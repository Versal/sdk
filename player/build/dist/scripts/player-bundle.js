/*!
 * js-api v0.3.2
 * lovingly baked from ad01c6c on 07. September 2013
 */

/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS text 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * Backbone Forms v0.12.0
 *
 * NOTE:
 * This version is for use with RequireJS
 * If using regular <script> tags to include your files, use backbone-forms.min.js
 *
 * Copyright (c) 2013 Charles Davison, Pow Media Ltd
 * 
 * License and more information at:
 * http://github.com/powmedia/backbone-forms
 */

/** 
 * Simple autocomplete plugin
 * with full keyboard navigation. 
 * works great with the tagbox plugin
 * 
 * @author Bastian Allgeier <bastian@getkirby.com>
 * @copyright Bastian Allgeier 2012
 * @license MIT
 */

/** 
 * Tag input plugin
 * works great with the autocomplete plugin
 * 
 * @author Bastian Allgeier <bastian@getkirby.com>
 * @copyright Bastian Allgeier 2012
 * @license MIT
 */

(function(e,t){typeof define=="function"&&define.amd&&define("plugins/vs.api",t),e.vs||(e.vs={}),e.vs.api=t()})(this,function(){var e,t,n;return function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),w=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n.apply(a[e],g);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!w)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../src/build/almond",[],function(){}),n("helpers/backbone_collection_move",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,n;t=e("backbone"),n=e("underscore"),t.Collection.prototype.move=function(e,t,n){var r;r=this.indexOf(e);if(r===-1)throw new Error("Can't move a model that's not in the collection");r!==t&&this.models.splice(t,0,this.models.splice(r,1)[0]),this.trigger("sort",this);if(n!=null?!n.silent:!void 0)return this.reorder(n)},t.Collection.prototype.getIndexes=function(){return n.map(this.models,function(e){return e.id})},t.Collection.prototype.reorder=function(e){var t;e==null&&(e={}),t=this.getIndexes();if(!t.length)return;return e.url==null&&(e.url=n.result(this,"url")+"/order"),e.attrs==null&&(e.attrs=t),this.sync("update",this,e)}}).call(this)}),n("models/asset_representation",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("backbone"),i=e("underscore"),t=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.isType=function(e){return this._isExactType(e)||this._isTypeWithWildcard(e)},t.prototype._isExactType=function(e){return e===this.get("contentType")},t.prototype._isTypeWithWildcard=function(e){var t,n,r;return r=e.split("/"),n=r[0],t=r[1],t==="*"&&n===i.first(this.get("contentType").split("/"))},t}(r.Model),n.exports=t}).call(this)}),n("collections/asset_representations",["require","exports","module","../models/asset_representation","backbone"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("../models/asset_representation"),i=e("backbone"),r=function(e){function n(){return s=n.__super__.constructor.apply(this,arguments),s}return u(n,e),n.prototype.model=t,n}(i.Collection),n.exports=r}).call(this)}),n("models/asset",["require","exports","module","backbone","../collections/asset_representations","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=e("backbone"),r=e("../collections/asset_representations"),s=e("underscore"),t=function(e){function t(e,n){e==null&&(e={}),n==null&&(n={}),this.representations=new r([],{asset:this}),n.parse=!0,t.__super__.constructor.call(this,e,n)}return u(t,e),t.prototype.urlRoot="/assets",t.prototype.validTypes=["image","video"],t.prototype.defaults={tags:[]},t.prototype.sync=function(e,t,n){return n==null&&(n={}),n.parse=!0,i.sync.apply(this,[e,t,n])},t.prototype.parse=function(e){return e.representations&&(this._expandLocations(e),this.representations.reset(e.representations),delete e.representations),e},t.prototype.toJSON=function(e){var t;return e==null&&(e={}),t=s.clone(this.attributes),e.upload||(t=s.omit(t,["content","contentType"])),e.includeRepresentations&&s.extend(t,{representations:this.representations.toJSON()}),t},t.prototype.hasRepresentation=function(e){return this.representations.any(function(t){return t.isType(e)})},t.prototype.getRepresentation=function(e){var t;return t=this.representations.select(function(t){return t.isType(e)}),s.map(t,function(e){return e.get("location")})},t.prototype.validate=function(e,t){t==null&&(t={}),this.attributes&&(e=s.extend(this.attributes,e));if(t.upload){if(!e.content)return"content is required to upload an asset";if(!e.contentType||!s.contains(this.validTypes,e.contentType.split("/")[0]))return"contentType should contain valid content type"}if(!e.title)return"title is required"},t.prototype._expandLocations=function(e){var t=this;return s.each(e.representations,function(e){if(!e.location.match(/^https?:\/\//))return e.location=t.baseUrl+e.location})},t}(i.Model),n.exports=t}).call(this)}),n("collections/assets",["require","exports","module","../models/asset","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("../models/asset"),i=e("backbone"),s=e("underscore"),r=function(e){function n(){return o=n.__super__.constructor.apply(this,arguments),o}return a(n,e),n.prototype.url=function(){return"/assets"},n.prototype.model=t,n.prototype.fetchByField=function(e,t,n){var r,i;return n==null&&(n={}),r=s.extend({},n.data),r[e]=t,i=s.extend({},n,{data:r}),this.fetch(i)},n.prototype.fetchByCreator=function(e,t){return this.fetchByField("creator",e,t)},n.prototype.fetchByTagLead=function(e,t){return this.fetchByField("tagLead",e,t)},n}(i.Collection),n.exports=r}).call(this)}),n("models/course_revision",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function n(e,n){n==null&&(n={});if(!n.course&&!n.catalog)throw new Error("Course or catalog reference is mandatory for CourseRevision");this.course=n.course,this.catalog=n.catalog,t.Model.apply(this,arguments)}return o(n,e),n.prototype.toJSON=function(){var e,t;return e={courseId:((t=this.course)!=null?t.id:void 0)||this.get("courseId")},e.revisionId=this.id||this.get("revisionId"),e},n}(t.Model),n.exports=r}).call(this)}),n("collections/course_revisions",["require","exports","module","backbone","underscore","../models/course_revision"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../models/course_revision"),i=function(e){function n(e,n){n==null&&(n={});if(!n.course&&!n.catalog)throw new Error("Course or catalog reference is mandatory for CourseRevisions");this.course=n.course,this.catalog=n.catalog,t.Collection.apply(this,arguments)}return u(n,e),n.prototype.model=r,n.prototype.create=function(e,t){return t==null&&(t={}),this.course&&(t.course=this.course),this.catalog&&(t.catalog=this.catalog),n.__super__.create.call(this,e,t)},n}(t.Collection),n.exports=i}).call(this)}),n("models/catalog",["require","exports","module","underscore","backbone","../collections/course_revisions"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=e("underscore"),t=e("backbone"),i=e("../collections/course_revisions"),r=function(e){function n(e,n){var r=this;e==null&&(e={}),n==null&&(n={}),this.courses=new i(n.courses,{catalog:this}),this.courses.url=function(){return s.result(r,"url")+"/courses"},n.parse=!0,t.Model.apply(this,arguments)}return u(n,e),n.prototype.urlRoot="/catalogs",n.prototype.parse=function(e){if(e.courses)return this.courses.set(e.courses)},n}(t.Model),n.exports=r}).call(this)}),n("collections/catalogs",["require","exports","module","backbone","../models/catalog"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=e("../models/catalog"),i=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.url="/catalogs",t.prototype.model=r,t}(t.Collection),n.exports=i}).call(this)}),n("models/gadget_userstate",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.isNew=function(){return!1},t.prototype.initialize=function(e,t){if(t!=null?!t.gadget:!void 0)throw new Error("gadget should be provided to create a gadget state");return this.gadget=t.gadget},t.prototype.setDefaults=function(e){return this.set(i.omit(e,i.keys(this.attributes)))},t}(t.Model),n.exports=r}).call(this)}),n("collections/gadget_userstates",["require","exports","module","backbone"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t.prototype.url=function(){if(this.gadget&&this.gadget.collection)return this.gadget.url()+"/userstates"},t.prototype.initialize=function(e,t){if(t!=null?!t.gadget:!void 0)throw new Error("Gadget reference is mandatory for GadgetUserstates");return this.gadget=t.gadget},t}(t.Collection),n.exports=r}).call(this)}),n("models/gadget_config",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.isNew=function(){return!1},t.prototype.initialize=function(e,t){if(t!=null?!t.gadget:!void 0)throw new Error("gadget should be provided to create a gadget config");return this.gadget=t.gadget},t.prototype.setDefaults=function(e){return this.set(i.omit(e,i.keys(this.attributes)))},t.prototype.validate=function(){if(!this.gadget.id)return"Cannot save config before gadget has been given an ID"},t}(t.Model),n.exports=r}).call(this)}),n("models/gadget",["require","exports","module","backbone","underscore","./gadget_userstate","../collections/gadget_userstates","./gadget_config"],function(e,t,n){(function(){var t,r,i,s,o,u,a={}.hasOwnProperty,f=function(e,t){function r(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),u=e("underscore"),s=e("./gadget_userstate"),o=e("../collections/gadget_userstates"),i=e("./gadget_config"),r=function(e){function t(e,n){var r=this;e==null&&(e={}),n==null&&(n={}),this.config=new i({},{gadget:this}),this.config.url=function(){return u.result(r,"url")+"/config"},this.userState=new s({},{gadget:this}),this.userState.url=function(){return u.result(r,"url")+"/userstate"},this.userStates=new o([],{gadget:this}),n.parse=!0,t.__super__.constructor.call(this,e,n)}return f(t,e),t.prototype.parse=function(e){if(!e)return;return e.config&&this.config.set(u.clone(e.config),{silent:!0}),e.userState&&this.userState.set(u.clone(e.userState),{silent:!0}),u.omit(e,["config","userState"])},t.prototype.toJSON=function(){var e;return e=u.clone(this.attributes),this.config&&(e.config=this.config.toJSON()),this.userState&&(e.userState=this.userState.toJSON()),e},t.prototype.validate=function(e){if(!e.type)return"Type is required. Did you call parse:true when instantiated your gadget?"},t}(t.Model),n.exports=r}).call(this)}),n("collections/gadgets",["require","exports","module","backbone","underscore","../models/gadget"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../models/gadget"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.model=r,t.prototype.url=function(){if(this.lesson)return s.result(this.lesson,"url")+"/gadgets"},t.prototype.initialize=function(e,t){return this.lesson=t&&t.lesson?t.lesson:void 0},t}(t.Collection),n.exports=i}).call(this)}),n("models/lesson",["require","exports","module","backbone","underscore","../collections/gadgets"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../collections/gadgets"),i=function(e){function t(e,n){e==null&&(e={}),n==null&&(n={}),this.gadgets=new r([],{lesson:this}),n.parse=!0,t.__super__.constructor.call(this,e,n)}return u(t,e),t.prototype.defaults={title:"Untitled lesson"},t.prototype.parse=function(e){if(!e)return;return e.gadgets&&this.gadgets.reset(e.gadgets,{parse:!0}),s.omit(e,"gadgets")},t.prototype.validate=function(e,t){if(!e.title)return"Title must be not empty"},t.prototype.toJSON=function(e){var t;t=s.clone(this.attributes);if(e!=null?e.gadgets:void 0)t.gadgets=this.gadgets.toJSON();return t},t}(t.Model),n.exports=i}).call(this)}),n("collections/lessons",["require","exports","module","backbone","underscore","../models/lesson"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../models/lesson"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.model=r,t.prototype.url=function(){if(this.course)return s.result(this.course,"url")+"/lessons"},t.prototype.initialize=function(e,t){if(t!=null?!t.course:!void 0)throw new Error("Course reference is mandatory for the Lessons");return this.course=t.course},t}(t.Collection),n.exports=i}).call(this)}),n("models/user",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.urlRoot="/users",t.prototype.signin=function(e){return e==null&&(e={}),e.url="/signin/"+this.id,e.useApiKey=!0,this.sync("create",this,e)},t.prototype.signout=function(e){return e==null&&(e={}),e.url="/signout",this.sync("create",this,e)},t.current=function(e){var n;return e==null&&(e={}),n=new t,e.self=!0,n.fetch(e)},t.prototype.defaults=function(){return{fn:"",location:"",shortDesc:"",longDesc:"",website:"",social:[],registered:!1,roles:{author:!1,developer:!1}}},t.prototype.fetch=function(e){return e.self&&(e.url="/user"),t.__super__.fetch.call(this,e)},t}(t.Model),n.exports=r}).call(this)}),n("collections/users",["require","exports","module","../models/user","backbone"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("../models/user"),t=e("backbone"),i=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.model=r,t}(t.Collection),n.exports=i}).call(this)}),n("models/course_progress",["require","exports","module","backbone"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t.prototype.isNew=function(){return!1},t}(t.Model),n.exports=r}).call(this)}),n("models/course_head",["require","exports","module","./course_revision","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("./course_revision"),i=e("underscore"),t=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.isNew=function(){return!1},t.prototype.discard=function(e){return this.id=null,this.save(this,e)},t}(r),n.exports=t}).call(this)}),n("models/course",["require","exports","module","backbone","underscore","../collections/lessons","../models/user","../collections/users","./catalog","./course_progress","../collections/course_revisions","./course_head"],function(e,t,n){(function(){var t,r,i,s,o,u,a,f,l,c,h,p,d,v={}.hasOwnProperty,m=function(e,t){function r(){this.constructor=e}for(var n in t)v.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),p=e("underscore"),l=e("../collections/lessons"),c=e("../models/user"),h=e("../collections/users"),r=e("./catalog"),o=e("./course_progress"),u=e("../collections/course_revisions"),s=e("./course_head"),a=function(e){function t(e,n){e==null&&(e={}),n==null&&(n={}),this.user=new c,t.__super__.constructor.apply(this,arguments)}return m(t,e),t.prototype.defaults={roles:{},user:null},t.prototype.parse=function(e){return e.user&&this.user.set(e.user,{parse:!0}),p.omit(e,"user")},t.prototype.toJSON=function(e){return p.omit(this.attributes,"id","user")},t}(t.Model),f=function(e){function t(){return d=t.__super__.constructor.apply(this,arguments),d}return m(t,e),t.prototype.model=a,t}(t.Collection),i=function(e){function n(e,n){var r=this;e==null&&(e={}),n==null&&(n={}),this.lessons=new l([],{course:this}),this.progress=new o({},{course:this}),this.progress.url=function(){return p.result(r,"url")+"/progress"},this.authors=new f,this.authors.url=function(){return p.result(r,"url")+"/users"},this.head=new s({},{course:this}),this.head.url=function(){return p.result(r,"url")+"/head"},this.revisions=new u([],{course:this}),this.revisions.url=function(){return p.result(r,"url")+"/revisions"},n.parse=!0,t.Model.call(this,e,n)}return m(n,e),n.prototype.urlRoot="/courses",n.prototype.defaults={title:"Untitled course",isEditable:!1,shortDesc:"",longDesc:"",authorBio:"",tags:[],catalogs:[]},n.prototype.parse=function(e){return e.lessons&&this.lessons.reset(e.lessons,{parse:!0}),e.authors&&this.authors.set(e.authors,{parse:!0}),e.revisions&&this.revisions.set(e.revisions,{parse:!0}),e.head&&this.head.set(p.clone(e.head),{silent:!0}),p.omit(e,"lessons","authors","revisions","head")},n.prototype.toJSON=function(e){var t;return e==null&&(e={}),t=p.clone(this.attributes),e.lessons&&(t.lessons=this.lessons.toJSON(e)),t},n.prototype.validate=function(e,t){if(!e.title)return"Title must be not empty"},n.prototype.stage=function(e){var t,n=this;return e==null&&(e={}),t=this.revisions.create({},{success:function(){var i;return i=new r({id:"staged"}),i.courses.create(t.toJSON(),{success:function(){var t;return(t=e.success)!=null?t.call(n,n):void 0}})}})},n.prototype.start=function(e){return e==null&&(e={}),e.url=p.result(this,"url")+"/start",this.sync("create",this,e)},n.prototype.complete=function(e){return e==null&&(e={}),e.url=p.result(this,"url")+"/completion",this.sync("update",this,e)},n.prototype.isStaged=function(){return this.get("catalogs").indexOf("staged")!==-1},n}(t.Model),n.exports=i}).call(this)}),n("collections/courses",["require","exports","module","../models/course","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("../models/course"),t=e("backbone"),s=e("underscore"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.model=r,t.prototype.url=function(){return"/courses"},t.prototype.fetchCatalog=function(e,t){var n,r;return t==null&&(t={}),n=s.extend({},t.data,{catalog:e}),r=s.extend({},t,{data:n}),this.fetch(r)},t.prototype.fetchUser=function(e){return this.fetchCatalog("user",e)},t.prototype.fetchLabs=function(e){return this.fetchCatalog("labs",e)},t}(t.Collection),n.exports=i}).call(this)}),n("models/gadget_project",["require","exports","module","underscore","backbone","jquery","./gadget"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};o=e("underscore"),r=e("backbone"),t=e("jquery"),i=e("./gadget"),n.exports=s=function(e){function n(e,t){e==null&&(e={}),t==null&&(t={}),t.parse=!0,n.__super__.constructor.call(this,e,t)}return a(n,e),n.cache={get:function(e){return n.cache[e]},set:function(e,t){return n.cache[e]=t}},n.prototype.urlRoot="gadgets",n.prototype.path=function(e){var t,r;return t=n.prototype.apiUrl||"",r=[t,this.urlRoot].concat(this.typeSegments()),e&&r.push(e),r.join("/")},n.prototype.manifest=function(){return this.path("manifest")},n.prototype.url=function(){return this.manifest()},n.prototype.main=function(){return this.path("gadget.js")},n.prototype.css=function(){if(!this.has("noCss"))return this.path("gadget.css")},n.prototype.icon=function(){return this.path("assets/icon.png")},n.prototype.code=function(){return this.path("code.zip")},n.prototype.compiled=function(){return this.path("compiled.zip")},n.prototype.typeSegments=function(){return[this.get("username"),this.get("name"),this.get("version")]},n.prototype.type=function(){return""+this.get("username")+"/"+this.get("name")+"@"+this.get("version")},n.prototype.cssClassName=function(){return("gadget-"+this.typeSegments().join("-")).replace(/[\.\s]+/g,"_")},n.prototype.changeCatalog=function(e,t){t==null&&(t={});if(!e)throw new Error("catalog is required");return t.url="/gadgets/"+this.id+"/status",this.sync("create",this,t)},n.prototype.parse=function(e,t){var n,r,i;e.username||e.type&&(e.username=e.type.split("/")[0]),i=e.files;for(n in i)r=i[n],r.slice(0,4)!=="http"&&(e.files[n]=this.baseUrl+r);return e},n.prototype.validate=function(e){if(!e.username)return"username is required for gadget project";if(!e.name)return"name is required for gadget project";if(!e.version)return"version is required for gadget project"},n.prototype.fetchConstructor=function(e){var r,i,s,o,u=this;e==null&&(e={});if(!this.has("classDefinition")){if(!n.prototype.apiUrl)throw new Error("apiUrl is required to resolve a gadget. Did you call api.init?");if(!n.prototype.requirejs)throw new Error("requirejs has to be provided to resolve a gadget. Did you call api.init?")}return o=function(t){return u.has("classDefinition")||(u.set("classDefinition",t),n.cache.get(u.type)||n.cache.set(u.type(),t)),s.resolve(t),e.success&&e.success.apply(u,[t]),u.trigger("resolve:success",t)},r=function(t){return s.reject(t),e.error&&e.error.apply(u,[t]),u.trigger("resolve:error",t)},s=t.Deferred(),(i=this.get("classDefinition"))?o(i):(i=n.cache.get(this.type()))?o(i):n.prototype.requirejs([""+n.prototype.apiUrl+this.main()],o,r),s.promise()},n}(r.Model)}).call(this)}),n("collections/gadget_projects",["require","exports","module","backbone","underscore","../models/gadget_project"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../models/gadget_project"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.url=function(){return"/gadgets"},t.prototype.model=r,t.prototype.fetchFiltered=function(e,t){var n,r;return t==null&&(t={}),n=s.extend({},t.data,e),r=s.extend({},t,{data:n}),this.fetch(r)},t.prototype.fetchApproved=function(e){return this.fetchFiltered({catalog:"approved"},e)},t.prototype.fetchSandbox=function(e){return this.fetchFiltered({user:"me",catalog:"sandbox"},e)},t.prototype.fetchPending=function(e){return this.fetchFiltered({user:"me",catalog:"pending"},e)},t.prototype.fetchRejected=function(e){return this.fetchFiltered({user:"me",catalog:"rejected"},e)},t.prototype.fetchUnapproved=function(e){var t=this;return $.when(this.fetchSandbox(e),this.fetchPending(e)).done(function(e,n){return t.reset(e[0].concat(n[0]))})},t}(t.Collection),n.exports=i}).call(this)}),n("models/partnerkey",["require","exports","module","backbone"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t.prototype.urlRoot="/partnerkeys",t.prototype.defaults={key:""},t}(t.Model),n.exports=r}).call(this)}),n("models/tag",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.urlRoot=function(){return"/tag"},t.prototype.idAttribute="path",t.prototype.validate=function(e,t){t==null&&(t={});if(!e.path)return"path is required to upload a tag"},t}(t.Model),n.exports=r}).call(this)}),n("collections/tags",["require","exports","module","../models/tag","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("../models/tag"),t=e("backbone"),s=e("underscore"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.url=function(){return"/tags"},t.prototype.model=r,t.prototype.fetchByField=function(e,t,n){var r,i;return n==null&&(n={}),r=s.extend({},n.data),r[e]=t,i=s.extend({},n,{data:r}),this.fetch(i)},t.prototype.fetchByPath=function(e,t){return this.fetchByField("path",e,t)},t}(t.Collection),n.exports=i}).call(this)}),n("api_errors",["require","exports","module"],function(e,t,n){(function(){var e,t,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=function(e){function t(){this.name="NotFound",t.__super__.constructor.apply(this,arguments)}return s(t,e),t}(Error),r=function(e){function t(){this.name="PermissionDenied",t.__super__.constructor.apply(this,arguments)}return s(t,e),t}(Error),e=function(e){function t(){this.name="ApplicationError",t.__super__.constructor.apply(this,arguments)}return s(t,e),t}(Error),n.exports={NotFound:t,PermissionDenied:r,ApplicationError:e}}).call(this)}),n("adapters/browser",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i;t=e("backbone"),i=e("underscore"),n.exports=r=function(){function e(){}return e.prototype.ajax=function(e){var t;return t=this.createRequestOptions(e),i.extend(t,{cache:!1,contentType:!1,processData:!1}),$.ajax(t)},e.prototype.createRequestOptions=function(e){return e},e.prototype.createFormData=function(e){var t,n,r,s;t=new FormData,s=e.toJSON({upload:!0});for(n in s)r=s[n],!(r instanceof File)&&(i.isArray(r)||i.isObject(r))&&(r=JSON.stringify(r)),t.append(n,r);return t},e.prototype.sendRequest=function(e){},e}()}).call(this)}),n("api",["require","exports","module","backbone","jquery","underscore","./helpers/backbone_collection_move","./models/asset","./collections/assets","./models/asset_representation","./collections/asset_representations","./models/catalog","./collections/catalogs","./models/course","./collections/courses","./models/course_head","./models/course_progress","./models/course_revision","./collections/course_revisions","./models/gadget","./collections/gadgets","./models/gadget_project","./collections/gadget_projects","./collections/gadget_userstates","./models/lesson","./collections/lessons","./models/partnerkey","./models/tag","./collections/tags","./models/user","./collections/users","./models/gadget","./api_errors","./adapters/node","./adapters/browser"],function(e,t,n){(function(){var t,r,i;t=e("backbone"),t.$=e("jquery"),i=e("underscore"),e("./helpers/backbone_collection_move"),n.exports=r={Asset:e("./models/asset"),Assets:e("./collections/assets"),AssetRepresentation:e("./models/asset_representation"),AssetRepresentations:e("./collections/asset_representations"),Catalog:e("./models/catalog"),Catalogs:e("./collections/catalogs"),Course:e("./models/course"),Courses:e("./collections/courses"),CourseHead:e("./models/course_head"),CourseProgress:e("./models/course_progress"),CourseRevision:e("./models/course_revision"),CourseRevisions:e("./collections/course_revisions"),Gadget:e("./models/gadget"),Gadgets:e("./collections/gadgets"),GadgetProject:e("./models/gadget_project"),GadgetProjects:e("./collections/gadget_projects"),GadgetUserStates:e("./collections/gadget_userstates"),Lesson:e("./models/lesson"),Lessons:e("./collections/lessons"),PartnerKey:e("./models/partnerkey"),Tag:e("./models/tag"),Tags:e("./collections/tags"),User:e("./models/user"),Users:e("./collections/users"),GadgetInstance:e("./models/gadget"),errors:e("./api_errors"),errorHandler:function(e,t,n){var s,o;n==null&&(n={});if(e instanceof Error)return e;if(!t||!t.status)return new Error("Unexpected result to error handler: "+JSON.stringify(arguments));o=r.errors,s=[t.status,i.result(e,"url"),t.responseText].join(" ");switch(t.status){case 401:case 403:return new o.PermissionDenied(s);case 404:return new o.NotFound(s);default:return new o.ApplicationError(s)}},connect:function(e){if(!e.url)throw new Error("url is required to connect to the API");return this.apiUrl=e.url.replace(/\/$/,""),this.apiKey=e.apiKey,this.sessionIdKey=e.sessionIdKey||"SESSION_ID",this.sessionId=e.sessionId,this.Asset.prototype.baseUrl=this.apiUrl,this.GadgetProject.prototype.apiUrl=this.apiUrl},setSIDHeader:function(e,t){var n;n=(t!=null?t.useApiKey:void 0)?this.apiKey:this.sessionId;if(!this.sessionIdKey||!n)return;return e.setRequestHeader(this.sessionIdKey,n)},init:function(e){var n,s,o=this;e==null&&(e={}),i.extend(this,t.Events),this.uploadAdapter=(e!=null?e.uploadAdapter:void 0)||this.getUploadAdapter(),e.url||(e.url=e.apiUrl),e.url&&this.connect(e),this.GadgetProject.prototype.requirejs=e.requirejs;if(!this._backbonePatched)return this._backbonePatched=!0,n=t.ajax,t.ajax=function(e){return e.upload&&o.uploadAdapter?o.uploadAdapter.ajax.apply(o.uploadAdapter,arguments):n.apply(o,arguments)},s=t.sync,t.sync=function(e,t,n){var u,a,f;return n==null&&(n={}),n=i.clone(n),a=n.url||i.result(t,"url"),a.match(/^https?:\/\//)?n.url=a:n.url=o.apiUrl+a,u=n.beforeSend,n.beforeSend=function(e){o.setSIDHeader(e,n);if(u)return u.apply(o,arguments)},n.upload&&(n.data=o.uploadAdapter.createFormData(t)),f=s.apply(o,arguments),f.requestUrl=n.url,i.isFunction(f.done)&&(r.trigger("xhr:start",f),f.done(i.bind(r.trigger,r,"xhr:success")),f.fail(i.bind(r.trigger,r,"xhr:error"))),f}},getUploadAdapter:function(){var t;return t=typeof Buffer!="undefined",t?new(e("./adapters/node")):new(e("./adapters/browser"))}}}).call(this)}),n("underscore",[],function(){return window._}),n("backbone",[],function(){return window.Backbone}),n("jquery",[],function(){return window.$}),n("adapters/node",[],function(){}),t("api")}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.5",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("ï»¿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);c.onXhr&&c.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText))},s.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!templates/course.html",[],function(){return'<div class="courseHeader">\n  <div class="headerContent">\n    <i class="js-toggle-toc toc-icon"></i>\n    <div class="saveErrorMsg hide">Your connection has been lost, changes were not saved.</div>\n    <div class="courseTitleWrapper">\n      <h2 class="title courseTitle"><%- title %></h2>\n      <i class=\'fade-out\'></i>\n    </div>\n\n    <div class="row bottomHalf">\n      <div class="lessonTitleWrapper">\n        <div class="lessonTitle" contenteditable="false" placeholder="Untitled lesson">\n          <%- firstLessonTitle %>\n        </div>\n        <i class=\'fade-out\'></i>\n      </div>\n      <!-- Per #44573495, hide these until they\'re working\n      <ul class="lessonControls">\n        <li class="js-search search"></li>\n        <li class="js-fav fav"></li>\n        <li class="js-overview-disabled overview disabled"></li>\n        <li class="js-more more"></li>\n      </ul>\n      -->\n    </div>\n\n  </div>\n\n</div>\n\n<div class="lessons"></div>\n\n<div class="nav"></div>\n\n<div class="toc"></div>\n\n'}),function(){var e=[].slice;define("messages/channel",[],function(){var t;return t=function(){function t(){this._subscribers=[],this.channels={}}return t.prototype.on=function(e,t){var n;return t==null&&(t=this),n={context:t,callback:e},this._subscribers.push(n)},t.prototype.off=function(e,t){var n,r,i,s,o;t==null&&(t=null),o=[];for(n=i=s=this._subscribers.length-1;i>=0;n=i+=-1)r=this._subscribers[n],e?r.callback===e?t==null||r.context===t?o.push(this._subscribers.splice(n,1)):o.push(void 0):o.push(void 0):o.push(this._subscribers.splice(n,1));return o},t.prototype.trigger=function(){var t,n,r,i,s,o;t=1<=arguments.length?e.call(arguments,0):[],s=this._subscribers,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(n.callback.apply(n.context,t));return o},t}()})}.call(this),function(){var e=[].slice;define("messages/mediator",["messages/channel"],function(t){var n;return n=function(){function n(){this.channels=new t}return n.prototype.getChannel=function(e){var n,r,i,s;n=e.split(":"),r=this.channels;while(n.length)s=n.shift(),i=r.channels,i[s]||(i[s]=new t),r=i[s];return r},n.prototype.on=function(e,t,n){var r;return r=this.getChannel(e),r.on(t,n!=null?n:n=this)},n.prototype.off=function(e,t,n){var r;return r=this.getChannel(e),r.off(t,n!=null?n:n=this)},n.prototype.trigger=function(){var t,n,r,i,s;i=arguments[0],r=2<=arguments.length?e.call(arguments,1):[],t=i.split(":"),n=this.channels,s=[];while(t.length){if(!(n=n.channels[t.shift()]))break;t.length?s.push(n.trigger.apply(n,[t.join(":")].concat(e.call(r)))):s.push(n.trigger.apply(n,r))}return s},n.prototype.triggerGadgetEvent=function(){var t,n,r;return n=arguments[0],r=arguments[1],t=3<=arguments.length?e.call(arguments,2):[],r="gadget:"+n+":"+r,this.trigger.apply(this,[r].concat(e.call(t)))},n}()})}.call(this),function(){define("app/mediator",["messages/mediator"],function(e){var t;return t=new e})}.call(this),function(){define("plugins/tracker",["app/mediator"],function(e){var t,n;return n={},t=function(t){return{_activeTimers:{},trackerSetup:function(e){return n=e},track:function(r,i){return i==null&&(i={}),e.trigger("metric:record",t,r,_.extend({},n,i))},startTimer:function(e){var t=this;return this._activeTimers[e]=(new Date).getTime(),{end:function(){return t.endTimer(e)}}},endTimer:function(r,i){var s,o,u;return i==null&&(i={}),(u=this._activeTimers[r])?(s=(new Date).getTime(),o={start:u,end:s,length:s-u},e.trigger("metric:record",t,r,_.extend({},n,i,o),"timer"),delete this._activeTimers[r]):!1}}}})}.call(this),function(){var e=[].slice,t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("messages/facade",["cdn.backbone","app/mediator"],function(n,r){var i,s;return s=["change","configure","configChange","configEmpty","doneEditing","domReady","domRemove","save","toggleEdit","registerPropertySheet","render","cancelEditing"],i=function(){function i(e){var t=this;this._model=e.model,this._gadgetId=this._model.cid,r.on("gadget:"+this._gadgetId+":change",function(e){return t.event("trigger","configChange",e)})}return i.prototype.event=function(e,t,r,i){return n.Events[e].call(this,t,r,i)},i.prototype.on=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.event.apply(this,["on"].concat(e.call(t)))},i.prototype.off=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.event.apply(this,["off"].concat(e.call(t)))},i.prototype.trigger=function(e,n,i){var o;return i==null&&(i={}),o=_.extend({},i,{gadgetId:this._gadgetId}),t.call(s,e)>=0?this.event("trigger",e,n,o):(this.event("trigger","local:"+e,n,o),r.trigger(e,n,o))},i.prototype.assetUrl=function(e){if(!e)return;return e.indexOf("assets/")!==0&&(e="assets/"+e),this._model.gadgetProject.path(e)},i}()})}.call(this),define("text!templates/property_sheet.html",[],function(){return'<div class="properties-dialog-arrow"></div>\n\n<div class="properties-dialog-header">\n  Properties\n\n  <div class="properties-dialog-error-count js-error-count-container">\n    <span class="js-error-count">1</span>\n    error<span class="js-error-count-plural">s</span>\n  </div>\n</div>\n\n<div class="js-form"></div>\n'}),define("libs/backbone-forms",["cdn.jquery","cdn.underscore","cdn.backbone"],function(e,t,n){var r=n.View.extend({initialize:function(e){var n=this;e=e||{};var r=this.schema=function(){if(e.schema)return t.result(e,"schema");var r=e.model;return r&&r.schema?t.isFunction(r.schema)?r.schema():r.schema:n.schema?t.isFunction(n.schema)?n.schema():n.schema:{}}();t.extend(this,t.pick(e,"model","data","idPrefix"));var i=this.constructor;this.template=e.template||i.template,this.Fieldset=e.Fieldset||i.Fieldset,this.Field=e.Field||i.Field,this.NestedField=e.NestedField||i.NestedField;var s=this.selectedFields=e.fields||t.keys(r),o=this.fields={};t.each(s,function(e){var t=r[e];o[e]=this.createField(e,t)},this);var u=e.fieldsets||[s],a=this.fieldsets=[];t.each(u,function(e){this.fieldsets.push(this.createFieldset(e))},this)},createFieldset:function(e){var t={schema:e,fields:this.fields};return new this.Fieldset(t)},createField:function(e,t){var n={form:this,key:e,schema:t,idPrefix:this.idPrefix};this.model?n.model=this.model:this.data?n.value=this.data[e]:n.value=null;var r=new this.Field(n);return this.listenTo(r.editor,"all",this.handleEditorEvent),r},handleEditorEvent:function(e,n){var r=n.key+":"+e;this.trigger.call(this,r,this,n);switch(e){case"change":this.trigger("change",this);break;case"focus":this.hasFocus||this.trigger("focus",this);break;case"blur":if(this.hasFocus){var i=this;setTimeout(function(){var e=t.find(i.fields,function(e){return e.editor.hasFocus});e||i.trigger("blur",i)},0)}}},render:function(){var n=this,r=this.fields,i=e(e.trim(this.template(t.result(this,"templateData"))));return i.find("[data-editors]").add(i).each(function(i,s){var o=e(s),u=o.attr("data-editors");if(t.isUndefined(u))return;var a=u=="*"?n.selectedFields||t.keys(r):u.split(",");t.each(a,function(e){var t=r[e];o.append(t.editor.render().el)})}),i.find("[data-fields]").add(i).each(function(i,s){var o=e(s),u=o.attr("data-fields");if(t.isUndefined(u))return;var a=u=="*"?n.selectedFields||t.keys(r):u.split(",");t.each(a,function(e){var t=r[e];o.append(t.render().el)})}),i.find("[data-fieldsets]").add(i).each(function(r,i){var s=e(i),o=s.attr("data-fieldsets");if(t.isUndefined(o))return;t.each(n.fieldsets,function(e){s.append(e.render().el)})}),this.setElement(i),this},validate:function(){var e=this,n=this.fields,r=this.model,i={};t.each(n,function(e){var t=e.validate();t&&(i[e.key]=t)});if(r&&r.validate){var s=r.validate(this.getValue());if(s){var o=t.isObject(s)&&!t.isArray(s);o||(i._others=i._others||[],i._others.push(s)),o&&t.each(s,function(e,t){if(n[t]&&!i[t])n[t].setError(e),i[t]=e;else{i._others=i._others||[];var r={};r[t]=e,i._others.push(r)}})}}return t.isEmpty(i)?null:i},commit:function(e){var n=this.validate();if(n)return n;var r,i=t.extend({error:function(e,t){r=t}},e);this.model.set(this.getValue(),i);if(r)return r},getValue:function(e){if(e)return this.fields[e].getValue();var n={};return t.each(this.fields,function(e){n[e.key]=e.getValue()}),n},setValue:function(e,t){var n={};typeof e=="string"?n[e]=t:n=e;var r;for(r in this.schema)n[r]!==undefined&&this.fields[r].setValue(n[r])},getEditor:function(e){var t=this.fields[e];if(!t)throw"Field not found: "+e;return t.editor},focus:function(){if(this.hasFocus)return;var e=this.fieldsets[0],t=e.getFieldAt(0);if(!t)return;t.editor.focus()},blur:function(){if(!this.hasFocus)return;var e=t.find(this.fields,function(e){return e.editor.hasFocus});e&&e.editor.blur()},trigger:function(e){return e==="focus"?this.hasFocus=!0:e==="blur"&&(this.hasFocus=!1),n.View.prototype.trigger.apply(this,arguments)},remove:function(){t.each(this.fieldsets,function(e){e.remove()}),t.each(this.fields,function(e){e.remove()}),n.View.prototype.remove.call(this)}},{template:t.template("    <form data-fieldsets></form>  ",null,this.templateSettings),templateSettings:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},editors:{}});return r.validators=function(){var e={};return e.errMessages={required:"Required",regexp:"Invalid",email:"Invalid email address",url:"Invalid URL",match:t.template('Must match field "<%= field %>"',null,r.templateSettings)},e.required=function(e){return e=t.extend({type:"required",message:this.errMessages.required},e),function(r){e.value=r;var i={type:e.type,message:t.isFunction(e.message)?e.message(e):e.message};if(r===null||r===undefined||r===!1||r==="")return i}},e.regexp=function(e){if(!e.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return e=t.extend({type:"regexp",message:this.errMessages.regexp},e),function(r){e.value=r;var i={type:e.type,message:t.isFunction(e.message)?e.message(e):e.message};if(r===null||r===undefined||r==="")return;if(!e.regexp.test(r))return i}},e.email=function(n){return n=t.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},n),e.regexp(n)},e.url=function(n){return n=t.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i},n),e.regexp(n)},e.match=function(e){if(!e.field)throw new Error('Missing required "field" options for "match" validator');return e=t.extend({type:"match",message:this.errMessages.match},e),function(r,i){e.value=r;var s={type:e.type,message:t.isFunction(e.message)?e.message(e):e.message};if(r===null||r===undefined||r==="")return;if(r!==i[e.field])return s}},e}(),r.Fieldset=n.View.extend({initialize:function(e){e=e||{};var n=this.schema=this.createSchema(e.schema);this.fields=t.pick(e.fields,n.fields),this.template=e.template||this.constructor.template},createSchema:function(e){return t.isArray(e)&&(e={fields:e}),e.legend=e.legend||null,e},getFieldAt:function(e){var t=this.schema.fields[e];return this.fields[t]},templateData:function(){return this.schema},render:function(){var n=this.schema,r=this.fields,i=e(e.trim(this.template(t.result(this,"templateData"))));return i.find("[data-fields]").add(i).each(function(n,i){var s=e(i),o=s.attr("data-fields");if(t.isUndefined(o))return;t.each(r,function(e){s.append(e.render().el)})}),this.setElement(i),this},remove:function(){t.each(this.fields,function(e){e.remove()}),n.View.prototype.remove.call(this)}},{template:t.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  ",null,r.templateSettings)}),r.Field=n.View.extend({initialize:function(e){e=e||{},t.extend(this,t.pick(e,"form","key","model","value","idPrefix"));var n=this.schema=this.createSchema(e.schema);this.template=e.template||n.template||this.constructor.template,this.errorClassName=e.errorClassName||this.constructor.errorClassName,this.editor=this.createEditor()},createSchema:function(e){return t.isString(e)&&(e={type:e}),e=t.extend({type:"Text",title:this.createTitle()},e),e.type=t.isString(e.type)?r.editors[e.type]:e.type,e},createEditor:function(){var e=t.extend(t.pick(this,"schema","form","key","model","value"),{id:this.createEditorId()}),n=this.schema.type;return new n(e)},createEditorId:function(){var e=this.idPrefix,n=this.key;return n=n.replace(/\./g,"_"),t.isString(e)||t.isNumber(e)?e+n:t.isNull(e)?n:this.model?this.model.cid+"_"+n:n},createTitle:function(){var e=this.key;return e=e.replace(/([A-Z])/g," $1"),e=e.replace(/^./,function(e){return e.toUpperCase()}),e},templateData:function(){var e=this.schema;return{help:e.help||"",title:e.title,fieldAttrs:e.fieldAttrs,editorAttrs:e.editorAttrs,key:this.key,editorId:this.editor.id}},render:function(){var n=this.schema,r=this.editor,i=e(e.trim(this.template(t.result(this,"templateData"))));return n.fieldClass&&i.addClass(n.fieldClass),n.fieldAttrs&&i.attr(n.fieldAttrs),i.find("[data-editor]").add(i).each(function(n,i){var s=e(i),o=s.attr("data-editor");if(t.isUndefined(o))return;s.append(r.render().el)}),this.setElement(i),this},validate:function(){var e=this.editor.validate();return e?this.setError(e.message):this.clearError(),e},setError:function(e){if(this.editor.hasNestedForm)return;this.$el.addClass(this.errorClassName),this.$("[data-error]").html(e)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$("[data-error]").empty()},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),n.View.prototype.remove.call(this)}},{template:t.template('    <div>      <label for="<%= editorId %>"><%= title %></label>      <div>        <span data-editor></span>        <div data-error></div>        <div><%= help %></div>      </div>    </div>  ',null,r.templateSettings),errorClassName:"error"}),r.NestedField=r.Field.extend({template:t.template(e.trim("    <div>      <span data-editor></span>      <% if (help) { %>        <div><%= help %></div>      <% } %>      <div data-error></div>    </div>  "),null,r.templateSettings)}),r.Editor=r.editors.Base=n.View.extend({defaultValue:null,hasFocus:!1,initialize:function(e){var e=e||{};if(e.model){if(!e.key)throw"Missing option: 'key'";this.model=e.model,this.value=this.model.get(e.key)}else e.value&&(this.value=e.value);this.value===undefined&&(this.value=this.defaultValue),t.extend(this,t.pick(e,"key","form"));var n=this.schema=e.schema||{};this.validators=e.validators||n.validators,this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),n.editorClass&&this.$el.addClass(n.editorClass),n.editorAttrs&&this.$el.attr(n.editorAttrs)},getName:function(){var e=this.key||"";return e.replace(/\./g,"_")},getValue:function(){return this.value},setValue:function(e){this.value=e},focus:function(){throw"Not implemented"},blur:function(){throw"Not implemented"},commit:function(e){var t=this.validate();if(t)return t;this.listenTo(this.model,"invalid",function(e,n){t=n}),this.model.set(this.key,this.getValue(),e);if(t)return t},validate:function(){var e=this.$el,n=null,r=this.getValue(),i=this.form?this.form.getValue():{},s=this.validators,o=this.getValidator;return s&&t.every(s,function(e){return n=o(e)(r,i),n?!1:!0}),n},trigger:function(e){return e==="focus"?this.hasFocus=!0:e==="blur"&&(this.hasFocus=!1),n.View.prototype.trigger.apply(this,arguments)},getValidator:function(e){var n=r.validators;if(t.isRegExp(e))return n.regexp({regexp:e});if(t.isString(e)){if(!n[e])throw new Error('Validator "'+e+'" not found');return n[e]()}if(t.isFunction(e))return e;if(t.isObject(e)&&e.type){var i=e;return n[i.type](i)}throw new Error("Invalid validator: "+e)}}),r.editors.Text=r.Editor.extend({tagName:"input",defaultValue:"",previousValue:"",events:{keyup:"determineChange",keypress:function(e){var t=this;setTimeout(function(){t.determineChange()},0)},select:function(e){this.trigger("select",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e);var t=this.schema,n="text";t&&t.editorAttrs&&t.editorAttrs.type&&(n=t.editorAttrs.type),t&&t.dataType&&(n=t.dataType),this.$el.attr("type",n)},render:function(){return this.setValue(this.value),this},determineChange:function(e){var t=this.$el.val(),n=t!==this.previousValue;n&&(this.previousValue=t,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e),this.previousValue=this.$el.val()},focus:function(){if(this.hasFocus)return;this.$el.focus()},blur:function(){if(!this.hasFocus)return;this.$el.blur()},select:function(){this.$el.select()}}),r.editors.TextArea=r.editors.Text.extend({tagName:"textarea"}),r.editors.Password=r.editors.Text.extend({initialize:function(e){r.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","password")}}),r.editors.Number=r.editors.Text.extend({defaultValue:0,events:t.extend({},r.editors.Text.prototype.events,{keypress:"onKeyPress",input:"determineChange"}),initialize:function(e){r.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","number"),this.$el.attr("step","any")},onKeyPress:function(e){var t=this,n=function(){setTimeout(function(){t.determineChange()},0)};if(e.charCode===0){n();return}var r=this.$el.val()+String.fromCharCode(e.charCode),i=/^-?[0-9]*\.?[0-9]*$/.test(r);i?n():e.preventDefault()},getValue:function(){var e=this.$el.val();return e===""?null:parseFloat(e,10)},setValue:function(e){e=function(){return t.isNumber(e)?e:t.isString(e)&&e!==""?parseFloat(e,10):null}(),t.isNaN(e)&&(e=null),r.editors.Text.prototype.setValue.call(this,e)}}),r.editors.Hidden=r.editors.Base.extend({defaultValue:"",initialize:function(e){r.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","hidden")},focus:function(){},blur:function(){}}),r.editors.Checkbox=r.editors.Base.extend({defaultValue:!1,tagName:"input",events:{click:function(e){this.trigger("change",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.prop("checked")},setValue:function(e){e&&this.$el.prop("checked",!0)},focus:function(){if(this.hasFocus)return;this.$el.focus()},blur:function(){if(!this.hasFocus)return;this.$el.blur()}}),r.editors.Select=r.editors.Base.extend({tagName:"select",events:{change:function(e){this.trigger("change",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e);if(!this.schema||!this.schema.options)throw"Missing required 'schema.options'"},render:function(){return this.setOptions(this.schema.options),this},setOptions:function(e){var r=this;if(e instanceof n.Collection){var i=e;i.length>0?this.renderOptions(e):i.fetch({success:function(t){r.renderOptions(e)}})}else t.isFunction(e)?e(function(e){r.renderOptions(e)},r):this.renderOptions(e)},renderOptions:function(e){var t=this.$el,n;n=this._getOptionsHtml(e),t.html(n),this.setValue(this.value)},_getOptionsHtml:function(e){var r;if(t.isString(e))r=e;else if(t.isArray(e))r=this._arrayToHtml(e);else if(e instanceof n.Collection)r=this._collectionToHtml(e);else if(t.isFunction(e)){var i;e(function(e){i=e},this),r=this._getOptionsHtml(i)}return r},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)},focus:function(){if(this.hasFocus)return;this.$el.focus()},blur:function(){if(!this.hasFocus)return;this.$el.blur()},_collectionToHtml:function(e){var t=[];e.each(function(e){t.push({val:e.id,label:e.toString()})});var n=this._arrayToHtml(t);return n},_arrayToHtml:function(e){var n=[];return t.each(e,function(e){if(t.isObject(e))if(e.group)n.push('<optgroup label="'+e.group+'">'),n.push(this._getOptionsHtml(e.options)),n.push("</optgroup>");else{var r=e.val||e.val===0?e.val:"";n.push('<option value="'+r+'">'+e.label+"</option>")}else n.push("<option>"+e+"</option>")},this),n.join("")}}),r.editors.Radio=r.editors.Select.extend({tagName:"ul",events:{"change input[type=radio]":function(){this.trigger("change",this)},"focus input[type=radio]":function(){if(this.hasFocus)return;this.trigger("focus",this)},"blur input[type=radio]":function(){if(!this.hasFocus)return;var e=this;setTimeout(function(){if(e.$("input[type=radio]:focus")[0])return;e.trigger("blur",e)},0)}},getValue:function(){return this.$("input[type=radio]:checked").val()},setValue:function(e){this.$("input[type=radio]").val([e])},focus:function(){if(this.hasFocus)return;var e=this.$("input[type=radio]:checked");if(e[0]){e.focus();return}this.$("input[type=radio]").first().focus()},blur:function(){if(!this.hasFocus)return;this.$("input[type=radio]:focus").blur()},_arrayToHtml:function(e){var n=[],r=this;return t.each(e,function(e,i){var s="<li>";if(t.isObject(e)){var o=e.val||e.val===0?e.val:"";s+='<input type="radio" name="'+r.id+'" value="'+o+'" id="'+r.id+"-"+i+'" />',s+='<label for="'+r.id+"-"+i+'">'+e.label+"</label>"}else s+='<input type="radio" name="'+r.id+'" value="'+e+'" id="'+r.id+"-"+i+'" />',s+='<label for="'+r.id+"-"+i+'">'+e+"</label>";s+="</li>",n.push(s)}),n.join("")}}),r.editors.Checkboxes=r.editors.Select.extend({tagName:"ul",events:{"click input[type=checkbox]":function(){this.trigger("change",this)},"focus input[type=checkbox]":function(){if(this.hasFocus)return;this.trigger("focus",this)},"blur input[type=checkbox]":function(){if(!this.hasFocus)return;var e=this;setTimeout(function(){if(e.$("input[type=checkbox]:focus")[0])return;e.trigger("blur",e)},0)}},getValue:function(){var t=[];return this.$("input[type=checkbox]:checked").each(function(){t.push(e(this).val())}),t},setValue:function(e){t.isArray(e)||(e=[e]),this.$("input[type=checkbox]").val(e)},focus:function(){if(this.hasFocus)return;this.$("input[type=checkbox]").first().focus()},blur:function(){if(!this.hasFocus)return;this.$("input[type=checkbox]:focus").blur()},_arrayToHtml:function(e){var n=[],r=this;return t.each(e,function(e,i){var s="<li>";if(t.isObject(e)){var o=e.val||e.val===0?e.val:"";s+='<input type="checkbox" name="'+r.id+'" value="'+o+'" id="'+r.id+"-"+i+'" />',s+='<label for="'+r.id+"-"+i+'">'+e.label+"</label>"}else s+='<input type="checkbox" name="'+r.id+'" value="'+e+'" id="'+r.id+"-"+i+'" />',s+='<label for="'+r.id+"-"+i+'">'+e+"</label>";s+="</li>",n.push(s)}),n.join("")}}),r.editors.Object=r.editors.Base.extend({hasNestedForm:!0,initialize:function(e){this.value={},r.editors.Base.prototype.initialize.call(this,e);if(!this.form)throw'Missing required option "form"';if(!this.schema.subSchema)throw new Error("Missing required 'schema.subSchema' option for Object editor")},render:function(){var e=this.form.constructor;return this.nestedForm=new e({schema:this.schema.subSchema,data:this.value,idPrefix:this.id+"_",Field:e.NestedField}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return this.nestedForm?this.nestedForm.getValue():this.value},setValue:function(e){this.value=e,this.render()},focus:function(){if(this.hasFocus)return;this.nestedForm.focus()},blur:function(){if(!this.hasFocus)return;this.nestedForm.blur()},remove:function(){this.nestedForm.remove(),n.View.prototype.remove.call(this)},validate:function(){return this.nestedForm.validate()},_observeFormEvents:function(){if(!this.nestedForm)return;this.nestedForm.on("all",function(){var e=t.toArray(arguments);e[1]=this,this.trigger.apply(this,e)},this)}}),r.editors.NestedModel=r.editors.Object.extend({initialize:function(e){r.editors.Base.prototype.initialize.call(this,e);if(!this.form)throw'Missing required option "form"';if(!e.schema.model)throw'Missing required "schema.model" option for NestedModel editor'},render:function(){var e=this.form.constructor,t=this.value||{},n=this.key,r=this.schema.model,i=t.constructor===r?t:new r(t);return this.nestedForm=new e({model:i,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){var e=this.nestedForm.commit();return e?(this.$el.addClass("error"),e):r.editors.Object.prototype.commit.call(this)}}),r.editors.Date=r.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){if(this.hasFocus)return;this.trigger("focus",this)},"blur select":function(){if(!this.hasFocus)return;var e=this;setTimeout(function(){if(e.$("select:focus")[0])return;e.trigger("blur",e)},0)}},initialize:function(e){e=e||{},r.editors.Base.prototype.initialize.call(this,e);var n=r.editors.Date,i=new Date;this.options=t.extend({monthNames:n.monthNames,showMonthNames:n.showMonthNames},e),this.schema=t.extend({yearStart:i.getFullYear()-100,yearEnd:i.getFullYear()},e.schema||{}),this.value&&!t.isDate(this.value)&&(this.value=new Date(this.value));if(!this.value){var s=new Date;s.setSeconds(0),s.setMilliseconds(0),this.value=s}this.template=e.template||this.constructor.template},render:function(){var n=this.options,r=this.schema,i=t.map(t.range(1,32),function(e){return'<option value="'+e+'">'+e+"</option>"}),s=t.map(t.range(0,12),function(e){var t=n.showMonthNames?n.monthNames[e]:e+1;return'<option value="'+e+'">'+t+"</option>"}),o=r.yearStart<r.yearEnd?t.range(r.yearStart,r.yearEnd+1):t.range(r.yearStart,r.yearEnd-1,-1),u=t.map(o,function(e){return'<option value="'+e+'">'+e+"</option>"}),a=e(e.trim(this.template({dates:i.join(""),months:s.join(""),years:u.join("")})));return this.$date=a.find('[data-type="date"]'),this.$month=a.find('[data-type="month"]'),this.$year=a.find('[data-type="year"]'),this.$hidden=e('<input type="hidden" name="'+this.key+'" />'),a.append(this.$hidden),this.setValue(this.value),this.setElement(a),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.$year.val(),t=this.$month.val(),n=this.$date.val();return!e||!t||!n?null:new Date(e,t,n)},setValue:function(e){this.$date.val(e.getDate()),this.$month.val(e.getMonth()),this.$year.val(e.getFullYear()),this.updateHidden()},focus:function(){if(this.hasFocus)return;this.$("select").first().focus()},blur:function(){if(!this.hasFocus)return;this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();t.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)}},{template:t.template('    <div>      <select data-type="date"><%= dates %></select>      <select data-type="month"><%= months %></select>      <select data-type="year"><%= years %></select>    </div>  ',null,r.templateSettings),showMonthNames:!0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]}),r.editors.DateTime=r.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){if(this.hasFocus)return;this.trigger("focus",this)},"blur select":function(){if(!this.hasFocus)return;var e=this;setTimeout(function(){if(e.$("select:focus")[0])return;e.trigger("blur",e)},0)}},initialize:function(e){e=e||{},r.editors.Base.prototype.initialize.call(this,e),this.options=t.extend({DateEditor:r.editors.DateTime.DateEditor},e),this.schema=t.extend({minsInterval:15},e.schema||{}),this.dateEditor=new this.options.DateEditor(e),this.value=this.dateEditor.value,this.template=e.template||this.constructor.template},render:function(){function n(e){return e<10?"0"+e:e}var r=this.schema,i=t.map(t.range(0,24),function(e){return'<option value="'+e+'">'+n(e)+"</option>"}),s=t.map(t.range(0,60,r.minsInterval),function(e){return'<option value="'+e+'">'+n(e)+"</option>"}),o=e(e.trim(this.template({hours:i.join(),mins:s.join()})));return o.find("[data-date]").append(this.dateEditor.render().el),this.$hour=o.find('select[data-type="hour"]'),this.$min=o.find('select[data-type="min"]'),this.$hidden=o.find('input[type="hidden"]'),this.setValue(this.value),this.setElement(o),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.dateEditor.getValue(),t=this.$hour.val(),n=this.$min.val();return!e||!t||!n?null:(e.setHours(t),e.setMinutes(n),e)},setValue:function(e){t.isDate(e)||(e=new Date(e)),this.dateEditor.setValue(e),this.$hour.val(e.getHours()),this.$min.val(e.getMinutes()),this.updateHidden()},focus:function(){if(this.hasFocus)return;this.$("select").first().focus()},blur:function(){if(!this.hasFocus)return;this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();t.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)},remove:function(){this.dateEditor.remove(),r.editors.Base.prototype.remove.call(this)}},{template:t.template('    <div class="bbf-datetime">      <div class="bbf-date-container" data-date></div>      <select data-type="hour"><%= hours %></select>      :      <select data-type="min"><%= mins %></select>    </div>  ',null,r.templateSettings),DateEditor:r.editors.Date}),r.VERSION="0.12.0",n.Form=r,r}),function(){define("libs/backbone-forms.bootstrap",["cdn.jquery","cdn.underscore","cdn.backbone","libs/backbone-forms"],function(e,t,n){var r;return r=n.Form,r.template=t.template('<form class="form" data-fieldsets></form>'),r.Fieldset.template=t.template('<fieldset class="bbf-fieldset" data-fields>\n  <% if (legend) { %>\n    <legend><%= legend %></legend>\n  <% } %>\n</fieldset>'),r.Field.template=t.template('<div class="control-group field-<%= key %> bbf-field">\n  <% if (this.options.schema.type === "Checkbox") { %>\n    <div class="bbf-editor hacked-for-checkbox" data-editor><label class="control-label" for="<%= editorId %>"><%= title %></label></div>\n    <div class="clearfix"></div>\n  <% } else { %>\n    <label class="control-label" for="<%= editorId %>"><%= title %></label>\n    <div class="bbf-editor" data-editor></div>\n  <% } %>\n  <div class="bbf-error-tooltip-container">\n    <div class="bff-error-tooltip versal-tooltip versal-tooltip-text versal-tooltip-left versal-tooltip-align-top">\n      <div class="versal-tooltip-arrow"></div>\n      <div class="bbf-error" data-error></div>\n    </div>\n  </div>\n</div>'),r.editors.Date.template=t.template('<div class="bbf-date">\n  <select data-type="date" class="bbf-date"><%= dates %></select>\n  <select data-type="month" class="bbf-month"><%= months %></select>\n  <select data-type="year" class="bbf-year"><%= years %></select>\n</div>'),r.editors.DateTime.template=t.template('<div class="bbf-datetime">\n  <div class="bbf-date-container" data-date></div>\n  <select data-type="hour" style="width: 4em"><%= hours %></select>\n  :\n  <select data-type="min" style="width: 4em"><%= mins %></select>\n</div>'),r.Field.errorClassName="bbf-error"})}.call(this);try{window.Modernizr=function(e,t,n){function r(e){v.cssText=e}function i(e,t){return r(prefixes.join(e+";")+(t||""))}function s(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function u(e,t,r){for(var i in e){var o=t[e[i]];if(o!==n)return r===!1?e[i]:s(o,"function")?o.bind(r||t):o}return!1}function a(){l.inputtypes=function(e){for(var r=0,i,s,o,u=e.length;r<u;r++)m.setAttribute("type",s=e[r]),i=m.type!=="text",i&&(m.value=g,m.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(s)&&m.style.WebkitAppearance!==n?(h.appendChild(m),o=t.defaultView,i=o.getComputedStyle&&o.getComputedStyle(m,null).WebkitAppearance!=="textfield"&&m.offsetHeight!==0,h.removeChild(m)):/^(search|tel)$/.test(s)||(/^(url|email)$/.test(s)?i=m.checkValidity&&m.checkValidity()===!1:i=m.value!=g)),w[e[r]]=!!i;return w}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var f="2.6.2",l={},c=!0,h=t.documentElement,p="modernizr",d=t.createElement(p),v=d.style,m=t.createElement("input"),g=":)",y={}.toString,b={},w={},E={},S=[],x=S.slice,T,N={}.hasOwnProperty,C;!s(N,"undefined")&&!s(N.call,"undefined")?C=function(e,t){return N.call(e,t)}:C=function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(typeof t!="function")throw new TypeError;var n=x.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,o=t.apply(s,n.concat(x.call(arguments)));return Object(o)===o?o:s}return t.apply(e,n.concat(x.call(arguments)))};return r});for(var k in b)C(b,k)&&(T=k.toLowerCase(),l[T]=b[k](),S.push((l[T]?"":"no-")+T));return l.input||a(),l.addTest=function(e,t){if(typeof e=="object")for(var r in e)C(e,r)&&l.addTest(r,e[r]);else{e=e.toLowerCase();if(l[e]!==n)return l;t=typeof t=="function"?t():t,typeof c!="undefined"&&c&&(h.className+=" "+(t?"":"no-")+e),l[e]=t}return l},r(""),d=m=null,function(e,t){function n(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var e=g.elements;return typeof e=="string"?e.split(" "):e}function i(e){var t=v[e[p]];return t||(t={},d++,e[p]=d,v[d]=t),t}function s(e,n,r){n||(n=t);if(m)return n.createElement(e);r||(r=i(n));var s;return r.cache[e]?s=r.cache[e].cloneNode():c.test(e)?s=(r.cache[e]=r.createElem(e)).cloneNode():s=r.createElem(e),s.canHaveChildren&&!l.test(e)?r.frag.appendChild(s):s}function o(e,n){e||(e=t);if(m)return e.createDocumentFragment();n=n||i(e);var s=n.frag.cloneNode(),o=0,u=r(),a=u.length;for(;o<a;o++)s.createElement(u[o]);return s}function u(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return g.shivMethods?s(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/\w+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(g,t.frag)}function a(e){e||(e=t);var r=i(e);return g.shivCSS&&!h&&!r.hasCSS&&(r.hasCSS=!!n(e,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),m||u(e,r),e}var f=e.html5||{},l=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,c=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,h,p="_html5shiv",d=0,v={},m;(function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",h="hidden"in e,m=e.childNodes.length==1||function(){t.createElement("a");var e=t.createDocumentFragment();return typeof e.cloneNode=="undefined"||typeof e.createDocumentFragment=="undefined"||typeof e.createElement=="undefined"}()}catch(n){h=!0,m=!0}})();var g={elements:f.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:f.shivCSS!==!1,supportsUnknownElements:m,shivMethods:f.shivMethods!==!1,type:"default",shivDocument:a,createElement:s,createDocumentFragment:o};e.html5=g,a(t)}(this,t),l._version=f,h.className=h.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(c?" js "+S.join(" "):""),l}(this,this.document),function(e,t,n){function r(e){return"[object Function]"==d.call(e)}function i(e){return"string"==typeof e}function s(){}function o(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function u(){var e=v.shift();m=1,e?e.t?h(function(){("c"==e.t?k.injectCss:k.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),u()):m=0}function a(e,n,r,i,s,a,f){function l(t){if(!d&&o(c.readyState)&&(w.r=d=1,!m&&u(),c.onload=c.onreadystatechange=null,t)){"img"!=e&&h(function(){b.removeChild(c)},50);for(var r in T[n])T[n].hasOwnProperty(r)&&T[n][r].onload()}}var f=f||k.errorTimeout,c=t.createElement(e),d=0,g=0,w={t:r,s:n,e:s,a:a,x:f};1===T[n]&&(g=1,T[n]=[]),"object"==e?c.data=n:(c.src=n,c.type=e),c.width=c.height="0",c.onerror=c.onload=c.onreadystatechange=function(){l.call(this,g)},v.splice(i,0,w),"img"!=e&&(g||2===T[n]?(b.insertBefore(c,y?null:p),h(l,f)):T[n].push(c))}function f(e,t,n,r,s){return m=0,t=t||"j",i(e)?a("c"==t?E:w,e,t,this.i++,n,r,s):(v.splice(this.i++,0,e),1==v.length&&u()),this}function l(){var e=k;return e.loader={load:f,i:0},e}var c=t.documentElement,h=e.setTimeout,p=t.getElementsByTagName("script")[0],d={}.toString,v=[],m=0,g="MozAppearance"in c.style,y=g&&!!t.createRange().compareNode,b=y?c:p.parentNode,c=e.opera&&"[object Opera]"==d.call(e.opera),c=!!t.attachEvent&&!c,w=g?"object":c?"script":"img",E=c?"script":w,S=Array.isArray||function(e){return"[object Array]"==d.call(e)},x=[],T={},N={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}},C,k;k=function(e){function t(e){var e=e.split("!"),t=x.length,n=e.pop(),r=e.length,n={url:n,origUrl:n,prefixes:e},i,s,o;for(s=0;s<r;s++)o=e[s].split("="),(i=N[o.shift()])&&(n=i(n,o));for(s=0;s<t;s++)n=x[s](n);return n}function o(e,i,s,o,u){var a=t(e),f=a.autoCallback;a.url.split(".").pop().split("?").shift(),a.bypass||(i&&(i=r(i)?i:i[e]||i[o]||i[e.split("/").pop().split("?")[0]]),a.instead?a.instead(e,i,s,o,u):(T[a.url]?a.noexec=!0:T[a.url]=1,s.load(a.url,a.forceCSS||!a.forceJS&&"css"==a.url.split(".").pop().split("?").shift()?"c":n,a.noexec,a.attrs,a.timeout),(r(i)||r(f))&&s.load(function(){l(),i&&i(a.origUrl,u,o),f&&f(a.origUrl,u,o),T[a.url]=2})))}function u(e,t){function n(e,n){if(e){if(i(e))n||(f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}),o(e,f,t,0,u);else if(Object(e)===e)for(p in h=function(){var t=0,n;for(n in e)e.hasOwnProperty(n)&&t++;return t}(),e)e.hasOwnProperty(p)&&(!n&&!--h&&(r(f)?f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}:f[p]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),c()}}(l[p])),o(e[p],f,t,p,u))}else!n&&c()}var u=!!e.test,a=e.load||e.both,f=e.callback||s,l=f,c=e.complete||s,h,p;n(u?e.yep:e.nope,!!a),a&&n(a)}var a,f,c=this.yepnope.loader;if(i(e))o(e,0,c,0);else if(S(e))for(a=0;a<e.length;a++)f=e[a],i(f)?o(f,0,c,0):S(f)?k(f):Object(f)===f&&u(f,c);else Object(e)===e&&u(e,c)},k.addPrefix=function(e,t){N[e]=t},k.addFilter=function(e){x.push(e)},k.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",C=function(){t.removeEventListener("DOMContentLoaded",C,0),t.readyState="complete"},0)),e.yepnope=l(),e.yepnope.executeStack=u,e.yepnope.injectJs=function(e,n,r,i,a,f){var l=t.createElement("script"),c,d,i=i||k.errorTimeout;l.src=e;for(d in r)l.setAttribute(d,r[d]);n=f?u:n||s,l.onreadystatechange=l.onload=function(){!c&&o(l.readyState)&&(c=1,n(),l.onload=l.onreadystatechange=null)},h(function(){c||(c=1,n(1))},i),a?l.onload():p.parentNode.insertBefore(l,p)},e.yepnope.injectCss=function(e,n,r,i,o,a){var i=t.createElement("link"),f,n=a?u:n||s;i.href=e,i.rel="stylesheet",i.type="text/css";for(f in r)i.setAttribute(f,r[f]);o||(p.parentNode.insertBefore(i,p),h(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("pointerevents",function(){var e=document.createElement("x"),t=document.documentElement,n=window.getComputedStyle,r;return"pointerEvents"in e.style?(e.style.pointerEvents="auto",e.style.pointerEvents="x",t.appendChild(e),r=n&&n(e,"").pointerEvents==="auto",t.removeChild(e),!!r):!1})}catch(e){}define("modernizr",function(){}),function(e,t,n){function f(e,t,n){var r=[];for(var i=0;i<e.length;i++){var s=tinycolor(e[i]),u=s.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";u+=tinycolor.equals(t,e[i])?" sp-thumb-active":"";var a=o?"background-color:"+s.toRgbString():"filter:"+s.toFilter();r.push('<span title="'+s.toRgbString()+'" data-color="'+s.toRgbString()+'" class="'+u+'"><span class="sp-thumb-inner" style="'+a+';" /></span>')}return"<div class='sp-cf "+n+"'>"+r.join("")+"</div>"}function l(){for(var e=0;e<i.length;e++)i[e]&&i[e].hide()}function c(e,n){var i=t.extend({},r,e);return i.callbacks={move:m(i.move,n),change:m(i.change,n),show:m(i.show,n),hide:m(i.hide,n),beforeShow:m(i.beforeShow,n)},i}function h(r,h){function gt(){d.showPaletteOnly&&(d.showPalette=!0),J.toggleClass("sp-flat",m),J.toggleClass("sp-input-disabled",!d.showInput),J.toggleClass("sp-alpha-enabled",d.showAlpha),J.toggleClass("sp-buttons-disabled",!d.showButtons),J.toggleClass("sp-palette-disabled",!d.showPalette),J.toggleClass("sp-palette-only",d.showPaletteOnly),J.toggleClass("sp-initial-disabled",!d.showInitial),J.addClass(d.className),jt()}function yt(){function o(e){return e.data&&e.data.ignore?(Ot(t(this).data("color")),Dt()):(Ot(t(this).data("color")),Bt(!0),Dt(),Lt()),!1}s&&J.find("*:not(input)").attr("unselectable","on"),gt(),at&&X.after(ft).hide();if(m)X.after(J).hide();else{var n=d.appendTo==="parent"?X.parent():t(d.appendTo);n.length!==1&&(n=t("body")),n.append(J)}if(w&&e.localStorage){try{var r=e.localStorage[w].split(",#");r.length>1&&(delete e.localStorage[w],t.each(r,function(e,t){bt(t)}))}catch(i){}try{I=e.localStorage[w].split(";")}catch(i){}}lt.bind("click.spectrum touchstart.spectrum",function(e){V||Ct(),e.stopPropagation(),t(e.target).is("input")||e.preventDefault()}),(X.is(":disabled")||d.disabled===!0)&&Rt(),J.click(v),nt.change(Nt),nt.bind("paste",function(){setTimeout(Nt,1)}),nt.keydown(function(e){e.keyCode==13&&Nt()}),st.text(d.cancelText),st.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Lt("cancel")}),ot.text(d.chooseText),ot.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),_t()&&(Bt(!0),Lt())}),g(et,function(e,t,n){B=e/O,n.shiftKey&&(B=Math.round(B*10)/10),Dt()}),g(G,function(e,t){D=parseFloat(t/L),Dt()},xt,Tt),g(K,function(e,t,n){if(!n.shiftKey)U=null;else if(!U){var r=P*N,i=C-H*C,s=Math.abs(e-r)>Math.abs(t-i);U=s?"x":"y"}var o=!U||U==="x",u=!U||U==="y";o&&(P=parseFloat(e/N)),u&&(H=parseFloat((C-t)/C)),Dt()},xt,Tt),ht?(Ot(ht),Pt(),vt=dt||tinycolor(ht).format,bt(ht)):Pt(),m&&kt();var u=s?"mousedown.spectrum":"click.spectrum touchstart.spectrum";rt.delegate(".sp-thumb-el",u,o),it.delegate(".sp-thumb-el:nth-child(1)",u,{ignore:!0},o)}function bt(n){if(b){var r=tinycolor(n).toRgbString();if(t.inArray(r,I)===-1){I.push(r);while(I.length>q)I.shift()}if(w&&e.localStorage)try{e.localStorage[w]=I.join(";")}catch(i){}}}function wt(){var e=[],t=I,n={},r;if(d.showPalette){for(var i=0;i<F.length;i++)for(var s=0;s<F[i].length;s++)r=tinycolor(F[i][s]).toRgbString(),n[r]=!0;for(i=0;i<t.length;i++)r=tinycolor(t[i]).toRgbString(),n.hasOwnProperty(r)||(e.push(t[i]),n[r]=!0)}return e.reverse().slice(0,d.maxSelectionSize)}function Et(){var e=Mt(),n=t.map(F,function(t,n){return f(t,e,"sp-palette-row sp-palette-row-"+n)});I&&n.push(f(wt(),e,"sp-palette-row sp-palette-row-selection")),rt.html(n.join(""))}function St(){if(d.showInitial){var e=pt,t=Mt();it.html(f([e,t],t,"sp-palette-row-initial"))}}function xt(){(C<=0||N<=0||L<=0)&&jt(),J.addClass(R),U=null}function Tt(){J.removeClass(R)}function Nt(){var e=tinycolor(nt.val());e.ok?Ot(e):nt.addClass("sp-validation-error")}function Ct(){T?Lt():kt()}function kt(){var n=t.Event("beforeShow.spectrum");if(T){jt();return}X.trigger(n,[Mt()]);if(S.beforeShow(Mt())===!1||n.isDefaultPrevented())return;l(),T=!0,t(z).bind("click.spectrum",Lt),t(e).bind("resize.spectrum",x),ft.addClass("sp-active"),J.removeClass("sp-hidden"),d.showPalette&&Et(),jt(),Pt(),pt=Mt(),St(),S.show(pt),X.trigger("show.spectrum",[pt])}function Lt(n){if(n&&n.type=="click"&&n.button==2)return;if(!T||m)return;T=!1,t(z).unbind("click.spectrum",Lt),t(e).unbind("resize.spectrum",x),ft.removeClass("sp-active"),J.addClass("sp-hidden");var r=!tinycolor.equals(Mt(),pt);r&&(mt&&n!=="cancel"?Bt(!0):At()),S.hide(Mt()),X.trigger("hide.spectrum",[Mt()])}function At(){Ot(pt,!0)}function Ot(e,t){if(tinycolor.equals(e,Mt()))return;var n=tinycolor(e),r=n.toHsv();D=r.h%360/360,P=r.s,H=r.v,B=r.a,Pt(),n.ok&&!t&&(vt=dt||n.format)}function Mt(e){return e=e||{},tinycolor.fromRatio({h:D,s:P,v:H,a:Math.round(B*100)/100},{format:e.format||vt})}function _t(){return!nt.hasClass("sp-validation-error")}function Dt(){Pt(),S.move(Mt()),X.trigger("move.spectrum",[Mt()])}function Pt(){nt.removeClass("sp-validation-error"),Ht();var e=tinycolor.fromRatio({h:D,s:1,v:1});K.css("background-color",e.toHexString());var t=vt;B<1&&(t==="hex"||t==="hex3"||t==="hex6"||t==="name")&&(t="rgb");var n=Mt({format:t}),r=n.toHexString(),i=n.toRgbString();o||n.alpha===1?ct.css("background-color",i):(ct.css("background-color","transparent"),ct.css("filter",n.toFilter()));if(d.showAlpha){var u=n.toRgb();u.a=0;var a=tinycolor(u).toRgbString(),f="linear-gradient(left, "+a+", "+r+")";s?Z.css("filter",tinycolor(a).toFilter({gradientType:1},r)):(Z.css("background","-webkit-"+f),Z.css("background","-moz-"+f),Z.css("background","-ms-"+f),Z.css("background",f))}d.showInput&&nt.val(n.toString(t)),d.showPalette&&Et(),St()}function Ht(){var e=P,t=H,n=e*N,r=C-t*C;n=Math.max(-k,Math.min(N-k,n-k)),r=Math.max(-k,Math.min(C-k,r-k)),Q.css({top:r,left:n});var i=B*O;tt.css({left:i-M/2});var s=D*L;Y.css({top:s-_})}function Bt(e){var t=Mt();ut&&X.val(t.toString(vt));var n=!tinycolor.equals(t,pt);pt=t,bt(t),e&&n&&(S.change(t),X.trigger("change",[t]))}function jt(){N=K.width(),C=K.height(),k=Q.height(),A=G.width(),L=G.height(),_=Y.height(),O=et.width(),M=tt.width(),m||(J.css("position","absolute"),J.offset(p(J,lt))),Ht()}function Ft(){X.show(),lt.unbind("click.spectrum touchstart.spectrum"),J.remove(),ft.remove(),i[Ut.id]=null}function It(e,r){if(e===n)return t.extend({},d);if(r===n)return d[e];d[e]=r,gt()}function qt(){V=!1,X.attr("disabled",!1),lt.removeClass("sp-disabled")}function Rt(){Lt(),V=!0,X.attr("disabled",!0),lt.addClass("sp-disabled")}var d=c(h,r),m=d.flat,b=d.showSelectionPalette,w=d.localStorageKey,E=d.theme,S=d.callbacks,x=y(jt,10),T=!1,N=0,C=0,k=0,L=0,A=0,O=0,M=0,_=0,D=0,P=0,H=0,B=1,j=d.palette.slice(0),F=t.isArray(j[0])?j:[j],I=d.selectionPalette.slice(0),q=d.maxSelectionSize,R="sp-dragging",U=null,z=r.ownerDocument,W=z.body,X=t(r),V=!1,J=t(a,z).addClass(E),K=J.find(".sp-color"),Q=J.find(".sp-dragger"),G=J.find(".sp-hue"),Y=J.find(".sp-slider"),Z=J.find(".sp-alpha-inner"),et=J.find(".sp-alpha"),tt=J.find(".sp-alpha-handle"),nt=J.find(".sp-input"),rt=J.find(".sp-palette"),it=J.find(".sp-initial"),st=J.find(".sp-cancel"),ot=J.find(".sp-choose"),ut=X.is("input"),at=ut&&!m,ft=at?t(u).addClass(E).addClass(d.className):t([]),lt=at?ft:X,ct=ft.find(".sp-preview-inner"),ht=d.color||ut&&X.val(),pt=!1,dt=d.preferredFormat,vt=dt,mt=!d.showButtons||d.clickoutFiresChange;yt();var Ut={show:kt,hide:Lt,toggle:Ct,reflow:jt,option:It,enable:qt,disable:Rt,set:function(e){Ot(e),Bt()},get:Mt,destroy:Ft,container:J};return Ut.id=i.push(Ut)-1,Ut}function p(e,n){var r=0,i=e.outerWidth(),s=e.outerHeight(),o=n.outerHeight(),u=e[0].ownerDocument,a=u.documentElement,f=a.clientWidth+t(u).scrollLeft(),l=a.clientHeight+t(u).scrollTop(),c=n.offset();return c.top+=o,c.left-=Math.min(c.left,c.left+i>f&&f>i?Math.abs(c.left+i-f):0),c.top-=Math.min(c.top,c.top+s>l&&l>s?Math.abs(s+o-r):r),c}function d(){}function v(e){e.stopPropagation()}function m(e,t){var n=Array.prototype.slice,r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}function g(n,r,i,o){function d(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function v(e){if(a){if(s&&document.documentMode<9&&!e.button)return g();var t=e.originalEvent.touches,i=t?t[0].pageX:e.pageX,o=t?t[0].pageY:e.pageY,u=Math.max(0,Math.min(i-f.left,c)),p=Math.max(0,Math.min(o-f.top,l));h&&d(e),r.apply(n,[u,p,e])}}function m(e){var r=e.which?e.which==3:e.button==2,s=e.originalEvent.touches;!r&&!a&&i.apply(n,arguments)!==!1&&(a=!0,l=t(n).height(),c=t(n).width(),f=t(n).offset(),t(u).bind(p),t(u.body).addClass("sp-dragging"),h||v(e),d(e))}function g(){a&&(t(u).unbind(p),t(u.body).removeClass("sp-dragging"),o.apply(n,arguments)),a=!1}r=r||function(){},i=i||function(){},o=o||function(){};var u=n.ownerDocument||document,a=!1,f={},l=0,c=0,h="ontouchstart"in e,p={};p.selectstart=d,p.dragstart=d,p["touchmove mousemove"]=v,p["touchend mouseup"]=g,t(n).bind("touchstart mousedown",m)}function y(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}}function b(){e.console&&(Function.prototype.bind?b=Function.prototype.bind.call(console.log,console):b=function(){Function.prototype.apply.call(console.log,console,arguments)},b.apply(this,arguments))}var r={beforeShow:d,move:d,change:d,show:d,hide:d,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},i=[],s=!!/msie/i.exec(e.navigator.userAgent),o=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),n=t.style;return n.cssText="background-color:rgba(0,0,0,.5)",e(n.backgroundColor,"rgba")||e(n.backgroundColor,"hsla")}(),u=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),a=function(){var e="";if(s)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),w="spectrum.id";t.fn.spectrum=function(e,n){if(typeof e=="string"){var r=this,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=i[t(this).data(w)];if(n){var o=n[e];if(!o)throw new Error("Spectrum: no such method: '"+e+"'");e=="get"?r=n.get():e=="container"?r=n.container:e=="option"?r=n.option.apply(n,s):e=="destroy"?(n.destroy(),t(this).removeData(w)):o.apply(n,s)}}),r}return this.spectrum("destroy").each(function(){var n=h(this,e);t(this).data(w,n.id)})},t.fn.spectrum.load=!0,t.fn.spectrum.loadOpts={},t.fn.spectrum.draggable=g,t.fn.spectrum.defaults=r,t.spectrum={},t.spectrum.localization={},t.spectrum.palettes={},t.fn.spectrum.processNativeColorInputs=function(){var e=t("<input type='color' value='!' />")[0],n=e.type==="color"&&e.value!="!";n||t("input[type=color]").spectrum({preferredFormat:"hex6"})},function(e){function f(e,t){e=e?e:"",t=t||{};if(typeof e=="object"&&e.hasOwnProperty("_tc_id"))return e;var n=l(e),i=n.r,o=n.g,u=n.b,a=n.a,c=s(100*a)/100,p=t.format||n.format;return i<1&&(i=s(i)),o<1&&(o=s(o)),u<1&&(u=s(u)),{ok:n.ok,format:p,_tc_id:r++,alpha:a,toHsv:function(){var e=d(i,o,u);return{h:e.h*360,s:e.s,v:e.v,a:a}},toHsvString:function(){var e=d(i,o,u),t=s(e.h*360),n=s(e.s*100),r=s(e.v*100);return a==1?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+c+")"},toHsl:function(){var e=h(i,o,u);return{h:e.h*360,s:e.s,l:e.l,a:a}},toHslString:function(){var e=h(i,o,u),t=s(e.h*360),n=s(e.s*100),r=s(e.l*100);return a==1?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+c+")"},toHex:function(e){return m(i,o,u,e)},toHexString:function(e){return"#"+m(i,o,u,e)},toRgb:function(){return{r:s(i),g:s(o),b:s(u),a:a}},toRgbString:function(){return a==1?"rgb("+s(i)+", "+s(o)+", "+s(u)+")":"rgba("+s(i)+", "+s(o)+", "+s(u)+", "+c+")"},toPercentageRgb:function(){return{r:s(w(i,255)*100)+"%",g:s(w(o,255)*100)+"%",b:s(w(u,255)*100)+"%",a:a}},toPercentageRgbString:function(){return a==1?"rgb("+s(w(i,255)*100)+"%, "+s(w(o,255)*100)+"%, "+s(w(u,255)*100)+"%)":"rgba("+s(w(i,255)*100)+"%, "+s(w(o,255)*100)+"%, "+s(w(u,255)*100)+"%, "+c+")"},toName:function(){return y[m(i,o,u,!0)]||!1},toFilter:function(e){var n=m(i,o,u),r=n,s=Math.round(parseFloat(a)*255).toString(16),l=s,c=t&&t.gradientType?"GradientType = 1, ":"";if(e){var h=f(e);r=h.toHex(),l=Math.round(parseFloat(h.alpha)*255).toString(16)}return"progid:DXImageTransform.Microsoft.gradient("+c+"startColorstr=#"+N(s)+n+",endColorstr=#"+N(l)+r+")"},toString:function(e){e=e||this.format;var t=!1;e==="rgb"&&(t=this.toRgbString()),e==="prgb"&&(t=this.toPercentageRgbString());if(e==="hex"||e==="hex6")t=this.toHexString();return e==="hex3"&&(t=this.toHexString(!0)),e==="name"&&(t=this.toName()),e==="hsl"&&(t=this.toHslString()),e==="hsv"&&(t=this.toHsvString()),t||this.toHexString()}}}function l(e){var t={r:0,g:0,b:0},n=1,r=!1,i=!1;typeof e=="string"&&(e=L(e)),typeof e=="object"&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=c(e.r,e.g,e.b),r=!0,i=String(e.r).substr(-1)==="%"?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=C(e.s),e.v=C(e.v),t=v(e.h,e.s,e.v),r=!0,i="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=C(e.s),e.l=C(e.l),t=p(e.h,e.s,e.l),r=!0,i="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=parseFloat(n);if(isNaN(n)||n<0||n>1)n=1;return{ok:r,format:e.format||i,r:o(255,u(t.r,0)),g:o(255,u(t.g,0)),b:o(255,u(t.b,0)),a:n}}function c(e,t,n){return{r:w(e,255)*255,g:w(t,255)*255,b:w(n,255)*255}}function h(e,t,n){e=w(e,255),t=w(t,255),n=w(n,255);var r=u(e,t,n),i=o(e,t,n),s,a,f=(r+i)/2;if(r==i)s=a=0;else{var l=r-i;a=f>.5?l/(2-r-i):l/(r+i);switch(r){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return{h:s,s:a,l:f}}function p(e,t,n){function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var r,i,s;e=w(e,360),t=w(t,100),n=w(n,100);if(t===0)r=i=s=n;else{var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return{r:r*255,g:i*255,b:s*255}}function d(e,t,n){e=w(e,255),t=w(t,255),n=w(n,255);var r=u(e,t,n),i=o(e,t,n),s,a,f=r,l=r-i;a=r===0?0:l/r;if(r==i)s=0;else{switch(r){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return{h:s,s:a,v:f}}function v(e,t,n){e=w(e,360)*6,t=w(t,100),n=w(n,100);var r=i.floor(e),s=e-r,o=n*(1-t),u=n*(1-s*t),a=n*(1-(1-s)*t),f=r%6,l=[n,u,o,o,a,n][f],c=[a,n,n,u,o,o][f],h=[o,o,a,n,n,u][f];return{r:l*255,g:c*255,b:h*255}}function m(e,t,n,r){var i=[N(s(e).toString(16)),N(s(t).toString(16)),N(s(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function b(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function w(e,t){x(e)&&(e="100%");var n=T(e);return e=o(t,u(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),i.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function E(e){return o(1,u(0,e))}function S(e){return parseInt(e,16)}function x(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function T(e){return typeof e=="string"&&e.indexOf("%")!=-1}function N(e){return e.length==1?"0"+e:""+e}function C(e){return e<=1&&(e=e*100+"%"),e}function L(e){e=e.replace(t,"").replace(n,"").toLowerCase();var r=!1;if(g[e])e=g[e],r=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0};var i;return(i=k.rgb.exec(e))?{r:i[1],g:i[2],b:i[3]}:(i=k.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=k.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=k.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=k.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=k.hex6.exec(e))?{r:S(i[1]),g:S(i[2]),b:S(i[3]),format:r?"name":"hex"}:(i=k.hex3.exec(e))?{r:S(i[1]+""+i[1]),g:S(i[2]+""+i[2]),b:S(i[3]+""+i[3]),format:r?"name":"hex"}:!1}var t=/^[\s,#]+/,n=/\s+$/,r=0,i=Math,s=i.round,o=i.min,u=i.max,a=i.random;f.fromRatio=function(e,t){if(typeof e=="object"){var n={};for(var r in e)e.hasOwnProperty(r)&&(r==="a"?n[r]=e[r]:n[r]=C(e[r]));e=n}return f(e,t)},f.equals=function(e,t){return!e||!t?!1:f(e).toRgbString()==f(t).toRgbString()},f.random=function(){return f.fromRatio({r:a(),g:a(),b:a()})},f.desaturate=function(e,t){var n=f(e).toHsl();return n.s-=(t||10)/100,n.s=E(n.s),f(n)},f.saturate=function(e,t){var n=f(e).toHsl();return n.s+=(t||10)/100,n.s=E(n.s),f(n)},f.greyscale=function(e){return f.desaturate(e,100)},f.lighten=function(e,t){var n=f(e).toHsl();return n.l+=(t||10)/100,n.l=E(n.l),f(n)},f.darken=function(e,t){var n=f(e).toHsl();return n.l-=(t||10)/100,n.l=E(n.l),f(n)},f.complement=function(e){var t=f(e).toHsl();return t.h=(t.h+180)%360,f(t)},f.triad=function(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+120)%360,s:t.s,l:t.l}),f({h:(n+240)%360,s:t.s,l:t.l})]},f.tetrad=function(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+90)%360,s:t.s,l:t.l}),f({h:(n+180)%360,s:t.s,l:t.l}),f({h:(n+270)%360,s:t.s,l:t.l})]},f.splitcomplement=function(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+72)%360,s:t.s,l:t.l}),f({h:(n+216)%360,s:t.s,l:t.l})]},f.analogous=function(e,t,n){t=t||6,n=n||30;var r=f(e).toHsl(),i=360/n,s=[f(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,s.push(f(r));return s},f.monochromatic=function(e,t){t=t||6;var n=f(e).toHsv(),r=n.h,i=n.s,s=n.v,o=[],u=1/t;while(t--)o.push(f({h:r,s:i,v:s})),s=(s+u)%1;return o},f.readability=function(e,t){var n=f(e).toRgb(),r=f(t).toRgb(),i=(n.r*299+n.g*587+n.b*114)/1e3,s=(r.r*299+r.g*587+r.b*114)/1e3,o=Math.max(n.r,r.r)-Math.min(n.r,r.r)+Math.max(n.g,r.g)-Math.min(n.g,r.g)+Math.max(n.b,r.b)-Math.min(n.b,r.b);return{brightness:Math.abs(i-s),color:o}},f.readable=function(e,t){var n=f.readability(e,t);return n.brightness>125&&n.color>500},f.mostReadable=function(e,t){var n=null,r=0,i=!1;for(var s=0;s<t.length;s++){var o=f.readability(e,t[s]),u=o.brightness>125&&o.color>500,a=3*(o.brightness/125)+o.color/500;if(u&&!i||u&&i&&a>r||!u&&!i&&a>r)i=u,r=a,n=f(t[s])}return n};var g=f.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},y=f.hexNames=b(g),k=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();e.tinycolor=f}(this),t(function(){t.fn.spectrum.load&&t.fn.spectrum.processNativeColorInputs()})}(window,jQuery),define("libs/spectrum",function(){}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/backbone-forms/color",["libs/backbone-forms","modernizr","libs/spectrum"],function(e){return e.editors.Color=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.events={"change  input[type=color]":"onColorChange","change  input[type=text]":"onTextChange","keyup   input[type=text]":"onTextChange","keydown input[type=text]":"onTextChange",focus:"onFocus",blur:"onBlur"},n.prototype.onColorChange=function(){return this.setPickerColor(this.$colorInput().val())},n.prototype.onTextChange=function(){return this.color=this.$textInput().val(),this.$colorInput().val(this.color),this.trigger("change",this)},n.prototype.onFocus=function(){return this.trigger("focus",this)},n.prototype.onBlur=function(){return this.trigger("blur",this)},n.prototype.render=function(){var e=this;return this.$el.html(this.$colorInput()),Modernizr.inputtypes.color||this.$colorInput().spectrum({color:this.value,move:function(t){return e.setPickerColor("#"+t.toHex())}}),this.$el.append(this.$textInput()),this.setValue(this.value),this},n.prototype.setPickerColor=function(e){return this.color=e,this.$textInput().val(this.color),this.trigger("change",this)},n.prototype.$colorInput=function(){var e;return(e=this._colorInput)!=null?e:this._colorInput=$('<input class="input-color-color" type="color"></input>')},n.prototype.$textInput=function(){var e;return(e=this._textInput)!=null?e:this._textInput=$('<input class="input-color-text" type="text"></input>')},n.prototype.getValue=function(){return this.color},n.prototype.setValue=function(e){return this.color=e,this.$colorInput().val(this.color),this.$textInput().val(this.color)},n.prototype.focus=function(){if(!this.hasFocus)return this.$colorInput().focus()},n.prototype.blur=function(){if(this.hasFocus)return this.$colorInput().blur()},n}(e.editors.Base)})}.call(this),function(){var e={};window.clayer=e,e.texts={drag:"drag"},e.makeCall=function(e,t,n){if(e[t])return e[t].apply(e,n)},e.setCss3=function(e,t,n,r){r=r||!1;var i=["","-ms-","-moz-","-webkit-","-o-"];for(var s=0;s<i.length;s++){var o=i[s]+t,u=(r?i[s]:"")+n;e.css(o,u)}},e.isTouch="ontouchstart"in document.documentElement,e.initBody=function(){e.isTouch?$("body").addClass("clayer-body-touch"):$("body").addClass("clayer-body-mouse")},e.Touchable=function(){return this.init.apply(this,arguments)},e.Touchable.prototype={init:function(e,t){this.$element=e,this.$document=$(e[0].ownerDocument),this.callbacks=t,this.mouseDown=$.proxy(this.mouseDown,this),this.mouseMove=$.proxy(this.mouseMove,this),this.mouseUp=$.proxy(this.mouseUp,this),this.touchStart=$.proxy(this.touchStart,this),this.touchMove=$.proxy(this.touchMove,this),this.touchEnd=$.proxy(this.touchEnd,this),this.hoverMove=$.proxy(this.hoverMove,this),this.hoverLeave=$.proxy(this.hoverLeave,this),this.documentEvents={mousemove:this.mouseMove,mouseup:this.mouseUp,touchmove:this.touchMove,touchend:this.touchEnd,touchcancel:this.touchEnd},this.setTouchable(!1),this.setHoverable(!1)},remove:function(){this.setTouchable(!1),this.setHoverable(!1)},setTouchable:function(e){if(this.isTouchable===e)return;this.isTouchable=e,this.touchEvent=null,e?this.$element.on({mousedown:this.mouseDown,touchstart:this.touchStart}):(this.$element.off("mousedown touchstart"),this.$document.off(this.documentEvents))},setHoverable:function(e){if(this.isHoverable===e)return;this.isHoverable=e,this.hoverEvent=null,e?this.$element.on({mousemove:this.hoverMove,mouseleave:this.hoverLeave}):this.$element.off({mousemove:this.hoverMove,mouseleave:this.hoverLeave})},mouseDown:function(t){return this.isTouchable&&(this.$document.on({mousemove:this.mouseMove,mouseup:this.mouseUp}),this.touchEvent=new e.PositionEvent(this.$element,t,t.timeStamp,!0),e.makeCall(this.callbacks,"touchDown",[this.touchEvent])),!1},mouseMove:function(t){return this.isTouchable&&this.touchEvent&&(this.touchEvent.move(t,t.timeStamp),e.makeCall(this.callbacks,"touchMove",[this.touchEvent])),!1},mouseUp:function(t){return this.isTouchable&&this.touchEvent&&(this.touchEvent.up(t,t.timeStamp),e.makeCall(this.callbacks,"touchUp",[this.touchEvent]),this.touchEvent=null),this.$document.off(this.documentEvents),!1},touchStart:function(t){return this.$element.off({mousedown:this.mouseDown,mousemove:this.hoverMove,mouseleave:this.hoverLeave}),!this.isTouchable||this.touchEvent||t.originalEvent.targetTouches.length>1?this.touchEnd(t):(this.$document.on({touchmove:this.touchMove,touchend:this.touchEnd,touchcancel:this.touchEnd}),this.touchEvent=new e.PositionEvent(this.$element,t.originalEvent.targetTouches[0],t.timeStamp,!1),e.makeCall(this.callbacks,"touchDown",[this.touchEvent])),!1},touchMove:function(t){if(this.isTouchable&&this.touchEvent){var n=this.findTouchEvent(t.originalEvent.touches);n===null?this.touchEnd(t):(this.touchEvent.move(n,t.timeStamp),e.makeCall(this.callbacks,"touchMove",[this.touchEvent]))}return!1},touchEnd:function(t){return this.isTouchable&&this.touchEvent&&(this.touchEvent.up(this.findTouchEvent(t.originalEvent.touches),t.timeStamp),e.makeCall(this.callbacks,"touchUp",[this.touchEvent]),this.touchEvent=null),this.$document.off(this.documentEvents),!1},hoverMove:function(t){return this.touchEvent?this.mouseMove(t):this.isHoverable&&(this.hoverEvent?this.hoverEvent.move(t,t.timeStamp):this.hoverEvent=new e.PositionEvent(this.$element,t,!0),e.makeCall(this.callbacks,"hoverMove",[this.hoverEvent])),!1},hoverLeave:function(t){return this.isHoverable&&this.hoverEvent&&(this.hoverEvent.move(t),e.makeCall(this.callbacks,"hoverLeave",[this.hoverEvent]),this.hoverEvent=null),!1},findTouchEvent:function(e){for(var t=0;t<e.length;t++)if(e[t].identifier===this.touchEvent.event.identifier)return e[t];return null}},e.PositionEvent=function(){return this.init.apply(this,arguments)},e.PositionEvent.prototype={init:function(e,t,n,r){this.$element=e,this.globalPoint={x:t.pageX,y:t.pageY},this.translation={x:0,y:0},this.deltaTranslation={x:0,y:0},this.localPoint={x:0,y:0},this.updateLocalPoint(),this.event=t,this.startTimestamp=this.timestamp=n,this.hasMoved=!1,this.wasTap=!1,this.mouse=r},getTimeSinceGoingDown:function(){return this.timestamp-this.startTimestamp},resetDeltaTranslation:function(){this.deltaTranslation.x=0,this.deltaTranslation.y=0},inElement:function(){return this.localPoint.x>=0&&this.localPoint.x<=this.$element.outerWidth()&&this.localPoint.y>=0&&this.localPoint.y<=this.$element.outerHeight()},move:function(e,t){this.event=e,this.timestamp=t,this.updatePositions()},up:function(e,t){this.event=e||this.event,this.timestamp=t,this.wasTap=!this.hasMoved&&this.getTimeSinceGoingDown()<300},updatePositions:function(){var e=this.event.pageX-this.globalPoint.x,t=this.event.pageY-this.globalPoint.y;this.translation.x+=e,this.translation.y+=t,this.deltaTranslation.x+=e,this.deltaTranslation.y+=t,this.globalPoint.x=this.event.pageX,this.globalPoint.y=this.event.pageY,this.updateLocalPoint(),this.translation.x*this.translation.x+this.translation.y*this.translation.y>200&&(this.hasMoved=!0)},updateLocalPoint:function(){var e=this.$element.offset();this.localPoint.x=this.globalPoint.x-e.left,this.localPoint.y=this.globalPoint.y-e.top}},e.Scrubbable=function(){return this.init.apply(this,arguments)},e.Scrubbable.prototype={init:function(t,n,r){this.$element=t,this.callbacks=n,this.options=r||{},this.touchable=new e.Touchable(t,this),this.setScrubbable(!0)},remove:function(){this.touchable.remove()},setScrubbable:function(e){this.touchable.setTouchable(e),this.options.disableHover?this.touchable.setHoverable(!1):this.touchable.setHoverable(e)},hoverMove:function(t){e.makeCall(this.callbacks,"scrubMove",[t.localPoint.x,t.localPoint.y,!1])},hoverLeave:function(t){e.makeCall(this.callbacks,"scrubLeave",[])},touchDown:function(e){this.touchMove(e)},touchMove:function(t){e.makeCall(this.callbacks,"scrubMove",[t.localPoint.x,t.localPoint.y,!0])},touchUp:function(t){!t.mouse||!t.inElement()?e.makeCall(this.callbacks,"scrubLeave",[]):this.hoverMove(t),t.wasTap&&e.makeCall(this.callbacks,"scrubTap",[t.localPoint.x,t.localPoint.y])}},e.Slider=function(){return this.init.apply(this,arguments)},e.Slider.prototype={init:function(t,n,r,i){this.$element=t,this.$element.addClass("clayer-slider"),this.callbacks=n,this.valueWidth=r||1,this.markerValue=0,this.knobValue=0,this.$container=$('<div class="clayer-slider-container"></div>'),this.$element.append(this.$container),this.$bar=$('<div class="clayer-slider-bar"></div>'),this.$container.append(this.$bar),this.$segmentContainer=$('<div class="clayer-slider-segment-container"></div>'),this.$bar.append(this.$segmentContainer),this.$marker=$('<div class="clayer-slider-marker"></div>'),this.markerWidth=Math.min(this.valueWidth,10),this.$marker.width(this.markerWidth),this.$bar.append(this.$marker),this.$knob=$('<div class="clayer-slider-knob"></div>'),this.$container.append(this.$knob),this.scrubbable=new e.Scrubbable(this.$element,this,i),this.bounceTimer=null,this.renderKnob(),this.renderMarker()},remove:function(){this.scrubbable.remove(),this.$segmentContainer.remove(),this.$marker.remove(),this.$knob.remove(),this.$bar.remove(),this.$container.remove()},setSegments:function(e){this.$segmentContainer.html("");for(var t=0;t<e.length;t++){var n=e[t],r=$('<div class="clayer-slider-segment"></div>');this.$segmentContainer.append(r),r.css("left",n.start*this.valueWidth),r.width((n.end-n.start+1)*this.valueWidth),r.css("background-color",n.color)}},setValue:function(e){this.markerValue=this.knobValue=e,this.renderKnob(),this.renderMarker()},setKnobValue:function(e){this.knobValue=e,this.renderKnob()},changed:function(t){e.makeCall(this.callbacks,"sliderChanged",[this.knobValue,t])},updateKnob:function(e){e=Math.max(0,Math.min(this.$element.width()-1,e)),this.updateKnobValue(Math.floor(e/this.valueWidth))},updateKnobValue:function(e){this.knobValue!==e&&(this.knobValue=e,this.renderKnob(),this.changed(!1))},updateMarker:function(e){e=Math.max(0,Math.min(this.$element.width()-1,e));var t=Math.floor(e/this.valueWidth);this.markerValue!==t&&(this.knobValue=this.markerValue=t,this.renderKnob(),this.renderMarker(),this.changed(!0))},renderKnob:function(){this.$knob.css("left",(this.knobValue+.5)*this.valueWidth)},renderMarker:function(){this.$marker.css("left",(this.markerValue+.5)*this.valueWidth-this.markerWidth/2)},scrubMove:function(e,t,n){this.$knob.addClass("clayer-active"),n?(this.$knob.addClass("clayer-pressed"),this.updateMarker(e)):(this.$knob.removeClass("clayer-pressed"),this.updateKnob(e))},scrubLeave:function(){this.$knob.removeClass("clayer-active clayer-pressed"),this.updateKnobValue(this.markerValue),e.makeCall(this.callbacks,"sliderLeave")},scrubTap:function(){this.$knob.removeClass("clayer-slider-knob-jump"),setTimeout($.proxy(this.startJump,this),0)},startJump:function(){this.$knob.addClass("clayer-slider-knob-jump")}},e.Draggable=function(){return this.init.apply(this,arguments)},e.Draggable.prototype={init:function(t,n,r){this.$element=t,this.callbacks=n,this.$parent=r,this.touchable=new e.Touchable(t,this),this.setDraggable(!0)},remove:function(){this.touchable.remove()},setDraggable:function(e){this.touchable.setTouchable(e),this.touchable.setHoverable(!1)},touchDown:function(t){this.offsetX=t.localPoint.x+parseInt(this.$element.css("margin-left"),10),this.offsetY=t.localPoint.y+parseInt(this.$element.css("margin-top"),10),e.makeCall(this.callbacks,"dragStart",[this.offsetX,this.offsetY])},touchMove:function(t){var n=t.globalPoint.x-this.offsetX,r=t.globalPoint.y-this.offsetY;if(this.$parent!==undefined){var i=this.$parent.offset();n=Math.max(0,Math.min(this.$parent.outerWidth(),n-i.left)),r=Math.max(0,Math.min(this.$parent.outerHeight(),r-i.top)),this.$element.css("left",n),this.$element.css("top",r),e.makeCall(this.callbacks,"dragMove",[n,r,t.globalPoint.x,t.globalPoint.y])}else e.makeCall(this.callbacks,"dragMove",[n,r,t.globalPoint.x,t.globalPoint.y])},touchUp:function(t){e.makeCall(this.callbacks,"dragEnd"),t.wasTap&&e.makeCall(this.callbacks,"dragTap",[t.localPoint.x,t.localPoint.y])}},e.DragKnob=function(){return this.init.apply(this,arguments)},e.DragKnob.prototype={init:function(t,n,r){this.$element=t,this.$element.addClass("clayer-dragknob"),this.$element.append('<div class="clayer-dragknob-label">'+e.texts.drag+"</div>"),this.$parent=r,this.$parent!==undefined&&this.$parent.addClass("clayer-dragknob-parent"),this.callbacks=n,this.draggable=new e.Draggable(t,this,r)},remove:function(){this.draggable.remove(),this.$element.removeClass("clayer-dragknob"),this.$parent!==undefined&&this.$parent.addClass("clayer-dragknob-parent")},dragStart:function(){this.$element.addClass("clayer-pressed"),this.$element.removeClass("clayer-dragknob-show-label"),e.makeCall(this.callbacks,"dragStart")},dragMove:function(t,n){e.makeCall(this.callbacks,"dragMove",arguments)},dragEnd:function(){this.$element.removeClass("clayer-pressed"),e.makeCall(this.callbacks,"dragEnd")},dragTap:function(){this.$element.addClass("clayer-dragknob-show-label"),e.makeCall(this.callbacks,"dragTap")}}}(),define("clayer",function(e){return function(){var t,n;return t||e.clayer}}(this)),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/backbone-forms/range",["cdn.jquery","libs/backbone-forms","clayer"],function(e,n,r){return n.editors.Range=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.width=210,i.prototype.initialize=function(e){return i.__super__.initialize.call(this,e),this.min=this.schema.min||0,this.max=this.schema.max||100,this.step=this.schema.step||1},i.prototype.render=function(){var t;return this.$el.width(this.width),t=(this.max-this.min)/this.step+1,this.slider=new r.Slider(this.$el,this,this.width/t,{disableHover:!0}),this.$knob=e('<div class="clayer-slider-knob-value"></div>'),this.$(".clayer-slider-knob").append(this.$knob),this.setValue(this.value||0),this},i.prototype.sliderChanged=function(e){var t,n;return t=this._decimalPlaces(),n=Number((e*this.step+this.min).toFixed(t)),this.sliderValue=this._clamp(n),this.updateKnob(),this.trigger("change",this)},i.prototype._decimalPlaces=function(){var e;return e=(""+this.step).split(".")[1]||"",e.length},i.prototype._clamp=function(e){return Math.min(this.max,Math.max(this.min,e))},i.prototype.getValue=function(){return this.sliderValue},i.prototype.setValue=function(e){return this.sliderValue=e,this.slider.setValue((e-this.min)/this.step),this.updateKnob()},i.prototype.updateKnob=function(){return this.$knob.text(this.sliderValue)},i.prototype.focus=function(){this.hasFocus},i.prototype.blur=function(){!this.hasFocus},i}(n.editors.Base)})}.call(this),function(e){e.autocomplete=function(t,n,r){var i={url:!1,apply:function(e){o.val(e)}},s=this;s.settings={};var o=e(t),t=t;s.init=function(){s.settings=e.extend({},i,r),s.input=o,s.ignore=[],s.data={},s.open=!1,s.load(),s.blocker=e('<div class="autocomplete-blocker"></div>').css({position:"fixed",top:0,left:0,right:0,bottom:0,"z-index":1999}).hide(),s.box=e('<div class="autocomplete"></div>').css("z-index",2e3),s.tooltip=e('<div class="versal-tooltip versal-tooltip-white versal-tooltip-top versal-tooltip-align-left versal-tooltip-offset"><div class="versal-tooltip-arrow"></div></div>'),s.box.append(s.tooltip),s.ul=e("<ul></ul>"),s.tooltip.hide(),s.blocker.click(function(e){s.kill(),s.input.focus(),e.stopPropagation()}),o.keyup(function(t){s.pos=s.selection();switch(t.keyCode){case 13:s.apply();case 27:s.kill();case 38:case 40:return!1;case 39:var n=s.value();n.length>0&&s.pos==s.input.val().length&&s.apply();break;case 188:s.apply();default:s.complete(e(this).val())}}),o.keydown(function(e){s.pos=s.selection();switch(e.keyCode){case 9:return s.value().length>0?(s.apply(),!1):!0;case 38:return s.prev(),!1;case 40:return s.next(),!1}}),s.box.click(function(e){e.stopPropagation()}),e("body").append(s.box),e("body").append(s.blocker),e(window).resize(s.position),s.position()},s.load=function(){typeof n=="object"?s.data=n:e.getJSON(n,function(e){s.data=e})},s.complete=function(t){s.kill(),s.position();var n=0,t=e.trim(t);if(t.length==0)return!1;var r=new RegExp("^"+t,"i"),i=s.data.filter(function(e){if(s.ignore.indexOf(e)==-1&&e.match(r))return e});i=i.slice(0,5),e.each(i,function(r,i){var o='<span class="autocomplete-highlight">'+i.substring(0,t.length)+"</span>"+i.substring(t.length),u=e("<li>"+o+"</li>");u.click(function(){s.apply(i)}),u.mouseover(function(){s.ul.find(".selected").removeClass("selected"),u.addClass("over")}),u.mouseout(function(){u.removeClass("over")}),s.ul.append(u),n==0&&u.addClass("first selected"),n++}),n>0&&(s.tooltip.append(s.ul),s.tooltip.show(),s.blocker.show(),s.open=!0)},s.kill=function(){s.blocker.hide(),s.ul.empty(),s.tooltip.hide(),s.open=!1},s.apply=function(e){if(!e)var e=s.value();s.settings.apply.call(s,e)},s.value=function(){return s.selected().text()},s.selected=function(){return s.ul.find(".selected")},s.select=function(e){s.deselect(),e.addClass("selected")},s.deselect=function(){s.selected().removeClass("selected")},s.prev=function(){var e=s.selected(),t=e.prev();t.length>0&&s.select(t)},s.next=function(){var e=s.selected(),t=e.length>0?e.next():s.ul.find("li:first-child");t.length>0&&s.select(t)},s.selection=function(){var e=s.input[0],t=s.val;if(!e.createTextRange)return e.selectionStart;var n=document.selection.createRange().duplicate();return n.moveEnd("character",t.length),n.text==""?t.length:t.lastIndexOf(n.text)},s.position=function(){var e=o.offset(),t=o.innerHeight();e.top=e.top+t,s.box.css(e)},s.init()},e.fn.autocomplete=function(t,n){return this.each(function(){if(undefined==e(this).data("autocomplete")){var r=new e.autocomplete(this,t,n);e(this).data("autocomplete",r)}})}}(jQuery),function(e){e.tagbox=function(t,n){var r={url:!1,autocomplete:{},lowercase:!0,classname:"tagbox",separator:", ",duplicates:!1,minLength:1,maxLength:140,keydown:function(){},onAdd:function(){},onRemove:function(){},onDuplicate:function(){return i.input.focus()},onInvalid:function(){return i.input.focus()},onReady:function(){}},i=this,s=null;i.settings={};var o=e(t),t=t;i.init=function(){i.settings=e.extend({},r,n);var t=o.attr("name"),s=o.attr("id"),u=o.val();i.index=[],i.val="",i.focused=!1,i.origin=o.addClass("tagboxified").hide(),i.box=e('<div class="'+i.settings.classname+'"><ul><li class="new"><input autocomplete="off" tabindex="0" type="text" /></li></ul></div>'),i.input=i.box.find("input").css("width",20),i.bhits=0,i.lhits=0;if(i.settings.url){var a={apply:function(e){i.add(e),this.kill(),i.input.focus()}};i.input.autocomplete(i.settings.url,e.extend({},a,i.settings.autocomplete)),i.autocomplete=i.input.data("autocomplete"),i.settings.onAdd=function(e){i.autocomplete.ignore=i.serialize()},i.settings.onRemove=function(e){i.autocomplete.ignore=i.serialize()}}i.origin.before(i.box),i.measure=e('<div style="display: inline" />').css({"font-size":i.input.css("font-size"),"font-family":i.input.css("font-family"),visibility:"hidden",position:"absolute",top:-1e4,left:-1e4}),e("body").append(i.measure),i.box.click(function(e){i.focus(),i.input.focus(),e.stopPropagation()}),i.input.keydown(function(e){i.val=i.input.val(),i.position=i.selection(),i.settings.keydown.call(i,e,i.val)}),i.input.keyup(function(e){i.val=i.input.val(),i.position=i.selection(),i.resize(i.val),i.val.match(new RegExp(i.settings.separator))&&i.add(i.val)}),i.input.focus(function(e){i.input.focused=!0,i.deselect(),i.bhits=0,i.focus()}),i.input.blur(function(e){i.input.focused=!1,i.bhits=0,i.val.length==0&&i.blur()}),i.settings.onReady.call(this),e(document).keydown(function(e){if(!i.focused)return!0;switch(e.keyCode){case 8:if(!i.input.focused)return i.remove(),!1;if(i.val.length==0)return i.next(),!1;if(i.position==0){if(i.bhits>0)return i.bhits=0,i.next(),!1;i.bhits++}break;case 37:if(!i.input.focused)return i.previous();if(i.val.length==0)return i.next(),!1;if(i.position==0){if(i.lhits>0)return i.lhits=0,i.next(),!1;i.lhits++}break;case 39:if(!i.input.focused)return i.next(),!1;break;case 9:if(i.input.focused&&i.val.length>i.settings.minLength)return i.add(i.val),!1;if(i.selected().length>0)return i.deselect(),i.input.focus(),!1;break;case 13:case 188:if(i.input.focused)return i.settings.autocomplete||i.add(i.val),!1}}).click(function(e){i.val.length>0&&i.add(i.val)}),u.length>0&&i.add(u)},i.resize=function(e){i.measure.text(e),i.input.css("width",i.measure.width()+20)},i.focus=function(t){if(i.focused)return!0;e(".tagboxified").not(i.origin).each(function(){e(this).data("tagbox")&&e(this).data("tagbox").blur()}),i.box.addClass("focus"),i.focused=!0;if(t==undefined)var t=!0;t!==!1&&i.input.focus()},i.blur=function(){if(!i.focused)return!0;i.box.removeClass("focus"),i.focused=!1,i.input.blur(),i.deselect()},i.tag=function(t){return t=t.replace(/,/g,"").replace(/;/g,""),i.settings.lowercase&&(t=t.toLowerCase()),e.trim(t)},i.serialize=function(){return i.index},i.string=function(){return i.serialize().toString()},i.add=function(t){i.input.val("");if(!t&&i.val.length>0)return i.add(i.val);if(!t)return!0;if(e.isArray(t)||t.match(new RegExp(i.settings.separator))){var n=e.isArray(t)?t:t.split(i.settings.separator);return e.each(n,function(e,t){i.add(t)}),!0}var t=i.tag(t);if(t.length<i.settings.minLength||t.length>i.settings.maxLength)return i.settings.onInvalid.call(i,t,length);if(i.settings.duplicates==0&&e.inArray(t,i.index)>-1)return i.settings.onDuplicate.call(i,t);i.index.push(t);var r=e('<li><span class="tag"></span><span class="delete">&#215;</span></li>').data("tag",t);r.find(".tag").text(t),r.find(".delete").click(function(){i.remove(r)}),r.click(function(e){i.blur(),e.stopPropagation(),i.select(r)}),r.focus(function(e){i.select(r)}),i.input.parent().before(r),i.input.val(""),i.input.css("width",20);var s=i.serialize();i.origin.val(s.join(i.settings.separator)),i.settings.onAdd.call(i,t,s,r)},i.select=function(e){if(typeof e=="string"){var e=i.find(e);if(!e)return!1}if(e.length==0)return!1;i.input.blur(),this.deselect(),e.addClass("selected"),i.focus(!1)},i.selected=function(){return i.box.find(".selected")},i.deselect=function(){var e=i.selected();e.removeClass("selected")},i.find=function(t){var n=!1;return i.box.find("li").not(".new").each(function(){e(this).data("tag")==t&&(n=e(this))}),n},i.remove=function(e){i.input.val("");if(typeof e=="string"){var e=i.find(e);if(!e)return!1}var t=i.selected();if(!e&&t.length>0)var e=t.first();var n=i.previous(!0);n.length==0?i.next():i.select(n);var r=e.find(".tag").text();i.removeFromIndex(r),e.remove();var s=i.serialize();i.origin.val(s),i.settings.onRemove.call(i,r,s,e)},i.removeFromIndex=function(e){var t=i.index.indexOf(e);i.index.splice(t,1)},i.selection=function(){var e=i.input[0],t=i.val;if(!e.createTextRange)return e.selectionStart;var n=document.selection.createRange().duplicate();return n.moveEnd("character",t.length),n.text==""?t.length:t.lastIndexOf(n.text)},i.previous=function(e){var t=i.selected(),n=t.length==0?i.box.find("li").not(".new").first():t.prev().not(".new");return e?n:i.select(n)},i.next=function(e){var t=i.selected(),n=t.length==0?i.box.find("li").not(".new").last():t.next();return e?n:n.hasClass("new")?i.input.focus():i.select(n)},i.init()},e.fn.tagbox=function(t){return this.each(function(){if(undefined==e(this).data("tagbox")){var n=new e.tagbox(this,t);e(this).data("tagbox",n)}})}}(jQuery),define("tags",function(){}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/backbone-forms/tags",["cdn.lodash","libs/backbone-forms","tags"],function(e,n,r){return n.editors.Tags=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.width=210,r.prototype.tagName="input",r.prototype.initialize=function(e){return r.__super__.initialize.call(this,e),this.tagboxValue=this.value||[]},r.prototype.render=function(){var t=this;return e.defer(function(){return t.renderTagbox()}),this},r.prototype.renderTagbox=function(){var e,t,n,r,i,s,o,u=this;return this.tagboxOptions=(n=this.schema.options)!=null?n:[],this.$el.tagbox({url:this.tagboxOptions,lowercase:(r=this.schema.lowercase)!=null?r:!0,duplicates:(i=this.schema.duplicates)!=null?i:!1,minLength:(s=this.schema.minLength)!=null?s:1,maxLength:(o=this.schema.maxLength)!=null?o:140}),this.tagbox=this.$el.data("tagbox"),e=this.tagbox.settings.onAdd,this.tagbox.settings.onAdd=function(){e();if(u.updating)return;return u.onChange(),u.updateTagboxOptions()},t=this.tagbox.settings.onRemove,this.tagbox.settings.onRemove=function(){t();if(u.updating)return;return u.onChange()},this.updateTagbox()},r.prototype.getValue=function(){return this.tagbox!=null&&(this.tagboxValue=this.tagbox.serialize().slice(0)),this.tagboxValue||[]},r.prototype.setValue=function(t){if(!e.isArray(t))return;if(e.isEqual(t,this.tagboxValue))return;return this.tagboxValue=t,this.updateTagbox()},r.prototype.updateTagbox=function(){var e,t,n,r;if(this.tagbox==null)return;this.updating=!0,this.clearValue(),r=this.tagboxValue;for(t=0,n=r.length;t<n;t++)e=r[t],this.tagbox.add(""+e);return this.updating=!1,this.updateTagboxOptions()},r.prototype.clearValue=function(){var e,t;t=[];while(((e=this.tagbox.serialize())!=null?e.length:void 0)>0)t.push(this.tagbox.remove(0));return t},r.prototype.onChange=function(){return this.trigger("change",this)},r.prototype.updateTagboxOptions=function(){var t,n,r,i,s;if(!this.schema.updateAutoComplete)return;i=e.difference(this.tagbox.serialize(),this.tagboxOptions),s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(this.tagboxOptions.push(t));return s},r}(n.editors.Base)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/property_sheet",["app/mediator","plugins/tracker","cdn.marionette","text!templates/property_sheet.html","libs/backbone-forms","libs/backbone-forms.bootstrap","views/backbone-forms/color","views/backbone-forms/range","views/backbone-forms/tags"],function(e,n,r,i,s){var o;return o=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),_.extend(r.prototype,n("Property Sheet")),r.prototype.template=_.template(i),r.prototype.className="properties-dialog",r.prototype.events={"change input[type=number]":"onFormChange","submit .js-form":"doNothing"},r.prototype.ui={form:".js-form",errorCount:".js-error-count",errorCountPlural:".js-error-count-plural",errorCountContainer:".js-error-count-container"},r.prototype.initialize=function(){return this.listenTo(this.options.config,"change",this.onConfigChange)},r.prototype.onConfigChange=function(e,t){return t.propertySheetChanging||this.render(),this.track("Change Config",{gadget:this.options.model.id,changed:this.options.config.changedAttributes()})},r.prototype.setErrorCount=function(e){return this.ui.errorCount.text(e),this.ui.errorCountPlural.toggle(e!==1),this.ui.errorCountContainer.toggle(e>0)},r.prototype.onRender=function(){var e;return this.form!=null&&this.stopListening(this.form),this.form=new s({data:this.options.config.toJSON(),schema:this.options.propertySheetSchema.sanitizedSchema()}),this.form.render(),e=this.form.validate(),this.setErrorCount(_.size(e)),this.listenTo(this.form,"change",this.onFormChange),this.ui.form.html(this.form.el)},r.prototype.doNothing=function(e){return e.preventDefault()},r.prototype.onFormChange=function(){return this.form.validate(),this.options.config.save(this.form.getValue(),{propertySheetChanging:!0})},r}(r.ItemView)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=[].slice;define("models/property_sheet_schema",["cdn.lodash","cdn.backbone"],function(e,r){var i;return i=function(r){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,r),i.prototype.whiteListedAttributes={Text:[],Number:[],TextArea:[],Checkbox:[],Color:[],Select:["options"],Radio:["options"],Checkboxes:["options"],Date:["yearStart","yearEnd"],DateTime:["yearStart","yearEnd","minsInterval"],Range:["min","max","step"],Tags:["options","lowercase","duplicates","minLength","maxLength","updateAutoComplete"]},i.prototype.constantSchemaTop=function(){return{conceptTags:{type:"Tags",updateAutoComplete:!0}}},i.prototype.sanitizedSchema=function(){var e,t,n,r,i;r={},i=this.attributes;for(t in i)e=i[t],r[t]==null&&(n=this.sanitizedAttributes(e),n!=null&&(r[t]=n));return r},i.prototype.sanitizedAttributes=function(t){var r;return typeof t=="string"?this.sanitizedAttributes({type:t}):typeof t!="object"?null:(r=this.whiteListedAttributes[t.type],r==null?null:e.pick.apply(e,[t,"type","title","validators"].concat(n.call(r))))},i.prototype._defaultDefinitionForValue=function(t){switch(typeof t){case"boolean":return"Checkbox";case"number":return"Number";case"string":return/^\#[a-f0-9]{6}$/i.test(t)?"Color":t.length>20?"TextArea":"Text";case"object":return e.isArray(t)&&e.every(t,function(e){var t;return(t=typeof e)==="string"||t==="number"})?{type:"Tags",options:e.uniq(t),updateAutoComplete:!0}:null;default:return null}},i}(r.Model)})}.call(this),define("text!templates/gadget_instance.html",[],function(){return'<ul class="toolbar">\n  <li class="drag js-draggable">\n    <i class="icon-reorder"></i>\n  </li>\n  <li class="edit js-edit">\n    <i class="icon-cog"></i>\n  </li>\n  <li class="delete js-trash">\n    <i class="icon-trash"></i>\n  </li>\n</ul>\n<div class="gadgetContent"></div>\n<div class="js-placeholder placeholder">Double-click to edit this gadget</div>\n<div class="js-property-dialog"></div>\n'}),define("text!templates/gadget_instance_error.html",[],function(){return'<div class=\'alert alert-error\'>\n  Something went wrong and this gadget didn\'t load properly.<br>\n  We\'re on it. Please check back in a bit.\n  <!--\n    Technical details:\n    <%- errorDescription %>\n  -->\n  <div class="error-controls">\n    <button class="js-hide">close</button>\n    <button class="action delete-button js-delete">remove</button>\n  </div>\n</div>\n'}),define("text!templates/gadget_delete_warn.html",[],function(){return'<div class="alert alert-warn js-alert-warn">\n  <div class="alert-controls">\n    <div class="alert-msg">Are you sure you want to remove this gadget?</div>\n    <button class="undo-button js-undo-delete">no</button>\n    <button class="action delete-button js-delete">yes</button>\n  </div>\n</div>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},r=[].slice;define("views/gadget_instance",["cdn.marionette","app/mediator","plugins/tracker","messages/facade","views/property_sheet","models/property_sheet_schema","text!templates/gadget_instance.html","text!templates/gadget_instance_error.html","text!templates/gadget_delete_warn.html","cdn.lodash"],function(t,i,s,o,u,a,f,l,c,h){var p;return p=function(t){function i(){return this.onFetchSuccess=e(this.onFetchSuccess,this),this.onFetchError=e(this.onFetchError,this),i.__super__.constructor.apply(this,arguments)}return n(i,t),h.extend(i.prototype,s("Gadget")),i.prototype.template=h.template(f),i.prototype.className="gadget",i.prototype.regions={propertySheetRegion:".js-property-dialog"},i.prototype.events={"click .js-draggable":"onDraggableClick","click .js-edit":"onEditClick","click .js-trash":"onTrashClick","click .js-hide":"onHideClick","click .js-delete":"onDeleteClick","click .js-undo-delete":"onUndoDelete",dblclick:"onDblClick","selectstart .js-placeholder":h.identity(!1)},i.prototype.ui={toolbar:".toolbar",gadgetContent:".gadgetContent"},i.prototype.initialize=function(e){var t,n=this;return e==null&&(e={}),this.isEditable=e.isEditable,this.listenTo(this.model,"resolve:success",this.onFetchSuccess,this),this.listenTo(this.model,"resolve:error",this.onFetchError,this),this._facade=new o({model:this.model}),this._facade.on("doneEditing",this.onFacadeDoneEditing,this),t=h.debounce(this.saveGadgetConfig,200),this._facade.on("registerPropertySheet",this.onRegisterPropertySheet,this),this._facade.on("configChange",this.onFacadeChange,this),this._facade.on("configEmpty",this.onGadgetConfigEmpty,this),this._facade.on("save",t,this),this._facade.on("cancelEditing",this.onGadgetCancelEdit,this),this.listenTo(this.model,"change",this.onPropertiesChange),this.listenTo(this.model.config,"change",this.onGadgetConfigChange,this),this.listenTo(this.model,"destroy",this.onModelDestroy),this._propertySheetSchema=new a,this.gadgetRendering=$.Deferred(),this.once("gadgetRendered",function(){return n.gadgetRendering.resolve()}),this.model.userState.on("sync",function(){return n.trigger("userStateSync")})},i.prototype.onInstanceAvailable=function(){var e;return e=this.model.gadgetProject.cssClassName(),this.ui.gadgetContent.addClass(e),this.passEvent("domReady"),this.passEvent("render"),this.trigger("gadgetRendered")},i.prototype.onTrashClick=function(){return this.toggleEdit(!1),this.showDeleteMsg()},i.prototype.onHideClick=function(){return this.$el.fadeOut(1200)},i.prototype.showDeleteMsg=function(){var e,t;if(this.deleteShowing)return;return this.deleteShowing=!0,e=this.$el.height(),t=$(c),e<100&&t.addClass("minimized"),this.$el.append(t)},i.prototype.onUndoDelete=function(){return this.deleteShowing=!1,this.$el.find(".js-alert-warn").remove()},i.prototype.onDeleteClick=function(){return this.track("Destroy",{gadget:this.model.id}),this.passEvent("domRemove"),this.model.destroy()},i.prototype.onDraggableClick=function(){},i.prototype.onEditClick=function(e){return e.stopPropagation(),this.toggleEdit()},i.prototype.onDblClick=function(e){if(!this.isEditable)return;this.trigger("dblclick");if(!this._isEditing)return this.onEditClick(e)},i.prototype.isChild=function(){return!!this.model.config.get("_hidden")},i.prototype.onPropertiesChange=function(e,t){return this.passEvent("configChange",this.model.config.toJSON())},i.prototype.onFacadeDoneEditing=function(){return this.toggleEdit(!1)},i.prototype.onFetchError=function(e){return this.showCouldNotLoad(e)},i.prototype.onFetchSuccess=function(e,t){return t==null&&(t={}),this.instantiateGadget(e,t)},i.prototype.gadgetOptions=function(){var e;return e=this._facade,e.player=this._facade,e.el=this.$(".gadgetContent")[0],e.propertySheetSchema=this._propertySheetSchema,e.config=this.model.config,e.userState=this.model.userState,e.userStates=this.model.userStates,e.model=this.model.config,e.facade=this._facade,e.properties=this.model.config,e.properties.propertySheetSchema=this._propertySheetSchema,e.$el=this.$(".gadgetContent"),e},i.prototype.instantiateGadget=function(e,t){var n,r,i,s;t==null&&(t={}),n=t.defaultConfig||{},r=t.defaultUserState||{},s=t.noToggleSwitch||!1,this.model._gadgetKlass=e,this.model.config.setDefaults(h.cloneDeep(n)),this.model.userState.setDefaults(r);try{t=this.gadgetOptions(),i=new e(t,t.config.toJSON(),t.$el),this.onInstanceAvailable();if(this.isEditable){if(s)return this.passEvent("toggleEdit",!0,{onLoad:!this.model.dropped}),this.$el.addClass("noToggleEdit").addClass("editing"),this.trigger("gadgetRendered"),this.toggleEdit=function(){};if(this.model.dropped)return this.toggleEdit(!0)}}catch(o){throw this.showCouldNotLoad("Couldn't initialize gadget"),o}},i.prototype.onRender=function(){if(this.model._gadgetKlass)return this.instantiateGadget(this.model._gadgetKlass)},i.prototype.passEvent=function(){var e,t,n;t=arguments[0],e=2<=arguments.length?r.call(arguments,1):[];if(this.model._gadgetKlass)return(n=this._facade).trigger.apply(n,[t].concat(r.call(e)))},i.prototype.showCouldNotLoad=function(e){return this.$el.html(h.template(l,{errorDescription:e})),this.trigger("gadgetRendered")},i.prototype.onRegisterPropertySheet=function(e){return this._propertySheetSchema.clear({silent:!0}),this._propertySheetSchema.set(e)},i.prototype.showPropertySheet=function(){if(this._propertySheetSchema.keys().length===0)return;return this._propertySheetView||(this._propertySheetView=new u({model:this.model,config:this.model.config,propertySheetSchema:this._propertySheetSchema}),this.propertySheetRegion.show(this._propertySheetView)),this._propertySheetView.$el.hide().show("fast")},i.prototype.hidePropertySheet=function(){if(this._propertySheetView)return this._propertySheetView.$el.hide()},i.prototype.toggleEdit=function(e){var t;t=h.isBoolean(e);if(t&&e===this._isEditing)return;return this._isEditing=t?e:!this._isEditing,this.track("Toggle Editing",{editing:this._isEditing,gadget:this.model.id}),this._isEditing?(this.trigger("edit",this),this.togglePropertySheet(!0)):(this.togglePropertySheet(!1),this.trigger("doneEditing",this)),this.$el.toggleClass("editing",this._isEditing),this.passEvent("toggleEdit",this._isEditing),this.trigger("gadgetRendered")},i.prototype.toggleEmpty=function(e){var t;t=h.isBoolean(e);if(t&&e===this._isEmpty)return;return this._isEmpty=t?e:!this._isEmpty,this._isEmpty&&(this._emptyState=this.model.config.toJSON()),this.$el.toggleClass("empty",this._isEmpty)},i.prototype.showHoverables=function(e){var t;return e==null&&(e=!0),t=$().add(this.ui.toolbar.add(this.ui.gadgetContent.add(this.$el))),t.toggleClass("blocked",!e)},i.prototype.togglePropertySheet=function(e){var t;t=h.isBoolean(e);if(t&&e===this._configVisible)return;return this._configVisible=t?e:!this._configVisible,this._configVisible?(this.toggleEdit(!0),this.showPropertySheet()):this.hidePropertySheet()},i.prototype.onFacadeChange=function(e){return this.model.config.set(e)},i.prototype.saveGadgetConfig=function(e){return e==null&&(e={}),this.model.config.save(e)},i.prototype.onGadgetConfigChange=function(){if(this._emptyState&&!h.isEqual(this.model.config.toJSON(),this._emptyState))return this.toggleEmpty(!1)},i.prototype.onGadgetCancelEdit=function(){return this.toggleEdit(!1)},i.prototype.onGadgetConfigEmpty=function(){return this.toggleEmpty(!0)},i}(t.Layout)})}.call(this),define("text!templates/inline_catalogue_item.html",[],function(){return"<img src='<%- icon %>' class='icon'>\n<div class='title'><%- title %></div>\n<div class='author'>Versal Group</div>\n<div class='version'><%- version %></div>\n"}),define("text!templates/inline_catalogue.html",[],function(){return"<h2>\n  Choose a gadget:\n  <button class='btn cancel'>cancel</button>\n</h2>\n<ul class='items'></ul>\n"}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("collections/gadget_catalogue",["plugins/vs.api"],function(){var e;return e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this._isReady=!1,this.once("sync",this.onFirstSync,this)},n.prototype.isReady=function(){return this._isReady},n.prototype.onFirstSync=function(){if(!this._isReady)return this._isReady=!0,this.trigger("ready")},n.prototype.findGadgetByType=function(e){return e==="gadget/section"&&(e="versal/header@0.2.9"),this.find(function(t){return t.type()===e||t.get("type")===e})},n.prototype.buildInstanceOfType=function(e,t){var n,r;if(!(n=this.findGadgetByType(e)))throw new Error("Unknown gadget type "+e);return r=new vs.api.GadgetInstance,r.gadgetProject=n,r.set({type:e}),r},n}(vs.api.GadgetProjects)})}.call(this),define("text!gadgets/section/template.html",[],function(){return"<div class='section-content' placeholder=\"Enter header title...\"></div>\n<div class='section-fadeout'></div>\n"}),function(){define("gadgets/section/gadget",["text!./template.html"],function(e){var t;return t=function(){function t(e){this.player=e.player,this.config=e.config,this.$el=$(e.el),this.player.on("toggleEdit",this.toggleEdit,this),this.player.on("domReady",this.render,this)}return t.prototype.className="section-header js-sticky-header",t.prototype.render=function(){var t,n=this;return this.$el.html(e),this.$el.addClass(this.className),this.text=new vs.ui.EditableText({el:this.$el.find(".section-content"),type:"input",success:function(){return n.save()}}),t=this.config.get("content"),t?this.text.setText(t):this.$el.hide()},t.prototype.toggleEdit=function(e,t){this.$el.show(),this.text.toggleEdit(e,!1);if(!t.onLoad)return this.$el.find(".section-content").focus()},t.prototype.save=function(){return this.config.save("content",this.text.getPretty())},t}()})}.call(this),define("text!gadgets/column/template.html",[],function(){return"<h2>\n  2-Column Gadget\n  <button class='btn highlightChildren'>Highlight Children</button>\n</h2>\n<div class='column first' data-col='first'>\n  <button class='btn chooseChild'>Choose a child</button>\n  <div class='payload'></div>\n</div>\n\n<div class='column second' data-col='second'>\n  <button class='btn chooseChild'>Choose a child</button>\n  <div class='payload'></div>\n</div>\n\n<div class='clearfix'></div>\n"}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("gadgets/column/gadget",["text!./template.html"],function(t){var n;return n=function(){function n(t,n,r){this.facade=t,this.properties=n,this.$el=r,this.highlightChildren=e(this.highlightChildren,this),this.addFacade=e(this.addFacade,this),this.chooseChild=e(this.chooseChild,this),this.facade.on("toggleEdit",this.onToggleEdit,this),this.facade.on("configChange",this.onConfigChange,this),this.facade.on("domReady",this.render,this),this.debouncedSave=_.debounce(this.save,1e3),this.childFacades=[]}return n.prototype.className="column-gadget",n.prototype.onToggleEdit=function(e){},n.prototype.onConfigChange=function(e){this.properties=e},n.prototype.render=function(){return this.$el.html(t),this.facade.trigger("gadget:showChild",{el:this.$el.find(".first .payload"),name:"first",success:this.addFacade}),this.facade.trigger("gadget:showChild",{el:this.$el.find(".second .payload"),name:"second",success:this.addFacade}),this.$el.find(".chooseChild").on("click",this.chooseChild),this.$el.find(".highlightChildren").on("click",this.highlightChildren)},n.prototype.chooseChild=function(e){var t,n,r;return r=$(e.currentTarget),t=r.parent().data("col"),n=r.siblings(".payload"),this.facade.trigger("gadget:pickChild",{el:n,name:t,success:this.addFacade})},n.prototype.addFacade=function(e){var t=this;if(_.contains(this.childFacades,e))return;return this.childFacades.push(e),e.on("local:highlightParent",function(){return t.$el.css({background:"lightblue"}),setTimeout(function(){return t.$el.css({background:"whitesmoke"})},500)})},n.prototype.highlightChildren=function(){return _.each(this.childFacades,function(e){return e.trigger("highlightSelf")})},n.prototype.save=function(){return this.facade.trigger("save",this.properties)},n}()})}.call(this),define("text!gadgets/lipsum/template.html",[],function(){return"  <h1>Lorem Ipsum</h1>\n  <button class='highlightParent btn'>Highlight Parent Gadget</button>\n  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quae quo sunt excelsiores, eo dant clariora indicia naturae. Non enim quaero quid verum, sed quid cuique dicendum sit. Idemne potest esse dies saepius, qui semel fuit? Aliter homines, aliter philosophos loqui putas oportere? Omnia contraria, quos etiam insanos esse vultis. Illa videamus, quae a te de amicitia dicta sunt. </p>\n\n  <p>Dempta enim aeternitate nihilo beatior Iuppiter quam Epicurus; Unum nescio, quo modo possit, si luxuriosus sit, finitas cupiditates habere. Itaque hoc frequenter dici solet a vobis, non intellegere nos, quam dicat Epicurus voluptatem. Inscite autem medicinae et gubernationis ultimum cum ultimo sapientiae comparatur. Et quidem iure fortasse, sed tamen non gravissimum est testimonium multitudinis. Urgent tamen et nihil remittunt. Huius ego nunc auctoritatem sequens idem faciam. </p>\n\n  <p>Paulum, cum regem Persem captum adduceret, eodem flumine invectio? Nec lapathi suavitatem acupenseri Galloni Laelius anteponebat, sed suavitatem ipsam neglegebat; Murenam te accusante defenderem. Negabat igitur ullam esse artem, quae ipsa a se proficisceretur; Quamquam te quidem video minime esse deterritum. Illum mallem levares, quo optimum atque humanissimum virum, Cn. </p>\n\n  <p>Duo Reges: constructio interrete. Sed potestne rerum maior esse dissensio? Illis videtur, qui illud non dubitant bonum dicere -; Nam Pyrrho, Aristo, Erillus iam diu abiecti. Ergo omni animali illud, quod appetiti positum est in eo, quod naturae est accommodatum. Sic exclusis sententiis reliquorum cum praeterea nulla esse possit, haec antiquorum valeat necesse est. Non est ista, inquam, Piso, magna dissensio. Nonne igitur tibi videntur, inquit, mala? </p>\n"}),function(){define("gadgets/lipsum/gadget",["text!./template.html"],function(e){var t;return t=function(){function t(e,t,n){this.facade=e,this.properties=t,this.$el=n,this.facade.on("domReady",this.render,this),this.facade.on("local:highlightSelf",this.highlightSelf,this)}return t.prototype.className="lipsum-gadget",t.prototype.render=function(){var t=this;return this.$el.html(e),this.$el.find(".highlightParent").on("click",function(){return t.facade.trigger("highlightParent")})},t.prototype.highlightSelf=function(){var e=this;return this.$el.css({background:"lightgreen"}),setTimeout(function(){return e.$el.css({background:"whitesmoke"})},500)},t}()})}.call(this),function(){define("plugins/backbone.prioritize",["cdn.backbone"],function(e){return e.Collection.prototype.prioritize=function(e){var t,n,r,i,s,o;s=e.reverse(),o=[];for(r=0,i=s.length;r<i;r++)n=s[r],this.remove(t=this.findWhere(n)),t?o.push(this.push(t)):o.push(void 0);return o}})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("app/catalogue",["collections/gadget_catalogue","gadgets/section/gadget","gadgets/column/gadget","gadgets/lipsum/gadget","plugins/backbone.prioritize"],function(e,n,r,i){var s,o;return o=new vs.api.GadgetProject({author:"Versal",catalog:"approved",icon:"//s3-us-west-2.amazonaws.com/net.vrsl.stack.prod.static/player2/assets/img/authorSidebar/icon_header_gadget.png",classDefinition:n,id:"section",title:"Header",username:"versal",name:"header",version:"0.2.9",noToggleSwitch:!0,noCss:!0}),s=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.fetchAll=function(t){var n,r,i=this;return t==null&&(t={}),n=new e,r=new e,$.when(n.fetchApproved(),r.fetchUnapproved()).then(function(){return n.prioritize([{title:"Header"},{title:"Text"},{title:"Image",type:"6/image@0.7.3"},{title:"Video"},{title:"Quiz"},{title:"Survey"},{title:"Expression"},{title:"Data viewer"},{title:"References"},{title:"Map"},{title:"Markdown"},{title:"Image annotator"},{title:"Image detail"},{title:"Color bar"},{title:"R0"},{title:"3D anatomy"},{title:"Cellular automaton"},{title:"Principle of superposition"}]),i.add(n.models),i.add(r.models),i.find(function(e){return e.type()==="versal/header@0.2.9"})||i.add(o),i.trigger("reset"),i.trigger("sync")})},r}(e),new s})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/inline_catalogue",["cdn.marionette","text!templates/inline_catalogue_item.html","text!templates/inline_catalogue.html","app/catalogue","app/mediator"],function(e,n,r,i,s){var o,u;return o=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.tagName="li",r.prototype.template=_.template(n),r.prototype.events={click:"select"},r.prototype.select=function(){return this.trigger("select")},r}(e.ItemView),u=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.className="inlineCatalogue",n.prototype.itemView=o,n.prototype.itemViewContainer=".items",n.prototype.initialize=function(){return this.collection=i,this.on("itemview:select",this.createInstance)},n.prototype.events=function(){return{"click .cancel":"onCancelClick"}},n.prototype.onCancelClick=function(){return this.trigger("selectCanceled")},n.prototype.createInstance=function(e){return this.trigger("selectGadget",e.model.get("type"))},n.prototype.template=function(){return _.template(r)},n}(e.CompositeView)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("plugins/vs-sticky",["cdn.lodash","cdn.jquery"],function(t,n){var r;return r=function(){function r(t,r,i){this.els=t,this.offset=r!=null?r:0,this.interval=i!=null?i:10,this.scroll=e(this.scroll,this),this.updateEls(this.els),n("<style>.vs-sticky-stuck{top:"+this.offset+"px;}</style>").appendTo("head"),this.topEl=this.els.get(0),this.scroll()}return r.prototype.setEls=function(e){return this.els=e,this.topEl=this.els.get(0)},r.prototype.updateEls=function(){return this.els.addClass("vs-sticky"),this.teardown(),this.els.each(function(){return n(this).data({start:n(this).offset().top,height:n(this).outerHeight()})}),this.scroll()},r.prototype.listen=function(){var e=this;return n(window).on("scroll",function(){return t.throttle(e.scroll,e.interval),t.throttle(e.updateEls(),1e3)})},r.prototype.stopListening=function(){return n(window).off("scroll")},r.prototype.teardown=function(){return this.els.removeClass("vs-sticky-stuck"),this.els.removeAttr("style")},r.prototype.scroll=function(){var e,t,r,i,s,o,u;e=n(window).scrollTop()+this.offset,this.teardown(),r=n(this.topEl).data("height"),o=n(this.topEl).data("start");if(o>e&&this.topEl!==this.els.get(0)){i=1;while(n(this.els[i]).data("start")<e)i++;this.topEl=this.els[i-1],this.scroll();return}n(this.topEl).parent().hasClass("wrapper")&&n(this.topEl).unwrap();if(o<=e){u=n("<div>").addClass("wrapper"),u.height(r),u.css({"margin-bottom":n(this.topEl).css("margin-bottom")}),n(this.topEl).wrap(u),n(this.topEl).addClass("vs-sticky-stuck"),s=this.els.get(1+this.els.index(this.topEl));if(!s)return;t=n(s).data("start")-e;if(t<=r){n(this.topEl).css("top",this.offset+t-r+"px");if(t<1)return this.topEl=s}}},r}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/lesson",["cdn.marionette","app/mediator","plugins/tracker","views/gadget_instance","views/inline_catalogue","app/catalogue","plugins/vs-sticky","cdn.jqueryui"],function(t,r,i,s,o,u,a){var f,l;return l=(new Date).getTime(),_.extend(vs.api.Gadget.prototype,{onResolveError:function(e){return console.error(e),this.trigger("resolve:error",e)},onResolveSuccess:function(e){return this.trigger("resolve:success",e,{defaultConfig:this.gadgetProject.get("defaultConfig"),defaultUserState:this.gadgetProject.get("defaultUserState"),noToggleSwitch:this.gadgetProject.get("noToggleSwitch")})},nocache:function(e){return""+e+"?_="+l},resolve:function(e){var t,n;return e==null&&(e={}),_.bindAll(this,"onResolveSuccess","onResolveError"),this.gadgetProject?(this.gadgetProject.css()&&(t=this.gadgetProject.cssClassName(),this.gadgetProject.has("_newCss")?r.trigger("player:style:register",{key:t,url:this.gadgetProject.css()}):r.trigger("style:register",{key:t,href:this.nocache(this.gadgetProject.css()),files:this.gadgetProject.get("files")})),(n=this.gadgetProject.get("classDefinition"))?this.onResolveSuccess(n):(require.config({baseUrl:"scripts"}),require([this.nocache(_.result(this.gadgetProject,"main"))],this.onResolveSuccess,this.onResolveError))):this.onResolveError("Gadget Project not found: "+this.get("type"))}}),f=function(t){function o(){return this.showChild=e(this.showChild,this),this.addChildGadget=e(this.addChildGadget,this),this.pickChild=e(this.pickChild,this),this.onSortStop=e(this.onSortStop,this),this.onSortStart=e(this.onSortStart,this),this.onSortReceive=e(this.onSortReceive,this),this.onSortOver=e(this.onSortOver,this),this.itemViewOptions=e(this.itemViewOptions,this),o.__super__.constructor.apply(this,arguments)}return n(o,t),_.extend(o.prototype,i("Lesson")),o.prototype.initialize=function(e){var t=this;return e==null&&(e={}),this.collection=this.model.gadgets,this.catalogue=e.catalogue||u,this.activeView=null,this.embed=e.embed,this.isEditable=e.isEditable,this.on("itemview:edit",this.onItemViewEdit,this),this.on("itemview:doneEditing",this.onItemViewDoneEditing,this),this.on("itemview:userStateSync",function(){return t.trigger("userStateSync")}),this.listenTo(this.catalogue,"ready",this.onCatalogueReady,this),$(window).click(function(e){var n;if($(".gadget.editing").length&&!$(e.target).parents(".gadget.editing, .modal").not(".noToggleEdit").length)return(n=t.activeView)!=null?n.toggleEdit(!1):void 0}),$(window).on("resize",function(){return t.fixSizing()}),r.on("gadget:pickChild",this.pickChild),r.on("gadget:showChild",this.showChild)},o.prototype.remove=function(){return r.off("gadget:pickChild",this.pickChild),r.off("gadget:showChild",this.showChild),o.__super__.remove.apply(this,arguments)},o.prototype.className="gadgets",o.prototype.itemView=s,o.prototype.itemViewOptions=function(){return{isEditable:this.isEditable}},o.prototype.insertGadgetTypeAt=function(e,t){var n;return(n=this.catalogue.buildInstanceOfType(e))?(n.dropped=!0,n.set({index:t}),this.collection.create(n,{at:t}),n.resolve(),this.fixSizing(),this.track("Add Gadget",{type:e,lesson:this.model.id}),n):console.error("Failed grabbing gadget "+e)},o.prototype.makeSortable=function(){return this.$el.sortable({handle:".js-draggable",containment:"parent",axis:"y",forceHelperSize:!0,forcePlaceholderSize:!0,tolerance:"pointer",over:this.onSortOver,receive:this.onSortReceive,start:this.onSortStart,stop:this.onSortStop,scrollSensitivity:40})},o.prototype.resolveGadgets=function(){var e=this;return this.collection.each(function(t){var n;return n=e.catalogue.findGadgetByType(t.get("type")),t.gadgetProject=n,t.resolve()})},o.prototype.onCatalogueReady=function(){return this.resolveGadgets()},o.prototype.onItemViewEdit=function(e){var t;return(t=this.activeView)!=null&&t.toggleEdit(!1),this.activeView=e,this.trigger("menuDeactivated",!1),this.children.each(function(t){if(t!==e)return t.showHoverables(!1)})},o.prototype.onItemViewDoneEditing=function(e){return this.activeView=null,this.trigger("menuDeactivated",!0),this.children.each(function(e){return e.showHoverables()})},o.prototype.onSortOver=function(e,t){return t.placeholder.animate({height:t.helper.height()})},o.prototype.onSortReceive=function(e,t){return this.insertGadgetTypeAt(t.item.data("type"),t.item.index())},o.prototype.onSortStart=function(e,t){return t.item.find(".fixed").removeClass("fixed"),t.item.data("originalPosition",t.item.index()),t.placeholder.height(t.item.height()-16),t.item.find(".toolbar").addClass("dragging")},o.prototype.onSortStop=function(e,t){var n=this;return _.defer(function(){var e,r,i;return r=t.item.data("originalPosition"),e=t.item.index(),i=n.collection.at(r),n.collection.move(i,e),t.item.find(".toolbar").removeClass("dragging"),n.stickHeaders(),n.track("Reorder Gadget",{gadget:i.id,from:r,to:e})})},o.prototype.onRender=function(){return this.makeSortable(),this.catalogue.isReady()&&this.resolveGadgets(),this.navBarHeight=$(".courseHeader").height(),this.fixSizing(),this.removeOrphans(),this.children.length===0&&r.trigger("gadget:rendered",null,!0),this.track("Render",{lesson:this.model.id})},o.prototype.removeOrphans=function(){var e,t=this;return e=[],this.model.gadgets.each(function(t){var n;if(n=t.config.get("_children"))return e=e.concat(_.values(n))}),this.model.gadgets.each(function(t){if(!t)return;if(t.config.get("_hidden")&&!_.contains(e,t.id))return t.destroy({queue:!0})})},o.prototype.fixSizing=function(){var e=this;return _.defer(function(){return e.$el.css({"min-height":$(window).height()-$(".courseHeader").height()-45})})},o.prototype.appendHtml=function(e,t,n){var r,i=this;return t.isChild()?(this.onGadgetRendered(t),!1):(r=this.$el.children(),r.size()<=n?this.$el.append(t.el):r.eq(n).before(t.el),this.fixSizing(),t.on("gadgetRendered",function(){return i.onGadgetRendered(t)}))},o.prototype.onGadgetRendered=function(e){var t;return e.rendered=!0,t=this.children.every(function(e){return e.rendered}),t&&this.stickHeaders(),r.trigger("gadget:rendered",e,t)},o.prototype.stickHeaders=function(){var e=this;return _.defer(function(){return e.sticky||(e.sticky=new a(e.$(".js-sticky-header"),e.navBarHeight),e.sticky.listen()),e.sticky.setEls(e.$(".js-sticky-header")),e.sticky.updateEls()})},o.prototype.showHoverables=function(e){return e==null&&(e=!0),this.children.each(function(t){return t.showHoverables(e)})},o.prototype.showGadget=function(e){var t,n=this;return t=this.children.findByIndex(e-1),t.gadgetRendering.done(function(){return _.defer(function(){return window.scrollTo(0,t.$el.offset().top-n.navBarHeight)})})},o.prototype.pickChild=function(e,t){var n,i,s,o,u,a,f,l=this;return n=e.el,s=e.name,f=e.success,i=e.error,a=this.collection.get(t.gadgetId),u=function(t){return t.on("selectGadget",function(t){return l.addChildGadget(a,t,e)})},o=function(){return typeof i=="function"?i("Gadget selection canceled"):void 0},r.trigger("inlineCatalogue:show",n,u,o)},o.prototype.addChildGadget=function(e,t,n){var r,i,s,o,u=this;return s=n.name,r=n.el,o=n.success,i=this.insertGadgetTypeAt(t,this.children.length),i.once("sync",function(){var t,n;return i.config.save({_hidden:!0}),n=e.config.get("_children")||{},n[s]=i.id,e.config.save({_children:n}),t=u.children.findByModel(i)._facade,typeof o=="function"?o(t):void 0}),this.renderElsewhere(i,r)},o.prototype.showChild=function(e,t){var n,r,i,s,o,u,a,f,l;return n=e.el,u=e.name,f=e.success,r=e.error,a=this.collection.get(t.gadgetId),l=a.config.get("_children")||{},o=l[u],o?(s=this.collection.get(o),s?(this.renderElsewhere(s,n),i=this.children.findByModel(s)._facade,typeof f=="function"?f(i):void 0):typeof r=="function"?r("Gadget with ID "+o+" not found"):void 0):typeof r=="function"?r("Child "+u+" not found"):void 0},o.prototype.renderElsewhere=function(e,t){var n;return n=this.children.findByModel(e),n.$el.remove(),n.$el=t,n.render()},o.prototype.isComplete=function(){return this.model.gadgets.every(function(e){var t;return e.get("type")!=="6/quiz@1.0.04"||((t=e.userState.get("results"))!=null?t.pass:void 0)===!0})},o.prototype.isEmbedded=function(){return this.embed},o}(t.CollectionView)})}.call(this),define("text!views/../../toc/./student.html",[],function(){return'<ul class="table-of-contents student">\n  <% _.each(lessons, function(lesson) { %>\n    <li data-cid="<%- lesson.cid %>" class="js-navigate-lesson <%- !lesson.isAccessible ? \'disabled-lesson\' : \'\' %>">\n      <span title="<%- lesson.title %>"><%- lesson.title %></span>\n    </li>\n  <%})%>\n</ul>\n'}),define("text!views/../../toc/./author.html",[],function(){return'<ul class="table-of-contents">\n  <% _.each(lessons, function(lesson) { %>\n    <li data-cid="<%- lesson.cid %>" class="js-navigate-lesson <%- !lesson.isAccessible ? \'disabled-lesson\' : \'\' %>">\n      <i class="js-handle handle" />\n      <input class="js-rename-lesson" value="<%- lesson.title %>" readonly="readonly" />\n      <i class="lesson-fade"></i>\n      <i class="js-destroy-lesson delete-icon"></i>\n    </li>\n  <%})%>\n</ul>\n<ul>\n<li class="js-create-lesson create-lesson">Add lesson</li>\n</ul>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/../../toc/main",["cdn.jquery","cdn.marionette","text!./student.html","text!./author.html","cdn.jqueryui","app/mediator"],function(t,r,i,s,o,u){var a,f;return f=function(e,t){return setTimeout(t,e)},a=function(r){function o(){return this.destroyLesson=e(this.destroyLesson,this),this.createLesson=e(this.createLesson,this),this.moveLesson=e(this.moveLesson,this),this.renameLesson=e(this.renameLesson,this),this.selectLesson=e(this.selectLesson,this),o.__super__.constructor.apply(this,arguments)}return n(o,r),o.prototype.template=function(){return this.model.get("isEditable")?_.template(s):_.template(i)},o.prototype.events={"click .js-create-lesson":"createLesson","click .js-destroy-lesson":"destroyLesson","dblclick .js-rename-lesson":"enableLesson","click .js-navigate-lesson":"selectLesson","change .js-rename-lesson":"renameLesson","blur .js-rename-lesson":"disableLesson","focus .js-rename-lesson":"blurLesson"},o.prototype.isEditable=function(){return this.model.get("isEditable")},o.prototype.initialize=function(e){var n,r=this;return this.model.lessons.on("change:title",this.render,this),this.model.lessons.on("add reset",this.render,this),this.model.lessons.on("remove",this.lessonRemoved,this),n=function(){return u.trigger("toc:hide")},u.on("toc:toggle",function(){var e;return e=r.$el.parent(),e.is(":visible")?u.trigger("toc:hide"):u.trigger("toc:show")}),u.on("toc:show",function(){return r.$el.parent().stop().fadeIn("fast",function(){return t(window).one("mousedown",n),t(this).on("mousedown",function(e){return e.stopPropagation()})})}),u.on("toc:hide",function(){return r.$el.parent().stop().fadeOut("fast",function(){return t(window).off("click",n)})}),u.on("blocking:changed",function(){return r.model.fetch({success:r.render})})},o.prototype.render=function(){return this.$el.html(this.template().call(this,this.serializeData())),this.$el.find("ul:first").sortable({handle:".handle",axis:"y",containment:"parent",tolerance:"pointer"}).on("sortupdate",this.moveLesson)},o.prototype.serializeData=function(){var e;return e=this.model.lessons.map(function(e){return _.extend(e.toJSON(),{cid:e.cid})}),_.extend(this.model.toJSON(),{lessons:e})},o.prototype.selectLesson=function(e){var n,r,i=this;r=t(e.currentTarget),n=this.model.lessons.get(r.data("cid"));if(!this.isEditable()&&n.get("isAccessible")===!1)return;return r.addClass("animated"),r.addClass("flash"),u.trigger("lesson:navigate",this.model.lessons.indexOf(n)+1),f(200,function(){return r.removeClass("animated"),r.removeClass("flash"),u.trigger("toc:hide")})},o.prototype.disableLesson=function(e){return e.currentTarget.setAttribute("readonly","readonly")},o.prototype.enableLesson=function(e){return e.currentTarget.removeAttribute("readonly"),e.currentTarget.focus(),e.stopPropagation(),!1},o.prototype.blurLesson=function(e){if(e.currentTarget.getAttribute("readonly"))return e.currentTarget.blur()},o.prototype.renameLesson=function(e){var n;if(!this.isEditable())return;if(!e.currentTarget.value)return;return n=this.model.lessons.get(t(e.currentTarget.parentNode).data("cid")),n.save({title:e.currentTarget.value})},o.prototype.moveLesson=function(e,t){var n;if(!this.isEditable())return;return n=this.model.lessons.get(t.item.data("cid")),this.model.lessons.move(n,t.item.index())},o.prototype.createLesson=function(){if(!this.isEditable())return;return this.model.lessons.create({})},o.prototype.destroyLesson=function(e){var n;return e.stopPropagation(),this.isEditable()?confirm("Are you sure you wish to delete this lesson?")?(n=t(e.currentTarget.parentNode).data("cid"),this.model.lessons.get(n).destroy({success:function(){return t(e.currentTarget).parents("li:first").fadeOut("fast",function(){return t(this).remove()})},error:function(e,t){return console.log("error deleting lesson")}})):!1:!1},o}(r.View)})}.call(this),define("text!templates/nav-buttons.html",[],function(){return"<%= buttonIf(previousAvailable(), 'js-prev previous-button', 'previous lesson') %>\n<%= buttonIf(nextAvailable(), 'js-next next-button', 'next lesson') %>\n<%= buttonIf(isComplete() && !nextAvailable(), 'js-finish finish-button', 'finish course') %>\n<div class='clearfix'></div>\n"}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/nav_buttons",["cdn.marionette","text!templates/nav-buttons.html","app/mediator","plugins/tracker"],function(t,r,i,s){var o;return o=function(t){function o(){return this.templateHelpers=e(this.templateHelpers,this),this.buttonIf=e(this.buttonIf,this),this.isComplete=e(this.isComplete,this),this.nextAvailable=e(this.nextAvailable,this),this.previousAvailable=e(this.previousAvailable,this),o.__super__.constructor.apply(this,arguments)}return n(o,t),_.extend(o.prototype,s("Navigation Buttons")),o.prototype.className="nav-buttons",o.prototype.initialize=function(){return i.on("lesson:rendered",this.updateButtons,this)},o.prototype.onClose=function(){return i.off("lesson:rendered",this.updateButtons)},o.prototype.events={"click .js-prev":"onPreviousClick","click .js-next":"onNextClick","click .js-finish":"onFinishClick"},o.prototype.template=_.template(r),o.prototype.updateButtons=function(e){var t;return this.lessonView=e,t=this.lessonView.model,this.prev=this.model.lessons.at(this.model.lessons.indexOf(t)-1),this.next=this.model.lessons.at(this.model.lessons.indexOf(t)+1),this.lessonView.on("userStateSync",this.render,this),this.next&&this.next.on("change",this.render,this),this._prevLessonView&&this._prevLessonView.off("userStateSync",this.render),this._prevNext&&this._prevNext.off("change",this.render),this._prevLessonView=this.lessonView,this._prevNext=this.next,this.render()},o.prototype.onPreviousClick=function(){var e;return e=1+this.model.lessons.indexOf(this.prev),i.trigger("lesson:navigate",e),this.track("Click Previous",{lesson:this.model.id,destination:e})},o.prototype.onNextClick=function(){var e;return e=1+this.model.lessons.indexOf(this.next),i.trigger("lesson:navigate",e),this.track("Click Next",{lesson:this.model.id,destination:e})},o.prototype.onFinishClick=function(){return i.trigger("parent:notify",{event:"courseEnd"}),this.track("Click Finish",{lesson:this.model.id})},o.prototype.previousAvailable=function(){return this.prev!=null&&(this.prev.get("isAccessible")||this.model.get("isEditable"))},o.prototype.nextAvailable=function(){return this.next!=null&&(this.next.get("isAccessible")||this.model.get("isEditable"))},o.prototype.isComplete=function(){var e;return((e=this.lessonView)!=null?e.isComplete():void 0)&&!this.next},o.prototype.buttonIf=function(e,t,n){if(e)return"<a class='"+t+"'><span class='nav-button-text'>"+n+"</span><i></i></a>"},o.prototype.templateHelpers=function(){return{previousAvailable:this.previousAvailable,nextAvailable:this.nextAvailable,isComplete:this.isComplete,buttonIf:this.buttonIf}},o}(t.CompositeView)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/course",["cdn.marionette","text!templates/course.html","views/lesson","app/mediator","plugins/tracker","../../toc/main","views/nav_buttons"],function(t,r,i,s,o,u,a){var f;return f=function(t){function f(){return this.onToggleTOC=e(this.onToggleTOC,this),this.customScroller=e(this.customScroller,this),f.__super__.constructor.apply(this,arguments)}return n(f,t),_.extend(f.prototype,o("Course")),f.prototype.initialize=function(){var e=this;return this._lessonTitleBlurrable=!0,this.listenTo(this.model,"change",this.onCourseChanged,this),this.listenTo(this.model.lessons,"add",this.onLessonsAdd,this),this.listenTo(this.model.lessons,"remove",this.onLessonsRemove,this),this.listenTo(this.model.lessons,"select",this.onLessonSelected,this),this.listenTo(this.model.lessons,"change:title",function(t,n){return e.updateTitle()}),this.ensureLesson(),s.on("toc:show",function(){return e.ui.tocIcon.addClass("active")}),s.on("toc:hide",function(){return e.ui.tocIcon.removeClass("active")})},f.prototype.ui={lessonTitle:".lessonTitle",lessonTitleWrapper:".lessonTitleWrapper",courseTitle:".courseTitle",courseTitleWrapper:".courseTitleWrapper",title:".title",tocIcon:".toc-icon",errorMsg:".saveErrorMsg"},f.prototype.regions={lessonRegion:".lessons",toc:".toc",nav:".nav"},f.prototype.events={"click .js-toggle-toc":"onToggleTOC","click .lessonTitle":"startEditingLessonTitle","click .courseTitle":"startEditingCourseTitle"},f.prototype.template=_.template(r),f.prototype.itemView=i,f.prototype.itemViewContainer=".lessons",f.prototype.className=function(){return this.options.embed?"course embed-frame":this.model.get("isEditable")?"course editable":"course"},f.prototype.serializeData=function(){return _.extend(this.model.toJSON(),{firstLessonTitle:this.model.lessons.first().get("title")})},f.prototype.ensureLesson=function(){if(this.model.lessons.length===0)return this.model.lessons.create({})},f.prototype.getLessonView=function(e){return this.children.findByModel(e)},f.prototype.activeLessonIndex=function(){return this.model.lessons.indexOf(this._activeLesson)},f.prototype.activateLesson=function(e){var t=this;return this.loadingLesson&&this.loadingLesson.abort(),this.renderingLesson=$.Deferred(),this.model.lessons.indexOf(e)===-1||e===this._activeLesson?(this.renderingLesson.resolve(),!1):(this.stopEditingCourseTitle(),this.stopEditingLessonTitle(),this.loadingLesson=e.fetch(),this.loadingLesson.done(function(){return t.displayLesson(e)}))},f.prototype.displayLesson=function(e){return this._activeLesson=e,this.model.progress.save({lessonIndex:this.activeLessonIndex()+1}),this._lessonView&&(this._lessonView.off("menuDeactivated"),this._lessonView.off("itemview:dblclick"),this._lessonView.close()),this._lessonView=new i({model:this._activeLesson,embed:this.options.embed,isEditable:this.model.get("isEditable")}),this._lessonView.on("menuDeactivated",this.showHoverables,this),this._lessonView.on("itemview:dblclick",this.onInstanceClicked,this),this.lessonRegion.show(this._lessonView),this.renderingLesson&&this.renderingLesson.resolve(),s.trigger("lesson:rendered",this._lessonView),this.updateTitle(),_.delay(function(){return window.scrollTo(0,0)},1e3)},f.prototype.addNewLesson=function(e){var t;return t=e||this.activeLessonIndex()+1,this.model.lessons.create({},{at:t}),this.displayLesson(this.model.lessons.at(t))},f.prototype.deleteLesson=function(e){var t;return t=e||this.activeLessonIndex(),this.model.lessons.destroy(this.model.lessons.at(this.activeLessonIndex()))},f.prototype.startEditing=function(e){if(!this.model.get("isEditable"))return;return e.toggleEdit(!0),e.$el.parent().addClass("editing"),this._lessonView.showHoverables(!1)},f.prototype.startEditingCourseTitle=function(){return this.startEditing(this._courseTitle),this._isEditingCourse=!0},f.prototype.startEditingLessonTitle=function(){return this.startEditing(this._lessonTitle),this._isEditingLesson=!0},f.prototype.stopEditing=function(e,t){return e.save({title:t.getPretty()}),t.toggleEdit(!1),t.$el.parent().removeClass("editing"),this._lessonView.showHoverables(!0)},f.prototype.stopEditingCourseTitle=function(){if(!this._isEditingCourse)return;return this.stopEditing(this.model,this._courseTitle),this._isEditingCourse=!1,this.track("Change Title",{course:this.model.id,title:this._courseTitle.getPretty()})},f.prototype.stopEditingLessonTitle=function(){if(!this._isEditingLesson)return;return this.stopEditing(this._activeLesson,this._lessonTitle),this._isEditingLesson=!1,this.track("Change Lesson Title",{lesson:this._activeLesson.id,title:this._lessonTitle.getPretty()})},f.prototype.onCourseChanged=function(){return this.updateTitle()},f.prototype.onInstanceClicked=function(){return this.stopEditingLessonTitle(),this.stopEditingCourseTitle()},f.prototype.onLessonsRemove=function(e,t,n){var r;t.length===0&&(this.addNewLesson(0),this.displayLesson(this.model.lessons.at(0)));if(e===this._activeLesson)return r=Math.min(n.index,t.length-1),this.activateLesson(this.model.lessons.at(r))},f.prototype.onLessonSelected=function(e){return this.activateLesson(e)},f.prototype.onLessonsChange=function(){return this.updateTitle()},f.prototype.onRender=function(){var e=this;return this._rendered=!0,this._lessonTitle=new vs.ui.EditableText({el:this.ui.lessonTitle,type:"input",complete:function(){return e.stopEditingLessonTitle()},maxlength:50}),this._courseTitle=new vs.ui.EditableText({el:this.ui.courseTitle,type:"input",complete:function(){return e.stopEditingCourseTitle()},maxlength:60}),this.activateLesson(this._activeLesson||this.model.lessons.first()),this.toc.show(new u({model:this.model})),this.toc.ready=!0,this.tocScroll=new vs.ui.Scroll(this.toc.$el),this.nav.show(new a({model:this.model})),s.on("api:xhr:error",this.showSaveErrorMsg,this),s.on("api:xhr:success",this.hideSaveErrorMsg,this)},f.prototype.scrollWidth=function(){var e;return e=$(window).width(),e<1024?e:e-263},f.prototype.customScroller=function(){return this.scroller=new vs.ui.Scroll($("html"),{horizontal:!1})},f.prototype.onShow=function(){return this.customScroller()},f.prototype.onToggleTOC=function(){return s.trigger("toc:toggle"),this.track("Toggle ToC",{course:this.model.id})},f.prototype.updateTitle=function(){if(!this._rendered)return;return this.ui.lessonTitle.text(this._activeLesson.get("title"))},f.prototype.showLesson=function(e){var t;if(t=this.model.lessons.at(e-1))return this.activateLesson(t)},f.prototype.showGadget=function(e,t){var n=this;return this.showLesson(e),this.renderingLesson.done(function(){return n._lessonView.showGadget(t)})},f.prototype.showSaveErrorMsg=function(){if(!this.errorShowing&&!!this.model.get("isEditable"))return this.ui.errorMsg.slideDown(50),this.errorShowing=!0},f.prototype.hideSaveErrorMsg=function(){if(this.errorShowing)return this.errorShowing=!1,this.ui.errorMsg.slideUp(50)},f}(t.Layout)})}.call(this),define("text!templates/author_sidebar/author_sidebar.html",[],function(){return'<div class="section first">\n  <% if(!whitelabel()){ %>\n    <a class=\'versal-logo\'></a>\n  <% } %>\n  <div class=\'pull-right\'>\n    <button class=\'js-publish publish\'>overview</button>\n    <div class="lastSaved">Last saved <span class="timestamp">seconds</span> ago</div>\n  </div>\n</div>\n\n<div class="js-catalogue catalogue"></div>\n'}),define("text!templates/author_sidebar/catalogue.html",[],function(){return'<!-- Removed per #430 until search is functional\n<div class="search-outer">\n  <input type="text" class="search" placeholder="Search gadgets" />\n</div>\n-->\n<div class="card-options">\n  <ul class="pull-left view-modes">\n    <li><i class="js-show-tile-view tile-view inactive"></i></li>\n    <li><i class="js-show-list-view list-view"></i></li>\n\n  </ul>\n  <!--\n  Removed per issue #415 until we finish up Marketplace\n  <div class="pull-right marketplace-link">\n    Gadget marketplace\n    <i class="tiny-arrow-icon"></i>\n  </div>\n  -->\n  <div class="clearfix"></div>\n</div>\n<div class="js-gadgets gadgetCards list-view">\n  <h3 class="header sandbox">Working set</h3>\n  <h3 class="header pending">Pending approval</h3>\n  <h3 class="header approved">Public</h3>\n\n</div>\n'}),define("text!templates/author_sidebar/sidebar_gadget.html",[],function(){return'<div class="icon"></div>\n<div class="title"><%- title %></div>\n<div class="author"><%- author %></div>\n<div class="version"><%- version %></div>\n<div class="expansion">\n  <div class="title"><%- title %></div>\n  <div class="author"><%- author %></div>\n  <div class="version"><%- version %></div>\n</div>\n<div class="clearfix"></div>\n'}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/sidebar/author/gadget",["cdn.marionette","text!templates/author_sidebar/sidebar_gadget.html"],function(e,n){var r;return r=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.template=_.template(n),r.prototype.className="gadgetCard js-gadgetCard",r.prototype.events={click:"onClick"},r.prototype.initialize=function(){return _.isFunction(this.model.type)&&this.$el.attr("data-type",this.model.type()),this.model.set({title:this.model.get("title")||this.model.get("name")},{silent:!0})},r.prototype.attributes=function(){return{"data-gadget-id":this.model.id}},r.prototype.ui={icon:".icon",title:".title"},r.prototype.onRender=function(){return this.model.type()==="versal/header@0.2.9"&&this.model.has("icon")?this.ui.icon.css("background-image","url("+this.model.get("icon")+")"):this.ui.icon.css("background-image","url("+this.model.icon()+")")},r.prototype.onClick=function(e){return e.preventDefault(),this.toggleExpansion()},r.prototype.toggleExpansion=function(e){this.$el.toggleClass("expanded",e);if(this.$el.hasClass("expanded"))return this.trigger("expand",this)},r}(e.ItemView)})}.call(this),function(e,t){var n=t.Collection.prototype.filter,r={},i=function(e,t){return e.hasOwnProperty(t)},s=[].slice;t.Filters={},t.Filter=function(){function n(t){this.options=e.defaults(e.pick(t,e.keys(this.defaults)),this.defaults)}return e.extend(n.prototype,{defaults:{},options:{},run:function(e,t){return this.query=t,new e.constructor(e.models)}}),e.extend(n,{extend:t.Collection.extend,define:function(e,t){if(i(r,e))throw"Filter alias "+e+" is already defined";r[e]=t},undefine:function(e,t){if(!i(r,e))throw"Unknown filter alias "+e;delete r[e]},lookup:function(e){return i(r,e)?r[e]:null}}),n}(),e.each(["filter","first","invoke","last","reject","select","shuffle","sortBy","without"],function(n){t.Filters[n]=t.Filter.extend({constructor:function(){this.args=s.call(arguments,0)},run:function(t){var r=e[n].apply(e,[t.models].concat(this.args));return new t.constructor(r)}})});var o=function(n,r){var i=s.call(arguments,2),u=function(e){n=o.apply(this,[n,e].concat(i))};return r instanceof t.Filter?n=r.run(n,i):(e.isString(r)&&(r=e.map(r.split("|"),t.Filter.lookup)),e.each(r,u)),n};t.Collection.prototype.filter=function(t){return e.isFunction(t)?n.apply(this,arguments):o.apply(this,[this].concat(s.call(arguments)))}}(_,Backbone),define("plugins/backbone.filter",["cdn.backbone"],function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/sidebar/author/catalogue",["app/mediator","plugins/tracker","cdn.marionette","text!templates/author_sidebar/catalogue.html","./gadget","app/catalogue","plugins/backbone.filter"],function(t,r,i,s,o,u){var a,f;return f=Backbone.Filter.extend({defaults:{field:"type",types:[]},run:function(e){var t=this;return e.select(function(e){return t.options.types.indexOf(e.get(t.options.field))>=0})}}),a=function(t){function i(){return this.onSortStop=e(this.onSortStop,this),this.onSortReceive=e(this.onSortReceive,this),this.onSortStart=e(this.onSortStart,this),i.__super__.constructor.apply(this,arguments)}return n(i,t),_.extend(i.prototype,r("Sidebar Catalogue")),i.prototype.className="gadget-catalogue js-gadget-catalogue",i.prototype.template=_.template(s),i.prototype.itemView=o,i.prototype.itemViewContainer=".js-gadgets",i.prototype.appendHtml=function(e,t){if(t.model.get("hidden"))return;if(t.model.get("catalog")==="approved")return e.$(".approved").after(t.el);if(t.model.get("catalog")==="sandbox")return e.$("h3.approved, h3.sandbox").show(),e.$(".sandbox").after(t.el);if(t.model.get("catalog")==="pending")return e.$("h3.approved, h3.pending").show(),e.$(".pending").after(t.el)},i.prototype.ui={gadgetList:".js-gadgets"},i.prototype.events={"click .js-show-list-view":"showListView","click .js-show-tile-view":"showTileView"},i.prototype.initialize=function(e){var t=this;return e==null&&(e={}),this.catalogue=e.catalogue||u,this.collection=new this.catalogue.constructor(this.catalogue.models),this.listenTo(this.catalogue,"reset",function(){return t.collection.reset(t.catalogue.models)}),$(window).on("resize",function(){return t.fixSizing()})},i.prototype.onRender=function(){var e=this;return this.on("itemview:expand",this.onItemViewExpanded,this),this.ui.gadgetList.sortable({items:".gadgetCard",connectWith:".gadgets",delay:100,placeholder:"hidden atom-placeholder",helper:"clone",receive:this.onSortReceive,start:this.onSortStart,stop:this.onSortStop,over:_.identity(!1)}),_.defer(function(){return e.fixSizing()})},i.prototype.changeView=function(e){var t=this;return this.$(".card-options i").addClass("inactive"),this.$("."+e+"-view").removeClass("inactive"),this.ui.gadgetList.fadeOut(100,function(){return t.ui.gadgetList.removeClass("list-view tile-view").addClass(e+"-view").fadeIn(100)})},i.prototype.showListView=function(){return this.changeView("list"),this.track("Show List View")},i.prototype.showTileView=function(e){return this.changeView("tile"),this.track("Show Tile View")},i.prototype.onItemViewExpanded=function(e){return _.each(this.children.without(e),function(e){return e.toggleExpansion(!1)})},i.prototype.onSortStart=function(e,t){return this.track("Start Dragging",{gadget:t.helper.data("type")}),t.item.addClass("dragging"),t.item.removeClass("expanded").show(),t.helper.removeClass("expanded").show(),t.helper.addClass("atom"),t.helper.css({width:1,height:"auto"}).hide().fadeIn(200,function(){return t.helper.addClass("fullWidth")})},i.prototype.onSortReceive=function(e,t){return!1},i.prototype.onSortStop=function(e,t){return t.item.removeClass("dragging"),t.item.removeAttr("style"),!1},i.prototype.fixSizing=function(){return this.ui.gadgetList.height(document.documentElement.clientHeight-this.ui.gadgetList.position().top-20)},i}(i.CompositeView)})}.call(this),function(){define("views/sidebar/sidebar",["app/mediator"],function(e){var t;return t={onLogoClick:function(){return e.trigger("parent:notify",{event:"logoClick"}),this.track("Click Logo")}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/sidebar/author/author",["cdn.marionette","text!templates/author_sidebar/author_sidebar.html","app/mediator","plugins/tracker","./catalogue","views/sidebar/sidebar","cdn.jqueryui"],function(t,r,i,s,o,u){var a;return a=function(t){function a(){return this.templateHelpers=e(this.templateHelpers,this),this.onAjaxComplete=e(this.onAjaxComplete,this),a.__super__.constructor.apply(this,arguments)}return n(a,t),_.extend(a.prototype,u),_.extend(a.prototype,s("Author Sidebar")),a.prototype.className="authorSidebar",a.prototype.template=_.template(r),a.prototype.initialize=function(){var e=this;return $(document).ajaxComplete(this.onAjaxComplete),this.lastSavedTime=+(new Date),setInterval(function(){return e.updateSavedLabel()},1e4)},a.prototype.events={"click .js-publish":"onPublishClick","click .versal-logo":"onLogoClick"},a.prototype.regions={catalogue:".js-catalogue"},a.prototype.ui={lastSavedTime:".timestamp"},a.prototype.onRender=function(){return this.catalogue.show(new o)},a.prototype.onAjaxComplete=function(){return this.lastSavedTime=+(new Date),this.updateSavedLabel()},a.prototype.updateSavedLabel=function(){var e,t,n,r,i,s,o,u,a,f;e=+(new Date)-this.lastSavedTime,e<=3e4&&(t="seconds"),3e4<e&&e<=6e4&&(t="less than a minute"),a=[["minute",6e4,36e5],["hour",36e5,864e5],["day",864e5,Infinity]];for(o=0,u=a.length;o<u;o++)f=a[o],i=f[0],r=f[1],n=f[2],r<e&&e<=n&&(s=Math.floor(e/r),t=""+s+" "+i,s>1&&(t+="s"));return this.ui.lastSavedTime.html(t)},a.prototype.onPublishClick=function(){return i.trigger("parent:notify",{event:"publishCourse"}),this.track("Click Publish")},a.prototype.templateHelpers=function(){var e=this;return{whitelabel:function(){return e.options.whitelabel}}},a}(t.Layout)})}.call(this),define("text!templates/learner_sidebar.html",[],function(){return"<div class='section first'>\n  <% if(!whitelabel()){ %>\n    <a class='versal-logo'></a>\n  <% } %>\n</div>\n<ul class=\"lesson-list\"></ul>\n"}),define("text!templates/learner_sidebar_item.html",[],function(){return'<span title="<%- title %>"><%- title %></span>\n'}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=function(e,t){return function(){return e.apply(t,arguments)}};define("views/sidebar/learner",["cdn.marionette","text!templates/learner_sidebar.html","text!templates/learner_sidebar_item.html","app/mediator","plugins/tracker","./sidebar"],function(e,r,i,s,o,u){var a,f;return a=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){return this.model.on("change",this.render,this)},n.prototype.tagName="li",n.prototype.className="lesson",n.prototype.template=_.template(i),n.prototype.events={click:"select"},n.prototype.select=function(){return this.trigger("select",this.model)},n.prototype.onRender=function(){if(!this.model.get("isAccessible"))return this.$el.addClass("disabled-lesson")},n}(e.ItemView),f=function(e){function i(){return this.templateHelpers=n(this.templateHelpers,this),i.__super__.constructor.apply(this,arguments)}return t(i,e),_.extend(i.prototype,u),_.extend(i.prototype,o("Learner Sidebar")),i.prototype.initialize=function(){return this.model.on("change",this.render,this),s.on("lesson:rendered",this.updateActiveLesson,this),this.collection=this.model.lessons,this.on("itemview:select",this.selectLesson,this)},i.prototype.remove=function(){return s.off("lesson:rendered",this.updateActiveLesson,this),i.__super__.remove.apply(this,arguments)},i.prototype.itemView=a,i.prototype.itemViewContainer=".lesson-list",i.prototype.ui={lessonList:".lesson-list"},i.prototype.className="learnerSidebar",i.prototype.template=_.template(r),i.prototype.events={"click .js-navigate-lesson":"selectLesson","click .versal-logo":"onLogoClick"},i.prototype.selectLesson=function(e){var t;t=e.model;if(!t.get("isAccessible"))return;return s.trigger("lesson:navigate",this.model.lessons.indexOf(t)+1),this.track("Select lesson",{lesson:t.id})},i.prototype.updateActiveLesson=function(e){var t;return this.activeView=e,t=this.activeView.model,this.$(".active-lesson").removeClass("active-lesson"),this.children.findByModel(t).$el.addClass("active-lesson")},i.prototype.templateHelpers=function(){var e=this;return{whitelabel:function(){return e.options.whitelabel}}},i.prototype.onRender=function(){return this.activeView&&this.updateActiveLesson(this.activeView),this.scroll=new vs.ui.Scroll(this.ui.lessonList)},i}(e.CompositeView)})}.call(this),define("text!templates/player.html",[],function(){return'<div class="player">\n  <div class="sidebar"></div>\n  <div class="dialogs"></div>\n  <div class="container"></div>\n  <div class="scrubBar"></div>\n  <div class="loadingCourse"></div>\n</div>\n'}),define("text!templates/loading.html",[],function(){return"<div class='loading-overlay'>\n  <div class='loading-content'>\n    <i class='spin-holder'></i>\n    Loading...\n  </div>\n</div>\n\n"}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/loading",["cdn.marionette","text!templates/loading.html"],function(e,n){var r;return r=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.className="loading-page",r.prototype.template=_.template(n),r.prototype.onRender=function(){return new vs.ui.LoadingIndicator(this.$(".spin-holder"))},r.prototype.hide=function(e){var t=this;return this.$(".loading-overlay").fadeOut(400,function(){return typeof e=="function"?e():void 0})},r}(e.ItemView)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("models/video",["cdn.lodash","cdn.backbone"],function(e,n){var r;return r=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.defaults={type:"asset"},r.prototype.getEmbedCode=function(){var t;if(this.get("type")==="asset")return t=e.filter(this.get("representations"),function(e){return e.contentType.indexOf("video/")===0}),t=e.sortBy(t,function(e){return e.contentType==="video/webm"?0:1}),e.template('<video class="myVideo" preload="none" controls="controls">\n  <% _.each(videos, function(vid) { %>\n    <source src="<%= vid.location %>" type="<%= vid.contentType %>">\n  <% }) %>\n</video>',{videos:t});if(this.get("type")==="youtube")return'<iframe id="ytplayer" type="text/html" width="100%" height="100%" src="http://www.youtube.com/embed/'+this.get("youtube_id")+'" frameborder="0"/>';if(this.get("type")==="vimeo")return'<iframe src="http://player.vimeo.com/video/'+this.get("vimeo_id")+'" width="100%" height="100%" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'},r}(n.Model),window.vs||(window.vs={}),window.vs.Video=r,r})}.call(this),define("text!templates/asset_picker/asset_picker.html",[],function(){return'<div class="assets-modal modal">\n  <div class="header">\n    <div class="modal-title">file picker</div>\n    <div class="modal-controls">\n      <button class="cancel js-close">cancel</button>\n      <button class="action js-use-file js-upload">use file</button>\n    </div>\n    <div class="clearfix"></div>\n  </div>\n  <div class="content">\n    <div class="preview-region">\n      <div class="uploading-overlay">\n        <div class="uploading-spinner"></div>\n      </div>\n\n      <div class="choose-overlay">\n        <div class="drop-image"></div>\n        <div class="drop-blurb">\n          drag file here\n          <span class="click-blurb">or click to upload</span>\n        </div>\n        <div class="dropzone"></div>\n      </div>\n\n      <input class="hidden-uploader" type="file">\n      <div class="file-preview"></div>\n\n    </div>\n    <div class="status-message"></div>\n    <% if (getType() == "video") { %>\n      <input class="video-link" placeholder="or paste YouTube or Vimeo link" />\n    <% } %>\n  </div>\n</div>\n<div class="modal-backdrop"></div>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/asset_picker/asset_picker",["app/mediator","plugins/tracker","models/video","cdn.marionette","text!templates/asset_picker/asset_picker.html"],function(t,r,i,s,o){var u,a;return a=function(t){function r(){return this.onKeyDown=e(this.onKeyDown,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.close=function(){return $(document).off("keydown",this.onKeyDown),$(window).off("dragenter dragexit dragover dragleave drop",this.noop),this.remove()},r.prototype.onBackdropClick=function(){return this.close()},r.prototype.onModalClick=function(e){return e.stopPropagation()},r.prototype.onCloseModalClick=function(){return this.close()},r.prototype.onKeyDown=function(e){if(e.keyCode===27)return this.close()},r.prototype.onRender=function(){return $(document).on("keydown",this.onKeyDown),$(window).on("dragenter dragexit dragover dragleave drop",this.noop)},r.prototype.noop=function(e){return e.stopPropagation(),e.preventDefault()},r.prototype.modalEvents={click:"onModalClick","click .js-close":"onCloseModalClick","click .modal-backdrop":"onBackdropClick"},r}(s.ItemView),u=function(t){function s(){return this.onUploadError=e(this.onUploadError,this),this.onAssetRefetchError=e(this.onAssetRefetchError,this),this.onAssetRefetch=e(this.onAssetRefetch,this),this.onUploadSuccess=e(this.onUploadSuccess,this),this.onDrop=e(this.onDrop,this),this.templateHelpers=e(this.templateHelpers,this),s.__super__.constructor.apply(this,arguments)}return n(s,t),_.extend(s.prototype,r("Asset Picker")),s.prototype.template=_.template(o),s.prototype.templateHelpers=function(){var e=this;return{getType:function(){return e.type}}},s.prototype.initialize=function(e){this.options=e,this.type=this.options.type;if(!this.type)throw new Error("Asset type is required");return this.formats=this.type==="image"?["jpg","jpeg","png"]:this.type==="video"?["mp4","ogg","webm","avi","mov"]:void 0},s.prototype.ui={preview:".preview-region",filePreview:".file-preview",uploading:".uploading-overlay",choose:".choose-overlay",status:".status-message",useButton:".js-use-file",spinner:".uploading-spinner",hiddenUploader:".hidden-uploader",videoInput:".video-link"},s.prototype.events=function(){return _.extend({"click .choose-overlay":"onChooseClick","dragenter .dropzone":"onOverlayDragEnter","dragleave .dropzone":"onOverlayDragLeave","dragenter .preview-region":"onRegionDragEnter","dragexit .dropzone":"noop","dragover .dropzone":"noop","drop .dropzone":"onDrop","click .js-use-file":"onUseClick","input .video-link":"onVideoInputChange","paste .video-link":"onVideoInputChange"},this.modalEvents)},s.prototype.onOverlayDragEnter=function(e){return this.ui.choose.addClass("dragenter"),e.preventDefault()},s.prototype.onOverlayDragLeave=function(e){return this.ui.choose.removeClass("dragenter fromRegion"),this.hasFile&&this.ui.choose.hide(),e.preventDefault()},s.prototype.onRegionDragEnter=function(e){if(!this.hasFile)return;return this.ui.choose.addClass("dragenter fromRegion"),this.ui.choose.show(),e.preventDefault()},s.prototype.onDrop=function(e){var t,n;t=e.originalEvent,t.stopPropagation(),t.preventDefault();if(t.dataTransfer.files.length)return this.onChooseComplete((n=t.dataTransfer.files)!=null?n[0]:void 0)},s.prototype.showStatus=function(e,t){return t==null&&(t=!1),this.ui.status.toggleClass("error",t),this.ui.status.text(e)},s.prototype.showPreviewError=function(e){return this.ui.filePreview.text(e)},s.prototype.showUploading=function(){return this.ui.choose.hide(),this.ui.uploading.show(),this.indicator||(this.indicator=new vs.ui.LoadingIndicator(this.ui.spinner,"#fff")),this.showStatus("uploading...")},s.prototype.showChoose=function(){return this.ui.uploading.hide(),this.ui.choose.show(),this.showStatus("Accepted file types: "+this.formats.join(", ")),this.hasFile=!1},s.prototype.showFilePreview=function(e){var t,n=this;return t=e.size/1048576,t>5?this.showPreviewError("File too large to preview"):typeof FileReader!="undefined"&&FileReader!==null?(this.fr=new FileReader,this.fr.onload=function(t){return n.onPreviewLoaded.call(n,t,e)},this.fr.readAsDataURL(e)):this.showPreviewError("No preview available")},s.prototype.onPreviewLoaded=function(e,t){var n;if(t.type.split("/")[0]!==this.type)return this.showPreviewError("No preview available");if(this.type==="image")return this.ui.filePreview.html($("<img>").attr("src",e.target.result));if(this.type==="video")return n=$("<video>")[0],!n.canPlayType||!n.canPlayType(t.type).replace(/no/,"")?this.showPreviewError("No preview available"):this.ui.filePreview.html("<video preload='metadata' controls='controls'>\n  <source src='"+e.target.result+"'>\n</video>")},s.prototype.onUploadSuccess=function(e){var t;return this.ui.uploading.hide(),this.assetJSON=_.extend(e.toJSON(),{representations:e.representations.toJSON()}),e.get("contentType").substr(0,5)==="video"&&(this.assetViewModel=new i(this.assetJSON)),this.showStatus("processing..."),typeof (t=this.options).processing=="function"&&t.processing(),this.checkProcessingStatus(e)},s.prototype.checkProcessingStatus=function(e){return e.fetch({success:this.onAssetRefetch,error:this.onAssetRefetchError})},s.prototype.onAssetRefetch=function(e){return e.representations.findWhere({available:!1})?_.delay(this.checkProcessingStatus.bind(this),3e3,e):this.onProcessingComplete()},s.prototype.onAssetRefetchError=function(e){return this.showStatus("Server error",!0)},s.prototype.onProcessingComplete=function(e){return this.ui.useButton.prop("disabled",!1),this.showStatus("Processing complete")},s.prototype.onUploadError=function(){return this.ui.uploading.hide(),this.track("Asset upload error"),this.showStatus("Error uploading",!0)},s.prototype.onChooseClick=function(){var e=this;return this.ui.hiddenUploader.one("change",function(){var t;return e.onChooseComplete((t=e.ui.hiddenUploader[0].files)!=null?t[0]:void 0)}),this.ui.hiddenUploader.click()},s.prototype.onChooseComplete=function(e){var t,n,r,i;return e?(i=_.last(e.name.split(".")),_.contains(this.formats,i.toLowerCase())?(r=e.type||""+this.type+"/x-"+i,n={title:"New File",tags:[this.type],content:e,contentType:r},t=new vs.api.Asset,t.save(n,{upload:!0,success:this.onUploadSuccess,error:this.onUploadError}),this.showUploading(),this.ui.videoInput.css({visibility:"hidden"}),this.showFilePreview(e),this.hasFile=!0):this.showStatus("Unsupported file type chosen. Acceptable formats:          "+this.formats.join(", "),!0)):this.showStatus("No file chosen",!0)},s.prototype.onUseClick=function(){return this.options.result(this.assetViewModel||this.assetJSON),this.close(),this.track("Use asset",{assetJSON:this.assetJSON})},s.prototype.onVideoInputChange=function(){var e,t,n;e=this.ui.videoInput.val();if(this.oldInput===e)return;this.oldInput=e;if(e.length===0){this.render(),this.ui.videoInput.focus();return}n=this.getYoutubeId(e),t=this.getVimeoId(e);if(n||t)this.ui.choose.hide(),this.ui.useButton.prop("disabled",!1),this.showStatus("");return n?(this.assetViewModel=new i({type:"youtube",youtube_id:n}),this.ui.filePreview.html(this.assetViewModel.getEmbedCode())):t?(this.assetViewModel=new i({type:"vimeo",vimeo_id:t}),this.ui.filePreview.html(this.assetViewModel.getEmbedCode())):(this.showStatus("That is not a valid YouTube or Vimeo video url",!0),this.ui.useButton.prop("disabled",!0))},s.prototype.getYoutubeId=function(e){var t,n;return t=/(?:(?:https?:\/\/)?(?:[a-zA_Z]{2,3}.)?)?(?:(?:youtube\.com\/watch\?)(?:[a-z=_&]+|(?:[\w\d\-\_\=]+&amp;(?:amp;)?))*v(?:&lt;[A-Z]+&gt;)?=|youtu.be\/)([0-9a-zA-Z\-\_]+)/,(n=e.match(t))!=null?n[1]:void 0},s.prototype.getVimeoId=function(e){var t,n;return t=/(?:(?:https?:\/\/)?(?:[a-zA_Z]{2,3}.)?)?(?:vimeo\.com\/)([0-9]+)/,(n=e.match(t))!=null?n[1]:void 0},s.prototype.onRender=function(){return s.__super__.onRender.apply(this,arguments),this.ui.useButton.prop("disabled",!0),this.showChoose(),this.track("Show")},s}(a)})}.call(this),function(){define("messages/handlers/asset_select",["cdn.jquery","views/asset_picker/asset_picker"],function(e,t){return function(n,r){var i,s,o;return s=this,i=function(e){var t;if(!_.isUndefined(e))return t={},n.as&&(t[n.as]=e,(r!=null?r.gadgetId:void 0)&&s.triggerGadgetEvent(r.gadgetId,"change",t)),typeof n.success=="function"?n.success(e):void 0},o=new t({result:i,type:n.type,processing:n.processing}),o.render(),e("body").append(o.$el)}})}.call(this),define("css-parse",[],function(){return function(e,t){function i(e){var t=e.match(/\n/g);t&&(n+=t.length);var i=e.lastIndexOf("\n");r=~i?e.length-i:r+e.length}function s(){var e={line:n,column:r};return t.position?function(t){return t.position={start:e,end:{line:n,column:r}},h(),t}:o}function o(e){return h(),e}function u(){return{type:"stylesheet",stylesheet:{rules:l()}}}function a(){return c(/^{\s*/)}function f(){return c(/^}/)}function l(){var t,n=[];h(),p(n);while(e[0]!="}"&&(t=L()||A()))n.push(t),p(n);return n}function c(t){var n=t.exec(e);if(!n)return;var r=n[0];return i(r),e=e.slice(r.length),n}function h(){c(/^\s*/)}function p(e){var t;e=e||[];while(t=d())e.push(t);return e}function d(){var t=s();if("/"!=e[0]||"*"!=e[1])return;var n=2;while(null!=e[n]&&("*"!=e[n]||"/"!=e[n+1]))++n;n+=2;var o=e.slice(2,n-2);return r+=2,i(o),e=e.slice(n),r+=2,t({type:"comment",comment:o})}function v(){var e=c(/^([^{]+)/);if(!e)return;return e[0].trim().split(/\s*,\s*/)}function m(){var e=s(),t=c(/^(\*?[-\w]+)\s*/);if(!t)return;t=t[0];if(!c(/^:\s*/))return;var n=c(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/);if(!n)return;var r=e({type:"declaration",property:t,value:n[0].trim()});return c(/^[;\s]*/),r}function g(){var e=[];if(!a())return;p(e);var t;while(t=m())e.push(t),p(e);if(!f())return;return e}function y(){var e,t=[],n=s();while(e=c(/^(from|to|\d+%|\.\d+%|\d+\.\d+%)\s*/))t.push(e[1]),c(/^,\s*/);if(!t.length)return;return n({type:"keyframe",values:t,declarations:g()})}function b(){var e=s(),t=c(/^@([-\w]+)?keyframes */);if(!t)return;var n=t[1],t=c(/^([-\w]+)\s*/);if(!t)return;var r=t[1];if(!a())return;p();var i,o=[];while(i=y())o.push(i),p();if(!f())return;return e({type:"keyframes",name:r,vendor:n,keyframes:o})}function w(){var e=s(),t=c(/^@supports *([^{]+)/);if(!t)return;var n=t[1].trim();if(!a())return;p();var r=l();if(!f())return;return e({type:"supports",supports:n,rules:r})}function E(){var e=s(),t=c(/^@media *([^{]+)/);if(!t)return;var n=t[1].trim();if(!a())return;p();var r=l();if(!f())return;return e({type:"media",media:n,rules:r})}function S(){var e=s(),t=c(/^@page */);if(!t)return;var n=v()||[],r=[];if(!a())return;p();var i;while(i=m())r.push(i),p();if(!f())return;return e({type:"page",selectors:n,declarations:r})}function x(){var e=s(),t=c(/^@([-\w]+)?document *([^{]+)/);if(!t)return;var n=(t[1]||"").trim(),r=t[2].trim();if(!a())return;p();var i=l();if(!f())return;return e({type:"document",document:r,vendor:n,rules:i})}function T(){return k("import")}function N(){return k("charset")}function C(){return k("namespace")}function k(e){var t=s(),n=c(new RegExp("^@"+e+" *([^;\\n]+);"));if(!n)return;var r={type:e};return r[e]=n[1].trim(),t(r)}function L(){return b()||E()||w()||T()||N()||C()||x()||S()}function A(){var e=s(),t=v();if(!t)return;return p(),e({type:"rule",selectors:t,declarations:g()})}t=t||{};var n=1,r=1;return u()}}),define("css-stringify",[],function(){return Compressed=function(){function e(e){e=e||{}}return e.prototype.compile=function(e){return e.stylesheet.rules.map(this.visit,this).join("")},e.prototype.visit=function(e){return this[e.type](e)},e.prototype.comment=function(e){if(this.compress)return""},e.prototype.import=function(e){return"@import "+e.import+";"},e.prototype.media=function(e){return"@media "+e.media+"{"+e.rules.map(this.visit,this).join("")+"}"},e.prototype.document=function(e){var t="@"+(e.vendor||"")+"document "+e.document;return t+"{"+e.rules.map(this.visit,this).join("")+"}"},e.prototype.charset=function(e){return"@charset "+e.charset+";"},e.prototype.supports=function(e){return"@supports "+e.supports+" {\n"+this.indent(1)+e.rules.map(this.visit,this).join("\n\n")+this.indent(-1)+"\n}"},e.prototype.keyframes=function(e){return"@"+(e.vendor||"")+"keyframes "+e.name+"{"+e.keyframes.map(this.visit,this).join("")+"}"},e.prototype.keyframe=function(e){var t=e.declarations;return e.values.join(",")+"{"+t.map(this.visit,this).join("")+"}"},e.prototype.page=function(e){var t=e.selectors.length?e.selectors.join(", ")+" ":"";return"@page "+t+"{\n"+this.indent(1)+e.declarations.map(this.visit,this).join("\n")+this.indent(-1)+"\n}"},e.prototype.rule=function(e){var t=e.declarations;return t.length?e.selectors.join(",")+"{"+t.map(this.visit,this).join("")+"}":""},e.prototype.declaration=function(e){return e.property+":"+e.value+";"},e}(),Identity=function(){function e(e){e=e||{},this.indentation=e.indent}return e.prototype.compile=function(e){return e.stylesheet.rules.map(this.visit,this).join("\n\n")},e.prototype.visit=function(e){return this[e.type](e)},e.prototype.comment=function(e){return this.indent()+"/*"+e.comment+"*/"},e.prototype.import=function(e){return"@import "+e.import+";"},e.prototype.media=function(e){return"@media "+e.media+" {\n"+this.indent(1)+e.rules.map(this.visit,this).join("\n\n")+this.indent(-1)+"\n}"},e.prototype.document=function(e){var t="@"+(e.vendor||"")+"document "+e.document;return t+" "+" {\n"+this.indent(1)+e.rules.map(this.visit,this).join("\n\n")+this.indent(-1)+"\n}"},e.prototype.charset=function(e){return"@charset "+e.charset+";\n"},e.prototype.supports=function(e){return"@supports "+e.supports+" {\n"+this.indent(1)+e.rules.map(this.visit,this).join("\n\n")+this.indent(-1)+"\n}"},e.prototype.keyframes=function(e){return"@"+(e.vendor||"")+"keyframes "+e.name+" {\n"+this.indent(1)+e.keyframes.map(this.visit,this).join("\n")+this.indent(-1)+"}"},e.prototype.keyframe=function(e){var t=e.declarations;return this.indent()+e.values.join(", ")+" {\n"+this.indent(1)+t.map(this.visit,this).join("\n")+this.indent(-1)+"\n"+this.indent()+"}\n"},e.prototype.page=function(e){var t=e.selectors.length?e.selectors.join(", ")+" ":"";return"@page "+t+"{\n"+this.indent(1)+e.declarations.map(this.visit,this).join("\n")+this.indent(-1)+"\n}"},e.prototype.rule=function(e){var t=this.indent(),n=e.declarations;return n.length?e.selectors.map(function(e){return t+e}).join(",\n")+" {\n"+this.indent(1)+n.map(this.visit,this).join("\n")+this.indent(-1)+"\n"+this.indent()+"}":""},e.prototype.declaration=function(e){return this.indent()+e.property+": "+e.value+";"},e.prototype.indent=function(e){return this.level=this.level||1,null!=e?(this.level+=e,""):Array(this.level).join(this.indentation||"  ")},e}(),function(e,t){t=t||{};var n=t.compress?new Compressed(t):new Identity(t);return n.compile(e)}}),function(){define("messages/handlers/style_register",["css-parse","css-stringify"],function(e,t){var n,r,i=this;return r={},n=function(e,t){var i,s,o,u;if(!(s=e.href))return;o=e.key,i=e.files;if(r[s])return;return r[s]=!0,u=$.get(s,{dataType:"text"}),u.done(_.wrap(n.addStyle,function(e,t){return e(t,o,i)})),u.fail(function(){return r[s]=!1})},n.namespaceSelector=function(e,t){return e+" "+t},n.namespaceRules=function(e,t){var r,i,s,o,u;u=[];for(s=0,o=t.length;s<o;s++)r=t[s],r.selectors!=null?u.push(r.selectors=function(){var t,s,o,u;o=r.selectors,u=[];for(t=0,s=o.length;t<s;t++)i=o[t],u.push(n.namespaceSelector(e,i));return u}()):r.rules!=null?u.push(n.namespaceRules(e,r.rules)):u.push(void 0);return u},n.namespaceCss=function(r,i){var s;return s=e(i),n.namespaceRules(r,s.stylesheet.rules),t(s,{compress:!0})},n.rewriteAssetUrls=function(e,t){return _.each(t,function(t,n){var r;return r=new RegExp(n,"g"),e=e.replace(r,t)}),e},n.addStyle=function(e,t,r){var i,s;return s="style-"+t,i=$("style."+s),i.length<1&&(i=$("<style />").addClass(s)),e=n.rewriteAssetUrls(e,r),i.text(n.namespaceCss("."+t,e)),i.appendTo("body")},n})}.call(this),function(){define("messages/handlers/inline_catalogue_show",["views/inline_catalogue"],function(e){return function(t,n,r){var i,s=this;return i=new e,t.html(i.render().el),n(i),i.on("selectCanceled",function(){return i.remove(),r(i)})}})}.call(this),function(){define("messages/handlers/parent_notify",[],function(){return function(e){return window.parent.postMessage(JSON.stringify(e),"*")}})}.call(this),function(){define("messages/handlers/metrics/ga",[],function(){var e,t,n;return n=n||[],n.push(["_setAccount","UA-34216821-1"]),n.push(["_setDomainName","versal.com"]),n.push(["_trackPageview"]),e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t),function(e,t,r){return n.push(["_trackEvent",e,t,JSON.stringify(r)])}})}.call(this),function(){define("messages/handlers/metrics/versal_analytics",["cdn.jquery"],function(e){var t,n,r=this;return t=[],n=_.throttle(function(){return e.ajax({type:"POST",url:"//stack.versal.com/stats/track",contentType:"application/json",data:JSON.stringify(t)}),t=[]},2e4),function(e,r,i,s){return s==null&&(s="counter"),t.push({category:e,action:r,data:i,eventType:s}),n()}})}.call(this),function(){define("messages/handlers/metric_record",["./metrics/ga","./metrics/versal_analytics"],function(e,t){var n;return n=function(){return e.apply(this,arguments),t.apply(this,arguments)},window.onerror=function(e,t,r){return n("Error",e,{url:t,line:r})},n})}.call(this),function(){define("messages/decorate",["app/mediator","messages/handlers/asset_select","messages/handlers/style_register","messages/handlers/inline_catalogue_show","messages/handlers/parent_notify","messages/handlers/metric_record"],function(e,t,n,r,i,s){var o;return o={"asset:select":t,"style:register":n,"inlineCatalogue:show":r,"parent:notify":i,"metric:record":s},_.each(o,function(t,n){return e.on(n,t,e)})})}.call(this),function(){var e,t,n;(function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),w=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n.apply(a[e],g);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!w)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("libs/almond",function(){}),n("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),n("text!styles/main.css",[],function(){return".character-count.hidden{display:none}\n.character-count{display:visible}\n.character-count-over{color:#f00}\n"}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};n("editable_text",["text!styles/main.css"],function(t){var n,r,i;return r=[],i=function(e){var t,n;return t=document.createRange(),t.selectNodeContents(e),n=window.getSelection(),n.removeAllRanges(),n.addRange(t),e.focus()},$("<style />").text(t).appendTo("body"),n=function(){function t(t){this.onFocus=e(this.onFocus,this),this.onBlur=e(this.onBlur,this),this.onKeyUp=e(this.onKeyUp,this),this.onKeyPress=e(this.onKeyPress,this),this.onKeyDown=e(this.onKeyDown,this),r.push(this),this.options=_.defaults(t,_.result(this,"defaults")),this.$el=this.options.el,this.$el.attr("contenteditable",!1),this.$el.addClass("vs-ui-editable-text"),this._isEditing=!1,this.options.charCount&&this.attachCharacterCount(this.options.charCount),this.$el.on("blur",this.onBlur),this.$el.on("focus",this.onFocus),this.$el.on("keyup",this.onKeyUp),this.$el.on("keydown",this.onKeyDown),this.$el.on("keypress",this.onKeyPress)}return t.prototype.defaults=function(){return{el:$("<div>"),type:"input",charCount:0,success:function(){},abort:function(){},complete:function(){},maxlength:!1}},t.prototype.onKeyDown=function(e){e.keyCode===13&&this.options.type==="input"&&(e.preventDefault(),this.success(),this.$el.blur());if(e.keyCode===27)return e.preventDefault(),this.setText(this._oldContent),this.abort()},t.prototype.onKeyPress=function(e){var t,n,r;t=e.originalEvent,r=!!(t.char||t.charCode&&String.fromCharCode(t.charCode)),n=this.getPretty().length;if(this.options.maxlength&&n>=this.options.maxlength&&r)return e.preventDefault()},t.prototype.onKeyUp=function(e){var t;return t=this.getPretty().length,this.options.maxlength&&t>this.options.maxlength&&this.setText(this.getPretty().slice(0,this.options.maxlength)),!t&&e.keyCode!==13&&this.$el.empty(),this.setCurrentCount(t)},t.prototype.onBlur=function(){return this.success(),this.hideCharCount()},t.prototype.onFocus=function(){return this.showCharCount()},t.prototype.selectText=function(){var e=this;return _.defer(function(){return i(e.$el[0])})},t.prototype.toggleEdit=function(e,t){var n,s=this;t==null&&(t=!0),n=_.isBoolean(e);if(n&&e===this._isEditing)return;return this._isEditing=n?e:!this._isEditing,this._isEditing?(this.$el.attr("contenteditable",!0),t?_.defer(function(){return i(s.$el[0])}):this.hideCharCount(),this._oldContent=this.getPretty(),_.each(r,function(e){if(s!==e&&e._isEditing)return e.abort()})):this.$el.attr("contenteditable",!1)},t.prototype.setText=function(e){if(!e)return;return this.$el.text(e),this.$el.html(this.$el.html().replace(/\n/gi,"<br>"))},t.prototype.getPretty=function(){var e;return e=$.trim(this.$el.html().replace(/\n/gi,"").replace(/<div><br><\/div>/gi,"\n").replace(/<div>/gi,"\n").replace(/<\/div>/gi,"").replace(/<br>/gi,"\n").replace(/\&nbsp\;/gi," ")),$("<div>").html(e).text()},t.prototype.attachCharacterCount=function(e){var t;return this.count=e,t='<div class="character-count pull-right">'+this.getPretty().length+"/"+this.count+"</div>",this.charCount=$(t),this.$el.after(this.charCount)},t.prototype.setCurrentCount=function(e){if(this.charCount){this.charCount.text(e+"/"+this.count);if(e>this.count&&!this._errorSet)return this._errorSet=!0,this.charCount.addClass("character-count-over");if(e<=this.count&&this._errorSet)return this._errorSet=!1,this.charCount.removeClass("character-count-over")}},t.prototype.showCharCount=function(){if(this.charCount)return this.charCount.removeClass("hidden")},t.prototype.hideCharCount=function(){if(this.charCount)return this.charCount.addClass("hidden")},t.prototype.abort=function(){return this.options.abort(),this.options.complete("abort")},t.prototype.success=function(){return this.options.success(this.getPretty()),this.options.complete("success")},t}()})}.call(this),function(){n("loading",[],function(){var e;return e=function(){function e(e){var t,n;this.$parent=e,n=this.$parent.position(),t=$('<div class="loading">Loading</div>').css({top:n.top,left:n.left,position:"absolute"}),this.$el=t.appendTo(this.$parent)}return e.prototype.done=function(){return this.$el.remove()},e}()})}.call(this),n("spin",[],function(){return function(){function r(e,t){var n=document.createElement(e||"div"),r;for(r in t)n[r]=t[r];return n}function i(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function o(e,r,i,o){var u=["opacity",r,~~(e*100),i,o].join("-"),a=.01+i/o*100,f=Math.max(1-(1-e)/r*(100-a),e),l=n.substring(0,n.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return t[u]||(s.insertRule("@"+c+"keyframes "+u+"{"+"0%{opacity:"+f+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+r)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",s.cssRules.length),t[u]=1),u}function u(t,n){var r=t.style,i,s;if(r[n]!==undefined)return n;n=n.charAt(0).toUpperCase()+n.slice(1);for(s=0;s<e.length;s++){i=e[s]+n;if(r[i]!==undefined)return i}}function a(e,t){for(var n in t)e.style[u(e,n)||n]=t[n];return e}function f(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]===undefined&&(e[r]=n[r])}return e}function l(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function h(e){if(typeof this=="undefined")return new h(e);this.opts=f(e||{},h.defaults,c)}function p(){function e(e,t){return r("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}s.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(t,n){function o(){return a(e("group",{coordsize:s+" "+s,coordorigin:-r+" "+ -r}),{width:s,height:s})}function c(t,s,u){i(f,i(a(o(),{rotation:360/n.lines*t+"deg",left:~~s}),i(a(e("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:u}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,s=2*r,u=-(n.width+n.length)*2+"px",f=a(o(),{position:"absolute",top:u,left:u}),l;if(n.shadow)for(l=1;l<=n.lines;l++)c(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=n.lines;l++)c(l);return i(t,f)},h.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var e=["webkit","Moz","ms","O"],t={},n,s=function(){var e=r("style",{type:"text/css"});return i(document.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),c={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};h.defaults={},f(h.prototype,{spin:function(e){this.stop();var t=this,i=t.opts,s=t.el=a(r(0,{className:i.className}),{position:i.position,width:0,zIndex:i.zIndex}),o=i.radius+i.length+i.width,u,f;e&&(e.insertBefore(s,e.firstChild||null),f=l(e),u=l(s),a(s,{left:(i.left=="auto"?f.x-u.x+(e.offsetWidth>>1):parseInt(i.left,10)+o)+"px",top:(i.top=="auto"?f.y-u.y+(e.offsetHeight>>1):parseInt(i.top,10)+o)+"px"})),s.setAttribute("role","progressbar"),t.lines(s,t.opts);if(!n){var c=0,h=(i.lines-1)*(1-i.direction)/2,p,d=i.fps,v=d/i.speed,m=(1-i.opacity)/(v*i.trail/100),g=v/i.lines;(function y(){c++;for(var e=0;e<i.lines;e++)p=Math.max(1-(c+(i.lines-e)*g)%v*m,i.opacity),t.opacity(s,e*i.direction+h,p,i);t.timeout=t.el&&setTimeout(y,~~(1e3/d))})()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=undefined),this},lines:function(e,t){function l(e,n){return a(r(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*s+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var s=0,u=(t.lines-1)*(1-t.direction)/2,f;for(;s<t.lines;s++)f=a(r(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:n&&o(t.opacity,t.trail,u+s*t.direction,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&i(f,a(l("#000","0 0 4px #000"),{top:"2px"})),i(e,i(f,l(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}});var d=a(r("group"),{behavior:"url(#default#VML)"});return!u(d,"transform")&&d.adj?p():n=u(d,"animation"),h}()}),function(){n("loading_indicator",["spin"],function(e){var t;return t=function(){function t(t,n){var r;n==null&&(n="#000"),r={lines:15,length:2,width:2,radius:8,corners:.4,rotate:0,direction:1,color:n,speed:.8,trail:46,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},t instanceof $&&(t=t[0]),this.spinner=(new e(r)).spin(t)}return t.prototype.stop=function(){return this.spinner.stop()},t}()})}.call(this),function(e){var t=!1,n=!1,r=5e3,i=2e3,s=0,o=function(){var e=document.getElementsByTagName("script"),e=e[e.length-1].src.split("?")[0];return 0<e.split("/").length?e.split("/").slice(0,-1).join("/")+"/":""}(),u=["ms","moz","webkit","o"],f=window.requestAnimationFrame||!1,l=window.cancelAnimationFrame||!1;if(!f)for(var c in u){var h=u[c];f||(f=window[h+"RequestAnimationFrame"]),l||(l=window[h+"CancelAnimationFrame"]||window[h+"CancelRequestAnimationFrame"])}var p=window.MutationObserver||window.WebKitMutationObserver||!1,d={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:!1,cursordragontouch:!1,oneaxismousemode:"auto"},v=!1,m=function(){if(v)return v;var e=document.createElement("DIV"),t={haspointerlock:"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document};t.isopera="opera"in window,t.isopera12=t.isopera&&"getUserMedia"in navigator,t.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),t.isie="all"in document&&"attachEvent"in e&&!t.isopera,t.isieold=t.isie&&!("msInterpolationMode"in e.style),t.isie7=t.isie&&!t.isieold&&(!("documentMode"in document)||7==document.documentMode),t.isie8=t.isie&&"documentMode"in document&&8==document.documentMode,t.isie9=t.isie&&"performance"in window&&9<=document.documentMode,t.isie10=t.isie&&"performance"in window&&10<=document.documentMode,t.isie9mobile=/iemobile.9/i.test(navigator.userAgent),t.isie9mobile&&(t.isie9=!1),t.isie7mobile=!t.isie9mobile&&t.isie7&&/iemobile/i.test(navigator.userAgent),t.ismozilla="MozAppearance"in e.style,t.iswebkit="WebkitAppearance"in e.style,t.ischrome="chrome"in window,t.ischrome22=t.ischrome&&t.haspointerlock,t.ischrome26=t.ischrome&&"transition"in e.style,t.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,t.hasmstouch=window.navigator.msPointerEnabled||!1,t.ismac=/^mac$/i.test(navigator.platform),t.isios=t.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform),t.isios4=t.isios&&!("seal"in Object),t.isandroid=/android/i.test(navigator.userAgent),t.trstyle=!1,t.hastransform=!1,t.hastranslate3d=!1,t.transitionstyle=!1,t.hastransition=!1,t.transitionend=!1;for(var n=["transform","msTransform","webkitTransform","MozTransform","OTransform"],r=0;r<n.length;r++)if("undefined"!=typeof e.style[n[r]]){t.trstyle=n[r];break}t.hastransform=0!=t.trstyle,t.hastransform&&(e.style[t.trstyle]="translate3d(1px,2px,3px)",t.hastranslate3d=/translate3d/.test(e.style[t.trstyle])),t.transitionstyle=!1,t.prefixstyle="",t.transitionend=!1;for(var n="transition webkitTransition MozTransition OTransition OTransition msTransition KhtmlTransition".split(" "),i=" -webkit- -moz- -o- -o -ms- -khtml-".split(" "),s="transitionend webkitTransitionEnd transitionend otransitionend oTransitionEnd msTransitionEnd KhtmlTransitionEnd".split(" "),r=0;r<n.length;r++)if(n[r]in e.style){t.transitionstyle=n[r],t.prefixstyle=i[r],t.transitionend=s[r];break}t.ischrome26&&(t.prefixstyle=i[1]),t.hastransition=t.transitionstyle;e:{n=["-moz-grab","-webkit-grab","grab"];if(t.ischrome&&!t.ischrome22||t.isie)n=[];for(r=0;r<n.length;r++)if(i=n[r],e.style.cursor=i,e.style.cursor==i){n=i;break e}n="url(http://www.google.com/intl/en_ALL/mapfiles/openhand.cur),n-resize"}return t.cursorgrabvalue=n,t.hasmousecapture="setCapture"in e,t.hasMutationObserver=!1!==p,v=t},g=function(u,a){function c(){var e=b.win;if("zIndex"in e)return e.zIndex();for(;0<e.length&&9!=e[0].nodeType;){var t=e.css("zIndex");if(!isNaN(t)&&0!=t)return parseInt(t);e=e.parent()}return!1}function h(e,t,n){return t=e.css(t),e=parseFloat(t),isNaN(e)?(e=x[t]||0,n=3==e?n?b.win.outerHeight()-b.win.innerHeight():b.win.outerWidth()-b.win.innerWidth():1,b.isie8&&e&&(e+=1),n?e:0):e}function v(e,t,n,r){b._bind(e,t,function(r){r=r?r:window.event;var i={original:r,target:r.target||r.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==r.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return r.preventDefault?r.preventDefault():r.returnValue=!1,!1},stopImmediatePropagation:function(){r.stopImmediatePropagation?r.stopImmediatePropagation():r.cancelBubble=!0}};return"mousewheel"==t?(i.deltaY=-0.025*r.wheelDelta,r.wheelDeltaX&&(i.deltaX=-0.025*r.wheelDeltaX)):i.deltaY=r.detail,n.call(e,i)},r)}function g(e,t,n){var r,i;0==e.deltaMode?(r=-Math.floor(e.deltaX*(b.opt.mousescrollstep/54)),i=-Math.floor(e.deltaY*(b.opt.mousescrollstep/54))):1==e.deltaMode&&(r=-Math.floor(e.deltaX*b.opt.mousescrollstep),i=-Math.floor(e.deltaY*b.opt.mousescrollstep)),t&&b.opt.oneaxismousemode&&0==r&&i&&(r=i,i=0),r&&(b.scrollmom&&b.scrollmom.stop(),b.lastdeltax+=r,b.debounced("mousewheelx",function(){var e=b.lastdeltax;b.lastdeltax=0,b.rail.drag||b.doScrollLeftBy(e)},120));if(i){if(b.opt.nativeparentscrolling&&n&&!b.ispage&&!b.zoomactive)if(0>i){if(b.getScrollTop()>=b.page.maxh)return!0}else if(0>=b.getScrollTop())return!0;b.scrollmom&&b.scrollmom.stop(),b.lastdeltay+=i,b.debounced("mousewheely",function(){var e=b.lastdeltay;b.lastdeltay=0,b.rail.drag||b.doScrollBy(e)},120)}return e.stopImmediatePropagation(),e.preventDefault()}var b=this;this.version="3.5.2",this.name="nicescroll",this.me=a,this.opt={doc:e("body"),win:!1},e.extend(this.opt,d),this.opt.snapbackspeed=80;if(u)for(var w in b.opt)"undefined"!=typeof u[w]&&(b.opt[w]=u[w]);this.iddoc=(this.doc=b.opt.doc)&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/BODY|HTML/.test(b.opt.win?b.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==b.opt.win,this.win=b.opt.win||(this.ispage?e(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?e(window):this.win,this.body=e("body"),this.iframe=this.isfixed=this.viewport=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=b.opt.autohidemode,this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart=this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.observerremover=this.observer=this.scrollmom=this.scrollrunning=this.checkrtlmode=!1;do this.id="ascrail"+i++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.selectiondrag=this.cursorfreezed=this.cursor=this.rail=!1,this.visibility=!0,this.hidden=this.locked=!1,this.cursoractive=!0,this.overflowx=b.opt.overflowx,this.overflowy=b.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltay=this.lastdeltax=0,this.detected=m();var E=e.extend({},this.detected);this.ishwscroll=(this.canhwscroll=E.hastransform&&b.opt.hwacceleration)&&b.haswrapper,this.istouchcapable=!1,E.cantouch&&E.ischrome&&!E.isios&&!E.isandroid&&(this.istouchcapable=!0,E.cantouch=!1),E.cantouch&&E.ismozilla&&!E.isios&&!E.isandroid&&(this.istouchcapable=!0,E.cantouch=!1),b.opt.enablemouselockapi||(E.hasmousecapture=!1,E.haspointerlock=!1),this.delayed=function(e,t,n,r){var i=b.delaylist[e],s=(new Date).getTime();if(!r&&i&&i.tt)return!1;i&&i.tt&&clearTimeout(i.tt),i&&i.last+n>s&&!i.tt?b.delaylist[e]={last:s+n,tt:setTimeout(function(){b.delaylist[e].tt=0,t.call()},n)}:i&&i.tt||(b.delaylist[e]={last:s,tt:0},setTimeout(function(){t.call()},0))},this.debounced=function(e,t,n){var r=b.delaylist[e];(new Date).getTime(),b.delaylist[e]=t,r||setTimeout(function(){var t=b.delaylist[e];b.delaylist[e]=!1,t.call()},n)},this.synched=function(e,t){return b.synclist[e]=t,function(){b.onsync||(f(function(){b.onsync=!1;for(e in b.synclist){var t=b.synclist[e];t&&t.call(b),b.synclist[e]=!1}}),b.onsync=!0)}(),e},this.unsynched=function(e){b.synclist[e]&&(b.synclist[e]=!1)},this.css=function(e,t){for(var n in t)b.saved.css.push([e,n,e.css(n)]),e.css(n,t[n])},this.scrollTop=function(e){return"undefined"==typeof e?b.getScrollTop():b.setScrollTop(e)},this.scrollLeft=function(e){return"undefined"==typeof e?b.getScrollLeft():b.setScrollLeft(e)},BezierClass=function(e,t,n,r,i,s,o){this.st=e,this.ed=t,this.spd=n,this.p1=r||0,this.p2=i||1,this.p3=s||0,this.p4=o||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st},BezierClass.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=1-((new Date).getTime()-this.ts)/this.spd,t=this.B2(e)+this.B3(e)+this.B4(e);return 0>e?this.ed:this.st+Math.round(this.df*t)},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}};if(this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},E.hastranslate3d&&E.isios&&this.doc.css("-webkit-backface-visibility","hidden");var S=function(){var e=b.doc.css(E.trstyle);return e&&"matrix"==e.substr(0,6)?e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/):!1};this.getScrollTop=function(e){if(!e){if(e=S())return 16==e.length?-e[13]:-e[5];if(b.timerscroll&&b.timerscroll.bz)return b.timerscroll.bz.getNow()}return b.doc.translate.y},this.getScrollLeft=function(e){if(!e){if(e=S())return 16==e.length?-e[12]:-e[4];if(b.timerscroll&&b.timerscroll.bh)return b.timerscroll.bh.getNow()}return b.doc.translate.x},this.notifyScrollEvent=document.createEvent?function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),e.dispatchEvent(t)}:document.fireEvent?function(e){var t=document.createEventObject();e.fireEvent("onscroll"),t.cancelBubble=!0}:function(e,t){},E.hastranslate3d&&b.opt.enabletranslate3d?(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=-1*e+"px",b.doc.css(E.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=-1*e+"px",b.doc.css(E.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])}):(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=-1*e+"px",b.doc.css(E.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=-1*e+"px",b.doc.css(E.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])})}else this.getScrollTop=function(){return b.docscroll.scrollTop()},this.setScrollTop=function(e){return b.docscroll.scrollTop(e)},this.getScrollLeft=function(){return b.docscroll.scrollLeft()},this.setScrollLeft=function(e){return b.docscroll.scrollLeft(e)};this.getTarget=function(e){return e?e.target?e.target:e.srcElement?e.srcElement:!1:!1},this.hasParent=function(e,t){if(!e)return!1;for(var n=e.target||e.srcElement||e||!1;n&&n.id!=t;)n=n.parentNode||!1;return!1!==n};var x={thin:1,medium:3,thick:5};this.getOffset=function(){if(b.isfixed)return{top:parseFloat(b.win.css("top")),left:parseFloat(b.win.css("left"))};if(!b.viewport)return b.win.offset();var e=b.win.offset(),t=b.viewport.offset();return{top:e.top-t.top+b.viewport.scrollTop(),left:e.left-t.left+b.viewport.scrollLeft()}},this.updateScrollBar=function(e){if(b.ishwscroll)b.rail.css({height:b.win.innerHeight()}),b.railh&&b.railh.css({width:b.win.innerWidth()});else{var t=b.getOffset(),n=t.top,r=t.left,n=n+h(b.win,"border-top-width",!0);b.win.outerWidth(),b.win.innerWidth();var r=r+(b.rail.align?b.win.outerWidth()-h(b.win,"border-right-width")-b.rail.width:h(b.win,"border-left-width")),i=b.opt.railoffset;i&&(i.top&&(n+=i.top),b.rail.align&&i.left&&(r+=i.left)),b.locked||b.rail.css({top:n,left:r,height:e?e.h:b.win.innerHeight()}),b.zoom&&b.zoom.css({top:n+1,left:1==b.rail.align?r-20:r+b.rail.width+4}),b.railh&&!b.locked&&(n=t.top,r=t.left,e=b.railh.align?n+h(b.win,"border-top-width",!0)+b.win.innerHeight()-b.railh.height:n+h(b.win,"border-top-width",!0),r+=h(b.win,"border-left-width"),b.railh.css({top:e,left:r,width:b.railh.width}))}},this.doRailClick=function(e,t,n){var r;b.locked||(b.cancelEvent(e),t?(t=n?b.doScrollLeft:b.doScrollTop,r=n?(e.pageX-b.railh.offset().left-b.cursorwidth/2)*b.scrollratio.x:(e.pageY-b.rail.offset().top-b.cursorheight/2)*b.scrollratio.y,t(r)):(t=n?b.doScrollLeftBy:b.doScrollBy,r=n?b.scroll.x:b.scroll.y,e=n?e.pageX-b.railh.offset().left:e.pageY-b.rail.offset().top,n=n?b.view.w:b.view.h,r>=e?t(n):t(-n)))},b.hasanimationframe=f,b.hascancelanimationframe=l,b.hasanimationframe?b.hascancelanimationframe||(l=function(){b.cancelAnimationFrame=!0}):(f=function(e){return setTimeout(e,15-Math.floor(+(new Date)/1e3)%16)},l=clearInterval),this.init=function(){b.saved.css=[];if(E.isie7mobile||E.isoperamini)return!0;E.hasmstouch&&b.css(b.ispage?e("html"):b.win,{"-ms-touch-action":"none"}),b.zindex="auto",b.zindex=b.ispage||"auto"!=b.opt.zindex?b.opt.zindex:c()||"auto",!b.ispage&&"auto"!=b.zindex&&b.zindex>s&&(s=b.zindex),b.isie&&0==b.zindex&&"auto"==b.opt.zindex&&(b.zindex="auto");if(!b.ispage||!E.cantouch&&!E.isieold&&!E.isie9mobile){var i=b.docscroll;b.ispage&&(i=b.haswrapper?b.win:b.doc),E.isie9mobile||b.css(i,{"overflow-y":"hidden"}),b.ispage&&E.isie7&&("BODY"==b.doc[0].nodeName?b.css(e("html"),{"overflow-y":"hidden"}):"HTML"==b.doc[0].nodeName&&b.css(e("body"),{"overflow-y":"hidden"})),!E.isios||b.ispage||b.haswrapper||b.css(e("body"),{"-webkit-overflow-scrolling":"touch"});var u=e(document.createElement("div"));u.css({position:"relative",top:0,"float":"right",width:b.opt.cursorwidth,height:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),u.hborder=parseFloat(u.outerHeight()-u.innerHeight()),b.cursor=u;var a=e(document.createElement("div"));a.attr("id",b.id),a.addClass("nicescroll-rails");var f,l,h=["left","right"],d;for(d in h)l=h[d],(f=b.opt.railpadding[l])?a.css("padding-"+l,f+"px"):b.opt.railpadding[l]=0;a.append(u),a.width=Math.max(parseFloat(b.opt.cursorwidth),u.outerWidth())+b.opt.railpadding.left+b.opt.railpadding.right,a.css({width:a.width+"px",zIndex:b.zindex,background:b.opt.background,cursor:"default"}),a.visibility=!0,a.scrollable=!0,a.align="left"==b.opt.railalign?0:1,b.rail=a,u=b.rail.drag=!1,!b.opt.boxzoom||b.ispage||E.isieold||(u=document.createElement("div"),b.bind(u,"click",b.doZoom),b.zoom=e(u),b.zoom.css({cursor:"pointer","z-index":b.zindex,backgroundImage:"url("+o+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),b.opt.dblclickzoom&&b.bind(b.win,"dblclick",b.doZoom),E.cantouch&&b.opt.gesturezoom&&(b.ongesturezoom=function(e){return 1.5<e.scale&&b.doZoomIn(e),.8>e.scale&&b.doZoomOut(e),b.cancelEvent(e)},b.bind(b.win,"gestureend",b.ongesturezoom))),b.railh=!1;if(b.opt.horizrailenabled){b.css(i,{"overflow-x":"hidden"}),u=e(document.createElement("div")),u.css({position:"relative",top:0,height:b.opt.cursorwidth,width:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),u.wborder=parseFloat(u.outerWidth()-u.innerWidth()),b.cursorh=u;var v=e(document.createElement("div"));v.attr("id",b.id+"-hr"),v.addClass("nicescroll-rails"),v.height=Math.max(parseFloat(b.opt.cursorwidth),u.outerHeight()),v.css({height:v.height+"px",zIndex:b.zindex,background:b.opt.background}),v.append(u),v.visibility=!0,v.scrollable=!0,v.align="top"==b.opt.railvalign?0:1,b.railh=v,b.railh.drag=!1}b.ispage?(a.css({position:"fixed",top:"0px",height:"100%"}),a.align?a.css({right:"0px"}):a.css({left:"0px"}),b.body.append(a),b.railh&&(v.css({position:"fixed",left:"0px",width:"100%"}),v.align?v.css({bottom:"0px"}):v.css({top:"0px"}),b.body.append(v))):(b.ishwscroll?("static"==b.win.css("position")&&b.css(b.win,{position:"relative"}),i="HTML"==b.win[0].nodeName?b.body:b.win,b.zoom&&(b.zoom.css({position:"absolute",top:1,right:0,"margin-right":a.width+4}),i.append(b.zoom)),a.css({position:"absolute",top:0}),a.align?a.css({right:0}):a.css({left:0}),i.append(a),v&&(v.css({position:"absolute",left:0,bottom:0}),v.align?v.css({bottom:0}):v.css({top:0}),i.append(v))):(b.isfixed="fixed"==b.win.css("position"),i=b.isfixed?"fixed":"absolute",b.isfixed||(b.viewport=b.getViewport(b.win[0])),b.viewport&&(b.body=b.viewport,0==/fixed|relative|absolute/.test(b.viewport.css("position"))&&b.css(b.viewport,{position:"relative"})),a.css({position:i}),b.zoom&&b.zoom.css({position:i}),b.updateScrollBar(),b.body.append(a),b.zoom&&b.body.append(b.zoom),b.railh&&(v.css({position:i}),b.body.append(v))),E.isios&&b.css(b.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),E.isie&&b.opt.disableoutline&&b.win.attr("hideFocus","true"),E.iswebkit&&b.opt.disableoutline&&b.win.css({outline:"none"})),!1===b.opt.autohidemode?(b.autohidedom=!1,b.rail.css({opacity:b.opt.cursoropacitymax}),b.railh&&b.railh.css({opacity:b.opt.cursoropacitymax})):!0===b.opt.autohidemode||"leave"===b.opt.autohidemode?(b.autohidedom=e().add(b.rail),E.isie8&&(b.autohidedom=b.autohidedom.add(b.cursor)),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh)),b.railh&&E.isie8&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"scroll"==b.opt.autohidemode?(b.autohidedom=e().add(b.rail),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh))):"cursor"==b.opt.autohidemode?(b.autohidedom=e().add(b.cursor),b.railh&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"hidden"==b.opt.autohidemode&&(b.autohidedom=!1,b.hide(),b.locked=!1);if(E.isie9mobile)b.scrollmom=new y(b),b.onmangotouch=function(e){e=b.getScrollTop();var t=b.getScrollLeft();if(e==b.scrollmom.lastscrolly&&t==b.scrollmom.lastscrollx)return!0;var n=e-b.mangotouch.sy,r=t-b.mangotouch.sx;if(0!=Math.round(Math.sqrt(Math.pow(r,2)+Math.pow(n,2)))){var i=0>n?-1:1,s=0>r?-1:1,o=+(new Date);b.mangotouch.lazy&&clearTimeout(b.mangotouch.lazy),80<o-b.mangotouch.tm||b.mangotouch.dry!=i||b.mangotouch.drx!=s?(b.scrollmom.stop(),b.scrollmom.reset(t,e),b.mangotouch.sy=e,b.mangotouch.ly=e,b.mangotouch.sx=t,b.mangotouch.lx=t,b.mangotouch.dry=i,b.mangotouch.drx=s,b.mangotouch.tm=o):(b.scrollmom.stop(),b.scrollmom.update(b.mangotouch.sx-r,b.mangotouch.sy-n),b.mangotouch.tm=o,n=Math.max(Math.abs(b.mangotouch.ly-e),Math.abs(b.mangotouch.lx-t)),b.mangotouch.ly=e,b.mangotouch.lx=t,2<n&&(b.mangotouch.lazy=setTimeout(function(){b.mangotouch.lazy=!1,b.mangotouch.dry=0,b.mangotouch.drx=0,b.mangotouch.tm=0,b.scrollmom.doMomentum(30)},100)))}},a=b.getScrollTop(),v=b.getScrollLeft(),b.mangotouch={sy:a,ly:a,dry:0,sx:v,lx:v,drx:0,lazy:!1,tm:0},b.bind(b.docscroll,"scroll",b.onmangotouch);else{if(E.cantouch||b.istouchcapable||b.opt.touchbehavior||E.hasmstouch){b.scrollmom=new y(b),b.ontouchstart=function(t){if(t.pointerType&&2!=t.pointerType)return!1;b.hasmoving=!1;if(!b.locked){if(E.hasmstouch)for(var n=t.target?t.target:!1;n;){var r=e(n).getNiceScroll();if(0<r.length&&r[0].me==b.me)break;if(0<r.length)return!1;if("DIV"==n.nodeName&&n.id==b.id)break;n=n.parentNode?n.parentNode:!1}b.cancelScroll();if((n=b.getTarget(t))&&/INPUT/i.test(n.nodeName)&&/range/i.test(n.type))return b.stopPropagation(t);!("clientX"in t)&&"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),b.forcescreen&&(r=t,t={original:t.original?t.original:t},t.clientX=r.screenX,t.clientY=r.screenY),b.rail.drag={x:t.clientX,y:t.clientY,sx:b.scroll.x,sy:b.scroll.y,st:b.getScrollTop(),sl:b.getScrollLeft(),pt:2,dl:!1};if(b.ispage||!b.opt.directionlockdeadzone)b.rail.drag.dl="f";else{var r=e(window).width(),i=e(window).height(),s=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),o=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),i=Math.max(0,o-i),r=Math.max(0,s-r);b.rail.drag.ck=!b.rail.scrollable&&b.railh.scrollable?0<i?"v":!1:b.rail.scrollable&&!b.railh.scrollable?0<r?"h":!1:!1,b.rail.drag.ck||(b.rail.drag.dl="f")}b.opt.touchbehavior&&b.isiframe&&E.isie&&(r=b.win.position(),b.rail.drag.x+=r.left,b.rail.drag.y+=r.top),b.hasmoving=!1,b.lastmouseup=!1,b.scrollmom.reset(t.clientX,t.clientY);if(!E.cantouch&&!this.istouchcapable&&!E.hasmstouch){if(!n||!/INPUT|SELECT|TEXTAREA/i.test(n.nodeName))return!b.ispage&&E.hasmousecapture&&n.setCapture(),b.opt.touchbehavior?(n.onclick&&!n._onclick&&(n._onclick=n.onclick,n.onclick=function(e){if(b.hasmoving)return!1;n._onclick.call(this,e)}),b.cancelEvent(t)):b.stopPropagation(t);/SUBMIT|CANCEL|BUTTON/i.test(e(n).attr("type"))&&(pc={tg:n,click:!1},b.preventclick=pc)}}},b.ontouchend=function(e){if(e.pointerType&&2!=e.pointerType)return!1;if(b.rail.drag&&2==b.rail.drag.pt&&(b.scrollmom.doMomentum(),b.rail.drag=!1,b.hasmoving&&(b.lastmouseup=!0,b.hideCursor(),E.hasmousecapture&&document.releaseCapture(),!E.cantouch)))return b.cancelEvent(e)};var m=b.opt.touchbehavior&&b.isiframe&&!E.hasmousecapture;b.ontouchmove=function(t,n){if(t.pointerType&&2!=t.pointerType)return!1;if(b.rail.drag&&2==b.rail.drag.pt){if(E.cantouch&&"undefined"==typeof t.original)return!0;b.hasmoving=!0,b.preventclick&&!b.preventclick.click&&(b.preventclick.click=b.preventclick.tg.onclick||!1,b.preventclick.tg.onclick=b.onpreventclick),t=e.extend({original:t},t),"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY);if(b.forcescreen){var r=t;t={original:t.original?t.original:t},t.clientX=r.screenX,t.clientY=r.screenY}r=ofy=0;if(m&&!n){var i=b.win.position(),r=-i.left;ofy=-i.top}var s=t.clientY+ofy,i=s-b.rail.drag.y,o=t.clientX+r,u=o-b.rail.drag.x,a=b.rail.drag.st-i;b.ishwscroll&&b.opt.bouncescroll?0>a?a=Math.round(a/2):a>b.page.maxh&&(a=b.page.maxh+Math.round((a-b.page.maxh)/2)):(0>a&&(s=a=0),a>b.page.maxh&&(a=b.page.maxh,s=0));if(b.railh&&b.railh.scrollable){var f=b.rail.drag.sl-u;b.ishwscroll&&b.opt.bouncescroll?0>f?f=Math.round(f/2):f>b.page.maxw&&(f=b.page.maxw+Math.round((f-b.page.maxw)/2)):(0>f&&(o=f=0),f>b.page.maxw&&(f=b.page.maxw,o=0))}r=!1;if(b.rail.drag.dl)r=!0,"v"==b.rail.drag.dl?f=b.rail.drag.sl:"h"==b.rail.drag.dl&&(a=b.rail.drag.st);else{var i=Math.abs(i),u=Math.abs(u),l=b.opt.directionlockdeadzone;if("v"==b.rail.drag.ck){if(i>l&&u<=.3*i)return b.rail.drag=!1,!0;u>l&&(b.rail.drag.dl="f",e("body").scrollTop(e("body").scrollTop()))}else if("h"==b.rail.drag.ck){if(u>l&&i<=.3*u)return b.rail.drag=!1,!0;i>l&&(b.rail.drag.dl="f",e("body").scrollLeft(e("body").scrollLeft()))}}b.synched("touchmove",function(){b.rail.drag&&2==b.rail.drag.pt&&(b.prepareTransition&&b.prepareTransition(0),b.rail.scrollable&&b.setScrollTop(a),b.scrollmom.update(o,s),b.railh&&b.railh.scrollable?(b.setScrollLeft(f),b.showCursor(a,f)):b.showCursor(a),E.isie10&&document.selection.clear())}),E.ischrome&&b.istouchcapable&&(r=!1);if(r)return b.cancelEvent(t)}}}b.onmousedown=function(e,t){if(!b.rail.drag||1==b.rail.drag.pt){if(b.locked)return b.cancelEvent(e);b.cancelScroll(),b.rail.drag={x:e.clientX,y:e.clientY,sx:b.scroll.x,sy:b.scroll.y,pt:1,hr:!!t};var n=b.getTarget(e);return!b.ispage&&E.hasmousecapture&&n.setCapture(),b.isiframe&&!E.hasmousecapture&&(b.saved.csspointerevents=b.doc.css("pointer-events"),b.css(b.doc,{"pointer-events":"none"})),b.cancelEvent(e)}},b.onmouseup=function(e){if(b.rail.drag&&(E.hasmousecapture&&document.releaseCapture(),b.isiframe&&!E.hasmousecapture&&b.doc.css("pointer-events",b.saved.csspointerevents),1==b.rail.drag.pt))return b.rail.drag=!1,b.cancelEvent(e)},b.onmousemove=function(e){if(b.rail.drag&&1==b.rail.drag.pt){if(E.ischrome&&0==e.which)return b.onmouseup(e);b.cursorfreezed=!0;if(b.rail.drag.hr){b.scroll.x=b.rail.drag.sx+(e.clientX-b.rail.drag.x),0>b.scroll.x&&(b.scroll.x=0);var t=b.scrollvaluemaxw;b.scroll.x>t&&(b.scroll.x=t)}else b.scroll.y=b.rail.drag.sy+(e.clientY-b.rail.drag.y),0>b.scroll.y&&(b.scroll.y=0),t=b.scrollvaluemax,b.scroll.y>t&&(b.scroll.y=t);return b.synched("mousemove",function(){b.rail.drag&&1==b.rail.drag.pt&&(b.showCursor(),b.rail.drag.hr?b.doScrollLeft(Math.round(b.scroll.x*b.scrollratio.x),b.opt.cursordragspeed):b.doScrollTop(Math.round(b.scroll.y*b.scrollratio.y),b.opt.cursordragspeed))}),b.cancelEvent(e)}};if(E.cantouch||b.opt.touchbehavior)b.onpreventclick=function(e){if(b.preventclick)return b.preventclick.tg.onclick=b.preventclick.click,b.preventclick=!1,b.cancelEvent(e)},b.bind(b.win,"mousedown",b.ontouchstart),b.onclick=E.isios?!1:function(e){return b.lastmouseup?(b.lastmouseup=!1,b.cancelEvent(e)):!0},b.opt.grabcursorenabled&&E.cursorgrabvalue&&(b.css(b.ispage?b.doc:b.win,{cursor:E.cursorgrabvalue}),b.css(b.rail,{cursor:E.cursorgrabvalue}));else{var g=function(e){if(b.selectiondrag){if(e){var t=b.win.outerHeight();e=e.pageY-b.selectiondrag.top,0<e&&e<t&&(e=0),e>=t&&(e-=t),b.selectiondrag.df=e}0!=b.selectiondrag.df&&(b.doScrollBy(2*-Math.floor(b.selectiondrag.df/6)),b.debounced("doselectionscroll",function(){g()},50))}};b.hasTextSelected="getSelection"in document?function(){return 0<document.getSelection().rangeCount}:"selection"in document?function(){return"None"!=document.selection.type}:function(){return!1},b.onselectionstart=function(e){b.ispage||(b.selectiondrag=b.win.offset())},b.onselectionend=function(e){b.selectiondrag=!1},b.onselectiondrag=function(e){b.selectiondrag&&b.hasTextSelected()&&b.debounced("selectionscroll",function(){g(e)},250)}}E.hasmstouch&&(b.css(b.rail,{"-ms-touch-action":"none"}),b.css(b.cursor,{"-ms-touch-action":"none"}),b.bind(b.win,"MSPointerDown",b.ontouchstart),b.bind(document,"MSPointerUp",b.ontouchend),b.bind(document,"MSPointerMove",b.ontouchmove),b.bind(b.cursor,"MSGestureHold",function(e){e.preventDefault()}),b.bind(b.cursor,"contextmenu",function(e){e.preventDefault()})),this.istouchcapable&&(b.bind(b.win,"touchstart",b.ontouchstart),b.bind(document,"touchend",b.ontouchend),b.bind(document,"touchcancel",b.ontouchend),b.bind(document,"touchmove",b.ontouchmove)),b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mouseup",b.onmouseup),b.railh&&(b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.bind(b.cursorh,"mouseup",function(e){if(!b.rail.drag||2!=b.rail.drag.pt)return b.rail.drag=!1,b.hasmoving=!1,b.hideCursor(),E.hasmousecapture&&document.releaseCapture(),b.cancelEvent(e)}));if(b.opt.cursordragontouch||!E.cantouch&&!b.opt.touchbehavior)b.rail.css({cursor:"default"}),b.railh&&b.railh.css({cursor:"default"}),b.jqbind(b.rail,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.rail,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.rail,"click",function(e){b.doRailClick(e,!1,!1)}),b.bind(b.rail,"dblclick",function(e){b.doRailClick(e,!0,!1)}),b.bind(b.cursor,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursor,"dblclick",function(e){b.cancelEvent(e)})),b.railh&&(b.jqbind(b.railh,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.railh,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.railh,"click",function(e){b.doRailClick(e,!1,!0)}),b.bind(b.railh,"dblclick",function(e){b.doRailClick(e,!0,!0)}),b.bind(b.cursorh,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursorh,"dblclick",function(e){b.cancelEvent(e)})));E.cantouch||b.opt.touchbehavior?(b.bind(E.hasmousecapture?b.win:document,"mouseup",b.ontouchend),b.bind(document,"mousemove",b.ontouchmove),b.onclick&&b.bind(document,"click",b.onclick),b.opt.cursordragontouch&&(b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mousemove",b.onmousemove),b.cursorh&&b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.cursorh&&b.bind(b.cursorh,"mousemove",b.onmousemove))):(b.bind(E.hasmousecapture?b.win:document,"mouseup",b.onmouseup),b.bind(document,"mousemove",b.onmousemove),b.onclick&&b.bind(document,"click",b.onclick),!b.ispage&&b.opt.enablescrollonselection&&(b.bind(b.win[0],"mousedown",b.onselectionstart),b.bind(document,"mouseup",b.onselectionend),b.bind(b.cursor,"mouseup",b.onselectionend),b.cursorh&&b.bind(b.cursorh,"mouseup",b.onselectionend),b.bind(document,"mousemove",b.onselectiondrag)),b.zoom&&(b.jqbind(b.zoom,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.zoom,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}))),b.opt.enablemousewheel&&(b.isiframe||b.bind(E.isie&&b.ispage?document:b.win,"mousewheel",b.onmousewheel),b.bind(b.rail,"mousewheel",b.onmousewheel),b.railh&&b.bind(b.railh,"mousewheel",b.onmousewheelhr)),b.ispage||E.cantouch||/HTML|BODY/.test(b.win[0].nodeName)||(b.win.attr("tabindex")||b.win.attr({tabindex:r++}),b.jqbind(b.win,"focus",function(e){t=b.getTarget(e).id||!0,b.hasfocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"blur",function(e){t=!1,b.hasfocus=!1}),b.jqbind(b.win,"mouseenter",function(e){n=b.getTarget(e).id||!0,b.hasmousefocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"mouseleave",function(){n=!1,b.hasmousefocus=!1,b.rail.drag||b.hideCursor()}))}b.onkeypress=function(r){if(b.locked&&0==b.page.maxh)return!0;r=r?r:window.e;var i=b.getTarget(r);if(i&&/INPUT|TEXTAREA|SELECT|OPTION/.test(i.nodeName)&&(!i.getAttribute("type")&&!i.type||!/submit|button|cancel/i.tp)||e(i).attr("contenteditable"))return!0;if(b.hasfocus||b.hasmousefocus&&!t||b.ispage&&!t&&!n){i=r.keyCode;if(b.locked&&27!=i)return b.cancelEvent(r);var s=r.ctrlKey||!1,o=r.shiftKey||!1,u=!1;switch(i){case 38:case 63233:b.doScrollBy(72),u=!0;break;case 40:case 63235:b.doScrollBy(-72),u=!0;break;case 37:case 63232:b.railh&&(s?b.doScrollLeft(0):b.doScrollLeftBy(72),u=!0);break;case 39:case 63234:b.railh&&(s?b.doScrollLeft(b.page.maxw):b.doScrollLeftBy(-72),u=!0);break;case 33:case 63276:b.doScrollBy(b.view.h),u=!0;break;case 34:case 63277:b.doScrollBy(-b.view.h),u=!0;break;case 36:case 63273:b.railh&&s?b.doScrollPos(0,0):b.doScrollTo(0),u=!0;break;case 35:case 63275:b.railh&&s?b.doScrollPos(b.page.maxw,b.page.maxh):b.doScrollTo(b.page.maxh),u=!0;break;case 32:b.opt.spacebarenabled&&(o?b.doScrollBy(b.view.h):b.doScrollBy(-b.view.h),u=!0);break;case 27:b.zoomactive&&(b.doZoom(),u=!0)}if(u)return b.cancelEvent(r)}},b.opt.enablekeyboard&&b.bind(document,E.isopera&&!E.isopera12?"keypress":"keydown",b.onkeypress),b.bind(window,"resize",b.lazyResize),b.bind(window,"orientationchange",b.lazyResize),b.bind(window,"load",b.lazyResize);if(E.ischrome&&!b.ispage&&!b.haswrapper){var w=b.win.attr("style"),a=parseFloat(b.win.css("width"))+1;b.win.css("width",a),b.synched("chromefix",function(){b.win.attr("style",w)})}b.onAttributeChange=function(e){b.lazyResize(250)},b.ispage||b.haswrapper||(!1!==p?(b.observer=new p(function(e){e.forEach(b.onAttributeChange)}),b.observer.observe(b.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),b.observerremover=new p(function(e){e.forEach(function(e){if(0<e.removedNodes.length)for(var t in e.removedNodes)if(e.removedNodes[t]==b.win[0])return b.remove()})}),b.observerremover.observe(b.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(b.bind(b.win,E.isie&&!E.isie9?"propertychange":"DOMAttrModified",b.onAttributeChange),E.isie9&&b.win[0].attachEvent("onpropertychange",b.onAttributeChange),b.bind(b.win,"DOMNodeRemoved",function(e){e.target==b.win[0]&&b.remove()}))),!b.ispage&&b.opt.boxzoom&&b.bind(window,"resize",b.resizeZoom),b.istextarea&&b.bind(b.win,"mouseup",b.lazyResize),b.checkrtlmode=!0,b.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var S=function(t){b.iframexd=!1;try{var n="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(r){b.iframexd=!0,n=!1}if(b.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;b.forcescreen=!0,b.isiframe&&(b.iframe={doc:e(n),html:b.doc.contents().find("html")[0],body:b.doc.contents().find("body")[0]},b.getContentSize=function(){return{w:Math.max(b.iframe.html.scrollWidth,b.iframe.body.scrollWidth),h:Math.max(b.iframe.html.scrollHeight,b.iframe.body.scrollHeight)}},b.docscroll=e(b.iframe.body)),E.isios||!b.opt.iframeautoresize||b.isiframe||(b.win.scrollTop(0),b.doc.height(""),t=Math.max(n.getElementsByTagName("html")[0].scrollHeight,n.body.scrollHeight),b.doc.height(t)),b.lazyResize(30),E.isie7&&b.css(e(b.iframe.html),{"overflow-y":"hidden"}),b.css(e(b.iframe.body),{"overflow-y":"hidden"}),E.isios&&b.haswrapper&&b.css(e(n.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?b.bind(this.contentWindow,"scroll",b.onscroll):b.bind(n,"scroll",b.onscroll),b.opt.enablemousewheel&&b.bind(n,"mousewheel",b.onmousewheel),b.opt.enablekeyboard&&b.bind(n,E.isopera?"keypress":"keydown",b.onkeypress);if(E.cantouch||b.opt.touchbehavior)b.bind(n,"mousedown",b.ontouchstart),b.bind(n,"mousemove",function(e){b.ontouchmove(e,!0)}),b.opt.grabcursorenabled&&E.cursorgrabvalue&&b.css(e(n.body),{cursor:E.cursorgrabvalue});b.bind(n,"mouseup",b.ontouchend),b.zoom&&(b.opt.dblclickzoom&&b.bind(n,"dblclick",b.doZoom),b.ongesturezoom&&b.bind(n,"gestureend",b.ongesturezoom))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){S.call(b.doc[0],!1)},500),b.bind(this.doc,"load",S)}},this.showCursor=function(e,t){b.cursortimeout&&(clearTimeout(b.cursortimeout),b.cursortimeout=0),b.rail&&(b.autohidedom&&(b.autohidedom.stop().css({opacity:b.opt.cursoropacitymax}),b.cursoractive=!0),b.rail.drag&&1==b.rail.drag.pt||("undefined"!=typeof e&&!1!==e&&(b.scroll.y=Math.round(1*e/b.scrollratio.y)),"undefined"!=typeof t&&(b.scroll.x=Math.round(1*t/b.scrollratio.x))),b.cursor.css({height:b.cursorheight,top:b.scroll.y}),b.cursorh&&(!b.rail.align&&b.rail.visibility?b.cursorh.css({width:b.cursorwidth,left:b.scroll.x+b.rail.width}):b.cursorh.css({width:b.cursorwidth,left:b.scroll.x}),b.cursoractive=!0),b.zoom&&b.zoom.stop().css({opacity:b.opt.cursoropacitymax}))},this.hideCursor=function(e){b.cursortimeout||!b.rail||!b.autohidedom||b.hasmousefocus&&"leave"==b.opt.autohidemode||(b.cursortimeout=setTimeout(function(){b.rail.active&&b.showonmouseevent||(b.autohidedom.stop().animate({opacity:b.opt.cursoropacitymin}),b.zoom&&b.zoom.stop().animate({opacity:b.opt.cursoropacitymin}),b.cursoractive=!1),b.cursortimeout=0},e||b.opt.hidecursordelay))},this.noticeCursor=function(e,t,n){b.showCursor(t,n),b.rail.active||b.hideCursor(e)},this.getContentSize=b.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:b.haswrapper?function(){return{w:b.doc.outerWidth()+parseInt(b.win.css("paddingLeft"))+parseInt(b.win.css("paddingRight")),h:b.doc.outerHeight()+parseInt(b.win.css("paddingTop"))+parseInt(b.win.css("paddingBottom"))}}:function(){return{w:b.docscroll[0].scrollWidth,h:b.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!b||!b.win)return!1;if(!b.haswrapper&&!b.ispage){if("none"==b.win.css("display"))return b.visibility&&b.hideRail().hideRailHr(),!1;b.hidden||b.visibility||b.showRail().showRailHr()}var n=b.page.maxh,r=b.page.maxw,i=b.view.w;b.view={w:b.ispage?b.win.width():parseInt(b.win[0].clientWidth),h:b.ispage?b.win.height():parseInt(b.win[0].clientHeight)},b.page=t?t:b.getContentSize(),b.page.maxh=Math.max(0,b.page.h-b.view.h),b.page.maxw=Math.max(0,b.page.w-b.view.w);if(b.page.maxh==n&&b.page.maxw==r&&b.view.w==i){if(b.ispage)return b;n=b.win.offset();if(b.lastposition&&(r=b.lastposition,r.top==n.top&&r.left==n.left))return b;b.lastposition=n}return 0==b.page.maxh?(b.hideRail(),b.scrollvaluemax=0,b.scroll.y=0,b.scrollratio.y=0,b.cursorheight=0,b.setScrollTop(0),b.rail.scrollable=!1):b.rail.scrollable=!0,0==b.page.maxw?(b.hideRailHr(),b.scrollvaluemaxw=0,b.scroll.x=0,b.scrollratio.x=0,b.cursorwidth=0,b.setScrollLeft(0),b.railh.scrollable=!1):b.railh.scrollable=!0,b.locked=0==b.page.maxh&&0==b.page.maxw,b.locked?(b.ispage||b.updateScrollBar(b.view),!1):(b.hidden||b.visibility?b.hidden||b.railh.visibility||b.showRailHr():b.showRail().showRailHr(),b.istextarea&&b.win.css("resize")&&"none"!=b.win.css("resize")&&(b.view.h-=20),b.cursorheight=Math.min(b.view.h,Math.round(b.view.h*(b.view.h/b.page.h))),b.cursorheight=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorheight),b.cursorwidth=Math.min(b.view.w,Math.round(b.view.w*(b.view.w/b.page.w))),b.cursorwidth=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorwidth),b.scrollvaluemax=b.view.h-b.cursorheight-b.cursor.hborder,b.railh&&(b.railh.width=0<b.page.maxh?b.view.w-b.rail.width:b.view.w,b.scrollvaluemaxw=b.railh.width-b.cursorwidth-b.cursorh.wborder),b.checkrtlmode&&b.railh&&(b.checkrtlmode=!1,b.opt.rtlmode&&0==b.scroll.x&&b.setScrollLeft(b.page.maxw)),b.ispage||b.updateScrollBar(b.view),b.scrollratio={x:b.page.maxw/b.scrollvaluemaxw,y:b.page.maxh/b.scrollvaluemax},b.getScrollTop()>b.page.maxh?b.doScrollTop(b.page.maxh):(b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x)),b.cursoractive&&b.noticeCursor()),b.scroll.y&&0==b.getScrollTop()&&b.doScrollTo(Math.floor(b.scroll.y*b.scrollratio.y)),b)},this.resize=b.onResize,this.lazyResize=function(e){return e=isNaN(e)?30:e,b.delayed("resize",b.resize,e),b},this._bind=function(e,t,n,r){b.events.push({e:e,n:t,f:n,b:r,q:!1}),e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},this.jqbind=function(t,n,r){b.events.push({e:t,n:n,f:r,q:!0}),e(t).bind(n,r)},this.bind=function(e,t,n,r){var i="jquery"in e?e[0]:e;"mousewheel"==t?"onwheel"in b.win?b._bind(i,"wheel",n,r||!1):(e="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll",v(i,e,n,r||!1),"DOMMouseScroll"==e&&v(i,"MozMousePixelScroll",n,r||!1)):i.addEventListener?(E.cantouch&&/mouseup|mousedown|mousemove/.test(t)&&b._bind(i,"mousedown"==t?"touchstart":"mouseup"==t?"touchend":"touchmove",function(e){if(e.touches){if(2>e.touches.length){var t=e.touches.length?e.touches[0]:e;t.original=e,n.call(this,t)}}else e.changedTouches&&(t=e.changedTouches[0],t.original=e,n.call(this,t))},r||!1),b._bind(i,t,n,r||!1),E.cantouch&&"mouseup"==t&&b._bind(i,"touchcancel",n,r||!1)):b._bind(i,t,function(e){return(e=e||window.event||!1)&&e.srcElement&&(e.target=e.srcElement),"pageY"in e||(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop),!1===n.call(i,e)||!1===r?b.cancelEvent(e):!0})},this._unbind=function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=!1},this.unbindAll=function(){for(var e=0;e<b.events.length;e++){var t=b.events[e];t.q?t.e.unbind(t.n,t.f):b._unbind(t.e,t.n,t.f,t.b)}},this.cancelEvent=function(e){return e=e.original?e.original:e?e:window.event||!1,e?(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1):!1},this.stopPropagation=function(e){return e=e.original?e.original:e?e:window.event||!1,e?e.stopPropagation?e.stopPropagation():(e.cancelBubble&&(e.cancelBubble=!0),!1):!1},this.showRail=function(){return 0==b.page.maxh||!b.ispage&&"none"==b.win.css("display")||(b.visibility=!0,b.rail.visibility=!0,b.rail.css("display","block")),b},this.showRailHr=function(){return b.railh?(0==b.page.maxw||!b.ispage&&"none"==b.win.css("display")||(b.railh.visibility=!0,b.railh.css("display","block")),b):b},this.hideRail=function(){return b.visibility=!1,b.rail.visibility=!1,b.rail.css("display","none"),b},this.hideRailHr=function(){return b.railh?(b.railh.visibility=!1,b.railh.css("display","none"),b):b},this.show=function(){return b.hidden=!1,b.locked=!1,b.showRail().showRailHr()},this.hide=function(){return b.hidden=!0,b.locked=!0,b.hideRail().hideRailHr()},this.toggle=function(){return b.hidden?b.show():b.hide()},this.remove=function(){b.stop(),b.cursortimeout&&clearTimeout(b.cursortimeout),b.doZoomOut(),b.unbindAll(),E.isie9&&b.win[0].detachEvent("onpropertychange",b.onAttributeChange),!1!==b.observer&&b.observer.disconnect(),!1!==b.observerremover&&b.observerremover.disconnect(),b.events=null,b.cursor&&b.cursor.remove(),b.cursorh&&b.cursorh.remove(),b.rail&&b.rail.remove(),b.railh&&b.railh.remove(),b.zoom&&b.zoom.remove();for(var t=0;t<b.saved.css.length;t++){var n=b.saved.css[t];n[0].css(n[1],"undefined"==typeof n[2]?"":n[2])}b.saved=!1,b.me.data("__nicescroll","");var r=e.nicescroll;r.each(function(e){if(this&&this.id===b.id){delete r[e];for(var t=++e;t<r.length;t++,e++)r[e]=r[t];r.length--,r.length&&delete r[r.length]}});for(var i in b)b[i]=null,delete b[i];b=null},this.scrollstart=function(e){return this.onscrollstart=e,b},this.scrollend=function(e){return this.onscrollend=e,b},this.scrollcancel=function(e){return this.onscrollcancel=e,b},this.zoomin=function(e){return this.onzoomin=e,b},this.zoomout=function(e){return this.onzoomout=e,b},this.isScrollable=function(t){t=t.target?t.target:t;if("OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var n=e(t),n=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(n))return t.clientHeight!=t.scrollHeight;t=t.parentNode?t.parentNode:!1}return!1},this.getViewport=function(t){for(t=t&&t.parentNode?t.parentNode:!1;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var n=e(t);if(/fixed|absolute/.test(n.css("position")))return n;var r=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(r)&&t.clientHeight!=t.scrollHeight||0<n.getNiceScroll().length)return n;t=t.parentNode?t.parentNode:!1}return!1},this.onmousewheel=function(e){if(b.locked)return b.debounced("checkunlock",b.resize,250),!0;if(b.rail.drag)return b.cancelEvent(e);"auto"==b.opt.oneaxismousemode&&0!=e.deltaX&&(b.opt.oneaxismousemode=!1);if(b.opt.oneaxismousemode&&0==e.deltaX&&!b.rail.scrollable)return b.railh&&b.railh.scrollable?b.onmousewheelhr(e):!0;var t=+(new Date),n=!1;b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t;if(b.nativescrollingarea)return!0;if(e=g(e,!1,n))b.checkarea=0;return e},this.onmousewheelhr=function(e){if(b.locked||!b.railh.scrollable)return!0;if(b.rail.drag)return b.cancelEvent(e);var t=+(new Date),n=!1;return b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t,b.nativescrollingarea?!0:b.locked?b.cancelEvent(e):g(e,!0,n)},this.stop=function(){return b.cancelScroll(),b.scrollmon&&b.scrollmon.stop(),b.cursorfreezed=!1,b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.noticeCursor(),b},this.getTransitionSpeed=function(e){var t=Math.round(10*b.opt.scrollspeed);return e=Math.min(t,Math.round(e/20*b.opt.scrollspeed)),20<e?e:0},b.opt.smoothscroll?b.ishwscroll&&E.hastransition&&b.opt.usetransition?(this.prepareTransition=function(e,t){var n=t?20<e?e:0:b.getTransitionSpeed(e),r=n?E.prefixstyle+"transform "+n+"ms ease-out":"";return b.lasttransitionstyle&&b.lasttransitionstyle==r||(b.lasttransitionstyle=r,b.doc.css(E.transitionstyle,r)),n},this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var r=b.getScrollTop(),i=b.getScrollLeft();(0>(b.newscrolly-r)*(t-r)||0>(b.newscrollx-i)*(e-i))&&b.cancelScroll(),0==b.opt.bouncescroll&&(0>t?t=0:t>b.page.maxh&&(t=b.page.maxh),0>e?e=0:e>b.page.maxw&&(e=b.page.maxw));if(b.scrollrunning&&e==b.newscrollx&&t==b.newscrolly)return!1;b.newscrolly=t,b.newscrollx=e,b.newscrollspeed=n||!1;if(b.timer)return!1;b.timer=setTimeout(function(){var n=b.getScrollTop(),r=b.getScrollLeft(),i,s;i=e-r,s=t-n,i=Math.round(Math.sqrt(Math.pow(i,2)+Math.pow(s,2))),i=b.newscrollspeed&&1<b.newscrollspeed?b.newscrollspeed:b.getTransitionSpeed(i),b.newscrollspeed&&1>=b.newscrollspeed&&(i*=b.newscrollspeed),b.prepareTransition(i,!0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),0<i&&(!b.scrollrunning&&b.onscrollstart&&b.onscrollstart.call(b,{type:"scrollstart",current:{x:r,y:n},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:i}),E.transitionend?b.scrollendtrapped||(b.scrollendtrapped=!0,b.bind(b.doc,E.transitionend,b.onScrollEnd,!1)):(b.scrollendtrapped&&clearTimeout(b.scrollendtrapped),b.scrollendtrapped=setTimeout(b.onScrollEnd,i)),b.timerscroll={bz:new BezierClass(n,b.newscrolly,i,0,0,.58,1),bh:new BezierClass(r,b.newscrollx,i,0,0,.58,1)},b.cursorfreezed||(b.timerscroll.tm=setInterval(function(){b.showCursor(b.getScrollTop(),b.getScrollLeft())},60))),b.synched("doScroll-set",function(){b.timer=0,b.scrollendtrapped&&(b.scrollrunning=!0),b.setScrollTop(b.newscrolly),b.setScrollLeft(b.newscrollx),b.scrollendtrapped||b.onScrollEnd()})},50)},this.cancelScroll=function(){if(!b.scrollendtrapped)return!0;var e=b.getScrollTop(),t=b.getScrollLeft();return b.scrollrunning=!1,E.transitionend||clearTimeout(E.transitionend),b.scrollendtrapped=!1,b._unbind(b.doc,E.transitionend,b.onScrollEnd),b.prepareTransition(0),b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1,b.cursorfreezed=!1,b.showCursor(e,t),b},this.onScrollEnd=function(){b.scrollendtrapped&&b._unbind(b.doc,E.transitionend,b.onScrollEnd),b.scrollendtrapped=!1,b.prepareTransition(0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1;var e=b.getScrollTop(),t=b.getScrollLeft();b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.noticeCursor(!1,e,t),b.cursorfreezed=!1,0>e?e=0:e>b.page.maxh&&(e=b.page.maxh),0>t?t=0:t>b.page.maxw&&(t=b.page.maxw);if(e!=b.newscrolly||t!=b.newscrollx)return b.doScrollPos(t,e,b.opt.snapbackspeed);b.onscrollend&&b.scrollrunning&&b.onscrollend.call(b,{type:"scrollend",current:{x:t,y:e},end:{x:b.newscrollx,y:b.newscrolly}}),b.scrollrunning=!1}):(this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){function r(){if(b.cancelAnimationFrame)return!0;b.scrollrunning=!0;if(c=1-c)return b.timer=f(r)||1;var e=0,t=sy=b.getScrollTop();if(b.dst.ay){var t=b.bzscroll?b.dst.py+b.bzscroll.getNow()*b.dst.ay:b.newscrolly,n=t-sy;if(0>n&&t<b.newscrolly||0<n&&t>b.newscrolly)t=b.newscrolly;b.setScrollTop(t),t==b.newscrolly&&(e=1)}else e=1;var i=sx=b.getScrollLeft();if(b.dst.ax){i=b.bzscroll?b.dst.px+b.bzscroll.getNow()*b.dst.ax:b.newscrollx,n=i-sx;if(0>n&&i<b.newscrollx||0<n&&i>b.newscrollx)i=b.newscrollx;b.setScrollLeft(i),i==b.newscrollx&&(e+=1)}else e+=1;2==e?(b.timer=0,b.cursorfreezed=!1,b.bzscroll=!1,b.scrollrunning=!1,0>t?t=0:t>b.page.maxh&&(t=b.page.maxh),0>i?i=0:i>b.page.maxw&&(i=b.page.maxw),i!=b.newscrollx||t!=b.newscrolly?b.doScrollPos(i,t):b.onscrollend&&b.onscrollend.call(b,{type:"scrollend",current:{x:sx,y:sy},end:{x:b.newscrollx,y:b.newscrolly}})):b.timer=f(r)||1}t="undefined"==typeof t||!1===t?b.getScrollTop(!0):t;if(b.timer&&b.newscrolly==t&&b.newscrollx==e)return!0;b.timer&&l(b.timer),b.timer=0;var i=b.getScrollTop(),s=b.getScrollLeft();(0>(b.newscrolly-i)*(t-i)||0>(b.newscrollx-s)*(e-s))&&b.cancelScroll(),b.newscrolly=t,b.newscrollx=e,b.bouncescroll&&b.rail.visibility||(0>b.newscrolly?b.newscrolly=0:b.newscrolly>b.page.maxh&&(b.newscrolly=b.page.maxh)),b.bouncescroll&&b.railh.visibility||(0>b.newscrollx?b.newscrollx=0:b.newscrollx>b.page.maxw&&(b.newscrollx=b.page.maxw)),b.dst={},b.dst.x=e-s,b.dst.y=t-i,b.dst.px=s,b.dst.py=i;var o=Math.round(Math.sqrt(Math.pow(b.dst.x,2)+Math.pow(b.dst.y,2)));b.dst.ax=b.dst.x/o,b.dst.ay=b.dst.y/o;var u=0,a=o;0==b.dst.x?(u=i,a=t,b.dst.ay=1,b.dst.py=0):0==b.dst.y&&(u=s,a=e,b.dst.ax=1,b.dst.px=0),o=b.getTransitionSpeed(o),n&&1>=n&&(o*=n),b.bzscroll=0<o?b.bzscroll?b.bzscroll.update(a,o):new BezierClass(u,a,o,0,1,0,1):!1;if(!b.timer){(i==b.page.maxh&&t>=b.page.maxh||s==b.page.maxw&&e>=b.page.maxw)&&b.checkContentSize();var c=1;b.cancelAnimationFrame=!1,b.timer=1,b.onscrollstart&&!b.scrollrunning&&b.onscrollstart.call(b,{type:"scrollstart",current:{x:s,y:i},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:o}),r(),(i==b.page.maxh&&t>=i||s==b.page.maxw&&e>=s)&&b.checkContentSize(),b.noticeCursor()}},this.cancelScroll=function(){return b.timer&&l(b.timer),b.timer=0,b.bzscroll=!1,b.scrollrunning=!1,b}):(this.doScrollLeft=function(e,t){var n=b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var r=e>b.page.maxw?b.page.maxw:e;0>r&&(r=0);var i=t>b.page.maxh?b.page.maxh:t;0>i&&(i=0),b.synched("scroll",function(){b.setScrollTop(i),b.setScrollLeft(r)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,t){var n=0,n=t?Math.floor((b.scroll.y-e)*b.scrollratio.y):(b.timer?b.newscrolly:b.getScrollTop(!0))-e;if(b.bouncescroll){var r=Math.round(b.view.h/2);n<-r?n=-r:n>b.page.maxh+r&&(n=b.page.maxh+r)}b.cursorfreezed=!1,py=b.getScrollTop(!0);if(0>n&&0>=py)return b.noticeCursor();if(n>b.page.maxh&&py>=b.page.maxh)return b.checkContentSize(),b.noticeCursor();b.doScrollTop(n)},this.doScrollLeftBy=function(e,t){var n=0,n=t?Math.floor((b.scroll.x-e)*b.scrollratio.x):(b.timer?b.newscrollx:b.getScrollLeft(!0))-e;if(b.bouncescroll){var r=Math.round(b.view.w/2);n<-r?n=-r:n>b.page.maxw+r&&(n=b.page.maxw+r)}b.cursorfreezed=!1,px=b.getScrollLeft(!0);if(0>n&&0>=px||n>b.page.maxw&&px>=b.page.maxw)return b.noticeCursor();b.doScrollLeft(n)},this.doScrollTo=function(e,t){t&&Math.round(e*b.scrollratio.y),b.cursorfreezed=!1,b.doScrollTop(e)},this.checkContentSize=function(){var e=b.getContentSize();e.h==b.page.h&&e.w==b.page.w||b.resize(!1,e)},b.onscroll=function(e){b.rail.drag||b.cursorfreezed||b.synched("scroll",function(){b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.railh&&(b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x))),b.noticeCursor()})},b.bind(b.docscroll,"scroll",b.onscroll),this.doZoomIn=function(t){if(!b.zoomactive){b.zoomactive=!0,b.zoomrestore={style:{}};var n="position top left zIndex backgroundColor marginTop marginBottom marginLeft marginRight".split(" "),r=b.win[0].style,i;for(i in n){var o=n[i];b.zoomrestore.style[o]="undefined"!=typeof r[o]?r[o]:""}return b.zoomrestore.style.width=b.win.css("width"),b.zoomrestore.style.height=b.win.css("height"),b.zoomrestore.padding={w:b.win.outerWidth()-b.win.width(),h:b.win.outerHeight()-b.win.height()},E.isios4&&(b.zoomrestore.scrollTop=e(window).scrollTop(),e(window).scrollTop(0)),b.win.css({position:E.isios4?"absolute":"fixed",top:0,left:0,"z-index":s+100,margin:"0px"}),n=b.win.css("backgroundColor"),(""==n||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(n))&&b.win.css("backgroundColor","#fff"),b.rail.css({"z-index":s+101}),b.zoom.css({"z-index":s+102}),b.zoom.css("backgroundPosition","0px -18px"),b.resizeZoom(),b.onzoomin&&b.onzoomin.call(b),b.cancelEvent(t)}},this.doZoomOut=function(t){if(b.zoomactive)return b.zoomactive=!1,b.win.css("margin",""),b.win.css(b.zoomrestore.style),E.isios4&&e(window).scrollTop(b.zoomrestore.scrollTop),b.rail.css({"z-index":b.zindex}),b.zoom.css({"z-index":b.zindex}),b.zoomrestore=!1,b.zoom.css("backgroundPosition","0px 0px"),b.onResize(),b.onzoomout&&b.onzoomout.call(b),b.cancelEvent(t)},this.doZoom=function(e){return b.zoomactive?b.doZoomOut(e):b.doZoomIn(e)},this.resizeZoom=function(){if(b.zoomactive){var t=b.getScrollTop();b.win.css({width:e(window).width()-b.zoomrestore.padding.w+"px",height:e(window).height()-b.zoomrestore.padding.h+"px"}),b.onResize(),b.setScrollTop(Math.min(b.page.maxh,t))}},this.init(),e.nicescroll.push(this)},y=function(e){var t=this;this.nc=e,this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0,this.snapy=this.snapx=!1,this.demuly=this.demulx=0,this.lastscrolly=this.lastscrollx=-1,this.timer=this.chky=this.chkx=0,this.time=function(){return+(new Date)},this.reset=function(e,n){t.stop();var r=t.time();t.steptime=0,t.lasttime=r,t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=n,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,n){var r=t.time();t.steptime=r-t.lasttime,t.lasttime=r;var r=n-t.lasty,i=e-t.lastx,s=t.nc.getScrollTop(),o=t.nc.getScrollLeft(),s=s+r,o=o+i;t.snapx=0>o||o>t.nc.page.maxw,t.snapy=0>s||s>t.nc.page.maxh,t.speedx=i,t.speedy=r,t.lastx=e,t.lasty=n},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,n){var r=!1;0>n?(n=0,r=!0):n>t.nc.page.maxh&&(n=t.nc.page.maxh,r=!0),0>e?(e=0,r=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,r=!0),r&&t.nc.doScrollPos(e,n,t.nc.opt.snapbackspeed)},this.doMomentum=function(e){var n=t.time(),r=e?n+e:t.lasttime;e=t.nc.getScrollLeft();var i=t.nc.getScrollTop(),s=t.nc.page.maxh,o=t.nc.page.maxw;t.speedx=0<o?Math.min(60,t.speedx):0,t.speedy=0<s?Math.min(60,t.speedy):0,r=r&&60>=n-r;if(0>i||i>s||0>e||e>o)r=!1;e=t.speedx&&r?t.speedx:!1;if(t.speedy&&r&&t.speedy||e){var u=Math.max(16,t.steptime);50<u&&(e=u/50,t.speedx*=e,t.speedy*=e,u=50),t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var a=t.lastscrollx,f=t.lastscrolly,l=function(){var e=600<t.time()-n?.04:.02;t.speedx&&(a=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=a,0>a||a>o)&&(e=.1),t.speedy&&(f=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=f,0>f||f>s)&&(e=.1),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched("domomentum2d",function(){t.speedx&&(t.nc.getScrollLeft()!=t.chkx&&t.stop(),t.chkx=a,t.nc.setScrollLeft(a)),t.speedy&&(t.nc.getScrollTop()!=t.chky&&t.stop(),t.chky=f,t.nc.setScrollTop(f)),t.timer||(t.nc.hideCursor(),t.doSnapy(a,f))}),1>t.demulxy?t.timer=setTimeout(l,u):(t.stop(),t.nc.hideCursor(),t.doSnapy(a,f))};l()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},b=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(t,n,r){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollTop():b.call(t)},set:function(t,n){var r=e.data(t,"__nicescroll")||!1;return r&&r.ishwscroll?r.setScrollTop(parseInt(n)):b.call(t,n),this}},e.fn.scrollTop=function(t){if("undefined"==typeof t){var n=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return n&&n.ishwscroll?n.getScrollTop():b.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollTop(parseInt(t)):b.call(e(this),t)})};var w=e.fn.scrollLeft;e.cssHooks.pageXOffset={get:function(t,n,r){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollLeft():w.call(t)},set:function(t,n){var r=e.data(t,"__nicescroll")||!1;return r&&r.ishwscroll?r.setScrollLeft(parseInt(n)):w.call(t,n),this}},e.fn.scrollLeft=function(t){if("undefined"==typeof t){var n=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return n&&n.ishwscroll?n.getScrollLeft():w.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollLeft(parseInt(t)):w.call(e(this),t)})};var E=function(t){var n=this;this.length=0,this.name="nicescrollarray",this.each=function(e){for(var t=0,r=0;t<n.length;t++)e.call(n[t],r++);return n},this.push=function(e){n[n.length]=e,n.length++},this.eq=function(e){return n[e]};if(t)for(a=0;a<t.length;a++){var r=e.data(t[a],"__nicescroll")||!1;r&&(this[this.length]=r,this.length++)}return this};(function(e,t,n){for(var r=0;r<t.length;r++)n(e,t[r])})(E.prototype,"show hide toggle onResize resize remove stop doScrollPos".split(" "),function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(t){return"undefined"==typeof t?new E(this):this[t]&&e.data(this[t],"__nicescroll")||!1},e.extend(e.expr[":"],{nicescroll:function(t){return e.data(t,"__nicescroll")?!0:!1}}),e.fn.niceScroll=function(t,n){"undefined"!=typeof n||"object"!=typeof t||"jquery"in t||(n=t,t=!1);var r=new E;"undefined"==typeof n&&(n={}),t&&(n.doc=e(t),n.win=e(this));var i=!("doc"in n);return i||"win"in n||(n.win=e(this)),this.each(function(){var t=e(this).data("__nicescroll")||!1;t||(n.doc=i?e(this):n.doc,t=new g(n,e(this)),e(this).data("__nicescroll",t)),r.push(t)}),1==r.length?r[0]:r},window.NiceScroll={getjQuery:function(){return e}},e.nicescroll||(e.nicescroll=new E,e.nicescroll.options=d)}(jQuery),n("libs/jquery.nicescroll.min",function(){}),function(){n("scroll",["libs/jquery.nicescroll.min"],function(e){var t;return t=function(){function e(e,t){var n,r,i;this.$el=e,t==null&&(t={});if(!t.allBrowsers){t.userAgent||(t.userAgent=/Windows\ NT/);if(!navigator.userAgent.match(t.userAgent))return!1}(r=t.horizontal)==null&&(t.horizontal=!0),(i=t.zindex)==null&&(t.zindex=9e3),n={cursorcolor:"rgba(0,0,0,0.5)",cursorwidth:"8px",zindex:t.zindex,horizrailenabled:t.horizontal},this.nice=this.$el.niceScroll(n)}return e.prototype.resize=function(){return this.nice.resize()},e.prototype.destroy=function(){return this.nice.hide()},e}()})}.call(this),function(){n("ui",["editable_text","loading","loading_indicator","scroll"],function(e,t,n,r){return this.vs||(this.vs={}),this.vs.ui={EditableText:e,Loading:t,LoadingIndicator:n,Scroll:r}})}.call(this),t(["ui"])}(),define("plugins/vs.ui",["cdn.jquery"],function(){}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=function(e,t){return function(){return e.apply(t,arguments)}};define("player",["cdn.marionette","views/course","views/sidebar/author/author","views/sidebar/learner","app/catalogue","text!templates/player.html","views/loading","app/mediator","plugins/tracker","messages/decorate","modernizr","plugins/vs.ui","models/video"],function(e,r,i,s,o,u,a,f,l){var c,h,p;return h=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template=u,n.prototype.regions={sidebar:".sidebar",dialogs:".dialogs",courseContainer:".container",position:".scrubBar",loading:".loadingCourse"},n}(e.Layout),p=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){var e;return f.on("lesson:navigate",this.navigateLesson,this),this.on("route:showLesson route:showGadget route:showCourse",this.updateId,this),e=this,$(document).on("click","a.js-navigate",function(){return e.navigate("courses/"+e.courseId+"/"+$(this).attr("href"),{trigger:!0}),!1})},n.prototype.routes={learn:"learn","courses/:courseId":"showCourse","courses/:courseId/lessons/:lessonIndex":"showLesson","courses/:courseId/lessons/:lessonIndex/gadgets/:gadgetIndex":"showGadget"},n.prototype.updateId=function(e){this.courseId=e},n.prototype.navigateLesson=function(e){return this.navigate("courses/"+this.courseId+"/lessons/"+e,{trigger:!0})},n.prototype.navigateGadget=function(e,t){return this.navigate("courses/"+this.courseId+"/lessons/"+e+"/gadgets/"+t,{trigger:!0})},n}(Backbone.Router),c=function(){function e(e){this.onProgressLoad=n(this.onProgressLoad,this),this.onCourseLoad=n(this.onCourseLoad,this);var t,r,i=this;if(!_.has(e,"api"))throw new Error("Please set options.api!");vs.api.init(e.api),vs.api.on("xhr:start",function(e){return i.startTimer(e.requestUrl)}),vs.api.on("xhr:error",function(e,t,n){return i.endTimer(n.requestUrl,{status:"error"}),f.trigger("api:xhr:error")}),vs.api.on("xhr:success",function(e,t,n){return i.endTimer(n.requestUrl,{status:"success"}),f.trigger("api:xhr:success")}),this.baseUrl=e&&e.requireRoot?e.requireRoot:"/",this.baseUrl.match(/\/$/)||(this.baseUrl+="/"),require.config({baseUrl:this.baseUrl}),f.on("player:style:register",this.registerStylesheet,this),this._courseRendering=$.Deferred(),this._courseRendering.done(function(){return f.trigger("course:rendered",i.courseView)}),this.router=new p,this.options=_.extend({},this.defaults,e),t=this.options.courseId,this.trackerSetup({sessionId:this.options.api.sessionId,interactionId:_.random(1e15,1e16).toString(32)}),t&&(this.router.courseId=t),this.router.on("route:showLesson",this.showLesson,this),this.router.on("route:showGadget",this.showGadget,this),this.router.on("route:learn",this.becomeLearner,this),Backbone.history.start({root:window.location.pathname}),this.options.container&&(r=$(this.options.container).get(0)),this.layout=new h({el:r}),this.layout.render(),this.loadingView=new a,this.layout.loading.show(this.loadingView),f.on("gadget:rendered",function(e,t){if(t)return i.loadingView.hide(function(){return i.layout.loading.reset()})}),o.fetchAll(),this.router.courseId?this.loadCourse(this.router.courseId):this.buildCourse()}return _.extend(e.prototype,l("Player")),e.prototype.defaults={whitelabel:!1,embed:!1},e.prototype.isLearner=!1,e.prototype.becomeLearner=function(){return this.isLearner=!0},e.prototype.registerStylesheet=function(e){if($("head link."+e.key).length)return;return $('<link rel="stylesheet" type="text/css" />').attr("href",e.url).addClass(e.key).appendTo("head")},e.prototype.buildCourse=function(){var e;return e=new vs.api.Course({lessons:[{title:"lesson 1"}]}),this.onCourseLoad(e)},e.prototype.loadCourse=function(e){var t,n,r,i=this;return this.track("Begin Loading",{course:e}),n=new vs.api.Course({id:e}),n.set({isEditable:!1}),r=n.progress.fetch(),r.success(this.onProgressLoad),this.options.revision&&(t=n.url(),n.url=function(){return i.baseUrl+"catalogs/staged"+t}),n.fetch({success:function(e){return $.when(r).then(function(){return i.onCourseLoad(e)})},silent:!0}),this.course=n},e.prototype.handleException=function(e){return e instanceof vs.api.errors.ApplicationError?console.log("app error"):e instanceof vs.api.errors.NotFound?console.log("not found"):e instanceof vs.api.errors.PermissionDenied?console.log("permission denied"):console.log("error")},e.prototype.onCourseLoad=function(e){var t;return this.track("Finish Loading",{course:e.id,editable:e.get("isEditable")}),(this.options.noEditable||this.isLearner||this.options.embed)&&e.set({isEditable:!1}),t={embed:this.options.embed,model:e,whitelabel:this.options.whitelabel},this.courseView=new r(t),this.layout.courseContainer.show(this.courseView),e.get("isEditable")?this.layout.sidebar.show(new i(t)):this.layout.sidebar.show(new s(t)),e.parse=function(e){return e.lessons=_.map(e.lessons,function(e){return _.omit(e,"gadgets")}),this.lessons.set(e.lessons),_.omit(e,"lessons")},this._courseRendering.resolve()},e.prototype.onProgressLoad=function(e){e==null&&(e={});if(e.lessonIndex)return e.gadgetIndex?this.router.navigateGadget(e.lessonIndex,e.gadgetIndex):this.router.navigateLesson(e.lessonIndex)},e.prototype.showLesson=function(e,t){var n=this;return this._courseRendering.done(function(){return n.courseView.showLesson(t)})},e.prototype.showGadget=function(e,t,n){var r=this;return this._courseRendering.done(function(){return r.courseView.showGadget(t,n)})},e}()})}.call(this),function(){require(["player"],function(e){window.onunload=function(){};if(window.onPlayerReady)return window.onPlayerReady(e)})}.call(this),define("launcher",function(){});