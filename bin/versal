#!/usr/bin/env node

'use strict';

var commands = ["create", "init", "register", "validate", "preview", "publish", "upload", "compile", "compress", "whoami", "docs"];
var usageMessage = "Versal Gadget SDK. Usage: versal (" + commands.join(" | ") + ") [-arguments] [--options] [--version]";

var argv = require("optimist")
  .usage(usageMessage)
  .check(function(argv) {
    var command = argv._[0];
    if (argv.help) {
      console.log(usageMessage);
    } else if (command == 'whoami' || command[0] == '_') {
      // whoami can be called without arguments
      return true;
    } else if (argv._.length < 1 && !argv.version) {
      throw "Not enough non-option arguments: got 0, need at least 1";
    } else if (command && commands.concat('test').indexOf(command) < 0) {
      throw 'Command does not exist: ' + command;
    }
    return true;
  })
  .argv;

var sdk = require("../lib/sdk");
var sdk2 = require('../lib/sdk2');

var command = argv._.shift();
if(command[0] == '_')
{
  command = command.replace('_','');
  sdk.exec(command, argv);
} else {
  sdk2.exec(command, argv._, argv.options);
}
