/*!
 * player v1.2.1
 * a masterpiece! from f6a9fbc on 02. April 2014
 */
(function(e,t){typeof define=="function"&&define.amd&&define("plugins/vs.api",t),e.vs||(e.vs={}),e.vs.api=t()})(this,function(){var e,t,n;return function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),w=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n.apply(a[e],g);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!w)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../src/build/almond",function(){}),n("pagination",["require","exports","module","underscore"],function(e,t,n){(function(){var t,r;r=e("underscore"),t=function(){function s(t){t==null&&(t={}),r.extend(this,e,i(t))}var e,t,n,i;return t=20,e={count:0,page:1,perPage:t,pageCount:1},n=s.pageParams=r.keys(e),i=function(e){return r.pick(e,n)},s.prototype.pageRequest=function(e,n){var s;return n==null&&(n={}),s=r.extend(i(this),i(n),{page:e}),s.perPage<1?s.perPage=1:s.perPage>t&&(s.perPage=t),0<e&&e<=s.pageCount?r.pick(s,"page","perPage"):!1},s}(),n.exports=t}).call(this)}),n("helpers/backbone_collection_move",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,n;t=e("backbone"),n=e("underscore"),t.Collection.prototype.move=function(e,t,n){var r;r=this.indexOf(e);if(r===-1)throw new Error("Can't move a model that's not in the collection");r!==t&&this.models.splice(t,0,this.models.splice(r,1)[0]),this.trigger("sort",this);if(n!=null?!n.silent:!void 0)return this.reorder(n)},t.Collection.prototype.getIndexes=function(){return n.map(this.models,function(e){return e.id})},t.Collection.prototype.reorder=function(e){var t;e==null&&(e={}),t=this.getIndexes();if(!t.length)return;return e.url==null&&(e.url=n.result(this,"url")+"/order"),e.attrs==null&&(e.attrs=t),this.sync("update",this,e)}}).call(this)}),n("models/asset_representation",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("backbone"),i=e("underscore"),t=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.isType=function(e){return this._isExactType(e)||this._isTypeWithWildcard(e)},t.prototype._isExactType=function(e){return e===this.get("contentType")},t.prototype._isTypeWithWildcard=function(e){var t,n,r;return r=e.split("/"),n=r[0],t=r[1],t==="*"&&n===i.first(this.get("contentType").split("/"))},t}(r.Model),n.exports=t}).call(this)}),n("collections/asset_representations",["require","exports","module","../models/asset_representation","backbone"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("../models/asset_representation"),i=e("backbone"),r=function(e){function n(){return s=n.__super__.constructor.apply(this,arguments),s}return u(n,e),n.prototype.model=t,n}(i.Collection),n.exports=r}).call(this)}),n("models/asset",["require","exports","module","backbone","../collections/asset_representations","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=e("backbone"),r=e("../collections/asset_representations"),s=e("underscore"),t=function(e){function t(e,n){e==null&&(e={}),n==null&&(n={}),this.representations=new r([],{asset:this}),n.parse=!0,t.__super__.constructor.call(this,e,n)}return u(t,e),t.prototype.urlRoot="/assets",t.prototype.defaults={tags:[]},t.prototype.sync=function(e,t,n){return n==null&&(n={}),n.parse=!0,i.sync.apply(this,[e,t,n])},t.prototype.parse=function(e){return e.representations&&(this._expandLocations(e),this.representations.set(e.representations),delete e.representations),e},t.prototype.toJSON=function(e){var t;return e==null&&(e={}),t=s.clone(this.attributes),e.upload||(t=s.omit(t,["content","contentType"])),e.representations&&s.extend(t,{representations:this.representations.toJSON()}),t},t.prototype.hasRepresentation=function(e){return this.representations.any(function(t){return t.isType(e)})},t.prototype.getRepresentation=function(e){var t;return t=this.representations.select(function(t){return t.isType(e)}),s.map(t,function(e){return e.get("location")})},t.prototype.validate=function(e,t){t==null&&(t={}),this.attributes&&(e=s.extend(this.attributes,e));if(t.upload){if(!e.content)return"content is required to upload an asset";if(!e.contentType)return"contentType is required to upload an asset"}if(!e.title)return"title is required"},t.prototype._expandLocations=function(e){var t=this;if(!this.baseUrl)return;return s.each(e.representations,function(e){if(!e.location.match(/^https?:\/\//))return e.location=t.baseUrl+e.location})},t}(i.Model),n.exports=t}).call(this)}),n("collections/assets",["require","exports","module","../models/asset","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("../models/asset"),i=e("backbone"),s=e("underscore"),r=function(e){function n(){return o=n.__super__.constructor.apply(this,arguments),o}return a(n,e),n.prototype.url=function(){return"/assets"},n.prototype.model=t,n.prototype.fetchByField=function(e,t,n){var r,i;return n==null&&(n={}),r=s.extend({},n.data),r[e]=t,i=s.extend({},n,{data:r}),this.fetch(i)},n.prototype.fetchByCreator=function(e,t){return this.fetchByField("creator",e,t)},n.prototype.fetchByTagLead=function(e,t){return this.fetchByField("tagLead",e,t)},n}(i.Collection),n.exports=r}).call(this)}),n("models/course_revision",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function n(e,n){n==null&&(n={});if(!n.course&&!n.catalog)throw new Error("Course or catalog reference is mandatory for CourseRevision");this.course=n.course,this.catalog=n.catalog,t.Model.apply(this,arguments)}return o(n,e),n.prototype.toJSON=function(){var e,t;return e={courseId:((t=this.course)!=null?t.id:void 0)||this.get("courseId")},e.revisionId=this.id||this.get("revisionId"),e},n}(t.Model),n.exports=r}).call(this)}),n("collections/course_revisions",["require","exports","module","backbone","underscore","../models/course_revision"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../models/course_revision"),i=function(e){function n(e,n){n==null&&(n={});if(!n.course&&!n.catalog)throw new Error("Course or catalog reference is mandatory for CourseRevisions");this.course=n.course,this.catalog=n.catalog,t.Collection.apply(this,arguments)}return u(n,e),n.prototype.model=r,n.prototype.create=function(e,t){return t==null&&(t={}),this.course&&(t.course=this.course),this.catalog&&(t.catalog=this.catalog),n.__super__.create.call(this,e,t)},n}(t.Collection),n.exports=i}).call(this)}),n("models/catalog",["require","exports","module","underscore","backbone","../collections/course_revisions"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=e("underscore"),t=e("backbone"),i=e("../collections/course_revisions"),r=function(e){function n(e,n){var r=this;e==null&&(e={}),n==null&&(n={}),this.courses=new i(n.courses,{catalog:this}),this.courses.url=function(){return s.result(r,"url")+"/courses"},n.parse=!0,t.Model.apply(this,arguments)}return u(n,e),n.prototype.urlRoot="/catalogs",n.prototype.parse=function(e){if(e.courses)return this.courses.set(e.courses)},n}(t.Model),n.exports=r}).call(this)}),n("collections/catalogs",["require","exports","module","backbone","../models/catalog"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=e("../models/catalog"),i=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.url="/catalogs",t.prototype.model=r,t}(t.Collection),n.exports=i}).call(this)}),n("models/course_head",["require","exports","module","./course_revision","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("./course_revision"),i=e("underscore"),t=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.isNew=function(){return!1},t.prototype.discard=function(e){return this.id=null,this.save(this,e)},t}(r),n.exports=t}).call(this)}),n("models/course_progress",["require","exports","module","backbone"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t.prototype.isNew=function(){return!1},t}(t.Model),n.exports=r}).call(this)}),n("models/gadget_userstate",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.isNew=function(){return!1},t.prototype.initialize=function(e,t){if(t!=null?!t.gadget:!void 0)throw new Error("gadget should be provided to create a gadget state");return this.gadget=t.gadget},t.prototype.setDefaults=function(e){return this.set(i.omit(e,i.keys(this.attributes)))},t}(t.Model),n.exports=r}).call(this)}),n("collections/gadget_userstates",["require","exports","module","backbone"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t.prototype.url=function(){if(this.gadget&&this.gadget.collection)return this.gadget.url()+"/userstates"},t.prototype.initialize=function(e,t){if(t!=null?!t.gadget:!void 0)throw new Error("Gadget reference is mandatory for GadgetUserstates");return this.gadget=t.gadget},t}(t.Collection),n.exports=r}).call(this)}),n("models/gadget_config",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.isNew=function(){return!1},t.prototype.initialize=function(e,t){if(t!=null?!t.gadget:!void 0)throw new Error("gadget should be provided to create a gadget config");return this.gadget=t.gadget},t.prototype.setDefaults=function(e){return this.set(i.omit(e,i.keys(this.attributes)))},t.prototype.validate=function(){if(!this.gadget.id)return"Cannot save config before gadget has been given an ID"},t}(t.Model),n.exports=r}).call(this)}),n("models/gadget",["require","exports","module","backbone","underscore","./gadget_userstate","../collections/gadget_userstates","./gadget_config"],function(e,t,n){(function(){var t,r,i,s,o,u,a={}.hasOwnProperty,f=function(e,t){function r(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),u=e("underscore"),s=e("./gadget_userstate"),o=e("../collections/gadget_userstates"),i=e("./gadget_config"),r=function(e){function t(e,n){var r=this;e==null&&(e={}),n==null&&(n={}),this.config=new i({},{gadget:this}),this.config.url=function(){return u.result(r,"url")+"/config"},this.userState=new s({},{gadget:this}),this.userState.url=function(){return u.result(r,"url")+"/userstate"},this.userStates=new o([],{gadget:this}),n.parse=!0,t.__super__.constructor.call(this,e,n)}return f(t,e),t.prototype._locals=["uploadPercent"],t.prototype.parse=function(e){if(!e)return;return e.config&&this.config.set(u.clone(e.config),{silent:!0}),e.userState&&this.userState.set(u.clone(e.userState),{silent:!0}),e.gadgetProject&&(this.gadgetProject=e.gadgetProject),u.omit(e,["config","userState","gadgetProject"])},t.prototype.toJSON=function(){var e;return e=u.clone(this.attributes),this.config&&(e.config=this.config.toJSON()),this.userState&&(e.userState=this.userState.toJSON()),u.omit(e,this._locals)},t.prototype.validate=function(e){if(!e.type)return"Type is required. Did you call parse:true when instantiated your gadget?"},t}(t.Model),n.exports=r}).call(this)}),n("models/gadget_project",["require","exports","module","underscore","backbone","jquery","./gadget"],function(e,t,n){(function(){var t,r,i,s,o,u,a={}.hasOwnProperty,f=function(e,t){function r(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};o=e("underscore"),r=e("backbone"),t=e("jquery"),i=e("./gadget"),n.exports=s=function(e){function t(){return u=t.__super__.constructor.apply(this,arguments),u}return f(t,e),t.prototype.urlRoot="/gadgets",t.prototype.url=function(){var e;return e=o.result(this.collection,"url")||this.urlRoot,o.flatten(o.compact([e,this.typeSegments()])).join("/")},t.prototype.path=function(e){var n;return n=this.urlRoot,t.prototype.apiUrl&&(n=t.prototype.apiUrl.replace(/\/$/,"")+n),o.flatten(o.compact([n,this.typeSegments(),e])).join("/")},t.prototype.manifest=function(){return this.path("manifest")},t.prototype.main=function(){return this.path("gadget.js")},t.prototype.css=function(){if(!this.has("noCss"))return this.path("gadget.css")},t.prototype.icon=function(){return this.path("assets/icon.png")},t.prototype.code=function(){return this.path("code.zip")},t.prototype.compiled=function(){return this.path("compiled.zip")},t.prototype.typeSegments=function(){var e;return e=this.get("version")||"latest",[this.get("username"),this.get("name"),e]},t.prototype.type=function(){var e;return e=""+this.get("username")+"/"+this.get("name"),this.get("version")&&(e+="@"+this.get("version")),e},t.prototype.cssClassName=function(){return("gadget-"+this.typeSegments().join("-")).replace(/[\.\s]+/g,"_")},t.prototype.fetch=function(e){return e==null&&(e={}),t.__super__.fetch.call(this,o.extend(e,{url:this.manifest()}))},t.prototype.isNew=function(){return!1},t.prototype.toJSON=function(e){return(e!=null?e.include:void 0)?o.pick.apply(this,this.attributes,e.include):o.clone(this.attributes)},t.prototype.buildInstance=function(e){var t,n;return n={config:this.get("defaultConfig"),userState:this.get("defaultUserState"),type:this.type()},o.extend(n,e),t=new i(n)},t}(r.Model)}).call(this)}),n("collections/gadget_projects",["require","exports","module","backbone","underscore","../models/gadget_project"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../models/gadget_project"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.model=r,t.prototype.url=function(){return"/gadgets"},t.prototype.fetchFiltered=function(e,t){var n,r;return t==null&&(t={}),n=s.extend({},t.data,e),r=s.extend({},t,{data:n}),this.fetch(r)},t.prototype.fetchApproved=function(e){return this.fetchFiltered({catalog:"approved"},e)},t.prototype.fetchSandbox=function(e){return this.fetchFiltered({user:"me",catalog:"sandbox"},e)},t.prototype.fetchRejected=function(e){return this.fetchFiltered({user:"me",catalog:"rejected"},e)},t.prototype.findByType=function(e){var t,n,r,i,s,o,u;return o=e.split("@"),n=o[0],s=o[1],u=n.split("/"),i=u[0],r=u[1],t={username:i,name:r},s&&(t.version=s),this.findWhere(t)},t}(t.Collection),n.exports=i}).call(this)}),n("models/gadget_palette",["require","exports","module","underscore","backbone","../collections/gadget_projects"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=e("underscore"),t=e("backbone"),i=e("../collections/gadget_projects"),n.exports=r=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.initialize=function(e,t){t==null&&(t={});if(t!=null?t.course:void 0)return this.url=function(){return s.result(t.course,"url")+"/palette"}},t.prototype.upgrade=function(e,t){return this.changeVersion(e,null,t)},t.prototype.changeVersion=function(e,t,n){var r,i;return n==null&&(n={}),r=this.findByType(e),r?(i=r.url(),n.url||(n.url=i),t||(t=r.get("latestVersion")),r.save({version:t},n)):$.Deferred().reject("Gadget project not found")},t}(i)}).call(this)}),n("collections/gadgets",["require","exports","module","backbone","underscore","../models/gadget"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../models/gadget"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.model=r,t.prototype.url=function(){if(this.lesson)return s.result(this.lesson,"url")+"/gadgets"},t.prototype.initialize=function(e,t){return this.lesson=t&&t.lesson?t.lesson:void 0},t}(t.Collection),n.exports=i}).call(this)}),n("models/lesson",["require","exports","module","backbone","underscore","../collections/gadgets"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../collections/gadgets"),i=function(e){function t(e,n){e==null&&(e={}),n==null&&(n={}),this.gadgets=new r([],{lesson:this}),n.parse=!0,t.__super__.constructor.call(this,e,n)}return u(t,e),t.prototype.defaults={title:"Untitled lesson",isActive:!1},t.prototype._locals=["isActive"],t.prototype.parse=function(e){if(!e)return;return e.gadgets&&this.gadgets.reset(e.gadgets,{parse:!0}),s.omit(e,"gadgets",this._locals)},t.prototype.validate=function(e,t){if(!e.title)return"Title must be not empty"},t.prototype.toJSON=function(e){var t;t=s.clone(this.attributes);if(e!=null?e.gadgets:void 0)t.gadgets=this.gadgets.toJSON();return s.omit(t,this._locals)},t}(t.Model),n.exports=i}).call(this)}),n("collections/lessons",["require","exports","module","backbone","underscore","../models/lesson"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../models/lesson"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.model=r,t.prototype.url=function(){if(this.course)return s.result(this.course,"url")+"/lessons"},t.prototype.initialize=function(e,t){if(t!=null?!t.course:!void 0)throw new Error("Course reference is mandatory for the Lessons");return this.course=t.course},t}(t.Collection),n.exports=i}).call(this)}),n("models/user",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function n(e,n){e==null&&(e={}),n==null&&(n={}),this.orgs=new t.Collection,t.Model.call(this,e,n)}return o(n,e),n.prototype.urlRoot="/users",n.prototype.parse=function(e){return e.orgs&&this.orgs.set(e.orgs,{parse:!0}),i.omit(e,"orgs")},n.prototype.signin=function(e){return e==null&&(e={}),e.url="/signin/"+this.id,e.useApiKey=!0,this.sync("create",this,e)},n.prototype.signout=function(e){return e==null&&(e={}),e.url="/signout",this.sync("create",this,e)},n.current=function(e){var t;return e==null&&(e={}),t=new n,e.self=!0,t.fetch(e)},n.prototype.defaults=function(){return{fn:"Anonymous",location:"",shortDesc:"",longDesc:"",website:"",social:[],registered:!1}},n.prototype.fetch=function(e){return e==null&&(e={}),e.self&&(e.url="/user"),n.__super__.fetch.call(this,e)},n.prototype.toJSON=function(){return i.extend({},this.attributes,{orgs:this.orgs.toJSON()})},n}(t.Model),n.exports=r}).call(this)}),n("models/user_role",["require","exports","module","backbone","underscore","../models/user"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),s=e("underscore"),r=e("../models/user"),i=function(e){function n(e,n){e==null&&(e={}),n==null&&(n={}),this.user=new r,n.parse=!0,t.Model.call(this,e,n)}return u(n,e),n.prototype.idAttribute="userId",n.prototype.defaults={roles:[]},n.prototype.parse=function(e,t){return e.user&&(this.user.set(e.user),e.userId=this.user.id),s.omit(e,"user")},n.prototype.toJSON=function(e){var t;return t={roles:this.attributes.roles},this.get("userId")?t.userId=this.get("userId"):t.user=this.user.toJSON(),t},n.prototype.destroy=function(e){return this.set({roles:[]}),this.sync("update",this,e)},n}(t.Model),n.exports=i}).call(this)}),n("collections/user_roles",["require","exports","module","backbone","../models/user_role"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=e("../models/user_role"),i=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.model=r,t}(t.Collection),n.exports=i}).call(this)}),n("collections/users",["require","exports","module","../models/user","backbone"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("../models/user"),t=e("backbone"),i=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.model=r,t.prototype.url=function(){return"/users"},t}(t.Collection),n.exports=i}).call(this)}),n("models/course",["require","exports","module","backbone","underscore","./catalog","./course_head","./course_progress","../collections/course_revisions","../models/gadget_palette","../collections/lessons","../collections/user_roles","../collections/users"],function(e,t,n){(function(){var t,r,i,s,o,u,a,f,l,c,h,p={}.hasOwnProperty,d=function(e,t){function r(){this.constructor=e}for(var n in t)p.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),h=e("underscore"),r=e("./catalog"),s=e("./course_head"),o=e("./course_progress"),u=e("../collections/course_revisions"),a=e("../models/gadget_palette"),f=e("../collections/lessons"),l=e("../collections/user_roles"),c=e("../collections/users"),i=function(e){function n(e,n){var r=this;e==null&&(e={}),n==null&&(n={}),this.authors=new c,this.authors.url=function(){return h.result(r,"url")+"/users"},this.lessons=new f([],{course:this}),this.progress=new o({},{course:this}),this.progress.url=function(){return h.result(r,"url")+"/progress"},this.users=new l,this.users.url=function(){return h.result(r,"url")+"/users"},this.head=new s({},{course:this}),this.head.url=function(){return h.result(r,"url")+"/head"},this.revisions=new u([],{course:this}),this.revisions.url=function(){return h.result(r,"url")+"/revisions"},this.palette=new a([],{course:this}),n.parse=!0,t.Model.call(this,e,n)}return d(n,e),n.prototype.urlRoot="/courses",n.prototype.defaults={title:"Untitled course",isEditable:!1,shortDesc:"",longDesc:"",authorBio:"",tags:[],catalogs:[]},n.prototype.parse=function(e){return e.authors&&this.authors.set(e.authors,{parse:!0}),e.lessons&&this.lessons.set(e.lessons,{parse:!0}),e.revisions&&this.revisions.set(e.revisions,{parse:!0}),e.head&&this.head.set(h.clone(e.head),{silent:!0}),e.palette&&this.palette.set(e.palette,{parse:!0}),e.currentPosition&&this.progress.set({lessonIndex:e.currentPosition.currentLesson}),h.omit(e,"lessons","authors","revisions","head","progress","palette")},n.prototype.toJSON=function(e){var t;return e==null&&(e={}),t=h.clone(this.attributes),e.lessons&&(t.lessons=this.lessons.toJSON(e)),e.palette&&(t.palette=this.palette.toJSON(e)),t},n.prototype.validate=function(e,t){if(!e.title)return"Title must be not empty"},n.prototype.stage=function(e){var t,n=this;return e==null&&(e={}),t=this.revisions.create({},{error:e.error,success:function(){var i;return i=new r({id:"staged"}),i.courses.create(t.toJSON(),{error:e.error,success:function(){var t;return(t=e.success)!=null?t.call(n,n):void 0}})}})},n.prototype.start=function(e){return e==null&&(e={}),e.attrs={},e.url=h.result(this,"url")+"/start",this.sync("create",this,e)},n.prototype.complete=function(e){return e==null&&(e={}),e.attrs={},e.url=h.result(this,"url")+"/completion",this.sync("update",this,e)},n.prototype.isStaged=function(){return h.contains(this.get("catalogs"),"staged")},n.prototype.isPublished=function(){return this.isStaged()||h.contains(this.get("catalogs"),"labs")},n}(t.Model),n.exports=i}).call(this)}),n("collections/courses",["require","exports","module","../models/course","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("../models/course"),t=e("backbone"),s=e("underscore"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.model=r,t.prototype.url=function(){return"/courses"},t.prototype.fetchCatalog=function(e,t){var n,r;return t==null&&(t={}),n=s.extend({},t.data,{catalog:e}),r=s.extend({},t,{data:n}),this.fetch(r)},t.prototype.fetchUser=function(e){return this.fetchCatalog("user",e)},t.prototype.fetchLabs=function(e){return this.fetchCatalog("labs",e)},t}(t.Collection),n.exports=i}).call(this)}),n("models/organization",["require","exports","module","backbone","underscore","../collections/user_roles","../collections/courses"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),o=e("underscore"),s=e("../collections/user_roles"),r=e("../collections/courses"),i=function(e){function n(e,n){var i=this;e==null&&(e={}),n==null&&(n={}),this.users=new s,this.users.url=function(){return o.result(i,"url")+"/users"},this.courses=new r,this.courses.url=function(){return o.result(i,"url")+"/courses"},n.parse=!0,t.Model.call(this,e,n)}return a(n,e),n.prototype.urlRoot="/orgs",n.prototype.defaults={orgTitle:"Your team name"},n}(t.Model),n.exports=i}).call(this)}),n("models/partnerkey",["require","exports","module","backbone"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t.prototype.urlRoot="/partnerkeys",t.prototype.defaults={key:""},t}(t.Model),n.exports=r}).call(this)}),n("models/tag",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),i=e("underscore"),r=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.urlRoot=function(){return"/tag"},t.prototype.idAttribute="path",t.prototype.validate=function(e,t){t==null&&(t={});if(!e.path)return"path is required to upload a tag"},t}(t.Model),n.exports=r}).call(this)}),n("collections/tags",["require","exports","module","../models/tag","backbone","underscore"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("../models/tag"),t=e("backbone"),s=e("underscore"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.url=function(){return"/tags"},t.prototype.model=r,t.prototype.fetchByField=function(e,t,n){var r,i;return n==null&&(n={}),r=s.extend({},n.data),r[e]=t,i=s.extend({},n,{data:r}),this.fetch(i)},t.prototype.fetchByPath=function(e,t){return this.fetchByField("path",e,t)},t}(t.Collection),n.exports=i}).call(this)}),n("api_errors",["require","exports","module"],function(e,t,n){(function(){var e,t,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=function(e){function t(){this.name="NotFound",t.__super__.constructor.apply(this,arguments)}return s(t,e),t}(Error),r=function(e){function t(){this.name="PermissionDenied",t.__super__.constructor.apply(this,arguments)}return s(t,e),t}(Error),e=function(e){function t(){this.name="ApplicationError",t.__super__.constructor.apply(this,arguments)}return s(t,e),t}(Error),n.exports={NotFound:t,PermissionDenied:r,ApplicationError:e}}).call(this)}),n("adapters/browser",["require","exports","module","backbone","underscore"],function(e,t,n){(function(){var t,r,i;t=e("backbone"),i=e("underscore"),n.exports=r=function(){function e(){}return e.prototype.ajax=function(e){var t;return t=this.createRequestOptions(e),i.extend(t,{cache:!1,contentType:!1,processData:!1}),$.ajax(t)},e.prototype.createRequestOptions=function(e){return e},e.prototype.createFormData=function(e){var t,n,r,i;t=new FormData,i=e.toJSON({upload:!0});for(n in i)r=i[n],t.append(n,this.normalizeValue(r));return t},e.prototype.normalizeValue=function(e){return e instanceof File||e instanceof Blob?e:i.isArray(e)||i.isObject(e)?JSON.stringify(e):e},e.prototype.sendRequest=function(e){},e}()}).call(this)}),n("api",["require","exports","module","backbone","jquery","./pagination","underscore","./helpers/backbone_collection_move","./models/asset","./collections/assets","./models/asset_representation","./collections/asset_representations","./models/catalog","./collections/catalogs","./models/course","./collections/courses","./models/course_head","./models/course_progress","./models/course_revision","./collections/course_revisions","./models/gadget","./collections/gadgets","./models/gadget_palette","./models/gadget_project","./collections/gadget_projects","./collections/gadget_userstates","./models/lesson","./collections/lessons","./models/organization","./models/partnerkey","./models/tag","./collections/tags","./models/user","./collections/users","./models/user_role","./collections/user_roles","./models/gadget","./api_errors","./adapters/node","./adapters/browser"],function(e,t,n){(function(){var t,r,i,s,o=[].slice;t=e("backbone"),t.$=e("jquery"),r=e("./pagination"),s=e("underscore"),e("./helpers/backbone_collection_move"),n.exports=i={Backbone:t,Asset:e("./models/asset"),Assets:e("./collections/assets"),AssetRepresentation:e("./models/asset_representation"),AssetRepresentations:e("./collections/asset_representations"),Catalog:e("./models/catalog"),Catalogs:e("./collections/catalogs"),Course:e("./models/course"),Courses:e("./collections/courses"),CourseHead:e("./models/course_head"),CourseProgress:e("./models/course_progress"),CourseRevision:e("./models/course_revision"),CourseRevisions:e("./collections/course_revisions"),Gadget:e("./models/gadget"),Gadgets:e("./collections/gadgets"),GadgetPalette:e("./models/gadget_palette"),GadgetProject:e("./models/gadget_project"),GadgetProjects:e("./collections/gadget_projects"),GadgetUserStates:e("./collections/gadget_userstates"),Lesson:e("./models/lesson"),Lessons:e("./collections/lessons"),Organization:e("./models/organization"),PartnerKey:e("./models/partnerkey"),Tag:e("./models/tag"),Tags:e("./collections/tags"),User:e("./models/user"),Users:e("./collections/users"),UserRole:e("./models/user_role"),UserRoles:e("./collections/user_roles"),GadgetInstance:e("./models/gadget"),Pagination:r,errors:e("./api_errors"),errorHandler:function(e,t,n){var r,o;n==null&&(n={});if(e instanceof Error)return e;if(!t||!t.status)return new Error("Unexpected result to error handler: "+JSON.stringify(arguments));o=i.errors,r=[t.status,s.result(e,"url"),t.responseText].join(" ");switch(t.status){case 401:case 403:return new o.PermissionDenied(r);case 404:return new o.NotFound(r);default:return new o.ApplicationError(r)}},connect:function(e){if(!e.url)throw new Error("url is required to connect to the API");return this.apiUrl=e.url.replace(/\/$/,""),this.apiKey=e.apiKey,this.sessionIdKey=e.sessionIdKey||"SESSION_ID",this.sessionId=e.sessionId,this.Asset.prototype.baseUrl=this.apiUrl,this.GadgetProject.prototype.apiUrl=this.apiUrl},setSIDHeader:function(e,t){var n;n=(t!=null?t.useApiKey:void 0)?this.apiKey:this.sessionId;if(!this.sessionIdKey||!n)return;return e.setRequestHeader(this.sessionIdKey,n)},init:function(e){var n,u,a=this;e==null&&(e={}),s.extend(this,t.Events),this.uploadAdapter=(e!=null?e.uploadAdapter:void 0)||this.getUploadAdapter(),e.url||(e.url=e.apiUrl),e.url&&this.connect(e),this.GadgetProject.prototype.requirejs=e.requirejs;if(!this._backbonePatched)return this._backbonePatched=!0,n=t.ajax,t.ajax=function(e){return e.upload&&a.uploadAdapter?a.uploadAdapter.ajax.apply(a.uploadAdapter,arguments):n.apply(a,arguments)},u=t.sync,t.sync=function(e,t,n){var f,l,c,h;return n==null&&(n={}),n=s.clone(n),c=n.url||s.result(t,"url"),c.match(/^https?:\/\//)?n.url=c:n.url=a.apiUrl+c,f=n.beforeSend,n.beforeSend=function(e){a.setSIDHeader(e,n);if(f)return f.apply(a,arguments)},n.upload&&(n.data=a.uploadAdapter.createFormData(t)),l=n.success||s.identity,n.success=s.wrap(l,function(){var e,n,i;n=arguments[0],e=2<=arguments.length?o.call(arguments,1):[];if(i=typeof h.getResponseHeader=="function"?h.getResponseHeader("X-Pagination"):void 0)t.pagination=new r(JSON.parse(i));return n.apply(this,e)}),h=u.apply(a,arguments),h.requestUrl=n.url,s.isFunction(h.done)&&(i.trigger("xhr:start",h),h.done(s.bind(i.trigger,i,"xhr:success")),h.fail(s.bind(i.trigger,i,"xhr:error"))),h}},getUploadAdapter:function(){var t;return t=typeof Buffer!="undefined",t?new(e("./adapters/node")):new(e("./adapters/browser"))}}}).call(this)}),n("underscore",[],function(){return window._}),n("backbone",[],function(){return window.Backbone}),n("jquery",[],function(){return window.$}),n("adapters/node",[],function(){}),t("api")}),function(e,t){typeof define=="function"&&define.amd&&define("plugins/vs.collab",t),e.vs||(e.vs={}),e.vs.collab=t()}(this,function(){var e,t,n;return function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),w=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n.apply(a[e],g);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!w)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../src/build/almond",function(){}),n("handler",["require","exports","module","./collab"],function(e,t,n){(function(){var t,r;r=e("./collab"),t=function(){function e(e){this.conn=e,this.mediator=this.conn.mediator,this.conn.on("ws:open",this.listenToMediator,this),this.conn.on("ws:close",this.stopListeningToMediator,this)}return e.prototype.listenToMediator=function(){var e,t,n,r;if(!this.events)return;n=this.events,r=[];for(t in n)e=n[t],r.push(this.mediator.on(t,this[e],this));return r},e.prototype.stopListeningToMediator=function(){var e,t,n,r;if(!this.events)return;n=this.events,r=[];for(t in n)e=n[t],r.push(this.mediator.off(t,this[e],this));return r},e}(),n.exports=t}).call(this)}),n("models/user",["require","exports","module","backbone"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t}(t.Model),n.exports=r}).call(this)}),n("collections/users",["require","exports","module","backbone","../models/user"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=e("../models/user"),i=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.model=r,t}(t.Collection),n.exports=i}).call(this)}),n("handlers/users",["require","exports","module","underscore","../handler","../collections/users"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=e("underscore"),t=e("../handler"),r=e("../collections/users"),i=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return a(t,e),t.prototype.events={"user:me":"onUserIdentity","gadget:activity":"onGadgetActivity","users:list":"onUsersList","user:add":"onUserAdd","user:remove":"onUserRemove"},t.prototype.onUserIdentity=function(e){return this.conn.me=e},t.prototype.onGadgetActivity=function(){return this.conn.resetLastActivity()},t.prototype.onUsersList=function(e){return this._activeUsers=new r(e),this.mediator.trigger("collab:activeUsers:update",this._activeUsers)},t.prototype.onUserAdd=function(e){return this._activeUsers.add(e),this.mediator.trigger("collab:activeUsers:update",this._activeUsers)},t.prototype.onUserRemove=function(e){return this._activeUsers.remove(this._activeUsers.get(e.id)),this.mediator.trigger("collab:activeUsers:update",this._activeUsers)},t}(t),n.exports=i}).call(this)}),n("models/gadget_lock",["require","exports","module","backbone"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t.prototype.defaults=function(){return{createdAt:new Date}},t.prototype.isLockedByMe=function(){return!!this.get("editable")},t}(t.Model),n.exports=r}).call(this)}),n("handlers/locks",["require","exports","module","underscore","../handler","../models/gadget_lock"],function(e,t,n){(function(){var t,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=e("underscore"),r=e("../handler"),t=e("../models/gadget_lock"),i=function(e){function n(){return o=n.__super__.constructor.apply(this,arguments),o}return a(n,e),n.prototype.events={"locks:list":"onLocksList","gadget:editing:start":"onGadgetEditing","gadget:editing:stop":"onGadgetStopEditing","lock:lock":"onLock","lock:unlock":"onUnlock"},n.prototype.onLocksList=function(e){var t=this;return e.each(function(e){return t.mediator.trigger("lock:lock",e)}),this.conn.activeLocks.reset(e.models)},n.prototype.onGadgetEditing=function(e){var n;return this.conn.triggerEvent("lock:lock",{gadgetId:e.id}),n=new t({gadgetId:e.id,user:this.conn.me,editable:!0}),this.mediator.trigger("lock:lock",n)},n.prototype.onGadgetStopEditing=function(e){return this.conn.triggerEvent("lock:unlock",{gadgetId:e.id})},n.prototype.onLock=function(e){return this.conn.activeLocks.add(e)},n.prototype.onUnlock=function(e){return this.conn.activeLocks.remove(this.conn.activeLocks.findWhere({gadgetId:e.get("gadgetId")}))},n}(r),n.exports=i}).call(this)}),n("handlers/comments",["require","exports","module","underscore","../handler"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=e("underscore"),r=e("../handler"),t=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype._unresolvedIds={},t.prototype.events={"comments:list":"onCommentsList","comment:resolve":"onCommentResolve","comment:added":"onCommentAdded","comment:deleted":"onCommentDeleted"},t.prototype.onCommentsList=function(e){var t=this;return this._personalizeCollection(e).each(function(e){return t.mediator.trigger("comment:add",e)})},t.prototype.onCommentResolve=function(e){var t,n;t=e.get("cid"),n=this._unresolvedIds[t];if(n)return n.set({id:e.id}),delete this._unresolvedIds[t]},t.prototype.onCommentAdded=function(e){return this._pendComment(e),this.conn.triggerEvent("comment:add",{gadgetId:e.get("gadgetId"),body:e.get("body"),cid:e.cid}),e.set({user:this.conn.me}),e.editable=!0,this.mediator.trigger("comment:add",e)},t.prototype.onCommentDeleted=function(e){var t;return t={gadgetId:e.get("gadgetId"),commentId:e.id},this.conn.triggerEvent("comment:delete",t),e.deleted=!0,this.mediator.trigger("comment:delete",t)},t.prototype._personalizeCollection=function(e){var t=this;return e.each(function(e){if(e.get("user").id===t.conn.me.id)return e.editable=!0}),e},t.prototype._pendComment=function(e){return this._unresolvedIds[e.cid]=e},t}(r),n.exports=t}).call(this)}),n("handlers/updates",["require","exports","module","../handler"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("../handler"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t.prototype.events={"course:update":"_onCourseUpdate","lesson:gadget:added":"_onLessonChanged","lesson:gadget:moved":"_onLessonChanged","lesson:gadget:deleted":"_onLessonChanged","gadget:changed":"_onGadgetChanged"},t.prototype._onLessonChanged=function(e,t){return t?this.conn.triggerEvent("course:update",{gadgetId:t.id}):this.conn.triggerEvent("course:update")},t.prototype._onGadgetChanged=function(e){return this.conn.triggerEvent("course:update",{gadgetId:e.id})},t.prototype._onCourseUpdate=function(e){return this.conn.updates.push(e),this.mediator.trigger("collab:update")},t}(t),n.exports=r}).call(this)}),n("models/gadget_comment",["require","exports","module","backbone"],function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=e("backbone"),r=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments),i}return o(t,e),t.prototype.editable=!1,t.prototype.defaults=function(){return{createdAt:new Date,deleted:!1}},t.prototype.isDeleted=function(){return!!this.get("deleted")},t}(t.Model),n.exports=r}).call(this)}),n("collections/gadget_comments",["require","exports","module","../models/gadget_comment","backbone"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("../models/gadget_comment"),t=e("backbone"),i=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.model=r,t}(t.Collection),n.exports=i}).call(this)}),n("collections/gadget_locks",["require","exports","module","../models/gadget_lock","backbone"],function(e,t,n){(function(){var t,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=e("../models/gadget_lock"),t=e("backbone"),i=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments),s}return u(t,e),t.prototype.model=r,t}(t.Collection),n.exports=i}).call(this)}),n("collab",["require","exports","module","underscore","backbone","./handlers/users","./handlers/locks","./handlers/comments","./handlers/updates","./models/gadget_comment","./collections/gadget_comments","./models/gadget_lock","./collections/gadget_locks"],function(e,t,n){(function(){var t,r,i,s,o,u,a,f=function(e,t){return function(){return e.apply(t,arguments)}};a=e("underscore"),t=e("backbone"),u=e("./handlers/users"),s=e("./handlers/locks"),i=e("./handlers/comments"),o=e("./handlers/updates"),r=function(){function n(){this.phoneHome=f(this.phoneHome,this),this.onMessage=f(this.onMessage,this),this.onClose=f(this.onClose,this),this.onOpen=f(this.onOpen,this),this.onError=f(this.onError,this),this.connect=f(this.connect,this)}return a.extend(n.prototype,t.Events),n.prototype.GadgetComment=e("./models/gadget_comment"),n.prototype.GadgetComments=e("./collections/gadget_comments"),n.prototype.GadgetLock=e("./models/gadget_lock"),n.prototype.GadgetLocks=e("./collections/gadget_locks"),n.prototype.phoneHomeEveryMs=6e4,n.prototype.tryConnectingEveryMs=2e3,n.prototype.lastActivity=new Date,n.prototype.updates=[],n.prototype.init=function(e,t){var n=this;return this.mediator=e,this.courseId=t.courseId,this.collabUrl=t.collabUrl,this.lessonId=t.lessonId,this.sessionId=t.api.sessionId,this.connect(),this.resetLastActivity(),new u(this),new s(this),new i(this),new o(this),this.enabled=!1,this.activeLocks=new this.GadgetLocks,this.mediator.on("lesson:opened",function(e){return n.subscribe(e.id)}),this.mediator.on("lesson:closed",function(e){return n.unsubscribe(e.id)})},n.prototype.connect=function(){return this.socket=new WebSocket(this.collabUrl),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onerror=this.onError,this.socket.onmessage=this.onMessage},n.prototype.onError=function(e){var t;return t=e.channel?"error connecting to course "+e.channel.courseId+" lesson "+e.channel.courseId:"error connecting to "+this.collabUrl,this.trigger("ws:error",t,e)},n.prototype.onOpen=function(){return this.subscribe(this.lessonId),this.cancelRetryConnect(),this.phoneHomePeriodically(),this.enabled=!0,this.trigger("ws:open")},n.prototype.subscribe=function(e){this.lessonId=e;if(!this.lessonId)throw new Error("No lesson ID to subscribe to");return this.triggerEvent("subscribe",{sessionId:this.sessionId})},n.prototype.unsubscribe=function(){return this.triggerEvent("unsubscribe"),delete this.lessonId},n.prototype.onClose=function(){return clearTimeout(this.phoneHomeId),this.scheduleRetryConnect(),this.enabled=!1,this.trigger("ws:close")},n.prototype.resetLastActivity=function(){return this.lastActivity=(new Date).getTime()},n.prototype.onMessage=function(e){var t,n;n=JSON.parse(e.data),t=this._dataToModels(n),this.mediator.trigger(n.name,t);if(n.name==="users:list")return this.onReady()},n.prototype.onReady=function(){return this.mediator.trigger("course:collab:ready")},n.prototype.scheduleRetryConnect=function(){return this.retryId=setTimeout(this.connect,this.tryConnectingEveryMs)},n.prototype.cancelRetryConnect=function(){if(this.retryId)return clearTimeout(this.retryId)},n.prototype.phoneHome=function(){var e;return e=(new Date).getTime(),this.triggerEvent("ping",{idleMs:e-this.lastActivity})},n.prototype.phoneHomePeriodically=a.once(function(){return this.phoneHomeId=setInterval(this.phoneHome,this.phoneHomeEveryMs)}),n.prototype.triggerEvent=function(e,t){var n;return n={lessonId:this.lessonId,courseId:this.courseId},this.socket.send(JSON.stringify({name:e,channel:n,data:t}))},n.prototype.hasUpdates=function(){return!!this.updates.length},n.prototype.updateCount=function(){return this.updates.length},n.prototype.resetUpdates=function(){return this.updates=[]},n.prototype.hasGadgetUpdates=function(){return a.any(this.updates,function(e){return a.has(e,"gadgetId")})},n.prototype.gadgetHasUpdates=function(e){return!!a.findWhere(this.updates,{gadgetId:e})},n.prototype._dataToModels=function(e){var t,n,r,i,s,o;return i={comment:"GadgetComment",comments:"GadgetComments",lock:"GadgetLock",locks:"GadgetLocks"},n=this._dereferenceEventData(e),o=e.name.split(":"),r=o[0],t=o[1],s=i[r],s&&t!=="delete"?new vs.collab[s](n):n},n.prototype._dereferenceEventData=function(e){var t;return t=e.name.split(":").shift(),e.data[t]},n}(),n.exports=new r}).call(this)}),n("underscore",[],function(){return window._}),n("backbone",[],function(){return window.Backbone}),t("collab")}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!templates/course.html",[],function(){return'<div class="updateNotificationContainer hide">\n  <div class="updateNotification">\n    <i class="icon-refresh"></i><span class="updateNotificationMsg">See new update<span>\n  </div>\n</div>\n\n<div class="js-loading loading"></div>\n<div class="js-lessons lessons"></div>\n\n<div class="js-nav nav"></div>\n'}),function(){var e=[].slice;define("messages/channel",[],function(){var t;return t=function(){function t(){this._subscribers=[],this.channels={}}return t.prototype.on=function(e,t){var n;return t==null&&(t=this),n={context:t,callback:e},this._subscribers.push(n)},t.prototype.off=function(e,t){var n,r,i,s,o;t==null&&(t=null),o=[];for(n=i=s=this._subscribers.length-1;i>=0;n=i+=-1)r=this._subscribers[n],e?r.callback===e?t==null||r.context===t?o.push(this._subscribers.splice(n,1)):o.push(void 0):o.push(void 0):o.push(this._subscribers.splice(n,1));return o},t.prototype.trigger=function(){var t,n,r,i,s,o;t=1<=arguments.length?e.call(arguments,0):[],s=this._subscribers,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(n.callback.apply(n.context,t));return o},t}()})}.call(this),function(){var e=[].slice;define("messages/mediator",["messages/channel"],function(t){var n;return n=function(){function n(){this.channels=new t}return n.prototype.getChannel=function(e){var n,r,i,s;n=e.split(":"),r=this.channels;while(n.length)s=n.shift(),i=r.channels,i[s]||(i[s]=new t),r=i[s];return r},n.prototype.on=function(e,t,n){var r,i,s,o,u,a;if(!e)return;u=e.split(" "),a=[];for(s=0,o=u.length;s<o;s++)i=u[s],r=this.getChannel(i),a.push(r.on(t,n!=null?n:n=this));return a},n.prototype.off=function(e,t,n){var r,i,s,o,u,a;if(!e)return;u=e.split(" "),a=[];for(s=0,o=u.length;s<o;s++)i=u[s],r=this.getChannel(i),a.push(r.off(t,n!=null?n:n=this));return a},n.prototype.trigger=function(){var t,n,r,i,s;i=arguments[0],r=2<=arguments.length?e.call(arguments,1):[],t=i.split(":"),n=this.channels,s=[];while(t.length){if(!(n=n.channels[t.shift()]))break;t.length?s.push(n.trigger.apply(n,[t.join(":")].concat(e.call(r)))):s.push(n.trigger.apply(n,r))}return s},n.prototype.triggerGadgetEvent=function(){var t,n,r;return n=arguments[0],r=arguments[1],t=3<=arguments.length?e.call(arguments,2):[],r="gadget:"+n+":"+r,this.trigger.apply(this,[r].concat(e.call(t)))},n}()})}.call(this),function(){define("app/mediator",["messages/mediator"],function(e){var t;return t=new e})}.call(this),function(){define("plugins/clonedeep",[],function(){var e;return e=function(t){var n,r,i;if(t===null||typeof t!="object")return t;r=t.constructor();for(n in t)i=t[n],r[n]=e(i);return r}})}.call(this),function(){define("models/settings",["cdn.underscore","plugins/clonedeep"],function(e,t){var n,r,i;return n={whitelabel:!1,embed:!1,site:"//versal.com",container:".player-container",sdk:!1},r={},i=function(e){return typeof e.api=="string"&&(e.api={url:e.api}),e.sid&&(e.api.sessionId=e.sid,delete e.sid),e.course&&(e.courseId=e.course,delete e.course),delete e.event,e},{get:function(e){return t(r[e])},set:function(t){if(!e.isEmpty(r))throw new Error("Options have already been set");if(!e.isObject(t))throw new Error("Options must be an object");if(t.api==null)throw new Error("Please set options.api!");return r=e.defaults({},i(t),n)},toJSON:function(){return t(r)}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("plugins/tracker",["cdn.underscore","cdn.jquery","models/settings"],function(t,n,r){var i,s,o,u,a,f,l;return u=[],o=((l=r.get("tracker"))!=null?l.interval:void 0)||2e4,a=function(){var e,i,s,o;return i=(s=r.get("tracker"))!=null?s.path:void 0,!i||u.length<1?!1:(e=t.clone(u),n.ajax({type:"POST",url:i,contentType:"application/json",data:JSON.stringify(u),success:function(){return u=t.difference(u,e)},headers:(o=r.get("tracker"))!=null?o.headers:void 0}))},f=t.throttle(a,o,{leading:!1}),i=function(){function e(e){this._name=e.name||"",this._initialData=e.data||{},this._stopCb=e.done||function(){},this._startTime=this._currentTime()}return e.prototype.stop=function(e){return this._stopCb({name:this._name,data:t.extend({},this._initialData,e),duration:this._currentTime()-this._startTime})},e.prototype._currentTime=function(){return(new Date).getTime()},e}(),s=function(){function n(t){this._source=t,this._addTypes=e(this._addTypes,this),this._mixin={}}return n.prototype.track=function(e,n){return n==null&&(n={}),u.push(this._addTypes({source:this._source,event:e,data:t.extend({},this._mixin,n),ts_dt:Math.round((new Date).getTime()/1e3)})),f()},n.prototype.createTimer=function(e,n){var r,s=this;return n==null&&(n={}),r=function(e){var n,r,i;return i=e.name,n=e.data,r=e.duration,s.track(i,t.extend(n,{duration:r}))},new i({name:e,data:n,done:r})},n.prototype.setMixin=function(e){this._mixin=e},n.prototype.timeXHR=function(e,t,n){var r;return r=this.createTimer(t,n),e.always(function(e,t){return r.stop({status:t})})},n.prototype._addTypes=function(e){var n,r=this;return t.isArray(e)?t.map(e,this._addTypes):t.isObject(e)?(n=t.map(t.pairs(e),function(e){var n,i,s,o,u;return n=e[0],o=e[1],i=n+((u=n.slice(-3))==="_i"||u==="_f"||u==="_dt"||u==="_tsd"?"":t.isNumber(o)?o%1===0?"_i":"_f":t.isString(o)?"_tsd":""),s=t.isObject(o)?r._addTypes(o):o,[i,s]}),t.object(n)):e},n}()})}.call(this),function(){define("messages/player_tracker",["plugins/tracker"],function(e){return new e("player")})}.call(this),define("plugins/vs.ui",["cdn.backbone"],function(){var e,t,n;return function(r){function i(e,t){return E.call(e,t)}function s(e,t){var n,r,i,s,o,u,a,f,l,c,h=t&&t.split("/"),p=b.map,d=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),f=0;f<e.length;f+=1)if(c=e[f],"."===c)e.splice(f,1),f-=1;else if(".."===c){if(1===f&&(".."===e[2]||".."===e[0]))break;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||d)&&p){for(n=e.split("/"),f=n.length;f>0;f-=1){if(r=n.slice(0,f).join("/"),h)for(l=h.length;l>0;l-=1)if(i=p[h.slice(0,l).join("/")],i&&(i=i[r])){s=i,o=f;break}if(s)break;!u&&d&&d[r]&&(u=d[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function u(e,t){return function(){return d.apply(r,S.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return s(t,e)}}function f(e){return function(t){g[e]=t}}function l(e){if(i(y,e)){var t=y[e];delete y[e],w[e]=!0,p.apply(r,t)}if(!i(g,e)&&!i(w,e))throw new Error("No "+e);return g[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function h(e){return function(){return b&&b.config&&b.config[e]||{}}}var p,d,v,m,g={},y={},b={},w={},E=Object.prototype.hasOwnProperty,S=[].slice;v=function(e,t){var n,r=c(e),i=r[0];return e=r[1],i&&(i=s(i,t),n=l(i)),i?e=n&&n.normalize?n.normalize(e,a(t)):s(e,t):(e=s(e,t),r=c(e),i=r[0],e=r[1],i&&(n=l(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},m={require:function(e){return u(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:h(e)}}},p=function(e,t,n,s){var o,a,c,h,p,d,b=[];if(s=s||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(h=v(t[p],s),a=h.f,"require"===a)b[p]=m.require(e);else if("exports"===a)b[p]=m.exports(e),d=!0;else if("module"===a)o=b[p]=m.module(e);else if(i(g,a)||i(y,a)||i(w,a))b[p]=l(a);else{if(!h.p)throw new Error(e+" missing "+a);h.p.load(h.n,u(s,!0),f(a),{}),b[p]=g[a]}c=n.apply(g[e],b),e&&(o&&o.exports!==r&&o.exports!==g[e]?g[e]=o.exports:c===r&&d||(g[e]=c))}else e&&(g[e]=n)},e=t=d=function(e,t,n,i,s){return"string"==typeof e?m[e]?m[e](t):l(v(e,t).f):(e.splice||(b=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},"function"==typeof n&&(n=i,i=s),i?p(r,e,t,n):setTimeout(function(){p(r,e,t,n)},4),d)},d.config=function(e){return b=e,b.deps&&d(b.deps,b.callback),d},e._defined=g,n=function(e,t,n){t.splice||(n=t,t=[]),i(g,e)||i(y,e)||(y[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("libs/almond",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};n("editable_text",[],function(){var t,n,r;return n=[],r=function(e){var t,n;return t=document.createRange(),t.selectNodeContents(e),n=window.getSelection(),n.removeAllRanges(),n.addRange(t),e.focus()},t=function(){function t(t){this.onFocus=e(this.onFocus,this),this.onBlur=e(this.onBlur,this),this.onKeyUp=e(this.onKeyUp,this),this.onKeyPress=e(this.onKeyPress,this),this.onKeyDown=e(this.onKeyDown,this),n.push(this),this.options=_.defaults(t,_.result(this,"defaults")),this.$el=this.options.el,this.$el.attr("contenteditable",!1),this.$el.addClass("vs-ui-editable-text"),this._isEditing=!1,this.options.charCount&&this.attachCharacterCount(this.options.charCount),this.$el.on(this.events())}return t.prototype.defaults=function(){return{el:$("<div>"),type:"input",charCount:0,success:function(){},abort:function(){},complete:function(){},maxlength:!1}},t.prototype.events=function(){return{blur:this.onBlur,focus:this.onFocus,keyup:this.onKeyUp,keydown:this.onKeyDown,keypress:this.onKeyPress}},t.prototype.onKeyDown=function(e){return 13===e.keyCode&&"input"===this.options.type&&(e.preventDefault(),this.success(),this.$el.blur()),27===e.keyCode?(e.preventDefault(),this.setText(this._oldContent),this.abort()):void 0},t.prototype.onKeyPress=function(e){var t,n,r;return t=e.originalEvent,r=!!(t.char||t.charCode&&String.fromCharCode(t.charCode)),n=this.getPretty().length,this.options.maxlength&&n>=this.options.maxlength&&r?e.preventDefault():void 0},t.prototype.onKeyUp=function(e){var t;return t=this.getPretty().length,this.options.maxlength&&t>this.options.maxlength&&this.setText(this.getPretty().slice(0,this.options.maxlength)),t||13===e.keyCode||this.$el.empty(),this.setCurrentCount(t)},t.prototype.onBlur=function(){return this.success(),this.hideCharCount()},t.prototype.onFocus=function(){return this.showCharCount()},t.prototype.selectText=function(){var e=this;return _.defer(function(){return r(e.$el[0])})},t.prototype.toggleEdit=function(e,t){var s,u=this;return null==t&&(t=!0),s=_.isBoolean(e),s&&e===this._isEditing?void 0:(this._isEditing=s?e:!this._isEditing,this._isEditing?(this.$el.attr("contenteditable",!0),t?_.defer(function(){return r(u.$el[0])}):this.hideCharCount(),this._oldContent=this.getPretty(),_.each(n,function(e){return u!==e&&e._isEditing?e.abort():void 0})):this.$el.attr("contenteditable",!1))},t.prototype.setText=function(e){return e?(this.$el.text(e),this.$el.html(this.$el.html().replace(/\n/gi,"<br>"))):void 0},t.prototype.getPretty=function(){var e;return e=$.trim(this.$el.html().replace(/\n/gi,"").replace(/<div><br><\/div>/gi,"\n").replace(/<div>/gi,"\n").replace(/<\/div>/gi,"").replace(/<br>/gi,"\n").replace(/\&nbsp\;/gi," ")),$("<div>").html(e).text()},t.prototype.attachCharacterCount=function(e){var t;return this.count=e,t='<div class="character-count pull-right">'+this.getPretty().length+"/"+this.count+"</div>",this.charCount=$(t),this.$el.after(this.charCount)},t.prototype.setCurrentCount=function(e){if(this.charCount){if(this.charCount.text(e+"/"+this.count),e>this.count&&!this._errorSet)return this._errorSet=!0,this.charCount.addClass("character-count-over");if(e<=this.count&&this._errorSet)return this._errorSet=!1,this.charCount.removeClass("character-count-over")}},t.prototype.showCharCount=function(){return this.charCount?this.charCount.removeClass("hidden"):void 0},t.prototype.hideCharCount=function(){return this.charCount?this.charCount.addClass("hidden"):void 0},t.prototype.abort=function(){return this.options.abort(),this.options.complete("abort")},t.prototype.success=function(){return this.options.success(this.getPretty()),this.options.complete("success")},t.prototype.destroy=function(){return this._isEditing&&this.toggleEdit(!1),this.$el.off(this.events()),n=_.without(n,this)},t}()})}.call(this),function(){n("loading",[],function(){var e;return e=function(){function e(e){var t,n;this.$parent=e,n=this.$parent.position(),t=$('<div class="loading">Loading</div>').css({top:n.top,left:n.left,position:"absolute"}),this.$el=t.appendTo(this.$parent)}return e.prototype.done=function(){return this.$el.remove()},e}()})}.call(this),n("../libs/spin",[],function(){return function(){function e(e,t){var n,r=document.createElement(e||"div");for(n in t)r[n]=t[n];return r}function t(e){for(var t=1,n=arguments.length;n>t;t++)e.appendChild(arguments[t]);return e}function n(e,t,n,r){var i=["opacity",t,~~(100*e),n,r].join("-"),s=.01+100*(n/r),o=Math.max(1-(1-e)/t*(100-s),e),u=f.substring(0,f.indexOf("Animation")).toLowerCase(),a=u&&"-"+u+"-"||"";return c[i]||(h.insertRule("@"+a+"keyframes "+i+"{"+"0%{opacity:"+o+"}"+s+"%{opacity:"+e+"}"+(s+.01)+"%{opacity:1}"+(s+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+o+"}"+"}",h.cssRules.length),c[i]=1),i}function r(e,t){var n,r,i=e.style;if(void 0!==i[t])return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),r=0;r<l.length;r++)if(n=l[r]+t,void 0!==i[n])return n}function i(e,t){for(var n in t)e.style[r(e,n)||n]=t[n];return e}function s(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)void 0===e[r]&&(e[r]=n[r])}return e}function o(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function u(e){return"undefined"==typeof this?new u(e):(this.opts=s(e||{},u.defaults,p),void 0)}function a(){function n(t,n){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}h.addRule(".spin-vml","behavior:url(#default#VML)"),u.prototype.lines=function(e,r){function s(){return i(n("group",{coordsize:f+" "+f,coordorigin:-a+" "+ -a}),{width:f,height:f})}function o(e,o,u){t(c,t(i(s(),{rotation:360/r.lines*e+"deg",left:~~o}),t(i(n("roundrect",{arcsize:r.corners}),{width:a,height:r.width,left:r.radius,top:-r.width>>1,filter:u}),n("fill",{color:r.color,opacity:r.opacity}),n("stroke",{opacity:0}))))}var u,a=r.length+r.width,f=2*a,l=2*-(r.width+r.length)+"px",c=i(s(),{position:"absolute",top:l,left:l});if(r.shadow)for(u=1;u<=r.lines;u++)o(u,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(u=1;u<=r.lines;u++)o(u);return t(e,c)},u.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var f,l=["webkit","Moz","ms","O"],c={},h=function(){var n=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}(),p={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};u.defaults={},s(u.prototype,{spin:function(t){this.stop();var n,r,s=this,u=s.opts,a=s.el=i(e(0,{className:u.className}),{position:u.position,width:0,zIndex:u.zIndex}),l=u.radius+u.length+u.width;if(t&&(t.insertBefore(a,t.firstChild||null),r=o(t),n=o(a),i(a,{left:("auto"==u.left?r.x-n.x+(t.offsetWidth>>1):parseInt(u.left,10)+l)+"px",top:("auto"==u.top?r.y-n.y+(t.offsetHeight>>1):parseInt(u.top,10)+l)+"px"})),a.setAttribute("role","progressbar"),s.lines(a,s.opts),!f){var c,h=0,p=(u.lines-1)*(1-u.direction)/2,d=u.fps,v=d/u.speed,m=(1-u.opacity)/(v*u.trail/100),g=v/u.lines;!function y(){h++;for(var e=0;e<u.lines;e++)c=Math.max(1-(h+(u.lines-e)*g)%v*m,u.opacity),s.opacity(a,e*u.direction+p,c,u);s.timeout=s.el&&setTimeout(y,~~(1e3/d))}()}return s},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(r,s){function o(t,n){return i(e(),{position:"absolute",width:s.length+s.width+"px",height:s.width+"px",background:t,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/s.lines*a+s.rotate)+"deg) translate("+s.radius+"px"+",0)",borderRadius:(s.corners*s.width>>1)+"px"})}for(var u,a=0,l=(s.lines-1)*(1-s.direction)/2;a<s.lines;a++)u=i(e(),{position:"absolute",top:1+~(s.width/2)+"px",transform:s.hwaccel?"translate3d(0,0,0)":"",opacity:s.opacity,animation:f&&n(s.opacity,s.trail,l+a*s.direction,s.lines)+" "+1/s.speed+"s linear infinite"}),s.shadow&&t(u,i(o("#000","0 0 4px #000"),{top:"2px"})),t(r,t(u,o(s.color,"0 0 1px rgba(0,0,0,.1)")));return r},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}});var d=i(e("group"),{behavior:"url(#default#VML)"});return!r(d,"transform")&&d.adj?a():f=r(d,"animation"),u}()}),function(){n("loading_indicator",["../libs/spin"],function(e){var t;return t=function(){function t(t,n){var r;null==n&&(n="#000"),r={lines:15,length:2,width:2,radius:8,corners:.4,rotate:0,direction:1,color:n,speed:.8,trail:46,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},t instanceof $&&(t=t[0]),this.spinner=(new e(r)).spin(t)}return t.prototype.stop=function(){return this.spinner.stop()},t}()})}.call(this),function(e){var t=!1,n=!1,r=5e3,i=2e3,s=0,o=function(){var e=document.getElementsByTagName("script"),e=e[e.length-1].src.split("?")[0];return 0<e.split("/").length?e.split("/").slice(0,-1).join("/")+"/":""}(),u=["ms","moz","webkit","o"],f=window.requestAnimationFrame||!1,l=window.cancelAnimationFrame||!1;if(!f)for(var c in u){var h=u[c];f||(f=window[h+"RequestAnimationFrame"]),l||(l=window[h+"CancelAnimationFrame"]||window[h+"CancelRequestAnimationFrame"])}var p=window.MutationObserver||window.WebKitMutationObserver||!1,d={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:!1,cursordragontouch:!1,oneaxismousemode:"auto"},v=!1,m=function(){if(v)return v;var e=document.createElement("DIV"),t={haspointerlock:"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document};t.isopera="opera"in window,t.isopera12=t.isopera&&"getUserMedia"in navigator,t.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),t.isie="all"in document&&"attachEvent"in e&&!t.isopera,t.isieold=t.isie&&!("msInterpolationMode"in e.style),t.isie7=!(!t.isie||t.isieold||"documentMode"in document&&7!=document.documentMode),t.isie8=t.isie&&"documentMode"in document&&8==document.documentMode,t.isie9=t.isie&&"performance"in window&&9<=document.documentMode,t.isie10=t.isie&&"performance"in window&&10<=document.documentMode,t.isie9mobile=/iemobile.9/i.test(navigator.userAgent),t.isie9mobile&&(t.isie9=!1),t.isie7mobile=!t.isie9mobile&&t.isie7&&/iemobile/i.test(navigator.userAgent),t.ismozilla="MozAppearance"in e.style,t.iswebkit="WebkitAppearance"in e.style,t.ischrome="chrome"in window,t.ischrome22=t.ischrome&&t.haspointerlock,t.ischrome26=t.ischrome&&"transition"in e.style,t.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,t.hasmstouch=window.navigator.msPointerEnabled||!1,t.ismac=/^mac$/i.test(navigator.platform),t.isios=t.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform),t.isios4=t.isios&&!("seal"in Object),t.isandroid=/android/i.test(navigator.userAgent),t.trstyle=!1,t.hastransform=!1,t.hastranslate3d=!1,t.transitionstyle=!1,t.hastransition=!1,t.transitionend=!1;for(var n=["transform","msTransform","webkitTransform","MozTransform","OTransform"],r=0;r<n.length;r++)if("undefined"!=typeof e.style[n[r]]){t.trstyle=n[r];break}t.hastransform=0!=t.trstyle,t.hastransform&&(e.style[t.trstyle]="translate3d(1px,2px,3px)",t.hastranslate3d=/translate3d/.test(e.style[t.trstyle])),t.transitionstyle=!1,t.prefixstyle="",t.transitionend=!1;for(var n="transition webkitTransition MozTransition OTransition OTransition msTransition KhtmlTransition".split(" "),i=" -webkit- -moz- -o- -o -ms- -khtml-".split(" "),s="transitionend webkitTransitionEnd transitionend otransitionend oTransitionEnd msTransitionEnd KhtmlTransitionEnd".split(" "),r=0;r<n.length;r++)if(n[r]in e.style){t.transitionstyle=n[r],t.prefixstyle=i[r],t.transitionend=s[r];break}t.ischrome26&&(t.prefixstyle=i[1]),t.hastransition=t.transitionstyle;e:{for(n=["-moz-grab","-webkit-grab","grab"],(t.ischrome&&!t.ischrome22||t.isie)&&(n=[]),r=0;r<n.length;r++)if(i=n[r],e.style.cursor=i,e.style.cursor==i){n=i;break e}n="url(http://www.google.com/intl/en_ALL/mapfiles/openhand.cur),n-resize"}return t.cursorgrabvalue=n,t.hasmousecapture="setCapture"in e,t.hasMutationObserver=!1!==p,v=t},g=function(u,a){function c(){var e=b.win;if("zIndex"in e)return e.zIndex();for(;0<e.length&&9!=e[0].nodeType;){var t=e.css("zIndex");if(!isNaN(t)&&0!=t)return parseInt(t);e=e.parent()}return!1}function h(e,t,n){return t=e.css(t),e=parseFloat(t),isNaN(e)?(e=x[t]||0,n=3==e?n?b.win.outerHeight()-b.win.innerHeight():b.win.outerWidth()-b.win.innerWidth():1,b.isie8&&e&&(e+=1),n?e:0):e}function v(e,t,n,r){b._bind(e,t,function(r){r=r?r:window.event;var i={original:r,target:r.target||r.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==r.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return r.preventDefault?r.preventDefault():r.returnValue=!1,!1},stopImmediatePropagation:function(){r.stopImmediatePropagation?r.stopImmediatePropagation():r.cancelBubble=!0}};return"mousewheel"==t?(i.deltaY=-0.025*r.wheelDelta,r.wheelDeltaX&&(i.deltaX=-0.025*r.wheelDeltaX)):i.deltaY=r.detail,n.call(e,i)},r)}function g(e,t,n){var r,i;if(0==e.deltaMode?(r=-Math.floor(e.deltaX*(b.opt.mousescrollstep/54)),i=-Math.floor(e.deltaY*(b.opt.mousescrollstep/54))):1==e.deltaMode&&(r=-Math.floor(e.deltaX*b.opt.mousescrollstep),i=-Math.floor(e.deltaY*b.opt.mousescrollstep)),t&&b.opt.oneaxismousemode&&0==r&&i&&(r=i,i=0),r&&(b.scrollmom&&b.scrollmom.stop(),b.lastdeltax+=r,b.debounced("mousewheelx",function(){var e=b.lastdeltax;b.lastdeltax=0,b.rail.drag||b.doScrollLeftBy(e)},120)),i){if(b.opt.nativeparentscrolling&&n&&!b.ispage&&!b.zoomactive)if(0>i){if(b.getScrollTop()>=b.page.maxh)return!0}else if(0>=b.getScrollTop())return!0;b.scrollmom&&b.scrollmom.stop(),b.lastdeltay+=i,b.debounced("mousewheely",function(){var e=b.lastdeltay;b.lastdeltay=0,b.rail.drag||b.doScrollBy(e)},120)}return e.stopImmediatePropagation(),e.preventDefault()}var b=this;if(this.version="3.5.2",this.name="nicescroll",this.me=a,this.opt={doc:e("body"),win:!1},e.extend(this.opt,d),this.opt.snapbackspeed=80,u)for(var w in b.opt)"undefined"!=typeof u[w]&&(b.opt[w]=u[w]);this.iddoc=(this.doc=b.opt.doc)&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/BODY|HTML/.test(b.opt.win?b.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==b.opt.win,this.win=b.opt.win||(this.ispage?e(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?e(window):this.win,this.body=e("body"),this.iframe=this.isfixed=this.viewport=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=b.opt.autohidemode,this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart=this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.observerremover=this.observer=this.scrollmom=this.scrollrunning=this.checkrtlmode=!1;do this.id="ascrail"+i++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.selectiondrag=this.cursorfreezed=this.cursor=this.rail=!1,this.visibility=!0,this.hidden=this.locked=!1,this.cursoractive=!0,this.overflowx=b.opt.overflowx,this.overflowy=b.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltay=this.lastdeltax=0,this.detected=m();var E=e.extend({},this.detected);if(this.ishwscroll=(this.canhwscroll=E.hastransform&&b.opt.hwacceleration)&&b.haswrapper,this.istouchcapable=!1,E.cantouch&&E.ischrome&&!E.isios&&!E.isandroid&&(this.istouchcapable=!0,E.cantouch=!1),E.cantouch&&E.ismozilla&&!E.isios&&!E.isandroid&&(this.istouchcapable=!0,E.cantouch=!1),b.opt.enablemouselockapi||(E.hasmousecapture=!1,E.haspointerlock=!1),this.delayed=function(e,t,n,r){var i=b.delaylist[e],s=(new Date).getTime();return!r&&i&&i.tt?!1:(i&&i.tt&&clearTimeout(i.tt),i&&i.last+n>s&&!i.tt?b.delaylist[e]={last:s+n,tt:setTimeout(function(){b.delaylist[e].tt=0,t.call()},n)}:i&&i.tt||(b.delaylist[e]={last:s,tt:0},setTimeout(function(){t.call()},0)),void 0)},this.debounced=function(e,t,n){var r=b.delaylist[e];(new Date).getTime(),b.delaylist[e]=t,r||setTimeout(function(){var t=b.delaylist[e];b.delaylist[e]=!1,t.call()},n)},this.synched=function(e,t){return b.synclist[e]=t,function(){b.onsync||(f(function(){b.onsync=!1;for(e in b.synclist){var t=b.synclist[e];t&&t.call(b),b.synclist[e]=!1}}),b.onsync=!0)}(),e},this.unsynched=function(e){b.synclist[e]&&(b.synclist[e]=!1)},this.css=function(e,t){for(var n in t)b.saved.css.push([e,n,e.css(n)]),e.css(n,t[n])},this.scrollTop=function(e){return"undefined"==typeof e?b.getScrollTop():b.setScrollTop(e)},this.scrollLeft=function(e){return"undefined"==typeof e?b.getScrollLeft():b.setScrollLeft(e)},BezierClass=function(e,t,n,r,i,s,o){this.st=e,this.ed=t,this.spd=n,this.p1=r||0,this.p2=i||1,this.p3=s||0,this.p4=o||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st},BezierClass.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=1-((new Date).getTime()-this.ts)/this.spd,t=this.B2(e)+this.B3(e)+this.B4(e);return 0>e?this.ed:this.st+Math.round(this.df*t)},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},E.hastranslate3d&&E.isios&&this.doc.css("-webkit-backface-visibility","hidden");var S=function(){var e=b.doc.css(E.trstyle);return e&&"matrix"==e.substr(0,6)?e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/):!1};this.getScrollTop=function(e){if(!e){if(e=S())return 16==e.length?-e[13]:-e[5];if(b.timerscroll&&b.timerscroll.bz)return b.timerscroll.bz.getNow()}return b.doc.translate.y},this.getScrollLeft=function(e){if(!e){if(e=S())return 16==e.length?-e[12]:-e[4];if(b.timerscroll&&b.timerscroll.bh)return b.timerscroll.bh.getNow()}return b.doc.translate.x},this.notifyScrollEvent=document.createEvent?function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),e.dispatchEvent(t)}:document.fireEvent?function(e){var t=document.createEventObject();e.fireEvent("onscroll"),t.cancelBubble=!0}:function(){},E.hastranslate3d&&b.opt.enabletranslate3d?(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=-1*e+"px",b.doc.css(E.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=-1*e+"px",b.doc.css(E.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])}):(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=-1*e+"px",b.doc.css(E.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=-1*e+"px",b.doc.css(E.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])})}else this.getScrollTop=function(){return b.docscroll.scrollTop()},this.setScrollTop=function(e){return b.docscroll.scrollTop(e)},this.getScrollLeft=function(){return b.docscroll.scrollLeft()},this.setScrollLeft=function(e){return b.docscroll.scrollLeft(e)};this.getTarget=function(e){return e?e.target?e.target:e.srcElement?e.srcElement:!1:!1},this.hasParent=function(e,t){if(!e)return!1;for(var n=e.target||e.srcElement||e||!1;n&&n.id!=t;)n=n.parentNode||!1;return!1!==n};var x={thin:1,medium:3,thick:5};this.getOffset=function(){if(b.isfixed)return{top:parseFloat(b.win.css("top")),left:parseFloat(b.win.css("left"))};if(!b.viewport)return b.win.offset();var e=b.win.offset(),t=b.viewport.offset();return{top:e.top-t.top+b.viewport.scrollTop(),left:e.left-t.left+b.viewport.scrollLeft()}},this.updateScrollBar=function(e){if(b.ishwscroll)b.rail.css({height:b.win.innerHeight()}),b.railh&&b.railh.css({width:b.win.innerWidth()});else{var t=b.getOffset(),n=t.top,r=t.left,n=n+h(b.win,"border-top-width",!0);b.win.outerWidth(),b.win.innerWidth();var r=r+(b.rail.align?b.win.outerWidth()-h(b.win,"border-right-width")-b.rail.width:h(b.win,"border-left-width")),i=b.opt.railoffset;i&&(i.top&&(n+=i.top),b.rail.align&&i.left&&(r+=i.left)),b.locked||b.rail.css({top:n,left:r,height:e?e.h:b.win.innerHeight()}),b.zoom&&b.zoom.css({top:n+1,left:1==b.rail.align?r-20:r+b.rail.width+4}),b.railh&&!b.locked&&(n=t.top,r=t.left,e=b.railh.align?n+h(b.win,"border-top-width",!0)+b.win.innerHeight()-b.railh.height:n+h(b.win,"border-top-width",!0),r+=h(b.win,"border-left-width"),b.railh.css({top:e,left:r,width:b.railh.width}))}},this.doRailClick=function(e,t,n){var r;b.locked||(b.cancelEvent(e),t?(t=n?b.doScrollLeft:b.doScrollTop,r=n?(e.pageX-b.railh.offset().left-b.cursorwidth/2)*b.scrollratio.x:(e.pageY-b.rail.offset().top-b.cursorheight/2)*b.scrollratio.y,t(r)):(t=n?b.doScrollLeftBy:b.doScrollBy,r=n?b.scroll.x:b.scroll.y,e=n?e.pageX-b.railh.offset().left:e.pageY-b.rail.offset().top,n=n?b.view.w:b.view.h,r>=e?t(n):t(-n)))},b.hasanimationframe=f,b.hascancelanimationframe=l,b.hasanimationframe?b.hascancelanimationframe||(l=function(){b.cancelAnimationFrame=!0}):(f=function(e){return setTimeout(e,15-Math.floor(+(new Date)/1e3)%16)},l=clearInterval),this.init=function(){if(b.saved.css=[],E.isie7mobile||E.isoperamini)return!0;if(E.hasmstouch&&b.css(b.ispage?e("html"):b.win,{"-ms-touch-action":"none"}),b.zindex="auto",b.zindex=b.ispage||"auto"!=b.opt.zindex?b.opt.zindex:c()||"auto",!b.ispage&&"auto"!=b.zindex&&b.zindex>s&&(s=b.zindex),b.isie&&0==b.zindex&&"auto"==b.opt.zindex&&(b.zindex="auto"),!b.ispage||!E.cantouch&&!E.isieold&&!E.isie9mobile){var i=b.docscroll;b.ispage&&(i=b.haswrapper?b.win:b.doc),E.isie9mobile||b.css(i,{"overflow-y":"hidden"}),b.ispage&&E.isie7&&("BODY"==b.doc[0].nodeName?b.css(e("html"),{"overflow-y":"hidden"}):"HTML"==b.doc[0].nodeName&&b.css(e("body"),{"overflow-y":"hidden"})),!E.isios||b.ispage||b.haswrapper||b.css(e("body"),{"-webkit-overflow-scrolling":"touch"});var u=e(document.createElement("div"));u.css({position:"relative",top:0,"float":"right",width:b.opt.cursorwidth,height:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),u.hborder=parseFloat(u.outerHeight()-u.innerHeight()),b.cursor=u;var a=e(document.createElement("div"));a.attr("id",b.id),a.addClass("nicescroll-rails");var f,l,h,d=["left","right"];for(h in d)l=d[h],(f=b.opt.railpadding[l])?a.css("padding-"+l,f+"px"):b.opt.railpadding[l]=0;if(a.append(u),a.width=Math.max(parseFloat(b.opt.cursorwidth),u.outerWidth())+b.opt.railpadding.left+b.opt.railpadding.right,a.css({width:a.width+"px",zIndex:b.zindex,background:b.opt.background,cursor:"default"}),a.visibility=!0,a.scrollable=!0,a.align="left"==b.opt.railalign?0:1,b.rail=a,u=b.rail.drag=!1,!b.opt.boxzoom||b.ispage||E.isieold||(u=document.createElement("div"),b.bind(u,"click",b.doZoom),b.zoom=e(u),b.zoom.css({cursor:"pointer","z-index":b.zindex,backgroundImage:"url("+o+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),b.opt.dblclickzoom&&b.bind(b.win,"dblclick",b.doZoom),E.cantouch&&b.opt.gesturezoom&&(b.ongesturezoom=function(e){return 1.5<e.scale&&b.doZoomIn(e),.8>e.scale&&b.doZoomOut(e),b.cancelEvent(e)},b.bind(b.win,"gestureend",b.ongesturezoom))),b.railh=!1,b.opt.horizrailenabled){b.css(i,{"overflow-x":"hidden"}),u=e(document.createElement("div")),u.css({position:"relative",top:0,height:b.opt.cursorwidth,width:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),u.wborder=parseFloat(u.outerWidth()-u.innerWidth()),b.cursorh=u;var v=e(document.createElement("div"));v.attr("id",b.id+"-hr"),v.addClass("nicescroll-rails"),v.height=Math.max(parseFloat(b.opt.cursorwidth),u.outerHeight()),v.css({height:v.height+"px",zIndex:b.zindex,background:b.opt.background}),v.append(u),v.visibility=!0,v.scrollable=!0,v.align="top"==b.opt.railvalign?0:1,b.railh=v,b.railh.drag=!1}if(b.ispage?(a.css({position:"fixed",top:"0px",height:"100%"}),a.align?a.css({right:"0px"}):a.css({left:"0px"}),b.body.append(a),b.railh&&(v.css({position:"fixed",left:"0px",width:"100%"}),v.align?v.css({bottom:"0px"}):v.css({top:"0px"}),b.body.append(v))):(b.ishwscroll?("static"==b.win.css("position")&&b.css(b.win,{position:"relative"}),i="HTML"==b.win[0].nodeName?b.body:b.win,b.zoom&&(b.zoom.css({position:"absolute",top:1,right:0,"margin-right":a.width+4}),i.append(b.zoom)),a.css({position:"absolute",top:0}),a.align?a.css({right:0}):a.css({left:0}),i.append(a),v&&(v.css({position:"absolute",left:0,bottom:0}),v.align?v.css({bottom:0}):v.css({top:0}),i.append(v))):(b.isfixed="fixed"==b.win.css("position"),i=b.isfixed?"fixed":"absolute",b.isfixed||(b.viewport=b.getViewport(b.win[0])),b.viewport&&(b.body=b.viewport,0==/fixed|relative|absolute/.test(b.viewport.css("position"))&&b.css(b.viewport,{position:"relative"})),a.css({position:i}),b.zoom&&b.zoom.css({position:i}),b.updateScrollBar(),b.body.append(a),b.zoom&&b.body.append(b.zoom),b.railh&&(v.css({position:i}),b.body.append(v))),E.isios&&b.css(b.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),E.isie&&b.opt.disableoutline&&b.win.attr("hideFocus","true"),E.iswebkit&&b.opt.disableoutline&&b.win.css({outline:"none"})),!1===b.opt.autohidemode?(b.autohidedom=!1,b.rail.css({opacity:b.opt.cursoropacitymax}),b.railh&&b.railh.css({opacity:b.opt.cursoropacitymax})):!0===b.opt.autohidemode||"leave"===b.opt.autohidemode?(b.autohidedom=e().add(b.rail),E.isie8&&(b.autohidedom=b.autohidedom.add(b.cursor)),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh)),b.railh&&E.isie8&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"scroll"==b.opt.autohidemode?(b.autohidedom=e().add(b.rail),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh))):"cursor"==b.opt.autohidemode?(b.autohidedom=e().add(b.cursor),b.railh&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"hidden"==b.opt.autohidemode&&(b.autohidedom=!1,b.hide(),b.locked=!1),E.isie9mobile)b.scrollmom=new y(b),b.onmangotouch=function(e){e=b.getScrollTop();var t=b.getScrollLeft();if(e==b.scrollmom.lastscrolly&&t==b.scrollmom.lastscrollx)return!0;var n=e-b.mangotouch.sy,r=t-b.mangotouch.sx;if(0!=Math.round(Math.sqrt(Math.pow(r,2)+Math.pow(n,2)))){var i=0>n?-1:1,s=0>r?-1:1,o=+(new Date);b.mangotouch.lazy&&clearTimeout(b.mangotouch.lazy),80<o-b.mangotouch.tm||b.mangotouch.dry!=i||b.mangotouch.drx!=s?(b.scrollmom.stop(),b.scrollmom.reset(t,e),b.mangotouch.sy=e,b.mangotouch.ly=e,b.mangotouch.sx=t,b.mangotouch.lx=t,b.mangotouch.dry=i,b.mangotouch.drx=s,b.mangotouch.tm=o):(b.scrollmom.stop(),b.scrollmom.update(b.mangotouch.sx-r,b.mangotouch.sy-n),b.mangotouch.tm=o,n=Math.max(Math.abs(b.mangotouch.ly-e),Math.abs(b.mangotouch.lx-t)),b.mangotouch.ly=e,b.mangotouch.lx=t,n>2&&(b.mangotouch.lazy=setTimeout(function(){b.mangotouch.lazy=!1,b.mangotouch.dry=0,b.mangotouch.drx=0,b.mangotouch.tm=0,b.scrollmom.doMomentum(30)},100)))}},a=b.getScrollTop(),v=b.getScrollLeft(),b.mangotouch={sy:a,ly:a,dry:0,sx:v,lx:v,drx:0,lazy:!1,tm:0},b.bind(b.docscroll,"scroll",b.onmangotouch);else{if(E.cantouch||b.istouchcapable||b.opt.touchbehavior||E.hasmstouch){b.scrollmom=new y(b),b.ontouchstart=function(t){if(t.pointerType&&2!=t.pointerType)return!1;if(b.hasmoving=!1,!b.locked){if(E.hasmstouch)for(var n=t.target?t.target:!1;n;){var r=e(n).getNiceScroll();if(0<r.length&&r[0].me==b.me)break;if(0<r.length)return!1;if("DIV"==n.nodeName&&n.id==b.id)break;n=n.parentNode?n.parentNode:!1}if(b.cancelScroll(),(n=b.getTarget(t))&&/INPUT/i.test(n.nodeName)&&/range/i.test(n.type))return b.stopPropagation(t);if(!("clientX"in t)&&"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),b.forcescreen&&(r=t,t={original:t.original?t.original:t},t.clientX=r.screenX,t.clientY=r.screenY),b.rail.drag={x:t.clientX,y:t.clientY,sx:b.scroll.x,sy:b.scroll.y,st:b.getScrollTop(),sl:b.getScrollLeft(),pt:2,dl:!1},b.ispage||!b.opt.directionlockdeadzone)b.rail.drag.dl="f";else{var r=e(window).width(),i=e(window).height(),s=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),o=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),i=Math.max(0,o-i),r=Math.max(0,s-r);b.rail.drag.ck=!b.rail.scrollable&&b.railh.scrollable?i>0?"v":!1:b.rail.scrollable&&!b.railh.scrollable?r>0?"h":!1:!1,b.rail.drag.ck||(b.rail.drag.dl="f")}if(b.opt.touchbehavior&&b.isiframe&&E.isie&&(r=b.win.position(),b.rail.drag.x+=r.left,b.rail.drag.y+=r.top),b.hasmoving=!1,b.lastmouseup=!1,b.scrollmom.reset(t.clientX,t.clientY),!E.cantouch&&!this.istouchcapable&&!E.hasmstouch){if(!n||!/INPUT|SELECT|TEXTAREA/i.test(n.nodeName))return!b.ispage&&E.hasmousecapture&&n.setCapture(),b.opt.touchbehavior?(n.onclick&&!n._onclick&&(n._onclick=n.onclick,n.onclick=function(e){return b.hasmoving?!1:(n._onclick.call(this,e),void 0)}),b.cancelEvent(t)):b.stopPropagation(t);/SUBMIT|CANCEL|BUTTON/i.test(e(n).attr("type"))&&(pc={tg:n,click:!1},b.preventclick=pc)}}},b.ontouchend=function(e){return e.pointerType&&2!=e.pointerType?!1:b.rail.drag&&2==b.rail.drag.pt&&(b.scrollmom.doMomentum(),b.rail.drag=!1,b.hasmoving&&(b.lastmouseup=!0,b.hideCursor(),E.hasmousecapture&&document.releaseCapture(),!E.cantouch))?b.cancelEvent(e):void 0};var m=b.opt.touchbehavior&&b.isiframe&&!E.hasmousecapture;b.ontouchmove=function(t,n){if(t.pointerType&&2!=t.pointerType)return!1;if(b.rail.drag&&2==b.rail.drag.pt){if(E.cantouch&&"undefined"==typeof t.original)return!0;if(b.hasmoving=!0,b.preventclick&&!b.preventclick.click&&(b.preventclick.click=b.preventclick.tg.onclick||!1,b.preventclick.tg.onclick=b.onpreventclick),t=e.extend({original:t},t),"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),b.forcescreen){var r=t;t={original:t.original?t.original:t},t.clientX=r.screenX,t.clientY=r.screenY}if(r=ofy=0,m&&!n){var i=b.win.position(),r=-i.left;ofy=-i.top}var s=t.clientY+ofy,i=s-b.rail.drag.y,o=t.clientX+r,u=o-b.rail.drag.x,a=b.rail.drag.st-i;if(b.ishwscroll&&b.opt.bouncescroll?0>a?a=Math.round(a/2):a>b.page.maxh&&(a=b.page.maxh+Math.round((a-b.page.maxh)/2)):(0>a&&(s=a=0),a>b.page.maxh&&(a=b.page.maxh,s=0)),b.railh&&b.railh.scrollable){var f=b.rail.drag.sl-u;b.ishwscroll&&b.opt.bouncescroll?0>f?f=Math.round(f/2):f>b.page.maxw&&(f=b.page.maxw+Math.round((f-b.page.maxw)/2)):(0>f&&(o=f=0),f>b.page.maxw&&(f=b.page.maxw,o=0))}if(r=!1,b.rail.drag.dl)r=!0,"v"==b.rail.drag.dl?f=b.rail.drag.sl:"h"==b.rail.drag.dl&&(a=b.rail.drag.st);else{var i=Math.abs(i),u=Math.abs(u),l=b.opt.directionlockdeadzone;if("v"==b.rail.drag.ck){if(i>l&&.3*i>=u)return b.rail.drag=!1,!0;u>l&&(b.rail.drag.dl="f",e("body").scrollTop(e("body").scrollTop()))}else if("h"==b.rail.drag.ck){if(u>l&&.3*u>=i)return b.rail.drag=!1,!0;i>l&&(b.rail.drag.dl="f",e("body").scrollLeft(e("body").scrollLeft()))}}if(b.synched("touchmove",function(){b.rail.drag&&2==b.rail.drag.pt&&(b.prepareTransition&&b.prepareTransition(0),b.rail.scrollable&&b.setScrollTop(a),b.scrollmom.update(o,s),b.railh&&b.railh.scrollable?(b.setScrollLeft(f),b.showCursor(a,f)):b.showCursor(a),E.isie10&&document.selection.clear())}),E.ischrome&&b.istouchcapable&&(r=!1),r)return b.cancelEvent(t)}}}if(b.onmousedown=function(e,t){if(!b.rail.drag||1==b.rail.drag.pt){if(b.locked)return b.cancelEvent(e);b.cancelScroll(),b.rail.drag={x:e.clientX,y:e.clientY,sx:b.scroll.x,sy:b.scroll.y,pt:1,hr:!!t};var n=b.getTarget(e);return!b.ispage&&E.hasmousecapture&&n.setCapture(),b.isiframe&&!E.hasmousecapture&&(b.saved.csspointerevents=b.doc.css("pointer-events"),b.css(b.doc,{"pointer-events":"none"})),b.cancelEvent(e)}},b.onmouseup=function(e){return b.rail.drag&&(E.hasmousecapture&&document.releaseCapture(),b.isiframe&&!E.hasmousecapture&&b.doc.css("pointer-events",b.saved.csspointerevents),1==b.rail.drag.pt)?(b.rail.drag=!1,b.cancelEvent(e)):void 0},b.onmousemove=function(e){if(b.rail.drag&&1==b.rail.drag.pt){if(E.ischrome&&0==e.which)return b.onmouseup(e);if(b.cursorfreezed=!0,b.rail.drag.hr){b.scroll.x=b.rail.drag.sx+(e.clientX-b.rail.drag.x),0>b.scroll.x&&(b.scroll.x=0);var t=b.scrollvaluemaxw;b.scroll.x>t&&(b.scroll.x=t)}else b.scroll.y=b.rail.drag.sy+(e.clientY-b.rail.drag.y),0>b.scroll.y&&(b.scroll.y=0),t=b.scrollvaluemax,b.scroll.y>t&&(b.scroll.y=t);return b.synched("mousemove",function(){b.rail.drag&&1==b.rail.drag.pt&&(b.showCursor(),b.rail.drag.hr?b.doScrollLeft(Math.round(b.scroll.x*b.scrollratio.x),b.opt.cursordragspeed):b.doScrollTop(Math.round(b.scroll.y*b.scrollratio.y),b.opt.cursordragspeed))}),b.cancelEvent(e)}},E.cantouch||b.opt.touchbehavior)b.onpreventclick=function(e){return b.preventclick?(b.preventclick.tg.onclick=b.preventclick.click,b.preventclick=!1,b.cancelEvent(e)):void 0},b.bind(b.win,"mousedown",b.ontouchstart),b.onclick=E.isios?!1:function(e){return b.lastmouseup?(b.lastmouseup=!1,b.cancelEvent(e)):!0},b.opt.grabcursorenabled&&E.cursorgrabvalue&&(b.css(b.ispage?b.doc:b.win,{cursor:E.cursorgrabvalue}),b.css(b.rail,{cursor:E.cursorgrabvalue}));else{var g=function(e){if(b.selectiondrag){if(e){var t=b.win.outerHeight();e=e.pageY-b.selectiondrag.top,e>0&&t>e&&(e=0),e>=t&&(e-=t),b.selectiondrag.df=e}0!=b.selectiondrag.df&&(b.doScrollBy(2*-Math.floor(b.selectiondrag.df/6)),b.debounced("doselectionscroll",function(){g()},50))}};b.hasTextSelected="getSelection"in document?function(){return 0<document.getSelection().rangeCount}:"selection"in document?function(){return"None"!=document.selection.type}:function(){return!1},b.onselectionstart=function(){b.ispage||(b.selectiondrag=b.win.offset())},b.onselectionend=function(){b.selectiondrag=!1},b.onselectiondrag=function(e){b.selectiondrag&&b.hasTextSelected()&&b.debounced("selectionscroll",function(){g(e)},250)}}E.hasmstouch&&(b.css(b.rail,{"-ms-touch-action":"none"}),b.css(b.cursor,{"-ms-touch-action":"none"}),b.bind(b.win,"MSPointerDown",b.ontouchstart),b.bind(document,"MSPointerUp",b.ontouchend),b.bind(document,"MSPointerMove",b.ontouchmove),b.bind(b.cursor,"MSGestureHold",function(e){e.preventDefault()}),b.bind(b.cursor,"contextmenu",function(e){e.preventDefault()})),this.istouchcapable&&(b.bind(b.win,"touchstart",b.ontouchstart),b.bind(document,"touchend",b.ontouchend),b.bind(document,"touchcancel",b.ontouchend),b.bind(document,"touchmove",b.ontouchmove)),b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mouseup",b.onmouseup),b.railh&&(b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.bind(b.cursorh,"mouseup",function(e){return b.rail.drag&&2==b.rail.drag.pt?void 0:(b.rail.drag=!1,b.hasmoving=!1,b.hideCursor(),E.hasmousecapture&&document.releaseCapture(),b.cancelEvent(e))})),(b.opt.cursordragontouch||!E.cantouch&&!b.opt.touchbehavior)&&(b.rail.css({cursor:"default"}),b.railh&&b.railh.css({cursor:"default"}),b.jqbind(b.rail,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.rail,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.rail,"click",function(e){b.doRailClick(e,!1,!1)}),b.bind(b.rail,"dblclick",function(e){b.doRailClick(e,!0,!1)}),b.bind(b.cursor,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursor,"dblclick",function(e){b.cancelEvent(e)})),b.railh&&(b.jqbind(b.railh,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.railh,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.railh,"click",function(e){b.doRailClick(e,!1,!0)}),b.bind(b.railh,"dblclick",function(e){b.doRailClick(e,!0,!0)}),b.bind(b.cursorh,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursorh,"dblclick",function(e){b.cancelEvent(e)})))),E.cantouch||b.opt.touchbehavior?(b.bind(E.hasmousecapture?b.win:document,"mouseup",b.ontouchend),b.bind(document,"mousemove",b.ontouchmove),b.onclick&&b.bind(document,"click",b.onclick),b.opt.cursordragontouch&&(b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mousemove",b.onmousemove),b.cursorh&&b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.cursorh&&b.bind(b.cursorh,"mousemove",b.onmousemove))):(b.bind(E.hasmousecapture?b.win:document,"mouseup",b.onmouseup),b.bind(document,"mousemove",b.onmousemove),b.onclick&&b.bind(document,"click",b.onclick),!b.ispage&&b.opt.enablescrollonselection&&(b.bind(b.win[0],"mousedown",b.onselectionstart),b.bind(document,"mouseup",b.onselectionend),b.bind(b.cursor,"mouseup",b.onselectionend),b.cursorh&&b.bind(b.cursorh,"mouseup",b.onselectionend),b.bind(document,"mousemove",b.onselectiondrag)),b.zoom&&(b.jqbind(b.zoom,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.zoom,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}))),b.opt.enablemousewheel&&(b.isiframe||b.bind(E.isie&&b.ispage?document:b.win,"mousewheel",b.onmousewheel),b.bind(b.rail,"mousewheel",b.onmousewheel),b.railh&&b.bind(b.railh,"mousewheel",b.onmousewheelhr)),b.ispage||E.cantouch||/HTML|BODY/.test(b.win[0].nodeName)||(b.win.attr("tabindex")||b.win.attr({tabindex:r++}),b.jqbind(b.win,"focus",function(e){t=b.getTarget(e).id||!0,b.hasfocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"blur",function(){t=!1,b.hasfocus=!1}),b.jqbind(b.win,"mouseenter",function(e){n=b.getTarget(e).id||!0,b.hasmousefocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"mouseleave",function(){n=!1,b.hasmousefocus=!1,b.rail.drag||b.hideCursor()}))}if(b.onkeypress=function(r){if(b.locked&&0==b.page.maxh)return!0;r=r?r:window.e;var i=b.getTarget(r);if(i&&/INPUT|TEXTAREA|SELECT|OPTION/.test(i.nodeName)&&(!i.getAttribute("type")&&!i.type||!/submit|button|cancel/i.tp)||e(i).attr("contenteditable"))return!0;if(b.hasfocus||b.hasmousefocus&&!t||b.ispage&&!t&&!n){if(i=r.keyCode,b.locked&&27!=i)return b.cancelEvent(r);var s=r.ctrlKey||!1,o=r.shiftKey||!1,u=!1;switch(i){case 38:case 63233:b.doScrollBy(72),u=!0;break;case 40:case 63235:b.doScrollBy(-72),u=!0;break;case 37:case 63232:b.railh&&(s?b.doScrollLeft(0):b.doScrollLeftBy(72),u=!0);break;case 39:case 63234:b.railh&&(s?b.doScrollLeft(b.page.maxw):b.doScrollLeftBy(-72),u=!0);break;case 33:case 63276:b.doScrollBy(b.view.h),u=!0;break;case 34:case 63277:b.doScrollBy(-b.view.h),u=!0;break;case 36:case 63273:b.railh&&s?b.doScrollPos(0,0):b.doScrollTo(0),u=!0;break;case 35:case 63275:b.railh&&s?b.doScrollPos(b.page.maxw,b.page.maxh):b.doScrollTo(b.page.maxh),u=!0;break;case 32:b.opt.spacebarenabled&&(o?b.doScrollBy(b.view.h):b.doScrollBy(-b.view.h),u=!0);break;case 27:b.zoomactive&&(b.doZoom(),u=!0)}if(u)return b.cancelEvent(r)}},b.opt.enablekeyboard&&b.bind(document,E.isopera&&!E.isopera12?"keypress":"keydown",b.onkeypress),b.bind(window,"resize",b.lazyResize),b.bind(window,"orientationchange",b.lazyResize),b.bind(window,"load",b.lazyResize),E.ischrome&&!b.ispage&&!b.haswrapper){var w=b.win.attr("style"),a=parseFloat(b.win.css("width"))+1;b.win.css("width",a),b.synched("chromefix",function(){b.win.attr("style",w)})}b.onAttributeChange=function(){b.lazyResize(250)},b.ispage||b.haswrapper||(!1!==p?(b.observer=new p(function(e){e.forEach(b.onAttributeChange)}),b.observer.observe(b.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),b.observerremover=new p(function(e){e.forEach(function(e){if(0<e.removedNodes.length)for(var t in e.removedNodes)if(e.removedNodes[t]==b.win[0])return b.remove()})}),b.observerremover.observe(b.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(b.bind(b.win,E.isie&&!E.isie9?"propertychange":"DOMAttrModified",b.onAttributeChange),E.isie9&&b.win[0].attachEvent("onpropertychange",b.onAttributeChange),b.bind(b.win,"DOMNodeRemoved",function(e){e.target==b.win[0]&&b.remove()}))),!b.ispage&&b.opt.boxzoom&&b.bind(window,"resize",b.resizeZoom),b.istextarea&&b.bind(b.win,"mouseup",b.lazyResize),b.checkrtlmode=!0,b.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var S=function(t){b.iframexd=!1;try{var n="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(r){b.iframexd=!0,n=!1}return b.iframexd?("console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0):(b.forcescreen=!0,b.isiframe&&(b.iframe={doc:e(n),html:b.doc.contents().find("html")[0],body:b.doc.contents().find("body")[0]},b.getContentSize=function(){return{w:Math.max(b.iframe.html.scrollWidth,b.iframe.body.scrollWidth),h:Math.max(b.iframe.html.scrollHeight,b.iframe.body.scrollHeight)}},b.docscroll=e(b.iframe.body)),E.isios||!b.opt.iframeautoresize||b.isiframe||(b.win.scrollTop(0),b.doc.height(""),t=Math.max(n.getElementsByTagName("html")[0].scrollHeight,n.body.scrollHeight),b.doc.height(t)),b.lazyResize(30),E.isie7&&b.css(e(b.iframe.html),{"overflow-y":"hidden"}),b.css(e(b.iframe.body),{"overflow-y":"hidden"}),E.isios&&b.haswrapper&&b.css(e(n.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?b.bind(this.contentWindow,"scroll",b.onscroll):b.bind(n,"scroll",b.onscroll),b.opt.enablemousewheel&&b.bind(n,"mousewheel",b.onmousewheel),b.opt.enablekeyboard&&b.bind(n,E.isopera?"keypress":"keydown",b.onkeypress),(E.cantouch||b.opt.touchbehavior)&&(b.bind(n,"mousedown",b.ontouchstart),b.bind(n,"mousemove",function(e){b.ontouchmove(e,!0)}),b.opt.grabcursorenabled&&E.cursorgrabvalue&&b.css(e(n.body),{cursor:E.cursorgrabvalue})),b.bind(n,"mouseup",b.ontouchend),b.zoom&&(b.opt.dblclickzoom&&b.bind(n,"dblclick",b.doZoom),b.ongesturezoom&&b.bind(n,"gestureend",b.ongesturezoom)),void 0)};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){S.call(b.doc[0],!1)},500),b.bind(this.doc,"load",S)}},this.showCursor=function(e,t){b.cursortimeout&&(clearTimeout(b.cursortimeout),b.cursortimeout=0),b.rail&&(b.autohidedom&&(b.autohidedom.stop().css({opacity:b.opt.cursoropacitymax}),b.cursoractive=!0),b.rail.drag&&1==b.rail.drag.pt||("undefined"!=typeof e&&!1!==e&&(b.scroll.y=Math.round(1*e/b.scrollratio.y)),"undefined"!=typeof t&&(b.scroll.x=Math.round(1*t/b.scrollratio.x))),b.cursor.css({height:b.cursorheight,top:b.scroll.y}),b.cursorh&&(!b.rail.align&&b.rail.visibility?b.cursorh.css({width:b.cursorwidth,left:b.scroll.x+b.rail.width}):b.cursorh.css({width:b.cursorwidth,left:b.scroll.x}),b.cursoractive=!0),b.zoom&&b.zoom.stop().css({opacity:b.opt.cursoropacitymax}))},this.hideCursor=function(e){b.cursortimeout||!b.rail||!b.autohidedom||b.hasmousefocus&&"leave"==b.opt.autohidemode||(b.cursortimeout=setTimeout(function(){b.rail.active&&b.showonmouseevent||(b.autohidedom.stop().animate({opacity:b.opt.cursoropacitymin}),b.zoom&&b.zoom.stop().animate({opacity:b.opt.cursoropacitymin}),b.cursoractive=!1),b.cursortimeout=0},e||b.opt.hidecursordelay))},this.noticeCursor=function(e,t,n){b.showCursor(t,n),b.rail.active||b.hideCursor(e)},this.getContentSize=b.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:b.haswrapper?function(){return{w:b.doc.outerWidth()+parseInt(b.win.css("paddingLeft"))+parseInt(b.win.css("paddingRight")),h:b.doc.outerHeight()+parseInt(b.win.css("paddingTop"))+parseInt(b.win.css("paddingBottom"))}}:function(){return{w:b.docscroll[0].scrollWidth,h:b.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!b||!b.win)return!1;if(!b.haswrapper&&!b.ispage){if("none"==b.win.css("display"))return b.visibility&&b.hideRail().hideRailHr(),!1;b.hidden||b.visibility||b.showRail().showRailHr()}var n=b.page.maxh,r=b.page.maxw,i=b.view.w;if(b.view={w:b.ispage?b.win.width():parseInt(b.win[0].clientWidth),h:b.ispage?b.win.height():parseInt(b.win[0].clientHeight)},b.page=t?t:b.getContentSize(),b.page.maxh=Math.max(0,b.page.h-b.view.h),b.page.maxw=Math.max(0,b.page.w-b.view.w),b.page.maxh==n&&b.page.maxw==r&&b.view.w==i){if(b.ispage)return b;if(n=b.win.offset(),b.lastposition&&(r=b.lastposition,r.top==n.top&&r.left==n.left))return b;b.lastposition=n}return 0==b.page.maxh?(b.hideRail(),b.scrollvaluemax=0,b.scroll.y=0,b.scrollratio.y=0,b.cursorheight=0,b.setScrollTop(0),b.rail.scrollable=!1):b.rail.scrollable=!0,0==b.page.maxw?(b.hideRailHr(),b.scrollvaluemaxw=0,b.scroll.x=0,b.scrollratio.x=0,b.cursorwidth=0,b.setScrollLeft(0),b.railh.scrollable=!1):b.railh.scrollable=!0,b.locked=0==b.page.maxh&&0==b.page.maxw,b.locked?(b.ispage||b.updateScrollBar(b.view),!1):(b.hidden||b.visibility?b.hidden||b.railh.visibility||b.showRailHr():b.showRail().showRailHr(),b.istextarea&&b.win.css("resize")&&"none"!=b.win.css("resize")&&(b.view.h-=20),b.cursorheight=Math.min(b.view.h,Math.round(b.view.h*(b.view.h/b.page.h))),b.cursorheight=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorheight),b.cursorwidth=Math.min(b.view.w,Math.round(b.view.w*(b.view.w/b.page.w))),b.cursorwidth=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorwidth),b.scrollvaluemax=b.view.h-b.cursorheight-b.cursor.hborder,b.railh&&(b.railh.width=0<b.page.maxh?b.view.w-b.rail.width:b.view.w,b.scrollvaluemaxw=b.railh.width-b.cursorwidth-b.cursorh.wborder),b.checkrtlmode&&b.railh&&(b.checkrtlmode=!1,b.opt.rtlmode&&0==b.scroll.x&&b.setScrollLeft(b.page.maxw)),b.ispage||b.updateScrollBar(b.view),b.scrollratio={x:b.page.maxw/b.scrollvaluemaxw,y:b.page.maxh/b.scrollvaluemax},b.getScrollTop()>b.page.maxh?b.doScrollTop(b.page.maxh):(b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x)),b.cursoractive&&b.noticeCursor()),b.scroll.y&&0==b.getScrollTop()&&b.doScrollTo(Math.floor(b.scroll.y*b.scrollratio.y)),b)},this.resize=b.onResize,this.lazyResize=function(e){return e=isNaN(e)?30:e,b.delayed("resize",b.resize,e),b},this._bind=function(e,t,n,r){b.events.push({e:e,n:t,f:n,b:r,q:!1}),e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},this.jqbind=function(t,n,r){b.events.push({e:t,n:n,f:r,q:!0}),e(t).bind(n,r)},this.bind=function(e,t,n,r){var i="jquery"in e?e[0]:e;"mousewheel"==t?"onwheel"in b.win?b._bind(i,"wheel",n,r||!1):(e="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll",v(i,e,n,r||!1),"DOMMouseScroll"==e&&v(i,"MozMousePixelScroll",n,r||!1)):i.addEventListener?(E.cantouch&&/mouseup|mousedown|mousemove/.test(t)&&b._bind(i,"mousedown"==t?"touchstart":"mouseup"==t?"touchend":"touchmove",function(e){if(e.touches){if(2>e.touches.length){var t=e.touches.length?e.touches[0]:e;t.original=e,n.call(this,t)}}else e.changedTouches&&(t=e.changedTouches[0],t.original=e,n.call(this,t))},r||!1),b._bind(i,t,n,r||!1),E.cantouch&&"mouseup"==t&&b._bind(i,"touchcancel",n,r||!1)):b._bind(i,t,function(e){return(e=e||window.event||!1)&&e.srcElement&&(e.target=e.srcElement),"pageY"in e||(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop),!1===n.call(i,e)||!1===r?b.cancelEvent(e):!0})},this._unbind=function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=!1},this.unbindAll=function(){for(var e=0;e<b.events.length;e++){var t=b.events[e];t.q?t.e.unbind(t.n,t.f):b._unbind(t.e,t.n,t.f,t.b)}},this.cancelEvent=function(e){return(e=e.original?e.original:e?e:window.event||!1)?(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1):!1},this.stopPropagation=function(e){return(e=e.original?e.original:e?e:window.event||!1)?e.stopPropagation?e.stopPropagation():(e.cancelBubble&&(e.cancelBubble=!0),!1):!1},this.showRail=function(){return 0==b.page.maxh||!b.ispage&&"none"==b.win.css("display")||(b.visibility=!0,b.rail.visibility=!0,b.rail.css("display","block")),b},this.showRailHr=function(){return b.railh?(0==b.page.maxw||!b.ispage&&"none"==b.win.css("display")||(b.railh.visibility=!0,b.railh.css("display","block")),b):b},this.hideRail=function(){return b.visibility=!1,b.rail.visibility=!1,b.rail.css("display","none"),b},this.hideRailHr=function(){return b.railh?(b.railh.visibility=!1,b.railh.css("display","none"),b):b},this.show=function(){return b.hidden=!1,b.locked=!1,b.showRail().showRailHr()},this.hide=function(){return b.hidden=!0,b.locked=!0,b.hideRail().hideRailHr()},this.toggle=function(){return b.hidden?b.show():b.hide()},this.remove=function(){b.stop(),b.cursortimeout&&clearTimeout(b.cursortimeout),b.doZoomOut(),b.unbindAll(),E.isie9&&b.win[0].detachEvent("onpropertychange",b.onAttributeChange),!1!==b.observer&&b.observer.disconnect(),!1!==b.observerremover&&b.observerremover.disconnect(),b.events=null,b.cursor&&b.cursor.remove(),b.cursorh&&b.cursorh.remove(),b.rail&&b.rail.remove(),b.railh&&b.railh.remove(),b.zoom&&b.zoom.remove();for(var t=0;t<b.saved.css.length;t++){var n=b.saved.css[t];n[0].css(n[1],"undefined"==typeof n[2]?"":n[2])}b.saved=!1,b.me.data("__nicescroll","");var r=e.nicescroll;r.each(function(e){if(this&&this.id===b.id){delete r[e];for(var t=++e;t<r.length;t++,e++)r[e]=r[t];r.length--,r.length&&delete r[r.length]}});for(var i in b)b[i]=null,delete b[i];b=null},this.scrollstart=function(e){return this.onscrollstart=e,b},this.scrollend=function(e){return this.onscrollend=e,b},this.scrollcancel=function(e){return this.onscrollcancel=e,b},this.zoomin=function(e){return this.onzoomin=e,b},this.zoomout=function(e){return this.onzoomout=e,b},this.isScrollable=function(t){if(t=t.target?t.target:t,"OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var n=e(t),n=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(n))return t.clientHeight!=t.scrollHeight;t=t.parentNode?t.parentNode:!1}return!1},this.getViewport=function(t){for(t=t&&t.parentNode?t.parentNode:!1;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var n=e(t);if(/fixed|absolute/.test(n.css("position")))return n;var r=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(r)&&t.clientHeight!=t.scrollHeight||0<n.getNiceScroll().length)return n;t=t.parentNode?t.parentNode:!1}return!1},this.onmousewheel=function(e){if(b.locked)return b.debounced("checkunlock",b.resize,250),!0;if(b.rail.drag)return b.cancelEvent(e);if("auto"==b.opt.oneaxismousemode&&0!=e.deltaX&&(b.opt.oneaxismousemode=!1),b.opt.oneaxismousemode&&0==e.deltaX&&!b.rail.scrollable)return b.railh&&b.railh.scrollable?b.onmousewheelhr(e):!0;var t=+(new Date),n=!1;return b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t,b.nativescrollingarea?!0:((e=g(e,!1,n))&&(b.checkarea=0),e)},this.onmousewheelhr=function(e){if(b.locked||!b.railh.scrollable)return!0;if(b.rail.drag)return b.cancelEvent(e);var t=+(new Date),n=!1;return b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t,b.nativescrollingarea?!0:b.locked?b.cancelEvent(e):g(e,!0,n)},this.stop=function(){return b.cancelScroll(),b.scrollmon&&b.scrollmon.stop(),b.cursorfreezed=!1,b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.noticeCursor(),b},this.getTransitionSpeed=function(e){var t=Math.round(10*b.opt.scrollspeed);return e=Math.min(t,Math.round(e/20*b.opt.scrollspeed)),e>20?e:0},b.opt.smoothscroll?b.ishwscroll&&E.hastransition&&b.opt.usetransition?(this.prepareTransition=function(e,t){var n=t?e>20?e:0:b.getTransitionSpeed(e),r=n?E.prefixstyle+"transform "+n+"ms ease-out":"";return b.lasttransitionstyle&&b.lasttransitionstyle==r||(b.lasttransitionstyle=r,b.doc.css(E.transitionstyle,r)),n},this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var r=b.getScrollTop(),i=b.getScrollLeft();return(0>(b.newscrolly-r)*(t-r)||0>(b.newscrollx-i)*(e-i))&&b.cancelScroll(),0==b.opt.bouncescroll&&(0>t?t=0:t>b.page.maxh&&(t=b.page.maxh),0>e?e=0:e>b.page.maxw&&(e=b.page.maxw)),b.scrollrunning&&e==b.newscrollx&&t==b.newscrolly?!1:(b.newscrolly=t,b.newscrollx=e,b.newscrollspeed=n||!1,b.timer?!1:(b.timer=setTimeout(function(){var n,r,i=b.getScrollTop(),s=b.getScrollLeft();n=e-s,r=t-i,n=Math.round(Math.sqrt(Math.pow(n,2)+Math.pow(r,2))),n=b.newscrollspeed&&1<b.newscrollspeed?b.newscrollspeed:b.getTransitionSpeed(n),b.newscrollspeed&&1>=b.newscrollspeed&&(n*=b.newscrollspeed),b.prepareTransition(n,!0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),n>0&&(!b.scrollrunning&&b.onscrollstart&&b.onscrollstart.call(b,{type:"scrollstart",current:{x:s,y:i},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:n}),E.transitionend?b.scrollendtrapped||(b.scrollendtrapped=!0,b.bind(b.doc,E.transitionend,b.onScrollEnd,!1)):(b.scrollendtrapped&&clearTimeout(b.scrollendtrapped),b.scrollendtrapped=setTimeout(b.onScrollEnd,n)),b.timerscroll={bz:new BezierClass(i,b.newscrolly,n,0,0,.58,1),bh:new BezierClass(s,b.newscrollx,n,0,0,.58,1)},b.cursorfreezed||(b.timerscroll.tm=setInterval(function(){b.showCursor(b.getScrollTop(),b.getScrollLeft())},60))),b.synched("doScroll-set",function(){b.timer=0,b.scrollendtrapped&&(b.scrollrunning=!0),b.setScrollTop(b.newscrolly),b.setScrollLeft(b.newscrollx),b.scrollendtrapped||b.onScrollEnd()})},50),void 0))},this.cancelScroll=function(){if(!b.scrollendtrapped)return!0;var e=b.getScrollTop(),t=b.getScrollLeft();return b.scrollrunning=!1,E.transitionend||clearTimeout(E.transitionend),b.scrollendtrapped=!1,b._unbind(b.doc,E.transitionend,b.onScrollEnd),b.prepareTransition(0),b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1,b.cursorfreezed=!1,b.showCursor(e,t),b},this.onScrollEnd=function(){b.scrollendtrapped&&b._unbind(b.doc,E.transitionend,b.onScrollEnd),b.scrollendtrapped=!1,b.prepareTransition(0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1;var e=b.getScrollTop(),t=b.getScrollLeft();return b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.noticeCursor(!1,e,t),b.cursorfreezed=!1,0>e?e=0:e>b.page.maxh&&(e=b.page.maxh),0>t?t=0:t>b.page.maxw&&(t=b.page.maxw),e!=b.newscrolly||t!=b.newscrollx?b.doScrollPos(t,e,b.opt.snapbackspeed):(b.onscrollend&&b.scrollrunning&&b.onscrollend.call(b,{type:"scrollend",current:{x:t,y:e},end:{x:b.newscrollx,y:b.newscrolly}}),b.scrollrunning=!1,void 0)}):(this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){function r(){if(b.cancelAnimationFrame)return!0;if(b.scrollrunning=!0,c=1-c)return b.timer=f(r)||1;var e=0,t=sy=b.getScrollTop();if(b.dst.ay){var t=b.bzscroll?b.dst.py+b.bzscroll.getNow()*b.dst.ay:b.newscrolly,n=t-sy;(0>n&&t<b.newscrolly||n>0&&t>b.newscrolly)&&(t=b.newscrolly),b.setScrollTop(t),t==b.newscrolly&&(e=1)}else e=1;var i=sx=b.getScrollLeft();b.dst.ax?(i=b.bzscroll?b.dst.px+b.bzscroll.getNow()*b.dst.ax:b.newscrollx,n=i-sx,(0>n&&i<b.newscrollx||n>0&&i>b.newscrollx)&&(i=b.newscrollx),b.setScrollLeft(i),i==b.newscrollx&&(e+=1)):e+=1,2==e?(b.timer=0,b.cursorfreezed=!1,b.bzscroll=!1,b.scrollrunning=!1,0>t?t=0:t>b.page.maxh&&(t=b.page.maxh),0>i?i=0:i>b.page.maxw&&(i=b.page.maxw),i!=b.newscrollx||t!=b.newscrolly?b.doScrollPos(i,t):b.onscrollend&&b.onscrollend.call(b,{type:"scrollend",current:{x:sx,y:sy},end:{x:b.newscrollx,y:b.newscrolly}})):b.timer=f(r)||1}if(t="undefined"==typeof t||!1===t?b.getScrollTop(!0):t,b.timer&&b.newscrolly==t&&b.newscrollx==e)return!0;b.timer&&l(b.timer),b.timer=0;var i=b.getScrollTop(),s=b.getScrollLeft();(0>(b.newscrolly-i)*(t-i)||0>(b.newscrollx-s)*(e-s))&&b.cancelScroll(),b.newscrolly=t,b.newscrollx=e,b.bouncescroll&&b.rail.visibility||(0>b.newscrolly?b.newscrolly=0:b.newscrolly>b.page.maxh&&(b.newscrolly=b.page.maxh)),b.bouncescroll&&b.railh.visibility||(0>b.newscrollx?b.newscrollx=0:b.newscrollx>b.page.maxw&&(b.newscrollx=b.page.maxw)),b.dst={},b.dst.x=e-s,b.dst.y=t-i,b.dst.px=s,b.dst.py=i;var o=Math.round(Math.sqrt(Math.pow(b.dst.x,2)+Math.pow(b.dst.y,2)));b.dst.ax=b.dst.x/o,b.dst.ay=b.dst.y/o;var u=0,a=o;if(0==b.dst.x?(u=i,a=t,b.dst.ay=1,b.dst.py=0):0==b.dst.y&&(u=s,a=e,b.dst.ax=1,b.dst.px=0),o=b.getTransitionSpeed(o),n&&1>=n&&(o*=n),b.bzscroll=o>0?b.bzscroll?b.bzscroll.update(a,o):new BezierClass(u,a,o,0,1,0,1):!1,!b.timer){(i==b.page.maxh&&t>=b.page.maxh||s==b.page.maxw&&e>=b.page.maxw)&&b.checkContentSize();var c=1;b.cancelAnimationFrame=!1,b.timer=1,b.onscrollstart&&!b.scrollrunning&&b.onscrollstart.call(b,{type:"scrollstart",current:{x:s,y:i},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:o}),r(),(i==b.page.maxh&&t>=i||s==b.page.maxw&&e>=s)&&b.checkContentSize(),b.noticeCursor()}},this.cancelScroll=function(){return b.timer&&l(b.timer),b.timer=0,b.bzscroll=!1,b.scrollrunning=!1,b}):(this.doScrollLeft=function(e,t){var n=b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t){var n=e>b.page.maxw?b.page.maxw:e;0>n&&(n=0);var r=t>b.page.maxh?b.page.maxh:t;0>r&&(r=0),b.synched("scroll",function(){b.setScrollTop(r),b.setScrollLeft(n)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,t){var n=0,n=t?Math.floor((b.scroll.y-e)*b.scrollratio.y):(b.timer?b.newscrolly:b.getScrollTop(!0))-e;if(b.bouncescroll){var r=Math.round(b.view.h/2);-r>n?n=-r:n>b.page.maxh+r&&(n=b.page.maxh+r)}return b.cursorfreezed=!1,py=b.getScrollTop(!0),0>n&&0>=py?b.noticeCursor():n>b.page.maxh&&py>=b.page.maxh?(b.checkContentSize(),b.noticeCursor()):(b.doScrollTop(n),void 0)},this.doScrollLeftBy=function(e,t){var n=0,n=t?Math.floor((b.scroll.x-e)*b.scrollratio.x):(b.timer?b.newscrollx:b.getScrollLeft(!0))-e;if(b.bouncescroll){var r=Math.round(b.view.w/2);-r>n?n=-r:n>b.page.maxw+r&&(n=b.page.maxw+r)}return b.cursorfreezed=!1,px=b.getScrollLeft(!0),0>n&&0>=px||n>b.page.maxw&&px>=b.page.maxw?b.noticeCursor():(b.doScrollLeft(n),void 0)},this.doScrollTo=function(e,t){t&&Math.round(e*b.scrollratio.y),b.cursorfreezed=!1,b.doScrollTop(e)},this.checkContentSize=function(){var e=b.getContentSize();e.h==b.page.h&&e.w==b.page.w||b.resize(!1,e)},b.onscroll=function(){b.rail.drag||b.cursorfreezed||b.synched("scroll",function(){b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.railh&&(b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x))),b.noticeCursor()})},b.bind(b.docscroll,"scroll",b.onscroll),this.doZoomIn=function(t){if(!b.zoomactive){b.zoomactive=!0,b.zoomrestore={style:{}};var n,r="position top left zIndex backgroundColor marginTop marginBottom marginLeft marginRight".split(" "),i=b.win[0].style;for(n in r){var o=r[n];b.zoomrestore.style[o]="undefined"!=typeof i[o]?i[o]:""}return b.zoomrestore.style.width=b.win.css("width"),b.zoomrestore.style.height=b.win.css("height"),b.zoomrestore.padding={w:b.win.outerWidth()-b.win.width(),h:b.win.outerHeight()-b.win.height()},E.isios4&&(b.zoomrestore.scrollTop=e(window).scrollTop(),e(window).scrollTop(0)),b.win.css({position:E.isios4?"absolute":"fixed",top:0,left:0,"z-index":s+100,margin:"0px"}),r=b.win.css("backgroundColor"),(""==r||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(r))&&b.win.css("backgroundColor","#fff"),b.rail.css({"z-index":s+101}),b.zoom.css({"z-index":s+102}),b.zoom.css("backgroundPosition","0px -18px"),b.resizeZoom(),b.onzoomin&&b.onzoomin.call(b),b.cancelEvent(t)}},this.doZoomOut=function(t){return b.zoomactive?(b.zoomactive=!1,b.win.css("margin",""),b.win.css(b.zoomrestore.style),E.isios4&&e(window).scrollTop(b.zoomrestore.scrollTop),b.rail.css({"z-index":b.zindex}),b.zoom.css({"z-index":b.zindex}),b.zoomrestore=!1,b.zoom.css("backgroundPosition","0px 0px"),b.onResize(),b.onzoomout&&b.onzoomout.call(b),b.cancelEvent(t)):void 0},this.doZoom=function(e){return b.zoomactive?b.doZoomOut(e):b.doZoomIn(e)},this.resizeZoom=function(){if(b.zoomactive){var t=b.getScrollTop();b.win.css({width:e(window).width()-b.zoomrestore.padding.w+"px",height:e(window).height()-b.zoomrestore.padding.h+"px"}),b.onResize(),b.setScrollTop(Math.min(b.page.maxh,t))}},this.init(),e.nicescroll.push(this)},y=function(e){var t=this;this.nc=e,this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0,this.snapy=this.snapx=!1,this.demuly=this.demulx=0,this.lastscrolly=this.lastscrollx=-1,this.timer=this.chky=this.chkx=0,this.time=function(){return+(new Date)},this.reset=function(e,n){t.stop();var r=t.time();t.steptime=0,t.lasttime=r,t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=n,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,n){var r=t.time();t.steptime=r-t.lasttime,t.lasttime=r;var r=n-t.lasty,i=e-t.lastx,s=t.nc.getScrollTop(),o=t.nc.getScrollLeft(),s=s+r,o=o+i;t.snapx=0>o||o>t.nc.page.maxw,t.snapy=0>s||s>t.nc.page.maxh,t.speedx=i,t.speedy=r,t.lastx=e,t.lasty=n},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,n){var r=!1;0>n?(n=0,r=!0):n>t.nc.page.maxh&&(n=t.nc.page.maxh,r=!0),0>e?(e=0,r=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,r=!0),r&&t.nc.doScrollPos(e,n,t.nc.opt.snapbackspeed)},this.doMomentum=function(e){var n=t.time(),r=e?n+e:t.lasttime;e=t.nc.getScrollLeft();var i=t.nc.getScrollTop(),s=t.nc.page.maxh,o=t.nc.page.maxw;if(t.speedx=o>0?Math.min(60,t.speedx):0,t.speedy=s>0?Math.min(60,t.speedy):0,r=r&&60>=n-r,(0>i||i>s||0>e||e>o)&&(r=!1),e=t.speedx&&r?t.speedx:!1,t.speedy&&r&&t.speedy||e){var u=Math.max(16,t.steptime);u>50&&(e=u/50,t.speedx*=e,t.speedy*=e,u=50),t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var a=t.lastscrollx,f=t.lastscrolly,l=function(){var e=600<t.time()-n?.04:.02;t.speedx&&(a=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=a,0>a||a>o)&&(e=.1),t.speedy&&(f=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=f,0>f||f>s)&&(e=.1),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched("domomentum2d",function(){t.speedx&&(t.nc.getScrollLeft()!=t.chkx&&t.stop(),t.chkx=a,t.nc.setScrollLeft(a)),t.speedy&&(t.nc.getScrollTop()!=t.chky&&t.stop(),t.chky=f,t.nc.setScrollTop(f)),t.timer||(t.nc.hideCursor(),t.doSnapy(a,f))}),1>t.demulxy?t.timer=setTimeout(l,u):(t.stop(),t.nc.hideCursor(),t.doSnapy(a,f))};l()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},b=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(t,n){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollTop():b.call(t)},set:function(t,n){var r=e.data(t,"__nicescroll")||!1;return r&&r.ishwscroll?r.setScrollTop(parseInt(n)):b.call(t,n),this}},e.fn.scrollTop=function(t){if("undefined"==typeof t){var n=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return n&&n.ishwscroll?n.getScrollTop():b.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollTop(parseInt(t)):b.call(e(this),t)})};var w=e.fn.scrollLeft;e.cssHooks.pageXOffset={get:function(t,n){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollLeft():w.call(t)},set:function(t,n){var r=e.data(t,"__nicescroll")||!1;return r&&r.ishwscroll?r.setScrollLeft(parseInt(n)):w.call(t,n),this}},e.fn.scrollLeft=function(t){if("undefined"==typeof t){var n=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return n&&n.ishwscroll?n.getScrollLeft():w.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollLeft(parseInt(t)):w.call(e(this),t)})};var E=function(t){var n=this;if(this.length=0,this.name="nicescrollarray",this.each=function(e){for(var t=0,r=0;t<n.length;t++)e.call(n[t],r++);return n},this.push=function(e){n[n.length]=e,n.length++},this.eq=function(e){return n[e]},t)for(a=0;a<t.length;a++){var r=e.data(t[a],"__nicescroll")||!1;r&&(this[this.length]=r,this.length++)}return this};!function(e,t,n){for(var r=0;r<t.length;r++)n(e,t[r])}(E.prototype,"show hide toggle onResize resize remove stop doScrollPos".split(" "),function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(t){return"undefined"==typeof t?new E(this):this[t]&&e.data(this[t],"__nicescroll")||!1},e.extend(e.expr[":"],{nicescroll:function(t){return e.data(t,"__nicescroll")?!0:!1}}),e.fn.niceScroll=function(t,n){"undefined"!=typeof n||"object"!=typeof t||"jquery"in t||(n=t,t=!1);var r=new E;"undefined"==typeof n&&(n={}),t&&(n.doc=e(t),n.win=e(this));var i=!("doc"in n);return i||"win"in n||(n.win=e(this)),this.each(function(){var t=e(this).data("__nicescroll")||!1;t||(n.doc=i?e(this):n.doc,t=new g(n,e(this)),e(this).data("__nicescroll",t)),r.push(t)}),1==r.length?r[0]:r},window.NiceScroll={getjQuery:function(){return e}},e.nicescroll||(e.nicescroll=new E,e.nicescroll.options=d)}(jQuery),n("libs/jquery.nicescroll.min",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};n("scroll",["libs/jquery.nicescroll.min"],function(){var t;return t=function(){function t(n,r){var i;return this.$el=n,null==r&&(r={}),this.onScrollEnd=e(this.onScrollEnd,this),this.onScrollStart=e(this.onScrollStart,this),r.allBrowsers||(r.userAgent||(r.userAgent=/Windows\ NT/),navigator.userAgent.match(r.userAgent))?(null==r.horizontal&&(r.horizontal=!0),null==r.zindex&&(r.zindex=9e3),i={cursorcolor:"rgba(0,0,0,0.5)",cursorwidth:"8px",zindex:r.zindex,horizrailenabled:r.horizontal},this.nice=this.$el.niceScroll(i),this.nice.scrollstart(this.onScrollStart),this.nice.scrollend(this.onScrollEnd),t.scrollers.push(this.nice),void 0):!1}return t.scrollers=[],t.prototype._otherScrollers=function(){var e,n,r,i,s;for(e=[],s=t.scrollers,r=0,i=s.length;i>r;r++)n=s[r],n!==this.nice&&e.push(n);return e},t.prototype.onScrollStart=function(){var e,t,n,r,i;for(r=this._otherScrollers(),i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(e.hide());return i},t.prototype.onScrollEnd=function(){var e,t,n,r,i;for(r=this._otherScrollers(),i=[],t=0,n=r.length;n>t;t++)e=r[t],e.resize(),i.push(e.show());return i},t.prototype.resize=function(){return this.nice.resize()},t.prototype.destroy=function(){return t.scrollers=this._otherScrollers(),this.nice.remove()},t}()})}.call(this),function(){n("ui",["editable_text","loading","loading_indicator","scroll"],function(e,t,n,r){var i;return i={EditableText:e,Loading:t,LoadingIndicator:n,Scroll:r},"undefined"!=typeof window&&(window.vs||(window.vs={}),window.vs.ui=i),i})}.call(this),t("ui")}),define("text!templates/lesson.html",[],function(){return'<h1 class="js-title top-lesson-title"><%- title %></h1>\n<div class="gadgets"></div>\n'}),function(){var e,t;e={"cdn.lodash":"cdn.underscore","cdn.mustache":"cdn.hogan"},t={waitSeconds:120,paths:{"cdn.backbone":"lib/core.min","cdn.marionette":"lib/core.min","cdn.jquery":"lib/core.min","cdn.underscore":"lib/core.min","cdn.underscore.mixins":"lib/core.min","cdn.processing":"lib/processing-1.4.1","cdn.raphael":"lib/raphael-2.1.2","cdn.hogan":"lib/hogan-2.0.0","cdn.jqueryui":"lib/jquery.ui-1.11.0pre","cdn.mathjax":"https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG&amp;delayStartupUntil=configured"},map:{"*":e},shim:{"cdn.backbone":{deps:["cdn.underscore","cdn.jquery"],exports:"Backbone"},"cdn.marionette":{deps:["cdn.backbone"],exports:"Backbone.Marionette"},"cdn.jquery":{exports:"$"},"cdn.underscore":{exports:"_",deps:["cdn.underscore.mixins"],init:function(e){return _.mixin(e)}},"cdn.processing":{exports:"Processing"},"cdn.raphael":{exports:"Raphael"},"cdn.jqueryui":{deps:["cdn.jquery"],exports:"$"},"cdn.mathjax":{exports:"MathJax",init:function(){return MathJax.Hub.Config({config:["MMLorHTML.js"],jax:["input/TeX","input/MathML","input/AsciiMath","output/HTML-CSS","output/NativeMML"],extensions:["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","Safe.js"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]},SVG:{scale:110,blacker:2},skipStartupTypeset:!0,delayStartupUntil:"configured",messageStyle:"none"}),MathJax.Hub.Configured(),MathJax}},"cdn.hogan":{exports:"Hogan"}}},"undefined"!=typeof module&&(module.exports=t),"undefined"!=typeof define&&define("lib/config",[],function(){return t})}.call(this),function(){define("models/gadget_loader",["cdn.underscore","cdn.jquery","lib/config","models/settings"],function(e,t,n,r){var i;return i={_cssLoaded:{},resolve:function(e){var n;return n=t.Deferred(),e?(e.get("launcher")==="iframe"?n.resolve(e):t.when(this._fetchJs(e),this._linkCss(e)).done(function(){return n.resolve(e)}).fail(function(e){return n.reject(e)}),n):n.reject(new Error("Gadget project is required to resolve a gadget"))},_fetchJs:function(e){var n;return n=t.Deferred(),this._requirejs(e,function(t){return e.klass=t,n.resolve()},function(e){return n.reject(e)}),n},_linkCss:function(e){var n;return n=t.Deferred(),this._cssLoaded[e.cssClassName()]?n.resolve:(t('<link rel="stylesheet" type="text/css" />').attr("href",e.css()).appendTo("head"),this._waitUntilLoaded(e.css(),n.resolve),this._cssLoaded[e.cssClassName()]=!0,n)},_waitUntilLoaded:function(e,n){return t("<img />").attr("src",e).on("error",n)},_requirejs:function(t,i,s){var o,u;return u=require,r.get("sdk")&&(o=e.extend({baseUrl:t.path()},n),e.each(o.paths,function(e,t,n){return n[t]="/scripts/"+e}),u=require.config(o)),u([t.main()],i,s)}}})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("models/json_asset",["cdn.backbone"],function(e){var n,r;return n=function(e){function n(){return r=n.__super__.constructor.apply(this,arguments),r}return t(n,e),n.prototype.idAttribute="bankId",n.prototype.urlRoot="/assets",n.prototype.initialize=function(e){e==null&&(e={});if(!e.bankId)throw new Error("Bank ID is required for JsonAsset")},n.prototype.toJSON=function(e){var t;return e==null&&(e={}),t=_.omit(this.attributes,"bankId")},n}(e.Model)})}.call(this),function(){var e=[].slice;define("plugins/deep_intersection",["cdn.underscore"],function(t){var n;return n=function(){var n,r,i;return r=arguments[0],i=2<=arguments.length?e.call(arguments,1):[],n=t.partial(t.every,i),t.filter(t.uniq(r),function(e){var r;return r=t.partial(t.isEqual,e),n(function(e){return t.any(e,r)})})}})}.call(this),function(){define("plugins/scoring_strategies",["plugins/deep_intersection","cdn.underscore"],function(e,t){var n;return n={strict:function(e,n){var r;return r=t.isEqual(e,n),r?1:0},partial:function(e,n){var r;if(!t.isArray(e))throw new Error("`prompt` argument must be an array for the `partial` scoring strategy)");if(!t.isArray(n))throw new Error("`response` argument must be an array for the `partial` scoring strategy");return r=t.select(t.zip(e,n),function(e){var n,r;return n=e[0],r=e[1],t.isEqual(n,r)}),e.length?r.length/e.length:0},subset:function(n,r){var i;if(!t.isArray(n))throw new Error("`prompt` argument must be an array for the `subset` scoring strategy");if(!t.isArray(r))throw new Error("`response` argument must be an array for the `subset` scoring strategy");return i=e(n,r),n.length?i.length/n.length:0},range:function(e,n){var r,i;if(!t.isArray(e))throw new Error("`prompt` argument must be an array for the `range` scoring strategy");if(e.length!==2)throw new Error("`prompt` argument must be an array of two numbers for the `range` scoring strategy");if(!t.isNumber(n))throw new Error("`response` argument must be a number for the `range` scoring strategy");return i=e[0],r=e[1],i<=n&&n<=r?1:0}}})}.call(this),function(){define("plugins/scoring",["cdn.underscore","plugins/scoring_strategies"],function(e,t){return function(n,r){if(!e.isArray(n))throw new Error("challenges argument must be an array");if(!e.isArray(r))throw new Error("responses argument must be an array");return e.map(e.zip(n,r),function(e){var n,r,i;return n=e[0],r=e[1],i=t[n.scoring],i(n.answers,r)})}})}.call(this),function(){define("plugins/sum_array",["cdn.underscore"],function(e){var t;return t=function(t){if(!e.isArray(t))throw new Error("argument must be an array");if(!e.all(t,e.isNumber))throw new Error("argument must be an array of numbers");return e.reduce(t,function(e,t){return e+=t},0)}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("plugins/challenges",["cdn.underscore","models/json_asset","plugins/scoring","plugins/vs.api","plugins/sum_array"],function(t,n,r,i,s){var o,u;return u=function(e){var t;return t=JSON.stringify(e),new Blob([t],{type:"application/json"})},o=function(){function o(t,n){this.model=t,this.launcher=n,this._onChallengesSaveSuccess=e(this._onChallengesSaveSuccess,this),this._onSetChallenges=e(this._onSetChallenges,this),this._sendScores=e(this._sendScores,this),this._onScoreChallenges=e(this._onScoreChallenges,this),this._onChallengesFetchSuccess=e(this._onChallengesFetchSuccess,this),this._challenges=[],this._loadChallenges(),this.launcher.once("detach",this._destroy),this.launcher.on("setChallenges",this._onSetChallenges),this.launcher.on("scoreChallenges",this._onScoreChallenges)}return o.prototype.defaultScores={scores:[],totalScore:0,responses:[]},o.prototype._loadChallenges=function(){var e;return e=this.model.config.get("__versal_challenges"),this.bankId=e!=null?e.bankId:void 0,this.bankId?this._fetchChallenges(this.bankId):this._sendChallenges(),this._sendScores()},o.prototype._sendChallenges=function(){return this.launcher.trigger("challengesChanged",{challenges:this._challenges})},o.prototype._fetchChallenges=function(){var e;return e=new n({bankId:this.bankId}),e.fetch({success:this._onChallengesFetchSuccess,error:function(){}})},o.prototype._onChallengesFetchSuccess=function(e){return this._challenges=e.get("resources"),this._sendChallenges()},o.prototype._destroy=function(){return this.launcher.off("setChallenges",this._onSetChallenges),this.launcher.off("scoreChallenges",this._onScoreChallenges)},o.prototype._onScoreChallenges=function(e){var t,n;return t=r(this._challenges,e),n=s(t),this._saveAndSendScores({responses:e,scores:t,totalScore:n})},o.prototype._sendScores=function(){return this.launcher.trigger("scoresChanged",this._currentScores())},o.prototype._currentScores=function(){var e;return e=this.model.userState.get("__versal_challenges"),(e!=null?e.currentScores:void 0)||t.clone(this.defaultScores)},o.prototype._saveAndSendScores=function(e){var t;return t={__versal_challenges:{currentScores:e}},this.model.userState.save(t,{success:this._sendScores,error:function(){}})},o.prototype._onSetChallenges=function(e){var t,n;return this._challenges=e,n={title:"challenge bank",content:u({resources:this._challenges}),contentType:"application/json"},t=new i.Asset,t.save(n,{upload:!0,success:this._onChallengesSaveSuccess,error:function(){}})},o.prototype._onChallengesSaveSuccess=function(e){var t,n=this;return this.bankId=e.representations.first().get("id"),t={__versal_challenges:{bankId:this.bankId}},this.model.config.save(t,{success:function(){return n.launcher.trigger("challengesChanged",{challenges:n._challenges})},error:function(){}})},o}()})}.call(this),define("text!templates/gadget_lock.html",[],function(){return'<li class="lock-status js-lock-status">\n  <i class="icon-lock"></i>\n</li>\n<% if (isLocked()) { %>\n<div class="lock-tooltip">\n  <img class="js-lock avatar" src="<%- profileImage() %>"></img>\n  <span class="name"><%- name() %></span>\n  <div class="triangle"></div>\n</div>\n<% } %>\n'}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/gadget/lock",["cdn.marionette","app/mediator","text!templates/gadget_lock.html"],function(e,n,r){var i,s;return i=function(e){function i(){return s=i.__super__.constructor.apply(this,arguments),s}return t(i,e),i.prototype.template=_.template(r),i.prototype.initialize=function(e){return this.gadget=this.model,n.on("lock:lock",this.onLockLocked,this),n.on("lock:unlock",this.onLockUnlocked,this),n.on("course:collab:close",this._unlock,this)},i.prototype.onClose=function(){return n.off("lock:lock",this.onLockLocked,this),n.off("lock:unlock",this.onLockUnlocked,this),n.off("course:collab:close",this._unlock,this)},i.prototype.ui={editor:".js-lock",lock:".icon-lock"},i.prototype.templateHelpers=function(){var e=this;return{isLocked:function(){return!!e.gadget.lock},name:function(){return e.gadget.lock.get("user").firstname||e.gadget.lock.get("user").fn||"Anonymous"},profileImage:function(){var t,n,r;return n=(r=e.gadget.lock.get("user").image)!=null?r.representations:void 0,n?(t=_.find(n,function(e){return e.scale==="140x140"}),t.location):"../assets/img/profile-retina.jpg"}}},i.prototype.onLockLocked=function(e){if(e.get("gadgetId")===this.gadget.id)return this.updateLock(e)},i.prototype.updateLock=function(e){return this.gadget.lock=e,this.gadget.trigger("unlock"),this.render()},i.prototype.onLockUnlocked=function(e){var t;t=e.get("gadgetId");if(this.gadget.lock&&t===this.gadget.id)return this._unlock()},i.prototype._unlock=function(){return delete this.gadget.lock,this.gadget.trigger("lock"),this.render()},i}(e.ItemView)})}.call(this),function(){define("plugins/time_since",[],function(){return function(e){var t,n,r,i,s,o,u,a,f,l;t=+(new Date)-e;if(t<=3e4)n="seconds";else if(3e4<t&&t<=6e4)n="less than a minute";else{f=[["minute",6e4,36e5],["hour",36e5,864e5],["day",864e5,Infinity]];for(u=0,a=f.length;u<a;u++)l=f[u],s=l[0],i=l[1],r=l[2],i<t&&t<=r&&(o=Math.floor(t/i),n=""+o+" "+s,o>1&&(n+="s"))}return n}})}.call(this),define("text!templates/gadget_comment.html",[],function(){return'<% if (deleted) { %>\n  <div class="deleted_comment">\n    <p>Comment has been deleted</p>\n  </div>\n<% } else { %>\n  <div class="comment-inner">\n    <div class=\'js-delete-overlay delete-overlay\'>\n      <div class=\'delete-content\'>\n        Delete this comment?\n        <button class=\'js-cancel-delete\'>no</button>\n        <button class=\'js-confirm-delete action\'>yes</button>\n      </div>\n    </div>\n    <img src="<%- profileImage() %>"></img>\n    <div class="commentInfo">\n      <p class="commentAuthor"><%- name() %></p><br/>\n      <p class="commentDate"><span class="js-timestamp timestamp">seconds</span> ago</p>\n    </div>\n    <p class="js-comment-body comment-body"><%= body() %></p>\n    <div class="js-comment-actions comment-actions">\n      <span class="js-show comment-action show-more">show more</span>\n      <span class="js-show comment-action show-less">show less</span>\n      <% if (isDeletable()) { %>\n        <span class="js-delete-comment delete-comment comment-action pull-right">delete</span>\n      <% } %>\n    </div>\n  </div>\n<% } %>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/gadget/comment",["cdn.marionette","plugins/time_since","app/mediator","text!templates/gadget_comment.html"],function(t,r,i,s){var o,u;return o=function(t){function o(){return this.updateTimeSince=e(this.updateTimeSince,this),this.sanitizeBody=e(this.sanitizeBody,this),u=o.__super__.constructor.apply(this,arguments),u}return n(o,t),o.prototype.updateTimeSinceEveryMs=1e4,o.prototype.className="comment",o.prototype.events={"click .js-delete-comment":"_onDeleteClick","click .js-show":"toggleShow","click .js-confirm-delete":"_onConfirmDelete","click .js-cancel-delete":"_onCancelDelete"},o.prototype.template=_.template(s),o.prototype.ui={createdAt:".js-timestamp",commentBody:".js-comment-body",deleteOverlay:".js-delete-overlay"},o.prototype.initialize=function(){return this.listenTo(this.model,"change",this.render)},o.prototype.toggleShow=function(){return this.$el.toggleClass("expanded"),this.$el.toggleClass("compacted")},o.prototype.templateHelpers=function(){var e=this;return{profileImage:this.profileImage,name:function(){var t,n;return((t=e.model.get("user"))!=null?t.firstname:void 0)||((n=e.model.get("user"))!=null?n.fn:void 0)||"Anonymous"},body:this.sanitizeBody,isDeletable:function(){return e.model.editable&&!e.model.isNew()}}},o.prototype.sanitizeBody=function(){var e,t,n,r;n=_.escape(this.model.get("body")),t={http:{"in":/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,out:'<a href="$1" target="_blank">$1</a>'},www:{"in":/(^|[^\/])(www\.[\S]+(\b|$))/gim,out:'$1<a href="http://$2" target="_blank">$2</a>'},email:{"in":/(^\S+@\S+\.\S+$)/gi,out:'<a href="mailto:$1">$1</a>'},newlines:{"in":/\n/g,out:"<br>"}};for(r in t)e=t[r],n=n.replace(e["in"],e.out);return n},o.prototype.profileImage=function(){var e,t;return((t=this.user)!=null?t.image:void 0)?(e=_.find(this.user.image.representations,function(e){return e.scale==="140x140"}),e.location):"../assets/img/profile-retina.jpg"},o.prototype.onRender=function(){return this.updateTimeSince()},o.prototype.onShow=function(){return this.determineHeight()},o.prototype.onClose=function(){return this.stopUpdatingTimeSince()},o.prototype.startUpdatingTimeSince=function(){if(!this.timeSinceUpdater&&!this.model.get("deleted"))return this.timeSinceUpdater=setInterval(this.updateTimeSince,this.updateTimeSinceEveryMs)},o.prototype.stopUpdatingTimeSince=function(){return clearInterval(this.timeSinceUpdater)},o.prototype._onDeleteClick=function(){return this.ui.deleteOverlay.show()},o.prototype._onConfirmDelete=function(){return this.ui.deleteOverlay.hide(),i.trigger("comment:deleted",this.model)},o.prototype._onCancelDelete=function(){return this.ui.deleteOverlay.hide()},o.prototype.updateTimeSince=function(){var e;return e=new Date(this.model.get("createdAt")),this.ui.createdAt.text(r(e))},o.prototype.determineHeight=function(){if(this.ui.commentBody.height()>145)return this.$el.addClass("compacted")},o}(t.ItemView)})}.call(this),define("text!templates/gadget_comments.html",[],function(){return'<ul class="comments-toolbar">\n  <li class="actions">\n    <span class="comments js-comments">\n      <span class="js-comments-toggle comments-toggle icon-stack">\n        <i class="fv-bubble icon-stack-base"></i>\n        <i class="js-comments-count icon-inner-text"><%- commentCount %></i>\n      </span>\n      <div class="js-comments-box comments-box">\n        <div class="js-inner-comments inner-comments"></div>\n        <textarea class="js-submit-comment-text submit-comment-text" maxlength="800" placeholder="Write a message here..."></textarea>\n        <div class="submit-action-buttons js-submit-action-buttons">\n          <button class="cancel-button js-cancel-comment ">cancel</button>\n          <button class="action submit-button js-submit-comment pull-right">submit</button>\n        </div>\n      </div>\n    </span>\n  </li>\n</ul>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/gadget/comments",["cdn.marionette","views/gadget/comment","plugins/vs.collab","app/mediator","text!templates/gadget_comments.html"],function(t,r,i,s,o){var u,a,f;return a={},u=function(t){function u(){return this._onCommentsChange=e(this._onCommentsChange,this),f=u.__super__.constructor.apply(this,arguments),f}return n(u,t),u.prototype.className="comments-container",u.prototype.ui={commentText:".js-submit-comment-text",commentsCount:".js-comments-count",commentsDisplay:".js-comments-box",commentsSubmitButtons:".js-submit-action-buttons",commentsBox:".js-comments",innerCommentsBox:".js-inner-comments"},u.prototype.events={"click .js-submit-comment":"onCommentSubmit","click .js-cancel-comment":"onCommentCancel",click:"onClick"},u.prototype.template=_.template(o),u.prototype.templateHelpers=function(){return{commentCount:this.commentCount()}},u.prototype.itemView=r,u.prototype.itemViewContainer=".inner-comments",u.prototype.initialize=function(e){var t;return a[this.model.id]&&this.collection.reset((t=a[this.model.id])!=null?t.models:void 0),this.listenTo(this.collection,"add remove reset",this._onCommentsChange),s.on("comment:add",this.addComment,this),s.on("comment:delete",this.deleteComment,this),s.on("course:collab:open",this.enable,this),s.on("course:collab:close",this.disable,this)},u.prototype.onRender=function(){if(i.enabled)return this.enable()},u.prototype.onClose=function(){return s.off("comment:add",this.addComment,this),s.off("comment:delete",this.deleteComment,this),s.off("course:collab:open",this.enable,this),s.off("course:collab:close",this.disable,this)},u.prototype.disable=function(){return this.$el.hide()},u.prototype.enable=function(){return this.$el.show()},u.prototype.addComment=function(e){var t;t=e.get("gadgetId");if(t===this.model.id)return this.collection.add(e)},u.prototype.deleteComment=function(e){var t;if(e.gadgetId===this.model.id)return(t=this.collection.get(e.commentId))!=null&&t.set({deleted:!0}),this._onCommentsChange()},u.prototype.onCommentSubmit=function(){var e;if(!this.ui.commentText.val())return;return e=new i.GadgetComment({gadgetId:this.model.id,body:this.ui.commentText.val()}),this.ui.commentText.val(""),s.trigger("comment:added",e),this.scrollToBottom()},u.prototype.commentCount=function(){var e,t;return e=this.collection.reject(function(e){return e.get("deleted")}),t=e.length,t>99?"99+":t<=0?"+":t},u.prototype._onCommentsChange=function(){return this.ui.commentsCount.text(this.commentCount()),a[this.model.id]=this.collection,this.children.each(function(e){return e.startUpdatingTimeSince()})},u.prototype.hideComments=function(){return this.ui.commentsDisplay.hide()},u.prototype.onCommentCancel=function(){return this.ui.commentText.val("")},u.prototype.checkForCollapsedComments=function(){return this.children.each(function(e){return e.determineHeight()})},u.prototype.scrollToBottom=function(){return this.ui.innerCommentsBox.scrollTop(this.ui.innerCommentsBox[0].scrollHeight)},u.prototype.show=function(){var e;return this.$el.addClass("comments-visible"),this.checkForCollapsedComments(),e=this.ui.commentsDisplay.height()+this.ui.commentsDisplay.offset().top,this.ui.commentsDisplay.toggleClass("above",e>$("body").height()),this.scrollToBottom(),this.ui.commentText.focus()},u.prototype.hide=function(){return this.$el.removeClass("comments-visible"),this.ui.commentsDisplay.removeClass("above"),this.children.each(function(e){return e.stopUpdatingTimeSince()})},u}(t.CompositeView)})}.call(this),define("text!templates/property_sheet.html",[],function(){return'<div class="properties-dialog-arrow"></div>\n\n<div class="properties-dialog-header">\n  Properties\n\n  <div class="properties-dialog-error-count js-error-count-container">\n    <span class="js-error-count">1</span>\n    error<span class="js-error-count-plural">s</span>\n  </div>\n</div>\n\n<div class="js-form"></div>\n'}),define("libs/backbone-forms",["cdn.jquery","cdn.underscore","cdn.backbone"],function(e,t,n){var r=n.View.extend({initialize:function(e){var n=this;e=e||{};var r=this.schema=function(){if(e.schema)return t.result(e,"schema");var r=e.model;return r&&r.schema?t.isFunction(r.schema)?r.schema():r.schema:n.schema?t.isFunction(n.schema)?n.schema():n.schema:{}}();t.extend(this,t.pick(e,"model","data","idPrefix"));var i=this.constructor;this.template=e.template||i.template,this.Fieldset=e.Fieldset||i.Fieldset,this.Field=e.Field||i.Field,this.NestedField=e.NestedField||i.NestedField;var s=this.selectedFields=e.fields||t.keys(r),o=this.fields={};t.each(s,function(e){var t=r[e];o[e]=this.createField(e,t)},this);var u=e.fieldsets||[s],a=this.fieldsets=[];t.each(u,function(e){this.fieldsets.push(this.createFieldset(e))},this)},createFieldset:function(e){var t={schema:e,fields:this.fields};return new this.Fieldset(t)},createField:function(e,t){var n={form:this,key:e,schema:t,idPrefix:this.idPrefix};this.model?n.model=this.model:this.data?n.value=this.data[e]:n.value=null;var r=new this.Field(n);return this.listenTo(r.editor,"all",this.handleEditorEvent),r},handleEditorEvent:function(e,n){var r=n.key+":"+e;this.trigger.call(this,r,this,n);switch(e){case"change":this.trigger("change",this);break;case"focus":this.hasFocus||this.trigger("focus",this);break;case"blur":if(this.hasFocus){var i=this;setTimeout(function(){var e=t.find(i.fields,function(e){return e.editor.hasFocus});e||i.trigger("blur",i)},0)}}},render:function(){var n=this,r=this.fields,i=e(e.trim(this.template(t.result(this,"templateData"))));return i.find("[data-editors]").add(i).each(function(i,s){var o=e(s),u=o.attr("data-editors");if(t.isUndefined(u))return;var a=u=="*"?n.selectedFields||t.keys(r):u.split(",");t.each(a,function(e){var t=r[e];o.append(t.editor.render().el)})}),i.find("[data-fields]").add(i).each(function(i,s){var o=e(s),u=o.attr("data-fields");if(t.isUndefined(u))return;var a=u=="*"?n.selectedFields||t.keys(r):u.split(",");t.each(a,function(e){var t=r[e];o.append(t.render().el)})}),i.find("[data-fieldsets]").add(i).each(function(r,i){var s=e(i),o=s.attr("data-fieldsets");if(t.isUndefined(o))return;t.each(n.fieldsets,function(e){s.append(e.render().el)})}),this.setElement(i),this},validate:function(){var e=this,n=this.fields,r=this.model,i={};t.each(n,function(e){var t=e.validate();t&&(i[e.key]=t)});if(r&&r.validate){var s=r.validate(this.getValue());if(s){var o=t.isObject(s)&&!t.isArray(s);o||(i._others=i._others||[],i._others.push(s)),o&&t.each(s,function(e,t){if(n[t]&&!i[t])n[t].setError(e),i[t]=e;else{i._others=i._others||[];var r={};r[t]=e,i._others.push(r)}})}}return t.isEmpty(i)?null:i},commit:function(e){var n=this.validate();if(n)return n;var r,i=t.extend({error:function(e,t){r=t}},e);this.model.set(this.getValue(),i);if(r)return r},getValue:function(e){if(e)return this.fields[e].getValue();var n={};return t.each(this.fields,function(e){n[e.key]=e.getValue()}),n},setValue:function(e,t){var n={};typeof e=="string"?n[e]=t:n=e;var r;for(r in this.schema)n[r]!==undefined&&this.fields[r].setValue(n[r])},getEditor:function(e){var t=this.fields[e];if(!t)throw"Field not found: "+e;return t.editor},focus:function(){if(this.hasFocus)return;var e=this.fieldsets[0],t=e.getFieldAt(0);if(!t)return;t.editor.focus()},blur:function(){if(!this.hasFocus)return;var e=t.find(this.fields,function(e){return e.editor.hasFocus});e&&e.editor.blur()},trigger:function(e){return e==="focus"?this.hasFocus=!0:e==="blur"&&(this.hasFocus=!1),n.View.prototype.trigger.apply(this,arguments)},remove:function(){t.each(this.fieldsets,function(e){e.remove()}),t.each(this.fields,function(e){e.remove()}),n.View.prototype.remove.call(this)}},{template:t.template("    <form data-fieldsets></form>  ",null,this.templateSettings),templateSettings:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},editors:{}});return r.validators=function(){var e={};return e.errMessages={required:"Required",regexp:"Invalid",email:"Invalid email address",url:"Invalid URL",match:t.template('Must match field "<%= field %>"',null,r.templateSettings)},e.required=function(e){return e=t.extend({type:"required",message:this.errMessages.required},e),function(r){e.value=r;var i={type:e.type,message:t.isFunction(e.message)?e.message(e):e.message};if(r===null||r===undefined||r===!1||r==="")return i}},e.regexp=function(e){if(!e.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return e=t.extend({type:"regexp",message:this.errMessages.regexp},e),function(r){e.value=r;var i={type:e.type,message:t.isFunction(e.message)?e.message(e):e.message};if(r===null||r===undefined||r==="")return;if(!e.regexp.test(r))return i}},e.email=function(n){return n=t.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},n),e.regexp(n)},e.url=function(n){return n=t.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i},n),e.regexp(n)},e.match=function(e){if(!e.field)throw new Error('Missing required "field" options for "match" validator');return e=t.extend({type:"match",message:this.errMessages.match},e),function(r,i){e.value=r;var s={type:e.type,message:t.isFunction(e.message)?e.message(e):e.message};if(r===null||r===undefined||r==="")return;if(r!==i[e.field])return s}},e}(),r.Fieldset=n.View.extend({initialize:function(e){e=e||{};var n=this.schema=this.createSchema(e.schema);this.fields=t.pick(e.fields,n.fields),this.template=e.template||this.constructor.template},createSchema:function(e){return t.isArray(e)&&(e={fields:e}),e.legend=e.legend||null,e},getFieldAt:function(e){var t=this.schema.fields[e];return this.fields[t]},templateData:function(){return this.schema},render:function(){var n=this.schema,r=this.fields,i=e(e.trim(this.template(t.result(this,"templateData"))));return i.find("[data-fields]").add(i).each(function(n,i){var s=e(i),o=s.attr("data-fields");if(t.isUndefined(o))return;t.each(r,function(e){s.append(e.render().el)})}),this.setElement(i),this},remove:function(){t.each(this.fields,function(e){e.remove()}),n.View.prototype.remove.call(this)}},{template:t.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  ",null,r.templateSettings)}),r.Field=n.View.extend({initialize:function(e){e=e||{},t.extend(this,t.pick(e,"form","key","model","value","idPrefix"));var n=this.schema=this.createSchema(e.schema);this.template=e.template||n.template||this.constructor.template,this.errorClassName=e.errorClassName||this.constructor.errorClassName,this.editor=this.createEditor()},createSchema:function(e){return t.isString(e)&&(e={type:e}),e=t.extend({type:"Text",title:this.createTitle()},e),e.type=t.isString(e.type)?r.editors[e.type]:e.type,e},createEditor:function(){var e=t.extend(t.pick(this,"schema","form","key","model","value"),{id:this.createEditorId()}),n=this.schema.type;return new n(e)},createEditorId:function(){var e=this.idPrefix,n=this.key;return n=n.replace(/\./g,"_"),t.isString(e)||t.isNumber(e)?e+n:t.isNull(e)?n:this.model?this.model.cid+"_"+n:n},createTitle:function(){var e=this.key;return e=e.replace(/([A-Z])/g," $1"),e=e.replace(/^./,function(e){return e.toUpperCase()}),e},templateData:function(){var e=this.schema;return{help:e.help||"",title:e.title,fieldAttrs:e.fieldAttrs,editorAttrs:e.editorAttrs,key:this.key,editorId:this.editor.id}},render:function(){var n=this.schema,r=this.editor,i=e(e.trim(this.template(t.result(this,"templateData"))));return n.fieldClass&&i.addClass(n.fieldClass),n.fieldAttrs&&i.attr(n.fieldAttrs),i.find("[data-editor]").add(i).each(function(n,i){var s=e(i),o=s.attr("data-editor");if(t.isUndefined(o))return;s.append(r.render().el)}),this.setElement(i),this},validate:function(){var e=this.editor.validate();return e?this.setError(e.message):this.clearError(),e},setError:function(e){if(this.editor.hasNestedForm)return;this.$el.addClass(this.errorClassName),this.$("[data-error]").html(e)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$("[data-error]").empty()},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),n.View.prototype.remove.call(this)}},{template:t.template('    <div>      <label for="<%= editorId %>"><%= title %></label>      <div>        <span data-editor></span>        <div data-error></div>        <div><%= help %></div>      </div>    </div>  ',null,r.templateSettings),errorClassName:"error"}),r.NestedField=r.Field.extend({template:t.template(e.trim("    <div>      <span data-editor></span>      <% if (help) { %>        <div><%= help %></div>      <% } %>      <div data-error></div>    </div>  "),null,r.templateSettings)}),r.Editor=r.editors.Base=n.View.extend({defaultValue:null,hasFocus:!1,initialize:function(e){var e=e||{};if(e.model){if(!e.key)throw"Missing option: 'key'";this.model=e.model,this.value=this.model.get(e.key)}else e.value&&(this.value=e.value);this.value===undefined&&(this.value=this.defaultValue),t.extend(this,t.pick(e,"key","form"));var n=this.schema=e.schema||{};this.validators=e.validators||n.validators,this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),n.editorClass&&this.$el.addClass(n.editorClass),n.editorAttrs&&this.$el.attr(n.editorAttrs)},getName:function(){var e=this.key||"";return e.replace(/\./g,"_")},getValue:function(){return this.value},setValue:function(e){this.value=e},focus:function(){throw"Not implemented"},blur:function(){throw"Not implemented"},commit:function(e){var t=this.validate();if(t)return t;this.listenTo(this.model,"invalid",function(e,n){t=n}),this.model.set(this.key,this.getValue(),e);if(t)return t},validate:function(){var e=this.$el,n=null,r=this.getValue(),i=this.form?this.form.getValue():{},s=this.validators,o=this.getValidator;return s&&t.every(s,function(e){return n=o(e)(r,i),n?!1:!0}),n},trigger:function(e){return e==="focus"?this.hasFocus=!0:e==="blur"&&(this.hasFocus=!1),n.View.prototype.trigger.apply(this,arguments)},getValidator:function(e){var n=r.validators;if(t.isRegExp(e))return n.regexp({regexp:e});if(t.isString(e)){if(!n[e])throw new Error('Validator "'+e+'" not found');return n[e]()}if(t.isFunction(e))return e;if(t.isObject(e)&&e.type){var i=e;return n[i.type](i)}throw new Error("Invalid validator: "+e)}}),r.editors.Text=r.Editor.extend({tagName:"input",defaultValue:"",previousValue:"",events:{keyup:"determineChange",keypress:function(e){var t=this;setTimeout(function(){t.determineChange()},0)},select:function(e){this.trigger("select",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e);var t=this.schema,n="text";t&&t.editorAttrs&&t.editorAttrs.type&&(n=t.editorAttrs.type),t&&t.dataType&&(n=t.dataType),this.$el.attr("type",n)},render:function(){return this.setValue(this.value),this},determineChange:function(e){var t=this.$el.val(),n=t!==this.previousValue;n&&(this.previousValue=t,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e),this.previousValue=this.$el.val()},focus:function(){if(this.hasFocus)return;this.$el.focus()},blur:function(){if(!this.hasFocus)return;this.$el.blur()},select:function(){this.$el.select()}}),r.editors.TextArea=r.editors.Text.extend({tagName:"textarea"}),r.editors.Password=r.editors.Text.extend({initialize:function(e){r.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","password")}}),r.editors.Number=r.editors.Text.extend({defaultValue:0,events:t.extend({},r.editors.Text.prototype.events,{keypress:"onKeyPress",input:"determineChange"}),initialize:function(e){r.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","number"),this.$el.attr("step","any")},onKeyPress:function(e){var t=this,n=function(){setTimeout(function(){t.determineChange()},0)};if(e.charCode===0){n();return}var r=this.$el.val()+String.fromCharCode(e.charCode),i=/^-?[0-9]*\.?[0-9]*$/.test(r);i?n():e.preventDefault()},getValue:function(){var e=this.$el.val();return e===""?null:parseFloat(e,10)},setValue:function(e){e=function(){return t.isNumber(e)?e:t.isString(e)&&e!==""?parseFloat(e,10):null}(),t.isNaN(e)&&(e=null),r.editors.Text.prototype.setValue.call(this,e)}}),r.editors.Hidden=r.editors.Base.extend({defaultValue:"",initialize:function(e){r.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","hidden")},focus:function(){},blur:function(){}}),r.editors.Checkbox=r.editors.Base.extend({defaultValue:!1,tagName:"input",events:{click:function(e){this.trigger("change",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.prop("checked")},setValue:function(e){e&&this.$el.prop("checked",!0)},focus:function(){if(this.hasFocus)return;this.$el.focus()},blur:function(){if(!this.hasFocus)return;this.$el.blur()}}),r.editors.Select=r.editors.Base.extend({tagName:"select",events:{change:function(e){this.trigger("change",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e);if(!this.schema||!this.schema.options)throw"Missing required 'schema.options'"},render:function(){return this.setOptions(this.schema.options),this},setOptions:function(e){var r=this;if(e instanceof n.Collection){var i=e;i.length>0?this.renderOptions(e):i.fetch({success:function(t){r.renderOptions(e)}})}else t.isFunction(e)?e(function(e){r.renderOptions(e)},r):this.renderOptions(e)},renderOptions:function(e){var t=this.$el,n;n=this._getOptionsHtml(e),t.html(n),this.setValue(this.value)},_getOptionsHtml:function(e){var r;if(t.isString(e))r=e;else if(t.isArray(e))r=this._arrayToHtml(e);else if(e instanceof n.Collection)r=this._collectionToHtml(e);else if(t.isFunction(e)){var i;e(function(e){i=e},this),r=this._getOptionsHtml(i)}return r},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)},focus:function(){if(this.hasFocus)return;this.$el.focus()},blur:function(){if(!this.hasFocus)return;this.$el.blur()},_collectionToHtml:function(e){var t=[];e.each(function(e){t.push({val:e.id,label:e.toString()})});var n=this._arrayToHtml(t);return n},_arrayToHtml:function(e){var n=[];return t.each(e,function(e){if(t.isObject(e))if(e.group)n.push('<optgroup label="'+e.group+'">'),n.push(this._getOptionsHtml(e.options)),n.push("</optgroup>");else{var r=e.val||e.val===0?e.val:"";n.push('<option value="'+r+'">'+e.label+"</option>")}else n.push("<option>"+e+"</option>")},this),n.join("")}}),r.editors.Radio=r.editors.Select.extend({tagName:"ul",events:{"change input[type=radio]":function(){this.trigger("change",this)},"focus input[type=radio]":function(){if(this.hasFocus)return;this.trigger("focus",this)},"blur input[type=radio]":function(){if(!this.hasFocus)return;var e=this;setTimeout(function(){if(e.$("input[type=radio]:focus")[0])return;e.trigger("blur",e)},0)}},getValue:function(){return this.$("input[type=radio]:checked").val()},setValue:function(e){this.$("input[type=radio]").val([e])},focus:function(){if(this.hasFocus)return;var e=this.$("input[type=radio]:checked");if(e[0]){e.focus();return}this.$("input[type=radio]").first().focus()},blur:function(){if(!this.hasFocus)return;this.$("input[type=radio]:focus").blur()},_arrayToHtml:function(e){var n=[],r=this;return t.each(e,function(e,i){var s="<li>";if(t.isObject(e)){var o=e.val||e.val===0?e.val:"";s+='<input type="radio" name="'+r.id+'" value="'+o+'" id="'+r.id+"-"+i+'" />',s+='<label for="'+r.id+"-"+i+'">'+e.label+"</label>"}else s+='<input type="radio" name="'+r.id+'" value="'+e+'" id="'+r.id+"-"+i+'" />',s+='<label for="'+r.id+"-"+i+'">'+e+"</label>";s+="</li>",n.push(s)}),n.join("")}}),r.editors.Checkboxes=r.editors.Select.extend({tagName:"ul",events:{"click input[type=checkbox]":function(){this.trigger("change",this)},"focus input[type=checkbox]":function(){if(this.hasFocus)return;this.trigger("focus",this)},"blur input[type=checkbox]":function(){if(!this.hasFocus)return;var e=this;setTimeout(function(){if(e.$("input[type=checkbox]:focus")[0])return;e.trigger("blur",e)},0)}},getValue:function(){var t=[];return this.$("input[type=checkbox]:checked").each(function(){t.push(e(this).val())}),t},setValue:function(e){t.isArray(e)||(e=[e]),this.$("input[type=checkbox]").val(e)},focus:function(){if(this.hasFocus)return;this.$("input[type=checkbox]").first().focus()},blur:function(){if(!this.hasFocus)return;this.$("input[type=checkbox]:focus").blur()},_arrayToHtml:function(e){var n=[],r=this;return t.each(e,function(e,i){var s="<li>";if(t.isObject(e)){var o=e.val||e.val===0?e.val:"";s+='<input type="checkbox" name="'+r.id+'" value="'+o+'" id="'+r.id+"-"+i+'" />',s+='<label for="'+r.id+"-"+i+'">'+e.label+"</label>"}else s+='<input type="checkbox" name="'+r.id+'" value="'+e+'" id="'+r.id+"-"+i+'" />',s+='<label for="'+r.id+"-"+i+'">'+e+"</label>";s+="</li>",n.push(s)}),n.join("")}}),r.editors.Object=r.editors.Base.extend({hasNestedForm:!0,initialize:function(e){this.value={},r.editors.Base.prototype.initialize.call(this,e);if(!this.form)throw'Missing required option "form"';if(!this.schema.subSchema)throw new Error("Missing required 'schema.subSchema' option for Object editor")},render:function(){var e=this.form.constructor;return this.nestedForm=new e({schema:this.schema.subSchema,data:this.value,idPrefix:this.id+"_",Field:e.NestedField}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return this.nestedForm?this.nestedForm.getValue():this.value},setValue:function(e){this.value=e,this.render()},focus:function(){if(this.hasFocus)return;this.nestedForm.focus()},blur:function(){if(!this.hasFocus)return;this.nestedForm.blur()},remove:function(){this.nestedForm.remove(),n.View.prototype.remove.call(this)},validate:function(){return this.nestedForm.validate()},_observeFormEvents:function(){if(!this.nestedForm)return;this.nestedForm.on("all",function(){var e=t.toArray(arguments);e[1]=this,this.trigger.apply(this,e)},this)}}),r.editors.NestedModel=r.editors.Object.extend({initialize:function(e){r.editors.Base.prototype.initialize.call(this,e);if(!this.form)throw'Missing required option "form"';if(!e.schema.model)throw'Missing required "schema.model" option for NestedModel editor'},render:function(){var e=this.form.constructor,t=this.value||{},n=this.key,r=this.schema.model,i=t.constructor===r?t:new r(t);return this.nestedForm=new e({model:i,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){var e=this.nestedForm.commit();return e?(this.$el.addClass("error"),e):r.editors.Object.prototype.commit.call(this)}}),r.editors.Date=r.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){if(this.hasFocus)return;this.trigger("focus",this)},"blur select":function(){if(!this.hasFocus)return;var e=this;setTimeout(function(){if(e.$("select:focus")[0])return;e.trigger("blur",e)},0)}},initialize:function(e){e=e||{},r.editors.Base.prototype.initialize.call(this,e);var n=r.editors.Date,i=new Date;this.options=t.extend({monthNames:n.monthNames,showMonthNames:n.showMonthNames},e),this.schema=t.extend({yearStart:i.getFullYear()-100,yearEnd:i.getFullYear()},e.schema||{}),this.value&&!t.isDate(this.value)&&(this.value=new Date(this.value));if(!this.value){var s=new Date;s.setSeconds(0),s.setMilliseconds(0),this.value=s}this.template=e.template||this.constructor.template},render:function(){var n=this.options,r=this.schema,i=t.map(t.range(1,32),function(e){return'<option value="'+e+'">'+e+"</option>"}),s=t.map(t.range(0,12),function(e){var t=n.showMonthNames?n.monthNames[e]:e+1;return'<option value="'+e+'">'+t+"</option>"}),o=r.yearStart<r.yearEnd?t.range(r.yearStart,r.yearEnd+1):t.range(r.yearStart,r.yearEnd-1,-1),u=t.map(o,function(e){return'<option value="'+e+'">'+e+"</option>"}),a=e(e.trim(this.template({dates:i.join(""),months:s.join(""),years:u.join("")})));return this.$date=a.find('[data-type="date"]'),this.$month=a.find('[data-type="month"]'),this.$year=a.find('[data-type="year"]'),this.$hidden=e('<input type="hidden" name="'+this.key+'" />'),a.append(this.$hidden),this.setValue(this.value),this.setElement(a),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.$year.val(),t=this.$month.val(),n=this.$date.val();return!e||!t||!n?null:new Date(e,t,n)},setValue:function(e){this.$date.val(e.getDate()),this.$month.val(e.getMonth()),this.$year.val(e.getFullYear()),this.updateHidden()},focus:function(){if(this.hasFocus)return;this.$("select").first().focus()},blur:function(){if(!this.hasFocus)return;this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();t.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)}},{template:t.template('    <div>      <select data-type="date"><%= dates %></select>      <select data-type="month"><%= months %></select>      <select data-type="year"><%= years %></select>    </div>  ',null,r.templateSettings),showMonthNames:!0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]}),r.editors.DateTime=r.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){if(this.hasFocus)return;this.trigger("focus",this)},"blur select":function(){if(!this.hasFocus)return;var e=this;setTimeout(function(){if(e.$("select:focus")[0])return;e.trigger("blur",e)},0)}},initialize:function(e){e=e||{},r.editors.Base.prototype.initialize.call(this,e),this.options=t.extend({DateEditor:r.editors.DateTime.DateEditor},e),this.schema=t.extend({minsInterval:15},e.schema||{}),this.dateEditor=new this.options.DateEditor(e),this.value=this.dateEditor.value,this.template=e.template||this.constructor.template},render:function(){function n(e){return e<10?"0"+e:e}var r=this.schema,i=t.map(t.range(0,24),function(e){return'<option value="'+e+'">'+n(e)+"</option>"}),s=t.map(t.range(0,60,r.minsInterval),function(e){return'<option value="'+e+'">'+n(e)+"</option>"}),o=e(e.trim(this.template({hours:i.join(),mins:s.join()})));return o.find("[data-date]").append(this.dateEditor.render().el),this.$hour=o.find('select[data-type="hour"]'),this.$min=o.find('select[data-type="min"]'),this.$hidden=o.find('input[type="hidden"]'),this.setValue(this.value),this.setElement(o),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.dateEditor.getValue(),t=this.$hour.val(),n=this.$min.val();return!e||!t||!n?null:(e.setHours(t),e.setMinutes(n),e)},setValue:function(e){t.isDate(e)||(e=new Date(e)),this.dateEditor.setValue(e),this.$hour.val(e.getHours()),this.$min.val(e.getMinutes()),this.updateHidden()},focus:function(){if(this.hasFocus)return;this.$("select").first().focus()},blur:function(){if(!this.hasFocus)return;this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();t.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)},remove:function(){this.dateEditor.remove(),r.editors.Base.prototype.remove.call(this)}},{template:t.template('    <div class="bbf-datetime">      <div class="bbf-date-container" data-date></div>      <select data-type="hour"><%= hours %></select>      :      <select data-type="min"><%= mins %></select>    </div>  ',null,r.templateSettings),DateEditor:r.editors.Date}),r.VERSION="0.12.0",n.Form=r,r}),function(){define("plugins/backbone-forms.bootstrap",["cdn.jquery","cdn.underscore","cdn.backbone","libs/backbone-forms"],function(e,t,n){var r;return r=n.Form,r.template=t.template('<form class="form" data-fieldsets></form>'),r.Fieldset.template=t.template('<fieldset class="bbf-fieldset" data-fields>\n  <% if (legend) { %>\n    <legend><%= legend %></legend>\n  <% } %>\n</fieldset>'),r.Field.template=t.template('<div class="control-group field-<%= key %> bbf-field">\n  <% if (this.options.schema.type === "Checkbox") { %>\n    <div class="bbf-editor hacked-for-checkbox" data-editor><label class="control-label" for="<%= editorId %>"><%= title %></label></div>\n    <div class="clearfix"></div>\n  <% } else { %>\n    <label class="control-label" for="<%= editorId %>"><%= title %></label>\n    <div class="bbf-editor" data-editor></div>\n  <% } %>\n  <div class="bbf-error-tooltip-container">\n    <div class="bff-error-tooltip versal-tooltip versal-tooltip-text versal-tooltip-left versal-tooltip-align-top">\n      <div class="versal-tooltip-arrow"></div>\n      <div class="bbf-error" data-error></div>\n    </div>\n  </div>\n</div>'),r.editors.Date.template=t.template('<div class="bbf-date">\n  <select data-type="date" class="bbf-date"><%= dates %></select>\n  <select data-type="month" class="bbf-month"><%= months %></select>\n  <select data-type="year" class="bbf-year"><%= years %></select>\n</div>'),r.editors.DateTime.template=t.template('<div class="bbf-datetime">\n  <div class="bbf-date-container" data-date></div>\n  <select data-type="hour" style="width: 4em"><%= hours %></select>\n  :\n  <select data-type="min" style="width: 4em"><%= mins %></select>\n</div>'),r.Field.errorClassName="bbf-error"})}.call(this);try{window.Modernizr=function(e,t,n){function r(e){v.cssText=e}function i(e,t){return r(prefixes.join(e+";")+(t||""))}function s(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function u(e,t,r){for(var i in e){var o=t[e[i]];if(o!==n)return r===!1?e[i]:s(o,"function")?o.bind(r||t):o}return!1}function a(){l.inputtypes=function(e){for(var r=0,i,s,o,u=e.length;r<u;r++)m.setAttribute("type",s=e[r]),i=m.type!=="text",i&&(m.value=g,m.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(s)&&m.style.WebkitAppearance!==n?(h.appendChild(m),o=t.defaultView,i=o.getComputedStyle&&o.getComputedStyle(m,null).WebkitAppearance!=="textfield"&&m.offsetHeight!==0,h.removeChild(m)):/^(search|tel)$/.test(s)||(/^(url|email)$/.test(s)?i=m.checkValidity&&m.checkValidity()===!1:i=m.value!=g)),w[e[r]]=!!i;return w}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var f="2.6.2",l={},c=!0,h=t.documentElement,p="modernizr",d=t.createElement(p),v=d.style,m=t.createElement("input"),g=":)",y={}.toString,b={},w={},E={},S=[],x=S.slice,T,N={}.hasOwnProperty,C;!s(N,"undefined")&&!s(N.call,"undefined")?C=function(e,t){return N.call(e,t)}:C=function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(typeof t!="function")throw new TypeError;var n=x.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,o=t.apply(s,n.concat(x.call(arguments)));return Object(o)===o?o:s}return t.apply(e,n.concat(x.call(arguments)))};return r});for(var k in b)C(b,k)&&(T=k.toLowerCase(),l[T]=b[k](),S.push((l[T]?"":"no-")+T));return l.input||a(),l.addTest=function(e,t){if(typeof e=="object")for(var r in e)C(e,r)&&l.addTest(r,e[r]);else{e=e.toLowerCase();if(l[e]!==n)return l;t=typeof t=="function"?t():t,typeof c!="undefined"&&c&&(h.className+=" "+(t?"":"no-")+e),l[e]=t}return l},r(""),d=m=null,function(e,t){function n(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var e=g.elements;return typeof e=="string"?e.split(" "):e}function i(e){var t=v[e[p]];return t||(t={},d++,e[p]=d,v[d]=t),t}function s(e,n,r){n||(n=t);if(m)return n.createElement(e);r||(r=i(n));var s;return r.cache[e]?s=r.cache[e].cloneNode():c.test(e)?s=(r.cache[e]=r.createElem(e)).cloneNode():s=r.createElem(e),s.canHaveChildren&&!l.test(e)?r.frag.appendChild(s):s}function o(e,n){e||(e=t);if(m)return e.createDocumentFragment();n=n||i(e);var s=n.frag.cloneNode(),o=0,u=r(),a=u.length;for(;o<a;o++)s.createElement(u[o]);return s}function u(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return g.shivMethods?s(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/\w+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(g,t.frag)}function a(e){e||(e=t);var r=i(e);return g.shivCSS&&!h&&!r.hasCSS&&(r.hasCSS=!!n(e,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),m||u(e,r),e}var f=e.html5||{},l=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,c=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,h,p="_html5shiv",d=0,v={},m;(function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",h="hidden"in e,m=e.childNodes.length==1||function(){t.createElement("a");var e=t.createDocumentFragment();return typeof e.cloneNode=="undefined"||typeof e.createDocumentFragment=="undefined"||typeof e.createElement=="undefined"}()}catch(n){h=!0,m=!0}})();var g={elements:f.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:f.shivCSS!==!1,supportsUnknownElements:m,shivMethods:f.shivMethods!==!1,type:"default",shivDocument:a,createElement:s,createDocumentFragment:o};e.html5=g,a(t)}(this,t),l._version=f,h.className=h.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(c?" js "+S.join(" "):""),l}(this,this.document),function(e,t,n){function r(e){return"[object Function]"==d.call(e)}function i(e){return"string"==typeof e}function s(){}function o(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function u(){var e=v.shift();m=1,e?e.t?h(function(){("c"==e.t?k.injectCss:k.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),u()):m=0}function a(e,n,r,i,s,a,f){function l(t){if(!d&&o(c.readyState)&&(w.r=d=1,!m&&u(),c.onload=c.onreadystatechange=null,t)){"img"!=e&&h(function(){b.removeChild(c)},50);for(var r in T[n])T[n].hasOwnProperty(r)&&T[n][r].onload()}}var f=f||k.errorTimeout,c=t.createElement(e),d=0,g=0,w={t:r,s:n,e:s,a:a,x:f};1===T[n]&&(g=1,T[n]=[]),"object"==e?c.data=n:(c.src=n,c.type=e),c.width=c.height="0",c.onerror=c.onload=c.onreadystatechange=function(){l.call(this,g)},v.splice(i,0,w),"img"!=e&&(g||2===T[n]?(b.insertBefore(c,y?null:p),h(l,f)):T[n].push(c))}function f(e,t,n,r,s){return m=0,t=t||"j",i(e)?a("c"==t?E:w,e,t,this.i++,n,r,s):(v.splice(this.i++,0,e),1==v.length&&u()),this}function l(){var e=k;return e.loader={load:f,i:0},e}var c=t.documentElement,h=e.setTimeout,p=t.getElementsByTagName("script")[0],d={}.toString,v=[],m=0,g="MozAppearance"in c.style,y=g&&!!t.createRange().compareNode,b=y?c:p.parentNode,c=e.opera&&"[object Opera]"==d.call(e.opera),c=!!t.attachEvent&&!c,w=g?"object":c?"script":"img",E=c?"script":w,S=Array.isArray||function(e){return"[object Array]"==d.call(e)},x=[],T={},N={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}},C,k;k=function(e){function t(e){var e=e.split("!"),t=x.length,n=e.pop(),r=e.length,n={url:n,origUrl:n,prefixes:e},i,s,o;for(s=0;s<r;s++)o=e[s].split("="),(i=N[o.shift()])&&(n=i(n,o));for(s=0;s<t;s++)n=x[s](n);return n}function o(e,i,s,o,u){var a=t(e),f=a.autoCallback;a.url.split(".").pop().split("?").shift(),a.bypass||(i&&(i=r(i)?i:i[e]||i[o]||i[e.split("/").pop().split("?")[0]]),a.instead?a.instead(e,i,s,o,u):(T[a.url]?a.noexec=!0:T[a.url]=1,s.load(a.url,a.forceCSS||!a.forceJS&&"css"==a.url.split(".").pop().split("?").shift()?"c":n,a.noexec,a.attrs,a.timeout),(r(i)||r(f))&&s.load(function(){l(),i&&i(a.origUrl,u,o),f&&f(a.origUrl,u,o),T[a.url]=2})))}function u(e,t){function n(e,n){if(e){if(i(e))n||(f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}),o(e,f,t,0,u);else if(Object(e)===e)for(p in h=function(){var t=0,n;for(n in e)e.hasOwnProperty(n)&&t++;return t}(),e)e.hasOwnProperty(p)&&(!n&&!--h&&(r(f)?f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}:f[p]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),c()}}(l[p])),o(e[p],f,t,p,u))}else!n&&c()}var u=!!e.test,a=e.load||e.both,f=e.callback||s,l=f,c=e.complete||s,h,p;n(u?e.yep:e.nope,!!a),a&&n(a)}var a,f,c=this.yepnope.loader;if(i(e))o(e,0,c,0);else if(S(e))for(a=0;a<e.length;a++)f=e[a],i(f)?o(f,0,c,0):S(f)?k(f):Object(f)===f&&u(f,c);else Object(e)===e&&u(e,c)},k.addPrefix=function(e,t){N[e]=t},k.addFilter=function(e){x.push(e)},k.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",C=function(){t.removeEventListener("DOMContentLoaded",C,0),t.readyState="complete"},0)),e.yepnope=l(),e.yepnope.executeStack=u,e.yepnope.injectJs=function(e,n,r,i,a,f){var l=t.createElement("script"),c,d,i=i||k.errorTimeout;l.src=e;for(d in r)l.setAttribute(d,r[d]);n=f?u:n||s,l.onreadystatechange=l.onload=function(){!c&&o(l.readyState)&&(c=1,n(),l.onload=l.onreadystatechange=null)},h(function(){c||(c=1,n(1))},i),a?l.onload():p.parentNode.insertBefore(l,p)},e.yepnope.injectCss=function(e,n,r,i,o,a){var i=t.createElement("link"),f,n=a?u:n||s;i.href=e,i.rel="stylesheet",i.type="text/css";for(f in r)i.setAttribute(f,r[f]);o||(p.parentNode.insertBefore(i,p),h(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("pointerevents",function(){var e=document.createElement("x"),t=document.documentElement,n=window.getComputedStyle,r;return"pointerEvents"in e.style?(e.style.pointerEvents="auto",e.style.pointerEvents="x",t.appendChild(e),r=n&&n(e,"").pointerEvents==="auto",t.removeChild(e),!!r):!1})}catch(e){}define("libs/modernizr",function(){}),function(e,t,n){function f(e,t,n){var r=[];for(var i=0;i<e.length;i++){var s=tinycolor(e[i]),u=s.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";u+=tinycolor.equals(t,e[i])?" sp-thumb-active":"";var a=o?"background-color:"+s.toRgbString():"filter:"+s.toFilter();r.push('<span title="'+s.toRgbString()+'" data-color="'+s.toRgbString()+'" class="'+u+'"><span class="sp-thumb-inner" style="'+a+';" /></span>')}return"<div class='sp-cf "+n+"'>"+r.join("")+"</div>"}function l(){for(var e=0;e<i.length;e++)i[e]&&i[e].hide()}function c(e,n){var i=t.extend({},r,e);return i.callbacks={move:m(i.move,n),change:m(i.change,n),show:m(i.show,n),hide:m(i.hide,n),beforeShow:m(i.beforeShow,n)},i}function h(r,h){function gt(){d.showPaletteOnly&&(d.showPalette=!0),J.toggleClass("sp-flat",m),J.toggleClass("sp-input-disabled",!d.showInput),J.toggleClass("sp-alpha-enabled",d.showAlpha),J.toggleClass("sp-buttons-disabled",!d.showButtons),J.toggleClass("sp-palette-disabled",!d.showPalette),J.toggleClass("sp-palette-only",d.showPaletteOnly),J.toggleClass("sp-initial-disabled",!d.showInitial),J.addClass(d.className),jt()}function yt(){function o(e){return e.data&&e.data.ignore?(Ot(t(this).data("color")),Dt()):(Ot(t(this).data("color")),Bt(!0),Dt(),Lt()),!1}s&&J.find("*:not(input)").attr("unselectable","on"),gt(),at&&X.after(ft).hide();if(m)X.after(J).hide();else{var n=d.appendTo==="parent"?X.parent():t(d.appendTo);n.length!==1&&(n=t("body")),n.append(J)}if(w&&e.localStorage){try{var r=e.localStorage[w].split(",#");r.length>1&&(delete e.localStorage[w],t.each(r,function(e,t){bt(t)}))}catch(i){}try{I=e.localStorage[w].split(";")}catch(i){}}lt.bind("click.spectrum touchstart.spectrum",function(e){V||Ct(),e.stopPropagation(),t(e.target).is("input")||e.preventDefault()}),(X.is(":disabled")||d.disabled===!0)&&Rt(),J.click(v),nt.change(Nt),nt.bind("paste",function(){setTimeout(Nt,1)}),nt.keydown(function(e){e.keyCode==13&&Nt()}),st.text(d.cancelText),st.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Lt("cancel")}),ot.text(d.chooseText),ot.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),_t()&&(Bt(!0),Lt())}),g(et,function(e,t,n){B=e/O,n.shiftKey&&(B=Math.round(B*10)/10),Dt()}),g(G,function(e,t){D=parseFloat(t/L),Dt()},xt,Tt),g(K,function(e,t,n){if(!n.shiftKey)U=null;else if(!U){var r=P*N,i=C-H*C,s=Math.abs(e-r)>Math.abs(t-i);U=s?"x":"y"}var o=!U||U==="x",u=!U||U==="y";o&&(P=parseFloat(e/N)),u&&(H=parseFloat((C-t)/C)),Dt()},xt,Tt),ht?(Ot(ht),Pt(),vt=dt||tinycolor(ht).format,bt(ht)):Pt(),m&&kt();var u=s?"mousedown.spectrum":"click.spectrum touchstart.spectrum";rt.delegate(".sp-thumb-el",u,o),it.delegate(".sp-thumb-el:nth-child(1)",u,{ignore:!0},o)}function bt(n){if(b){var r=tinycolor(n).toRgbString();if(t.inArray(r,I)===-1){I.push(r);while(I.length>q)I.shift()}if(w&&e.localStorage)try{e.localStorage[w]=I.join(";")}catch(i){}}}function wt(){var e=[],t=I,n={},r;if(d.showPalette){for(var i=0;i<F.length;i++)for(var s=0;s<F[i].length;s++)r=tinycolor(F[i][s]).toRgbString(),n[r]=!0;for(i=0;i<t.length;i++)r=tinycolor(t[i]).toRgbString(),n.hasOwnProperty(r)||(e.push(t[i]),n[r]=!0)}return e.reverse().slice(0,d.maxSelectionSize)}function Et(){var e=Mt(),n=t.map(F,function(t,n){return f(t,e,"sp-palette-row sp-palette-row-"+n)});I&&n.push(f(wt(),e,"sp-palette-row sp-palette-row-selection")),rt.html(n.join(""))}function St(){if(d.showInitial){var e=pt,t=Mt();it.html(f([e,t],t,"sp-palette-row-initial"))}}function xt(){(C<=0||N<=0||L<=0)&&jt(),J.addClass(R),U=null}function Tt(){J.removeClass(R)}function Nt(){var e=tinycolor(nt.val());e.ok?Ot(e):nt.addClass("sp-validation-error")}function Ct(){T?Lt():kt()}function kt(){var n=t.Event("beforeShow.spectrum");if(T){jt();return}X.trigger(n,[Mt()]);if(S.beforeShow(Mt())===!1||n.isDefaultPrevented())return;l(),T=!0,t(z).bind("click.spectrum",Lt),t(e).bind("resize.spectrum",x),ft.addClass("sp-active"),J.removeClass("sp-hidden"),d.showPalette&&Et(),jt(),Pt(),pt=Mt(),St(),S.show(pt),X.trigger("show.spectrum",[pt])}function Lt(n){if(n&&n.type=="click"&&n.button==2)return;if(!T||m)return;T=!1,t(z).unbind("click.spectrum",Lt),t(e).unbind("resize.spectrum",x),ft.removeClass("sp-active"),J.addClass("sp-hidden");var r=!tinycolor.equals(Mt(),pt);r&&(mt&&n!=="cancel"?Bt(!0):At()),S.hide(Mt()),X.trigger("hide.spectrum",[Mt()])}function At(){Ot(pt,!0)}function Ot(e,t){if(tinycolor.equals(e,Mt()))return;var n=tinycolor(e),r=n.toHsv();D=r.h%360/360,P=r.s,H=r.v,B=r.a,Pt(),n.ok&&!t&&(vt=dt||n.format)}function Mt(e){return e=e||{},tinycolor.fromRatio({h:D,s:P,v:H,a:Math.round(B*100)/100},{format:e.format||vt})}function _t(){return!nt.hasClass("sp-validation-error")}function Dt(){Pt(),S.move(Mt()),X.trigger("move.spectrum",[Mt()])}function Pt(){nt.removeClass("sp-validation-error"),Ht();var e=tinycolor.fromRatio({h:D,s:1,v:1});K.css("background-color",e.toHexString());var t=vt;B<1&&(t==="hex"||t==="hex3"||t==="hex6"||t==="name")&&(t="rgb");var n=Mt({format:t}),r=n.toHexString(),i=n.toRgbString();o||n.alpha===1?ct.css("background-color",i):(ct.css("background-color","transparent"),ct.css("filter",n.toFilter()));if(d.showAlpha){var u=n.toRgb();u.a=0;var a=tinycolor(u).toRgbString(),f="linear-gradient(left, "+a+", "+r+")";s?Z.css("filter",tinycolor(a).toFilter({gradientType:1},r)):(Z.css("background","-webkit-"+f),Z.css("background","-moz-"+f),Z.css("background","-ms-"+f),Z.css("background",f))}d.showInput&&nt.val(n.toString(t)),d.showPalette&&Et(),St()}function Ht(){var e=P,t=H,n=e*N,r=C-t*C;n=Math.max(-k,Math.min(N-k,n-k)),r=Math.max(-k,Math.min(C-k,r-k)),Q.css({top:r,left:n});var i=B*O;tt.css({left:i-M/2});var s=D*L;Y.css({top:s-_})}function Bt(e){var t=Mt();ut&&X.val(t.toString(vt));var n=!tinycolor.equals(t,pt);pt=t,bt(t),e&&n&&(S.change(t),X.trigger("change",[t]))}function jt(){N=K.width(),C=K.height(),k=Q.height(),A=G.width(),L=G.height(),_=Y.height(),O=et.width(),M=tt.width(),m||(J.css("position","absolute"),J.offset(p(J,lt))),Ht()}function Ft(){X.show(),lt.unbind("click.spectrum touchstart.spectrum"),J.remove(),ft.remove(),i[Ut.id]=null}function It(e,r){if(e===n)return t.extend({},d);if(r===n)return d[e];d[e]=r,gt()}function qt(){V=!1,X.attr("disabled",!1),lt.removeClass("sp-disabled")}function Rt(){Lt(),V=!0,X.attr("disabled",!0),lt.addClass("sp-disabled")}var d=c(h,r),m=d.flat,b=d.showSelectionPalette,w=d.localStorageKey,E=d.theme,S=d.callbacks,x=y(jt,10),T=!1,N=0,C=0,k=0,L=0,A=0,O=0,M=0,_=0,D=0,P=0,H=0,B=1,j=d.palette.slice(0),F=t.isArray(j[0])?j:[j],I=d.selectionPalette.slice(0),q=d.maxSelectionSize,R="sp-dragging",U=null,z=r.ownerDocument,W=z.body,X=t(r),V=!1,J=t(a,z).addClass(E),K=J.find(".sp-color"),Q=J.find(".sp-dragger"),G=J.find(".sp-hue"),Y=J.find(".sp-slider"),Z=J.find(".sp-alpha-inner"),et=J.find(".sp-alpha"),tt=J.find(".sp-alpha-handle"),nt=J.find(".sp-input"),rt=J.find(".sp-palette"),it=J.find(".sp-initial"),st=J.find(".sp-cancel"),ot=J.find(".sp-choose"),ut=X.is("input"),at=ut&&!m,ft=at?t(u).addClass(E).addClass(d.className):t([]),lt=at?ft:X,ct=ft.find(".sp-preview-inner"),ht=d.color||ut&&X.val(),pt=!1,dt=d.preferredFormat,vt=dt,mt=!d.showButtons||d.clickoutFiresChange;yt();var Ut={show:kt,hide:Lt,toggle:Ct,reflow:jt,option:It,enable:qt,disable:Rt,set:function(e){Ot(e),Bt()},get:Mt,destroy:Ft,container:J};return Ut.id=i.push(Ut)-1,Ut}function p(e,n){var r=0,i=e.outerWidth(),s=e.outerHeight(),o=n.outerHeight(),u=e[0].ownerDocument,a=u.documentElement,f=a.clientWidth+t(u).scrollLeft(),l=a.clientHeight+t(u).scrollTop(),c=n.offset();return c.top+=o,c.left-=Math.min(c.left,c.left+i>f&&f>i?Math.abs(c.left+i-f):0),c.top-=Math.min(c.top,c.top+s>l&&l>s?Math.abs(s+o-r):r),c}function d(){}function v(e){e.stopPropagation()}function m(e,t){var n=Array.prototype.slice,r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}function g(n,r,i,o){function d(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function v(e){if(a){if(s&&document.documentMode<9&&!e.button)return g();var t=e.originalEvent.touches,i=t?t[0].pageX:e.pageX,o=t?t[0].pageY:e.pageY,u=Math.max(0,Math.min(i-f.left,c)),p=Math.max(0,Math.min(o-f.top,l));h&&d(e),r.apply(n,[u,p,e])}}function m(e){var r=e.which?e.which==3:e.button==2,s=e.originalEvent.touches;!r&&!a&&i.apply(n,arguments)!==!1&&(a=!0,l=t(n).height(),c=t(n).width(),f=t(n).offset(),t(u).bind(p),t(u.body).addClass("sp-dragging"),h||v(e),d(e))}function g(){a&&(t(u).unbind(p),t(u.body).removeClass("sp-dragging"),o.apply(n,arguments)),a=!1}r=r||function(){},i=i||function(){},o=o||function(){};var u=n.ownerDocument||document,a=!1,f={},l=0,c=0,h="ontouchstart"in e,p={};p.selectstart=d,p.dragstart=d,p["touchmove mousemove"]=v,p["touchend mouseup"]=g,t(n).bind("touchstart mousedown",m)}function y(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}}function b(){e.console&&(Function.prototype.bind?b=Function.prototype.bind.call(console.log,console):b=function(){Function.prototype.apply.call(console.log,console,arguments)},b.apply(this,arguments))}var r={beforeShow:d,move:d,change:d,show:d,hide:d,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},i=[],s=!!/msie/i.exec(e.navigator.userAgent),o=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),n=t.style;return n.cssText="background-color:rgba(0,0,0,.5)",e(n.backgroundColor,"rgba")||e(n.backgroundColor,"hsla")}(),u=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),a=function(){var e="";if(s)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),w="spectrum.id";t.fn.spectrum=function(e,n){if(typeof e=="string"){var r=this,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=i[t(this).data(w)];if(n){var o=n[e];if(!o)throw new Error("Spectrum: no such method: '"+e+"'");e=="get"?r=n.get():e=="container"?r=n.container:e=="option"?r=n.option.apply(n,s):e=="destroy"?(n.destroy(),t(this).removeData(w)):o.apply(n,s)}}),r}return this.spectrum("destroy").each(function(){var n=h(this,e);t(this).data(w,n.id)})},t.fn.spectrum.load=!0,t.fn.spectrum.loadOpts={},t.fn.spectrum.draggable=g,t.fn.spectrum.defaults=r,t.spectrum={},t.spectrum.localization={},t.spectrum.palettes={},t.fn.spectrum.processNativeColorInputs=function(){var e=t("<input type='color' value='!' />")[0],n=e.type==="color"&&e.value!="!";n||t("input[type=color]").spectrum({preferredFormat:"hex6"})},function(e){function f(e,t){e=e?e:"",t=t||{};if(typeof e=="object"&&e.hasOwnProperty("_tc_id"))return e;var n=l(e),i=n.r,o=n.g,u=n.b,a=n.a,c=s(100*a)/100,p=t.format||n.format;return i<1&&(i=s(i)),o<1&&(o=s(o)),u<1&&(u=s(u)),{ok:n.ok,format:p,_tc_id:r++,alpha:a,toHsv:function(){var e=d(i,o,u);return{h:e.h*360,s:e.s,v:e.v,a:a}},toHsvString:function(){var e=d(i,o,u),t=s(e.h*360),n=s(e.s*100),r=s(e.v*100);return a==1?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+c+")"},toHsl:function(){var e=h(i,o,u);return{h:e.h*360,s:e.s,l:e.l,a:a}},toHslString:function(){var e=h(i,o,u),t=s(e.h*360),n=s(e.s*100),r=s(e.l*100);return a==1?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+c+")"},toHex:function(e){return m(i,o,u,e)},toHexString:function(e){return"#"+m(i,o,u,e)},toRgb:function(){return{r:s(i),g:s(o),b:s(u),a:a}},toRgbString:function(){return a==1?"rgb("+s(i)+", "+s(o)+", "+s(u)+")":"rgba("+s(i)+", "+s(o)+", "+s(u)+", "+c+")"},toPercentageRgb:function(){return{r:s(w(i,255)*100)+"%",g:s(w(o,255)*100)+"%",b:s(w(u,255)*100)+"%",a:a}},toPercentageRgbString:function(){return a==1?"rgb("+s(w(i,255)*100)+"%, "+s(w(o,255)*100)+"%, "+s(w(u,255)*100)+"%)":"rgba("+s(w(i,255)*100)+"%, "+s(w(o,255)*100)+"%, "+s(w(u,255)*100)+"%, "+c+")"},toName:function(){return y[m(i,o,u,!0)]||!1},toFilter:function(e){var n=m(i,o,u),r=n,s=Math.round(parseFloat(a)*255).toString(16),l=s,c=t&&t.gradientType?"GradientType = 1, ":"";if(e){var h=f(e);r=h.toHex(),l=Math.round(parseFloat(h.alpha)*255).toString(16)}return"progid:DXImageTransform.Microsoft.gradient("+c+"startColorstr=#"+N(s)+n+",endColorstr=#"+N(l)+r+")"},toString:function(e){e=e||this.format;var t=!1;e==="rgb"&&(t=this.toRgbString()),e==="prgb"&&(t=this.toPercentageRgbString());if(e==="hex"||e==="hex6")t=this.toHexString();return e==="hex3"&&(t=this.toHexString(!0)),e==="name"&&(t=this.toName()),e==="hsl"&&(t=this.toHslString()),e==="hsv"&&(t=this.toHsvString()),t||this.toHexString()}}}function l(e){var t={r:0,g:0,b:0},n=1,r=!1,i=!1;typeof e=="string"&&(e=L(e)),typeof e=="object"&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=c(e.r,e.g,e.b),r=!0,i=String(e.r).substr(-1)==="%"?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=C(e.s),e.v=C(e.v),t=v(e.h,e.s,e.v),r=!0,i="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=C(e.s),e.l=C(e.l),t=p(e.h,e.s,e.l),r=!0,i="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=parseFloat(n);if(isNaN(n)||n<0||n>1)n=1;return{ok:r,format:e.format||i,r:o(255,u(t.r,0)),g:o(255,u(t.g,0)),b:o(255,u(t.b,0)),a:n}}function c(e,t,n){return{r:w(e,255)*255,g:w(t,255)*255,b:w(n,255)*255}}function h(e,t,n){e=w(e,255),t=w(t,255),n=w(n,255);var r=u(e,t,n),i=o(e,t,n),s,a,f=(r+i)/2;if(r==i)s=a=0;else{var l=r-i;a=f>.5?l/(2-r-i):l/(r+i);switch(r){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return{h:s,s:a,l:f}}function p(e,t,n){function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var r,i,s;e=w(e,360),t=w(t,100),n=w(n,100);if(t===0)r=i=s=n;else{var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return{r:r*255,g:i*255,b:s*255}}function d(e,t,n){e=w(e,255),t=w(t,255),n=w(n,255);var r=u(e,t,n),i=o(e,t,n),s,a,f=r,l=r-i;a=r===0?0:l/r;if(r==i)s=0;else{switch(r){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return{h:s,s:a,v:f}}function v(e,t,n){e=w(e,360)*6,t=w(t,100),n=w(n,100);var r=i.floor(e),s=e-r,o=n*(1-t),u=n*(1-s*t),a=n*(1-(1-s)*t),f=r%6,l=[n,u,o,o,a,n][f],c=[a,n,n,u,o,o][f],h=[o,o,a,n,n,u][f];return{r:l*255,g:c*255,b:h*255}}function m(e,t,n,r){var i=[N(s(e).toString(16)),N(s(t).toString(16)),N(s(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function b(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function w(e,t){x(e)&&(e="100%");var n=T(e);return e=o(t,u(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),i.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function E(e){return o(1,u(0,e))}function S(e){return parseInt(e,16)}function x(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function T(e){return typeof e=="string"&&e.indexOf("%")!=-1}function N(e){return e.length==1?"0"+e:""+e}function C(e){return e<=1&&(e=e*100+"%"),e}function L(e){e=e.replace(t,"").replace(n,"").toLowerCase();var r=!1;if(g[e])e=g[e],r=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0};var i;return(i=k.rgb.exec(e))?{r:i[1],g:i[2],b:i[3]}:(i=k.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=k.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=k.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=k.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=k.hex6.exec(e))?{r:S(i[1]),g:S(i[2]),b:S(i[3]),format:r?"name":"hex"}:(i=k.hex3.exec(e))?{r:S(i[1]+""+i[1]),g:S(i[2]+""+i[2]),b:S(i[3]+""+i[3]),format:r?"name":"hex"}:!1}var t=/^[\s,#]+/,n=/\s+$/,r=0,i=Math,s=i.round,o=i.min,u=i.max,a=i.random;f.fromRatio=function(e,t){if(typeof e=="object"){var n={};for(var r in e)e.hasOwnProperty(r)&&(r==="a"?n[r]=e[r]:n[r]=C(e[r]));e=n}return f(e,t)},f.equals=function(e,t){return!e||!t?!1:f(e).toRgbString()==f(t).toRgbString()},f.random=function(){return f.fromRatio({r:a(),g:a(),b:a()})},f.desaturate=function(e,t){var n=f(e).toHsl();return n.s-=(t||10)/100,n.s=E(n.s),f(n)},f.saturate=function(e,t){var n=f(e).toHsl();return n.s+=(t||10)/100,n.s=E(n.s),f(n)},f.greyscale=function(e){return f.desaturate(e,100)},f.lighten=function(e,t){var n=f(e).toHsl();return n.l+=(t||10)/100,n.l=E(n.l),f(n)},f.darken=function(e,t){var n=f(e).toHsl();return n.l-=(t||10)/100,n.l=E(n.l),f(n)},f.complement=function(e){var t=f(e).toHsl();return t.h=(t.h+180)%360,f(t)},f.triad=function(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+120)%360,s:t.s,l:t.l}),f({h:(n+240)%360,s:t.s,l:t.l})]},f.tetrad=function(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+90)%360,s:t.s,l:t.l}),f({h:(n+180)%360,s:t.s,l:t.l}),f({h:(n+270)%360,s:t.s,l:t.l})]},f.splitcomplement=function(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+72)%360,s:t.s,l:t.l}),f({h:(n+216)%360,s:t.s,l:t.l})]},f.analogous=function(e,t,n){t=t||6,n=n||30;var r=f(e).toHsl(),i=360/n,s=[f(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,s.push(f(r));return s},f.monochromatic=function(e,t){t=t||6;var n=f(e).toHsv(),r=n.h,i=n.s,s=n.v,o=[],u=1/t;while(t--)o.push(f({h:r,s:i,v:s})),s=(s+u)%1;return o},f.readability=function(e,t){var n=f(e).toRgb(),r=f(t).toRgb(),i=(n.r*299+n.g*587+n.b*114)/1e3,s=(r.r*299+r.g*587+r.b*114)/1e3,o=Math.max(n.r,r.r)-Math.min(n.r,r.r)+Math.max(n.g,r.g)-Math.min(n.g,r.g)+Math.max(n.b,r.b)-Math.min(n.b,r.b);return{brightness:Math.abs(i-s),color:o}},f.readable=function(e,t){var n=f.readability(e,t);return n.brightness>125&&n.color>500},f.mostReadable=function(e,t){var n=null,r=0,i=!1;for(var s=0;s<t.length;s++){var o=f.readability(e,t[s]),u=o.brightness>125&&o.color>500,a=3*(o.brightness/125)+o.color/500;if(u&&!i||u&&i&&a>r||!u&&!i&&a>r)i=u,r=a,n=f(t[s])}return n};var g=f.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},y=f.hexNames=b(g),k=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();e.tinycolor=f}(this),t(function(){t.fn.spectrum.load&&t.fn.spectrum.processNativeColorInputs()})}(window,jQuery),define("libs/spectrum",function(){}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/backbone-forms/color",["libs/backbone-forms","libs/modernizr","libs/spectrum"],function(e){var n;return e.editors.Color=function(e){function r(){return n=r.__super__.constructor.apply(this,arguments),n}return t(r,e),r.prototype.events={"change  input[type=color]":"onColorChange","change  input[type=text]":"onTextChange","keyup   input[type=text]":"onTextChange","keydown input[type=text]":"onTextChange",focus:"onFocus",blur:"onBlur"},r.prototype.onColorChange=function(){return this.setPickerColor(this.$colorInput().val())},r.prototype.onTextChange=function(){return this.color=this.$textInput().val(),this.$colorInput().val(this.color),this.trigger("change",this)},r.prototype.onFocus=function(){return this.trigger("focus",this)},r.prototype.onBlur=function(){return this.trigger("blur",this)},r.prototype.render=function(){var e=this;return this.$el.html(this.$colorInput()),Modernizr.inputtypes.color||this.$colorInput().spectrum({color:this.value,move:function(t){return e.setPickerColor("#"+t.toHex())}}),this.$el.append(this.$textInput()),this.setValue(this.value),this},r.prototype.setPickerColor=function(e){return this.color=e,this.$textInput().val(this.color),this.trigger("change",this)},r.prototype.$colorInput=function(){return this._colorInput!=null?this._colorInput:this._colorInput=$('<input class="input-color-color" type="color"></input>')},r.prototype.$textInput=function(){return this._textInput!=null?this._textInput:this._textInput=$('<input class="input-color-text" type="text"></input>')},r.prototype.getValue=function(){return this.color},r.prototype.setValue=function(e){return this.color=e,this.$colorInput().val(this.color),this.$textInput().val(this.color)},r.prototype.focus=function(){if(!this.hasFocus)return this.$colorInput().focus()},r.prototype.blur=function(){if(this.hasFocus)return this.$colorInput().blur()},r}(e.editors.Base)})}.call(this),function(){define("libs/clayer",[],function(){var e={};return window.clayer=e,e.texts={drag:"drag"},e.makeCall=function(e,t,n){if(e[t])return e[t].apply(e,n)},e.setCss3=function(e,t,n,r){r=r||!1;var i=["","-ms-","-moz-","-webkit-","-o-"];for(var s=0;s<i.length;s++){var o=i[s]+t,u=(r?i[s]:"")+n;e.css(o,u)}},e.isTouch="ontouchstart"in document.documentElement,e.initBody=function(){e.isTouch?$("body").addClass("clayer-body-touch"):$("body").addClass("clayer-body-mouse")},e.Touchable=function(){return this.init.apply(this,arguments)},e.Touchable.prototype={init:function(e,t){this.$element=e,this.$document=$(e[0].ownerDocument),this.callbacks=t,this.mouseDown=$.proxy(this.mouseDown,this),this.mouseMove=$.proxy(this.mouseMove,this),this.mouseUp=$.proxy(this.mouseUp,this),this.touchStart=$.proxy(this.touchStart,this),this.touchMove=$.proxy(this.touchMove,this),this.touchEnd=$.proxy(this.touchEnd,this),this.hoverMove=$.proxy(this.hoverMove,this),this.hoverLeave=$.proxy(this.hoverLeave,this),this.documentEvents={mousemove:this.mouseMove,mouseup:this.mouseUp,touchmove:this.touchMove,touchend:this.touchEnd,touchcancel:this.touchEnd},this.setTouchable(!1),this.setHoverable(!1)},remove:function(){this.setTouchable(!1),this.setHoverable(!1)},setTouchable:function(e){if(this.isTouchable===e)return;this.isTouchable=e,this.touchEvent=null,e?this.$element.on({mousedown:this.mouseDown,touchstart:this.touchStart}):(this.$element.off("mousedown touchstart"),this.$document.off(this.documentEvents))},setHoverable:function(e){if(this.isHoverable===e)return;this.isHoverable=e,this.hoverEvent=null,e?this.$element.on({mousemove:this.hoverMove,mouseleave:this.hoverLeave}):this.$element.off({mousemove:this.hoverMove,mouseleave:this.hoverLeave})},mouseDown:function(t){return this.isTouchable&&(this.$document.on({mousemove:this.mouseMove,mouseup:this.mouseUp}),this.touchEvent=new e.PositionEvent(this.$element,t,t.timeStamp,!0),e.makeCall(this.callbacks,"touchDown",[this.touchEvent])),!1},mouseMove:function(t){return this.isTouchable&&this.touchEvent&&(this.touchEvent.move(t,t.timeStamp),e.makeCall(this.callbacks,"touchMove",[this.touchEvent])),!1},mouseUp:function(t){return this.isTouchable&&this.touchEvent&&(this.touchEvent.up(t,t.timeStamp),e.makeCall(this.callbacks,"touchUp",[this.touchEvent]),this.touchEvent=null),this.$document.off(this.documentEvents),!1},touchStart:function(t){return this.$element.off({mousedown:this.mouseDown,mousemove:this.hoverMove,mouseleave:this.hoverLeave}),!this.isTouchable||this.touchEvent||t.originalEvent.targetTouches.length>1?this.touchEnd(t):(this.$document.on({touchmove:this.touchMove,touchend:this.touchEnd,touchcancel:this.touchEnd}),this.touchEvent=new e.PositionEvent(this.$element,t.originalEvent.targetTouches[0],t.timeStamp,!1),e.makeCall(this.callbacks,"touchDown",[this.touchEvent])),!1},touchMove:function(t){if(this.isTouchable&&this.touchEvent){var n=this.findTouchEvent(t.originalEvent.touches);n===null?this.touchEnd(t):(this.touchEvent.move(n,t.timeStamp),e.makeCall(this.callbacks,"touchMove",[this.touchEvent]))}return!1},touchEnd:function(t){return this.isTouchable&&this.touchEvent&&(this.touchEvent.up(this.findTouchEvent(t.originalEvent.touches),t.timeStamp),e.makeCall(this.callbacks,"touchUp",[this.touchEvent]),this.touchEvent=null),this.$document.off(this.documentEvents),!1},hoverMove:function(t){return this.touchEvent?this.mouseMove(t):this.isHoverable&&(this.hoverEvent?this.hoverEvent.move(t,t.timeStamp):this.hoverEvent=new e.PositionEvent(this.$element,t,!0),e.makeCall(this.callbacks,"hoverMove",[this.hoverEvent])),!1},hoverLeave:function(t){return this.isHoverable&&this.hoverEvent&&(this.hoverEvent.move(t),e.makeCall(this.callbacks,"hoverLeave",[this.hoverEvent]),this.hoverEvent=null),!1},findTouchEvent:function(e){for(var t=0;t<e.length;t++)if(e[t].identifier===this.touchEvent.event.identifier)return e[t];return null}},e.PositionEvent=function(){return this.init.apply(this,arguments)},e.PositionEvent.prototype={init:function(e,t,n,r){this.$element=e,this.globalPoint={x:t.pageX,y:t.pageY},this.translation={x:0,y:0},this.deltaTranslation={x:0,y:0},this.localPoint={x:0,y:0},this.updateLocalPoint(),this.event=t,this.startTimestamp=this.timestamp=n,this.hasMoved=!1,this.wasTap=!1,this.mouse=r},getTimeSinceGoingDown:function(){return this.timestamp-this.startTimestamp},resetDeltaTranslation:function(){this.deltaTranslation.x=0,this.deltaTranslation.y=0},inElement:function(){return this.localPoint.x>=0&&this.localPoint.x<=this.$element.outerWidth()&&this.localPoint.y>=0&&this.localPoint.y<=this.$element.outerHeight()},move:function(e,t){this.event=e,this.timestamp=t,this.updatePositions()},up:function(e,t){this.event=e||this.event,this.timestamp=t,this.wasTap=!this.hasMoved&&this.getTimeSinceGoingDown()<300},updatePositions:function(){var e=this.event.pageX-this.globalPoint.x,t=this.event.pageY-this.globalPoint.y;this.translation.x+=e,this.translation.y+=t,this.deltaTranslation.x+=e,this.deltaTranslation.y+=t,this.globalPoint.x=this.event.pageX,this.globalPoint.y=this.event.pageY,this.updateLocalPoint(),this.translation.x*this.translation.x+this.translation.y*this.translation.y>200&&(this.hasMoved=!0)},updateLocalPoint:function(){var e=this.$element.offset();this.localPoint.x=this.globalPoint.x-e.left,this.localPoint.y=this.globalPoint.y-e.top}},e.Scrubbable=function(){return this.init.apply(this,arguments)},e.Scrubbable.prototype={init:function(t,n,r){this.$element=t,this.callbacks=n,this.options=r||{},this.touchable=new e.Touchable(t,this),this.setScrubbable(!0)},remove:function(){this.touchable.remove()},setScrubbable:function(e){this.touchable.setTouchable(e),this.options.disableHover?this.touchable.setHoverable(!1):this.touchable.setHoverable(e)},hoverMove:function(t){e.makeCall(this.callbacks,"scrubMove",[t.localPoint.x,t.localPoint.y,!1])},hoverLeave:function(t){e.makeCall(this.callbacks,"scrubLeave",[])},touchDown:function(e){this.touchMove(e)},touchMove:function(t){e.makeCall(this.callbacks,"scrubMove",[t.localPoint.x,t.localPoint.y,!0])},touchUp:function(t){!t.mouse||!t.inElement()?e.makeCall(this.callbacks,"scrubLeave",[]):this.hoverMove(t),t.wasTap&&e.makeCall(this.callbacks,"scrubTap",[t.localPoint.x,t.localPoint.y])}},e.Slider=function(){return this.init.apply(this,arguments)},e.Slider.prototype={init:function(t,n,r,i){this.$element=t,this.$element.addClass("clayer-slider"),this.callbacks=n,this.valueWidth=r||1,this.markerValue=0,this.knobValue=0,this.$container=$('<div class="clayer-slider-container"></div>'),this.$element.append(this.$container),this.$bar=$('<div class="clayer-slider-bar"></div>'),this.$container.append(this.$bar),this.$segmentContainer=$('<div class="clayer-slider-segment-container"></div>'),this.$bar.append(this.$segmentContainer),this.$marker=$('<div class="clayer-slider-marker"></div>'),this.markerWidth=Math.min(this.valueWidth,10),this.$marker.width(this.markerWidth),this.$bar.append(this.$marker),this.$knob=$('<div class="clayer-slider-knob"></div>'),this.$container.append(this.$knob),this.scrubbable=new e.Scrubbable(this.$element,this,i),this.bounceTimer=null,this.renderKnob(),this.renderMarker()},remove:function(){this.scrubbable.remove(),this.$segmentContainer.remove(),this.$marker.remove(),this.$knob.remove(),this.$bar.remove(),this.$container.remove()},setSegments:function(e){this.$segmentContainer.html("");for(var t=0;t<e.length;t++){var n=e[t],r=$('<div class="clayer-slider-segment"></div>');this.$segmentContainer.append(r),r.css("left",n.start*this.valueWidth),r.width((n.end-n.start+1)*this.valueWidth),r.css("background-color",n.color)}},setValue:function(e){this.markerValue=this.knobValue=e,this.renderKnob(),this.renderMarker()},setKnobValue:function(e){this.knobValue=e,this.renderKnob()},changed:function(t){e.makeCall(this.callbacks,"sliderChanged",[this.knobValue,t])},updateKnob:function(e){e=Math.max(0,Math.min(this.$element.width()-1,e)),this.updateKnobValue(Math.floor(e/this.valueWidth))},updateKnobValue:function(e){this.knobValue!==e&&(this.knobValue=e,this.renderKnob(),this.changed(!1))},updateMarker:function(e){e=Math.max(0,Math.min(this.$element.width()-1,e));var t=Math.floor(e/this.valueWidth);this.markerValue!==t&&(this.knobValue=this.markerValue=t,this.renderKnob(),this.renderMarker(),this.changed(!0))},renderKnob:function(){this.$knob.css("left",(this.knobValue+.5)*this.valueWidth)},renderMarker:function(){this.$marker.css("left",(this.markerValue+.5)*this.valueWidth-this.markerWidth/2)},scrubMove:function(e,t,n){this.$knob.addClass("clayer-active"),n?(this.$knob.addClass("clayer-pressed"),this.updateMarker(e)):(this.$knob.removeClass("clayer-pressed"),this.updateKnob(e))},scrubLeave:function(){this.$knob.removeClass("clayer-active clayer-pressed"),this.updateKnobValue(this.markerValue),e.makeCall(this.callbacks,"sliderLeave")},scrubTap:function(){this.$knob.removeClass("clayer-slider-knob-jump"),setTimeout($.proxy(this.startJump,this),0)},startJump:function(){this.$knob.addClass("clayer-slider-knob-jump")}},e.Draggable=function(){return this.init.apply(this,arguments)},e.Draggable.prototype={init:function(t,n,r){this.$element=t,this.callbacks=n,this.$parent=r,this.touchable=new e.Touchable(t,this),this.setDraggable(!0)},remove:function(){this.touchable.remove()},setDraggable:function(e){this.touchable.setTouchable(e),this.touchable.setHoverable(!1)},touchDown:function(t){this.offsetX=t.localPoint.x+parseInt(this.$element.css("margin-left"),10),this.offsetY=t.localPoint.y+parseInt(this.$element.css("margin-top"),10),e.makeCall(this.callbacks,"dragStart",[this.offsetX,this.offsetY])},touchMove:function(t){var n=t.globalPoint.x-this.offsetX,r=t.globalPoint.y-this.offsetY;if(this.$parent!==undefined){var i=this.$parent.offset();n=Math.max(0,Math.min(this.$parent.outerWidth(),n-i.left)),r=Math.max(0,Math.min(this.$parent.outerHeight(),r-i.top)),this.$element.css("left",n),this.$element.css("top",r),e.makeCall(this.callbacks,"dragMove",[n,r,t.globalPoint.x,t.globalPoint.y])}else e.makeCall(this.callbacks,"dragMove",[n,r,t.globalPoint.x,t.globalPoint.y])},touchUp:function(t){e.makeCall(this.callbacks,"dragEnd"),t.wasTap&&e.makeCall(this.callbacks,"dragTap",[t.localPoint.x,t.localPoint.y])}},e.DragKnob=function(){return this.init.apply(this,arguments)},e.DragKnob.prototype={init:function(t,n,r){this.$element=t,this.$element.addClass("clayer-dragknob"),this.$element.append('<div class="clayer-dragknob-label">'+e.texts.drag+"</div>"),this.$parent=r,this.$parent!==undefined&&this.$parent.addClass("clayer-dragknob-parent"),this.callbacks=n,this.draggable=new e.Draggable(t,this,r)},remove:function(){this.draggable.remove(),this.$element.removeClass("clayer-dragknob"),this.$parent!==undefined&&this.$parent.addClass("clayer-dragknob-parent")},dragStart:function(){this.$element.addClass("clayer-pressed"),this.$element.removeClass("clayer-dragknob-show-label"),e.makeCall(this.callbacks,"dragStart")},dragMove:function(t,n){e.makeCall(this.callbacks,"dragMove",arguments)},dragEnd:function(){this.$element.removeClass("clayer-pressed"),e.makeCall(this.callbacks,"dragEnd")},dragTap:function(){this.$element.addClass("clayer-dragknob-show-label"),e.makeCall(this.callbacks,"dragTap")}},e})}(),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/backbone-forms/range",["cdn.jquery","libs/backbone-forms","libs/clayer"],function(e,n,r){var i;return n.editors.Range=function(n){function s(){return i=s.__super__.constructor.apply(this,arguments),i}return t(s,n),s.prototype.width=210,s.prototype.initialize=function(e){return s.__super__.initialize.call(this,e),this.min=this.schema.min||0,this.max=this.schema.max||100,this.step=this.schema.step||1},s.prototype.render=function(){var t;return this.$el.width(this.width),t=(this.max-this.min)/this.step+1,this.slider=new r.Slider(this.$el,this,this.width/t,{disableHover:!0}),this.$knob=e('<div class="clayer-slider-knob-value"></div>'),this.$(".clayer-slider-knob").append(this.$knob),this.setValue(this.value||0),this},s.prototype.sliderChanged=function(e){var t,n;return t=this._decimalPlaces(),n=Number((e*this.step+this.min).toFixed(t)),this.sliderValue=this._clamp(n),this.updateKnob(),this.trigger("change",this)},s.prototype._decimalPlaces=function(){var e;return e=(""+this.step).split(".")[1]||"",e.length},s.prototype._clamp=function(e){return Math.min(this.max,Math.max(this.min,e))},s.prototype.getValue=function(){return this.sliderValue},s.prototype.setValue=function(e){return this.sliderValue=e,this.slider.setValue((e-this.min)/this.step),this.updateKnob()},s.prototype.updateKnob=function(){return this.$knob.text(this.sliderValue)},s.prototype.focus=function(){this.hasFocus},s.prototype.blur=function(){!this.hasFocus},s}(n.editors.Base)})}.call(this),function(e){e.autocomplete=function(t,n,r){var i={url:!1,apply:function(e){o.val(e)}},s=this;s.settings={};var o=e(t),t=t;s.init=function(){s.settings=e.extend({},i,r),s.input=o,s.ignore=[],s.data={},s.open=!1,s.load(),s.blocker=e('<div class="autocomplete-blocker"></div>').css({position:"fixed",top:0,left:0,right:0,bottom:0,"z-index":1999}).hide(),s.box=e('<div class="autocomplete"></div>').css("z-index",2e3),s.tooltip=e('<div class="versal-tooltip versal-tooltip-white versal-tooltip-top versal-tooltip-align-left versal-tooltip-offset"><div class="versal-tooltip-arrow"></div></div>'),s.box.append(s.tooltip),s.ul=e("<ul></ul>"),s.tooltip.hide(),s.blocker.click(function(e){s.kill(),s.input.focus(),e.stopPropagation()}),o.keyup(function(t){s.pos=s.selection();switch(t.keyCode){case 13:s.apply();case 27:s.kill();case 38:case 40:return!1;case 39:var n=s.value();n.length>0&&s.pos==s.input.val().length&&s.apply();break;case 188:s.apply();default:s.complete(e(this).val())}}),o.keydown(function(e){s.pos=s.selection();switch(e.keyCode){case 9:return s.value().length>0?(s.apply(),!1):!0;case 38:return s.prev(),!1;case 40:return s.next(),!1}}),s.box.click(function(e){e.stopPropagation()}),e("body").append(s.box),e("body").append(s.blocker),e(window).resize(s.position),s.position()},s.load=function(){typeof n=="object"?s.data=n:e.getJSON(n,function(e){s.data=e})},s.complete=function(t){s.kill(),s.position();var n=0,t=e.trim(t);if(t.length==0)return!1;var r=new RegExp("^"+t,"i"),i=s.data.filter(function(e){if(s.ignore.indexOf(e)==-1&&e.match(r))return e});i=i.slice(0,5),e.each(i,function(r,i){var o='<span class="autocomplete-highlight">'+i.substring(0,t.length)+"</span>"+i.substring(t.length),u=e("<li>"+o+"</li>");u.click(function(){s.apply(i)}),u.mouseover(function(){s.ul.find(".selected").removeClass("selected"),u.addClass("over")}),u.mouseout(function(){u.removeClass("over")}),s.ul.append(u),n==0&&u.addClass("first selected"),n++}),n>0&&(s.tooltip.append(s.ul),s.tooltip.show(),s.blocker.show(),s.open=!0)},s.kill=function(){s.blocker.hide(),s.ul.empty(),s.tooltip.hide(),s.open=!1},s.apply=function(e){if(!e)var e=s.value();s.settings.apply.call(s,e)},s.value=function(){return s.selected().text()},s.selected=function(){return s.ul.find(".selected")},s.select=function(e){s.deselect(),e.addClass("selected")},s.deselect=function(){s.selected().removeClass("selected")},s.prev=function(){var e=s.selected(),t=e.prev();t.length>0&&s.select(t)},s.next=function(){var e=s.selected(),t=e.length>0?e.next():s.ul.find("li:first-child");t.length>0&&s.select(t)},s.selection=function(){var e=s.input[0],t=s.val;if(!e.createTextRange)return e.selectionStart;var n=document.selection.createRange().duplicate();return n.moveEnd("character",t.length),n.text==""?t.length:t.lastIndexOf(n.text)},s.position=function(){var e=o.offset(),t=o.innerHeight();e.top=e.top+t,s.box.css(e)},s.init()},e.fn.autocomplete=function(t,n){return this.each(function(){if(undefined==e(this).data("autocomplete")){var r=new e.autocomplete(this,t,n);e(this).data("autocomplete",r)}})}}(jQuery),function(e){e.tagbox=function(t,n){var r={url:!1,autocomplete:{},lowercase:!0,classname:"tagbox",separator:", ",duplicates:!1,minLength:1,maxLength:140,keydown:function(){},onAdd:function(){},onRemove:function(){},onDuplicate:function(){return i.input.focus()},onInvalid:function(){return i.input.focus()},onReady:function(){}},i=this,s=null;i.settings={};var o=e(t),t=t;i.init=function(){i.settings=e.extend({},r,n);var t=o.attr("name"),s=o.attr("id"),u=o.val();i.index=[],i.val="",i.focused=!1,i.origin=o.addClass("tagboxified").hide(),i.box=e('<div class="'+i.settings.classname+'"><ul><li class="new"><input autocomplete="off" tabindex="0" type="text" /></li></ul></div>'),i.input=i.box.find("input").css("width",20),i.bhits=0,i.lhits=0;if(i.settings.url){var a={apply:function(e){i.add(e),this.kill(),i.input.focus()}};i.input.autocomplete(i.settings.url,e.extend({},a,i.settings.autocomplete)),i.autocomplete=i.input.data("autocomplete"),i.settings.onAdd=function(e){i.autocomplete.ignore=i.serialize()},i.settings.onRemove=function(e){i.autocomplete.ignore=i.serialize()}}i.origin.before(i.box),i.measure=e('<div style="display: inline" />').css({"font-size":i.input.css("font-size"),"font-family":i.input.css("font-family"),visibility:"hidden",position:"absolute",top:-1e4,left:-1e4}),e("body").append(i.measure),i.box.click(function(e){i.focus(),i.input.focus(),e.stopPropagation()}),i.input.keydown(function(e){i.val=i.input.val(),i.position=i.selection(),i.settings.keydown.call(i,e,i.val)}),i.input.keyup(function(e){i.val=i.input.val(),i.position=i.selection(),i.resize(i.val),i.val.match(new RegExp(i.settings.separator))&&i.add(i.val)}),i.input.focus(function(e){i.input.focused=!0,i.deselect(),i.bhits=0,i.focus()}),i.input.blur(function(e){i.input.focused=!1,i.bhits=0,i.val.length==0&&i.blur()}),i.settings.onReady.call(this),e(document).keydown(function(e){if(!i.focused)return!0;switch(e.keyCode){case 8:if(!i.input.focused)return i.remove(),!1;if(i.val.length==0)return i.next(),!1;if(i.position==0){if(i.bhits>0)return i.bhits=0,i.next(),!1;i.bhits++}break;case 37:if(!i.input.focused)return i.previous();if(i.val.length==0)return i.next(),!1;if(i.position==0){if(i.lhits>0)return i.lhits=0,i.next(),!1;i.lhits++}break;case 39:if(!i.input.focused)return i.next(),!1;break;case 9:if(i.input.focused&&i.val.length>i.settings.minLength)return i.add(i.val),!1;if(i.selected().length>0)return i.deselect(),i.input.focus(),!1;break;case 13:case 188:if(i.input.focused)return i.settings.autocomplete||i.add(i.val),!1}}).click(function(e){i.val.length>0&&i.add(i.val)}),u.length>0&&i.add(u)},i.resize=function(e){i.measure.text(e),i.input.css("width",i.measure.width()+20)},i.focus=function(t){if(i.focused)return!0;e(".tagboxified").not(i.origin).each(function(){e(this).data("tagbox")&&e(this).data("tagbox").blur()}),i.box.addClass("focus"),i.focused=!0;if(t==undefined)var t=!0;t!==!1&&i.input.focus()},i.blur=function(){if(!i.focused)return!0;i.box.removeClass("focus"),i.focused=!1,i.input.blur(),i.deselect()},i.tag=function(t){return t=t.replace(/,/g,"").replace(/;/g,""),i.settings.lowercase&&(t=t.toLowerCase()),e.trim(t)},i.serialize=function(){return i.index},i.string=function(){return i.serialize().toString()},i.add=function(t){i.input.val("");if(!t&&i.val.length>0)return i.add(i.val);if(!t)return!0;if(e.isArray(t)||t.match(new RegExp(i.settings.separator))){var n=e.isArray(t)?t:t.split(i.settings.separator);return e.each(n,function(e,t){i.add(t)}),!0}var t=i.tag(t);if(t.length<i.settings.minLength||t.length>i.settings.maxLength)return i.settings.onInvalid.call(i,t,length);if(i.settings.duplicates==0&&e.inArray(t,i.index)>-1)return i.settings.onDuplicate.call(i,t);i.index.push(t);var r=e('<li><span class="tag"></span><span class="delete">&#215;</span></li>').data("tag",t);r.find(".tag").text(t),r.find(".delete").click(function(){i.remove(r)}),r.click(function(e){i.blur(),e.stopPropagation(),i.select(r)}),r.focus(function(e){i.select(r)}),i.input.parent().before(r),i.input.val(""),i.input.css("width",20);var s=i.serialize();i.origin.val(s.join(i.settings.separator)),i.settings.onAdd.call(i,t,s,r)},i.select=function(e){if(typeof e=="string"){var e=i.find(e);if(!e)return!1}if(e.length==0)return!1;i.input.blur(),this.deselect(),e.addClass("selected"),i.focus(!1)},i.selected=function(){return i.box.find(".selected")},i.deselect=function(){var e=i.selected();e.removeClass("selected")},i.find=function(t){var n=!1;return i.box.find("li").not(".new").each(function(){e(this).data("tag")==t&&(n=e(this))}),n},i.remove=function(e){i.input.val("");if(typeof e=="string"){var e=i.find(e);if(!e)return!1}var t=i.selected();if(!e&&t.length>0)var e=t.first();var n=i.previous(!0);n.length==0?i.next():i.select(n);var r=e.find(".tag").text();i.removeFromIndex(r),e.remove();var s=i.serialize();i.origin.val(s),i.settings.onRemove.call(i,r,s,e)},i.removeFromIndex=function(e){var t=i.index.indexOf(e);i.index.splice(t,1)},i.selection=function(){var e=i.input[0],t=i.val;if(!e.createTextRange)return e.selectionStart;var n=document.selection.createRange().duplicate();return n.moveEnd("character",t.length),n.text==""?t.length:t.lastIndexOf(n.text)},i.previous=function(e){var t=i.selected(),n=t.length==0?i.box.find("li").not(".new").first():t.prev().not(".new");return e?n:i.select(n)},i.next=function(e){var t=i.selected(),n=t.length==0?i.box.find("li").not(".new").last():t.next();return e?n:n.hasClass("new")?i.input.focus():i.select(n)},i.init()},e.fn.tagbox=function(t){return this.each(function(){if(undefined==e(this).data("tagbox")){var n=new e.tagbox(this,t);e(this).data("tagbox",n)}})}}(jQuery),define("libs/tags",function(){}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/backbone-forms/tags",["cdn.underscore","libs/backbone-forms","libs/tags"],function(e,n,r){var i;return n.editors.Tags=function(n){function r(){return i=r.__super__.constructor.apply(this,arguments),i}return t(r,n),r.prototype.width=210,r.prototype.tagName="input",r.prototype.initialize=function(e){return r.__super__.initialize.call(this,e),this.tagboxValue=this.value||[]},r.prototype.render=function(){var t=this;return e.defer(function(){return t.renderTagbox()}),this},r.prototype.renderTagbox=function(){var e,t,n,r,i,s,o,u=this;return this.tagboxOptions=(n=this.schema.options)!=null?n:[],this.$el.tagbox({url:this.tagboxOptions,lowercase:(r=this.schema.lowercase)!=null?r:!0,duplicates:(i=this.schema.duplicates)!=null?i:!1,minLength:(s=this.schema.minLength)!=null?s:1,maxLength:(o=this.schema.maxLength)!=null?o:140}),this.tagbox=this.$el.data("tagbox"),e=this.tagbox.settings.onAdd,this.tagbox.settings.onAdd=function(){e();if(u.updating)return;return u.onChange(),u.updateTagboxOptions()},t=this.tagbox.settings.onRemove,this.tagbox.settings.onRemove=function(){t();if(u.updating)return;return u.onChange()},this.updateTagbox()},r.prototype.getValue=function(){return this.tagbox!=null&&(this.tagboxValue=this.tagbox.serialize().slice(0)),this.tagboxValue||[]},r.prototype.setValue=function(t){if(!e.isArray(t))return;if(e.isEqual(t,this.tagboxValue))return;return this.tagboxValue=t,this.updateTagbox()},r.prototype.updateTagbox=function(){var e,t,n,r;if(this.tagbox==null)return;this.updating=!0,this.clearValue(),r=this.tagboxValue;for(t=0,n=r.length;t<n;t++)e=r[t],this.tagbox.add(""+e);return this.updating=!1,this.updateTagboxOptions()},r.prototype.clearValue=function(){var e,t;t=[];while(((e=this.tagbox.serialize())!=null?e.length:void 0)>0)t.push(this.tagbox.remove(0));return t},r.prototype.onChange=function(){return this.trigger("change",this)},r.prototype.updateTagboxOptions=function(){var t,n,r,i,s;if(!this.schema.updateAutoComplete)return;i=e.difference(this.tagbox.serialize(),this.tagboxOptions),s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(this.tagboxOptions.push(t));return s},r}(n.editors.Base)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/property_sheet",["app/mediator","cdn.marionette","text!templates/property_sheet.html","libs/backbone-forms","plugins/backbone-forms.bootstrap","views/backbone-forms/color","views/backbone-forms/range","views/backbone-forms/tags"],function(e,n,r,i){var s,o;return s=function(e){function n(){return o=n.__super__.constructor.apply(this,arguments),o}return t(n,e),n.prototype.template=_.template(r),n.prototype.className="properties-dialog",n.prototype.events={"change input[type=number]":"onFormChange","submit .js-form":"doNothing"},n.prototype.ui={form:".js-form",errorCount:".js-error-count",errorCountPlural:".js-error-count-plural",errorCountContainer:".js-error-count-container"},n.prototype.initialize=function(){return this.listenTo(this.options.config,"change",this.onConfigChange),this.listenTo(this.options.propertySheetSchema,"change",this.onSchemaChange)},n.prototype.onConfigChange=function(e,t){if(!t.propertySheetChanging)return this.render()},n.prototype.onSchemaChange=function(){return this.render()},n.prototype.setErrorCount=function(e){return this.ui.errorCount.text(e),this.ui.errorCountPlural.toggle(e!==1),this.ui.errorCountContainer.toggle(e>0)},n.prototype.onRender=function(){var e;return this.form!=null&&this.stopListening(this.form),this.form=new i({data:this.options.config.toJSON(),schema:this.options.propertySheetSchema.sanitizedSchema()}),this.form.render(),e=this.form.validate(),this.setErrorCount(_.size(e)),this.listenTo(this.form,"change",this.onFormChange),this.ui.form.html(this.form.el)},n.prototype.doNothing=function(e){return e.preventDefault()},n.prototype.onFormChange=function(){return this.form.validate(),this.options.config.save(this.form.getValue(),{propertySheetChanging:!0})},n}(n.ItemView)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=[].slice;define("models/property_sheet_schema",["cdn.underscore","cdn.backbone"],function(e,r){var i,s;return i=function(r){function i(){return s=i.__super__.constructor.apply(this,arguments),s}return t(i,r),i.prototype.whiteListedAttributes={Text:[],Number:[],TextArea:[],Checkbox:[],Color:[],Select:["options"],Radio:["options"],Checkboxes:["options"],Date:["yearStart","yearEnd"],DateTime:["yearStart","yearEnd","minsInterval"],Range:["min","max","step"],Tags:["options","lowercase","duplicates","minLength","maxLength","updateAutoComplete"]},i.prototype.constantSchemaTop=function(){return{conceptTags:{type:"Tags",updateAutoComplete:!0}}},i.prototype.sanitizedSchema=function(){var e,t,n,r,i;r={},i=this.attributes;for(t in i)e=i[t],r[t]==null&&(n=this.sanitizedAttributes(e),n!=null&&(r[t]=n));return r},i.prototype.sanitizedAttributes=function(t){var r;return typeof t=="string"?this.sanitizedAttributes({type:t}):typeof t!="object"?null:(r=this.whiteListedAttributes[t.type],r==null?null:e.pick.apply(e,[t,"type","title","validators"].concat(n.call(r))))},i.prototype._defaultDefinitionForValue=function(t){switch(typeof t){case"boolean":return"Checkbox";case"number":return"Number";case"string":return/^\#[a-f0-9]{6}$/i.test(t)?"Color":t.length>20?"TextArea":"Text";case"object":return e.isArray(t)&&e.every(t,function(e){var t;return(t=typeof e)==="string"||t==="number"})?{type:"Tags",options:e.uniq(t),updateAutoComplete:!0}:null;default:return null}},i}(r.Model)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=[].slice;define("launchers/legacy/player_interface",["cdn.underscore","cdn.backbone","app/mediator"],function(e,r,i){var s;return s=function(){function s(t){var r;this.project=t.project,r=t.assetUrlTemplate,this._assetUrlTemplate=e.template(r),this._delegateEvents(),i.on("broadcast",function(){var e,t;t=arguments[0],e=2<=arguments.length?n.call(arguments,1):[];if(t!==this)return this.trigger.apply(this,["broadcast:receive"].concat(n.call(e)))},this)}return t(s.prototype,r.Events),s.prototype._whitelistedEvents=["asset:select","blocking:changed"],s.prototype._delegateEvents=function(){var t=this;return e.each(this._whitelistedEvents,function(r){return t.on(r,function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.partial(i.trigger,r).apply(i,t)})}),this.on("broadcast:send",function(){var e;return e=1<=arguments.length?n.call(arguments,0):[],i.trigger.apply(i,["broadcast",t].concat(n.call(e)))})},s.prototype.selectAsset=function(e){var t;return t=$.Deferred(),this.trigger("asset:select",{type:e,success:t.resolve}),t},s.prototype.assetPath=function(e){return this._assetUrlTemplate({id:e})},s.prototype.assetUrl=function(e){return this.project.path(e)},s}()})}.call(this),define("text!templates/gadget_child_picker.html",[],function(){return"<div class='gadget-child-picker-inner'>\n  <h2 class=\"gadget-child-picker-heading\">Select slide content</h2>\n\n  <ul class='gadget-child-picker-list'>\n    <% for(var gadgetType in gadgetTypes) { %>\n      <li class='gadget-child-picker-item js-choose-type' data-type='<%= gadgetType %>'>\n        <img class=\"gadget-child-picker-image\" src='<%= gadgetTypes[gadgetType].imageUrl %>'>\n        <label class='gadget-child-picker-title'><%= gadgetTypes[gadgetType].title %></label>\n        <label class='gadget-child-picker-author'><%= gadgetTypes[gadgetType].author %></label>\n      </li>\n    <% } %>\n  </ul>\n</div>\n"}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/gadget/child_picker",["cdn.marionette","text!templates/gadget_child_picker.html"],function(t,r){var i,s;return i=function(t){function i(){return this.templateHelpers=e(this.templateHelpers,this),s=i.__super__.constructor.apply(this,arguments),s}return n(i,t),i.prototype.template=_.template(r),i.prototype.className="gadget-child-picker",i.prototype.events={"click .js-choose-type":"_onTypeClick"},i.prototype._onTypeClick=function(e){var t;return t=$(e.target).closest("li").data("type"),this.trigger("gadget_picked_of_type",t),!1},i.prototype._imageUrl=function(e){return this.options.playerInterface.assetUrl("assets/"+e)},i.prototype.templateHelpers=function(){return{gadgetTypes:{"versal/image":{title:"Image",author:"Versal",imageUrl:this._imageUrl("image.png")},"versal/video":{title:"Video",author:"Versal",imageUrl:this._imageUrl("video.png")},"versal/markdown":{title:"Markdown",author:"Versal",imageUrl:this._imageUrl("markdown.png")}}}},i}(t.ItemView)})}.call(this),define("text!templates/gadget_child_container.html",[],function(){return"<div class='gadget-child-container-picker-region js-picker-region'></div>\n"}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/gadget/child_container",["cdn.marionette","views/gadget/child_picker","text!templates/gadget_child_container.html"],function(e,n,r){var i,s;return i=function(e){function i(){return s=i.__super__.constructor.apply(this,arguments),s}return t(i,e),i.prototype.template=_.template(r),i.prototype.className="gadget-child-container",i.prototype.regions={pickerRegion:".js-picker-region"},i.prototype.onRender=function(){return this.options.gadgetId!=null?this._renderGadget(this.options.gadgetId):this._renderChildPicker()},i.prototype._renderGadget=function(e){return this.pickerRegion.close(),this.options.children.useGadgetAndMoveToEl(e,this.$el)},i.prototype._renderChildPicker=function(){var e;return e=new n({playerInterface:this.options.playerInterface}),this.listenTo(e,"gadget_picked_of_type",this._gadgetPickedOfType),this.pickerRegion.show(e)},i.prototype._gadgetPickedOfType=function(e){var t=this;return this.options.children.build(e,function(e){return t._renderGadget(e),t.options.children.toggleEdit(!0),t.trigger("selected_gadget",e)})},i}(e.Layout)})}.call(this),function(){define("launchers/legacy/containers_interface",["cdn.underscore","views/gadget/child_container","app/mediator"],function(e,t,n){var r;return r=function(){function r(e){var t;this.gadgetConfig=e.gadgetConfig,this.lesson=e.lesson,this.playerInterface=e.playerInterface,this._children=(t=this.gadgetConfig.get("_children"))!=null?t:[]}return r.prototype.build=function(e,t,r){var i=this;return n.trigger("catalog:findByType",e,function(e){var n;return n=i.lesson.insertGadgetProjectAt(e,i.lesson.children.length),n.isChild=!0,n!=null?n.once("sync",function(){return i._children.push(n.id),i.gadgetConfig.save({_children:i._children}),t(n.id)}):void 0})},r.prototype.getGadgetChildContainerView=function(e){return e==null&&(e=null),new t({gadgetId:e,children:this,playerInterface:this.playerInterface})},r.prototype.useGadgetAndMoveToEl=function(t,n){var r,i;if(!e.contains(this._children,t))return;this._childrenInUse.push(t),r=this.lesson.collection.get(t);if(!r)return;return r.isChild=!0,this.gadgetConfig.gadget.on("destroy",function(){return r.destroy()}),i=this.lesson.children.findByModel(r),n.empty(),i.$el.detach().find(".gadgetContent").appendTo(n),i.setElement(n)},r.prototype.renderById=function(e,t){return this.useGadgetAndMoveToEl(e,t)},r.prototype.destroy=function(t){var n;if(!e.contains(this._children,t))return;return n=this.lesson.collection.get(t),n!=null&&n.destroy(),this._children=e.without(this._children,t),this._childrenInUse=e.without(this._childrenInUse,t)},r.prototype.toggleEdit=function(t){var n=this;return e.each(this._childrenInUse,function(e){var r;if(r=n.lesson.collection.get(e))return r.set({isEditing:t})})},r.prototype._childrenInUse=[],r}()})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=[].slice;define("launchers/legacy",["cdn.backbone","launchers/legacy/player_interface","launchers/legacy/containers_interface"],function(e,r,i){var s,o,u,a,f,l;return u=function(e){function n(){return f=n.__super__.constructor.apply(this,arguments),f}return t(n,e),n.prototype.save=function(){return this.set.apply(this,arguments)},n.prototype.fetch=function(){return $.Deferred().resolve(this)},n}(e.Model),a=function(){function e(e){this.project=e}return e.prototype.path=function(e){return this.project.path(e)},e}(),s=function(e){function n(){return l=n.__super__.constructor.apply(this,arguments),l}return t(n,e),n.prototype.url=function(){var e;if(((e=this._gadget)!=null?e.collection:void 0)==null)throw"No valid gadget url in GadgetUserStateAggregate";return this._gadget.url()+"/userstates"},n.prototype.initialize=function(e,t){return this._gadget=t.gadget},n}(e.Collection),o=function(){function o(t){var n,s,o,f=this;n=t.assetUrlTemplate,this.project=t.project,o=t.isEditable,this.gadgetModel=t.gadgetModel,s=t.currentLesson,this.$el=$("<div>"),this.playerInterface=new r({assetUrlTemplate:n,project:this.project}),this.playerInterface.isEditable=o,this.listenTo(this.playerInterface,"configEmpty",function(){return this.trigger("setEmpty")}),this.listenTo(this.playerInterface,"track",this._trackEvent),this.projectInterface=new a(this.project),this.containersInterface=new i({gadgetConfig:this.gadgetModel.config,lesson:s,playerInterface:this.playerInterface}),this._config=new u,this._userstate=new u,this._userstate.gadget=new e.Model({id:1337}),this._propertySheetSchema=new u,this.on({setEditable:function(e){return f._passEvent("toggleEdit",e.editable)},attributesChanged:function(e){return this._config.set(e,{source:"player"})},learnerStateChanged:function(e){return this._userstate.set(e,{source:"player"}),this._userstate.trigger("sync")},attached:this._launch,detached:_.partial(this._passEvent,"close")}),this._config.on("change",function(e,t){if(t.source!=="player")return f.trigger("setAttributes",e.toJSON())}),this._userstate.on("change",function(e,t){if(t.source!=="player")return f.trigger("setLearnerState",e.toJSON())}),this._propertySheetSchema.on("change",function(e,t){return f.trigger("setPropertySheetAttributes",e.toJSON())})}return t(o.prototype,e.Events),o.prototype._gadgetOptions=function(){return{player:this.playerInterface,facade:this.playerInterface,project:this.projectInterface,$el:this.$el,el:this.$el.get(0),config:this._config,userState:this._userstate,userStates:new s([],{gadget:this.gadgetModel}),model:this._config,propertySheetSchema:this._propertySheetSchema,children:this.containersInterface,containers:this.containersInterface}},o.prototype._passEvent=function(){var e,t,r,i;r=arguments[0],e=2<=arguments.length?n.call(arguments,1):[];try{return(i=this.playerInterface).trigger.apply(i,[r].concat(n.call(e)))}catch(s){return t=s,this.trigger("error",{message:"Error when passing event: "+t,stacktrace:t.stack})}},o.prototype._launch=function(){var e,t;try{return t=new this.project.klass(this._gadgetOptions()),this.playerInterface.trigger("domReady")}catch(n){return e=n,this.trigger("error",{message:"Error when loading: "+e,stacktrace:e.stack})}},o.prototype.getEl=function(){return this.$el},o.prototype._trackEvent=function(e,t){return this.trigger("track",_.extend({"@type":e},t))},o}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("launchers/iframe",["cdn.underscore","cdn.backbone","cdn.jquery"],function(t,r,i){var s,o;return o=["detached","setEditable","attributesChanged","learnerStateChanged","attached","setAsset","setPath","challengesChanged","scoresChanged"],s=function(){function s(n){var r,s,u,a;s=n.project,this._onMessageReceived=e(this._onMessageReceived,this),a=i.Deferred(),r=i("<iframe>").addClass("iframe-gadget").attr({src:s.path("index.html")}).on({load:function(){return a.resolve()}}),this._iframe=r.get(0),u=function(e,n,r){var i=this;r==null&&(r={});if(r.source==="launcher"||!t.contains(o,e))return;return a.done(function(){return i._iframe.contentWindow.postMessage({event:e,data:n},"*")})},this.on("all",u,this),this.on("attached",this._onAttached,this),this.on("detached",this._onDetached,this),this.on("setHeight",this._onHeightChange,this),this._ready=i.Deferred()}return n(s.prototype,r.Events),s.prototype.getEl=function(){return this._iframe},s.prototype._onAttached=function(){return window.addEventListener("message",this._onMessageReceived)},s.prototype._onDetached=function(){return window.removeEventListener("message",this._onMessageReceived)},s.prototype._onMessageReceived=function(e){var t;if(e.source===this._iframe.contentWindow)try{return this.trigger(e.data.event,e.data.data,{source:"launcher"})}catch(n){return t=n,this.trigger("error",{message:"Error when parsing event "+e.data.event+": "+t,stacktrace:t.stack},{source:"launcher"})}},s.prototype._onHeightChange=function(e){return i(this._iframe).height(e.pixels)},s}()})}.call(this),define("text!templates/gadget_instance.html",[],function(){return'<ul class="toolbar">\n  <li class="drag js-draggable">\n    <i class="icon-reorder"></i>\n  </li>\n    <li class="edit js-edit">\n      <i class="icon-cog"></i>\n    </li>\n  <li class="delete js-trash">\n    <i class="icon-trash"></i>\n  </li>\n  <span class="lock"></span>\n</ul>\n<div class="toolbar-right"></div>\n<div class="gadgetContent"></div>\n<div class="js-placeholder placeholder">Double-click to edit this gadget</div>\n<div class="property-dialog-container js-property-dialog"></div>\n<div class="lock-overlay"></div>\n'}),define("text!templates/gadget_instance_error.html",[],function(){return'<div class="alert alert-error">\n  Something went wrong and this gadget didn\'t load properly.<br>\n  We\'re on it. Please check back in a bit.\n  <!--\n    Technical details:\n    <%- errorDescription %>\n  -->\n  <div class="error-controls">\n    <button class="js-hide">close</button>\n    <button class="action delete-button js-delete">remove</button>\n  </div>\n</div>\n'}),define("text!templates/gadget_delete_warn.html",[],function(){return'<div class="alert alert-warn js-alert-warn">\n  <div class="alert-controls">\n    <div class="alert-msg">Are you sure you want to remove this gadget?</div>\n    <button class="undo-button js-undo-delete">no</button>\n    <button class="action delete-button js-delete">yes</button>\n  </div>\n</div>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/gadget/instance",["cdn.jquery","cdn.underscore","cdn.marionette","app/mediator","models/gadget_loader","plugins/vs.collab","plugins/tracker","plugins/challenges","views/gadget/lock","views/gadget/comments","views/property_sheet","models/property_sheet_schema","launchers/legacy","launchers/iframe","text!templates/gadget_instance.html","text!templates/gadget_instance_error.html","text!templates/gadget_delete_warn.html"],function(t,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){var b,w;return b=function(i){function b(){return this._onLauncherSetPropertySheetAttributes=e(this._onLauncherSetPropertySheetAttributes,this),this._onLauncherGetPath=e(this._onLauncherGetPath,this),this._onLauncherSetLearnerState=e(this._onLauncherSetLearnerState,this),this._onLauncherSetAttributes=e(this._onLauncherSetAttributes,this),this.onResolveSuccess=e(this.onResolveSuccess,this),this.onResolveError=e(this.onResolveError,this),this._scrollIntoViewIfNeeded=e(this._scrollIntoViewIfNeeded,this),this._gadgetDropped=e(this._gadgetDropped,this),this.stopEditing=e(this.stopEditing,this),this.stopCommenting=e(this.stopCommenting,this),this.startCommenting=e(this.startCommenting,this),w=b.__super__.constructor.apply(this,arguments),w}return n(b,i),b.prototype.reportActivityEveryMs=6e4,b.prototype.template=r.template(m),b.prototype.className="gadget",b.prototype.regions={propertySheetRegion:".js-property-dialog",lockRegion:".lock",commentsRegion:".toolbar-right"},b.prototype.events={"click .js-edit":"onEditClick","click .js-trash":"onTrashClick","click .js-hide":"onHideClick","click .js-delete":"onDeleteClick","click .js-undo-delete":"onUndoDelete","click .gadgetContent":"onContentClick","dblclick .gadgetContent":"onContentDblClick","dblclick .js-placeholder":"onContentDblClick","click .toolbar-right":"prevent","click .js-comments-toggle":"onCommentToggleClicked","click .js-cancel-comment":"stopCommenting","selectstart .js-placeholder":r.identity(!1)},b.prototype.modelEvents={destroy:"onModelDestroy",lock:"_onLockChange",unlock:"_onLockChange","change:isEditing":"_onIsEditingChanged"},b.prototype.ui={toolbar:".toolbar",gadgetContent:".gadgetContent",propertySheetContainer:".js-property-dialog",commentsBox:".js-comments-box"},b.prototype.initialize=function(e){var n,i,s,o,u=this;this.isEditable=e.isEditable,this.project=e.project,this.currentLesson=e.currentLesson,this.assetUrlTemplate=e.assetUrlTemplate,n=e.dropped,this._tracker=new a("gadget"),this._tracker.setMixin({gadgetId:this.model.id,gadgetType:(o=this.project)!=null?o.type():void 0}),this.gadgetRendering=t.Deferred(),this.once("gadgetRendered",function(){return u.gadgetRendering.resolve()}),n&&this.gadgetRendering.done(this._gadgetDropped),this.listenTo(this.model.config,"change",this._onGadgetConfigChange),this.listenTo(this.model.userState,"change",this._onGadgetUserStateChange),this.listenTo(this.model.userState,"sync",this._onGadgetUserStateSync),this._propertySheetSchema=new p;switch(this.project.get("launcher")){case"iframe":this._launcher=new v({project:this.project});break;default:this._launcher=new d({assetUrlTemplate:this.assetUrlTemplate,project:this.project,isEditable:this.isEditable,gadgetModel:this.model,currentLesson:this.currentLesson})}return i=["setAttributes","setLearnerState","requestAsset","getPath","setHeight","setPropertySheetAttributes","setEmpty","track","changeBlocking","error"],s=r.map(i,function(e){return u["_onLauncher"+e.slice(0,1).toUpperCase()+e.slice(1)]}),this.listenTo(this._launcher,r.object(i,s))},b.prototype.onClose=function(){return this._launcher.trigger("detached")},b.prototype._initializeCollab=function(){var e,t;if(!this.isEditable)return;return this.comments=new u.GadgetComments,this._lockView=new l({model:this.model}),this.lockRegion.show(this._lockView),(e=(t=u.activeLocks)!=null?t.findWhere({gadgetId:this.model.id}):void 0)&&this._lockView.updateLock(e),this._commentsView=new c({model:this.model,collection:this.comments}),this.commentsRegion.show(this._commentsView),this.startReportingActivity()},b.prototype.isCommenting=function(){return!!this.model.get("isCommenting")},b.prototype.onCommentToggleClicked=function(){return this.isCommenting()?this.stopCommenting():this.startCommenting()},b.prototype.startCommenting=function(){var e;if(!this._commentsView)return;return this.trigger("before:startCommenting"),this.model.set({isCommenting:!0}),(e=this._commentsView)!=null&&e.show(),t(window).one("click",this.stopCommenting),this.$el.on("click",this.prevent),this.trigger("after:startCommenting")},b.prototype.stopCommenting=function(){var e;return this.model.set({isCommenting:!1}),(e=this._commentsView)!=null&&e.hide(),t(window).off("click",this.stopCommenting),this.$el.off("click",this.prevent)},b.prototype.onContentClick=function(e){if(this.project.get("noToggleSwitch"))return this.startEditing(),e.stopPropagation()},b.prototype.onContentDblClick=function(e){return this.startEditing()},b.prototype.isEditing=function(){return!!this.model.get("isEditing")},b.prototype.onEditClick=function(e){return this._toggleEditing(),e.stopPropagation()},b.prototype._toggleEditing=function(){if(this.model.isChild||!this.isEditable)return;return this.isEditing()?this.stopEditing():this.startEditing()},b.prototype.startEditing=function(){if(this.model.isChild||!this.isEditable)return;if(this.isEditing())return;return this.trigger("before:startEditing"),this._configBeforeEditing=this.model.config.toJSON(),this.model.set({isEditing:!0}),s.trigger("gadget:editing:start",this.model),this.$el.on("click",this.prevent),t(window).one("click",this.stopEditing),this.trigger("after:startEditing")},b.prototype.stopEditing=function(){if(!this.isEditing())return;return r.isEqual(this.model.config.toJSON(),this._configBeforeEditing)||s.trigger("gadget:changed",this.model),this.model.set({isEditing:!1}),s.trigger("gadget:editing:stop",this.model),t(window).off("click",this.stopEditing),this.$el.off("click",this.prevent)},b.prototype._onIsEditingChanged=function(e,t){return this.$el.toggleClass("editing",t),this._launcher.trigger("setEditable",{editable:t}),this._togglePropertySheet(t)},b.prototype._togglePropertySheet=function(e){var t=this;if(!this._hasPropertySheet())return;return this._propertySheetView?this.propertySheetRegion.$el.toggleClass("visible",e):(this._propertySheetView=new h({model:this.model,config:this.model.config,propertySheetSchema:this._propertySheetSchema}),this._propertySheetView.once("show",function(){return t.propertySheetRegion.$el.toggleClass("visible",e)}),this.propertySheetRegion.show(this._propertySheetView))},b.prototype._hasPropertySheet=function(){var e;return this.model.isChild?!1:!r.isEmpty((e=this._propertySheetSchema)!=null?e.keys():void 0)},b.prototype.prevent=function(e){return e.stopPropagation()},b.prototype._onLockChange=function(){var e;if(!this.model.lock&&this._changedByCollaborator())return;return e=!!this.model.lock&&!this.model.lock.isLockedByMe(),this.$el.toggleClass("locked",e)},b.prototype._changedByCollaborator=function(){return u.gadgetHasUpdates(this.model.id)},b.prototype.isChild=function(){return!!this.model.isChild},b.prototype._gadgetDropped=function(){return this._scrollIntoViewIfNeeded(),this.startEditing()},b.prototype._scrollIntoViewIfNeeded=function(){var e;e=this.el.getBoundingClientRect();if(e.top<=0){this.el.scrollIntoView(!0);if(e.top<=0)return window.scrollBy(0,-37)}else if(e.bottom>t(window).height())return this.el.scrollIntoView(!1)},b.prototype.onModelDestroy=function(){return s.trigger("gadget:deleted",this.model)},b.prototype.onTrashClick=function(){return this.stopEditing(),this.showDeleteMsg()},b.prototype.onHideClick=function(){return this.$el.fadeOut(1200)},b.prototype.showDeleteMsg=function(){var e,n;if(this.deleteShowing)return;return this.deleteShowing=!0,e=this.$el.height(),n=t(y),e<100&&n.addClass("minimized"),this.$el.append(n)},b.prototype.onUndoDelete=function(){return this.deleteShowing=!1,this.$el.find(".js-alert-warn").remove()},b.prototype.onDeleteClick=function(){return this.model.destroy()},b.prototype.onRender=function(){var e;return this.project==null?this.showCouldNotLoad("Gadget Project is missing"):(this.ui.gadgetContent.addClass(this.project.cssClassName()),this.isEditable&&this.project.get("noToggleSwitch")&&this.$el.addClass("noToggleSwitch"),(e=o.resolve(this.project))!=null?e.done(this.onResolveSuccess).fail(this.onResolveError):void 0)},b.prototype.onResolveError=function(e){return this.showCouldNotLoad(e)},b.prototype.onResolveSuccess=function(){return this._launcher.trigger("attributesChanged",this.model.config.toJSON()),this._launcher.trigger("learnerStateChanged",this.model.userState.toJSON()),this.ui.gadgetContent.append(this._launcher.getEl()),this._launcher.trigger("attached"),this.trigger("gadgetRendered"),this._initializePlugins()},b.prototype._initializePlugins=function(){return this._initializeCollab(),this._challenges=new f(this.model,this._launcher)},b.prototype.startReportingActivity=function(){var e,t,n;return e="scroll mousedown DOMMouseScroll mousewheel keyup",t=function(){return s.trigger("gadget:activity")},n=r.debounce(t,this.reportActivityEveryMs,!0),this.listenTo(this.ui.gadgetContent,this.activityEvents,n),this.listenTo(s,"course:click",n)},b.prototype.showCouldNotLoad=function(e){return typeof console!="undefined"&&console!==null&&typeof console.error=="function"&&console.error(e),this.$el.html(r.template(g,{errorDescription:e})),this.trigger("gadgetRendered")},b.prototype.toggleEmpty=function(e){return e&&(this._emptyState=this.model.config.toJSON()),this.$el.toggleClass("empty",e)},b.prototype._onGadgetConfigChange=function(e){return this._emptyState&&!r.isEqual(e.toJSON(),this._emptyState)&&this.toggleEmpty(!1),this._launcher.trigger("attributesChanged",e.toJSON())},b.prototype._onGadgetUserStateChange=function(e){return this._launcher.trigger("learnerStateChanged",e.toJSON())},b.prototype._onGadgetUserStateSync=function(e,t,n){if(!(this._launcher instanceof d))return;this.trigger("userStateSync");if(t.results!=null)return this._launcher.trigger("learnerStateChanged",this.model.userState.toJSON())},b.prototype._onLauncherSetAttributes=function(e){return this.model.config.save(e)},b.prototype._onLauncherSetLearnerState=function(e){return this.model.userState.save(e)},b.prototype._onLauncherRequestAsset=function(e){var t=this;return s.trigger("asset:select",{type:e.type,success:function(n){return t.model.config.save(e.attribute,n)}})},b.prototype._onLauncherGetPath=function(e){return this._launcher.trigger("setPath",{messageId:e.messageId,url:r.template(this.assetUrlTemplate,{id:e.assetId})})},b.prototype._onLauncherSetPropertySheetAttributes=function(e){return this._propertySheetSchema.set(e)},b.prototype._onLauncherSetEmpty=function(){return this.toggleEmpty(!0)},b.prototype._onLauncherTrack=function(e){return this._tracker.track(e["@type"],r.omit(e,"@type"))},b.prototype._onLauncherChangeBlocking=function(){return s.trigger("blocking:changed")},b.prototype._onLauncherError=function(e){var t;return t=[e.message,e.stacktrace].join("\n"),this.showCouldNotLoad(t||"Something bad happened to this gadget...")},b}(i.Layout)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("plugins/vs-sticky",["cdn.underscore","cdn.jquery"],function(t,n){var r;return r=function(){function r(r,i){this.$container=r,this.selector=i!=null?i:".js-sticky-header",this._watchContainer=e(this._watchContainer,this),this._scroll=e(this._scroll,this),this.scanContainer(),this._throttledScroll=t.throttle(this._scroll,10),n(window).on("scroll",this._throttledScroll),this._watchInterval=setInterval(this._watchContainer,730)}return r.prototype.STUCK_Z_INDEX=98,r.prototype.destroy=function(){return this._changeCurrentSection(null),n(window).off("scroll",this._throttledScroll),clearInterval(this._watchInterval)},r.prototype.scanContainer=function(){var e,r,i,s,o,u,a;this._containerTop=this.$container.offset().top,this._containerHeight=this.$container.height(),this._changeCurrentSection(null),this._sections=[],r=this.$container.find(this.selector);for(i=o=0,u=r.length;0<=u?o<u:o>u;i=0<=u?++o:--o)e=n(r[i]),e.css({position:"relative"}),this._sections.push({top:e.offset().top,headerHeight:e.outerHeight(),$header:e}),i>0&&(s=this._sections[i-1],s.bottom=e.offset().top);return(a=t.last(this._sections))!=null&&(a.bottom=this.$container.height()),this._scroll()},r.prototype._inCurrentSection=function(e){return this._currentSection==null?!1:this._currentSection.top<=e&&e<this._currentSection.bottom},r.prototype._findSectionByCutoff=function(e){return t.find(this._sections,function(t){return t.top<=e&&e<t.bottom})},r.prototype._setHeaderOffset=function(e,t){var n;if(this._currentSection==null)return;return n=t+e.headerHeight-e.bottom,n>0?e.$header.css("top",this._containerTop-n):e.$header.css("top",this._containerTop)},r.prototype._scroll=function(){var e;return e=n(window).scrollTop()+this._containerTop,this._inCurrentSection(e)||this._changeCurrentSection(this._findSectionByCutoff(e)),this._setHeaderOffset(this._currentSection,e)},r.prototype._changeCurrentSection=function(e){return this._currentSection!=null&&this._unwrap(this._currentSection),e!=null&&this._wrap(e),this._currentSection=e},r.prototype._wrap=function(e){var t;return e.$header.css({left:e.$header.offset().left,top:this._containerTop}),t=n("<div/>").height(e.headerHeight),e.$header.wrap(t).css({"z-index":this.STUCK_Z_INDEX,position:"fixed",width:"100%"})},r.prototype._unwrap=function(e){return e.$header.removeAttr("style").unwrap()},r.prototype._watchContainer=function(){if(this._containerTop!==this.$container.offset().top||this._containerHeight!==this.$container.height())return this.scanContainer()},r}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("plugins/vs-edgescroll",["cdn.jquery","cdn.underscore"],function(t,n){var r;return r=function(){function i(i){var s,o,u;this.options=i,this._step=e(this._step,this),this._startScrolling=e(this._startScrolling,this),this._onMouseLeave=e(this._onMouseLeave,this),this._onMouseEnter=e(this._onMouseEnter,this),n.defaults(this.options,r),u={position:"fixed",left:0,width:"100%",opacity:0,display:"none","z-index":this.options.zIndex},o=t("<div>").css(n.extend({},u,{top:0,height:this.options.top})),s=t("<div>").css(n.extend({},u,{bottom:0,height:this.options.bottom})),this.$zones=t([o[0],s[0]]),this.options.container.append(this.$zones),o.on({mouseenter:n.partial(this._onMouseEnter,-1),mouseleave:this._onMouseLeave}),s.on({mouseenter:n.partial(this._onMouseEnter,1),mouseleave:this._onMouseLeave})}var r;return r={top:40,bottom:40,speed:30,threshold:400,duration:100,zIndex:6e3,container:t("body")},i.prototype._onMouseEnter=function(e){return this._direction=e,this._scrollingInterval&&this._teardown(),this._mouseover=!0,setTimeout(this._startScrolling,this.options.threshold)},i.prototype._onMouseLeave=function(){return this._mouseover=!1,this._teardown()},i.prototype._startScrolling=function(){if(!this._mouseover)return;return this._position=this.options.container.scrollTop(),this._scrollingInterval&&this._teardown(),this._scrollingInterval=setInterval(this._step,this.options.duration)},i.prototype._step=function(){return this._position+=this._direction*this.options.speed,this.options.container.animate({scrollTop:this._position},this.options.duration,"linear")},i.prototype._teardown=function(){return clearInterval(this._scrollingInterval),this._scrollingInterval=null},i.prototype.enable=function(){return this.$zones.show()},i.prototype.disable=function(){return this._teardown(),this.$zones.hide()},i.prototype.destroy=function(){return this._teardown(),this.$zones.remove()},i}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/lesson",["cdn.marionette","app/mediator","messages/player_tracker","plugins/vs.ui","text!templates/lesson.html","views/gadget/instance","plugins/vs-sticky","plugins/vs-edgescroll","cdn.jqueryui"],function(t,r,i,s,o,u,a,f){var l,c;return l=function(t){function i(){return this.fixSizing=e(this.fixSizing,this),this.onTitleEdited=e(this.onTitleEdited,this),this.stopEditingTitle=e(this.stopEditingTitle,this),this.onSortStop=e(this.onSortStop,this),this.onSortStart=e(this.onSortStart,this),this.onSortReceive=e(this.onSortReceive,this),this.itemViewOptions=e(this.itemViewOptions,this),c=i.__super__.constructor.apply(this,arguments),c}return n(i,t),i.prototype.template=_.template(o),i.prototype.ui={gadgets:".gadgets",lessonTitle:".js-title"},i.prototype.events={"click .js-title":"startEditingTitle"},i.prototype.className="lesson",i.prototype.itemViewContainer=".gadgets",i.prototype.itemView=u,i.prototype.itemViewOptions=function(e){var t;return{project:(t=this.palette)!=null?t.findByType(e.get("type")):void 0,isEditable:this.isEditable,assetUrlTemplate:this.assetUrlTemplate,currentLesson:this,dropped:e.dropped}},i.prototype.initialize=function(e){var t=this;return this.palette=e.palette,this.isEditable=e.isEditable,this.assetUrlTemplate=e.assetUrlTemplate,this.collection=this.model.gadgets,this.activeView=null,this.on("itemview:userStateSync",function(){return t.trigger("userStateSync")}),this.on("itemview:before:startEditing",this.onBeforeStartEditingGadget),this.on("itemview:before:startCommenting",this.onBeforeStartCommentingGadget),this.on("itemview:gadgetRendered",this._onGadgetRendered),this.listenTo(this.model.gadgets,"remove",this.onGadgetDeleted),this.listenTo(this.model.gadgets,"change:isEditing",this.onGadgetEditingChanged),this.listenTo(this.model,"change:title",this.onChangeTitle),this.listenTo(this,"composite:collection:rendered",this.onCollectionRender),r.on("tray:gadgetSelected",this.addGadgetToTheEnd,this),r.on("tray:gadget:dragStarted",this._onTrayDragStart,this),r.on("tray:gadget:dragStopped",this._onTrayDragEnd,this),this.fixSizingThrottled=_.throttle(this.fixSizing,200),$(window).on("resize",this.fixSizingThrottled)},i.prototype.onClose=function(){var e;return r.off("tray:gadgetSelected",this.addGadgetToTheEnd,this),r.off("tray:gadget:dragStarted",this._onTrayDragStart,this),r.off("tray:gadget:dragStopped",this._onTrayDragEnd,this),$(window).off("resize",this.fixSizingThrottled),(e=this.sticky)!=null?e.destroy():void 0},i.prototype.onGadgetEditingChanged=function(e,t){return this.$el.toggleClass("has-editing-gadget",t)},i.prototype.onBeforeStartEditingGadget=function(e){var t;return(t=this._currentlyEditingGadget)!=null&&t.stopEditing(),this._currentlyEditingGadget=e},i.prototype.onBeforeStartCommentingGadget=function(e){var t;return(t=this._currentlyCommentingGadget)!=null&&t.stopCommenting(),this._currentlyCommentingGadget=e},i.prototype.insertGadgetProjectAt=function(e,t){var n;return this.palette.add(e),(n=e.buildInstance({index:t}))?(n.dropped=!0,this.collection.create(n,{at:t}),this.fixSizing(),r.trigger("lesson:gadget:added",this),n):console.error("Failed grabbing gadget ",e)},i.prototype.makeSortable=function(){return this.ui.gadgets.sortable({handle:".js-draggable",containment:"parent",axis:"y",forceHelperSize:!0,tolerance:"pointer",receive:this.onSortReceive,start:this.onSortStart,stop:this.onSortStop,sort:this.onSort,scroll:!1})},i.prototype.onGadgetDeleted=function(e){return r.trigger("lesson:gadget:deleted",this,e)},i.prototype.onSortReceive=function(e,t){return this.insertGadgetProjectAt(t.item.data("project"),t.item.index())},i.prototype.onSortStart=function(e,t){return t.item.data("originalPosition",t.item.index()),t.item.find(".toolbar").addClass("dragging")},i.prototype.onSortStop=function(e,t){var n=this;return _.defer(function(){var e,i,s;return i=t.item.data("originalPosition"),e=t.item.index(),i!==e&&r.trigger("lesson:gadget:moved",n),s=n.collection.at(i),n.collection.move(s,e),t.item.find(".toolbar").removeClass("dragging"),n.stickHeaders()})},i.prototype.onSort=function(e,t){return t.helper.css({top:t.position.top+$(window).scrollTop()+"px"})},i.prototype.onRender=function(){var e;return this.makeSortable(),this.fixSizing(),this.children.length===0&&r.trigger("lesson:allGadgetsRendered",this.model),this.isEditable&&!this.editableTitle&&(this.editableTitle=new s.EditableText({el:this.ui.lessonTitle,success:this.onTitleEdited,complete:this.stopEditingTitle})),e=60,this.edge!=null?this.edge:this.edge=new f({top:e,bottom:$(".tray").outerHeight()+e})},i.prototype.onCollectionRender=function(){return this._currentlyCommentingGadget=null,this._currentlyEditingGadget=null},i.prototype.startEditingTitle=function(){var e;return(e=this.editableTitle)!=null?e.toggleEdit(!0):void 0},i.prototype.stopEditingTitle=function(){var e;return(e=this.editableTitle)!=null?e.toggleEdit(!1):void 0},i.prototype.onTitleEdited=function(e){return this.model.save({title:e})},i.prototype.fixSizing=function(){var e=this;return _.defer(function(){var t;return typeof (t=e.ui.gadgets).css=="function"?t.css({"min-height":e.availableHeight()}):void 0})},i.prototype.availableHeight=function(){return $(window).height()-90-$(".tray").outerHeight()},i.prototype.appendHtml=function(e,t,n){var r;return t.isChild()?(this._onGadgetRendered(t),!1):(r=this.ui.gadgets.children(),r.size()<=n?this.ui.gadgets.append(t.el):r.eq(n).before(t.el),this.fixSizing())},i.prototype._onGadgetRendered=function(e){var t;e.rendered=!0,t=this.children.every(function(e){return e.rendered});if(t)return this.stickHeaders(),r.trigger("lesson:allGadgetsRendered",this.model)},i.prototype.stickHeaders=function(){var e=this;return _.defer(function(){return e.sticky==null&&(e.sticky=new a(e.$el)),e.sticky.scanContainer()})},i.prototype.showHoverables=function(e){return e==null&&(e=!0),this.children.each(function(t){return t.showHoverables(e)})},i.prototype.showGadget=function(e){var t,n=this;return t=this.children.findByIndex(e-1),t.gadgetRendering.done(function(){return _.defer(function(){return window.scrollTo(0,t.$el.offset().top)})})},i.prototype.isComplete=function(){return this.model.gadgets.every(function(e){var t;return e.get("type")!=="6/quiz@1.0.04"||((t=e.userState.get("results"))!=null?t.pass:void 0)===!0})},i.prototype.onChangeTitle=function(e,t){return this.ui.lessonTitle.text(t),this.ui.lessonTitle.scrollLeft(0)},i.prototype.addGadgetToTheEnd=function(e){return this.insertGadgetProjectAt(e,this.children.length)},i.prototype._onTrayDragStart=function(){var e;return(e=this.edge)!=null?e.enable():void 0},i.prototype._onTrayDragEnd=function(){var e;return(e=this.edge)!=null?e.disable():void 0},i}(t.CompositeView)})}.call(this),define("text!templates/loading.html",[],function(){return'<div class="loading-overlay">\n  <div class="loading-content">\n    <i class="spin-holder"></i>\n    Loading...\n  </div>\n</div>\n\n'}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/loading",["cdn.marionette","plugins/vs.ui","text!templates/loading.html"],function(e,n,r){var i,s;return i=function(e){function i(){return s=i.__super__.constructor.apply(this,arguments),s}return t(i,e),i.prototype.className="loading-page",i.prototype.template=_.template(r),i.prototype.onRender=function(){return new n.LoadingIndicator(this.$(".spin-holder"))},i.prototype.hide=function(e){var t=this;return this.$(".loading-overlay").fadeOut(400,function(){return typeof e=="function"?e():void 0})},i}(e.ItemView)})}.call(this),define("text!templates/nav-buttons.html",[],function(){return"<%= buttonIf(previousAvailable(), 'js-prev previous-button', 'previous lesson', 'left') %>\n<%= buttonIf(nextAvailable(), 'js-next next-button', 'next lesson', 'right') %>\n<%= buttonIf(isComplete() && !nextAvailable(), 'js-finish finish-button', 'finish course', 'right') %>\n<div class=\"clearfix\"></div>\n"}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/nav_buttons",["cdn.marionette","text!templates/nav-buttons.html","app/mediator","plugins/vs.api"],function(t,r,i,s){var o,u;return o=function(t){function o(){return this.templateHelpers=e(this.templateHelpers,this),this.buttonIf=e(this.buttonIf,this),this.isComplete=e(this.isComplete,this),this.nextAvailable=e(this.nextAvailable,this),this.previousAvailable=e(this.previousAvailable,this),this._onCourseEnd=e(this._onCourseEnd,this),u=o.__super__.constructor.apply(this,arguments),u}return n(o,t),o.prototype.className="nav-buttons",o.prototype.initialize=function(){return i.on("lesson:rendered",this.updateButtons,this)},o.prototype.onClose=function(){return i.off("lesson:rendered",this.updateButtons)},o.prototype.events={"click .js-prev":"onPreviousClick","click .js-next":"onNextClick","click .js-finish":"onFinishClick"},o.prototype.ui={finishButton:".js-finish",nextButton:".js-next",prevButton:".js-prev"},o.prototype.template=_.template(r),o.prototype.updateButtons=function(e){var t;return this.lessonView=e,t=this.lessonView.model,this.prev=this.model.lessons.at(this.model.lessons.indexOf(t)-1),this.next=this.model.lessons.at(this.model.lessons.indexOf(t)+1),this.lessonView.on("userStateSync",this.render,this),this.next&&this.next.on("change",this.render,this),this._prevLessonView&&this._prevLessonView.off("userStateSync",this.render),this._prevNext&&this._prevNext.off("change",this.render),this._prevLessonView=this.lessonView,this._prevNext=this.next,this.render()},o.prototype.onPreviousClick=function(){var e;return this.ui.prevButton.addClass("disabled"),e=1+this.model.lessons.indexOf(this.prev),i.trigger("navigate:lesson",e)},o.prototype.onNextClick=function(){var e;return this.ui.nextButton.addClass("disabled"),e=1+this.model.lessons.indexOf(this.next),i.trigger("navigate:lesson",e)},o.prototype._fetchCurrentUser=function(){return(new s.User).fetch({self:!0})},o.prototype._onCourseEnd=function(e){return _.each(["courseEnd","player:course:completed"],function(t){return i.trigger("parent:notify",{event:t,user:_.pick(e,"email","id")})}),this.ui.finishButton.removeClass("disabled")},o.prototype.onFinishClick=function(){if(this.ui.finishButton.hasClass("disabled"))return;return this.ui.finishButton.addClass("disabled"),this.model.complete().then(this._fetchCurrentUser).then(this._onCourseEnd)},o.prototype.previousAvailable=function(){return this.prev!=null&&(this.prev.get("isAccessible")||this.model.get("isEditable"))},o.prototype.nextAvailable=function(){return this.next!=null&&(this.next.get("isAccessible")||this.model.get("isEditable"))},o.prototype.isComplete=function(){var e;return((e=this.lessonView)!=null?e.isComplete():void 0)&&!this.next},o.prototype.buttonIf=function(e,t,n,r){if(e)return"<a class='nav-button "+t+" pull-"+r+"'>\n  <i class='icon-caret-"+r+" pull-"+r+"'></i>\n  <span class='nav-button-text'>"+n+"</span>\n</a>"},o.prototype.templateHelpers=function(){return{previousAvailable:this.previousAvailable,nextAvailable:this.nextAvailable,isComplete:this.isComplete,buttonIf:this.buttonIf}},o}(t.CompositeView)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/course",["cdn.marionette","text!templates/course.html","views/lesson","views/loading","app/mediator","plugins/vs.collab","messages/player_tracker","views/nav_buttons"],function(t,r,i,s,o,u,a,f){var l,c;return l=function(t){function l(){return this._refetchSections=e(this._refetchSections,this),this.onCourseRefetchFail=e(this.onCourseRefetchFail,this),this.onCourseRefetchSuccess=e(this.onCourseRefetchSuccess,this),this.onClick=e(this.onClick,this),c=l.__super__.constructor.apply(this,arguments),c}return n(l,t),l.prototype.initialize=function(){return this.listenTo(this.model.lessons,"add",this.onLessonsAdd,this),this.listenTo(this.model.lessons,"select",this.onLessonSelected,this),o.on("tray:gadgetUpdated",this.rerenderLesson,this),o.on("tray:toggle",this.onTrayToggle,this),o.on("blocking:changed",this._onBlockingChanged,this)},l.prototype.ui={saveErrorMsg:".saveErrorMsg",collabErrorMsg:".collabErrorMsg",updateNotificationContainer:".updateNotificationContainer",updateNotificationMsg:".updateNotificationMsg",updateNotification:".updateNotification"},l.prototype.regions={lessonRegion:".js-lessons",loadingRegion:".js-loading",nav:".js-nav"},l.prototype.events={"click .updateNotificationContainer":"onUpdateNotificationClick"},l.prototype.template=_.template(r),l.prototype.className=function(){return this.model.get("isEditable")?"course editable":"course"},l.prototype.getLessonView=function(e){return this.children.findByModel(e)},l.prototype.activeLessonIndex=function(){return this.model.lessons.indexOf(this._activeLesson)},l.prototype.activateLesson=function(e){var t,n=this;return(t=this.model.lessons.findWhere({isActive:true}))!=null&&t.set({isActive:!1}),e.set({isActive:!0}),this.loadingLesson&&this.loadingLesson.abort(),this.renderingLesson=$.Deferred(),this.model.lessons.indexOf(e)===-1||e===this._activeLesson?(this.renderingLesson.resolve(),!1):(this.loadingLesson=e.fetch(),a.timeXHR(this.loadingLesson,"fetch-lesson",{lessonId:e.id}),this._activeLesson&&(this._loadingView=new s,this.loadingRegion.show(this._loadingView)),this.loadingLesson.done(function(){return n.displayLesson(e)}))},l.prototype.displayLesson=function(e){var t,n,r,s,u=this;return t=this._activeLesson,this._activeLesson=e,this._loadingView&&this._loadingView.hide(function(){return u.loadingRegion.close()}),n=this.activeLessonIndex()+1,this.model.progress.get("lessonIndex")!==n&&(r=this.renderingLesson)!=null&&r.done(function(){return u.model.progress.save({lessonIndex:n})}),(s=this._lessonView)!=null&&s.close(),this._lessonView=new i({model:this._activeLesson,palette:this.model.palette,isEditable:this.model.get("isEditable"),assetUrlTemplate:this.model.get("assetUrlTemplate")}),this.lessonRegion.show(this._lessonView),this.renderingLesson&&this.renderingLesson.resolve(),o.trigger("lesson:rendered",this._lessonView),t&&o.trigger("lesson:closed",t),o.trigger("lesson:opened",this._activeLesson),_.delay(function(){return window.scrollTo(0,0)},1e3)},l.prototype.addNewLesson=function(e){var t;return t=e||this.activeLessonIndex()+1,this.model.lessons.create({},{at:t}),this.displayLesson(this.model.lessons.at(t))},l.prototype.startEditing=function(e){if(!this.model.get("isEditable"))return;return e.toggleEdit(!0),e.$el.parent().addClass("editing"),this._lessonView.showHoverables(!1)},l.prototype.onLessonSelected=function(e){return this.activateLesson(e)},l.prototype.onRender=function(){return this._rendered=!0,this.activateLesson(this._activeLesson||this.model.lessons.first()),this.navView=new f({model:this.model}),this.nav.show(this.navView),o.on("course:save:error",this.showSaveErrorMsg,this),o.on("course:save:success",this.hideSaveErrorMsg,this),o.on("course:collab:ready",this.onEnableCollab,this),o.on("course:collab:close",this.onDisableCollab,this),o.on("collab:update",this.onCollabUpdate,this),$(window).on("click",this.onClick)},l.prototype.onClick=function(e){if(!this.isModalOpen())return o.trigger("course:click",e)},l.prototype.isModalOpen=function(){return!!$(".modal").length},l.prototype.showLesson=function(e){var t;if(t=this.model.lessons.at(e-1))return this.activateLesson(t)},l.prototype.showGadget=function(e,t){var n=this;return this.showLesson(e),this.renderingLesson.done(function(){return n._lessonView.showGadget(t)})},l.prototype.showSaveErrorMsg=function(){if(!this.saveErrorShowing&&!!this.model.get("isEditable"))return this.ui.saveErrorMsg.slideDown(50),this.saveErrorShowing=!0},l.prototype.hideSaveErrorMsg=function(){if(this.saveErrorShowing)return this.saveErrorShowing=!1,this.ui.saveErrorMsg.slideUp(50)},l.prototype.onEnableCollab=function(){return this.collabErrorShowing=!1,this.ui.collabErrorMsg.slideUp(50)},l.prototype.onDisableCollab=function(){if(!this.collabErrorShowing&&!!this.model.get("isEditable"))return this.ui.collabErrorMsg.slideDown(50),this.collabErrorShowing=!0},l.prototype.onCollabUpdate=function(){var e;return e=u.updateCount()===1?"See new update":"See "+u.updateCount()+" new updates",u.hasGadgetUpdates()&&(e+="; unlock updated gadgets"),this.ui.updateNotificationMsg.text(e),this.ui.updateNotificationContainer.slideDown(50)},l.prototype.onUpdateNotificationClick=function(e){var t=this;return u.resetUpdates(),this.ui.updateNotificationMsg.text("Fetching updates..."),this.model.palette.fetch().then(function(){return t._activeLesson.fetch()}).done(this.onCourseRefetchSuccess).fail(this.onCourseRefetchFail)},l.prototype.onCourseRefetchSuccess=function(){return u.hasUpdates()?this.onCollabUpdate():this.ui.updateNotificationContainer.slideUp(50)},l.prototype.onCourseRefetchFail=function(){return this.ui.updateNotificationMsg.text("Failed to update lesson, please try again!")},l.prototype.onTrayToggle=function(e){return this.$el.toggleClass("tray-expanded",e)},l.prototype._onBlockingChanged=function(){return setTimeout(this._refetchSections,100)},l.prototype._refetchSections=function(){var e,t=this;return e=this.model.fetch({data:{depth:"sections"},success:function(){return t._activeLesson.set({isActive:!0}),t.navView.updateButtons(t._lessonView)}}),a.timeXHR(e,"fetch-sections",{courseId:this.model.id})},l.prototype.rerenderLesson=function(){return this.displayLesson(this._activeLesson)},l}(t.Layout)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("plugins/marionette.filter",["cdn.marionette"],function(e){var n,r;return n=function(e){function n(){return r=n.__super__.constructor.apply(this,arguments),r}return t(n,e),n.prototype._match=function(e){var t,n,r;r=this.filters;for(t in r){n=r[t];if(n instanceof RegExp){if(!e.get(t).match(n))return!1}else if(e.get(t)!==n)return!1}return!0},n.prototype.addItemView=function(e){return this._match(e)?n.__super__.addItemView.apply(this,arguments):!1},n.prototype.removeItemView=function(e){return this._match(e)?n.__super__.removeItemView.apply(this,arguments):!1},n}(e.CompositeView)})}.call(this),define("text!templates/sidebar/lesson.html",[],function(){return'<div class="js-handle drag-handle">\n  <i class="icon-reorder"></i>\n</div>\n<div class="js-delete delete-button">\n  <i class="icon-remove"></i>\n</div>\n<div class="js-edit edit-button">\n  <i class="icon-pencil"></i>\n</div>\n<div class="lesson-title js-lesson-title" title="<%- title %>"><%- title %></div>\n<ul class="sections"></ul>\n\n<i class="icon-lock" title="This lesson is locked by one or more quizzes"></i>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/sidebar/lesson",["cdn.marionette","plugins/marionette.filter","text!templates/sidebar/lesson.html","plugins/vs.ui"],function(t,r,i,s){var o,u,a,f;return u=function(t){function r(){return this.content=e(this.content,this),this.template=e(this.template,this),a=r.__super__.constructor.apply(this,arguments),a}return n(r,t),r.prototype.template=function(){return this.content()},r.prototype.tagName="li",r.prototype.className="section",r.prototype.content=function(){return $.trim(this.model.config.get("content"))},r.prototype.initialize=function(){return this.listenTo(this.model.config,"change",this.render)},r.prototype.onRender=function(){return this.$el.toggle(this.content().length>0)},r}(t.ItemView),o=function(t){function r(){return this.onTitleChange=e(this.onTitleChange,this),this.toggleEdit=e(this.toggleEdit,this),f=r.__super__.constructor.apply(this,arguments),f}return n(r,t),r.prototype.template=_.template(i),r.prototype.itemView=u,r.prototype.itemViewContainer=".sections",r.prototype.initialize=function(e){return this.isEditable=e.isEditable,this.editing=!1,this.collection=this.model.gadgets,this.filters={type:/^versal\/header/},this.listenTo(this.model,"change",this.render),this.listenTo(this.collection,"sort",this.render)},r.prototype.className=function(){var e;return e="lesson",this.isDisabled()&&(e+=" disabled"),this.model.isNew()&&(e+=" pending"),this.model.get("isActive")&&(e+=" active"),e},r.prototype.events={click:"onClick","mousedown .js-delete":"onDeleteClick","click .js-edit":"onEditClick"},r.prototype.onClick=function(){if(this.isDisabled())return;return this.trigger("select",this.model)},r.prototype.attributes=function(){return{"data-cid":this.model.cid}},r.prototype.onDeleteClick=function(){if(this.isDisabled())return;if(confirm("Are you sure you want to delete this lesson?"))return this.model.destroy()},r.prototype.isDisabled=function(){return!this.model.get("isAccessible")&&!this.isEditable},r.prototype.onRender=function(){var e;return(e=this.editable)!=null&&e.destroy(),this.editable=new s.EditableText({type:"input",el:this.ui.lessonTitle,success:this.onTitleChange,complete:this.toggleEdit}),this.$el.attr("class",_.result(this,"className"))},r.prototype.ui={lessonTitle:".js-lesson-title"},r.prototype.onEditClick=function(e){return this.toggleEdit(),e.preventDefault(),e.stopPropagation()},r.prototype.toggleEdit=function(){return this.editing=!this.editing,this.$el.toggleClass("editing",this.editing),this.editable.toggleEdit(this.editing)},r.prototype.onTitleChange=function(e){return this.model.save({title:e})},r.prototype.appendHtml=function(e,t,n){var r;return r=this.getItemViewContainer(e),n>=r.children().length?r.append(t.el):r.children().eq(n).before(t.el)},r}(r)})}.call(this),define("text!templates/sidebar/sidebar.html",[],function(){return'<div class="course-title js-fixed-pane js-course-title">\n  <% if(isAuthor) { %>\n    <div class="options-dropdown js-options-dropdown">\n      <i class="icon-caret-down show-icon js-toggle-options"></i>\n      <i class="icon-caret-up hide-icon js-toggle-options"></i>\n      <ul class="options">\n        <li><b>view as learner</b></li>\n        <li><a target="_blank" href="<%- site %>/c/<%- id %>/learn">this revision</a></li>\n        <% if(isPublished) { %>\n          <li><a target="_blank" href="<%- site %>/c/<%- id %>/learn?revision=true">published course</a></li>\n        <% } %>\n      </ul>\n    </div>\n    <div class="js-edit-course-title edit-button">\n      <i class="icon-pencil"></i>\n    </div>\n  <% } %>\n  <div class="main-title js-title-content" title="Back to course overview"><%- title %></div>\n</div>\n\n<div class="scroll-container js-scroll-container">\n  <ul class="lessons"></ul>\n  <% if (isAuthor) { %>\n    <a href="#" class="js-add-lesson add-lesson link-style">Add a lesson</a>\n  <% } %>\n</div>\n\n<% if (isAuthor) { %>\n  <div class="fix-bottom js-fixed-pane">\n    <div class="last-saved">\n      last saved\n      <span class="js-last-saved">seconds</span>\n      ago\n    </div>\n    <div class="contributors-container js-contributors"></div>\n  </div>\n<% } %>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/sidebar/sidebar",["cdn.underscore","cdn.marionette","plugins/vs.ui","./lesson","text!templates/sidebar/sidebar.html","app/mediator","models/settings"],function(t,r,i,s,o,u,a){var f,l;return f=function(r){function f(){return this.fixSizing=e(this.fixSizing,this),this.templateHelpers=e(this.templateHelpers,this),l=f.__super__.constructor.apply(this,arguments),l}return n(f,r),f.prototype.className="sidebar",f.prototype.template=t.template(o),f.prototype.itemView=s,f.prototype.itemViewContainer=".lessons",f.prototype.itemViewOptions=function(){return{isEditable:this.model.get("isEditable")}},f.prototype.initialize=function(){return this.collection=this.model.lessons,this.on("itemview:select",this.selectLesson,this),this.fixSizingThrottled=t.throttle(this.fixSizing,200),$(window).on("resize",this.fixSizingThrottled),u.on("toc:toggle",this.onTocToggle,this)},f.prototype.onClose=function(){return u.off("toc:toggle",this.onTocToggle,this),$(window).off("resize",this.fixSizingThrottled)},f.prototype.templateHelpers=function(){return{isAuthor:!!this.author,id:this.model.id||1,site:a.get("site")}},f.prototype.events={"click .js-title-content":"onTitleClick"},f.prototype.ui={lessons:".lessons",fixedPanes:".js-fixed-pane",scrollContainer:".js-scroll-container",courseTitle:".js-course-title",titleContent:".js-title-content"},f.prototype.selectLesson=function(e){var t;return t=e.model,u.trigger("navigate:lesson",this.model.lessons.indexOf(t)+1)},f.prototype.onRender=function(){var e,n=this;return this.fixSizing(),(e=this._scroll)!=null&&e.destroy(),t.defer(function(){return n._scroll=new i.Scroll(n.ui.scrollContainer,{horizontal:!1})})},f.prototype.fixSizing=function(){var e=this;return t.defer(function(){var n,r,i,s,o;if(((o=e.ui.courseTitle)!=null?o.outerHeight:void 0)==null)return;return s=e.ui.courseTitle.outerHeight(),i=t.reduce(e.ui.fixedPanes,function(e,t){return e+$(t).outerHeight()},0),n=$(".titlebar"),r=n&&n.css("display")!=="none"?n.outerHeight():0,e.ui.scrollContainer.css({top:s,bottom:i-s+r})})},f.prototype.onTocToggle=function(){return this.$el.toggleClass("visible"),this.fixSizing()},f.prototype.onTitleClick=function(){if(this.editing)return;return u.trigger("parent:notify",{event:"publishCourse"})},f}(r.CompositeView)})}.call(this),define("text!templates/sidebar/contributor.html",[],function(){return'<a href="<%- site %>/u/<%- id %>" target="_blank">\n  <img src="<%- thumbnail %>" alt="<%- name() %>" class="contrib-icon" title="<%- name() %>">\n</a>\n'}),define("text!templates/sidebar/contributors.html",[],function(){return'<h4>Contributors</h4>\n<div class="js-toggle-collapse">\n  <i class="collapse icon-double-angle-down"></i>\n  <i class="expand icon-double-angle-up"></i>\n</div>\n<ul class="icons js-icons"></ul>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/sidebar/contributors",["cdn.marionette","app/mediator","plugins/vs.collab","text!templates/sidebar/contributor.html","text!templates/sidebar/contributors.html","models/settings"],function(t,r,i,s,o,u){var a,f,l,c;return a=function(t){function r(){return this.templateHelpers=e(this.templateHelpers,this),l=r.__super__.constructor.apply(this,arguments),l}return n(r,t),r.prototype.template=_.template(s),r.prototype.templateHelpers=function(){var e=this;return{thumbnail:this.getThumbnail(),name:function(){return e.model.get("firstname")||e.model.get("fn")||"Anonymous"},site:u.get("site")}},r.prototype.tagName="li",r.prototype.className="contributor",r.prototype.getThumbnail=function(){var e,t;return e=_.findWhere((t=this.model.get("image"))!=null?t.representations:void 0,{scale:"40x40"}),(e!=null?e.location:void 0)||"../assets/img/profile-retina.jpg"},r}(t.ItemView),f=function(e){function t(){return c=t.__super__.constructor.apply(this,arguments),c}return n(t,e),t.prototype.initialize=function(){return r.on("course:collab:open",this.render,this),r.on("course:collab:close",this.render,this),this.listenTo(this,"composite:collection:rendered",this.onCollectionRender)},t.prototype.onClose=function(){return r.off("course:collab:open",this.render,this),r.off("course:collab:close",this.render,this)},t.prototype.itemView=a,t.prototype.itemViewContainer=".js-icons",t.prototype.template=_.template(o),t.prototype.className="contributors",t.prototype.onCollectionRender=function(){return this.$el.toggle(!!i.enabled&&this.collection.length>0),this.trigger("sizeChanged")},t.prototype.events={"click .js-toggle-collapse":"onCollapseToggle"},t.prototype.onCollapseToggle=function(){return this.$el.toggleClass("collapsed"),this.trigger("sizeChanged")},t}(t.CompositeView)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/sidebar/author",["app/mediator","cdn.underscore","./sidebar","./contributors","plugins/time_since","plugins/vs.ui"],function(t,r,i,s,o,u){var a,f;return a=function(a){function l(){return this._onTitleChange=e(this._onTitleChange,this),this._onLessonMoved=e(this._onLessonMoved,this),this._toggleEdit=e(this._toggleEdit,this),this._moveLesson=e(this._moveLesson,this),this._onAjaxComplete=e(this._onAjaxComplete,this),f=l.__super__.constructor.apply(this,arguments),f}return n(l,a),l.prototype.author=!0,l.prototype.className="sidebar author-sidebar",l.prototype.initialize=function(){var e=this;return this.lastSavedTime=+(new Date),$(document).ajaxComplete(this._onAjaxComplete),setInterval(function(){return e.updateSavedLabel()},1e4),this.editing=!1,t.on("collab:activeUsers:update",this._onActiveUsersChange,this),t.on("course:click",this._onCourseClick,this),this.listenTo(this.model.lessons,"remove",this._onLessonsRemove,this),this._ensureLesson(),l.__super__.initialize.apply(this,arguments)},l.prototype.onClose=function(){return t.off("collab:activeUsers:update",this._onActiveUsersChange,this),t.off("course:click",this._onCourseClick,this)},l.prototype.ui=r.extend({},i.prototype.ui,{lastSavedTime:".js-last-saved",optionsDropdown:".js-options-dropdown",contributors:".js-contributors"}),l.prototype._onAjaxComplete=function(){return this.lastSavedTime=+(new Date),this.updateSavedLabel()},l.prototype.updateSavedLabel=function(){var e;return typeof (e=this.ui.lastSavedTime).html=="function"?e.html(o(this.lastSavedTime)):void 0},l.prototype.events=r.extend({},i.prototype.events,{"click .js-add-lesson":"_onAddLessonClick","click .js-toggle-options":"_onOptionToggleClick","click .js-edit-course-title":"_onEditClick","input .js-title-content":"_onTitleInput"}),l.prototype.onRender=function(){var e,t;return l.__super__.onRender.apply(this,arguments),this.ui.lessons.sortable({handle:".js-handle",axis:"y",containment:"parent",tolerance:"pointer"}),this.ui.lessons.on("sortupdate",this._moveLesson),this.editable=new u.EditableText({type:"input",el:this.ui.titleContent,success:this._onTitleChange,complete:this._toggleEdit,maxlength:60}),e=new Marionette.Region({el:this.ui.contributors}),this.contributors=new Backbone.Collection,t=new s({collection:this.contributors}),e.show(t),this.listenTo(t,"sizeChanged",this.fixSizing),this._optionsVisible=!1},l.prototype._moveLesson=function(e,t){var n;return n=this.model.lessons.get(t.item.data("cid")),this.model.lessons.move(n,t.item.index(),{success:this._onLessonMoved})},l.prototype._toggleEdit=function(){return this.editing=!this.editing,this.$el.toggleClass("editing",this.editing),this.editable.toggleEdit(this.editing)},l.prototype._ensureLesson=function(e){return this.model.lessons.length===0?this.model.lessons.create({},{success:e}):typeof e=="function"?e():void 0},l.prototype._onLessonMoved=function(){var e,n;return e=this.model.lessons.findWhere({isActive:!0}),n=this.model.lessons.indexOf(e)+1,t.trigger("navigate:lesson",n,{trigger:!1})},l.prototype._toggleOptions=function(){return this._optionsVisible=!this._optionsVisible,this.ui.optionsDropdown.toggleClass("expanded",this._optionsVisible)},l.prototype._onOptionToggleClick=function(){return this._toggleOptions()},l.prototype._onEditClick=function(){return this._toggleEdit()},l.prototype._onAddLessonClick=function(){var e=this;return this.model.lessons.create({},{success:function(){return t.trigger("navigate:lesson",e.model.lessons.length)}})},l.prototype._onTitleChange=function(e){return this.model.save({title:e})},l.prototype._onTitleInput=function(){return this.fixSizing()},l.prototype._onActiveUsersChange=function(e){return this.contributors.reset(e.models)},l.prototype._onCourseClick=function(e){if(this._optionsVisible&&!$(e.target).closest(".js-options-dropdown").length)return this._toggleOptions()},l.prototype._onLessonsRemove=function(e,n,r){var i=this;return t.trigger("lesson:deleted",e),this._ensureLesson(function(){var t;if(e.get("isActive"))return t=Math.min(r.index,n.length-1),i.model.lessons.trigger("select",i.model.lessons.at(t))})},l.prototype.serializeData=function(){return r.extend(this.model.toJSON(),{isPublished:this.model.isPublished()})},l}(i)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/sidebar/learner",["./sidebar"],function(e){var n,r;return n=function(e){function n(){return r=n.__super__.constructor.apply(this,arguments),r}return t(n,e),n.prototype.className="sidebar learner-sidebar",n}(e)})}.call(this),define("text!templates/tray/gadget.html",[],function(){return'<div class="js-version-controls version-controls">\n  <div class="js-upgrade-icon upgrade-icon">\n    <i class="arrow-icon icon-circle-arrow-up"></i>\n  </div>\n  <div class="js-revert-icon revert-icon">\n    <i class="arrow-icon icon-circle-arrow-down"></i>\n  </div>\n</div>\n<div class="js-gadget-icon icon"></div>\n<div class="js-gadget-title title"><%- title %></div>\n<div class="js-gadget-author author"><%- author %></div>\n<div class="js-gadget-version version"><%- version %></div>\n'}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/tray/item",["cdn.marionette","text!templates/tray/gadget.html","cdn.underscore","app/mediator"],function(e,n,r,i){var s,o;return s=function(e){function s(){return o=s.__super__.constructor.apply(this,arguments),o}return t(s,e),s.prototype.template=r.template(n),s.prototype.tagName="li",s.prototype.className="gadget",s.prototype.ui={icon:".js-gadget-icon",title:".js-gadget-title",upgradeIcon:".js-upgrade-icon",revertIcon:".js-revert-icon",versionControls:".js-version-controls"},s.prototype.events={dblclick:"onGadgetSelected"},s.prototype.triggers={"click .js-upgrade-icon":"upgrade","click .js-revert-icon":"revert"},s.prototype.checksum=function(e){var t;return t=r.reduce(e.split(""),function(e,t){return e+t.charCodeAt(0)},0),t%10},s.prototype.iconPath=function(){var e;return e=this.model.path("assets/icon.png"),e.replace(/^(https?:\/\/)((staging)?stack)/,"$1$2-"+this.checksum(e))},s.prototype.onRender=function(){this.ui.icon.css({"background-image":"url("+this.iconPath()+")"}),this.$el.data("project",this.model);if(this._isUpgradable())return this.showUpgradable();if(this.options.revertable())return this.showRevertable()},s.prototype._isUpgradable=function(){var e;return e=this.model.get("latestVersion"),e!=null&&this.model.get("version")!==e},s.prototype.attributes=function(){return{"data-type":r.result(this.model,"type")}},s.prototype.showUpgradable=function(){return this.ui.versionControls.removeClass("reverting").addClass("upgrading")},s.prototype.showRevertable=function(){return this.ui.versionControls.removeClass("upgrading").addClass("reverting")},s.prototype.onGadgetSelected=function(){return i.trigger("tray:gadgetSelected",this.model)},s}(e.ItemView)})}.call(this),define("text!templates/tray/tray.html",[],function(){return'<div class="tab js-toggle-size">\n  <i class="collapse icon-double-angle-down"></i>\n  <i class="expand icon-double-angle-up"></i>\n</div>\n<div class="prev-arrow js-scroll-prev">\n  <i class="icon-caret-left"></i>\n</div>\n<div class="next-arrow js-scroll-next">\n  <i class="icon-caret-right"></i>\n</div>\n\n<div class="tray-gadgets-scroller">\n  <ul class="trayGadgets"></ul>\n</div>\n\n<ul class="filters">\n  <% catalogs.forEach(function(cat){ %>\n    <li class="link-style filter js-choose-catalog js-catalog-label" data-catalog="<%- cat %>"><%- cat %></li>\n  <% }) %>\n</ul>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/modal",["cdn.marionette"],function(t){var r,i;return r=function(t){function r(){return this._onKeyDown=e(this._onKeyDown,this),i=r.__super__.constructor.apply(this,arguments),i}return n(r,t),r.prototype.onClose=function(){return $(document).off("keydown",this._onKeyDown),this.remove()},r.prototype._onBackdropClick=function(){return this.close()},r.prototype._onModalClick=function(e){return e.stopPropagation()},r.prototype._onCloseModalClick=function(){return this.close()},r.prototype._onKeyDown=function(e){if(e.keyCode===27)return this.close()},r.prototype.onRender=function(){return $(document).on("keydown",this._onKeyDown)},r.prototype._prevent=function(e){return e.stopPropagation(),e.preventDefault()},r.prototype.events={click:"_onModalClick","click .js-close":"_onCloseModalClick","click .modal-backdrop":"_onBackdropClick"},r}(t.ItemView)})}.call(this),define("text!templates/tray/version_modal.html",[],function(){return'<div class="gadget-version-modal modal">\n  <div class="js-instructions instructions">\n    <%- prompt %>\n  </div>\n  <div class="gadget-info">\n    <div class="icon" style="background-image: url(<%- icon %>)"></div>\n    <div class="title"><%- title %></div>\n    <div class="author"><%- author %></div>\n    <div class="version">\n      <%- fromVersion %> &#8594; <%- toVersion %>\n    </div>\n  </div>\n  <div class="js-error-text error-text">Gadget <%- operation %> failed, please check your connection and try again</div>\n  <div class="js-button-controls button-controls">\n    <button class="version-change-cancel js-close">maybe later</button>\n    <button class="version-change-ok js-ok action">\n      <span class="js-okay-text"><%- operation %></span>\n      <div class="js-spinner spinner"></div>\n    </button>\n  </div>\n  <div class="js-done-controls button-controls done-controls">\n    <button class="js-done js-close action">okay</button>\n  </div>\n</div>\n<div class="js-modal-backdrop modal-backdrop"></div>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/tray/version_modal",["views/modal","text!templates/tray/version_modal.html","app/mediator"],function(t,r,i){var s,o;return s=function(t){function s(){return this.templateHelpers=e(this.templateHelpers,this),this.onVersionChangeFailed=e(this.onVersionChangeFailed,this),this.onVersionChangeSuccess=e(this.onVersionChangeSuccess,this),o=s.__super__.constructor.apply(this,arguments),o}return n(s,t),s.prototype.template=_.template(r),s.prototype.events=_.extend({},s.prototype.events,{"click .js-ok":"onVersionChangeClick","click .js-modal-backdrop":"close"}),s.prototype.ui={confirmButton:".js-ok",okayText:".js-okay-text",spinner:".js-spinner",controls:".js-button-controls",doneControls:".js-done-controls",instructions:".js-instructions",errorText:".js-error-text"},s.prototype.initialize=function(){return this.upgrading=!this.options.toVersion,this.toVersion=this.options.toVersion||this.options.model.get("latestVersion"),this.fromVersion=this.options.model.get("version")},s.prototype.onVersionChangeClick=function(){return this.showLoading(),this.options.palette.changeVersion(this.options.model.type().split("@")[0],this.toVersion).done(this.onVersionChangeSuccess).fail(this.onVersionChangeFailed)},s.prototype.showLoading=function(){return this.indicator||(this.indicator=new vs.ui.LoadingIndicator(this.ui.spinner,"#fff")),this.ui.okayText.addClass("invisible"),this.ui.errorText.hide()},s.prototype.showDone=function(){var e;return this.ui.spinner.hide(),this.ui.okayText.removeClass("invisible"),this.ui.controls.hide(),e=this.upgrading?"updated":"reverted",this.ui.instructions.text("All instances of this gadget have been "+e),this.ui.doneControls.show()},s.prototype.onVersionChangeSuccess=function(){return this.showDone(),i.trigger("tray:gadgetUpdated",this.options.model)},s.prototype.onVersionChangeFailed=function(){return this.ui.okayText.text("try again").removeClass("invisible"),this.ui.errorText.show(),this.ui.spinner.hide()},s.prototype.serializeData=function(){return _.extend({icon:this.options.model.icon()},this.options.model.toJSON())},s.prototype.templateHelpers=function(){return{operation:this.upgrading?"upgrade":"revert",fromVersion:this.fromVersion,toVersion:this.toVersion,prompt:this.upgrading?"Upgrade each instance of this gadget in the current course":"Revert each instance of this gadget back to its previous version"}},s}(t)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/tray/tray",["cdn.marionette","./item","text!templates/tray/tray.html","app/mediator","./version_modal"],function(t,r,i,s,o){var u,a;return u=function(t){function u(){return this.onSortStop=e(this.onSortStop,this),this.onSortStart=e(this.onSortStart,this),this.templateHelpers=e(this.templateHelpers,this),this.activeCatalogs=e(this.activeCatalogs,this),this.itemViewOptions=e(this.itemViewOptions,this),a=u.__super__.constructor.apply(this,arguments),a}return n(u,t),u.prototype.template=_.template(i),u.prototype.className="tray",u.prototype.ui={gadgetList:".trayGadgets",gadgetScroller:".tray-gadgets-scroller",labels:".js-catalog-label"},u.prototype.events={"click .js-toggle-size":"onSizeToggle","click .js-scroll-next":"scrollNext","click .js-scroll-prev":"scrollPrev","click .js-choose-catalog":"onCatalogClick"},u.prototype.modelEvents={"change:collapsed":"onCollapsedChanged"},u.prototype.initialize=function(e){return this.catalogs=e.catalogs,this.model=e.model,this.gadgetsPerRow=9,this.palette=this.model.palette,this.storePaletteHistory(),this.palette.on("sync",this.render,this),this.collection=new Backbone.Collection,this.selectCatalog("all"),this.on("itemview:upgrade",this.onGadgetUpgradeRequest,this),this.on("itemview:revert",this.onGadgetRevertRequest,this),s.trigger("tray:toggle",!this.isCollapsed()),this.listenTo(s,"lesson:deleted gadget:deleted",this.onFragmentRemove),this.listenTo(s,"gadget:editing:start",this._onGadgetStartEditing),this.listenTo(s,"gadget:editing:stop",this._onGadgetStopEditing),this.listenTo(this,"composite:collection:rendered",this._onCollectionRendered),this.listenTo(this.catalogs.course,"add",this._updateLabels)},u.prototype.itemViewContainer=".trayGadgets",u.prototype.itemView=r,u.prototype.getModelType=function(e){return e.type().split("@")[0]},u.prototype.onBeforeItemAdded=function(e){var t;t=this.palette.findByType(this.getModelType(e.model));if(t)return e.model.set(t.toJSON(),{silent:!0})},u.prototype.itemViewOptions=function(e){var t=this;return{revertable:function(){var n;return n=t.paletteHistory[t.getModelType(e)],n?n!==e.get("latestVersion"):!1}}},u.prototype.storePaletteHistory=function(){var e,t,n=this;return e=this.palette.map(function(e){return n.getModelType(e)}),t=this.palette.pluck("version"),this.paletteHistory=_.object(e,t)},u.prototype.activeCatalogs=function(){return _.compact(_.map(this.catalogs,function(e,t){if(e!=null?e.length:void 0)return t}))},u.prototype.selectCatalog=function(e){if(e===this.activeCatalog)return;return this.activeCatalog=e,this.collection=this.catalogs[this.activeCatalog]},u.prototype.templateHelpers=function(){return{catalogs:_.keys(this.catalogs)}},u.prototype.onRender=function(){return this.scrollIndex==null&&(this.scrollIndex=0),this.$el.addClass("first-page last-page"),this.ui.gadgetList.sortable({items:".gadget",connectWith:".gadgets",delay:100,placeholder:"hidden gadget-drop-target",distance:3,helper:"clone",receive:function(){return!1},start:this.onSortStart,stop:this.onSortStop,over:!1,scroll:!1}),this.$("[data-catalog="+this.activeCatalog+"]").addClass("active")},u.prototype._onCollectionRendered=function(){var e=this;this._updateLabels(),this.icons=this.ui.gadgetList.children();if(this.icons.length>0)return _.defer(function(){var t;return t=e.icons.first().offset().left,e.icons.each(function(e){return $(this).data("leftPos",$(this).offset().left-t)}),e.scrollToChild(e.scrollIndex,!1)})},u.prototype._updateLabels=function(){var e=this;return this.ui.labels.each(function(t,n){return $(n).toggleClass("hidden",!_.contains(e.activeCatalogs(),$(n).data("catalog")))})},u.prototype.scrollToChild=function(e,t){var n,r;return t==null&&(t=!0),r=e-e%this.gadgetsPerRow,n=this.icons.eq(r).data("leftPos"),t?this.ui.gadgetScroller.animate({scrollLeft:n}):this.ui.gadgetScroller.scrollLeft(n),this.$el.toggleClass("first-page",r===0),this.$el.toggleClass("last-page",r+this.gadgetsPerRow>=this.icons.length)},u.prototype.scrollNext=function(){return this.scrollIndex=Math.min(this.icons.length-1,this.scrollIndex+this.gadgetsPerRow),this.scrollToChild(this.scrollIndex)},u.prototype.scrollPrev=function(){return this.scrollIndex=Math.max(0,this.scrollIndex-this.gadgetsPerRow),this.scrollToChild(this.scrollIndex)},u.prototype.appendHtml=function(e,t){var n,r;n=_.compact((r=this.model)!=null?r.authors.map(function(e){return e.get("username")}):void 0);if(t.model.get("hidden")&&!_.contains(n,t.model.get("username")))return;return u.__super__.appendHtml.apply(this,arguments)},u.prototype.isCollapsed=function(){return!!this.model.get("collapsed")},u.prototype.onSizeToggle=function(){if(this._gadgetEditing)return;return this.model.set("collapsed",!this.isCollapsed())},u.prototype.onCollapsedChanged=function(e,t){return this._toggleCollapsed(t)},u.prototype._toggleCollapsed=function(e){return this.$el.toggleClass("collapsed",e),setTimeout(function(){return $(window).trigger("resize"),s.trigger("tray:toggle",!e)},200)},u.prototype.onCatalogClick=function(e){return this.scrollIndex=0,this.selectCatalog($(e.target).data("catalog")),this.render()},u.prototype.onSortStart=function(e,t){return s.trigger("tray:gadget:dragStarted"),t.item.addClass("dragging"),t.item.removeClass("expanded").show(),t.helper.removeClass("expanded").show(),t.helper.css({width:1,height:"auto"}).hide().fadeIn(200,function(){return t.helper.addClass("fullWidth")})},u.prototype.onSortStop=function(e,t){return s.trigger("tray:gadget:dragStopped"),t.item.removeClass("dragging"),t.item.removeAttr("style"),!1},u.prototype.showVersionModal=function(e,t){var n;return n=new o({model:e,palette:this.palette,toVersion:t}),n.render(),$("body").append(n.$el)},u.prototype.onGadgetUpgradeRequest=function(e){return this.showVersionModal(this.palette.findByType(this.getModelType(e.model)))},u.prototype.onGadgetRevertRequest=function(e){var t;return t=this.paletteHistory[this.getModelType(e.model)],this.showVersionModal(e.model,t)},u.prototype._onGadgetStartEditing=function(){this._gadgetEditing=!0;if(!this.isCollapsed())return this._toggleCollapsed(!0)},u.prototype._onGadgetStopEditing=function(){this._gadgetEditing=!1;if(!this.isCollapsed())return this._toggleCollapsed(!1)},u.prototype.onFragmentRemove=function(e){return this._pendingRemove&&this.stopListening(this._pendingRemove,"sync"),this._pendingRemove=e,this.listenToOnce(e,"sync",this.onRemoveComplete)},u.prototype.onRemoveComplete=function(){return this.palette.fetch()},u}(t.CompositeView)})}.call(this),define("text!templates/titlebar.html",[],function(){return'<div class="title"><%- title %></div>\n<div class="author">by <%- authors() %></div>\n<div class="toc-icon js-toggle-toc">\n  <i class="icon-reorder"></i>\n</div>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/titlebar",["cdn.marionette","text!templates/titlebar.html","app/mediator"],function(t,r,i){var s,o;return s=function(t){function s(){return this.templateHelpers=e(this.templateHelpers,this),o=s.__super__.constructor.apply(this,arguments),o}return n(s,t),s.prototype.template=_.template(r),s.prototype.className="titlebar",s.prototype.events={"click .js-toggle-toc":"onToggleClick"},s.prototype.onToggleClick=function(){return i.trigger("toc:toggle")},s.prototype.onRender=function(){if(this.model.get("isEditable"))return this.$el.addClass("learner")},s.prototype.templateHelpers=function(){var e=this;return{authors:function(){return e.model.authors.pluck("fn").join(", ")}}},s}(t.ItemView)})}.call(this),function(){define("plugins/backbone.prioritize",["cdn.backbone"],function(e){return e.Collection.prototype.prioritize=function(e){var t,n,r,i,s,o;s=e.reverse(),o=[];for(r=0,i=s.length;r<i;r++)n=s[r],this.remove(t=this.findWhere(n)),t?o.push(this.unshift(t)):o.push(void 0);return o}})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("app/combined_catalogue",["app/mediator","plugins/vs.api","plugins/backbone.prioritize"],function(e,n){var r,i;return r=function(r){function s(){return i=s.__super__.constructor.apply(this,arguments),i}return t(s,r),s.prototype.initialize=function(){var t=this;return e.on("catalog:findByType",function(e,n){var r;r=t.findByType(e);if(r==null)throw new Error("Unknown gadget project of type: "+e);return n(r)})},s.prototype.fetchAll=function(e){var t=this;return e==null&&(e={}),this.approved=new n.GadgetProjects,this.sandbox=new n.GadgetProjects,$.when(this.approved.fetchApproved(),this.sandbox.fetchSandbox()).then(function(){var e;return t.approved.prioritize([{title:"Header"},{title:"Text"},{title:"Image"},{title:"Video"},{title:"Wolfram"},{title:"Quiz"},{title:"Survey"},{title:"Expression"},{title:"Data viewer"},{title:"References"},{title:"Map"},{title:"Markdown"},{title:"Image annotator"},{title:"Image detail"},{title:"Color bar"},{title:"R0"},{title:"3D anatomy"},{title:"Cellular automaton"},{title:"Principle of superposition"}]),e=function(e,n){return t.add(n.models.map(function(t){return t.get("catalog")||t.set({catalog:e}),t}))},e("approved",t.approved),e("sandbox",t.sandbox),t.trigger("reset"),t.trigger("sync")})},s}(n.GadgetProjects)})}.call(this),define("text!templates/player.html",[],function(){return'<div class="player">\n  <div class="titlebarContainer"></div>\n  <div class="sidebarContainer"></div>\n  <div class="dialogs"></div>\n  <div class="js-course-container"></div>\n  <div class="loadingCourse"></div>\n  <div class="trayContainer"></div>\n</div>\n'}),define("text!templates/asset_picker/asset_picker.html",[],function(){return'<div class="assets-modal modal">\n  <div class="header">\n    <div class="modal-title">file picker</div>\n    <div class="modal-controls">\n      <button class="cancel js-close">cancel</button>\n      <button class="action js-use-file js-upload">use file</button>\n    </div>\n    <div class="clearfix"></div>\n  </div>\n  <div class="content">\n    <div class="preview-region">\n      <div class="uploading-overlay">\n        <div class="uploading-spinner"></div>\n      </div>\n\n      <div class="choose-overlay">\n        <div class="drop-image"></div>\n        <div class="drop-blurb">\n          drag file here\n          <span class="click-blurb">or click to upload</span>\n        </div>\n        <div class="dropzone"></div>\n      </div>\n\n      <input class="hidden-uploader" type="file">\n      <div class="file-preview"></div>\n\n    </div>\n    <div class="status-message"></div>\n    <% if (getType() == "video") { %>\n      <input class="video-link" placeholder="or paste YouTube or Vimeo link" />\n    <% } %>\n  </div>\n</div>\n<div class="modal-backdrop"></div>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define("views/asset_picker/asset_picker",["app/mediator","plugins/vs.api","plugins/vs.ui","messages/player_tracker","cdn.marionette","text!templates/asset_picker/asset_picker.html","views/modal"],function(t,r,i,s,o,u,a){var f,l;return f=function(t){function o(){return this.onUploadError=e(this.onUploadError,this),this.onAssetRefetchError=e(this.onAssetRefetchError,this),this.onAssetRefetch=e(this.onAssetRefetch,this),this.onUploadSuccess=e(this.onUploadSuccess,this),this.onDrop=e(this.onDrop,this),this.templateHelpers=e(this.templateHelpers,this),l=o.__super__.constructor.apply(this,arguments),l}return n(o,t),o.prototype.template=_.template(u),o.prototype.templateHelpers=function(){var e=this;return{getType:function(){return e.type}}},o.prototype.initialize=function(e){this.options=e,$(window).on("dragenter dragexit dragover dragleave drop",this._prevent),this.type=this.options.type;if(!this.type)throw new Error("Asset type is required");return this.formats=this.type==="image"?["jpg","jpeg","png"]:this.type==="video"?["mp4","ogg","webm","avi","mov"]:void 0},o.prototype.ui={preview:".preview-region",filePreview:".file-preview",uploading:".uploading-overlay",choose:".choose-overlay",status:".status-message",useButton:".js-use-file",spinner:".uploading-spinner",hiddenUploader:".hidden-uploader",videoInput:".video-link"},o.prototype.events=_.extend({},o.prototype.events,{"click .choose-overlay":"onChooseClick","dragenter .dropzone":"onOverlayDragEnter","dragleave .dropzone":"onOverlayDragLeave","dragenter .preview-region":"onRegionDragEnter","dragexit .dropzone":"_prevent","dragover .dropzone":"_prevent","drop .dropzone":"onDrop","click .js-use-file":"onUseClick","input .video-link":"onVideoInputChange","paste .video-link":"onVideoInputChange"}),o.prototype.onOverlayDragEnter=function(e){return this.ui.choose.addClass("dragenter"),e.preventDefault()},o.prototype.onOverlayDragLeave=function(e){return this.ui.choose.removeClass("dragenter fromRegion"),this.hasFile&&this.ui.choose.hide(),e.preventDefault()},o.prototype.onRegionDragEnter=function(e){if(!this.hasFile)return;return this.ui.choose.addClass("dragenter fromRegion"),this.ui.choose.show(),e.preventDefault()},o.prototype.onDrop=function(e){var t,n;t=e.originalEvent,t.stopPropagation(),t.preventDefault();if(t.dataTransfer.files.length)return this.onChooseComplete((n=t.dataTransfer.files)!=null?n[0]:void 0)},o.prototype.showStatus=function(e,t){return t==null&&(t=!1),this.ui.status.toggleClass("error",t),this.ui.status.text(e)},o.prototype.showPreviewError=function(e){return this.ui.filePreview.text(e)},o.prototype.showUploading=function(){return this.ui.choose.hide(),this.ui.uploading.show(),this.indicator||(this.indicator=new i.LoadingIndicator(this.ui.spinner,"#fff")),this.showStatus("uploading...")},o.prototype.showChoose=function(){return this.ui.uploading.hide(),this.ui.choose.show(),this.showStatus("Accepted file types: "+this.formats.join(", ")),this.hasFile=!1},o.prototype.showFilePreview=function(e){var t,n=this;return t=e.size/1048576,t>5?this.showPreviewError("File too large to preview"):typeof FileReader!="undefined"&&FileReader!==null?(this.fr=new FileReader,this.fr.onload=function(t){return n.onPreviewLoaded.call(n,t,e)},this.fr.readAsDataURL(e)):this.showPreviewError("No preview available")},o.prototype.onPreviewLoaded=function(e,t){var n;if(t.type.split("/")[0]!==this.type)return this.showPreviewError("No preview available");if(this.type==="image")return this.ui.filePreview.html($("<img>").attr("src",e.target.result));if(this.type==="video")return n=$("<video>")[0],!n.canPlayType||!n.canPlayType(t.type).replace(/no/,"")?this.showPreviewError("No preview available"):this.ui.filePreview.html("<video preload='metadata' controls='controls'>\n  <source src='"+e.target.result+"'>\n</video>")},o.prototype.onUploadSuccess=function(e){var t;return this.ui.uploading.hide(),this.assetJSON=_.extend(e.toJSON(),{representations:e.representations.toJSON()}),this.showStatus("processing..."),typeof (t=this.options).processing=="function"&&t.processing(),this.checkProcessingStatus(e)},o.prototype.checkProcessingStatus=function(e){return e.fetch({success:this.onAssetRefetch,error:this.onAssetRefetchError})},o.prototype.onAssetRefetch=function(e){return e.representations.findWhere({available:!1})?_.delay(this.checkProcessingStatus.bind(this),3e3,e):this.onProcessingComplete()},o.prototype.onAssetRefetchError=function(e){return this.showStatus("Server error",!0)},o.prototype.onProcessingComplete=function(e){return this.ui.useButton.prop("disabled",!1),this.showStatus("Processing complete")},o.prototype.onUploadError=function(){return this.ui.uploading.hide(),this.showStatus("Error uploading",!0)},o.prototype.onChooseClick=function(){var e=this;return this.ui.hiddenUploader.one("change",function(){var t;return e.onChooseComplete((t=e.ui.hiddenUploader[0].files)!=null?t[0]:void 0)}),this.ui.hiddenUploader.click()},o.prototype.onChooseComplete=function(e){var t,n,i,o,u;return e?(o=_.last(e.name.split(".")),_.contains(this.formats,o.toLowerCase())?(i=e.type||""+this.type+"/x-"+o,n={title:"New File",tags:[this.type],content:e,contentType:i},t=new r.Asset,u=t.save(n,{upload:!0,success:this.onUploadSuccess,error:this.onUploadError}),s.timeXHR(u,"upload-asset",{contentType:i,name:e.name}),this.showUploading(),this.ui.videoInput.css({visibility:"hidden"}),this.showFilePreview(e),this.hasFile=!0):this.showStatus("Unsupported file type chosen. Acceptable formats:          "+this.formats.join(", "),!0)):this.showStatus("No file chosen",!0)},o.prototype.onUseClick=function(){return this.options.success(this.assetJSON),this.close(),s.track("use-asset",{assetJSON:this.assetJSON})},o.prototype.close=function(){return $(window).off("dragenter dragexit dragover dragleave drop",this._prevent),o.__super__.close.apply(this,arguments)},o.prototype.onVideoInputChange=function(){var e,t,n;e=this.ui.videoInput.val();if(this.oldInput===e)return;this.oldInput=e;if(e.length===0){this.render(),this.ui.videoInput.focus();return}n=this.getYoutubeId(e),t=this.getVimeoId(e);if(n||t)this.ui.choose.hide(),this.ui.useButton.prop("disabled",!1),this.showStatus("");return n?(this.assetJSON={type:"youtube",youtube_id:n},this.ui.filePreview.html(this.getYoutubeEmbed(n))):t?(this.assetJSON={type:"vimeo",vimeo_id:t},this.ui.filePreview.html(this.getVimeoEmbed(t))):(this.showStatus("That is not a valid YouTube or Vimeo video url",!0),this.ui.useButton.prop("disabled",!0))},o.prototype.getYoutubeId=function(e){var t,n;return t=/(?:(?:https?:\/\/)?(?:[a-zA_Z]{2,3}.)?)?(?:(?:youtube\.com\/watch\?)(?:[a-z=_&]+|(?:[\w\d\-\_\=]+&amp;(?:amp;)?))*v(?:&lt;[A-Z]+&gt;)?=|youtu.be\/)([0-9a-zA-Z\-\_]+)/,(n=e.match(t))!=null?n[1]:void 0},o.prototype.getVimeoId=function(e){var t,n;return t=/(?:(?:https?:\/\/)?(?:[a-zA_Z]{2,3}.)?)?(?:vimeo\.com\/)([0-9]+)/,(n=e.match(t))!=null?n[1]:void 0},o.prototype.onRender=function(){return o.__super__.onRender.apply(this,arguments),this.ui.useButton.prop("disabled",!0),this.showChoose()},o.prototype.getEmbedCode=function(e){var t;if(e==="asset")return t=_.filter(this.get("representations"),function(e){return e.contentType.indexOf("video/")===0}),t=_.sortBy(t,function(e){return e.contentType==="video/webm"?0:1}),_.template('<video class="myVideo" preload="none" controls="controls">\n  <% _.each(videos, function(vid) { %>\n    <source src="<%= vid.location %>" type="<%= vid.contentType %>">\n  <% }) %>\n</video>',{videos:t})},o.prototype.getYoutubeEmbed=function(e){return'<iframe id="ytplayer" type="text/html" width="100%" height="100%" src="//www.youtube.com/embed/'+e+'" frameborder="0"/>'},o.prototype.getVimeoEmbed=function(e){return'<iframe src="//player.vimeo.com/video/'+e+'" width="100%" height="100%" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'},o}(a)})}.call(this),function(){define("messages/handlers/asset_select",["cdn.jquery","views/asset_picker/asset_picker"],function(e,t){return function(n,r){var i,s;return i=this,s=new t(_.pick(n,"success","type","processing")),e("body").append(s.render().$el)}})}.call(this),function(){define("messages/handlers/parent_notify",[],function(){return function(e){return window.parent.postMessage(JSON.stringify(e),"*")}})}.call(this),function(){define("messages/decorate",["app/mediator","messages/handlers/asset_select","messages/handlers/parent_notify"],function(e,t,n){var r;return r={"asset:select":t,"parent:notify":n},_.each(r,function(t,n){return e.on(n,t,e)})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=function(e,t){return function(){return e.apply(t,arguments)}};define("player",["cdn.underscore","cdn.jquery","cdn.marionette","plugins/vs.api","plugins/vs.collab","views/course","views/sidebar/author","views/sidebar/learner","views/tray/tray","views/titlebar","app/combined_catalogue","text!templates/player.html","views/loading","app/mediator","messages/player_tracker","models/settings","messages/decorate","libs/modernizr","plugins/vs.ui"],function(e,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y,b,w,E,S;return b=function(e){function n(){return E=n.__super__.constructor.apply(this,arguments),E}return t(n,e),n.prototype.template=p,n.prototype.regions={titlebar:".titlebarContainer",sidebar:".sidebarContainer",dialogs:".dialogs",courseContainer:".js-course-container",loading:".loadingCourse",tray:".trayContainer"},n}(i.Layout),w=function(e){function n(){return S=n.__super__.constructor.apply(this,arguments),S}return t(n,e),n.prototype.routes={"courses/:courseId":"showCourse","courses/:courseId/lessons/:lessonIndex":"showLesson","courses/:courseId/lessons/:lessonIndex/gadgets/:gadgetIndex":"showGadget"},n}(Backbone.Router),y=function(){function t(t){this._onNavigateGadget=n(this._onNavigateGadget,this),this._onNavigateLesson=n(this._onNavigateLesson,this),this.onProgressLoad=n(this.onProgressLoad,this),this.onCourseLoad=n(this.onCourseLoad,this);var i,s,o,u=this;t&&g.set(t),this.initializeApi(),this._courseRendering=r.Deferred(),this._courseRendering.done(function(){return v.trigger("course:rendered",u.courseView)}),s=g.get("courseId"),m.setMixin({sessionId:g.get("api").sessionId,interactionId:e.random(1e15,1e16).toString(32)}),(t!=null?!t.noHistory:!void 0)&&this.installHistory(s),this.installNavigation(s);if(i=g.get("container"))o=r(i).get(0),g.get("embed")&&r(i).addClass("embed-frame");this.layout=new b({el:o}),this.layout.render(),this.loadingView=new d,this.layout.loading.show(this.loadingView),v.on("lesson:allGadgetsRendered",this._onAllGadgetsRendered,this),this.combinedCatalogue=new h,this.combinedCatalogue.fetchAll(),s&&this.loadCourse(s)}return t.prototype.installNavigation=function(e){return this.uninstallNavigation(),v.on("navigate:lesson",this._onNavigateLesson),v.on("navigate:gadget",this._onNavigateGadget)},t.prototype.uninstallNavigation=function(){this._onNavigateLesson&&v.off("navigate:lesson",this._onNavigateLesson);if(this._onNavigateGadget)return v.off("navigate:gadget",this._onNavigateGadget)},t.prototype.installHistory=function(e){return this.router=new w,this.router.on("route:showLesson",this.showLesson,this),this.router.on("route:showGadget",this.showGadget,this),e&&(this.router.courseId=e),Backbone.history.start({root:window.location.pathname})},t.prototype.close=function(){return this.uninstallNavigation(),this.router&&Backbone.history.stop(),v.off("lesson:allGadgetsRendered",this._onAllGadgetsRendered,this)},t.prototype.initializeApi=function(){var e=this;return s.init(g.get("api")),s.on("xhr:error",function(e,t,n){return v.trigger("course:save:error")}),s.on("xhr:success",function(e,t,n){return v.trigger("course:save:success")})},t.prototype.initializeCollab=e.once(function(t){if(g.get("collabUrl"))return o.init(v,e.extend({lessonId:t},g.toJSON())),o.on("ws:open",function(){return v.trigger("course:collab:open")}),o.on("ws:close",function(){return v.trigger("course:collab:close")}),o.on("ws:error",function(e){return v.trigger("course:collab:error",e)})}),t.prototype.loadCourse=function(e){var t,n,r,i=this;return r=new s.Course({id:e}),g.get("revision")&&(t=r.url(),r.url=function(){return"/catalogs/staged"+t}),n=r.fetch({data:{depth:"sections"},silent:!0,success:function(){return i.onCourseLoad(r)}}),m.timeXHR(n,"fetch-course",{courseId:e}),this._renderTimer=m.createTimer("render-course",{courseId:e})},t.prototype.handleException=function(e){return e instanceof s.errors.ApplicationError?console.log("app error"):e instanceof s.errors.NotFound?console.log("not found"):e instanceof s.errors.PermissionDenied?console.log("permission denied"):console.log("error")},t.prototype.onCourseLoad=function(e){var t;return this.course=e,this.onProgressLoad(e.progress),(g.get("noEditable")||g.get("embed"))&&e.set({isEditable:!1}),e.get("isEditable")?(t={all:this.combinedCatalogue,course:e.palette,sandbox:this.combinedCatalogue.sandbox},this.layout.sidebar.show(new a({model:e})),this.layout.tray.show(new l({model:e,catalogs:t}))):(this.layout.sidebar.show(new f({model:e})),this.layout.titlebar.show(new c({model:e}))),this.courseView=new u({model:e}),this.layout.courseContainer.show(this.courseView),e.get("currentPosition")==null&&e.start(),this._courseRendering.resolve()},t.prototype.onProgressLoad=function(e){var t,n;e==null&&(e={}),n=e.get("lessonIndex"),t=e.get("gadgetIndex"),this.lessonId&&v.trigger("navigate:lesson",this.lessonId);if(n!=null&&this.router)return t!=null?v.trigger("navigate:gadget",n,t):v.trigger("navigate:lesson",n)},t.prototype.showLesson=function(e,t){var n=this;return this._courseRendering.done(function(){return n.courseView.showLesson(t)})},t.prototype.showGadget=function(e,t,n){var r=this;return this._courseRendering.done(function(){return r.courseView.showGadget(t,n)})},t.prototype._navigateTo=function(e){if(!this.router)return;return this.router.navigate("courses/"+this.course.id+"/"+e,{trigger:!0})},t.prototype._onAllGadgetsRendered=function(e){var t,n,r=this;this.loadingView.hide(function(){return r.layout.loading.reset()});if(this._playerLoaded)return;return t={event:"player:loaded",course:this.course.pick("title","isEditable")},v.trigger("parent:notify",t),e.id?this.initializeCollab(e.id):e.once("sync",function(){return r.initializeCollab(e.id)}),this._playerLoaded=!0,(n=this._renderTimer)!=null?n.stop():void 0},t.prototype._onNavigateLesson=function(e){this.lessonId=e;if(!this.course)return;return this._navigateTo("lessons/"+this.lessonId),this.showLesson(this.course.id,this.lessonId),v.trigger("parent:notify",{event:"player:navigate:lesson",data:{lessonId:this.lessonId}})},t.prototype._onNavigateGadget=function(e,t){this.lessonId=e;if(!this.course)return;return this._navigateTo("lessons/"+this.lessonId+"/gadgets/"+t),this.showGadget(this.course.id,this.lessonId,t),v.trigger("parent:notify",{event:"player:navigate:gadget",data:{lessonId:this.lessonId,gadgetId:t}})},t}()})}.call(this);