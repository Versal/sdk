/*!
 * player v1.6.27
 * a masterpiece! from 32afe58 on 27. October 2014
 */
// NOTE: We also depend on requirejs and requirejs-text!

if (!window._) {
  !function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?(this._wrapped=a,void 0):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.6.0";var y=x.each=x.forEach=function(a,b,d){if(null==a)return a;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return;return a};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,x.property(b))},x.where=function(a,b){return x.filter(a,x.matches(b))},x.findWhere=function(a,b){return x.find(a,x.matches(b))},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-1/0,e=-1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=x.values(a)),a[x.random(a.length-1)]):x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return null==a?x.identity:x.isFunction(a)?a:x.property(a)};x.sortBy=function(a,b,c){return b=B(b),x.pluck(x.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={};return c=B(c),y(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};x.groupBy=C(function(a,b,c){x.has(a,b)?a[b].push(c):a[b]=[c]}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.partition=function(a,b,c){b=B(b);var d=[],e=[];return y(a,function(a){(b.call(c,a)?d:e).push(a)}),[d,e]},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.contains(b,a)})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===x&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:x.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=x.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=x.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=x.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},x.once=function(a){var c,b=!1;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},x.wrap=function(a,b){return x.partial(b,a)},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=function(a){if(!x.isObject(a))return[];if(v)return v(a);var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.constant=function(a){return function(){return a}},x.property=function(a){return function(b){return b[a]}},x.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},x.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this);
}
if (!window._.cloneDeep) {
  var cloneDeep = function (obj) {
    if (console && console.warn)
      console.warn('_.cloneDeep is not part of underscore and will be deprecated');
    if (obj === null || typeof obj !== 'object') return obj;

    var tmp = obj.constructor();

    for (var k in obj) {
      tmp[k] = cloneDeep(obj[k]);
    }
    return tmp;
  };
  _.mixin({cloneDeep: cloneDeep});
}
if (!window.jQuery) {
  !function(a,b){function J(a){var b=a.length,c=u.type(a);return u.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}function L(a){var b=K[a]={};return u.each(a.match(w)||[],function(a,c){b[c]=!0}),b}function O(a,c,d,e){if(u.acceptData(a)){var f,g,h=u.expando,i=a.nodeType,j=i?u.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||d!==b||"string"!=typeof c)return k||(k=i?a[h]=l.pop()||u.guid++:h),j[k]||(j[k]=i?{}:{toJSON:u.noop}),("object"==typeof c||"function"==typeof c)&&(e?j[k]=u.extend(j[k],c):j[k].data=u.extend(j[k].data,c)),g=j[k],e||(g.data||(g.data={}),g=g.data),d!==b&&(g[u.camelCase(c)]=d),"string"==typeof c?(f=g[c],null==f&&(f=g[u.camelCase(c)])):f=g,f}}function P(a,b,c){if(u.acceptData(a)){var d,e,f=a.nodeType,g=f?u.cache:a,h=f?a[u.expando]:u.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){u.isArray(b)?b=b.concat(u.map(b,u.camelCase)):b in d?b=[b]:(b=u.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;for(;e--;)delete d[b[e]];if(c?!R(d):!u.isEmptyObject(d))return}(c||(delete g[h].data,R(g[h])))&&(f?u.cleanData([a],!0):u.support.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}function Q(a,c,d){if(d===b&&1===a.nodeType){var e="data-"+c.replace(N,"-$1").toLowerCase();if(d=a.getAttribute(e),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:M.test(d)?u.parseJSON(d):d}catch(f){}u.data(a,c,d)}else d=b}return d}function R(a){var b;for(b in a)if(("data"!==b||!u.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function eb(){return!0}function fb(){return!1}function gb(){try{return g.activeElement}catch(a){}}function lb(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function mb(a,b,c){if(u.isFunction(b))return u.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return u.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(hb.test(b))return u.filter(b,a,c);b=u.filter(b,a)}return u.grep(a,function(a){return u.inArray(a,b)>=0!==c})}function nb(a){var b=ob.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function Fb(a,b){return u.nodeName(a,"table")&&u.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function Gb(a){return a.type=(null!==u.find.attr(a,"type"))+"/"+a.type,a}function Hb(a){var b=Ab.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ib(a,b){for(var c,d=0;null!=(c=a[d]);d++)u._data(c,"globalEval",!b||u._data(b[d],"globalEval"))}function Jb(a,b){if(1===b.nodeType&&u.hasData(a)){var c,d,e,f=u._data(a),g=u._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)u.event.add(b,c,h[c][d])}g.data&&(g.data=u.extend({},g.data))}}function Kb(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!u.support.noCloneEvent&&b[u.expando]){e=u._data(b);for(d in e.events)u.removeEvent(b,d,e.handle);b.removeAttribute(u.expando)}"script"===c&&b.text!==a.text?(Gb(b).text=a.text,Hb(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),u.support.html5Clone&&a.innerHTML&&!u.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&xb.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}function Lb(a,c){var d,f,g=0,h=typeof a.getElementsByTagName!==e?a.getElementsByTagName(c||"*"):typeof a.querySelectorAll!==e?a.querySelectorAll(c||"*"):b;if(!h)for(h=[],d=a.childNodes||a;null!=(f=d[g]);g++)!c||u.nodeName(f,c)?h.push(f):u.merge(h,Lb(f,c));return c===b||c&&u.nodeName(a,c)?u.merge([a],h):h}function Mb(a){xb.test(a.type)&&(a.defaultChecked=a.checked)}function bc(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=ac.length;e--;)if(b=ac[e]+c,b in a)return b;return d}function cc(a,b){return a=b||a,"none"===u.css(a,"display")||!u.contains(a.ownerDocument,a)}function dc(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=u._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&cc(d)&&(f[g]=u._data(d,"olddisplay",hc(d.nodeName)))):f[g]||(e=cc(d),(c&&"none"!==c||!e)&&u._data(d,"olddisplay",e?c:u.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function ec(a,b,c){var d=Vb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function fc(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=u.css(a,c+_b[f],!0,e)),d?("content"===c&&(g-=u.css(a,"padding"+_b[f],!0,e)),"margin"!==c&&(g-=u.css(a,"border"+_b[f]+"Width",!0,e))):(g+=u.css(a,"padding"+_b[f],!0,e),"padding"!==c&&(g+=u.css(a,"border"+_b[f]+"Width",!0,e)));return g}function gc(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ob(a),g=u.support.boxSizing&&"border-box"===u.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Pb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Wb.test(e))return e;d=g&&(u.support.boxSizingReliable||e===a.style[b]),e=parseFloat(e)||0}return e+fc(a,b,c||(g?"border":"content"),d,f)+"px"}function hc(a){var b=g,c=Yb[a];return c||(c=ic(a,b),"none"!==c&&c||(Nb=(Nb||u("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(Nb[0].contentWindow||Nb[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=ic(a,b),Nb.detach()),Yb[a]=c),c}function ic(a,b){var c=u(b.createElement(a)).appendTo(b.body),d=u.css(c[0],"display");return c.remove(),d}function oc(a,b,c,d){var e;if(u.isArray(b))u.each(b,function(b,e){c||kc.test(a)?d(a,e):oc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==u.type(b))d(a,b);else for(e in b)oc(a+"["+e+"]",b[e],c,d)}function Fc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(w)||[];if(u.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Gc(a,b,c,d){function g(h){var i;return e[h]=!0,u.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}var e={},f=a===Cc;return g(b.dataTypes[0])||!e["*"]&&g("*")}function Hc(a,c){var d,e,f=u.ajaxSettings.flatOptions||{};for(e in c)c[e]!==b&&((f[e]?a:d||(d={}))[e]=c[e]);return d&&u.extend(!0,a,d),a}function Ic(a,c,d){for(var e,f,g,h,i=a.contents,j=a.dataTypes;"*"===j[0];)j.shift(),f===b&&(f=a.mimeType||c.getResponseHeader("Content-Type"));if(f)for(h in i)if(i[h]&&i[h].test(f)){j.unshift(h);break}if(j[0]in d)g=j[0];else{for(h in d){if(!j[0]||a.converters[h+" "+j[0]]){g=h;break}e||(e=h)}g=g||e}return g?(g!==j[0]&&j.unshift(g),d[g]):void 0}function Jc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function Qc(){try{return new a.XMLHttpRequest}catch(b){}}function Rc(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function Zc(){return setTimeout(function(){Sc=b}),Sc=u.now()}function $c(a,b,c){for(var d,e=(Yc[b]||[]).concat(Yc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function _c(a,b,c){var d,e,f=0,g=Xc.length,h=u.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Sc||Zc(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:u.extend({},b),opts:u.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Sc||Zc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=u.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(ad(k,j.opts.specialEasing);g>f;f++)if(d=Xc[f].call(j,a,k,j.opts))return d;return u.map(k,$c,j),u.isFunction(j.opts.start)&&j.opts.start.call(a,j),u.fx.timer(u.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function ad(a,b){var c,d,e,f,g;for(c in a)if(d=u.camelCase(c),e=b[d],f=a[c],u.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=u.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function bd(a,b,c){var d,e,f,g,h,i,j=this,k={},l=a.style,m=a.nodeType&&cc(a),n=u._data(a,"fxshow");c.queue||(h=u._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,j.always(function(){j.always(function(){h.unqueued--,u.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[l.overflow,l.overflowX,l.overflowY],"inline"===u.css(a,"display")&&"none"===u.css(a,"float")&&(u.support.inlineBlockNeedsLayout&&"inline"!==hc(a.nodeName)?l.zoom=1:l.display="inline-block")),c.overflow&&(l.overflow="hidden",u.support.shrinkWrapBlocks||j.always(function(){l.overflow=c.overflow[0],l.overflowX=c.overflow[1],l.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Uc.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(m?"hide":"show"))continue;k[d]=n&&n[d]||u.style(a,d)}if(!u.isEmptyObject(k)){n?"hidden"in n&&(m=n.hidden):n=u._data(a,"fxshow",{}),f&&(n.hidden=!m),m?u(a).show():j.done(function(){u(a).hide()}),j.done(function(){var b;u._removeData(a,"fxshow");for(b in k)u.style(a,b,k[b])});for(d in k)g=$c(m?n[d]:0,d,j),d in n||(n[d]=g.start,m&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function cd(a,b,c,d,e){return new cd.prototype.init(a,b,c,d,e)}function dd(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=_b[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function ed(a){return u.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var c,d,e=typeof b,f=a.location,g=a.document,h=g.documentElement,i=a.jQuery,j=a.$,k={},l=[],m="1.10.2",n=l.concat,o=l.push,p=l.slice,q=l.indexOf,r=k.toString,s=k.hasOwnProperty,t=m.trim,u=function(a,b){return new u.fn.init(a,b,d)},v=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,x=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,y=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,z=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,A=/^[\],:{}\s]*$/,B=/(?:^|:|,)(?:\s*\[)+/g,C=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,D=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,E=/^-ms-/,F=/-([\da-z])/gi,G=function(a,b){return b.toUpperCase()},H=function(a){(g.addEventListener||"load"===a.type||"complete"===g.readyState)&&(I(),u.ready())},I=function(){g.addEventListener?(g.removeEventListener("DOMContentLoaded",H,!1),a.removeEventListener("load",H,!1)):(g.detachEvent("onreadystatechange",H),a.detachEvent("onload",H))};u.fn=u.prototype={jquery:m,constructor:u,init:function(a,c,d){var e,f;if(!a)return this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:y.exec(a),!e||!e[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(e[1]){if(c=c instanceof u?c[0]:c,u.merge(this,u.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:g,!0)),z.test(e[1])&&u.isPlainObject(c))for(e in c)u.isFunction(this[e])?this[e](c[e]):this.attr(e,c[e]);return this}if(f=g.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return d.find(a);this.length=1,this[0]=f}return this.context=g,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):u.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),u.makeArray(a,this))},selector:"",length:0,toArray:function(){return p.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){var b=u.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return u.each(this,a,b)},ready:function(a){return u.ready.promise().done(a),this},slice:function(){return this.pushStack(p.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},map:function(a){return this.pushStack(u.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:o,sort:[].sort,splice:[].splice},u.fn.init.prototype=u.fn,u.extend=u.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||u.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(f=arguments[i]))for(e in f)a=h[e],d=f[e],h!==d&&(k&&d&&(u.isPlainObject(d)||(c=u.isArray(d)))?(c?(c=!1,g=a&&u.isArray(a)?a:[]):g=a&&u.isPlainObject(a)?a:{},h[e]=u.extend(k,g,d)):d!==b&&(h[e]=d));return h},u.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),noConflict:function(b){return a.$===u&&(a.$=j),b&&a.jQuery===u&&(a.jQuery=i),u},isReady:!1,readyWait:1,holdReady:function(a){a?u.readyWait++:u.ready(!0)},ready:function(a){if(a===!0?!--u.readyWait:!u.isReady){if(!g.body)return setTimeout(u.ready);u.isReady=!0,a!==!0&&--u.readyWait>0||(c.resolveWith(g,[u]),u.fn.trigger&&u(g).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===u.type(a)},isArray:Array.isArray||function(a){return"array"===u.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?k[r.call(a)]||"object":typeof a},isPlainObject:function(a){var c;if(!a||"object"!==u.type(a)||a.nodeType||u.isWindow(a))return!1;try{if(a.constructor&&!s.call(a,"constructor")&&!s.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}if(u.support.ownLast)for(c in a)return s.call(a,c);for(c in a);return c===b||s.call(a,c)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||g;var d=z.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=u.buildFragment([a],b,e),e&&u(e).remove(),u.merge([],d.childNodes))},parseJSON:function(b){return a.JSON&&a.JSON.parse?a.JSON.parse(b):null===b?b:"string"==typeof b&&(b=u.trim(b),b&&A.test(b.replace(C,"@").replace(D,"]").replace(B,"")))?new Function("return "+b)():(u.error("Invalid JSON: "+b),void 0)},parseXML:function(c){var d,e;if(!c||"string"!=typeof c)return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return d&&d.documentElement&&!d.getElementsByTagName("parsererror").length||u.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&u.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(E,"ms-").replace(F,G)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=J(a);if(c){if(g)for(;f>e&&(d=b.apply(a[e],c),d!==!1);e++);else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g)for(;f>e&&(d=b.call(a[e],e,a[e]),d!==!1);e++);else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:t&&!t.call("\ufeff\xa0")?function(a){return null==a?"":t.call(a)}:function(a){return null==a?"":(a+"").replace(x,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(J(Object(a))?u.merge(c,"string"==typeof a?[a]:a):o.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(q)return q.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;d>f;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;g>f;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,c){var d,e=0,f=a.length,g=J(a),h=[];if(g)for(;f>e;e++)d=b(a[e],e,c),null!=d&&(h[h.length]=d);else for(e in a)d=b(a[e],e,c),null!=d&&(h[h.length]=d);return n.apply([],h)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(f=a[c],c=a,a=f),u.isFunction(a)?(d=p.call(arguments,2),e=function(){return a.apply(c||this,d.concat(p.call(arguments)))},e.guid=a.guid=a.guid||u.guid++,e):b},access:function(a,c,d,e,f,g,h){var i=0,j=a.length,k=null==d;if("object"===u.type(d)){f=!0;for(i in d)u.access(a,c,i,d[i],!0,g,h)}else if(e!==b&&(f=!0,u.isFunction(e)||(h=!0),k&&(h?(c.call(a,e),c=null):(k=c,c=function(a,b,c){return k.call(u(a),c)})),c))for(;j>i;i++)c(a[i],d,h?e:e.call(a[i],i,c(a[i],d)));return f?a:k?c.call(a):j?c(a[0],d):g},now:function(){return(new Date).getTime()},swap:function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e}}),u.ready.promise=function(b){if(!c)if(c=u.Deferred(),"complete"===g.readyState)setTimeout(u.ready);else if(g.addEventListener)g.addEventListener("DOMContentLoaded",H,!1),a.addEventListener("load",H,!1);else{g.attachEvent("onreadystatechange",H),a.attachEvent("onload",H);var d=!1;try{d=null==a.frameElement&&g.documentElement}catch(e){}d&&d.doScroll&&function f(){if(!u.isReady){try{d.doScroll("left")}catch(a){return setTimeout(f,50)}I(),u.ready()}}()}return c.promise(b)},u.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){k["[object "+b+"]"]=b.toLowerCase()}),d=u(g),function(a,b){function gb(a,b,c,e){var f,g,h,i,j,k,n,q,r,u;if((b?b.ownerDocument||b:v)!==m&&l(b),b=b||m,c=c||[],!a||"string"!=typeof a)return c;if(1!==(i=b.nodeType)&&9!==i)return[];if(o&&!e){if(f=_.exec(a))if(h=f[1]){if(9===i){if(g=b.getElementById(h),!g||!g.parentNode)return c;if(g.id===h)return c.push(g),c}else if(b.ownerDocument&&(g=b.ownerDocument.getElementById(h))&&s(b,g)&&g.id===h)return c.push(g),c}else{if(f[2])return J.apply(c,b.getElementsByTagName(a)),c;if((h=f[3])&&d.getElementsByClassName&&b.getElementsByClassName)return J.apply(c,b.getElementsByClassName(h)),c}if(d.qsa&&(!p||!p.test(a))){if(q=n=t,r=b,u=9===i&&a,1===i&&"object"!==b.nodeName.toLowerCase()){for(k=qb(a),(n=b.getAttribute("id"))?q=n.replace(cb,"\\$&"):b.setAttribute("id",q),q="[id='"+q+"'] ",j=k.length;j--;)k[j]=q+rb(k[j]);r=V.test(a)&&b.parentNode||b,u=k.join(",")}if(u)try{return J.apply(c,r.querySelectorAll(u)),c}catch(w){}finally{n||b.removeAttribute("id")}}}return zb(a.replace(S,"$1"),b,c,e)}function hb(){function b(c,d){return a.push(c+=" ")>f.cacheLength&&delete b[a.shift()],b[c]=d}var a=[];return b}function ib(a){return a[t]=!0,a}function jb(a){var b=m.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function kb(a,b){for(var c=a.split("|"),d=a.length;d--;)f.attrHandle[c[d]]=b}function lb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||E)-(~a.sourceIndex||E);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function nb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function ob(a){return ib(function(b){return b=+b,ib(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pb(){}function qb(a,b){var c,d,e,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=f.preFilter;h;){(!c||(d=T.exec(h)))&&(d&&(h=h.slice(d[0].length)||h),i.push(e=[])),c=!1,(d=U.exec(h))&&(c=d.shift(),e.push({value:c,type:d[0].replace(S," ")}),h=h.slice(c.length));for(g in f.filter)!(d=Z[g].exec(h))||j[g]&&!(d=j[g](d))||(c=d.shift(),e.push({value:c,type:g,matches:d}),h=h.slice(c.length));if(!c)break}return b?h.length:h?gb.error(a):z(a,i).slice(0)}function rb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function sb(a,b,c){var d=b.dir,f=c&&"parentNode"===d,g=x++;return b.first?function(b,c,e){for(;b=b[d];)if(1===b.nodeType||f)return a(b,c,e)}:function(b,c,h){var i,j,k,l=w+" "+g;if(h){for(;b=b[d];)if((1===b.nodeType||f)&&a(b,c,h))return!0}else for(;b=b[d];)if(1===b.nodeType||f)if(k=b[t]||(b[t]={}),(j=k[d])&&j[0]===l){if((i=j[1])===!0||i===e)return i===!0}else if(j=k[d]=[l],j[1]=a(b,c,h)||e,j[1]===!0)return!0}}function tb(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ub(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function vb(a,b,c,d,e,f){return d&&!d[t]&&(d=vb(d)),e&&!e[t]&&(e=vb(e,f)),ib(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||yb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ub(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d)for(j=ub(r,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l));if(f){if(e||a){if(e){for(j=[],k=r.length;k--;)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}for(k=r.length;k--;)(l=r[k])&&(j=e?L.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ub(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):J.apply(g,r)})}function wb(a){for(var b,c,d,e=a.length,g=f.relative[a[0].type],h=g||f.relative[" "],i=g?1:0,k=sb(function(a){return a===b},h,!0),l=sb(function(a){return L.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];e>i;i++)if(c=f.relative[a[i].type])m=[sb(tb(m),c)];else{if(c=f.filter[a[i].type].apply(null,a[i].matches),c[t]){for(d=++i;e>d&&!f.relative[a[d].type];d++);return vb(i>1&&tb(m),i>1&&rb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(S,"$1"),c,d>i&&wb(a.slice(i,d)),e>d&&wb(a=a.slice(d)),e>d&&rb(a))}m.push(c)}return tb(m)}function xb(a,b){var c=0,d=b.length>0,g=a.length>0,h=function(h,i,k,l,n){var o,p,q,r=[],s=0,t="0",u=h&&[],v=null!=n,x=j,y=h||g&&f.find.TAG("*",n&&i.parentNode||i),z=w+=null==x?1:Math.random()||.1;for(v&&(j=i!==m&&i,e=c);null!=(o=y[t]);t++){if(g&&o){for(p=0;q=a[p++];)if(q(o,i,k)){l.push(o);break}v&&(w=z,e=++c)}d&&((o=!q&&o)&&s--,h&&u.push(o))}if(s+=t,d&&t!==s){for(p=0;q=b[p++];)q(u,r,i,k);if(h){if(s>0)for(;t--;)u[t]||r[t]||(r[t]=H.call(l));r=ub(r)}J.apply(l,r),v&&!h&&r.length>0&&s+b.length>1&&gb.uniqueSort(l)}return v&&(w=z,j=x),u};return d?ib(h):h}function yb(a,b,c){for(var d=0,e=b.length;e>d;d++)gb(a,b[d],c);return c}function zb(a,b,c,e){var g,h,j,k,l,m=qb(a);if(!e&&1===m.length){if(h=m[0]=m[0].slice(0),h.length>2&&"ID"===(j=h[0]).type&&d.getById&&9===b.nodeType&&o&&f.relative[h[1].type]){if(b=(f.find.ID(j.matches[0].replace(db,eb),b)||[])[0],!b)return c;a=a.slice(h.shift().value.length)}for(g=Z.needsContext.test(a)?0:h.length;g--&&(j=h[g],!f.relative[k=j.type]);)if((l=f.find[k])&&(e=l(j.matches[0].replace(db,eb),V.test(h[0].type)&&b.parentNode||b))){if(h.splice(g,1),a=e.length&&rb(h),!a)return J.apply(c,e),c;break}}return i(a,m)(e,b,!o,c,V.test(a)),c}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t="sizzle"+-new Date,v=a.document,w=0,x=0,y=hb(),z=hb(),A=hb(),B=!1,C=function(a,b){return a===b?(B=!0,0):0},D=typeof b,E=1<<31,F={}.hasOwnProperty,G=[],H=G.pop,I=G.push,J=G.push,K=G.slice,L=G.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},M="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",N="[\\x20\\t\\r\\n\\f]",O="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",P=O.replace("w","w#"),Q="\\["+N+"*("+O+")"+N+"*(?:([*^$|!~]?=)"+N+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+P+")|)|)"+N+"*\\]",R=":("+O+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+Q.replace(3,8)+")*)|.*)\\)|)",S=new RegExp("^"+N+"+|((?:^|[^\\\\])(?:\\\\.)*)"+N+"+$","g"),T=new RegExp("^"+N+"*,"+N+"*"),U=new RegExp("^"+N+"*([>+~]|"+N+")"+N+"*"),V=new RegExp(N+"*[+~]"),W=new RegExp("="+N+"*([^\\]'\"]*)"+N+"*\\]","g"),X=new RegExp(R),Y=new RegExp("^"+P+"$"),Z={ID:new RegExp("^#("+O+")"),CLASS:new RegExp("^\\.("+O+")"),TAG:new RegExp("^("+O.replace("w","w*")+")"),ATTR:new RegExp("^"+Q),PSEUDO:new RegExp("^"+R),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+N+"*(even|odd|(([+-]|)(\\d*)n|)"+N+"*(?:([+-]|)"+N+"*(\\d+)|))"+N+"*\\)|)","i"),bool:new RegExp("^(?:"+M+")$","i"),needsContext:new RegExp("^"+N+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+N+"*((?:-\\d)?\\d*)"+N+"*\\)|)(?=[^-]|$)","i")},$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/^(?:input|select|textarea|button)$/i,bb=/^h\d$/i,cb=/'|\\/g,db=new RegExp("\\\\([\\da-f]{1,6}"+N+"?|("+N+")|.)","ig"),eb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(55296|d>>10,56320|1023&d)};try{J.apply(G=K.call(v.childNodes),v.childNodes),G[v.childNodes.length].nodeType}catch(fb){J={apply:G.length?function(a,b){I.apply(a,K.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}h=gb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},d=gb.support={},l=gb.setDocument=function(a){var b=a?a.ownerDocument||a:v,c=b.defaultView;return b!==m&&9===b.nodeType&&b.documentElement?(m=b,n=b.documentElement,o=!h(b),c&&c.attachEvent&&c!==c.top&&c.attachEvent("onbeforeunload",function(){l()}),d.attributes=jb(function(a){return a.className="i",!a.getAttribute("className")}),d.getElementsByTagName=jb(function(a){return a.appendChild(b.createComment("")),!a.getElementsByTagName("*").length}),d.getElementsByClassName=jb(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),d.getById=jb(function(a){return n.appendChild(a).id=t,!b.getElementsByName||!b.getElementsByName(t).length}),d.getById?(f.find.ID=function(a,b){if(typeof b.getElementById!==D&&o){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},f.filter.ID=function(a){var b=a.replace(db,eb);return function(a){return a.getAttribute("id")===b}}):(delete f.find.ID,f.filter.ID=function(a){var b=a.replace(db,eb);return function(a){var c=typeof a.getAttributeNode!==D&&a.getAttributeNode("id");return c&&c.value===b}}),f.find.TAG=d.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==D?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},f.find.CLASS=d.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==D&&o?b.getElementsByClassName(a):void 0},q=[],p=[],(d.qsa=$.test(b.querySelectorAll))&&(jb(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||p.push("\\["+N+"*(?:value|"+M+")"),a.querySelectorAll(":checked").length||p.push(":checked")}),jb(function(a){var c=b.createElement("input");c.setAttribute("type","hidden"),a.appendChild(c).setAttribute("t",""),a.querySelectorAll("[t^='']").length&&p.push("[*^$]="+N+"*(?:''|\"\")"),a.querySelectorAll(":enabled").length||p.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),p.push(",.*:")})),(d.matchesSelector=$.test(r=n.webkitMatchesSelector||n.mozMatchesSelector||n.oMatchesSelector||n.msMatchesSelector))&&jb(function(a){d.disconnectedMatch=r.call(a,"div"),r.call(a,"[s!='']:x"),q.push("!=",R)}),p=p.length&&new RegExp(p.join("|")),q=q.length&&new RegExp(q.join("|")),s=$.test(n.contains)||n.compareDocumentPosition?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},C=n.compareDocumentPosition?function(a,c){if(a===c)return B=!0,0;var e=c.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(c);return e?1&e||!d.sortDetached&&c.compareDocumentPosition(a)===e?a===b||s(v,a)?-1:c===b||s(v,c)?1:k?L.call(k,a)-L.call(k,c):0:4&e?-1:1:a.compareDocumentPosition?-1:1}:function(a,c){var d,e=0,f=a.parentNode,g=c.parentNode,h=[a],i=[c];if(a===c)return B=!0,0;if(!f||!g)return a===b?-1:c===b?1:f?-1:g?1:k?L.call(k,a)-L.call(k,c):0;if(f===g)return lb(a,c);for(d=a;d=d.parentNode;)h.unshift(d);for(d=c;d=d.parentNode;)i.unshift(d);for(;h[e]===i[e];)e++;return e?lb(h[e],i[e]):h[e]===v?-1:i[e]===v?1:0},b):m},gb.matches=function(a,b){return gb(a,null,null,b)},gb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==m&&l(a),b=b.replace(W,"='$1']"),!(!d.matchesSelector||!o||q&&q.test(b)||p&&p.test(b)))try{var c=r.call(a,b);if(c||d.disconnectedMatch||a.document&&11!==a.document.nodeType)return c}catch(e){}return gb(b,m,null,[a]).length>0},gb.contains=function(a,b){return(a.ownerDocument||a)!==m&&l(a),s(a,b)},gb.attr=function(a,c){(a.ownerDocument||a)!==m&&l(a);var e=f.attrHandle[c.toLowerCase()],g=e&&F.call(f.attrHandle,c.toLowerCase())?e(a,c,!o):b;return g===b?d.attributes||!o?a.getAttribute(c):(g=a.getAttributeNode(c))&&g.specified?g.value:null:g},gb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},gb.uniqueSort=function(a){var b,c=[],e=0,f=0;if(B=!d.detectDuplicates,k=!d.sortStable&&a.slice(0),a.sort(C),B){for(;b=a[f++];)b===a[f]&&(e=c.push(f));for(;e--;)a.splice(c[e],1)}return a},g=gb.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=g(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=g(b);return c},f=gb.selectors={cacheLength:50,createPseudo:ib,match:Z,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(db,eb),a[3]=(a[4]||a[5]||"").replace(db,eb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||gb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&gb.error(a[0]),a},PSEUDO:function(a){var c,d=!a[5]&&a[2];return Z.CHILD.test(a[0])?null:(a[3]&&a[4]!==b?a[2]=a[4]:d&&X.test(d)&&(c=qb(d,!0))&&(c=d.indexOf(")",d.length-c)-d.length)&&(a[0]=a[0].slice(0,c),a[2]=d.slice(0,c)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(db,eb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+N+")"+a+"("+N+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==D&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=gb.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;
  o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[t]||(q[t]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[t]||(b[t]={}))[a])&&j[0]===w)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[t]||(l[t]={}))[a]=[w,m]),l!==b)););return m-=e,m===d||0===m%d&&m/d>=0}}},PSEUDO:function(a,b){var c,d=f.pseudos[a]||f.setFilters[a.toLowerCase()]||gb.error("unsupported pseudo: "+a);return d[t]?d(b):d.length>1?(c=[a,a,"",b],f.setFilters.hasOwnProperty(a.toLowerCase())?ib(function(a,c){for(var e,f=d(a,b),g=f.length;g--;)e=L.call(a,f[g]),a[e]=!(c[e]=f[g])}):function(a){return d(a,0,c)}):d}},pseudos:{not:ib(function(a){var b=[],c=[],d=i(a.replace(S,"$1"));return d[t]?ib(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:ib(function(a){return function(b){return gb(a,b).length>0}}),contains:ib(function(a){return function(b){return(b.textContent||b.innerText||g(b)).indexOf(a)>-1}}),lang:ib(function(a){return Y.test(a||"")||gb.error("unsupported lang: "+a),a=a.replace(db,eb).toLowerCase(),function(b){var c;do if(c=o?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===n},focus:function(a){return a===m.activeElement&&(!m.hasFocus||m.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeName>"@"||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!f.pseudos.empty(a)},header:function(a){return bb.test(a.nodeName)},input:function(a){return ab.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:ob(function(){return[0]}),last:ob(function(a,b){return[b-1]}),eq:ob(function(a,b,c){return[0>c?c+b:c]}),even:ob(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:ob(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:ob(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:ob(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},f.pseudos.nth=f.pseudos.eq;for(c in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})f.pseudos[c]=mb(c);for(c in{submit:!0,reset:!0})f.pseudos[c]=nb(c);pb.prototype=f.filters=f.pseudos,f.setFilters=new pb,i=gb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){for(b||(b=qb(a)),c=b.length;c--;)f=wb(b[c]),f[t]?d.push(f):e.push(f);f=A(a,xb(e,d))}return f},d.sortStable=t.split("").sort(C).join("")===t,d.detectDuplicates=B,l(),d.sortDetached=jb(function(a){return 1&a.compareDocumentPosition(m.createElement("div"))}),jb(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||kb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),d.attributes&&jb(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||kb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),jb(function(a){return null==a.getAttribute("disabled")})||kb(M,function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&d.specified?d.value:a[b]===!0?b.toLowerCase():null}),u.find=gb,u.expr=gb.selectors,u.expr[":"]=u.expr.pseudos,u.unique=gb.uniqueSort,u.text=gb.getText,u.isXMLDoc=gb.isXML,u.contains=gb.contains}(a);var K={};u.Callbacks=function(a){a="string"==typeof a?K[a]||L(a):u.extend({},a);var c,d,e,f,g,h,i=[],j=!a.once&&[],k=function(b){for(d=a.memory&&b,e=!0,g=h||0,h=0,f=i.length,c=!0;i&&f>g;g++)if(i[g].apply(b[0],b[1])===!1&&a.stopOnFalse){d=!1;break}c=!1,i&&(j?j.length&&k(j.shift()):d?i=[]:l.disable())},l={add:function(){if(i){var b=i.length;!function e(b){u.each(b,function(b,c){var d=u.type(c);"function"===d?a.unique&&l.has(c)||i.push(c):c&&c.length&&"string"!==d&&e(c)})}(arguments),c?f=i.length:d&&(h=b,k(d))}return this},remove:function(){return i&&u.each(arguments,function(a,b){for(var d;(d=u.inArray(b,i,d))>-1;)i.splice(d,1),c&&(f>=d&&f--,g>=d&&g--)}),this},has:function(a){return a?u.inArray(a,i)>-1:!(!i||!i.length)},empty:function(){return i=[],f=0,this},disable:function(){return i=j=d=b,this},disabled:function(){return!i},lock:function(){return j=b,d||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return!i||e&&!j||(b=b||[],b=[a,b.slice?b.slice():b],c?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!e}};return l},u.extend({Deferred:function(a){var b=[["resolve","done",u.Callbacks("once memory"),"resolved"],["reject","fail",u.Callbacks("once memory"),"rejected"],["notify","progress",u.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return u.Deferred(function(c){u.each(b,function(b,f){var g=f[0],h=u.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);a&&u.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?u.extend(a,d):d}},e={};return d.pipe=d.then,u.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var h,i,j,b=0,c=p.call(arguments),d=c.length,e=1!==d||a&&u.isFunction(a.promise)?d:0,f=1===e?a:u.Deferred(),g=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?p.call(arguments):d,c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}};if(d>1)for(h=new Array(d),i=new Array(d),j=new Array(d);d>b;b++)c[b]&&u.isFunction(c[b].promise)?c[b].promise().done(g(b,j,c)).fail(f.reject).progress(g(b,i,h)):--e;return e||f.resolveWith(j,c),f.promise()}}),u.support=function(b){var c,d,f,h,i,j,k,l,m,n=g.createElement("div");if(n.setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=n.getElementsByTagName("*")||[],d=n.getElementsByTagName("a")[0],!d||!d.style||!c.length)return b;h=g.createElement("select"),j=h.appendChild(g.createElement("option")),f=n.getElementsByTagName("input")[0],d.style.cssText="top:1px;float:left;opacity:.5",b.getSetAttribute="t"!==n.className,b.leadingWhitespace=3===n.firstChild.nodeType,b.tbody=!n.getElementsByTagName("tbody").length,b.htmlSerialize=!!n.getElementsByTagName("link").length,b.style=/top/.test(d.getAttribute("style")),b.hrefNormalized="/a"===d.getAttribute("href"),b.opacity=/^0.5/.test(d.style.opacity),b.cssFloat=!!d.style.cssFloat,b.checkOn=!!f.value,b.optSelected=j.selected,b.enctype=!!g.createElement("form").enctype,b.html5Clone="<:nav></:nav>"!==g.createElement("nav").cloneNode(!0).outerHTML,b.inlineBlockNeedsLayout=!1,b.shrinkWrapBlocks=!1,b.pixelPosition=!1,b.deleteExpando=!0,b.noCloneEvent=!0,b.reliableMarginRight=!0,b.boxSizingReliable=!0,f.checked=!0,b.noCloneChecked=f.cloneNode(!0).checked,h.disabled=!0,b.optDisabled=!j.disabled;try{delete n.test}catch(o){b.deleteExpando=!1}f=g.createElement("input"),f.setAttribute("value",""),b.input=""===f.getAttribute("value"),f.value="t",f.setAttribute("type","radio"),b.radioValue="t"===f.value,f.setAttribute("checked","t"),f.setAttribute("name","t"),i=g.createDocumentFragment(),i.appendChild(f),b.appendChecked=f.checked,b.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,n.attachEvent&&(n.attachEvent("onclick",function(){b.noCloneEvent=!1}),n.cloneNode(!0).click());for(m in{submit:!0,change:!0,focusin:!0})n.setAttribute(k="on"+m,"t"),b[m+"Bubbles"]=k in a||n.attributes[k].expando===!1;n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",b.clearCloneStyle="content-box"===n.style.backgroundClip;for(m in u(b))break;return b.ownLast="0"!==m,u(function(){var c,d,f,h="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",i=g.getElementsByTagName("body")[0];i&&(c=g.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",i.appendChild(c).appendChild(n),n.innerHTML="<table><tr><td></td><td>t</td></tr></table>",f=n.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",l=0===f[0].offsetHeight,f[0].style.display="",f[1].style.display="none",b.reliableHiddenOffsets=l&&0===f[0].offsetHeight,n.innerHTML="",n.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",u.swap(i,null!=i.style.zoom?{zoom:1}:{},function(){b.boxSizing=4===n.offsetWidth}),a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(n,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(n,null)||{width:"4px"}).width,d=n.appendChild(g.createElement("div")),d.style.cssText=n.style.cssText=h,d.style.marginRight=d.style.width="0",n.style.width="1px",b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)),typeof n.style.zoom!==e&&(n.innerHTML="",n.style.cssText=h+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=3===n.offsetWidth,n.style.display="block",n.innerHTML="<div></div>",n.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==n.offsetWidth,b.inlineBlockNeedsLayout&&(i.style.zoom=1)),i.removeChild(c),c=n=f=d=null)}),c=h=i=j=d=f=null,b}({});var M=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,N=/([A-Z])/g;u.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?u.cache[a[u.expando]]:a[u.expando],!!a&&!R(a)},data:function(a,b,c){return O(a,b,c)},removeData:function(a,b){return P(a,b)},_data:function(a,b,c){return O(a,b,c,!0)},_removeData:function(a,b){return P(a,b,!0)},acceptData:function(a){if(a.nodeType&&1!==a.nodeType&&9!==a.nodeType)return!1;var b=a.nodeName&&u.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),u.fn.extend({data:function(a,c){var d,e,f=null,g=0,h=this[0];if(a===b){if(this.length&&(f=u.data(h),1===h.nodeType&&!u._data(h,"parsedAttrs"))){for(d=h.attributes;g<d.length;g++)e=d[g].name,0===e.indexOf("data-")&&(e=u.camelCase(e.slice(5)),Q(h,e,f[e]));u._data(h,"parsedAttrs",!0)}return f}return"object"==typeof a?this.each(function(){u.data(this,a)}):arguments.length>1?this.each(function(){u.data(this,a,c)}):h?Q(h,a,u.data(h,a)):null},removeData:function(a){return this.each(function(){u.removeData(this,a)})}}),u.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=u._data(a,b),c&&(!d||u.isArray(c)?d=u._data(a,b,u.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=u.queue(a,b),d=c.length,e=c.shift(),f=u._queueHooks(a,b),g=function(){u.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return u._data(a,c)||u._data(a,c,{empty:u.Callbacks("once memory").add(function(){u._removeData(a,b+"queue"),u._removeData(a,c)})})}}),u.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?u.queue(this[0],a):c===b?this:this.each(function(){var b=u.queue(this,a,c);u._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&u.dequeue(this,a)})},dequeue:function(a){return this.each(function(){u.dequeue(this,a)})},delay:function(a,b){return a=u.fx?u.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=u.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)d=u._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var S,T,U=/[\t\r\n\f]/g,V=/\r/g,W=/^(?:input|select|textarea|button|object)$/i,X=/^(?:a|area)$/i,Y=/^(?:checked|selected)$/i,Z=u.support.getSetAttribute,$=u.support.input;u.fn.extend({attr:function(a,b){return u.access(this,u.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){u.removeAttr(this,a)})},prop:function(a,b){return u.access(this,u.prop,a,b,arguments.length>1)},removeProp:function(a){return a=u.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i="string"==typeof a&&a;if(u.isFunction(a))return this.each(function(b){u(this).addClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(w)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(U," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");c.className=u.trim(d)}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=0===arguments.length||"string"==typeof a&&a;if(u.isFunction(a))return this.each(function(b){u(this).removeClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(w)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(U," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");c.className=a?u.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):u.isFunction(a)?this.each(function(c){u(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var b,d=0,f=u(this),g=a.match(w)||[];b=g[d++];)f.hasClass(b)?f.removeClass(b):f.addClass(b);else(c===e||"boolean"===c)&&(this.className&&u._data(this,"__className__",this.className),this.className=this.className||a===!1?"":u._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(U," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];{if(arguments.length)return e=u.isFunction(a),this.each(function(c){var f;1===this.nodeType&&(f=e?a.call(this,c,u(this).val()):a,null==f?f="":"number"==typeof f?f+="":u.isArray(f)&&(f=u.map(f,function(a){return null==a?"":a+""})),d=u.valHooks[this.type]||u.valHooks[this.nodeName.toLowerCase()],d&&"set"in d&&d.set(this,f,"value")!==b||(this.value=f))});if(f)return d=u.valHooks[f.type]||u.valHooks[f.nodeName.toLowerCase()],d&&"get"in d&&(c=d.get(f,"value"))!==b?c:(c=f.value,"string"==typeof c?c.replace(V,""):null==c?"":c)}}}),u.extend({valHooks:{option:{get:function(a){var b=u.find.attr(a,"value");return null!=b?b:a.text}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(u.support.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&u.nodeName(c.parentNode,"optgroup"))){if(b=u(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=u.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=u.inArray(u(d).val(),f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}},attr:function(a,c,d){var f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return typeof a.getAttribute===e?u.prop(a,c,d):(1===h&&u.isXMLDoc(a)||(c=c.toLowerCase(),f=u.attrHooks[c]||(u.expr.match.bool.test(c)?T:S)),d===b?f&&"get"in f&&null!==(g=f.get(a,c))?g:(g=u.find.attr(a,c),null==g?b:g):null!==d?f&&"set"in f&&(g=f.set(a,d,c))!==b?g:(a.setAttribute(c,d+""),d):(u.removeAttr(a,c),void 0))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(w);if(f&&1===a.nodeType)for(;c=f[e++];)d=u.propFix[c]||c,u.expr.match.bool.test(c)?$&&Z||!Y.test(c)?a[d]=!1:a[u.camelCase("default-"+c)]=a[d]=!1:u.attr(a,c,""),a.removeAttribute(Z?c:d)},attrHooks:{type:{set:function(a,b){if(!u.support.radioValue&&"radio"===b&&u.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return g=1!==h||!u.isXMLDoc(a),g&&(c=u.propFix[c]||c,f=u.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){var b=u.find.attr(a,"tabindex");return b?parseInt(b,10):W.test(a.nodeName)||X.test(a.nodeName)&&a.href?0:-1}}}}),T={set:function(a,b,c){return b===!1?u.removeAttr(a,c):$&&Z||!Y.test(c)?a.setAttribute(!Z&&u.propFix[c]||c,c):a[u.camelCase("default-"+c)]=a[c]=!0,c}},u.each(u.expr.match.bool.source.match(/\w+/g),function(a,c){var d=u.expr.attrHandle[c]||u.find.attr;u.expr.attrHandle[c]=$&&Z||!Y.test(c)?function(a,c,e){var f=u.expr.attrHandle[c],g=e?b:(u.expr.attrHandle[c]=b)!=d(a,c,e)?c.toLowerCase():null;return u.expr.attrHandle[c]=f,g}:function(a,c,d){return d?b:a[u.camelCase("default-"+c)]?c.toLowerCase():null}}),$&&Z||(u.attrHooks.value={set:function(a,b,c){return u.nodeName(a,"input")?(a.defaultValue=b,void 0):S&&S.set(a,b,c)}}),Z||(S={set:function(a,c,d){var e=a.getAttributeNode(d);return e||a.setAttributeNode(e=a.ownerDocument.createAttribute(d)),e.value=c+="","value"===d||c===a.getAttribute(d)?c:b}},u.expr.attrHandle.id=u.expr.attrHandle.name=u.expr.attrHandle.coords=function(a,c,d){var e;return d?b:(e=a.getAttributeNode(c))&&""!==e.value?e.value:null},u.valHooks.button={get:function(a,c){var d=a.getAttributeNode(c);return d&&d.specified?d.value:b},set:S.set},u.attrHooks.contenteditable={set:function(a,b,c){S.set(a,""===b?!1:b,c)}},u.each(["width","height"],function(a,b){u.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),u.support.hrefNormalized||u.each(["href","src"],function(a,b){u.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),u.support.style||(u.attrHooks.style={get:function(a){return a.style.cssText||b},set:function(a,b){return a.style.cssText=b+""}}),u.support.optSelected||(u.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),u.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){u.propFix[this.toLowerCase()]=this}),u.support.enctype||(u.propFix.enctype="encoding"),u.each(["radio","checkbox"],function(){u.valHooks[this]={set:function(a,b){return u.isArray(b)?a.checked=u.inArray(u(a).val(),b)>=0:void 0}},u.support.checkOn||(u.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var _=/^(?:input|select|textarea)$/i,ab=/^key/,bb=/^(?:mouse|contextmenu)|click/,cb=/^(?:focusinfocus|focusoutblur)$/,db=/^([^.]*)(?:\.(.+)|)$/;u.event={global:{},add:function(a,c,d,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=u._data(a);if(s){for(d.handler&&(k=d,d=k.handler,g=k.selector),d.guid||(d.guid=u.guid++),(i=s.events)||(i=s.events={}),(m=s.handle)||(m=s.handle=function(a){return typeof u===e||a&&u.event.triggered===a.type?b:u.event.dispatch.apply(m.elem,arguments)},m.elem=a),c=(c||"").match(w)||[""],j=c.length;j--;)h=db.exec(c[j])||[],p=r=h[1],q=(h[2]||"").split(".").sort(),p&&(l=u.event.special[p]||{},p=(g?l.delegateType:l.bindType)||p,l=u.event.special[p]||{},n=u.extend({type:p,origType:r,data:f,handler:d,guid:d.guid,selector:g,needsContext:g&&u.expr.match.needsContext.test(g),namespace:q.join(".")},k),(o=i[p])||(o=i[p]=[],o.delegateCount=0,l.setup&&l.setup.call(a,f,q,m)!==!1||(a.addEventListener?a.addEventListener(p,m,!1):a.attachEvent&&a.attachEvent("on"+p,m))),l.add&&(l.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),g?o.splice(o.delegateCount++,0,n):o.push(n),u.event.global[p]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=u.hasData(a)&&u._data(a);if(q&&(k=q.events)){for(b=(b||"").match(w)||[""],j=b.length;j--;)if(h=db.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=u.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=k[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;f--;)g=m[f],!e&&p!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||u.removeEvent(a,n,q.handle),delete k[n])}else for(n in k)u.event.remove(a,n+b[j],c,d,!0);u.isEmptyObject(k)&&(delete q.handle,u._removeData(a,"events"))}},trigger:function(c,d,e,f){var h,i,j,k,l,m,n,o=[e||g],p=s.call(c,"type")?c.type:c,q=s.call(c,"namespace")?c.namespace.split("."):[];if(j=m=e=e||g,3!==e.nodeType&&8!==e.nodeType&&!cb.test(p+u.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),i=p.indexOf(":")<0&&"on"+p,c=c[u.expando]?c:new u.Event(p,"object"==typeof c&&c),c.isTrigger=f?2:3,c.namespace=q.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=e),d=null==d?[c]:u.makeArray(d,[c]),l=u.event.special[p]||{},f||!l.trigger||l.trigger.apply(e,d)!==!1)){if(!f&&!l.noBubble&&!u.isWindow(e)){for(k=l.delegateType||p,cb.test(k+p)||(j=j.parentNode);j;j=j.parentNode)o.push(j),m=j;m===(e.ownerDocument||g)&&o.push(m.defaultView||m.parentWindow||a)}for(n=0;(j=o[n++])&&!c.isPropagationStopped();)c.type=n>1?k:l.bindType||p,h=(u._data(j,"events")||{})[c.type]&&u._data(j,"handle"),h&&h.apply(j,d),h=i&&j[i],h&&u.acceptData(j)&&h.apply&&h.apply(j,d)===!1&&c.preventDefault();if(c.type=p,!f&&!c.isDefaultPrevented()&&(!l._default||l._default.apply(o.pop(),d)===!1)&&u.acceptData(e)&&i&&e[p]&&!u.isWindow(e)){m=e[i],m&&(e[i]=null),u.event.triggered=p;try{e[p]()}catch(r){}u.event.triggered=b,m&&(e[i]=m)}return c.result}},dispatch:function(a){a=u.event.fix(a);var c,d,e,f,g,h=[],i=p.call(arguments),j=(u._data(this,"events")||{})[a.type]||[],k=u.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){for(h=u.event.handlers.call(this,a,j),c=0;(f=h[c++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,g=0;(e=f.handlers[g++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,d=((u.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),d!==b&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,c){var d,e,f,g,h=[],i=c.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||"click"!==a.type))for(;j!=this;j=j.parentNode||this)if(1===j.nodeType&&(j.disabled!==!0||"click"!==a.type)){for(f=[],g=0;i>g;g++)e=c[g],d=e.selector+" ",f[d]===b&&(f[d]=e.needsContext?u(d,this).index(j)>=0:u.find(d,this,null,[j]).length),f[d]&&f.push(e);f.length&&h.push({elem:j,handlers:f})}return i<c.length&&h.push({elem:this,handlers:c.slice(i)}),h},fix:function(a){if(a[u.expando])return a;var b,c,d,e=a.type,f=a,h=this.fixHooks[e];for(h||(this.fixHooks[e]=h=bb.test(e)?this.mouseHooks:ab.test(e)?this.keyHooks:{}),d=h.props?this.props.concat(h.props):this.props,a=new u.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||g),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,h.filter?h.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,h=c.button,i=c.fromElement;return null==a.pageX&&null!=c.clientX&&(e=a.target.ownerDocument||g,f=e.documentElement,d=e.body,a.pageX=c.clientX+(f&&f.scrollLeft||d&&d.scrollLeft||0)-(f&&f.clientLeft||d&&d.clientLeft||0),a.pageY=c.clientY+(f&&f.scrollTop||d&&d.scrollTop||0)-(f&&f.clientTop||d&&d.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?c.toElement:i),a.which||h===b||(a.which=1&h?1:2&h?3:4&h?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==gb()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===gb()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return u.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return u.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=u.extend(new u.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?u.event.trigger(e,null,b):u.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},u.removeEvent=g.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===e&&(a[d]=null),a.detachEvent(d,c))},u.Event=function(a,b){return this instanceof u.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?eb:fb):this.type=a,b&&u.extend(this,b),this.timeStamp=a&&a.timeStamp||u.now(),this[u.expando]=!0,void 0):new u.Event(a,b)},u.Event.prototype={isDefaultPrevented:fb,isPropagationStopped:fb,isImmediatePropagationStopped:fb,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=eb,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=eb,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=eb,this.stopPropagation()}},u.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){u.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!u.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),u.support.submitBubbles||(u.event.special.submit={setup:function(){return u.nodeName(this,"form")?!1:(u.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=u.nodeName(c,"input")||u.nodeName(c,"button")?c.form:b;d&&!u._data(d,"submitBubbles")&&(u.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),u._data(d,"submitBubbles",!0))}),void 0)},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&u.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return u.nodeName(this,"form")?!1:(u.event.remove(this,"._submit"),void 0)}}),u.support.changeBubbles||(u.event.special.change={setup:function(){return _.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(u.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),u.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),u.event.simulate("change",this,a,!0)})),!1):(u.event.add(this,"beforeactivate._change",function(a){var b=a.target;_.test(b.nodeName)&&!u._data(b,"changeBubbles")&&(u.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||u.event.simulate("change",this.parentNode,a,!0)}),u._data(b,"changeBubbles",!0))}),void 0)},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return u.event.remove(this,"._change"),!_.test(this.nodeName)}}),u.support.focusinBubbles||u.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){u.event.simulate(b,a.target,u.event.fix(a),!0)};u.event.special[b]={setup:function(){0===c++&&g.addEventListener(a,d,!0)},teardown:function(){0===--c&&g.removeEventListener(a,d,!0)}}}),u.fn.extend({on:function(a,c,d,e,f){var g,h;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(g in a)this.on(g,c,d,a[g],f);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),e===!1)e=fb;else if(!e)return this;return 1===f&&(h=e,e=function(a){return u().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=u.guid++)),this.each(function(){u.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,u(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(f in a)this.off(f,c,a[f]);return this}return(c===!1||"function"==typeof c)&&(d=c,c=b),d===!1&&(d=fb),this.each(function(){u.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){u.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?u.event.trigger(a,b,c,!0):void 0}});var hb=/^.[^:#\[\.,]*$/,ib=/^(?:parents|prev(?:Until|All))/,jb=u.expr.match.needsContext,kb={children:!0,contents:!0,next:!0,prev:!0};u.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(u(a).filter(function(){for(b=0;e>b;b++)if(u.contains(d[b],this))return!0}));for(b=0;e>b;b++)u.find(a,d[b],c);return c=this.pushStack(e>1?u.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},has:function(a){var b,c=u(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(u.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(mb(this,a||[],!0))},filter:function(a){return this.pushStack(mb(this,a||[],!1))},is:function(a){return!!mb(this,"string"==typeof a&&jb.test(a)?u(a):a||[],!1).length},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=jb.test(a)||"string"!=typeof a?u(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&u.find.matchesSelector(c,a))){c=f.push(c);break}return this.pushStack(f.length>1?u.unique(f):f)},index:function(a){return a?"string"==typeof a?u.inArray(this[0],u(a)):u.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"==typeof a?u(a,b):u.makeArray(a&&a.nodeType?[a]:a),d=u.merge(this.get(),c);return this.pushStack(u.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),u.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u.dir(a,"parentNode")},parentsUntil:function(a,b,c){return u.dir(a,"parentNode",c)},next:function(a){return lb(a,"nextSibling")},prev:function(a){return lb(a,"previousSibling")},nextAll:function(a){return u.dir(a,"nextSibling")},prevAll:function(a){return u.dir(a,"previousSibling")},nextUntil:function(a,b,c){return u.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return u.dir(a,"previousSibling",c)},siblings:function(a){return u.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return u.sibling(a.firstChild)
  },contents:function(a){return u.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:u.merge([],a.childNodes)}},function(a,b){u.fn[a]=function(c,d){var e=u.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=u.filter(d,e)),this.length>1&&(kb[a]||(e=u.unique(e)),ib.test(a)&&(e=e.reverse())),this.pushStack(e)}}),u.extend({filter:function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?u.find.matchesSelector(d,a)?[d]:[]:u.find.matches(a,u.grep(b,function(a){return 1===a.nodeType}))},dir:function(a,c,d){for(var e=[],f=a[c];f&&9!==f.nodeType&&(d===b||1!==f.nodeType||!u(f).is(d));)1===f.nodeType&&e.push(f),f=f[c];return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var ob="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",pb=/ jQuery\d+="(?:null|\d+)"/g,qb=new RegExp("<(?:"+ob+")[\\s/>]","i"),rb=/^\s+/,sb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,tb=/<([\w:]+)/,ub=/<tbody/i,vb=/<|&#?\w+;/,wb=/<(?:script|style|link)/i,xb=/^(?:checkbox|radio)$/i,yb=/checked\s*(?:[^=]|=\s*.checked.)/i,zb=/^$|\/(?:java|ecma)script/i,Ab=/^true\/(.*)/,Bb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Cb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:u.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Db=nb(g),Eb=Db.appendChild(g.createElement("div"));Cb.optgroup=Cb.option,Cb.tbody=Cb.tfoot=Cb.colgroup=Cb.caption=Cb.thead,Cb.th=Cb.td,u.fn.extend({text:function(a){return u.access(this,function(a){return a===b?u.text(this):this.empty().append((this[0]&&this[0].ownerDocument||g).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Fb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Fb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?u.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||u.cleanData(Lb(c)),c.parentNode&&(b&&u.contains(c.ownerDocument,c)&&Ib(Lb(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){for(1===a.nodeType&&u.cleanData(Lb(a,!1));a.firstChild;)a.removeChild(a.firstChild);a.options&&u.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return u.clone(this,a,b)})},html:function(a){return u.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(pb,""):b;if(!("string"!=typeof a||wb.test(a)||!u.support.htmlSerialize&&qb.test(a)||!u.support.leadingWhitespace&&rb.test(a)||Cb[(tb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(sb,"<$1></$2>");try{for(;e>d;d++)c=this[d]||{},1===c.nodeType&&(u.cleanData(Lb(c,!1)),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=u.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;return this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(d&&d.parentNode!==e&&(d=this.nextSibling),u(this).remove(),e.insertBefore(c,d))},!0),b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=n.apply([],a);var d,e,f,g,h,i,j=0,k=this.length,l=this,m=k-1,o=a[0],p=u.isFunction(o);if(p||!(1>=k||"string"!=typeof o||u.support.checkClone)&&yb.test(o))return this.each(function(d){var e=l.eq(d);p&&(a[0]=o.call(this,d,e.html())),e.domManip(a,b,c)});if(k&&(i=u.buildFragment(a,this[0].ownerDocument,!1,!c&&this),d=i.firstChild,1===i.childNodes.length&&(i=d),d)){for(g=u.map(Lb(i,"script"),Gb),f=g.length;k>j;j++)e=i,j!==m&&(e=u.clone(e,!0,!0),f&&u.merge(g,Lb(e,"script"))),b.call(this[j],e,j);if(f)for(h=g[g.length-1].ownerDocument,u.map(g,Hb),j=0;f>j;j++)e=g[j],zb.test(e.type||"")&&!u._data(e,"globalEval")&&u.contains(h,e)&&(e.src?u._evalUrl(e.src):u.globalEval((e.text||e.textContent||e.innerHTML||"").replace(Bb,"")));i=d=null}return this}}),u.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){u.fn[a]=function(a){for(var c,d=0,e=[],f=u(a),g=f.length-1;g>=d;d++)c=d===g?this:this.clone(!0),u(f[d])[b](c),o.apply(e,c.get());return this.pushStack(e)}}),u.extend({clone:function(a,b,c){var d,e,f,g,h,i=u.contains(a.ownerDocument,a);if(u.support.html5Clone||u.isXMLDoc(a)||!qb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(Eb.innerHTML=a.outerHTML,Eb.removeChild(f=Eb.firstChild)),!(u.support.noCloneEvent&&u.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||u.isXMLDoc(a)))for(d=Lb(f),h=Lb(a),g=0;null!=(e=h[g]);++g)d[g]&&Kb(e,d[g]);if(b)if(c)for(h=h||Lb(a),d=d||Lb(f),g=0;null!=(e=h[g]);g++)Jb(e,d[g]);else Jb(a,f);return d=Lb(f,"script"),d.length>0&&Ib(d,!i&&Lb(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k,l=a.length,m=nb(b),n=[],o=0;l>o;o++)if(f=a[o],f||0===f)if("object"===u.type(f))u.merge(n,f.nodeType?[f]:f);else if(vb.test(f)){for(h=h||m.appendChild(b.createElement("div")),i=(tb.exec(f)||["",""])[1].toLowerCase(),k=Cb[i]||Cb._default,h.innerHTML=k[1]+f.replace(sb,"<$1></$2>")+k[2],e=k[0];e--;)h=h.lastChild;if(!u.support.leadingWhitespace&&rb.test(f)&&n.push(b.createTextNode(rb.exec(f)[0])),!u.support.tbody)for(f="table"!==i||ub.test(f)?"<table>"!==k[1]||ub.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;e--;)u.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j);for(u.merge(n,h.childNodes),h.textContent="";h.firstChild;)h.removeChild(h.firstChild);h=m.lastChild}else n.push(b.createTextNode(f));for(h&&m.removeChild(h),u.support.appendChecked||u.grep(Lb(n,"input"),Mb),o=0;f=n[o++];)if((!d||-1===u.inArray(f,d))&&(g=u.contains(f.ownerDocument,f),h=Lb(m.appendChild(f),"script"),g&&Ib(h),c))for(e=0;f=h[e++];)zb.test(f.type||"")&&c.push(f);return h=null,m},cleanData:function(a,b){for(var c,d,f,g,h=0,i=u.expando,j=u.cache,k=u.support.deleteExpando,m=u.event.special;null!=(c=a[h]);h++)if((b||u.acceptData(c))&&(f=c[i],g=f&&j[f])){if(g.events)for(d in g.events)m[d]?u.event.remove(c,d):u.removeEvent(c,d,g.handle);j[f]&&(delete j[f],k?delete c[i]:typeof c.removeAttribute!==e?c.removeAttribute(i):c[i]=null,l.push(f))}},_evalUrl:function(a){return u.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),u.fn.extend({wrapAll:function(a){if(u.isFunction(a))return this.each(function(b){u(this).wrapAll(a.call(this,b))});if(this[0]){var b=u(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return u.isFunction(a)?this.each(function(b){u(this).wrapInner(a.call(this,b))}):this.each(function(){var b=u(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=u.isFunction(a);return this.each(function(c){u(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){u.nodeName(this,"body")||u(this).replaceWith(this.childNodes)}).end()}});var Nb,Ob,Pb,Qb=/alpha\([^)]*\)/i,Rb=/opacity\s*=\s*([^)]*)/,Sb=/^(top|right|bottom|left)$/,Tb=/^(none|table(?!-c[ea]).+)/,Ub=/^margin/,Vb=new RegExp("^("+v+")(.*)$","i"),Wb=new RegExp("^("+v+")(?!px)[a-z%]+$","i"),Xb=new RegExp("^([+-])=("+v+")","i"),Yb={BODY:"block"},Zb={position:"absolute",visibility:"hidden",display:"block"},$b={letterSpacing:0,fontWeight:400},_b=["Top","Right","Bottom","Left"],ac=["Webkit","O","Moz","ms"];u.fn.extend({css:function(a,c){return u.access(this,function(a,c,d){var e,f,g={},h=0;if(u.isArray(c)){for(f=Ob(a),e=c.length;e>h;h++)g[c[h]]=u.css(a,c[h],!1,f);return g}return d!==b?u.style(a,c,d):u.css(a,c)},a,c,arguments.length>1)},show:function(){return dc(this,!0)},hide:function(){return dc(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){cc(this)?u(this).show():u(this).hide()})}}),u.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Pb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":u.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=u.camelCase(c),j=a.style;if(c=u.cssProps[i]||(u.cssProps[i]=bc(j,i)),h=u.cssHooks[c]||u.cssHooks[i],d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];if(g=typeof d,"string"===g&&(f=Xb.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(u.css(a,c)),g="number"),!(null==d||"number"===g&&isNaN(d)||("number"!==g||u.cssNumber[i]||(d+="px"),u.support.clearCloneStyle||""!==d||0!==c.indexOf("background")||(j[c]="inherit"),h&&"set"in h&&(d=h.set(a,d,e))===b)))try{j[c]=d}catch(k){}}},css:function(a,c,d,e){var f,g,h,i=u.camelCase(c);return c=u.cssProps[i]||(u.cssProps[i]=bc(a.style,i)),h=u.cssHooks[c]||u.cssHooks[i],h&&"get"in h&&(g=h.get(a,!0,d)),g===b&&(g=Pb(a,c,e)),"normal"===g&&c in $b&&(g=$b[c]),""===d||d?(f=parseFloat(g),d===!0||u.isNumeric(f)?f||0:g):g}}),a.getComputedStyle?(Ob=function(b){return a.getComputedStyle(b,null)},Pb=function(a,c,d){var e,f,g,h=d||Ob(a),i=h?h.getPropertyValue(c)||h[c]:b,j=a.style;return h&&(""!==i||u.contains(a.ownerDocument,a)||(i=u.style(a,c)),Wb.test(i)&&Ub.test(c)&&(e=j.width,f=j.minWidth,g=j.maxWidth,j.minWidth=j.maxWidth=j.width=i,i=h.width,j.width=e,j.minWidth=f,j.maxWidth=g)),i}):g.documentElement.currentStyle&&(Ob=function(a){return a.currentStyle},Pb=function(a,c,d){var e,f,g,h=d||Ob(a),i=h?h[c]:b,j=a.style;return null==i&&j&&j[c]&&(i=j[c]),Wb.test(i)&&!Sb.test(c)&&(e=j.left,f=a.runtimeStyle,g=f&&f.left,g&&(f.left=a.currentStyle.left),j.left="fontSize"===c?"1em":i,i=j.pixelLeft+"px",j.left=e,g&&(f.left=g)),""===i?"auto":i}),u.each(["height","width"],function(a,b){u.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&Tb.test(u.css(a,"display"))?u.swap(a,Zb,function(){return gc(a,b,d)}):gc(a,b,d):void 0},set:function(a,c,d){var e=d&&Ob(a);return ec(a,c,d?fc(a,b,d,u.support.boxSizing&&"border-box"===u.css(a,"boxSizing",!1,e),e):0)}}}),u.support.opacity||(u.cssHooks.opacity={get:function(a,b){return Rb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=u.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===u.trim(f.replace(Qb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Qb.test(f)?f.replace(Qb,e):f+" "+e)}}),u(function(){u.support.reliableMarginRight||(u.cssHooks.marginRight={get:function(a,b){return b?u.swap(a,{display:"inline-block"},Pb,[a,"marginRight"]):void 0}}),!u.support.pixelPosition&&u.fn.position&&u.each(["top","left"],function(a,b){u.cssHooks[b]={get:function(a,c){return c?(c=Pb(a,b),Wb.test(c)?u(a).position()[b]+"px":c):void 0}}})}),u.expr&&u.expr.filters&&(u.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!u.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||u.css(a,"display"))},u.expr.filters.visible=function(a){return!u.expr.filters.hidden(a)}),u.each({margin:"",padding:"",border:"Width"},function(a,b){u.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+_b[d]+b]=f[d]||f[d-2]||f[0];return e}},Ub.test(a)||(u.cssHooks[a+b].set=ec)});var jc=/%20/g,kc=/\[\]$/,lc=/\r?\n/g,mc=/^(?:submit|button|image|reset|file)$/i,nc=/^(?:input|select|textarea|keygen)/i;u.fn.extend({serialize:function(){return u.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=u.prop(this,"elements");return a?u.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!u(this).is(":disabled")&&nc.test(this.nodeName)&&!mc.test(a)&&(this.checked||!xb.test(a))}).map(function(a,b){var c=u(this).val();return null==c?null:u.isArray(c)?u.map(c,function(a){return{name:b.name,value:a.replace(lc,"\r\n")}}):{name:b.name,value:c.replace(lc,"\r\n")}}).get()}}),u.param=function(a,c){var d,e=[],f=function(a,b){b=u.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=u.ajaxSettings&&u.ajaxSettings.traditional),u.isArray(a)||a.jquery&&!u.isPlainObject(a))u.each(a,function(){f(this.name,this.value)});else for(d in a)oc(d,a[d],c,f);return e.join("&").replace(jc,"+")},u.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){u.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),u.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var pc,qc,rc=u.now(),sc=/\?/,tc=/#.*$/,uc=/([?&])_=[^&]*/,vc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,wc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,xc=/^(?:GET|HEAD)$/,yc=/^\/\//,zc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ac=u.fn.load,Bc={},Cc={},Dc="*/".concat("*");try{qc=f.href}catch(Ec){qc=g.createElement("a"),qc.href="",qc=qc.href}pc=zc.exec(qc.toLowerCase())||[],u.fn.load=function(a,c,d){if("string"!=typeof a&&Ac)return Ac.apply(this,arguments);var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),u.isFunction(c)?(d=c,c=b):c&&"object"==typeof c&&(g="POST"),h.length>0&&u.ajax({url:a,type:g,dataType:"html",data:c}).done(function(a){f=arguments,h.html(e?u("<div>").append(u.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){h.each(d,f||[a.responseText,b,a])}),this},u.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){u.fn[b]=function(a){return this.on(b,a)}}),u.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:qc,type:"GET",isLocal:wc.test(pc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":u.parseJSON,"text xml":u.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Hc(Hc(a,u.ajaxSettings),b):Hc(u.ajaxSettings,a)},ajaxPrefilter:Fc(Bc),ajaxTransport:Fc(Cc),ajax:function(a,c){function z(a,c,d,e){var k,r,s,v,w,y=c;2!==t&&(t=2,h&&clearTimeout(h),j=b,g=e||"",x.readyState=a>0?4:0,k=a>=200&&300>a||304===a,d&&(v=Ic(l,x,d)),v=Jc(l,v,x,k),k?(l.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(u.lastModified[f]=w),w=x.getResponseHeader("etag"),w&&(u.etag[f]=w)),204===a||"HEAD"===l.type?y="nocontent":304===a?y="notmodified":(y=v.state,r=v.data,s=v.error,k=!s)):(s=y,(a||!y)&&(y="error",0>a&&(a=0))),x.status=a,x.statusText=(c||y)+"",k?o.resolveWith(m,[r,y,x]):o.rejectWith(m,[x,y,s]),x.statusCode(q),q=b,i&&n.trigger(k?"ajaxSuccess":"ajaxError",[x,l,k?r:s]),p.fireWith(m,[x,y]),i&&(n.trigger("ajaxComplete",[x,l]),--u.active||u.event.trigger("ajaxStop")))}"object"==typeof a&&(c=a,a=b),c=c||{};var d,e,f,g,h,i,j,k,l=u.ajaxSetup({},c),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?u(m):u.event,o=u.Deferred(),p=u.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,v="canceled",x={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!k)for(k={};b=vc.exec(g);)k[b[1].toLowerCase()]=b[2];b=k[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else x.always(a[x.status]);return this},abort:function(a){var b=a||v;return j&&j.abort(b),z(0,b),this}};if(o.promise(x).complete=p.add,x.success=x.done,x.error=x.fail,l.url=((a||l.url||qc)+"").replace(tc,"").replace(yc,pc[1]+"//"),l.type=c.method||c.type||l.method||l.type,l.dataTypes=u.trim(l.dataType||"*").toLowerCase().match(w)||[""],null==l.crossDomain&&(d=zc.exec(l.url.toLowerCase()),l.crossDomain=!(!d||d[1]===pc[1]&&d[2]===pc[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(pc[3]||("http:"===pc[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=u.param(l.data,l.traditional)),Gc(Bc,l,c,x),2===t)return x;i=l.global,i&&0===u.active++&&u.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!xc.test(l.type),f=l.url,l.hasContent||(l.data&&(f=l.url+=(sc.test(f)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=uc.test(f)?f.replace(uc,"$1_="+rc++):f+(sc.test(f)?"&":"?")+"_="+rc++)),l.ifModified&&(u.lastModified[f]&&x.setRequestHeader("If-Modified-Since",u.lastModified[f]),u.etag[f]&&x.setRequestHeader("If-None-Match",u.etag[f])),(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&x.setRequestHeader("Content-Type",l.contentType),x.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Dc+"; q=0.01":""):l.accepts["*"]);for(e in l.headers)x.setRequestHeader(e,l.headers[e]);if(l.beforeSend&&(l.beforeSend.call(m,x,l)===!1||2===t))return x.abort();v="abort";for(e in{success:1,error:1,complete:1})x[e](l[e]);if(j=Gc(Cc,l,c,x)){x.readyState=1,i&&n.trigger("ajaxSend",[x,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){x.abort("timeout")},l.timeout));try{t=1,j.send(r,z)}catch(y){if(!(2>t))throw y;z(-1,y)}}else z(-1,"No Transport");return x},getJSON:function(a,b,c){return u.get(a,b,c,"json")},getScript:function(a,c){return u.get(a,b,c,"script")}}),u.each(["get","post"],function(a,c){u[c]=function(a,d,e,f){return u.isFunction(d)&&(f=f||e,e=d,d=b),u.ajax({url:a,type:c,dataType:f,data:d,success:e})}}),u.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return u.globalEval(a),a}}}),u.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),u.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=g.head||u("head")[0]||g.documentElement;return{send:function(b,e){c=g.createElement("script"),c.async=!0,a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,b){(b||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),c=null,b||e(200,"success"))},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(b,!0)}}}});var Kc=[],Lc=/(=)\?(?=&|$)|\?\?/;u.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Kc.pop()||u.expando+"_"+rc++;return this[a]=!0,a}}),u.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.jsonp!==!1&&(Lc.test(c.url)?"url":"string"==typeof c.data&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Lc.test(c.data)&&"data");return i||"jsonp"===c.dataTypes[0]?(f=c.jsonpCallback=u.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,i?c[i]=c[i].replace(Lc,"$1"+f):c.jsonp!==!1&&(c.url+=(sc.test(c.url)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||u.error(f+" was not called"),h[0]},c.dataTypes[0]="json",g=a[f],a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,Kc.push(f)),h&&u.isFunction(g)&&g(h[0]),h=g=b}),"script"):void 0});var Mc,Nc,Oc=0,Pc=a.ActiveXObject&&function(){var a;for(a in Mc)Mc[a](b,!0)};u.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&Qc()||Rc()}:Qc,Nc=u.ajaxSettings.xhr(),u.support.cors=!!Nc&&"withCredentials"in Nc,Nc=u.support.ajax=!!Nc,Nc&&u.ajaxTransport(function(c){if(!c.crossDomain||u.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();if(c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async),c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),c.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l;try{if(d&&(e||4===i.readyState))if(d=b,g&&(i.onreadystatechange=u.noop,Pc&&delete Mc[g]),e)4!==i.readyState&&i.abort();else{l={},h=i.status,j=i.getAllResponseHeaders(),"string"==typeof i.responseText&&(l.text=i.responseText);try{k=i.statusText}catch(m){k=""}h||!c.isLocal||c.crossDomain?1223===h&&(h=204):h=l.text?200:404}}catch(n){e||f(-1,n)}l&&f(h,k,l,j)},c.async?4===i.readyState?setTimeout(d):(g=++Oc,Pc&&(Mc||(Mc={},u(a).unload(Pc)),Mc[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(b,!0)}}}});var Sc,Tc,Uc=/^(?:toggle|show|hide)$/,Vc=new RegExp("^(?:([+-])=|)("+v+")([a-z%]*)$","i"),Wc=/queueHooks$/,Xc=[bd],Yc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Vc.exec(b),f=e&&e[3]||(u.cssNumber[a]?"":"px"),g=(u.cssNumber[a]||"px"!==f&&+d)&&Vc.exec(u.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,u.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};u.Animation=u.extend(_c,{tweener:function(a,b){u.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Yc[c]=Yc[c]||[],Yc[c].unshift(b)},prefilter:function(a,b){b?Xc.unshift(a):Xc.push(a)}}),u.Tween=cd,cd.prototype={constructor:cd,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(u.cssNumber[c]?"":"px")},cur:function(){var a=cd.propHooks[this.prop];return a&&a.get?a.get(this):cd.propHooks._default.get(this)},run:function(a){var b,c=cd.propHooks[this.prop];return this.pos=b=this.options.duration?u.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):cd.propHooks._default.set(this),this}},cd.prototype.init.prototype=cd.prototype,cd.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=u.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){u.fx.step[a.prop]?u.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[u.cssProps[a.prop]]||u.cssHooks[a.prop])?u.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},cd.propHooks.scrollTop=cd.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},u.each(["toggle","show","hide"],function(a,b){var c=u.fn[b];u.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(dd(b,!0),a,d,e)}}),u.fn.extend({fadeTo:function(a,b,c,d){return this.filter(cc).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=u.isEmptyObject(a),f=u.speed(b,c,d),g=function(){var b=_c(this,u.extend({},a),f);(e||u._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=u.timers,g=u._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&Wc.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem!==this||null!=a&&f[c].queue!==a||(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&u.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=u._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=u.timers,g=d?d.length:0;for(c.finish=!0,u.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),u.each({slideDown:dd("show"),slideUp:dd("hide"),slideToggle:dd("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){u.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),u.speed=function(a,b,c){var d=a&&"object"==typeof a?u.extend({},a):{complete:c||!c&&b||u.isFunction(a)&&a,duration:a,easing:c&&b||b&&!u.isFunction(b)&&b};return d.duration=u.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in u.fx.speeds?u.fx.speeds[d.duration]:u.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){u.isFunction(d.old)&&d.old.call(this),d.queue&&u.dequeue(this,d.queue)},d},u.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},u.timers=[],u.fx=cd.prototype.init,u.fx.tick=function(){var a,c=u.timers,d=0;for(Sc=u.now();d<c.length;d++)a=c[d],a()||c[d]!==a||c.splice(d--,1);c.length||u.fx.stop(),Sc=b},u.fx.timer=function(a){a()&&u.timers.push(a)&&u.fx.start()},u.fx.interval=13,u.fx.start=function(){Tc||(Tc=setInterval(u.fx.tick,u.fx.interval))},u.fx.stop=function(){clearInterval(Tc),Tc=null},u.fx.speeds={slow:600,fast:200,_default:400},u.fx.step={},u.expr&&u.expr.filters&&(u.expr.filters.animated=function(a){return u.grep(u.timers,function(b){return a===b.elem}).length}),u.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){u.offset.setOffset(this,a,b)});var c,d,f={top:0,left:0},g=this[0],h=g&&g.ownerDocument;if(h)return c=h.documentElement,u.contains(c,g)?(typeof g.getBoundingClientRect!==e&&(f=g.getBoundingClientRect()),d=ed(h),{top:f.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0),left:f.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}):f},u.offset={setOffset:function(a,b,c){var d=u.css(a,"position");"static"===d&&(a.style.position="relative");var l,m,e=u(a),f=e.offset(),g=u.css(a,"top"),h=u.css(a,"left"),i=("absolute"===d||"fixed"===d)&&u.inArray("auto",[g,h])>-1,j={},k={};i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),u.isFunction(b)&&(b=b.call(a,c,f)),null!=b.top&&(j.top=b.top-f.top+l),null!=b.left&&(j.left=b.left-f.left+m),"using"in b?b.using.call(a,j):e.css(j)}},u.fn.extend({position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===u.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),u.nodeName(a[0],"html")||(c=a.offset()),c.top+=u.css(a[0],"borderTopWidth",!0),c.left+=u.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-u.css(d,"marginTop",!0),left:b.left-c.left-u.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||h;a&&!u.nodeName(a,"html")&&"static"===u.css(a,"position");)a=a.offsetParent;return a||h})}}),u.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);u.fn[a]=function(e){return u.access(this,function(a,e,f){var g=ed(a);return f===b?g?c in g?g[c]:g.document.documentElement[e]:a[e]:(g?g.scrollTo(d?u(g).scrollLeft():f,d?f:u(g).scrollTop()):a[e]=f,void 0)},a,e,arguments.length,null)}}),u.each({Height:"height",Width:"width"},function(a,c){u.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){u.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(e===!0||f===!0?"margin":"border");return u.access(this,function(c,d,e){var f;return u.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?u.css(c,d,h):u.style(c,d,e,h)},c,g?e:b,g,null)}})}),u.fn.size=function(){return this.length},u.fn.andSelf=u.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=u:(a.jQuery=a.$=u,"function"==typeof define&&define.amd&&define("jquery",[],function(){return u}))}(window);
}
if (!window.Backbone) {
  !function(){var g,a=this,b=a.Backbone,c=[],d=c.push,e=c.slice,f=c.splice;g="undefined"!=typeof exports?exports:a.Backbone={},g.VERSION="1.0.0";var h=a._;h||"undefined"==typeof require||(h=require("underscore")),g.$=a.jQuery||a.Zepto||a.ender||a.$,g.noConflict=function(){return a.Backbone=b,this},g.emulateHTTP=!1,g.emulateJSON=!1;var i=g.Events={on:function(a,b,c){if(!k(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,j=g.length;j>i;i++)if(a=g[i],f=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=f.length;m>l;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=e.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){for(var f=c.split(j),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=h.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(g,i);var n=g.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return h.clone(this.attributes)},sync:function(){return g.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),b.trigger("sync",b,d,a),void 0):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,!(!d||c&&c.wait||this.set(d,c)))return!1;if(c=h.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);return c.wait&&(b=h.extend(d||{},b)),h.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),i.trigger("sync",i,a,c),void 0)},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=g.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return g.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,e,g,j,k,l=b.at,m=this.comparator&&null==l&&b.sort!==!1,n=h.isString(this.comparator)?this.comparator:null,o=[],p=[],q={};for(c=0,e=a.length;e>c;c++)(g=this._prepareModel(a[c],b))&&((j=this.get(g))?(b.remove&&(q[j.cid]=!0),b.merge&&(j.set(g.attributes,b),m&&!k&&j.hasChanged(n)&&(k=!0))):b.add&&(o.push(g),g.on("all",this._onModelEvent,this),this._byId[g.cid]=g,null!=g.id&&(this._byId[g.id]=g)));if(b.remove){for(c=0,e=this.length;e>c;++c)q[(g=this.models[c]).cid]||p.push(g);p.length&&this.remove(p,b)}if(o.length&&(m&&(k=!0),this.length+=o.length,null!=l?f.apply(this.models,[l,0].concat(o)):d.apply(this.models,o)),k&&this.sort({silent:!0}),b.silent)return this;for(c=0,e=o.length;e>c;c++)(g=o[c]).trigger("add",g,this,b);return k&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=g.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof g.$?a:g.$(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(h.isFunction(c)||(c=this[a[b]]),c){var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var a=h.extend({},h.result(this,"attributes"));this.id&&(a.id=h.result(this,"id")),this.className&&(a["class"]=h.result(this,"className"));var b=g.$("<"+h.result(this,"tagName")+">").attr(a);this.setElement(b,!1)}}}),g.sync=function(a,b,c){var d=y[a];h.defaults(c||(c={}),{emulateHTTP:g.emulateHTTP,emulateJSON:g.emulateJSON});var e={type:d,dataType:"json"};if(c.url||(e.url=h.result(b,"url")||K()),null!=c.data||!b||"create"!==a&&"update"!==a&&"patch"!==a||(e.contentType="application/json",e.data=JSON.stringify(c.attrs||b.toJSON(c))),c.emulateJSON&&(e.contentType="application/x-www-form-urlencoded",e.data=e.data?{model:e.data}:{}),c.emulateHTTP&&("PUT"===d||"DELETE"===d||"PATCH"===d)){e.type="POST",c.emulateJSON&&(e.data._method=d);var f=c.beforeSend;c.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",d),f?f.apply(this,arguments):void 0}}"GET"===e.type||c.emulateJSON||(e.processData=!1),"PATCH"!==e.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(e.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=c.xhr=g.ajax(h.extend(e,c));return b.trigger("request",b,i,c),i};var y={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};g.ajax=function(){return g.$.ajax.apply(g.$,arguments)};var z=g.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(a,b,c){h.isRegExp(a)||(a=this._routeToRegExp(a)),h.isFunction(b)&&(c=b,b=""),c||(c=this[b]);var d=this;return g.history.route(a,function(e){var f=d._extractParameters(a,e);c&&c.apply(d,f),d.trigger.apply(d,["route:"+b].concat(f)),d.trigger("route",b,f),g.history.trigger("route",d,b,f)}),this},navigate:function(a,b){return g.history.navigate(a,b),this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=g.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(a){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var b=this.getFragment(),c=document.documentMode,d=H.exec(navigator.userAgent.toLowerCase())&&(!c||7>=c);this.root=("/"+this.root+"/").replace(G,"/"),d&&this._wantsHashChange&&(this.iframe=g.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?g.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!d?g.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b;var e=this.location,f=e.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!f?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&f&&e.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+e.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){g.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!E.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),g.history=new E;var J=function(a,b){var d,c=this;d=a&&h.has(a,"constructor")?a.constructor:function(){return c.apply(this,arguments)},h.extend(d,c,b);var e=function(){this.constructor=d};return e.prototype=c.prototype,d.prototype=new e,a&&h.extend(d.prototype,a),d.__super__=c.prototype,d};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this);
}
if (!window.Backbone.Marionette) {
  Backbone.ChildViewContainer=function(a,b){var c=function(a){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),b.each(a,this.add,this)};b.extend(c.prototype,{add:function(a,b){var c=a.cid;this._views[c]=a,a.model&&(this._indexByModel[a.model.cid]=c),b&&(this._indexByCustom[b]=c),this._updateLength()},findByModel:function(a){return this.findByModelCid(a.cid)},findByModelCid:function(a){var b=this._indexByModel[a];return this.findByCid(b)},findByCustom:function(a){var b=this._indexByCustom[a];return this.findByCid(b)},findByIndex:function(a){return b.values(this._views)[a]},findByCid:function(a){return this._views[a]},remove:function(a){var c=a.cid;a.model&&delete this._indexByModel[a.model.cid],b.any(this._indexByCustom,function(a,b){return a===c?(delete this._indexByCustom[b],!0):void 0},this),delete this._views[c],this._updateLength()},call:function(a){this.apply(a,b.tail(arguments))},apply:function(a,c){b.each(this._views,function(d){b.isFunction(d[a])&&d[a].apply(d,c||[])})},_updateLength:function(){this.length=b.size(this._views)}});var d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return b.each(d,function(a){c.prototype[a]=function(){var c=b.values(this._views),d=[c].concat(b.toArray(arguments));return b[a].apply(b,d)}}),c}(Backbone,_),Backbone.Wreqr=function(a,b,c){var d={};return d.Handlers=function(a,b){var c=function(a){this.options=a,this._wreqrHandlers={},b.isFunction(this.initialize)&&this.initialize(a)};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events,{setHandlers:function(a){b.each(a,function(a,c){var d=null;b.isObject(a)&&!b.isFunction(a)&&(d=a.context,a=a.callback),this.setHandler(c,a,d)},this)},setHandler:function(a,b,c){var d={callback:b,context:c};this._wreqrHandlers[a]=d,this.trigger("handler:add",a,b,c)},hasHandler:function(a){return!!this._wreqrHandlers[a]},getHandler:function(a){var b=this._wreqrHandlers[a];if(!b)throw new Error("Handler not found for '"+a+"'");return function(){var a=Array.prototype.slice.apply(arguments);return b.callback.apply(b.context,a)}},removeHandler:function(a){delete this._wreqrHandlers[a]},removeAllHandlers:function(){this._wreqrHandlers={}}}),c}(a,c),d.CommandStorage=function(){var b=function(a){this.options=a,this._commands={},c.isFunction(this.initialize)&&this.initialize(a)};return c.extend(b.prototype,a.Events,{getCommands:function(a){var b=this._commands[a];return b||(b={command:a,instances:[]},this._commands[a]=b),b},addCommand:function(a,b){var c=this.getCommands(a);c.instances.push(b)},clearCommands:function(a){var b=this.getCommands(a);b.instances=[]}}),b}(),d.Commands=function(a){return a.Handlers.extend({storageType:a.CommandStorage,constructor:function(b){this.options=b||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var c=Array.prototype.slice.call(arguments);a.Handlers.prototype.constructor.apply(this,c)},execute:function(a,b){a=arguments[0],b=Array.prototype.slice.call(arguments,1),this.hasHandler(a)?this.getHandler(a).apply(this,b):this.storage.addCommand(a,b)},_executeCommands:function(a,b,d){var e=this.storage.getCommands(a);c.each(e.instances,function(a){b.apply(d,a)}),this.storage.clearCommands(a)},_initializeStorage:function(a){var b,d=a.storageType||this.storageType;b=c.isFunction(d)?new d:d,this.storage=b}})}(d),d.RequestResponse=function(a){return a.Handlers.extend({request:function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);return this.getHandler(a).apply(this,b)}})}(d),d.EventAggregator=function(a,b){var c=function(){};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events),c}(a,c),d}(Backbone,Backbone.Marionette,_);var Marionette=function(a,b,c){function f(a){return e.call(a)}function g(a,b){var c=new Error(a);throw c.name=b||"Error",c}var d={};b.Marionette=d,d.$=b.$;var e=Array.prototype.slice;return d.extend=b.Model.extend,d.getOption=function(a,b){if(a&&b){var c;return c=a.options&&b in a.options&&void 0!==a.options[b]?a.options[b]:a[b]}},d.triggerMethod=function(){function b(a,b,c){return c.toUpperCase()}var a=/(^|:)(\w)/gi,d=function(d){var e="on"+d.replace(a,b),f=this[e];return c.isFunction(this.trigger)&&this.trigger.apply(this,arguments),c.isFunction(f)?f.apply(this,c.tail(arguments)):void 0};return d}(),d.MonitorDOMRefresh=function(){function a(a){a._isShown=!0,d(a)}function b(a){a._isRendered=!0,d(a)}function d(a){a._isShown&&a._isRendered&&c.isFunction(a.triggerMethod)&&a.triggerMethod("dom:refresh")}return function(c){c.listenTo(c,"show",function(){a(c)}),c.listenTo(c,"render",function(){b(c)})}}(),function(a){function b(a,b,d,e){var f=e.split(/\s+/);c.each(f,function(c){var e=a[c];e||g("Method '"+c+"' was configured as an event handler, but does not exist."),a.listenTo(b,d,e,a)})}function d(a,b,c,d){a.listenTo(b,c,d,a)}function e(a,b,d,e){var f=e.split(/\s+/);c.each(f,function(c){var e=a[c];a.stopListening(b,d,e,a)})}function f(a,b,c,d){a.stopListening(b,c,d,a)}function h(a,b,d,e,f){b&&d&&(c.isFunction(d)&&(d=d.call(a)),c.each(d,function(d,g){c.isFunction(d)?e(a,b,g,d):f(a,b,g,d)}))}a.bindEntityEvents=function(a,c,e){h(a,c,e,d,b)},a.unbindEntityEvents=function(a,b,c){h(a,b,c,f,e)}}(d),d.Callbacks=function(){this._deferred=d.$.Deferred(),this._callbacks=[]},c.extend(d.Callbacks.prototype,{add:function(a,b){this._callbacks.push({cb:a,ctx:b}),this._deferred.done(function(c,d){b&&(c=b),a.call(c,d)})},run:function(a,b){this._deferred.resolve(b,a)},reset:function(){var a=this._callbacks;this._deferred=d.$.Deferred(),this._callbacks=[],c.each(a,function(a){this.add(a.cb,a.ctx)},this)}}),d.Controller=function(a){this.triggerMethod=d.triggerMethod,this.options=a||{},c.isFunction(this.initialize)&&this.initialize(this.options)},d.Controller.extend=d.extend,c.extend(d.Controller.prototype,b.Events,{close:function(){this.stopListening(),this.triggerMethod("close"),this.unbind()}}),d.Region=function(a){if(this.options=a||{},this.el=d.getOption(this,"el"),!this.el){var b=new Error("An 'el' must be specified for a region.");throw b.name="NoElError",b}if(this.initialize){var c=Array.prototype.slice.apply(arguments);this.initialize.apply(this,c)}},c.extend(d.Region,{buildRegion:function(a,b){var d="string"==typeof a,e="string"==typeof a.selector,f="undefined"==typeof a.regionType,g="function"==typeof a;if(!g&&!d&&!e)throw new Error("Region must be specified as a Region type, a selector string or an object with selector property");var h,i;d&&(h=a),a.selector&&(h=a.selector),g&&(i=a),!g&&f&&(i=b),a.regionType&&(i=a.regionType);var j=new i({el:h});return a.parentEl&&(j.getEl=function(b){var d=a.parentEl;return c.isFunction(d)&&(d=d()),d.find(b)}),j}}),c.extend(d.Region.prototype,b.Events,{show:function(a){this.ensureEl();var b=a.isClosed||c.isUndefined(a.$el),e=a!==this.currentView;e&&this.close(),a.render(),(e||b)&&this.open(a),this.currentView=a,d.triggerMethod.call(this,"show",a),d.triggerMethod.call(a,"show")},ensureEl:function(){this.$el&&0!==this.$el.length||(this.$el=this.getEl(this.el))},getEl:function(a){return d.$(a)},open:function(a){this.$el.empty().append(a.el)},close:function(){var a=this.currentView;a&&!a.isClosed&&(a.close?a.close():a.remove&&a.remove(),d.triggerMethod.call(this,"close"),delete this.currentView)},attachView:function(a){this.currentView=a},reset:function(){this.close(),delete this.$el}}),d.Region.extend=d.extend,d.RegionManager=function(a){var b=a.Controller.extend({constructor:function(b){this._regions={},a.Controller.prototype.constructor.call(this,b)},addRegions:function(a,b){var d={};return c.each(a,function(a,e){"string"==typeof a&&(a={selector:a}),a.selector&&(a=c.defaults({},a,b));var f=this.addRegion(e,a);d[e]=f},this),d},addRegion:function(b,d){var e,f=c.isObject(d),g=c.isString(d),h=!!d.selector;return e=g||f&&h?a.Region.buildRegion(d,a.Region):c.isFunction(d)?a.Region.buildRegion(d,a.Region):d,this._store(b,e),this.triggerMethod("region:add",b,e),e},get:function(a){return this._regions[a]},removeRegion:function(a){var b=this._regions[a];this._remove(a,b)},removeRegions:function(){c.each(this._regions,function(a,b){this._remove(b,a)},this)},closeRegions:function(){c.each(this._regions,function(a){a.close()},this)},close:function(){this.removeRegions();var b=Array.prototype.slice.call(arguments);a.Controller.prototype.close.apply(this,b)},_store:function(a,b){this._regions[a]=b,this._setLength()},_remove:function(a,b){b.close(),delete this._regions[a],this._setLength(),this.triggerMethod("region:remove",a,b)},_setLength:function(){this.length=c.size(this._regions)}}),d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return c.each(d,function(a){b.prototype[a]=function(){var b=c.values(this._regions),d=[b].concat(c.toArray(arguments));return c[a].apply(c,d)}}),b}(d),d.TemplateCache=function(a){this.templateId=a},c.extend(d.TemplateCache,{templateCaches:{},get:function(a){var b=this.templateCaches[a];return b||(b=new d.TemplateCache(a),this.templateCaches[a]=b),b.load()},clear:function(){var a,b=f(arguments),c=b.length;if(c>0)for(a=0;c>a;a++)delete this.templateCaches[b[a]];else this.templateCaches={}}}),c.extend(d.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var a=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(a),this.compiledTemplate},loadTemplate:function(a){var b=d.$(a).html();return b&&0!==b.length||g("Could not find template: '"+a+"'","NoTemplateError"),b},compileTemplate:function(a){return c.template(a)}}),d.Renderer={render:function(a,b){if(!a){var c=new Error("Cannot render the template since it's false, null or undefined.");throw c.name="TemplateNotFoundError",c}var e;return e="function"==typeof a?a:d.TemplateCache.get(a),e(b)}},d.View=b.View.extend({constructor:function(){c.bindAll(this,"render");var a=Array.prototype.slice.apply(arguments);b.View.prototype.constructor.apply(this,a),d.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled,this)},triggerMethod:d.triggerMethod,getTemplate:function(){return d.getOption(this,"template")},mixinTemplateHelpers:function(a){a=a||{};var b=d.getOption(this,"templateHelpers");return c.isFunction(b)&&(b=b.call(this)),c.extend(a,b)},configureTriggers:function(){if(this.triggers){var a={},b=c.result(this,"triggers");return c.each(b,function(b,c){a[c]=function(a){a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation();var c={view:this,model:this.model,collection:this.collection};this.triggerMethod(b,c)}},this),a}},delegateEvents:function(a){this._delegateDOMEvents(a),d.bindEntityEvents(this,this.model,d.getOption(this,"modelEvents")),d.bindEntityEvents(this,this.collection,d.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(a){a=a||this.events,c.isFunction(a)&&(a=a.call(this));var d={},e=this.configureTriggers();c.extend(d,a,e),b.View.prototype.delegateEvents.call(this,d)},undelegateEvents:function(){var a=Array.prototype.slice.call(arguments);b.View.prototype.undelegateEvents.apply(this,a),d.unbindEntityEvents(this,this.model,d.getOption(this,"modelEvents")),d.unbindEntityEvents(this,this.collection,d.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(!this.isClosed){var a=this.triggerMethod("before:close");a!==!1&&(this.isClosed=!0,this.triggerMethod("close"),this.unbindUIElements(),this.remove())}},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var a=c.result(this,"_uiBindings");this.ui={},c.each(c.keys(a),function(b){var c=a[b];this.ui[b]=this.$(c)},this)}},unbindUIElements:function(){this.ui&&this._uiBindings&&(c.each(this.ui,function(a,b){delete this.ui[b]},this),this.ui=this._uiBindings,delete this._uiBindings)}}),d.ItemView=d.View.extend({constructor:function(){d.View.prototype.constructor.apply(this,f(arguments))},serializeData:function(){var a={};return this.model?a=this.model.toJSON():this.collection&&(a={items:this.collection.toJSON()}),a},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var a=this.serializeData();a=this.mixinTemplateHelpers(a);var b=this.getTemplate(),c=d.Renderer.render(b,a);return this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){this.isClosed||(this.triggerMethod("item:before:close"),d.View.prototype.close.apply(this,f(arguments)),this.triggerMethod("item:closed"))}}),d.CollectionView=d.View.extend({itemViewEventPrefix:"itemview",constructor:function(){this._initChildViewStorage(),d.View.prototype.constructor.apply(this,f(arguments)),this._initialEvents()},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this.render,this))},addChildView:function(a){this.closeEmptyView();var d=this.getItemView(a),e=this.collection.indexOf(a);this.addItemView(a,d,e)},onShowCalled:function(){this.children.each(function(a){d.triggerMethod.call(a,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.closeEmptyView(),this.closeChildren(),this.collection&&this.collection.length>0?this.showCollection():this.showEmptyView()},showCollection:function(){var a;this.collection.each(function(b,c){a=this.getItemView(b),this.addItemView(b,a,c)},this)},showEmptyView:function(){var a=d.getOption(this,"emptyView");if(a&&!this._showingEmptyView){this._showingEmptyView=!0;var c=new b.Model;this.addItemView(c,a,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getItemView:function(){var b=d.getOption(this,"itemView");return b||g("An `itemView` must be specified","NoItemViewError"),b},addItemView:function(a,b,e){var f=d.getOption(this,"itemViewOptions");c.isFunction(f)&&(f=f.call(this,a,e));var g=this.buildItemView(a,b,f);this.addChildViewEventForwarding(g),this.triggerMethod("before:item:added",g),this.children.add(g),this.renderItemView(g,e),this._isShown&&d.triggerMethod.call(g,"show"),this.triggerMethod("after:item:added",g)},addChildViewEventForwarding:function(a){var b=d.getOption(this,"itemViewEventPrefix");this.listenTo(a,"all",function(){var c=f(arguments);c[0]=b+":"+c[0],c.splice(1,0,a),d.triggerMethod.apply(this,c)},this)},renderItemView:function(a,b){a.render(),this.appendHtml(this,a,b)},buildItemView:function(a,b,d){var e=c.extend({model:a},d);return new b(e)},removeItemView:function(a){var b=this.children.findByModel(a);this.removeChildView(b),this.checkEmpty()},removeChildView:function(a){a&&(this.stopListening(a),a.close?a.close():a.remove&&a.remove(),this.children.remove(a)),this.triggerMethod("item:removed",a)},checkEmpty:function(){this.collection&&0!==this.collection.length||this.showEmptyView()},appendHtml:function(a,b){a.$el.append(b.el)},_initChildViewStorage:function(){this.children=new b.ChildViewContainer},close:function(){this.isClosed||(this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),d.View.prototype.close.apply(this,f(arguments)))},closeChildren:function(){this.children.each(function(a){this.removeChildView(a)},this),this.checkEmpty()}}),d.CompositeView=d.CollectionView.extend({constructor:function(){d.CollectionView.prototype.constructor.apply(this,f(arguments))},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this._renderChildren,this))},getItemView:function(){var b=d.getOption(this,"itemView")||this.constructor;return b||g("An `itemView` must be specified","NoItemViewError"),b},serializeData:function(){var a={};return this.model&&(a=this.model.toJSON()),a},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var a=this.renderModel();return this.$el.html(a),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(d.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var a={};a=this.serializeData(),a=this.mixinTemplateHelpers(a);var b=this.getTemplate();return d.Renderer.render(b,a)},appendHtml:function(a,b){var d=this.getItemViewContainer(a);d.append(b.el)},getItemViewContainer:function(a){if("$itemViewContainer"in a)return a.$itemViewContainer;var b,e=d.getOption(a,"itemViewContainer");if(e){var f=c.isFunction(e)?e():e;b=a.$(f),b.length<=0&&g("The specified `itemViewContainer` was not found: "+a.itemViewContainer,"ItemViewContainerMissingError")}else b=a.$el;return a.$itemViewContainer=b,b},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),d.Layout=d.ItemView.extend({regionType:d.Region,constructor:function(a){a=a||{},this._firstRender=!0,this._initializeRegions(a),d.ItemView.prototype.constructor.call(this,a)},render:function(){this.isClosed&&this._initializeRegions(),this._firstRender?this._firstRender=!1:this.isClosed||this._reInitializeRegions();var a=Array.prototype.slice.apply(arguments),b=d.ItemView.prototype.render.apply(this,a);return b},close:function(){if(!this.isClosed){this.regionManager.close();var a=Array.prototype.slice.apply(arguments);d.ItemView.prototype.close.apply(this,a)}},addRegion:function(a,b){var c={};return c[a]=b,this._buildRegions(c)[a]},addRegions:function(a){return this.regions=c.extend({},this.regions,a),this._buildRegions(a)},removeRegion:function(a){return delete this.regions[a],this.regionManager.removeRegion(a)},_buildRegions:function(a){var b=this,c={regionType:d.getOption(this,"regionType"),parentEl:function(){return b.$el}};return this.regionManager.addRegions(a,c)},_initializeRegions:function(a){var b;this._initRegionManager(),b=c.isFunction(this.regions)?this.regions(a):this.regions||{},this.addRegions(b)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(a){a.reset()})},_initRegionManager:function(){this.regionManager=new d.RegionManager,this.listenTo(this.regionManager,"region:add",function(a,b){this[a]=b,this.trigger("region:add",a,b)}),this.listenTo(this.regionManager,"region:remove",function(a,b){delete this[a],this.trigger("region:remove",a,b)})}}),d.AppRouter=b.Router.extend({constructor:function(a){b.Router.prototype.constructor.apply(this,f(arguments)),this.options=a||{};var c=d.getOption(this,"appRoutes"),e=this._getController();this.processAppRoutes(e,c)},appRoute:function(a,b){var c=this._getController();this._addAppRoute(c,a,b)},processAppRoutes:function(a,b){if(b){var d=c.keys(b).reverse();c.each(d,function(c){this._addAppRoute(a,c,b[c])},this)}},_getController:function(){return d.getOption(this,"controller")},_addAppRoute:function(a,b,d){var e=a[d];if(!e)throw new Error("Method '"+d+"' was not found on the controller");this.route(b,d,c.bind(e,a))}}),d.Application=function(a){this._initRegionManager(),this._initCallbacks=new d.Callbacks,this.vent=new b.Wreqr.EventAggregator,this.commands=new b.Wreqr.Commands,this.reqres=new b.Wreqr.RequestResponse,this.submodules={},c.extend(this,a),this.triggerMethod=d.triggerMethod},c.extend(d.Application.prototype,b.Events,{execute:function(){var a=Array.prototype.slice.apply(arguments);this.commands.execute.apply(this.commands,a)},request:function(){var a=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,a)},addInitializer:function(a){this._initCallbacks.add(a)},start:function(a){this.triggerMethod("initialize:before",a),this._initCallbacks.run(a,this),this.triggerMethod("initialize:after",a),this.triggerMethod("start",a)},addRegions:function(a){return this._regionManager.addRegions(a)},closeRegions:function(){this._regionManager.closeRegions()},removeRegion:function(a){this._regionManager.removeRegion(a)},getRegion:function(a){return this._regionManager.get(a)},module:function(){var c=f(arguments);return c.unshift(this),d.Module.create.apply(d.Module,c)},_initRegionManager:function(){this._regionManager=new d.RegionManager,this.listenTo(this._regionManager,"region:add",function(a,b){this[a]=b}),this.listenTo(this._regionManager,"region:remove",function(a){delete this[a]})}}),d.Application.extend=d.extend,d.Module=function(a,b){this.moduleName=a,this.submodules={},this._setupInitializersAndFinalizers(),this.app=b,this.startWithParent=!0,this.triggerMethod=d.triggerMethod},c.extend(d.Module.prototype,b.Events,{addInitializer:function(a){this._initializerCallbacks.add(a)},addFinalizer:function(a){this._finalizerCallbacks.add(a)},start:function(a){this._isInitialized||(c.each(this.submodules,function(b){b.startWithParent&&b.start(a)}),this.triggerMethod("before:start",a),this._initializerCallbacks.run(a,this),this._isInitialized=!0,this.triggerMethod("start",a))},stop:function(){this._isInitialized&&(this._isInitialized=!1,d.triggerMethod.call(this,"before:stop"),c.each(this.submodules,function(a){a.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),d.triggerMethod.call(this,"stop"))},addDefinition:function(a,b){this._runModuleDefinition(a,b)},_runModuleDefinition:function(a,e){if(a){var f=c.flatten([this,this.app,b,d,d.$,c,e]);a.apply(this,f)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new d.Callbacks,this._finalizerCallbacks=new d.Callbacks}}),c.extend(d.Module,{create:function(a,b,d){var e=a,g=f(arguments);g.splice(0,3),b=b.split(".");var h=b.length,i=[];return i[h-1]=d,c.each(b,function(b,c){var d=e;e=this._getModule(d,b,a),this._addModuleDefinition(d,e,i[c],g)},this),e},_getModule:function(a,b,c){var g=a[b];return g||(g=new d.Module(b,c),a[b]=g,a.submodules[b]=g),g},_addModuleDefinition:function(a,b,d,e){var f,g;c.isFunction(d)?(f=d,g=!0):c.isObject(d)?(f=d.define,g=d.startWithParent):g=!0,f&&b.addDefinition(f,e),b.startWithParent=b.startWithParent&&g,b.startWithParent&&!b.startWithParentIsConfigured&&(b.startWithParentIsConfigured=!0,a.addInitializer(function(a){b.startWithParent&&b.start(a)}))}}),d}(this,Backbone,_);
}
if (!window.Processing) {
  !function(a,b,c,d){function i(b,c){return b in a?a[b]:"function"==typeof a[c]?a[c]:function(a){if(a instanceof Array)return a;if("number"==typeof a){var b=[];return b.length=a,b}}}function o(a){if("string"==typeof a){for(var b=0,e=0;e<a.length;++e)b=4294967295&31*b+a.charCodeAt(e);return b}return"object"!=typeof a?4294967295&a:a.hashCode instanceof Function?a.hashCode():(a.$id===d&&(a.$id=c.floor(65536*c.random())-32768<<16|c.floor(65536*c.random())),a.$id)}function p(a,b){return null===a||null===b?null===a&&null===b:"string"==typeof a?a===b:"object"!=typeof a?a===b:a.equals instanceof Function?a.equals(b):a===b}function u(){}function w(a,b,c){if(!a.hasOwnProperty(b)||"function"!=typeof a[b])return a[b]=c,void 0;var d=a[b];if("$overloads"in d)return d.$defaultOverload=c,void 0;if("$overloads"in c||d.length!==c.length){var e,f;"$overloads"in c?(e=c.$overloads.slice(0),e[d.length]=d,f=c.$defaultOverload):(e=[],e[c.length]=c,e[d.length]=d,f=d);var g=function(){var a=g.$overloads[arguments.length]||("$methodArgsIndex"in g&&arguments.length>g.$methodArgsIndex?g.$overloads[g.$methodArgsIndex]:null)||g.$defaultOverload;return a.apply(this,arguments)};g.$overloads=e,"$methodArgsIndex"in c&&(g.$methodArgsIndex=c.$methodArgsIndex),g.$defaultOverload=f,g.name=b,a[b]=g}}function x(a,b){function c(c){v.defineProperty(a,c,{get:function(){return b[c]},set:function(a){b[c]=a},enumerable:!0})}var d=[];for(var e in b)"function"==typeof b[e]?w(a,e,b[e]):"$"===e.charAt(0)||e in a||d.push(e);for(;d.length>0;)c(d.shift());a.$super=b}function y(a){return"string"!=typeof a?!1:-1!==["byte","int","char","color","float","long","double"].indexOf(a)}function E(a){var d=250,f=a.size/d,g=b.createElement("canvas");g.width=2*d,g.height=2*d,g.style.opacity=0;var h=a.getCSSDefinition(d+"px","normal"),i=g.getContext("2d");i.font=h;var j="dbflkhyjqpg";g.width=i.measureText(j).width,i.font=h;var k=b.createElement("div");k.style.position="absolute",k.style.opacity=0,k.style.fontFamily='"'+a.name+'"',k.style.fontSize=d+"px",k.innerHTML=j+"<br/>"+j,b.body.appendChild(k);var l=g.width,m=g.height,n=m/2;i.fillStyle="white",i.fillRect(0,0,l,m),i.fillStyle="black",i.fillText(j,0,n);for(var o=i.getImageData(0,0,l,m).data,p=0,q=4*l,r=o.length;++p<r&&255===o[p];)e();var s=c.round(p/q);for(p=r-1;--p>0&&255===o[p];)e();var t=c.round(p/q);if(a.ascent=f*(n-s),a.descent=f*(t-n),b.defaultView.getComputedStyle){var u=b.defaultView.getComputedStyle(k,null).getPropertyValue("height");u=f*u.replace("px",""),u>=2*a.size&&(a.leading=c.round(u/2))}return b.body.removeChild(k),a.caching?i:void 0}function F(a,b){a===d&&(a=""),this.name=a,b===d&&(b=0),this.size=b,this.glyph=!1,this.ascent=0,this.descent=0,this.leading=1.2*b;var c=a.indexOf(" Italic Bold");-1!==c&&(a=a.substring(0,c)),this.style="normal";var e=a.indexOf(" Italic");-1!==e&&(a=a.substring(0,e),this.style="italic"),this.weight="normal";var f=a.indexOf(" Bold");if(-1!==f&&(a=a.substring(0,f),this.weight="bold"),this.family="sans-serif",a!==d)switch(a){case"sans-serif":case"serif":case"monospace":case"fantasy":case"cursive":this.family=a;break;default:this.family='"'+a+'", sans-serif'}this.context2d=E(this),this.css=this.getCSSDefinition(),this.context2d&&(this.context2d.font=this.css)}function H(){var c,d,a=["abs","acos","alpha","ambient","ambientLight","append","applyMatrix","arc","arrayCopy","asin","atan","atan2","background","beginCamera","beginDraw","beginShape","bezier","bezierDetail","bezierPoint","bezierTangent","bezierVertex","binary","blend","blendColor","blit_resize","blue","box","breakShape","brightness","camera","ceil","Character","color","colorMode","concat","constrain","copy","cos","createFont","createGraphics","createImage","cursor","curve","curveDetail","curvePoint","curveTangent","curveTightness","curveVertex","day","degrees","directionalLight","disableContextMenu","dist","draw","ellipse","ellipseMode","emissive","enableContextMenu","endCamera","endDraw","endShape","exit","exp","expand","externals","fill","filter","floor","focused","frameCount","frameRate","frustum","get","glyphLook","glyphTable","green","height","hex","hint","hour","hue","image","imageMode","intersect","join","key","keyCode","keyPressed","keyReleased","keyTyped","lerp","lerpColor","lightFalloff","lights","lightSpecular","line","link","loadBytes","loadFont","loadGlyphs","loadImage","loadPixels","loadShape","loadXML","loadStrings","log","loop","mag","map","match","matchAll","max","millis","min","minute","mix","modelX","modelY","modelZ","modes","month","mouseButton","mouseClicked","mouseDragged","mouseMoved","mouseOut","mouseOver","mousePressed","mouseReleased","mouseScroll","mouseScrolled","mouseX","mouseY","name","nf","nfc","nfp","nfs","noCursor","noFill","noise","noiseDetail","noiseSeed","noLights","noLoop","norm","normal","noSmooth","noStroke","noTint","ortho","param","parseBoolean","parseByte","parseChar","parseFloat","parseInt","peg","perspective","PImage","pixels","PMatrix2D","PMatrix3D","PMatrixStack","pmouseX","pmouseY","point","pointLight","popMatrix","popStyle","pow","print","printCamera","println","printMatrix","printProjection","PShape","PShapeSVG","pushMatrix","pushStyle","quad","radians","random","Random","randomSeed","rect","rectMode","red","redraw","requestImage","resetMatrix","reverse","rotate","rotateX","rotateY","rotateZ","round","saturation","save","saveFrame","saveStrings","scale","screenX","screenY","screenZ","second","set","setup","shape","shapeMode","shared","shearX","shearY","shininess","shorten","sin","size","smooth","sort","specular","sphere","sphereDetail","splice","split","splitTokens","spotLight","sq","sqrt","status","str","stroke","strokeCap","strokeJoin","strokeWeight","subset","tan","text","textAlign","textAscent","textDescent","textFont","textLeading","textMode","textSize","texture","textureMode","textWidth","tint","toImageData","touchCancel","touchEnd","touchMove","touchStart","translate","transform","triangle","trim","unbinary","unhex","updatePixels","use3DContext","vertex","width","XMLElement","XML","year","__contains","__equals","__equalsIgnoreCase","__frameRate","__hashCode","__int_cast","__instanceof","__keyPressed","__mousePressed","__printStackTrace","__replace","__replaceAll","__replaceFirst","__toCharArray","__split","__codePointAt","__startsWith","__endsWith","__matches"],b={};for(c=0,d=a.length;d>c;++c)b[a[c]]=null;for(var e in G.lib)if(G.lib.hasOwnProperty(e)&&G.lib[e].exports){var f=G.lib[e].exports;for(c=0,d=f.length;d>c;++c)b[f[c]]=null}return b}function I(a){function c(a){for(var b=[],c=a.split(/([\{\[\(\)\]\}])/),d=c[0],e=[],f=1;f<c.length;f+=2){var g=c[f];if("["===g||"{"===g||"("===g)e.push(d),d=g;else if("]"===g||"}"===g||")"===g){var h="}"===g?"A":")"===g?"B":"C",i=b.length;b.push(d+g),d=e.pop()+'"'+h+(i+1)+'"'}d+=c[f+1]}return b.unshift(d),b}function e(a,b){return a.replace(/'(\d+)'/g,function(a,c){var d=b[c];return"/"===d.charAt(0)?d:/^'((?:[^'\\\n])|(?:\\.[0-9A-Fa-f]*))'$/.test(d)?"(new $p.Character("+d+"))":d})}function f(a){var c,b=/^\s*/.exec(a);if(b[0].length===a.length)c={left:b[0],middle:"",right:""};else{var d=/\s*$/.exec(a);c={left:b[0],middle:a.substring(b[0].length,d.index),right:d[0]}}return c.untrim=function(a){return this.left+a+this.right},c}function g(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}function h(a,b){for(var c=0,d=b.length;d>c;++c)a[b[c]]=null;return a}function i(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function j(a){return a.substring(2,a.length-1)}function x(a,b){var c=r.length;return r.push(a),'"'+b+c+'"'}function y(){return"class"+ ++w}function z(a,b,c){a.classId=b,a.scopeId=c,t[b]=a}function N(a){var b=a;return b=b.replace(G,function(a){return x(a,"E")}),b=b.replace(I,function(a){return x(a,"D")}),b=b.replace(M,function(a){return x(a,"H")})}function O(a,b){var c=a.replace(K,function(a,c,d){return d!==b?a:x(a,"G")});return c}function P(a){this.name=a}function Q(a,b){this.params=a,this.methodArgsParam=b}function R(a){var b=g(a.substring(1,a.length-1)),c=[],d=null;if(""!==b)for(var e=b.split(","),f=0;f<e.length;++f){var h=/\b([A-Za-z_$][\w$]*\b)(\s*"[ABC][\d]*")*\s*$/.exec(e[f]);if(f===e.length-1&&e[f].indexOf("...")>=0){d=new P(h[1]);break}c.push(new P(h[1]))}return new Q(c,d)}function S(a){function d(a,b,d,e){var g=r[e];c=!0;var h=f(g.substring(1,g.length-1));return"__"+d+(""===h.middle?x("("+b.replace(/\.\s*$/,"")+")","B"):x("("+b.replace(/\.\s*$/,"")+","+h.middle+")","B"))}function e(a,b,d){return c=!0,"__instanceof"+x("("+b+", "+d+")","B")}var b=a;b=b.replace(/\bnew\s+([A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)(?:\s*"C\d+")+\s*("A\d+")/g,function(a,b,c){return c}),b=b.replace(/\bnew\s+([A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)(?:\s*"B\d+")\s*("A\d+")/g,function(a){return x(a,"F")}),b=b.replace(M,function(a){return x(a,"H")}),b=b.replace(/\bnew\s+([A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)\s*("C\d+"(?:\s*"C\d+")*)/g,function(a,b,c){var d=c.replace(/"C(\d+)"/g,function(a,b){return r[b]}).replace(/\[\s*\]/g,"[null]").replace(/\s*\]\s*\[\s*/g,", "),e="{"+d.substring(1,d.length-1)+"}",f="('"+b+"', "+x(e,"A")+")";return"$p.createJavaArray"+x(f,"B")}),b=b.replace(/(\.\s*length)\s*"B\d+"/g,"$1"),b=b.replace(/#([0-9A-Fa-f]{6})\b/g,function(a,b){return"0xFF"+b}),b=b.replace(/"B(\d+)"(\s*(?:[\w$']|"B))/g,function(a,b,c){var d=r[b];if(!/^\(\s*[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*\s*(?:"C\d+"\s*)*\)$/.test(d))return a;if(/^\(\s*int\s*\)$/.test(d))return"(int)"+c;var e=d.split(/"C(\d+)"/g);return e.length>1&&!/^\[\s*\]$/.test(r[e[1]])?a:""+c}),b=b.replace(/\(int\)([^,\]\)\}\?\:\*\+\-\/\^\|\%\&\~<\>\=]+)/g,function(a,b){var c=f(b);return c.untrim("__int_cast("+c.middle+")")}),b=b.replace(/\bsuper(\s*"B\d+")/g,"$$superCstr$1").replace(/\bsuper(\s*\.)/g,"$$super$1"),b=b.replace(/\b0+((\d*)(?:\.[\d*])?(?:[eE][\-\+]?\d+)?[fF]?)\b/,function(a,b,c){return b===c?a:""===c?"0"+b:b}),b=b.replace(/\b(\.?\d+\.?)[fF]\b/g,"$1"),b=b.replace(/([^\s])%([^=\s])/g,"$1 % $2"),b=b.replace(/\b(frameRate|keyPressed|mousePressed)\b(?!\s*"B)/g,"__$1"),b=b.replace(/\b(boolean|byte|char|float|int)\s*"B/g,function(a,b){return"parse"+b.substring(0,1).toUpperCase()+b.substring(1)+'"B'}),b=b.replace(/\bpixels\b\s*(("C(\d+)")|\.length)?(\s*=(?!=)([^,\]\)\}]+))?/g,function(a,b,c,d,e,f){if(c){var g=r[d];return e?"pixels.setPixel"+x("("+g.substring(1,g.length-1)+","+f+")","B"):"pixels.getPixel"+x("("+g.substring(1,g.length-1)+")","B")}return b?"pixels.getLength"+x("()","B"):e?"pixels.set"+x("("+f+")","B"):"pixels.toArray"+x("()","B")});var c;do c=!1,b=b.replace(/((?:'\d+'|\b[A-Za-z_$][\w$]*\s*(?:"[BC]\d+")*)\s*\.\s*(?:[A-Za-z_$][\w$]*\s*(?:"[BC]\d+"\s*)*\.\s*)*)(replace|replaceAll|replaceFirst|contains|equals|equalsIgnoreCase|hashCode|toCharArray|printStackTrace|split|startsWith|endsWith|codePointAt|matches)\s*"B(\d+)"/g,d);while(c);do c=!1,b=b.replace(/((?:'\d+'|\b[A-Za-z_$][\w$]*\s*(?:"[BC]\d+")*)\s*(?:\.\s*[A-Za-z_$][\w$]*\s*(?:"[BC]\d+"\s*)*)*)instanceof\s+([A-Za-z_$][\w$]*\s*(?:\.\s*[A-Za-z_$][\w$]*)*)/g,e);while(c);return b=b.replace(/\bthis(\s*"B\d+")/g,"$$constr$1")}function T(a,b){this.baseInterfaceName=a,this.body=b,b.owner=this}function U(a){var b=new RegExp(/\bnew\s*([A-Za-z_$][\w$]*\s*(?:\.\s*[A-Za-z_$][\w$]*)*)\s*"B\d+"\s*"A(\d+)"/).exec(a),c=u,d=y();u=d;var e=b[1]+"$"+d,f=new T(e,A(r[b[2]],e,"","implements "+b[1]));return z(f,d,c),u=c,f}function V(a,b,c){this.name=a,this.params=b,this.body=c}function W(a){var b=new RegExp(/\b([A-Za-z_$][\w$]*)\s*"B(\d+)"\s*"A(\d+)"/).exec(a);return new V("function"!==b[1]?b[1]:null,R(r[b[2]]),C(r[b[3]]))}function X(a){this.members=a}function Y(a){for(var b=a.split(","),c=0;c<b.length;++c){var d=b[c].indexOf(":");b[c]=0>d?{value:F(b[c])}:{label:g(b[c].substring(0,d)),value:F(g(b[c].substring(d+1)))}}return new X(b)}function Z(a){if("("===a.charAt(0)||"["===a.charAt(0))return a.charAt(0)+Z(a.substring(1,a.length-1))+a.charAt(a.length-1);if("{"===a.charAt(0))return/^\{\s*(?:[A-Za-z_$][\w$]*|'\d+')\s*:/.test(a)?"{"+x(a.substring(1,a.length-1),"I")+"}":"["+Z(a.substring(1,a.length-1))+"]";var b=f(a),c=S(b.middle);return c=c.replace(/"[ABC](\d+)"/g,function(a,b){return Z(r[b])}),b.untrim(c)}function $(a){return a.replace(/(\.\s*)?((?:\b[A-Za-z_]|\$)[\w$]*)(\s*\.\s*([A-Za-z_$][\w$]*)(\s*\()?)?/g,function(a,b,c,e,f,g){if(b)return a;var h={name:c,member:f,callSign:!!g};return s(h)+(e===d?"":e)})}function _(a,b){this.expr=a,this.transforms=b}function ab(a,b,c){this.name=a,this.value=b,this.isDefault=c}function bb(a,b){var d,e,f,c=a.indexOf("=");return 0>c?(d=a,e=b,f=!0):(d=a.substring(0,c),e=F(a.substring(c+1)),f=!1),new ab(g(d.replace(/(\s*"C\d+")+/g,"")),e,f)}function cb(a){return"int"===a||"float"===a?"0":"boolean"===a?"false":"color"===a?"0x00000000":"null"}function db(a,b){this.definitions=a,this.varType=b}function eb(a){this.expression=a}function fb(a){if(J.test(a)){for(var b=L.exec(a),c=a.substring(b[0].length).split(","),d=cb(b[2]),e=0;e<c.length;++e)c[e]=bb(c[e],d);return new db(c,b[2])}return new eb(F(a))}function gb(a,b,c){this.initStatement=a,this.condition=b,this.step=c}function hb(a,b){this.initStatement=a,this.container=b}function ib(a,b){this.initStatement=a,this.container=b}function jb(a){var b;return/\bin\b/.test(a)?(b=a.substring(1,a.length-1).split(/\bin\b/g),new hb(fb(g(b[0])),F(b[1]))):a.indexOf(":")>=0&&a.indexOf(";")<0?(b=a.substring(1,a.length-1).split(":"),new ib(fb(g(b[0])),F(b[1]))):(b=a.substring(1,a.length-1).split(";"),new gb(fb(g(b[0])),F(b[1]),F(b[2])))}function kb(a){a.sort(function(a,b){return b.weight-a.weight})}function lb(a,b,c){this.name=a,this.body=b,this.isStatic=c,b.owner=this}function mb(a,b,c){this.name=a,this.body=b,this.isStatic=c,b.owner=this}function nb(a){var b=G.exec(a);G.lastIndex=0;var e,c=b[1].indexOf("static")>=0,d=r[j(b[6])],f=u,g=y();return u=g,e="interface"===b[2]?new lb(b[3],B(d,b[3],b[4]),c):new mb(b[3],A(d,b[3],b[4],b[5]),c),z(e,g,f),u=f,e}function ob(a,b,c,d){this.name=a,this.params=b,this.body=c,this.isStatic=d}function pb(a){var b=I.exec(a);I.lastIndex=0;var c=b[1].indexOf("static")>=0,d=";"!==b[6]?r[j(b[6])]:"{}";return new ob(b[3],R(r[j(b[4])]),C(d),c)}function qb(a,b,c){this.definitions=a,this.fieldType=b,this.isStatic=c}function rb(a){for(var b=L.exec(a),c=b[1].indexOf("static")>=0,d=a.substring(b[0].length).split(/,\s*/g),e=cb(b[2]),f=0;f<d.length;++f)d[f]=bb(d[f],e);return new qb(d,b[2],c)}function sb(a,b){this.params=a,this.body=b}function tb(a){var b=new RegExp(/"B(\d+)"\s*"A(\d+)"/).exec(a),c=R(r[b[1]]);return new sb(c,C(r[b[2]]))}function ub(a,b,c,d,e,f){var g,h;for(this.name=a,this.interfacesNames=b,this.methodsNames=c,this.fields=d,this.innerClasses=e,this.misc=f,g=0,h=d.length;h>g;++g)d[g].owner=this}function vb(a,b,c,d,e,f,g,h,i){var j,k;for(this.name=a,this.baseClassName=b,this.interfacesNames=c,this.functions=d,this.methods=e,this.fields=f,this.cstrs=g,this.innerClasses=h,this.misc=i,j=0,k=f.length;k>j;++j)f[j].owner=this}function wb(a,b){this.name=a,this.body=b,b.owner=this}function xb(a,b){this.name=a,this.body=b,b.owner=this}function yb(a){var b=G.exec(a);G.lastIndex=0;var c=r[j(b[6])],d=u,e=y();u=e;var f;return f="interface"===b[2]?new wb(b[3],B(c,b[3],b[4])):new xb(b[3],A(c,b[3],b[4],b[5])),z(f,e,d),u=d,f}function zb(a,b,c){this.name=a,this.params=b,this.body=c}function Ab(a){var b=I.exec(a);return I.lastIndex=0,new zb(b[3],R(r[j(b[4])]),C(r[j(b[6])]))}function Bb(a){var b=a;return b=b.replace(/\b(catch\s*"B\d+"\s*"A\d+")(\s*catch\s*"B\d+"\s*"A\d+")+/g,"$1")}function Cb(a,b){this.argument=a,this.misc=b}function Db(a,b){this.argument=a,this.misc=b}function Eb(a,b,c){this.name=a,this.argument=b,this.misc=c}function Fb(a){this.expr=a}function Gb(a){this.label=a}function Hb(a){for(var b=[],c=0,d=a.length;d>c;++c){var e=a[c];e instanceof db?b=b.concat(e.getNames()):e instanceof Cb&&e.argument.initStatement instanceof db?b=b.concat(e.argument.initStatement.getNames()):(e instanceof lb||e instanceof mb||e instanceof wb||e instanceof xb||e instanceof zb||e instanceof V)&&b.push(e.name)}return h({},b)}function Ib(a){this.statements=a}function Jb(a){this.statements=a}function Kb(){function i(a,c){for(var g,e=c.split("."),f=a.scope;f;){if(f.hasOwnProperty(e[0])){g=f[e[0]];break}f=f.scope}g===d&&(g=b[e[0]]);for(var h=1,i=e.length;i>h&&g;++h)g=g.inScope[e[h]];return g}var c,e,b={};for(c in t)if(t.hasOwnProperty(c)){e=t[c];var f=e.scopeId,g=e.name;if(f){var h=t[f];e.scope=h,h.inScope===d&&(h.inScope={}),h.inScope[g]=e}else b[g]=e}for(c in t)if(t.hasOwnProperty(c)){e=t[c];var j=e.body.baseClassName;if(j){var k=i(e,j);k&&(e.base=k,k.derived||(k.derived=[]),k.derived.push(e))}var n,o,l=e.body.interfacesNames,m=[];if(l&&l.length>0){for(n=0,o=l.length;o>n;++n){var p=i(e,l[n]);m.push(p),p&&(p.derived||(p.derived=[]),p.derived.push(e))}m.length>0&&(e.interfaces=m)}}}function Lb(){function h(a,b){var d=c[a];if(!d)return!1;var e=d.indexOf(b);return 0>e?!1:(d.splice(e,1),d.length>0?!1:(delete c[a],!0))}var d,e,f,b=[],c={};for(d in t)if(t.hasOwnProperty(d))if(f=t[d],f.inScope||f.derived){var g=[];if(f.inScope)for(e in f.inScope)f.inScope.hasOwnProperty(e)&&g.push(f.inScope[e]);f.derived&&(g=g.concat(f.derived)),c[d]=g}else b.push(d),f.weight=0;for(;b.length>0;)if(d=b.shift(),f=t[d],f.scopeId&&h(f.scopeId,f)&&(b.push(f.scopeId),t[f.scopeId].weight=f.weight+1),f.base&&h(f.base.classId,f)&&(b.push(f.base.classId),f.base.weight=f.weight+1),f.interfaces){var i,j;for(i=0,j=f.interfaces.length;j>i;++i)f.interfaces[i]&&h(f.interfaces[i].classId,f)&&(b.push(f.interfaces[i].classId),f.interfaces[i].weight=f.weight+1)}}var b=H(),k=a.replace(/\r\n?|\n\r/g,"\n"),l=[],m=k.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')|(([\[\(=|&!\^:?]\s*)(\/(?![*\/])(?:[^\/\\\n]|\\.)*\/[gim]*)\b)|(\/\/[^\n]*\n)|(\/\*(?:(?!\*\/)(?:.|\n))*\*\/)/g,function(a,b,c,d,e,f,g,h){var i;return b||c?(i=l.length,l.push(a),"'"+i+"'"):d?(i=l.length,l.push(f),e+"'"+i+"'"):""!==h?" ":"\n"});m=m.replace(/__x([0-9A-F]{4})/g,function(a,b){return"__x005F_x"+b}),m=m.replace(/\$/g,"__x0024");var o,p=m,q=function(a,b,c,d){return b||d?a:(o=!0,"")};do o=!1,p=p.replace(/([<]?)<\s*((?:\?|[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)(?:\[\])*(?:\s+(?:extends|super)\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)?(?:\s*,\s*(?:\?|[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)(?:\[\])*(?:\s+(?:extends|super)\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)?)*)\s*>([=]?)/g,q);while(o);var s,u,A,B,C,D,E,F,r=c(p),t={},w=0,G=/\b((?:(?:public|private|final|protected|static|abstract)\s+)*)(class|interface)\s+([A-Za-z_$][\w$]*\b)(\s+extends\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*,\s*[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*\b)*)?(\s+implements\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*,\s*[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*\b)*)?\s*("A\d+")/g,I=/\b((?:(?:public|private|final|protected|static|abstract|synchronized)\s+)*)((?!(?:else|new|return|throw|function|public|private|protected)\b)[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*"C\d+")*)\s*([A-Za-z_$][\w$]*\b)\s*("B\d+")(\s*throws\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*,\s*[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)*)?\s*("A\d+"|;)/g,J=/^((?:(?:public|private|final|protected|static)\s+)*)((?!(?:else|new|return|throw)\b)[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*"C\d+")*)\s*([A-Za-z_$][\w$]*\b)\s*(?:"C\d+"\s*)*([=,]|$)/,K=/\b((?:(?:public|private|final|protected|static|abstract)\s+)*)((?!(?:new|return|throw)\b)[A-Za-z_$][\w$]*\b)\s*("B\d+")(\s*throws\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*,\s*[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)*)?\s*("A\d+")/g,L=/^((?:(?:public|private|final|protected|static)\s+)*)((?!(?:new|return|throw)\b)[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*"C\d+")*)\s*/,M=/\bfunction(?:\s+([A-Za-z_$][\w$]*))?\s*("B\d+")\s*("A\d+")/g;P.prototype.toString=function(){return this.name},Q.prototype.getNames=function(){for(var a=[],b=0,c=this.params.length;c>b;++b)a.push(this.params[b].name);return a},Q.prototype.prependMethodArgs=function(a){return this.methodArgsParam?"{\nvar "+this.methodArgsParam.name+" = Array.prototype.slice.call(arguments, "+this.params.length+");\n"+a.substring(1):a},Q.prototype.toString=function(){if(0===this.params.length)return"()";for(var a="(",b=0,c=this.params.length;c>b;++b)a+=this.params[b]+", ";return a.substring(0,a.length-2)+")"},T.prototype.toString=function(){return"new ("+this.body+")"},V.prototype.toString=function(){var a=s,b=h({"this":null},this.params.getNames());s=function(c){return b.hasOwnProperty(c.name)?c.name:a(c)};var c="function";this.name&&(c+=" "+this.name);var d=this.params.prependMethodArgs(this.body.toString());return c+=this.params+" "+d,s=a,c},X.prototype.toString=function(){var a=s;s=function(b){return"this"===b.name?"this":a(b)};for(var b="",c=0,d=this.members.length;d>c;++c)this.members[c].label&&(b+=this.members[c].label+": "),b+=this.members[c].value.toString()+", ";return s=a,b.substring(0,b.length-2)},_.prototype.toString=function(){var a=this.transforms,b=$(this.expr);return b.replace(/"!(\d+)"/g,function(b,c){return a[c].toString()})},F=function(a){var b=[],c=Z(a);return c=c.replace(/"H(\d+)"/g,function(a,c){return b.push(W(r[c])),'"!'+(b.length-1)+'"'}),c=c.replace(/"F(\d+)"/g,function(a,c){return b.push(U(r[c])),'"!'+(b.length-1)+'"'}),c=c.replace(/"I(\d+)"/g,function(a,c){return b.push(Y(r[c])),'"!'+(b.length-1)+'"'}),new _(c,b)},ab.prototype.toString=function(){return this.name+" = "+this.value},db.prototype.getNames=function(){for(var a=[],b=0,c=this.definitions.length;c>b;++b)a.push(this.definitions[b].name);return a},db.prototype.toString=function(){return"var "+this.definitions.join(",")},eb.prototype.toString=function(){return this.expression.toString()},gb.prototype.toString=function(){return"("+this.initStatement+"; "+this.condition+"; "+this.step+")"},hb.prototype.toString=function(){var a=this.initStatement.toString();return a.indexOf("=")>=0&&(a=a.substring(0,a.indexOf("="))),"("+a+" in "+this.container+")"},ib.iteratorId=0,ib.prototype.toString=function(){var a=this.initStatement.toString(),b="$it"+ib.iteratorId++,c=a.replace(/^\s*var\s*/,"").split("=")[0],d="var "+b+" = new $p.ObjectIterator("+this.container+"), "+c+" = void(0)",e=b+".hasNext() && (("+c+" = "+b+".next()) || true)";return"("+d+"; "+e+";)"},lb.prototype.toString=function(){return""+this.body},mb.prototype.toString=function(){return""+this.body},ob.prototype.toString=function(){var a=h({},this.params.getNames()),b=s;s=function(c){return a.hasOwnProperty(c.name)?c.name:b(c)};var c=this.params.prependMethodArgs(this.body.toString()),d="function "+this.methodId+this.params+" "+c+"\n";return s=b,d},qb.prototype.getNames=function(){for(var a=[],b=0,c=this.definitions.length;c>b;++b)a.push(this.definitions[b].name);return a},qb.prototype.toString=function(){var a=s({name:"[this]"});if(this.isStatic){for(var b=this.owner.name,c=[],d=0,e=this.definitions.length;e>d;++d){var f=this.definitions[d],g=f.name,h=b+"."+g,i="if("+h+" === void(0)) {\n"+" "+h+" = "+f.value+"; }\n"+"$p.defineProperty("+a+", "+"'"+g+"', { get: function(){return "+h+";}, "+"set: function(val){"+h+" = val;} });\n";c.push(i)}return c.join("")}return a+"."+this.definitions.join("; "+a+".")},sb.prototype.toString=function(){var a=h({},this.params.getNames()),b=s;s=function(c){return a.hasOwnProperty(c.name)?c.name:b(c)};var c="function $constr_"+this.params.params.length+this.params.toString(),d=this.params.prependMethodArgs(this.body.toString());return/\$(superCstr|constr)\b/.test(d)||(d="{\n$superCstr();\n"+d.substring(1)),s=b,c+d+"\n"},ub.prototype.getMembers=function(a,b,c){this.owner.base&&this.owner.base.body.getMembers(a,b,c);var d,e,f,g;for(d=0,f=this.fields.length;f>d;++d){var h=this.fields[d].getNames();for(e=0,g=h.length;g>e;++e)a[h[e]]=this.fields[d]}for(d=0,f=this.methodsNames.length;f>d;++d){var i=this.methodsNames[d];b[i]=!0}for(d=0,f=this.innerClasses.length;f>d;++d){var j=this.innerClasses[d];c[j.name]=j}},ub.prototype.toString=function(){function a(a){for(var b=0;a;)++b,a=a.scope;return b}a(this.owner);var c=this.name,d="",e="",f={},g={},h={};this.getMembers(f,g,h);var i,j;if(this.owner.interfaces){var n,m=[];for(i=0,j=this.interfacesNames.length;j>i;++i)this.owner.interfaces[i]&&(n=s({name:this.interfacesNames[i]}),m.push(n),d+="$p.extendInterfaceMembers("+c+", "+n+");\n");e+=c+".$interfaces = ["+m.join(", ")+"];\n"}for(e+=c+".$isInterface = true;\n",e+=c+".$methods = ['"+this.methodsNames.join("', '")+"'];\n",kb(this.innerClasses),i=0,j=this.innerClasses.length;j>i;++i){var o=this.innerClasses[i];o.isStatic&&(d+=c+"."+o.name+" = "+o+";\n")}for(i=0,j=this.fields.length;j>i;++i){var p=this.fields[i];p.isStatic&&(d+=c+"."+p.definitions.join(";\n"+c+".")+";\n")}return"(function() {\nfunction "+c+"() { throw 'Unable to create the interface'; }\n"+d+e+"return "+c+";\n"+"})()"},B=function(a,b,c){var e=a.substring(1,a.length-1);e=N(e),e=O(e,b);var g=[],h=[];e=e.replace(/"([DE])(\d+)"/g,function(a,b,c){return"D"===b?g.push(c):"E"===b&&h.push(c),""});var j,k,l,i=e.split(/;(?:\s*;)*/g);for(c!==d&&(j=c.replace(/^\s*extends\s+(.+?)\s*$/g,"$1").split(/\s*,\s*/g)),k=0,l=g.length;l>k;++k){var m=pb(r[g[k]]);g[k]=m.name}for(k=0,l=i.length-1;l>k;++k){var n=f(i[k]);i[k]=rb(n.middle)}var o=i.pop();for(k=0,l=h.length;l>k;++k)h[k]=nb(r[h[k]]);return new ub(b,j,g,i,h,{tail:o})},vb.prototype.getMembers=function(a,b,c){this.owner.base&&this.owner.base.body.getMembers(a,b,c);var d,e,f,g;for(d=0,f=this.fields.length;f>d;++d){var h=this.fields[d].getNames();for(e=0,g=h.length;g>e;++e)a[h[e]]=this.fields[d]}for(d=0,f=this.methods.length;f>d;++d){var i=this.methods[d];b[i.name]=i}for(d=0,f=this.innerClasses.length;f>d;++d){var j=this.innerClasses[d];c[j.name]=j}},vb.prototype.toString=function(){function a(a){for(var b=0;a;)++b,a=a.scope;return b}var b=a(this.owner),c="$this_"+b,d=this.name,e="var "+c+" = this;\n",f="",h="",i={},j={},k={};this.getMembers(i,j,k);var l=s;s=function(a){var b=a.name;return"this"===b?a.callSign||!a.member?c+".$self":c:i.hasOwnProperty(b)?i[b].isStatic?d+"."+b:c+"."+b:k.hasOwnProperty(b)?c+"."+b:j.hasOwnProperty(b)?j[b].isStatic?d+"."+b:c+".$self."+b:l(a)};var m;this.baseClassName?(m=l({name:this.baseClassName}),e+="var $super = { $upcast: "+c+" };\n",e+="function $superCstr(){"+m+".apply($super,arguments);if(!('$self' in $super)) $p.extendClassChain($super)}\n",h+=d+".$base = "+m+";\n"):e+="function $superCstr(){$p.extendClassChain("+c+")}\n",this.owner.base&&(f+="$p.extendStaticMembers("+d+", "+m+");\n");var n,o,p,q;if(this.owner.interfaces){var t,r=[];for(n=0,o=this.interfacesNames.length;o>n;++n)this.owner.interfaces[n]&&(t=l({name:this.interfacesNames[n]}),r.push(t),f+="$p.extendInterfaceMembers("+d+", "+t+");\n");h+=d+".$interfaces = ["+r.join(", ")+"];\n"}for(this.functions.length>0&&(e+=this.functions.join("\n")+"\n"),kb(this.innerClasses),n=0,o=this.innerClasses.length;o>n;++n){var u=this.innerClasses[n];u.isStatic?(f+=d+"."+u.name+" = "+u+";\n",e+=c+"."+u.name+" = "+d+"."+u.name+";\n"):e+=c+"."+u.name+" = "+u+";\n"}for(n=0,o=this.fields.length;o>n;++n){var v=this.fields[n];if(v.isStatic)for(f+=d+"."+v.definitions.join(";\n"+d+".")+";\n",p=0,q=v.definitions.length;q>p;++p){var w=v.definitions[p].name,x=d+"."+w;e+="$p.defineProperty("+c+", '"+w+"', {"+"get: function(){return "+x+"}, "+"set: function(val){"+x+" = val}});\n"}else e+=c+"."+v.definitions.join(";\n"+c+".")+";\n"}var y={};for(n=0,o=this.methods.length;o>n;++n){var z=this.methods[n],A=y[z.name],B=z.name+"$"+z.params.params.length,C=!!z.params.methodArgsParam;A?(++A,B+="_"+A):A=1,z.methodId=B,y[z.name]=A,z.isStatic?(f+=z,f+="$p.addMethod("+d+", '"+z.name+"', "+B+", "+C+");\n",e+="$p.addMethod("+c+", '"+z.name+"', "+B+", "+C+");\n"):(e+=z,e+="$p.addMethod("+c+", '"+z.name+"', "+B+", "+C+");\n")}e+=g(this.misc.tail),this.cstrs.length>0&&(e+=this.cstrs.join("\n")+"\n"),e+="function $constr() {\n";var D=[];for(n=0,o=this.cstrs.length;o>n;++n){var E=this.cstrs[n].params.params.length,F=!!this.cstrs[n].params.methodArgsParam;D.push("if(arguments.length "+(F?">=":"===")+" "+E+") { "+"$constr_"+E+".apply("+c+", arguments); }")}return D.length>0&&(e+=D.join(" else ")+" else "),e+="$superCstr();\n}\n",e+="$constr.apply(null, arguments);\n",s=l,"(function() {\nfunction "+d+"() {\n"+e+"}\n"+f+h+"return "+d+";\n"+"})()"},A=function(a,b,c,e){var g=a.substring(1,a.length-1);g=N(g),g=O(g,b);var h=[],i=[],j=[],k=[];g=g.replace(/"([DEGH])(\d+)"/g,function(a,b,c){return"D"===b?h.push(c):"E"===b?i.push(c):"H"===b?k.push(c):j.push(c),""});var m,n,o,l=g.replace(/^(?:\s*;)+/,"").split(/;(?:\s*;)*/g);for(c!==d&&(m=c.replace(/^\s*extends\s+([A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)\s*$/g,"$1")),e!==d&&(n=e.replace(/^\s*implements\s+(.+?)\s*$/g,"$1").split(/\s*,\s*/g)),o=0;o<k.length;++o)k[o]=W(r[k[o]]);for(o=0;o<h.length;++o)h[o]=pb(r[h[o]]);for(o=0;o<l.length-1;++o){var p=f(l[o]);l[o]=rb(p.middle)}var q=l.pop();for(o=0;o<j.length;++o)j[o]=tb(r[j[o]]);for(o=0;o<i.length;++o)i[o]=nb(r[i[o]]);return new vb(b,m,n,k,h,l,j,i,{tail:q})},wb.prototype.toString=function(){return"var "+this.name+" = "+this.body+";\n"+"$p."+this.name+" = "+this.name+";\n"},xb.prototype.toString=function(){return"var "+this.name+" = "+this.body+";\n"+"$p."+this.name+" = "+this.name+";\n"},zb.prototype.toString=function(){var a=h({},this.params.getNames()),b=s;s=function(c){return a.hasOwnProperty(c.name)?c.name:b(c)};var c=this.params.prependMethodArgs(this.body.toString()),d="function "+this.name+this.params+" "+c+"\n"+"$p."+this.name+" = "+this.name+";";return s=b,d},Cb.prototype.toString=function(){return this.misc.prefix+this.argument.toString()},Db.prototype.toString=function(){return this.misc.prefix+this.argument.toString()},Eb.prototype.toString=function(){var a=this.misc.prefix;return this.argument!==d&&(a+=this.argument.toString()),a},Fb.prototype.toString=function(){return"case "+this.expr+":"},Gb.prototype.toString=function(){return this.label},D=function(a,b,c){var e=new RegExp(/\b(catch|for|if|switch|while|with)\s*"B(\d+)"|\b(do|else|finally|return|throw|try|break|continue)\b|("[ADEH](\d+)")|\b(case)\s+([^:]+):|\b([A-Za-z_$][\w$]*\s*:)|(;)/g),h=[];a=Bb(a);for(var j,k,i=0;null!==(j=e.exec(a));){if(j[1]!==d){var l=a.lastIndexOf('"B',e.lastIndex),m=a.substring(i,l);"for"===j[1]?h.push(new Cb(jb(r[j[2]]),{prefix:m})):"catch"===j[1]?h.push(new Db(R(r[j[2]]),{prefix:m})):h.push(new Eb(j[1],F(r[j[2]]),{prefix:m}))}else if(j[3]!==d)h.push(new Eb(j[3],d,{prefix:a.substring(i,e.lastIndex)}));else if(j[4]!==d){if(k=a.substring(i,e.lastIndex-j[4].length),0!==g(k).length)continue;h.push(k);var n=j[4].charAt(1),o=j[5];"D"===n?h.push(b(r[o])):"E"===n?h.push(c(r[o])):"H"===n?h.push(W(r[o])):h.push(C(r[o]))}else if(j[6]!==d)h.push(new Fb(F(g(j[7]))));else if(j[8]!==d){if(k=a.substring(i,e.lastIndex-j[8].length),0!==g(k).length)continue;h.push(new Gb(a.substring(i,e.lastIndex)))}else{var p=f(a.substring(i,e.lastIndex-1));h.push(p.left),h.push(fb(p.middle)),h.push(p.right+";")}i=e.lastIndex}var q=f(a.substring(i));return h.push(q.left),""!==q.middle&&(h.push(fb(q.middle)),h.push(";"+q.right)),h},Ib.prototype.toString=function(){var a=Hb(this.statements),b=s;i(a)||(s=function(c){return a.hasOwnProperty(c.name)?c.name:b(c)});var c="{\n"+this.statements.join("")+"\n}";return s=b,c},C=function(a){var b=f(a.substring(1,a.length-1));return new Ib(D(b.middle))},Jb.prototype.toString=function(){for(var d,a=[],c=[],e=0,f=this.statements.length;f>e;++e)d=this.statements[e],d instanceof xb||d instanceof wb?a.push(d):c.push(d);kb(a);var g=Hb(this.statements);s=function(a){var c=a.name;return g.hasOwnProperty(c)?c:b.hasOwnProperty(c)||n.hasOwnProperty(c)||v.hasOwnProperty(c)?"$p."+c:c};var h="// this code was autogenerated from PJS\n(function($p) {\n"+a.join("")+"\n"+c.join("")+"\n})";return s=null,h},E=function(){var a=N(r[0]);return a=a.replace(/\bimport\s+[^;]+;/g,""),new Jb(D(a,Ab,yb))};var Mb=E();Kb(Mb),Lb(Mb);var Nb=Mb.toString();
  return Nb=Nb.replace(/\s*\n(?:[\t ]*\n)+/g,"\n\n"),Nb=Nb.replace(/__x([0-9A-F]{4})/g,function(a,b){return String.fromCharCode(parseInt(b,16))}),e(Nb,l)}function J(a,b){var c=new RegExp(/\/\*\s*@pjs\s+((?:[^\*]|\*+[^\*\/])*)\*\//g).exec(a);if(c&&2===c.length)for(var d=[],e=c.splice(1,2)[0].replace(/\{([\s\S]*?)\}/g,function(){return function(a,b){return d.push(b),"{"+(d.length-1)+"}"}}()).replace("\n","").replace("\r","").split(";"),f=function(a){return a.replace(/^\s*["']?/,"").replace(/["']?\s*$/,"")},g=0,h=e.length;h>g;g++){var i=e[g].split("=");if(i&&2===i.length){var j=f(i[0]),k=f(i[1]),l=[];if("preload"===j){l=k.split(",");for(var m=0,n=l.length;n>m;m++){var o=f(l[m]);b.imageCache.add(o)}}else if("font"===j){l=k.split(",");for(var p=0,q=l.length;q>p;p++){var r=f(l[p]),s=/^\{(\d*?)\}$/.exec(r);F.preloading.add(s?JSON.parse("{"+d[s[1]]+"}"):r)}}else"pauseOnBlur"===j?b.options.pauseOnBlur="true"===k:"globalKeyEvents"===j?b.options.globalKeyEvents="true"===k:"param-"===j.substring(0,6)?b.params[j.substring(6)]=k:b.options[j]=k}}return a}var e=function(){},f=function(){return"console"in a?function(b){a.console.log("Processing.js: "+b)}:e}(),g=function(a){var b=new XMLHttpRequest;if(b.open("GET",a,!1),b.overrideMimeType&&b.overrideMimeType("text/plain"),b.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),b.send(null),200!==b.status&&0!==b.status)throw"XMLHttpRequest failed, status code "+b.status;return b.responseText},h="document"in this&&!("fake"in this.document);if(b.head=b.head||b.getElementsByTagName("head")[0],b.documentMode>=9&&!b.doctype)throw"The doctype directive is missing. The recommended doctype in Internet Explorer is the HTML5 doctype: <!DOCTYPE html>";var j=i("Float32Array","WebGLFloatArray"),k=i("Int32Array","WebGLIntArray"),l=i("Uint16Array","WebGLUnsignedShortArray"),m=i("Uint8Array","WebGLUnsignedByteArray"),n={X:0,Y:1,Z:2,R:3,G:4,B:5,A:6,U:7,V:8,NX:9,NY:10,NZ:11,EDGE:12,SR:13,SG:14,SB:15,SA:16,SW:17,TX:18,TY:19,TZ:20,VX:21,VY:22,VZ:23,VW:24,AR:25,AG:26,AB:27,DR:3,DG:4,DB:5,DA:6,SPR:28,SPG:29,SPB:30,SHINE:31,ER:32,EG:33,EB:34,BEEN_LIT:35,VERTEX_FIELD_COUNT:36,P2D:1,JAVA2D:1,WEBGL:2,P3D:2,OPENGL:2,PDF:0,DXF:0,OTHER:0,WINDOWS:1,MAXOSX:2,LINUX:3,EPSILON:1e-4,MAX_FLOAT:3.4028235e38,MIN_FLOAT:-3.4028235e38,MAX_INT:2147483647,MIN_INT:-2147483648,PI:c.PI,TWO_PI:2*c.PI,HALF_PI:c.PI/2,THIRD_PI:c.PI/3,QUARTER_PI:c.PI/4,DEG_TO_RAD:c.PI/180,RAD_TO_DEG:180/c.PI,WHITESPACE:"  \n\r\f\xa0",RGB:1,ARGB:2,HSB:3,ALPHA:4,CMYK:5,TIFF:0,TARGA:1,JPEG:2,GIF:3,BLUR:11,GRAY:12,INVERT:13,OPAQUE:14,POSTERIZE:15,THRESHOLD:16,ERODE:17,DILATE:18,REPLACE:0,BLEND:1,ADD:2,SUBTRACT:4,LIGHTEST:8,DARKEST:16,DIFFERENCE:32,EXCLUSION:64,MULTIPLY:128,SCREEN:256,OVERLAY:512,HARD_LIGHT:1024,SOFT_LIGHT:2048,DODGE:4096,BURN:8192,ALPHA_MASK:4278190080,RED_MASK:16711680,GREEN_MASK:65280,BLUE_MASK:255,CUSTOM:0,ORTHOGRAPHIC:2,PERSPECTIVE:3,POINT:2,POINTS:2,LINE:4,LINES:4,TRIANGLE:8,TRIANGLES:9,TRIANGLE_STRIP:10,TRIANGLE_FAN:11,QUAD:16,QUADS:16,QUAD_STRIP:17,POLYGON:20,PATH:21,RECT:30,ELLIPSE:31,ARC:32,SPHERE:40,BOX:41,GROUP:0,PRIMITIVE:1,GEOMETRY:3,VERTEX:0,BEZIER_VERTEX:1,CURVE_VERTEX:2,BREAK:3,CLOSESHAPE:4,OPEN:1,CLOSE:2,CORNER:0,CORNERS:1,RADIUS:2,CENTER_RADIUS:2,CENTER:3,DIAMETER:3,CENTER_DIAMETER:3,BASELINE:0,TOP:101,BOTTOM:102,NORMAL:1,NORMALIZED:1,IMAGE:2,MODEL:4,SHAPE:5,SQUARE:"butt",ROUND:"round",PROJECT:"square",MITER:"miter",BEVEL:"bevel",AMBIENT:0,DIRECTIONAL:1,SPOT:3,BACKSPACE:8,TAB:9,ENTER:10,RETURN:13,ESC:27,DELETE:127,CODED:65535,SHIFT:16,CONTROL:17,ALT:18,CAPSLK:20,PGUP:33,PGDN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLK:144,META:157,INSERT:155,ARROW:"default",CROSS:"crosshair",HAND:"pointer",MOVE:"move",TEXT:"text",WAIT:"wait",NOCURSOR:"url('data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=='), auto",DISABLE_OPENGL_2X_SMOOTH:1,ENABLE_OPENGL_2X_SMOOTH:-1,ENABLE_OPENGL_4X_SMOOTH:2,ENABLE_NATIVE_FONTS:3,DISABLE_DEPTH_TEST:4,ENABLE_DEPTH_TEST:-4,ENABLE_DEPTH_SORT:5,DISABLE_DEPTH_SORT:-5,DISABLE_OPENGL_ERROR_REPORT:6,ENABLE_OPENGL_ERROR_REPORT:-6,ENABLE_ACCURATE_TEXTURES:7,DISABLE_ACCURATE_TEXTURES:-7,HINT_COUNT:10,SINCOS_LENGTH:720,PRECISIONB:15,PRECISIONF:32768,PREC_MAXVAL:32767,PREC_ALPHA_SHIFT:9,PREC_RED_SHIFT:1,NORMAL_MODE_AUTO:0,NORMAL_MODE_SHAPE:1,NORMAL_MODE_VERTEX:2,MAX_LIGHTS:8},q=function(a){if(a.iterator instanceof Function)return a.iterator();if(!(a instanceof Array))throw"Unable to iterate: "+a;var b=-1;this.hasNext=function(){return++b<a.length},this.next=function(){return a[b]}},r=function(){function a(a){var b=0;this.hasNext=function(){return b<a.length},this.next=function(){return a[b++]},this.remove=function(){a.splice(b,1)}}function b(c){var d;c instanceof b?d=c.toArray():(d=[],"number"==typeof c&&(d.length=c>0?c:0)),this.get=function(a){return d[a]},this.contains=function(a){return this.indexOf(a)>-1},this.indexOf=function(a){for(var b=0,c=d.length;c>b;++b)if(p(a,d[b]))return b;return-1},this.lastIndexOf=function(a){for(var b=d.length-1;b>=0;--b)if(p(a,d[b]))return b;return-1},this.add=function(){if(1===arguments.length)d.push(arguments[0]);else{if(2!==arguments.length)throw"Please use the proper number of parameters.";var a=arguments[0];if("number"!=typeof a)throw typeof a+" is not a number";if(!(a>=0&&a<=d.length))throw a+" is not a valid index";d.splice(a,0,arguments[1])}},this.addAll=function(a,b){var c;if("number"==typeof a){if(0>a||a>d.length)throw"Index out of bounds for addAll: "+a+" greater or equal than "+d.length;for(c=new q(b);c.hasNext();)d.splice(a++,0,c.next())}else for(c=new q(a);c.hasNext();)d.push(c.next())},this.set=function(){if(2!==arguments.length)throw"Please use the proper number of parameters.";var a=arguments[0];if("number"!=typeof a)throw typeof a+" is not a number";if(!(a>=0&&a<d.length))throw a+" is not a valid index.";d.splice(a,1,arguments[1])},this.size=function(){return d.length},this.clear=function(){d.length=0},this.remove=function(a){return"number"==typeof a?d.splice(a,1)[0]:(a=this.indexOf(a),a>-1?(d.splice(a,1),!0):!1)},this.removeAll=function(a){var c,d,e,f=new b;for(f.addAll(this),this.clear(),c=0,d=0;c<f.size();c++)e=f.get(c),a.contains(e)||this.add(d++,e);return this.size()<f.size()?!0:!1},this.isEmpty=function(){return!d.length},this.clone=function(){return new b(this)},this.toArray=function(){return d.slice(0)},this.iterator=function(){return new a(d)}}return b}(),s=function(){function a(){function h(a){var b=o(a)%e.length;return 0>b?e.length+b:b}function i(){if(!(f<=c*e.length)){for(var a=[],b=0;b<e.length;++b)e[b]!==d&&(a=a.concat(e[b]));var g=2*e.length;e=[],e.length=g;for(var i=0;i<a.length;++i){var j=h(a[i].key),k=e[j];k===d&&(e[j]=k=[]),k.push(a[i])}}}function j(a,b){function i(){for(;!g;)if(++f,c>=e.length)g=!0;else{if(!(e[c]===d||f>=e[c].length))return;f=-1,++c}}var h,c=0,f=-1,g=!1;this.hasNext=function(){return!g},this.next=function(){return h=a(e[c][f]),i(),h},this.remove=function(){h!==d&&(b(h),--f,i())},i()}function k(a,b,c){this.clear=function(){g.clear()},this.contains=function(a){return b(a)},this.containsAll=function(a){for(var b=a.iterator();b.hasNext();)if(!this.contains(b.next()))return!1;return!0},this.isEmpty=function(){return g.isEmpty()},this.iterator=function(){return new j(a,c)},this.remove=function(a){return this.contains(a)?(c(a),!0):!1},this.removeAll=function(a){for(var b=a.iterator(),d=!1;b.hasNext();){var e=b.next();this.contains(e)&&(c(e),d=!0)}return!0},this.retainAll=function(a){for(var b=this.iterator(),d=[];b.hasNext();){var e=b.next();a.contains(e)||d.push(e)}for(var f=0;f<d.length;++f)c(d[f]);return d.length>0},this.size=function(){return g.size()},this.toArray=function(){for(var a=[],b=this.iterator();b.hasNext();)a.push(b.next());return a}}function l(a){this._isIn=function(b){return b===g&&a.removed===d},this.equals=function(b){return p(a.key,b.getKey())},this.getKey=function(){return a.key},this.getValue=function(){return a.value},this.hashCode=function(){return o(a.key)},this.setValue=function(b){var c=a.value;return a.value=b,c}}if(1===arguments.length&&arguments[0]instanceof a)return arguments[0].clone();var b=arguments.length>0?arguments[0]:16,c=arguments.length>1?arguments[1]:.75,e=[];e.length=b;var f=0,g=this;this.clear=function(){f=0,e=[],e.length=b},this.clone=function(){var b=new a;return b.putAll(this),b},this.containsKey=function(a){var b=h(a),c=e[b];if(c===d)return!1;for(var f=0;f<c.length;++f)if(p(c[f].key,a))return!0;return!1},this.containsValue=function(a){for(var b=0;b<e.length;++b){var c=e[b];if(c!==d)for(var f=0;f<c.length;++f)if(p(c[f].value,a))return!0}return!1},this.entrySet=function(){return new k(function(a){return new l(a)},function(a){return a instanceof l&&a._isIn(g)},function(a){return g.remove(a.getKey())})},this.get=function(a){var b=h(a),c=e[b];if(c===d)return null;for(var f=0;f<c.length;++f)if(p(c[f].key,a))return c[f].value;return null},this.isEmpty=function(){return 0===f},this.keySet=function(){return new k(function(a){return a.key},function(a){return g.containsKey(a)},function(a){return g.remove(a)})},this.values=function(){return new k(function(a){return a.value},function(a){return g.containsValue(a)},function(a){return g.removeByValue(a)})},this.put=function(a,b){var c=h(a),g=e[c];if(g===d)return++f,e[c]=[{key:a,value:b}],i(),null;for(var j=0;j<g.length;++j)if(p(g[j].key,a)){var k=g[j].value;return g[j].value=b,k}return++f,g.push({key:a,value:b}),i(),null},this.putAll=function(a){for(var b=a.entrySet().iterator();b.hasNext();){var c=b.next();this.put(c.getKey(),c.getValue())}},this.remove=function(a){var b=h(a),c=e[b];if(c===d)return null;for(var g=0;g<c.length;++g)if(p(c[g].key,a)){--f;var i=c[g].value;return c[g].removed=!0,c.length>1?c.splice(g,1):e[b]=d,i}return null},this.removeByValue=function(a){var b,c,d,f;for(b in e)if(e.hasOwnProperty(b))for(c=0,d=e[b].length;d>c;c++)if(f=e[b][c],f.value===a)return e[b].splice(c,1),!0;return!1},this.size=function(){return f}}return a}(),t=function(){function a(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0}function b(a){return function(b,c){var d=b.get();return d[a](c),d}}a.dist=function(a,b){return a.dist(b)},a.dot=function(a,b){return a.dot(b)},a.cross=function(a,b){return a.cross(b)},a.angleBetween=function(a,b){return c.acos(a.dot(b)/(a.mag()*b.mag()))},a.prototype={set:function(a,b,c){1===arguments.length?this.set(a.x||a[0]||0,a.y||a[1]||0,a.z||a[2]||0):(this.x=a,this.y=b,this.z=c)},get:function(){return new a(this.x,this.y,this.z)},mag:function(){var a=this.x,b=this.y,d=this.z;return c.sqrt(a*a+b*b+d*d)},add:function(a,b,c){1===arguments.length?(this.x+=a.x,this.y+=a.y,this.z+=a.z):(this.x+=a,this.y+=b,this.z+=c)},sub:function(a,b,c){1===arguments.length?(this.x-=a.x,this.y-=a.y,this.z-=a.z):(this.x-=a,this.y-=b,this.z-=c)},mult:function(a){"number"==typeof a?(this.x*=a,this.y*=a,this.z*=a):(this.x*=a.x,this.y*=a.y,this.z*=a.z)},div:function(a){"number"==typeof a?(this.x/=a,this.y/=a,this.z/=a):(this.x/=a.x,this.y/=a.y,this.z/=a.z)},dist:function(a){var b=this.x-a.x,d=this.y-a.y,e=this.z-a.z;return c.sqrt(b*b+d*d+e*e)},dot:function(a,b,c){return 1===arguments.length?this.x*a.x+this.y*a.y+this.z*a.z:this.x*a+this.y*b+this.z*c},cross:function(b){var c=this.x,d=this.y,e=this.z;return new a(d*b.z-b.y*e,e*b.x-b.z*c,c*b.y-b.x*d)},normalize:function(){var a=this.mag();a>0&&this.div(a)},limit:function(a){this.mag()>a&&(this.normalize(),this.mult(a))},heading2D:function(){return-c.atan2(-this.y,this.x)},toString:function(){return"["+this.x+", "+this.y+", "+this.z+"]"},array:function(){return[this.x,this.y,this.z]}};for(var d in a.prototype)a.prototype.hasOwnProperty(d)&&!a.hasOwnProperty(d)&&(a[d]=b(d));return a}();u.prototype=n;var v=new u;v.ArrayList=r,v.HashMap=s,v.PVector=t,v.ObjectIterator=q,v.PConstants=n,v.defineProperty=function(a,b,c){"defineProperty"in Object?Object.defineProperty(a,b,c):(c.hasOwnProperty("get")&&a.__defineGetter__(b,c.get),c.hasOwnProperty("set")&&a.__defineSetter__(b,c.set))},v.extendClassChain=function(a){for(var b=[a],c=a.$upcast;c;c=c.$upcast)x(c,a),b.push(c),a=c;for(;b.length>0;)b.pop().$self=a},v.extendStaticMembers=function(a,b){x(a,b)},v.extendInterfaceMembers=function(a,b){x(a,b)},v.addMethod=function(a,b,c,d){var e=a[b];if(e||d){var f=c.length;if("$overloads"in e)e.$overloads[f]=c;else{var g=function(){var a=g.$overloads[arguments.length]||("$methodArgsIndex"in g&&arguments.length>g.$methodArgsIndex?g.$overloads[g.$methodArgsIndex]:null)||g.$defaultOverload;return a.apply(this,arguments)},h=[];e&&(h[e.length]=e),h[f]=c,g.$overloads=h,g.$defaultOverload=e||c,d&&(g.$methodArgsIndex=f),g.name=b,a[b]=g}}else a[b]=c},v.createJavaArray=function(a,b){var c=null,d=null;if("string"==typeof a&&("boolean"===a?d=!1:y(a)&&(d=0)),"number"==typeof b[0]){var e=0|b[0];if(b.length<=1){c=[],c.length=e;for(var f=0;e>f;++f)c[f]=d}else{c=[];for(var g=b.slice(1),h=0;e>h;++h)c.push(v.createJavaArray(a,g))}}return c};var z={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};!function(a){function f(a){return function(){throw"Processing.js does not support "+a+"."}}for(var d,e,b="open() createOutput() createInput() BufferedReader selectFolder() dataPath() createWriter() selectOutput() beginRecord() saveStream() endRecord() selectInput() saveBytes() createReader() beginRaw() endRaw() PrintWriter delay()".split(" "),c=b.length;c--;)d=b[c],e=d.replace("()",""),a[e]=f(d)}(v),v.defineProperty(v,"screenWidth",{get:function(){return a.innerWidth}}),v.defineProperty(v,"screenHeight",{get:function(){return a.innerHeight}}),v.defineProperty(v,"online",{get:function(){return!0}});var A=[],B={},C=function(a){A.splice(B[a],1),delete B[a]},D=function(a){a.externals.canvas.id!==d&&a.externals.canvas.id.length||(a.externals.canvas.id="__processing"+A.length),B[a.externals.canvas.id]=A.length,A.push(a)};F.prototype.caching=!0,F.prototype.getCSSDefinition=function(a,b){a===d&&(a=this.size+"px"),b===d&&(b=this.leading+"px");var c=[this.style,"normal",this.weight,a+"/"+b,this.family];return c.join(" ")},F.prototype.measureTextWidth=function(a){return this.context2d.measureText(a).width},F.prototype.measureTextWidthFallback=function(a){var c=b.createElement("canvas"),d=c.getContext("2d");return d.font=this.css,d.measureText(a).width},F.PFontCache={length:0},F.get=function(a,b){b=(0|10*b+.5)/10;var c=F.PFontCache,d=a+"/"+b;if(!c[d]){if(c[d]=new F(a,b),c.length++,50===c.length){F.prototype.measureTextWidth=F.prototype.measureTextWidthFallback,F.prototype.caching=!1;var e;for(e in c)"length"!==e&&(c[e].context2d=null);return new F(a,b)}if(400===c.length)return F.PFontCache={},F.get=F.getFallback,new F(a,b)}return c[d]},F.getFallback=function(a,b){return new F(a,b)},F.list=function(){return["sans-serif","serif","monospace","fantasy","cursive"]},F.preloading={template:{},initialized:!1,initialize:function(){var a=function(){var a="#E3KAI2wAgT1MvMg7Eo3VmNtYX7ABi3CxnbHlm7Abw3kaGVhZ7ACs3OGhoZWE7A53CRobXR47AY3AGbG9jYQ7G03Bm1heH7ABC3CBuYW1l7Ae3AgcG9zd7AI3AE#B3AQ2kgTY18PPPUACwAg3ALSRoo3#yld0xg32QAB77#E777773B#E3C#I#Q77773E#Q7777777772CMAIw7AB77732B#M#Q3wAB#g3B#E#E2BB//82BB////w#B7#gAEg3E77x2B32B#E#Q#MTcBAQ32gAe#M#QQJ#E32M#QQJ#I#g32Q77#",b=function(a){return"AAAAAAAA".substr(~~a?7-a:6)};return a.replace(/[#237]/g,b)},c=b.createElement("style");c.setAttribute("type","text/css"),c.innerHTML='@font-face {\n  font-family: "PjsEmptyFont";\n  src: url(\'data:application/x-font-ttf;base64,'+a()+"')\n"+"       format('truetype');\n"+"}",b.head.appendChild(c);var d=b.createElement("span");d.style.cssText='position: absolute; top: 0; left: 0; opacity: 0; font-family: "PjsEmptyFont", fantasy;',d.innerHTML="AAAAAAAA",b.body.appendChild(d),this.template=d,this.initialized=!0},getElementWidth:function(a){return b.defaultView.getComputedStyle(a,"").getPropertyValue("width")},timeAttempted:0,pending:function(a){this.initialized||this.initialize();for(var c,d,e=this.getElementWidth(this.template),f=0;f<this.fontList.length;f++){if(c=this.fontList[f],d=this.getElementWidth(c),this.timeAttempted<4e3&&d===e)return this.timeAttempted+=a,!0;b.body.removeChild(c),this.fontList.splice(f--,1),this.timeAttempted=0}return 0===this.fontList.length?!1:!0},fontList:[],addedList:{},add:function(a){this.initialized||this.initialize();var c="object"==typeof a?a.fontFace:a,d="object"==typeof a?a.url:a;if(!this.addedList[c]){var e=b.createElement("style");e.setAttribute("type","text/css"),e.innerHTML="@font-face{\n  font-family: '"+c+"';\n  src:  url('"+d+"');\n}\n",b.head.appendChild(e),this.addedList[c]=!0;var f=b.createElement("span");f.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",f.style.fontFamily='"'+c+'", "PjsEmptyFont", fantasy',f.innerHTML="AAAAAAAA",b.body.appendChild(f),this.fontList.push(f)}}},v.PFont=F;var G=this.Processing=function(f,h){function q(a){G.debug("Unimplemented - "+a)}function md(a,b,c,e){var f=Cb.locations[a];f===d&&(f=s.getUniformLocation(b,c),Cb.locations[a]=f),null!==f&&(4===e.length?s.uniform4fv(f,e):3===e.length?s.uniform3fv(f,e):2===e.length?s.uniform2fv(f,e):s.uniform1f(f,e))}function nd(a,b,c,e){var f=Cb.locations[a];f===d&&(f=s.getUniformLocation(b,c),Cb.locations[a]=f),null!==f&&(4===e.length?s.uniform4iv(f,e):3===e.length?s.uniform3iv(f,e):2===e.length?s.uniform2iv(f,e):s.uniform1i(f,e))}function od(a,b,c,e,f){var g=Cb.locations[a];g===d&&(g=s.getUniformLocation(b,c),Cb.locations[a]=g),-1!==g&&(16===f.length?s.uniformMatrix4fv(g,e,f):9===f.length?s.uniformMatrix3fv(g,e,f):s.uniformMatrix2fv(g,e,f))}function pd(a,b,c,e,f){var g=Cb.attributes[a];g===d&&(g=s.getAttribLocation(b,c),Cb.attributes[a]=g),-1!==g&&(s.bindBuffer(s.ARRAY_BUFFER,f),s.vertexAttribPointer(g,e,s.FLOAT,!1,0,0),s.enableVertexAttribArray(g))}function qd(a,b,c){var e=Cb.attributes[a];e===d&&(e=s.getAttribLocation(b,c),Cb.attributes[a]=e),-1!==e&&s.disableVertexAttribArray(e)}function Ld(a,b,d,e){var f,g,h,i;if(3===ob){var j=r.color.toRGB(a,b,d);f=j[0],g=j[1],h=j[2]}else f=c.round(255*(a/hb)),g=c.round(255*(b/ib)),h=c.round(255*(d/jb));return i=c.round(255*(e/gb)),f=0>f?0:f,g=0>g?0:g,h=0>h?0:h,i=0>i?0:i,f=f>255?255:f,g=g>255?255:g,h=h>255?255:h,i=i>255?255:i,4278190080&i<<24|16711680&f<<16|65280&g<<8|255&h}function Md(a,b){var d;return 4278190080&a?(d=c.round(255*(b/gb)),d=d>255?255:d,d=0>d?0:d,a-(4278190080&a)+(4278190080&d<<24)):1===ob?Ld(a,a,a,b):3===ob?Ld(0,0,a/hb*jb,b):void 0}function Nd(a){if(hb>=a&&a>=0){if(1===ob)return Ld(a,a,a,gb);if(3===ob)return Ld(0,0,a/hb*jb,gb)}return a?(a>2147483647&&(a-=4294967296),a):void 0}function Od(a){var b,c,d;b=(255&a>>16)/255,c=(255&a>>8)/255,d=(255&a)/255;var g,h,e=r.max(r.max(b,c),d),f=r.min(r.min(b,c),d);return f===e?[0,0,e*jb]:(h=(e-f)/e,g=b===e?(c-d)/(e-f):c===e?2+(d-b)/(e-f):4+(b-c)/(e-f),g/=6,0>g?g+=1:g>1&&(g-=1),[g*hb,h*ib,e*jb])}function Pd(){s.save()}function Qd(){s.restore(),K=!0,E=!0}function Rd(){var a=(Date.now()-tb)/1e3;ub++;var b=ub/a;a>.5&&(tb=Date.now(),ub=0,r.__frameRate=b),r.frameCount++}function Td(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c),Sd.push({elem:a,type:b,fn:c})}function Ud(a){var b=a.elem,c=a.type,d=a.fn;b.removeEventListener?b.removeEventListener(c,d,!1):b.detachEvent&&b.detachEvent("on"+c,d)}function Vd(a,b,e,f,g,h){var i=0>a?e:b,j=0===g,k=g===d||0>g?0:g,l=c.abs(a);if(j)for(k=1,l*=10;c.abs(c.round(l)-l)>1e-6&&7>k;)++k,l*=10;else 0!==k&&(l*=c.pow(10,k));var m,n=2*l;if(c.floor(l)===l)m=l;else if(c.floor(n)===n){var o=c.floor(l);m=o+o%2}else m=c.round(l);for(var p="",q=f+k;q>0||m>0;)q--,p=""+m%10+p,m=c.floor(m/10);if(h!==d)for(var r=p.length-3-k;r>0;)p=p.substring(0,r)+h+p.substring(r),r-=3;return k>0?i+p.substring(0,p.length-k)+"."+p.substring(p.length-k,p.length):i+p}function Wd(a,b,c,d,e,f){if(a instanceof Array){for(var g=[],h=0,i=a.length;i>h;h++)g.push(Vd(a[h],b,c,d,e,f));return g}return Vd(a,b,c,d,e,f)}function Yd(a){var b=parseInt("0x"+a,16);return b>2147483647&&(b-=4294967296),b}function Zd(a){return Array.prototype.slice.call(a,1)}function _d(a){return"number"==typeof a?0!==a:"boolean"==typeof a?a:"string"==typeof a?"true"===a.toLowerCase():a instanceof Bd?49===a.code||84===a.code||116===a.code:void 0}function ae(a){return"number"==typeof a?a:"boolean"==typeof a?a?1:0:"string"==typeof a?parseFloat(a):a instanceof Bd?a.code:void 0}function be(a,b){if("number"==typeof a)return 4294967295&a;if("boolean"==typeof a)return a?1:0;if("string"==typeof a){var c=parseInt(a,b||10);return 4294967295&c}return a instanceof Bd?a.code:void 0}function de(a,b){var c=a||362436069,d=b||521288629,e=function(){return c=4294967295&36969*(65535&c)+(c>>>16),d=4294967295&18e3*(65535&d)+(d>>>16),4294967295&((65535&c)<<16|65535&d)};this.nextDouble=function(){var a=e()/4294967296;return 0>a?1+a:a},this.nextInt=e}function ee(a){function i(a,b,c,d){var e=15&a,f=8>e?b:c,g=4>e?c:12===e||14===e?b:d;return(0===(1&e)?f:-f)+(0===(2&e)?g:-g)}function j(a,b,c){var d=0===(1&a)?b:c;return 0===(2&a)?-d:d}function k(a,b){return 0===(1&a)?-b:b}function l(a,b,c){return b+a*(c-b)}var e,f,b=a!==d?new de(a):de.createRandomized(),g=new m(512);for(e=0;256>e;++e)g[e]=e;for(e=0;256>e;++e){var h=g[f=255&b.nextInt()];g[f]=g[e],g[e]=h}for(e=0;256>e;++e)g[e+256]=g[e];this.noise3d=function(a,b,d){var e=255&c.floor(a),f=255&c.floor(b),h=255&c.floor(d);a-=c.floor(a),b-=c.floor(b),d-=c.floor(d);var j=(3-2*a)*a*a,k=(3-2*b)*b*b,m=(3-2*d)*d*d,n=g[e]+f,o=g[n]+h,p=g[n+1]+h,q=g[e+1]+f,r=g[q]+h,s=g[q+1]+h;return l(m,l(k,l(j,i(g[o],a,b,d),i(g[r],a-1,b,d)),l(j,i(g[p],a,b-1,d),i(g[s],a-1,b-1,d))),l(k,l(j,i(g[o+1],a,b,d-1),i(g[r+1],a-1,b,d-1)),l(j,i(g[p+1],a,b-1,d-1),i(g[s+1],a-1,b-1,d-1))))},this.noise2d=function(a,b){var d=255&c.floor(a),e=255&c.floor(b);a-=c.floor(a),b-=c.floor(b);var f=(3-2*a)*a*a,h=(3-2*b)*b*b,i=g[d]+e,k=g[d+1]+e;return l(h,l(f,j(g[i],a,b),j(g[k],a-1,b)),l(f,j(g[i+1],a,b-1),j(g[k+1],a-1,b-1)))},this.noise1d=function(a){var b=255&c.floor(a);a-=c.floor(a);var d=(3-2*a)*a*a;return l(d,k(g[b],a),k(g[b+1],a-1))}}function he(){y&&(E&&(s.fillStyle=r.color.toString(B),E=!1),s.fill())}function ie(){H&&(K&&(s.strokeStyle=r.color.toString(J),K=!1),s.stroke())}function me(){he(),ie(),s.closePath()}function ue(a,c,e){var f=te.shift();f===d&&(f={},f.canvas=b.createElement("canvas"),f.context=f.canvas.getContext("2d")),te.push(f);var g=f.canvas,h=f.context,i=c||a.width,j=e||a.height;return g.width=i,g.height=j,a?"data"in a?h.putImageData(a,0,0):(h.clearRect(0,0,i,j),h.drawImage(a,0,0,i,j)):h.clearRect(0,0,i,j),f}function ve(a){return{getLength:function(a){return function(){if(a.isRemote)throw"Image is loaded remotely. Cannot get length.";return a.imageData.data.length?a.imageData.data.length/4:0}}(a),getPixel:function(a){return function(b){var c=4*b,d=a.imageData.data;if(a.isRemote)throw"Image is loaded remotely. Cannot get pixels.";return(255&d[c+3])<<24|(255&d[c])<<16|(255&d[c+1])<<8|255&d[c+2]}}(a),setPixel:function(a){return function(b,c){var d=4*b,e=a.imageData.data;if(a.isRemote)throw"Image is loaded remotely. Cannot set pixel.";e[d+0]=255&c>>16,e[d+1]=255&c>>8,e[d+2]=255&c,e[d+3]=255&c>>24,a.__isDirty=!0}}(a),toArray:function(a){return function(){var b=[],c=a.imageData.data,d=a.width*a.height;if(a.isRemote)throw"Image is loaded remotely. Cannot get pixels.";for(var e=0,f=0;d>e;e++,f+=4)b.push((255&c[f+3])<<24|(255&c[f])<<16|(255&c[f+1])<<8|255&c[f+2]);return b}}(a),set:function(a){return function(b){var c,d,e;if(this.isRemote)throw"Image is loaded remotely. Cannot set pixels.";d=a.imageData.data;for(var f=0,g=b.length;g>f;f++)e=b[f],c=4*f,d[c+0]=255&e>>16,d[c+1]=255&e>>8,d[c+2]=255&e,d[c+3]=255&e>>24;a.__isDirty=!0}}(a)}}function xe(a,b){var c;if(a>=r.width||0>a||0>b||b>=r.height)return 0;if(jc){var d=4*((0|a)+r.width*(0|b));return c=r.imageData.data,(255&c[d+3])<<24|(255&c[d])<<16|(255&c[d+1])<<8|255&c[d+2]}return c=r.toImageData(0|a,0|b,1,1).data,(255&c[3])<<24|(255&c[0])<<16|(255&c[1])<<8|255&c[2]}function ye(a,b,c){if(c.isRemote)throw"Image is loaded remotely. Cannot get x,y.";var d=4*b*c.width+4*a,e=c.imageData.data;return(255&e[d+3])<<24|(255&e[d])<<16|(255&e[d+1])<<8|255&e[d+2]}function ze(a,b,c,d){var e=new we(c,d,2);return e.fromImageData(r.toImageData(a,b,c,d)),e}function Ae(a,b,d,e,f){if(f.isRemote)throw"Image is loaded remotely. Cannot get x,y,w,h.";for(var g=new we(d,e,2),h=g.imageData.data,i=f.width,j=f.height,k=f.imageData.data,l=c.max(0,-b),m=c.max(0,-a),n=c.min(e,j-b),o=c.min(d,i-a),p=l;n>p;++p)for(var q=4*((b+p)*i+(a+m)),r=4*(p*d+m),s=m;o>s;++s)h[r++]=k[q++],h[r++]=k[q++],h[r++]=k[q++],h[r++]=k[q++];return g.__isDirty=!0,g}function Be(){jc&&(s=hc,jc=!1,r.updatePixels())}function Ce(){function a(a,b){function c(){Be(),s[b].apply(s,arguments)}a[b]=c}function b(a,b){function c(){return Be(),s[b]}function d(a){Be(),s[b]=a}r.defineProperty(a,b,{get:c,set:d})}for(var c in s)"function"==typeof s[c]?a(this,c):b(this,c)}function De(){jc||(r.loadPixels(),null===ic&&(hc=s,ic=new Ce),jc=!0,s=ic,kc=0)}function Ee(a,b,c){a<r.width&&a>=0&&b>=0&&b<r.height&&(De(),r.pixels.setPixel((0|a)+r.width*(0|b),c),++kc>lc&&Be())}function Fe(a,b,c,d){if(d.isRemote)throw"Image is loaded remotely. Cannot set x,y.";var e=r.color.toArray(c),f=4*b*d.width+4*a,g=d.imageData.data;g[f]=e[0],g[f+1]=e[1],g[f+2]=e[2],g[f+3]=e[3]}function Le(a){return a instanceof String?a:"number"==typeof a?a===(0|a)?a.toString():r.nf(a,0,3):null===a||a===d?"":a.toString()}function Me(a,b,c,d){var e,f;a.indexOf("\n")<0?(e=[a],f=1):(e=a.split(/\r?\n/g),f=e.length);var g=0;101===_b?g=dc+ec:3===_b?g=dc/2-(f-1)*fc/2:102===_b&&(g=-(ec+(f-1)*fc));for(var h=0;f>h;++h){var i=e[h];w.text$line(i,b,c+g,d,$b),g+=fc}}function Ne(a,b,d,e,f,g){if(0!==a.length&&0!==e&&0!==f&&!(cc>f)){for(var h=-1,i=0,j=0,k=[],l=0,m=a.length;m>l;l++){var n=a[l],o=" "===n,p=gc.measureTextWidth(n);if("\n"!==n&&e>=j+p)o&&(h=l),j+=p;else{if(h+1===i){if(!(l>0))return;h=l}"\n"===n?(k.push({text:a.substring(i,l),width:j}),i=l+1):(k.push({text:a.substring(i,h+1),width:j}),i=h+1),j=0,l=i-1}}m>i&&k.push({text:a.substring(i),width:j});var q=1,r=dc;3===$b?q=e/2:39===$b&&(q=e);var s=k.length,t=c.min(s,c.floor(f/fc));101===_b?r=dc+ec:3===_b?r=f/2-fc*(t/2-1):102===_b&&(r=ec+fc);var u,v,x;for(u=0;s>u&&(x=u*fc,!(r+x>f-ec));u++)v=k[u],w.text$line(v.text,b+q,d+r+x,g,$b)}}function Oe(a){w="3D"===a?new yd:"2D"===a?new xd:new zd;for(var b in zd.prototype)zd.prototype.hasOwnProperty(b)&&b.indexOf("$")<0&&(r[b]=w[b]);w.$init()}function Pe(a){return function(){return Oe("2D"),w[a].apply(this,arguments)}}function Qe(b){var d=b,e=0,f=0;if(r.pmouseX=r.mouseX,r.pmouseY=r.mouseY,d.offsetParent)do e+=d.offsetLeft,f+=d.offsetTop;while(d=d.offsetParent);d=b;do e-=d.scrollLeft||0,f-=d.scrollTop||0;while(d=d.parentNode);return e+=pc,f+=qc,e+=rc,f+=sc,e+=a.pageXOffset,f+=a.pageYOffset,{X:e,Y:f}}function Re(a,b){var c=Qe(a,b);r.mouseX=b.pageX-c.X,r.mouseY=b.pageY-c.Y}function Se(a){var c,b=Qe(a.changedTouches[0].target,a.changedTouches[0]);for(c=0;c<a.touches.length;c++){var d=a.touches[c];d.offsetX=d.pageX-b.X,d.offsetY=d.pageY-b.Y}for(c=0;c<a.targetTouches.length;c++){var e=a.targetTouches[c];e.offsetX=e.pageX-b.X,e.offsetY=e.pageY-b.Y}for(c=0;c<a.changedTouches.length;c++){var f=a.changedTouches[c];f.offsetX=f.pageX-b.X,f.offsetY=f.pageY-b.Y}return a}function Ue(a){var b=a.which||a.keyCode;switch(b){case 13:return 10;case 91:case 93:case 224:return 157;case 57392:return 17;case 46:return 127;case 45:return 155}return b}function Ve(a){var b=a.which||a.keyCode,c=a.shiftKey||a.ctrlKey||a.altKey||a.metaKey;switch(b){case 13:b=c?13:10;break;case 8:b=c?127:8}return new Bd(b)}function We(a){return"function"==typeof a.preventDefault?a.preventDefault():"function"==typeof a.stopPropagation&&a.stopPropagation(),!1}function Xe(){var a;for(a in mc)if(mc.hasOwnProperty(a))return r.__keyPressed=!0,void 0;r.__keyPressed=!1}function Ye(){r.__keyPressed=!1,mc=[],nc=null}function Ze(a,b){mc[a]=b,nc=null,r.key=b,r.keyCode=a,r.keyPressed(),r.keyCode=0,r.keyTyped(),Xe()}function $e(a){var b=Ue(a);if(127===b)return Ze(b,new Bd(127)),void 0;if(oc.indexOf(b)<0)return nc=b,void 0;var c=new Bd(65535);return r.key=c,r.keyCode=b,mc[b]=c,r.keyPressed(),nc=null,Xe(),We(a)}function _e(a){if(null!==nc){var b=nc,c=Ve(a);return Ze(b,c),We(a)}}function af(a){var b=Ue(a),c=mc[b];c!==d&&(r.key=c,r.keyCode=b,r.keyReleased(),delete mc[b],Xe())}if(!(this instanceof G))throw"called Processing constructor as if it were a function: missing 'new'.";var i,p=f===d&&h===d;if(i=p?b.createElement("canvas"):"string"==typeof f?b.getElementById(f):f,!(i instanceof HTMLCanvasElement))throw"called Processing constructor without passing canvas element reference or id.";var r=this;r.externals={canvas:i,context:d,sketch:d},r.name="Processing.js Instance",r.use3DContext=!1,r.focused=!1,r.breakShape=!1,r.glyphTable={},r.pmouseX=0,r.pmouseY=0,r.mouseX=0,r.mouseY=0,r.mouseButton=0,r.mouseScroll=0,r.mouseClicked=d,r.mouseDragged=d,r.mouseMoved=d,r.mousePressed=d,r.mouseReleased=d,r.mouseScrolled=d,r.mouseOver=d,r.mouseOut=d,r.touchStart=d,r.touchEnd=d,r.touchMove=d,r.touchCancel=d,r.key=d,r.keyCode=d,r.keyPressed=e,r.keyReleased=e,r.keyTyped=e,r.draw=d,r.setup=d,r.__mousePressed=!1,r.__keyPressed=!1,r.__frameRate=60,r.frameCount=0,r.width=100,r.height=100;var s,u,w,vb,wb,xb,yb,zb,Ab,Bb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Xb,Yb,Zb,hc,kc,pc,qc,rc,sc,y=!0,A=[1,1,1,1],B=4294967295,E=!0,H=!0,I=[0,0,0,1],J=4278190080,K=!0,L=1,M=!1,N=!1,O=!0,P=0,Q=0,R=3,S=0,T=0,U=0,V=0,W=60,X=1e3/W,Y="default",Z=i.style.cursor,$=20,ab=[],bb=0,cb=20,db=!1,eb=-3355444,fb=20,gb=255,hb=255,ib=255,jb=255,mb=0,nb=0,ob=1,pb=null,qb=null,sb=Date.now(),tb=sb,ub=0,Cb={attributes:{},locations:{}},Ub={width:0,height:0},Vb=2,Wb=!1,$b=37,_b=0,ac=4,bc="Arial",cc=12,dc=9,ec=2,fc=14,gc=F.get(bc,cc),ic=null,jc=!1,lc=1e3,mc=[],nc=null,oc=[16,17,18,20,33,34,35,36,37,38,39,40,144,155,112,113,114,115,116,117,118,119,120,121,122,123,157];
  b.defaultView&&b.defaultView.getComputedStyle&&(pc=parseInt(b.defaultView.getComputedStyle(i,null).paddingLeft,10)||0,qc=parseInt(b.defaultView.getComputedStyle(i,null).paddingTop,10)||0,rc=parseInt(b.defaultView.getComputedStyle(i,null).borderLeftWidth,10)||0,sc=parseInt(b.defaultView.getComputedStyle(i,null).borderTopWidth,10)||0);var Bc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,tc=0,uc=0,vc=0,wc=[],xc=[],yc=[],zc=new j(720),Ac=new j(720),Lc=!1,Mc=!1,Nc=60*(c.PI/180),Oc=r.width/2,Pc=r.height/2,Qc=Pc/c.tan(Nc/2),Rc=Qc/10,Sc=10*Qc,Tc=r.width/r.height,Uc=[],Vc=[],Wc=0,Xc=!1,Yc=!1,Zc=!0,$c=0,_c=[],ad=new j([.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5]),bd=new j([.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5]),cd=new j([0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]),dd=new j([0,0,0,0,1,0,1,1,0,1,0,0]),ed=new j([0,0,1,0,0,1,0,0,1,0,0,1]),fd="varying vec4 vFrontColor;attribute vec3 aVertex;attribute vec4 aColor;uniform mat4 uView;uniform mat4 uProjection;uniform float uPointSize;void main(void) {  vFrontColor = aColor;  gl_PointSize = uPointSize;  gl_Position = uProjection * uView * vec4(aVertex, 1.0);}",gd="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vFrontColor;uniform bool uSmooth;void main(void){  if(uSmooth == true){    float dist = distance(gl_PointCoord, vec2(0.5));    if(dist > 0.5){      discard;    }  }  gl_FragColor = vFrontColor;}",hd="varying vec4 vFrontColor;attribute vec3 aVertex;attribute vec2 aTextureCoord;uniform vec4 uColor;uniform mat4 uModel;uniform mat4 uView;uniform mat4 uProjection;uniform float uPointSize;varying vec2 vTextureCoord;void main(void) {  gl_PointSize = uPointSize;  vFrontColor = uColor;  gl_Position = uProjection * uView * uModel * vec4(aVertex, 1.0);  vTextureCoord = aTextureCoord;}",id="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vFrontColor;varying vec2 vTextureCoord;uniform sampler2D uSampler;uniform int uIsDrawingText;uniform bool uSmooth;void main(void){  if(uSmooth == true){    float dist = distance(gl_PointCoord, vec2(0.5));    if(dist > 0.5){      discard;    }  }  if(uIsDrawingText == 1){    float alpha = texture2D(uSampler, vTextureCoord).a;    gl_FragColor = vec4(vFrontColor.rgb * alpha, alpha);  }  else{    gl_FragColor = vFrontColor;  }}",jd=/Windows/.test(navigator.userAgent),kd="varying vec4 vFrontColor;attribute vec3 aVertex;attribute vec3 aNormal;attribute vec4 aColor;attribute vec2 aTexture;varying   vec2 vTexture;uniform vec4 uColor;uniform bool uUsingMat;uniform vec3 uSpecular;uniform vec3 uMaterialEmissive;uniform vec3 uMaterialAmbient;uniform vec3 uMaterialSpecular;uniform float uShininess;uniform mat4 uModel;uniform mat4 uView;uniform mat4 uProjection;uniform mat4 uNormalTransform;uniform int uLightCount;uniform vec3 uFalloff;struct Light {  int type;  vec3 color;  vec3 position;  vec3 direction;  float angle;  vec3 halfVector;  float concentration;};uniform Light uLights0;uniform Light uLights1;uniform Light uLights2;uniform Light uLights3;uniform Light uLights4;uniform Light uLights5;uniform Light uLights6;uniform Light uLights7;Light getLight(int index){  if(index == 0) return uLights0;  if(index == 1) return uLights1;  if(index == 2) return uLights2;  if(index == 3) return uLights3;  if(index == 4) return uLights4;  if(index == 5) return uLights5;  if(index == 6) return uLights6;  return uLights7;}void AmbientLight( inout vec3 totalAmbient, in vec3 ecPos, in Light light ) {  float d = length( light.position - ecPos );  float attenuation = 1.0 / ( uFalloff[0] + ( uFalloff[1] * d ) + ( uFalloff[2] * d * d ));  totalAmbient += light.color * attenuation;}void DirectionalLight( inout vec3 col, inout vec3 spec, in vec3 vertNormal, in vec3 ecPos, in Light light ) {  float powerFactor = 0.0;  float nDotVP = max(0.0, dot( vertNormal, normalize(-light.position) ));  float nDotVH = max(0.0, dot( vertNormal, normalize(-light.position-normalize(ecPos) )));  if( nDotVP != 0.0 ){    powerFactor = pow( nDotVH, uShininess );  }  col += light.color * nDotVP;  spec += uSpecular * powerFactor;}void PointLight( inout vec3 col, inout vec3 spec, in vec3 vertNormal, in vec3 ecPos, in Light light ) {  float powerFactor;   vec3 VP = light.position - ecPos;  float d = length( VP );   VP = normalize( VP );  float attenuation = 1.0 / ( uFalloff[0] + ( uFalloff[1] * d ) + ( uFalloff[2] * d * d ));  float nDotVP = max( 0.0, dot( vertNormal, VP ));  vec3 halfVector = normalize( VP - normalize(ecPos) );  float nDotHV = max( 0.0, dot( vertNormal, halfVector ));  if( nDotVP == 0.0 ) {    powerFactor = 0.0;  }  else {    powerFactor = pow( nDotHV, uShininess );  }  spec += uSpecular * powerFactor * attenuation;  col += light.color * nDotVP * attenuation;}void SpotLight( inout vec3 col, inout vec3 spec, in vec3 vertNormal, in vec3 ecPos, in Light light ) {  float spotAttenuation;  float powerFactor = 0.0;  vec3 VP = light.position - ecPos;  vec3 ldir = normalize( -light.direction );  float d = length( VP );  VP = normalize( VP );  float attenuation = 1.0 / ( uFalloff[0] + ( uFalloff[1] * d ) + ( uFalloff[2] * d * d ) );  float spotDot = dot( VP, ldir );"+(jd?"  spotAttenuation = 1.0; ":"  if( spotDot > cos( light.angle ) ) {    spotAttenuation = pow( spotDot, light.concentration );  }  else{    spotAttenuation = 0.0;  }  attenuation *= spotAttenuation;")+"  float nDotVP = max( 0.0, dot( vertNormal, VP ) );"+"  vec3 halfVector = normalize( VP - normalize(ecPos) );"+"  float nDotHV = max( 0.0, dot( vertNormal, halfVector ) );"+"  if( nDotVP != 0.0 ) {"+"    powerFactor = pow( nDotHV, uShininess );"+"  }"+"  spec += uSpecular * powerFactor * attenuation;"+"  col += light.color * nDotVP * attenuation;"+"}"+"void main(void) {"+"  vec3 finalAmbient = vec3( 0.0 );"+"  vec3 finalDiffuse = vec3( 0.0 );"+"  vec3 finalSpecular = vec3( 0.0 );"+"  vec4 col = uColor;"+"  if ( uColor[0] == -1.0 ){"+"    col = aColor;"+"  }"+"  vec3 norm = normalize(vec3( uNormalTransform * vec4( aNormal, 0.0 ) ));"+"  vec4 ecPos4 = uView * uModel * vec4(aVertex, 1.0);"+"  vec3 ecPos = (vec3(ecPos4))/ecPos4.w;"+"  if( uLightCount == 0 ) {"+"    vFrontColor = col + vec4(uMaterialSpecular, 1.0);"+"  }"+"  else {"+"    for( int i = 0; i < 8; i++ ) {"+"      Light l = getLight(i);"+"      if( i >= uLightCount ){"+"        break;"+"      }"+"      if( l.type == 0 ) {"+"        AmbientLight( finalAmbient, ecPos, l );"+"      }"+"      else if( l.type == 1 ) {"+"        DirectionalLight( finalDiffuse, finalSpecular, norm, ecPos, l );"+"      }"+"      else if( l.type == 2 ) {"+"        PointLight( finalDiffuse, finalSpecular, norm, ecPos, l );"+"      }"+"      else {"+"        SpotLight( finalDiffuse, finalSpecular, norm, ecPos, l );"+"      }"+"    }"+"   if( uUsingMat == false ) {"+"     vFrontColor = vec4("+"       vec3( col ) * finalAmbient +"+"       vec3( col ) * finalDiffuse +"+"       vec3( col ) * finalSpecular,"+"       col[3] );"+"   }"+"   else{"+"     vFrontColor = vec4( "+"       uMaterialEmissive + "+"       (vec3(col) * uMaterialAmbient * finalAmbient ) + "+"       (vec3(col) * finalDiffuse) + "+"       (uMaterialSpecular * finalSpecular), "+"       col[3] );"+"    }"+"  }"+"  vTexture.xy = aTexture.xy;"+"  gl_Position = uProjection * uView * uModel * vec4( aVertex, 1.0 );"+"}",ld="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vFrontColor;uniform sampler2D uSampler;uniform bool uUsingTexture;varying vec2 vTexture;void main(void){  if( uUsingTexture ){    gl_FragColor = vec4(texture2D(uSampler, vTexture.xy)) * vFrontColor;  }  else{    gl_FragColor = vFrontColor;  }}",rd=function(a,b,c){var d=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(d,b),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))throw a.getShaderInfoLog(d);var e=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(e,c),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw a.getShaderInfoLog(e);var f=a.createProgram();if(a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f),!a.getProgramParameter(f,a.LINK_STATUS))throw"Error linking shaders.";return f},sd=function(a,b,c,d){return{x:a,y:b,w:c,h:d}},td=sd,ud=function(a,b,c,d,e){return{x:a,y:b,w:e?c:c-a,h:e?d:d-b}},vd=function(a,b,c,d){return{x:a-c/2,y:b-d/2,w:c,h:d}},wd=function(){},xd=function(){},yd=function(){},zd=function(){};xd.prototype=new wd,xd.prototype.constructor=xd,yd.prototype=new wd,yd.prototype.constructor=yd,zd.prototype=new wd,zd.prototype.constructor=zd,wd.prototype.a3DOnlyFunction=e;var Ad={},Bd=r.Character=function(a){return this.code="string"==typeof a&&1===a.length?a.charCodeAt(0):"number"==typeof a?a:a instanceof Bd?a:0/0,Ad[this.code]===d?Ad[this.code]=this:Ad[this.code]};Bd.prototype.toString=function(){return String.fromCharCode(this.code)},Bd.prototype.valueOf=function(){return this.code};var Cd=r.PShape=function(a){this.family=a||0,this.visible=!0,this.style=!0,this.children=[],this.nameTable=[],this.params=[],this.name="",this.image=null,this.matrix=null,this.kind=null,this.close=null,this.width=null,this.height=null,this.parent=null};Cd.prototype={isVisible:function(){return this.visible},setVisible:function(a){this.visible=a},disableStyle:function(){this.style=!1;for(var a=0,b=this.children.length;b>a;a++)this.children[a].disableStyle()},enableStyle:function(){this.style=!0;for(var a=0,b=this.children.length;b>a;a++)this.children[a].enableStyle()},getFamily:function(){return this.family},getWidth:function(){return this.width},getHeight:function(){return this.height},setName:function(a){this.name=a},getName:function(){return this.name},draw:function(a){a=a||r,this.visible&&(this.pre(a),this.drawImpl(a),this.post(a))},drawImpl:function(a){0===this.family?this.drawGroup(a):1===this.family?this.drawPrimitive(a):3===this.family?this.drawGeometry(a):21===this.family&&this.drawPath(a)},drawPath:function(a){var b,c;if(0!==this.vertices.length){if(a.beginShape(),0===this.vertexCodes.length)if(2===this.vertices[0].length)for(b=0,c=this.vertices.length;c>b;b++)a.vertex(this.vertices[b][0],this.vertices[b][1]);else for(b=0,c=this.vertices.length;c>b;b++)a.vertex(this.vertices[b][0],this.vertices[b][1],this.vertices[b][2]);else{var d=0;if(2===this.vertices[0].length)for(b=0,c=this.vertexCodes.length;c>b;b++)0===this.vertexCodes[b]?(a.vertex(this.vertices[d][0],this.vertices[d][1],this.vertices[d].moveTo),a.breakShape=!1,d++):1===this.vertexCodes[b]?(a.bezierVertex(this.vertices[d+0][0],this.vertices[d+0][1],this.vertices[d+1][0],this.vertices[d+1][1],this.vertices[d+2][0],this.vertices[d+2][1]),d+=3):2===this.vertexCodes[b]?(a.curveVertex(this.vertices[d][0],this.vertices[d][1]),d++):3===this.vertexCodes[b]&&(a.breakShape=!0);else for(b=0,c=this.vertexCodes.length;c>b;b++)0===this.vertexCodes[b]?(a.vertex(this.vertices[d][0],this.vertices[d][1],this.vertices[d][2]),this.vertices[d].moveTo===!0?Uc[Uc.length-1].moveTo=!0:this.vertices[d].moveTo===!1&&(Uc[Uc.length-1].moveTo=!1),a.breakShape=!1):1===this.vertexCodes[b]?(a.bezierVertex(this.vertices[d+0][0],this.vertices[d+0][1],this.vertices[d+0][2],this.vertices[d+1][0],this.vertices[d+1][1],this.vertices[d+1][2],this.vertices[d+2][0],this.vertices[d+2][1],this.vertices[d+2][2]),d+=3):2===this.vertexCodes[b]?(a.curveVertex(this.vertices[d][0],this.vertices[d][1],this.vertices[d][2]),d++):3===this.vertexCodes[b]&&(a.breakShape=!0)}a.endShape(this.close?2:1)}},drawGeometry:function(a){var b,c;if(a.beginShape(this.kind),this.style)for(b=0,c=this.vertices.length;c>b;b++)a.vertex(this.vertices[b]);else for(b=0,c=this.vertices.length;c>b;b++){var d=this.vertices[b];0===d[2]?a.vertex(d[0],d[1]):a.vertex(d[0],d[1],d[2])}a.endShape()},drawGroup:function(a){for(var b=0,c=this.children.length;c>b;b++)this.children[b].draw(a)},drawPrimitive:function(a){if(2===this.kind)a.point(this.params[0],this.params[1]);else if(4===this.kind)4===this.params.length?a.line(this.params[0],this.params[1],this.params[2],this.params[3]):a.line(this.params[0],this.params[1],this.params[2],this.params[3],this.params[4],this.params[5]);else if(8===this.kind)a.triangle(this.params[0],this.params[1],this.params[2],this.params[3],this.params[4],this.params[5]);else if(16===this.kind)a.quad(this.params[0],this.params[1],this.params[2],this.params[3],this.params[4],this.params[5],this.params[6],this.params[7]);else if(30===this.kind)if(null!==this.image){var b=td;a.imageMode(0),a.image(this.image,this.params[0],this.params[1],this.params[2],this.params[3]),td=b}else{var c=Q;a.rectMode(0),a.rect(this.params[0],this.params[1],this.params[2],this.params[3]),Q=c}else if(31===this.kind){var d=R;a.ellipseMode(0),a.ellipse(this.params[0],this.params[1],this.params[2],this.params[3]),R=d}else if(32===this.kind){var e=R;a.ellipseMode(0),a.arc(this.params[0],this.params[1],this.params[2],this.params[3],this.params[4],this.params[5]),R=e}else 41===this.kind?1===this.params.length?a.box(this.params[0]):a.box(this.params[0],this.params[1],this.params[2]):40===this.kind&&a.sphere(this.params[0])},pre:function(a){this.matrix&&(a.pushMatrix(),a.transform(this.matrix)),this.style&&(a.pushStyle(),this.styles(a))},post:function(a){this.matrix&&a.popMatrix(),this.style&&a.popStyle()},styles:function(a){this.stroke?(a.stroke(this.strokeColor),a.strokeWeight(this.strokeWeight),a.strokeCap(this.strokeCap),a.strokeJoin(this.strokeJoin)):a.noStroke(),this.fill?a.fill(this.fillColor):a.noFill()},getChild:function(a){var b,c;if("number"==typeof a)return this.children[a];var d;if(""===a||this.name===a)return this;if(this.nameTable.length>0){for(b=0,c=this.nameTable.length;c>b||d;b++)if(this.nameTable[b].getName===a){d=this.nameTable[b];break}if(d)return d}for(b=0,c=this.children.length;c>b;b++)if(d=this.children[b].getChild(a))return d;return null},getChildCount:function(){return this.children.length},addChild:function(a){this.children.push(a),a.parent=this,null!==a.getName()&&this.addName(a.getName(),a)},addName:function(a,b){null!==this.parent?this.parent.addName(a,b):this.nameTable.push([a,b])},translate:function(){2===arguments.length?(this.checkMatrix(2),this.matrix.translate(arguments[0],arguments[1])):(this.checkMatrix(3),this.matrix.translate(arguments[0],arguments[1],0))},checkMatrix:function(a){null===this.matrix?this.matrix=2===a?new r.PMatrix2D:new r.PMatrix3D:3===a&&this.matrix instanceof r.PMatrix2D&&(this.matrix=new r.PMatrix3D)},rotateX:function(a){this.rotate(a,1,0,0)},rotateY:function(a){this.rotate(a,0,1,0)},rotateZ:function(a){this.rotate(a,0,0,1)},rotate:function(){1===arguments.length?(this.checkMatrix(2),this.matrix.rotate(arguments[0])):(this.checkMatrix(3),this.matrix.rotate(arguments[0],arguments[1],arguments[2],arguments[3]))},scale:function(){2===arguments.length?(this.checkMatrix(2),this.matrix.scale(arguments[0],arguments[1])):3===arguments.length?(this.checkMatrix(2),this.matrix.scale(arguments[0],arguments[1],arguments[2])):(this.checkMatrix(2),this.matrix.scale(arguments[0]))},resetMatrix:function(){this.checkMatrix(2),this.matrix.reset()},applyMatrix:function(a){1===arguments.length?this.applyMatrix(a.elements[0],a.elements[1],0,a.elements[2],a.elements[3],a.elements[4],0,a.elements[5],0,0,1,0,0,0,0,1):6===arguments.length?(this.checkMatrix(2),this.matrix.apply(arguments[0],arguments[1],arguments[2],0,arguments[3],arguments[4],arguments[5],0,0,0,1,0,0,0,0,1)):16===arguments.length&&(this.checkMatrix(3),this.matrix.apply(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15]))}};var Dd=r.PShapeSVG=function(){if(r.PShape.call(this),1===arguments.length){if(this.element=arguments[0],this.vertexCodes=[],this.vertices=[],this.opacity=1,this.stroke=!1,this.strokeColor=4278190080,this.strokeWeight=1,this.strokeCap="butt",this.strokeJoin="miter",this.strokeGradient=null,this.strokeGradientPaint=null,this.strokeName=null,this.strokeOpacity=1,this.fill=!0,this.fillColor=4278190080,this.fillGradient=null,this.fillGradientPaint=null,this.fillName=null,this.fillOpacity=1,"svg"!==this.element.getName())throw"root is not <svg>, it's <"+this.element.getName()+">"}else 2===arguments.length&&("string"==typeof arguments[1]?arguments[1].indexOf(".svg")>-1&&(this.element=new r.XMLElement(r,arguments[1]),this.vertexCodes=[],this.vertices=[],this.opacity=1,this.stroke=!1,this.strokeColor=4278190080,this.strokeWeight=1,this.strokeCap="butt",this.strokeJoin="miter",this.strokeGradient="",this.strokeGradientPaint="",this.strokeName="",this.strokeOpacity=1,this.fill=!0,this.fillColor=4278190080,this.fillGradient=null,this.fillGradientPaint=null,this.fillOpacity=1):arguments[0]&&(this.element=arguments[1],this.vertexCodes=arguments[0].vertexCodes.slice(),this.vertices=arguments[0].vertices.slice(),this.stroke=arguments[0].stroke,this.strokeColor=arguments[0].strokeColor,this.strokeWeight=arguments[0].strokeWeight,this.strokeCap=arguments[0].strokeCap,this.strokeJoin=arguments[0].strokeJoin,this.strokeGradient=arguments[0].strokeGradient,this.strokeGradientPaint=arguments[0].strokeGradientPaint,this.strokeName=arguments[0].strokeName,this.fill=arguments[0].fill,this.fillColor=arguments[0].fillColor,this.fillGradient=arguments[0].fillGradient,this.fillGradientPaint=arguments[0].fillGradientPaint,this.fillName=arguments[0].fillName,this.strokeOpacity=arguments[0].strokeOpacity,this.fillOpacity=arguments[0].fillOpacity,this.opacity=arguments[0].opacity));this.name=this.element.getStringAttribute("id");var a=this.element.getStringAttribute("display","inline");this.visible="none"!==a;var b=this.element.getAttribute("transform");b&&(this.matrix=this.parseMatrix(b));var c=this.element.getStringAttribute("viewBox");if(null!==c){var d=c.split(" ");this.width=d[2],this.height=d[3]}var e=this.element.getStringAttribute("width"),f=this.element.getStringAttribute("height");if(null!==e)this.width=this.parseUnitSize(e),this.height=this.parseUnitSize(f);else if(0===this.width||0===this.height)throw this.width=1,this.height=1,"The width and/or height is not readable in the <svg> tag of this file.";this.parseColors(this.element),this.parseChildren(this.element)};Dd.prototype=new Cd,Dd.prototype.parseMatrix=function(){function a(a){var b=[];return a.replace(/\((.*?)\)/,function(){return function(a,c){b=c.replace(/,+/g," ").split(/\s+/)}}()),b}return function(b){this.checkMatrix(2);var c=[];if(b.replace(/\s*(\w+)\((.*?)\)/g,function(a){c.push(r.trim(a))}),0===c.length)return null;for(var d=0,e=c.length;e>d;d++){var f=a(c[d]);if(-1!==c[d].indexOf("matrix"))this.matrix.set(f[0],f[2],f[4],f[1],f[3],f[5]);else if(-1!==c[d].indexOf("translate")){var g=f[0],h=2===f.length?f[1]:0;this.matrix.translate(g,h)}else if(-1!==c[d].indexOf("scale")){var i=f[0],j=2===f.length?f[1]:f[0];this.matrix.scale(i,j)}else if(-1!==c[d].indexOf("rotate")){var k=f[0];1===f.length?this.matrix.rotate(r.radians(k)):3===f.length&&(this.matrix.translate(f[1],f[2]),this.matrix.rotate(r.radians(f[0])),this.matrix.translate(-f[1],-f[2]))}else-1!==c[d].indexOf("skewX")?this.matrix.skewX(parseFloat(f[0])):-1!==c[d].indexOf("skewY")?this.matrix.skewY(f[0]):-1!==c[d].indexOf("shearX")?this.matrix.shearX(f[0]):-1!==c[d].indexOf("shearY")&&this.matrix.shearY(f[0])}return this.matrix}}(),Dd.prototype.parseChildren=function(a){for(var b=a.getChildren(),c=new r.PShape,d=0,e=b.length;e>d;d++){var f=this.parseChild(b[d]);f&&c.addChild(f)}this.children.push(c)},Dd.prototype.getName=function(){return this.name},Dd.prototype.parseChild=function(a){var c,b=a.getName();return"g"===b?c=new Dd(this,a):"defs"===b?c=new Dd(this,a):"line"===b?(c=new Dd(this,a),c.parseLine()):"circle"===b?(c=new Dd(this,a),c.parseEllipse(!0)):"ellipse"===b?(c=new Dd(this,a),c.parseEllipse(!1)):"rect"===b?(c=new Dd(this,a),c.parseRect()):"polygon"===b?(c=new Dd(this,a),c.parsePoly(!0)):"polyline"===b?(c=new Dd(this,a),c.parsePoly(!1)):"path"===b?(c=new Dd(this,a),c.parsePath()):"radialGradient"===b?q("PShapeSVG.prototype.parseChild, name = radialGradient"):"linearGradient"===b?q("PShapeSVG.prototype.parseChild, name = linearGradient"):"text"===b?q("PShapeSVG.prototype.parseChild, name = text"):"filter"===b?q("PShapeSVG.prototype.parseChild, name = filter"):"mask"===b?q("PShapeSVG.prototype.parseChild, name = mask"):e(),c},Dd.prototype.parsePath=function(){this.family=21,this.kind=0;var c=r.trim(this.element.getStringAttribute("d").replace(/[\s,]+/g," "));if(null!==c){c=r.__toCharArray(c);for(var x,y,z,A,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,s=0,t=0,u="",v=[],w=!1;s<c.length;)if(t=c[s].valueOf(),t>=65&&90>=t||t>=97&&122>=t){if(z=s,s++,s<c.length)for(v=[],t=c[s].valueOf();!(t>=65&&90>=t||t>=97&&100>=t||t>=102&&122>=t)&&w===!1;)32===t?(""!==u&&(v.push(parseFloat(u)),u=""),s++):45===t?101===c[s-1].valueOf()?(u+=c[s].toString(),s++):(""!==u&&v.push(parseFloat(u)),u=c[s].toString(),s++):(u+=c[s].toString(),s++),s===c.length?w=!0:t=c[s].valueOf();if(""!==u&&(v.push(parseFloat(u)),u=""),y=c[z],t=y.valueOf(),77===t){if(v.length>=2&&0===v.length%2&&(d=v[0],e=v[1],this.parsePathMoveto(d,e),v.length>2))for(z=2,A=v.length;A>z;z+=2)d=v[z],e=v[z+1],this.parsePathLineto(d,e)}else if(109===t){if(v.length>=2&&0===v.length%2&&(d+=v[0],e+=v[1],this.parsePathMoveto(d,e),v.length>2))for(z=2,A=v.length;A>z;z+=2)d+=v[z],e+=v[z+1],this.parsePathLineto(d,e)}else if(76===t){if(v.length>=2&&0===v.length%2)for(z=0,A=v.length;A>z;z+=2)d=v[z],e=v[z+1],this.parsePathLineto(d,e)}else if(108===t){if(v.length>=2&&0===v.length%2)for(z=0,A=v.length;A>z;z+=2)d+=v[z],e+=v[z+1],this.parsePathLineto(d,e)}else if(72===t)for(z=0,A=v.length;A>z;z++)d=v[z],this.parsePathLineto(d,e);else if(104===t)for(z=0,A=v.length;A>z;z++)d+=v[z],this.parsePathLineto(d,e);else if(86===t)for(z=0,A=v.length;A>z;z++)e=v[z],this.parsePathLineto(d,e);else if(118===t)for(z=0,A=v.length;A>z;z++)e+=v[z],this.parsePathLineto(d,e);else if(67===t){if(v.length>=6&&0===v.length%6)for(z=0,A=v.length;A>z;z+=6)h=v[z],j=v[z+1],i=v[z+2],k=v[z+3],l=v[z+4],m=v[z+5],this.parsePathCurveto(h,j,i,k,l,m),d=l,e=m}else if(99===t){if(v.length>=6&&0===v.length%6)for(z=0,A=v.length;A>z;z+=6)h=d+v[z],j=e+v[z+1],i=d+v[z+2],k=e+v[z+3],l=d+v[z+4],m=e+v[z+5],this.parsePathCurveto(h,j,i,k,l,m),d=l,e=m}else if(83===t){if(v.length>=4&&0===v.length%4)for(z=0,A=v.length;A>z;z+=4)"c"===x.toLowerCase()||"s"===x.toLowerCase()?(n=this.vertices[this.vertices.length-2][0],o=this.vertices[this.vertices.length-2][1],p=this.vertices[this.vertices.length-1][0],q=this.vertices[this.vertices.length-1][1],h=p+(p-n),j=q+(q-o)):(h=this.vertices[this.vertices.length-1][0],j=this.vertices[this.vertices.length-1][1]),i=v[z],k=v[z+1],l=v[z+2],m=v[z+3],this.parsePathCurveto(h,j,i,k,l,m),d=l,e=m}else if(115===t){if(v.length>=4&&0===v.length%4)for(z=0,A=v.length;A>z;z+=4)"c"===x.toLowerCase()||"s"===x.toLowerCase()?(n=this.vertices[this.vertices.length-2][0],o=this.vertices[this.vertices.length-2][1],p=this.vertices[this.vertices.length-1][0],q=this.vertices[this.vertices.length-1][1],h=p+(p-n),j=q+(q-o)):(h=this.vertices[this.vertices.length-1][0],j=this.vertices[this.vertices.length-1][1]),i=d+v[z],k=e+v[z+1],l=d+v[z+2],m=e+v[z+3],this.parsePathCurveto(h,j,i,k,l,m),d=l,e=m}else if(81===t){if(v.length>=4&&0===v.length%4)for(z=0,A=v.length;A>z;z+=4)f=v[z],g=v[z+1],l=v[z+2],m=v[z+3],this.parsePathQuadto(d,e,f,g,l,m),d=l,e=m}else if(113===t){if(v.length>=4&&0===v.length%4)for(z=0,A=v.length;A>z;z+=4)f=d+v[z],g=e+v[z+1],l=d+v[z+2],m=e+v[z+3],this.parsePathQuadto(d,e,f,g,l,m),d=l,e=m}else if(84===t){if(v.length>=2&&0===v.length%2)for(z=0,A=v.length;A>z;z+=2)"q"===x.toLowerCase()||"t"===x.toLowerCase()?(n=this.vertices[this.vertices.length-2][0],o=this.vertices[this.vertices.length-2][1],p=this.vertices[this.vertices.length-1][0],q=this.vertices[this.vertices.length-1][1],f=p+(p-n),g=q+(q-o)):(f=d,g=e),l=v[z],m=v[z+1],this.parsePathQuadto(d,e,f,g,l,m),d=l,e=m}else if(116===t){if(v.length>=2&&0===v.length%2)for(z=0,A=v.length;A>z;z+=2)"q"===x.toLowerCase()||"t"===x.toLowerCase()?(n=this.vertices[this.vertices.length-2][0],o=this.vertices[this.vertices.length-2][1],p=this.vertices[this.vertices.length-1][0],q=this.vertices[this.vertices.length-1][1],f=p+(p-n),g=q+(q-o)):(f=d,g=e),l=d+v[z],m=e+v[z+1],this.parsePathQuadto(d,e,f,g,l,m),d=l,e=m}else(90===t||122===t)&&(this.close=!0);x=y.toString()}else s++}},Dd.prototype.parsePathQuadto=function(a,b,c,d,e,f){if(!(this.vertices.length>0))throw"Path must start with M/m";this.parsePathCode(1),this.parsePathVertex(a+2*(c-a)/3,b+2*(d-b)/3),this.parsePathVertex(e+2*(c-e)/3,f+2*(d-f)/3),this.parsePathVertex(e,f)},Dd.prototype.parsePathCurveto=function(a,b,c,d,e,f){if(!(this.vertices.length>0))throw"Path must start with M/m";this.parsePathCode(1),this.parsePathVertex(a,b),this.parsePathVertex(c,d),this.parsePathVertex(e,f)},Dd.prototype.parsePathLineto=function(a,b){if(!(this.vertices.length>0))throw"Path must start with M/m";this.parsePathCode(0),this.parsePathVertex(a,b),this.vertices[this.vertices.length-1].moveTo=!1},Dd.prototype.parsePathMoveto=function(a,b){this.vertices.length>0&&this.parsePathCode(3),this.parsePathCode(0),this.parsePathVertex(a,b),this.vertices[this.vertices.length-1].moveTo=!0},Dd.prototype.parsePathVertex=function(a,b){var c=[];c[0]=a,c[1]=b,this.vertices.push(c)},Dd.prototype.parsePathCode=function(a){this.vertexCodes.push(a)},Dd.prototype.parsePoly=function(a){this.family=21,this.close=a;var b=r.trim(this.element.getStringAttribute("points").replace(/[,\s]+/g," "));if(null!==b){var c=b.split(" ");if(0!==c.length%2)throw"Error parsing polygon points: odd number of coordinates provided";for(var d=0,e=c.length;e>d;d++){var f=[];f[0]=c[d],f[1]=c[++d],this.vertices.push(f)}}},Dd.prototype.parseRect=function(){if(this.kind=30,this.family=1,this.params=[],this.params[0]=this.element.getFloatAttribute("x"),this.params[1]=this.element.getFloatAttribute("y"),this.params[2]=this.element.getFloatAttribute("width"),this.params[3]=this.element.getFloatAttribute("height"),this.params[2]<0||this.params[3]<0)throw"svg error: negative width or height found while parsing <rect>"},Dd.prototype.parseEllipse=function(a){this.kind=31,this.family=1,this.params=[],this.params[0]=0|this.element.getFloatAttribute("cx"),this.params[1]=0|this.element.getFloatAttribute("cy");var b,c;if(a){if(b=c=this.element.getFloatAttribute("r"),0>b)throw"svg error: negative radius found while parsing <circle>"}else if(b=this.element.getFloatAttribute("rx"),c=this.element.getFloatAttribute("ry"),0>b||0>c)throw"svg error: negative x-axis radius or y-axis radius found while parsing <ellipse>";this.params[0]-=b,this.params[1]-=c,this.params[2]=2*b,this.params[3]=2*c},Dd.prototype.parseLine=function(){this.kind=4,this.family=1,this.params=[],this.params[0]=this.element.getFloatAttribute("x1"),this.params[1]=this.element.getFloatAttribute("y1"),this.params[2]=this.element.getFloatAttribute("x2"),this.params[3]=this.element.getFloatAttribute("y2")},Dd.prototype.parseColors=function(a){if(a.hasAttribute("opacity")&&this.setOpacity(a.getAttribute("opacity")),a.hasAttribute("stroke")&&this.setStroke(a.getAttribute("stroke")),a.hasAttribute("stroke-width")&&this.setStrokeWeight(a.getAttribute("stroke-width")),a.hasAttribute("stroke-linejoin")&&this.setStrokeJoin(a.getAttribute("stroke-linejoin")),a.hasAttribute("stroke-linecap")&&this.setStrokeCap(a.getStringAttribute("stroke-linecap")),a.hasAttribute("fill")&&this.setFill(a.getStringAttribute("fill")),a.hasAttribute("style"))for(var b=a.getStringAttribute("style"),c=b.toString().split(";"),d=0,e=c.length;e>d;d++){var f=r.trim(c[d].split(":"));"fill"===f[0]?this.setFill(f[1]):"fill-opacity"===f[0]?this.setFillOpacity(f[1]):"stroke"===f[0]?this.setStroke(f[1]):"stroke-width"===f[0]?this.setStrokeWeight(f[1]):"stroke-linecap"===f[0]?this.setStrokeCap(f[1]):"stroke-linejoin"===f[0]?this.setStrokeJoin(f[1]):"stroke-opacity"===f[0]?this.setStrokeOpacity(f[1]):"opacity"===f[0]&&this.setOpacity(f[1])}},Dd.prototype.setFillOpacity=function(a){this.fillOpacity=parseFloat(a),this.fillColor=255*this.fillOpacity<<24|16777215&this.fillColor},Dd.prototype.setFill=function(a){var b=4278190080&this.fillColor;"none"===a?this.fill=!1:0===a.indexOf("#")?(this.fill=!0,4===a.length&&(a=a.replace(/#(.)(.)(.)/,"#$1$1$2$2$3$3")),this.fillColor=b|16777215&parseInt(a.substring(1),16)):0===a.indexOf("rgb")?(this.fill=!0,this.fillColor=b|this.parseRGB(a)):0===a.indexOf("url(#")?this.fillName=a.substring(5,a.length-1):z[a]&&(this.fill=!0,this.fillColor=b|16777215&parseInt(z[a].substring(1),16))},Dd.prototype.setOpacity=function(a){this.strokeColor=255*parseFloat(a)<<24|16777215&this.strokeColor,this.fillColor=255*parseFloat(a)<<24|16777215&this.fillColor},Dd.prototype.setStroke=function(a){var b=4278190080&this.strokeColor;"none"===a?this.stroke=!1:"#"===a.charAt(0)?(this.stroke=!0,4===a.length&&(a=a.replace(/#(.)(.)(.)/,"#$1$1$2$2$3$3")),this.strokeColor=b|16777215&parseInt(a.substring(1),16)):0===a.indexOf("rgb")?(this.stroke=!0,this.strokeColor=b|this.parseRGB(a)):0===a.indexOf("url(#")?this.strokeName=a.substring(5,a.length-1):z[a]&&(this.stroke=!0,this.strokeColor=b|16777215&parseInt(z[a].substring(1),16))},Dd.prototype.setStrokeWeight=function(a){this.strokeWeight=this.parseUnitSize(a)},Dd.prototype.setStrokeJoin=function(a){"miter"===a?this.strokeJoin="miter":"round"===a?this.strokeJoin="round":"bevel"===a&&(this.strokeJoin="bevel")},Dd.prototype.setStrokeCap=function(a){"butt"===a?this.strokeCap="butt":"round"===a?this.strokeCap="round":"square"===a&&(this.strokeCap="square")},Dd.prototype.setStrokeOpacity=function(a){this.strokeOpacity=parseFloat(a),this.strokeColor=255*this.strokeOpacity<<24|16777215&this.strokeColor},Dd.prototype.parseRGB=function(a){var b=a.substring(a.indexOf("(")+1,a.indexOf(")")),c=b.split(", ");return c[0]<<16|c[1]<<8|c[2]},Dd.prototype.parseUnitSize=function(a){var b=a.length-2;return 0>b?a:a.indexOf("pt")===b?1.25*parseFloat(a.substring(0,b)):a.indexOf("pc")===b?15*parseFloat(a.substring(0,b)):a.indexOf("mm")===b?3.543307*parseFloat(a.substring(0,b)):a.indexOf("cm")===b?35.43307*parseFloat(a.substring(0,b)):a.indexOf("in")===b?90*parseFloat(a.substring(0,b)):a.indexOf("px")===b?parseFloat(a.substring(0,b)):parseFloat(a)},r.shape=function(a,b,c,d,e){arguments.length>=1&&null!==arguments[0]&&a.isVisible()&&(r.pushMatrix(),3===$c?5===arguments.length?(r.translate(b-d/2,c-e/2),r.scale(d/a.getWidth(),e/a.getHeight())):3===arguments.length?r.translate(b-a.getWidth()/2,-a.getHeight()/2):r.translate(-a.getWidth()/2,-a.getHeight()/2):0===$c?5===arguments.length?(r.translate(b,c),r.scale(d/a.getWidth(),e/a.getHeight())):3===arguments.length&&r.translate(b,c):1===$c&&(5===arguments.length?(d-=b,e-=c,r.translate(b,c),r.scale(d/a.getWidth(),e/a.getHeight())):3===arguments.length&&r.translate(b,c)),a.draw(r),(1===arguments.length&&3===$c||arguments.length>1)&&r.popMatrix())},r.shapeMode=function(a){$c=a},r.loadShape=function(a){return 1===arguments.length&&a.indexOf(".svg")>-1?new Dd(null,a):null};var Ed=function(a,b,c,d,e){this.fullName=a||"",this.name=b||"",this.namespace=c||"",this.value=d,this.type=e};Ed.prototype={getName:function(){return this.name},getFullName:function(){return this.fullName},getNamespace:function(){return this.namespace},getValue:function(){return this.value},getType:function(){return this.type
  },setValue:function(a){this.value=a}};var Fd=r.XMLElement=function(a,b,c,e){this.attributes=[],this.children=[],this.fullName=null,this.name=null,this.namespace="",this.content=null,this.parent=null,this.lineNr="",this.systemID="",this.type="ELEMENT",a&&("string"==typeof a?b===d&&a.indexOf("<")>-1?this.parse(a):(this.fullName=a,this.namespace=b,this.systemId=c,this.lineNr=e):this.parse(b))};Fd.prototype={parse:function(a){var b;try{var c=a.substring(a.length-4);(".xml"===c||".svg"===c)&&(a=g(a)),b=(new DOMParser).parseFromString(a,"text/xml");var d=b.documentElement;if(!d)throw"Error loading document";return this.parseChildrenRecursive(null,d),this}catch(e){throw e}},parseChildrenRecursive:function(a,b){var c,d,e,f,g,h;if(a?(c=new Fd(b.nodeName),c.parent=a):(this.fullName=b.localName,this.name=b.nodeName,c=this),3===b.nodeType&&""!==b.textContent)return this.createPCDataElement(b.textContent);if(4===b.nodeType)return this.createCDataElement(b.textContent);if(b.attributes)for(f=0,g=b.attributes.length;g>f;f++)e=b.attributes[f],d=new Ed(e.getname,e.nodeName,e.namespaceURI,e.nodeValue,e.nodeType),c.attributes.push(d);if(b.childNodes)for(f=0,g=b.childNodes.length;g>f;f++){var i=b.childNodes[f];h=c.parseChildrenRecursive(c,i),null!==h&&c.children.push(h)}return c},createElement:function(a,b,c,e){return c===d?new Fd(a,b):new Fd(a,b,c,e)},createPCDataElement:function(a){if(""===a.replace(/^\s+$/g,""))return null;var c=new Fd;return c.type="TEXT",c.content=a,c},createCDataElement:function(a){var b=this.createPCDataElement(a);if(null===b)return null;b.type="CDATA";var d,c={"<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"};for(d in c)Object.hasOwnProperty(c,d)||(a=a.replace(new RegExp(d,"g"),c[d]));return b.cdata=a,b},hasAttribute:function(){return 1===arguments.length?null!==this.getAttribute(arguments[0]):2===arguments.length?null!==this.getAttribute(arguments[0],arguments[1]):void 0},equals:function(a){if(!(a instanceof Fd))return!1;var b,c;if(this.fullName!==a.fullName)return!1;if(this.attributes.length!==a.getAttributeCount())return!1;if(this.attributes.length!==a.attributes.length)return!1;var d,e,h;for(b=0,c=this.attributes.length;c>b;b++){if(d=this.attributes[b].getName(),e=this.attributes[b].getNamespace(),h=a.findAttribute(d,e),null===h)return!1;if(this.attributes[b].getValue()!==h.getValue())return!1;if(this.attributes[b].getType()!==h.getType())return!1}if(this.children.length!==a.getChildCount())return!1;if(this.children.length>0){var i,j;for(b=0,c=this.children.length;c>b;b++)if(i=this.getChild(b),j=a.getChild(b),!i.equals(j))return!1;return!0}return this.content===a.content},getContent:function(){if("TEXT"===this.type||"CDATA"===this.type)return this.content;var a=this.children;return 1!==a.length||"TEXT"!==a[0].type&&"CDATA"!==a[0].type?null:a[0].content},getAttribute:function(){var a;return 2===arguments.length?(a=this.findAttribute(arguments[0]),a?a.getValue():arguments[1]):1===arguments.length?(a=this.findAttribute(arguments[0]),a?a.getValue():null):3===arguments.length?(a=this.findAttribute(arguments[0],arguments[1]),a?a.getValue():arguments[2]):void 0},getStringAttribute:function(){return 1===arguments.length?this.getAttribute(arguments[0]):2===arguments.length?this.getAttribute(arguments[0],arguments[1]):this.getAttribute(arguments[0],arguments[1],arguments[2])},getString:function(a){return this.getStringAttribute(a)},getFloatAttribute:function(){return 1===arguments.length?parseFloat(this.getAttribute(arguments[0],0)):2===arguments.length?this.getAttribute(arguments[0],arguments[1]):this.getAttribute(arguments[0],arguments[1],arguments[2])},getFloat:function(a){return this.getFloatAttribute(a)},getIntAttribute:function(){return 1===arguments.length?this.getAttribute(arguments[0],0):2===arguments.length?this.getAttribute(arguments[0],arguments[1]):this.getAttribute(arguments[0],arguments[1],arguments[2])},getInt:function(a){return this.getIntAttribute(a)},hasChildren:function(){return this.children.length>0},addChild:function(a){null!==a&&(a.parent=this,this.children.push(a))},insertChild:function(a,b){if(a){if(null===a.getLocalName()&&!this.hasChildren()){var c=this.children[this.children.length-1];if(null===c.getLocalName())return c.setContent(c.getContent()+a.getContent()),void 0}a.parent=this,this.children.splice(b,0,a)}},getChild:function(a){if("number"==typeof a)return this.children[a];if(-1!==a.indexOf("/"))return this.getChildRecursive(a.split("/"),0);for(var b,c,d=0,e=this.getChildCount();e>d;d++)if(b=this.getChild(d),c=b.getName(),null!==c&&c===a)return b;return null},getChildren:function(){if(1===arguments.length){if("number"==typeof arguments[0])return this.getChild(arguments[0]);if(-1!==arguments[0].indexOf("/"))return this.getChildrenRecursive(arguments[0].split("/"),0);for(var b,c,a=[],d=0,e=this.getChildCount();e>d;d++)b=this.getChild(d),c=b.getName(),null!==c&&c===arguments[0]&&a.push(b);return a}return this.children},getChildCount:function(){return this.children.length},getChildRecursive:function(a,b){if(b===a.length)return this;for(var c,d,e=a[b],f=0,g=this.getChildCount();g>f;f++)if(c=this.getChild(f),d=c.getName(),null!==d&&d===e)return c.getChildRecursive(a,b+1);return null},getChildrenRecursive:function(a,b){if(b===a.length-1)return this.getChildren(a[b]);for(var c=this.getChildren(a[b]),d=[],e=0;e<c.length;e++)d=d.concat(c[e].getChildrenRecursive(a,b+1));return d},isLeaf:function(){return!this.hasChildren()},listChildren:function(){for(var a=[],b=0,c=this.children.length;c>b;b++)a.push(this.getChild(b).getName());return a},removeAttribute:function(a,b){this.namespace=b||"";for(var c=0,d=this.attributes.length;d>c;c++)if(this.attributes[c].getName()===a&&this.attributes[c].getNamespace()===this.namespace){this.attributes.splice(c,1);break}},removeChild:function(a){if(a)for(var b=0,c=this.children.length;c>b;b++)if(this.children[b].equals(a)){this.children.splice(b,1);break}},removeChildAtIndex:function(a){this.children.length>a&&this.children.splice(a,1)},findAttribute:function(a,b){this.namespace=b||"";for(var c=0,d=this.attributes.length;d>c;c++)if(this.attributes[c].getName()===a&&this.attributes[c].getNamespace()===this.namespace)return this.attributes[c];return null},setAttribute:function(){var a;if(3===arguments.length){var b=arguments[0].indexOf(":"),c=arguments[0].substring(b+1);a=this.findAttribute(c,arguments[1]),a?a.setValue(arguments[2]):(a=new Ed(arguments[0],c,arguments[1],arguments[2],"CDATA"),this.attributes.push(a))}else a=this.findAttribute(arguments[0]),a?a.setValue(arguments[1]):(a=new Ed(arguments[0],arguments[0],null,arguments[1],"CDATA"),this.attributes.push(a))},setString:function(a,b){this.setAttribute(a,b)},setInt:function(a,b){this.setAttribute(a,b)},setFloat:function(a,b){this.setAttribute(a,b)},setContent:function(a){this.children.length>0&&G.debug("Tried to set content for XMLElement with children"),this.content=a},setName:function(){if(1===arguments.length)this.name=arguments[0],this.fullName=arguments[0],this.namespace=null;else{var a=arguments[0].indexOf(":");this.name=null===arguments[1]||0>a?arguments[0]:arguments[0].substring(a+1),this.fullName=arguments[0],this.namespace=arguments[1]}},getName:function(){return this.fullName},getLocalName:function(){return this.name},getAttributeCount:function(){return this.attributes.length},toString:function(){if("TEXT"===this.type)return this.content;if("CDATA"===this.type)return this.cdata;var c,d,a=this.fullName,b="<"+a;for(c=0;c<this.attributes.length;c++){var e=this.attributes[c];b+=" "+e.getName()+"="+'"'+e.getValue()+'"'}if(0===this.children.length)b+=""===this.content?"/>":">"+this.content+"</"+a+">";else{for(b+=">",d=0;d<this.children.length;d++)b+=this.children[d].toString();b+="</"+a+">"}return b}},Fd.parse=function(a){var b=new Fd;return b.parse(a),b};var Gd=r.XML=r.XMLElement;r.loadXML=function(a){return new Gd(r,a)};var Hd=function(a){for(var b=0,d=0;d<a.length;d++)b=0!==d?c.max(b,c.abs(a[d])):c.abs(a[d]);var e=(b+"").indexOf(".");return 0===e?e=1:-1===e&&(e=(b+"").length),e},Id=r.PMatrix2D=function(){0===arguments.length?this.reset():1===arguments.length&&arguments[0]instanceof Id?this.set(arguments[0].array()):6===arguments.length&&this.set(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])};Id.prototype={set:function(){if(6===arguments.length){var a=arguments;this.set([a[0],a[1],a[2],a[3],a[4],a[5]])}else 1===arguments.length&&arguments[0]instanceof Id?this.elements=arguments[0].array():1===arguments.length&&arguments[0]instanceof Array&&(this.elements=arguments[0].slice())},get:function(){var a=new Id;return a.set(this.elements),a},reset:function(){this.set([1,0,0,0,1,0])},array:function(){return this.elements.slice()},translate:function(a,b){this.elements[2]=a*this.elements[0]+b*this.elements[1]+this.elements[2],this.elements[5]=a*this.elements[3]+b*this.elements[4]+this.elements[5]},invTranslate:function(a,b){this.translate(-a,-b)},transpose:function(){},mult:function(a,b){var c,d;return a instanceof t?(c=a.x,d=a.y,b||(b=new t)):a instanceof Array&&(c=a[0],d=a[1],b||(b=[])),b instanceof Array?(b[0]=this.elements[0]*c+this.elements[1]*d+this.elements[2],b[1]=this.elements[3]*c+this.elements[4]*d+this.elements[5]):b instanceof t&&(b.x=this.elements[0]*c+this.elements[1]*d+this.elements[2],b.y=this.elements[3]*c+this.elements[4]*d+this.elements[5],b.z=0),b},multX:function(a,b){return a*this.elements[0]+b*this.elements[1]+this.elements[2]},multY:function(a,b){return a*this.elements[3]+b*this.elements[4]+this.elements[5]},skewX:function(a){this.apply(1,0,1,a,0,0)},skewY:function(a){this.apply(1,0,1,0,a,0)},shearX:function(a){this.apply(1,0,1,c.tan(a),0,0)},shearY:function(a){this.apply(1,0,1,0,c.tan(a),0)},determinant:function(){return this.elements[0]*this.elements[4]-this.elements[1]*this.elements[3]},invert:function(){var a=this.determinant();if(c.abs(a)>-2147483648){var b=this.elements[0],d=this.elements[1],e=this.elements[2],f=this.elements[3],g=this.elements[4],h=this.elements[5];return this.elements[0]=g/a,this.elements[3]=-f/a,this.elements[1]=-d/a,this.elements[4]=b/a,this.elements[2]=(d*h-g*e)/a,this.elements[5]=(f*e-b*h)/a,!0}return!1},scale:function(a,b){a&&!b&&(b=a),a&&b&&(this.elements[0]*=a,this.elements[1]*=b,this.elements[3]*=a,this.elements[4]*=b)},invScale:function(a,b){a&&!b&&(b=a),this.scale(1/a,1/b)},apply:function(){var a;1===arguments.length&&arguments[0]instanceof Id?a=arguments[0].array():6===arguments.length?a=Array.prototype.slice.call(arguments):1===arguments.length&&arguments[0]instanceof Array&&(a=arguments[0]);for(var b=[0,0,this.elements[2],0,0,this.elements[5]],c=0,d=0;2>d;d++)for(var e=0;3>e;e++,c++)b[c]+=this.elements[3*d+0]*a[e+0]+this.elements[3*d+1]*a[e+3];this.elements=b.slice()},preApply:function(){var a;1===arguments.length&&arguments[0]instanceof Id?a=arguments[0].array():6===arguments.length?a=Array.prototype.slice.call(arguments):1===arguments.length&&arguments[0]instanceof Array&&(a=arguments[0]);var b=[0,0,a[2],0,0,a[5]];b[2]=a[2]+this.elements[2]*a[0]+this.elements[5]*a[1],b[5]=a[5]+this.elements[2]*a[3]+this.elements[5]*a[4],b[0]=this.elements[0]*a[0]+this.elements[3]*a[1],b[3]=this.elements[0]*a[3]+this.elements[3]*a[4],b[1]=this.elements[1]*a[0]+this.elements[4]*a[1],b[4]=this.elements[1]*a[3]+this.elements[4]*a[4],this.elements=b.slice()},rotate:function(a){var b=c.cos(a),d=c.sin(a),e=this.elements[0],f=this.elements[1];this.elements[0]=b*e+d*f,this.elements[1]=-d*e+b*f,e=this.elements[3],f=this.elements[4],this.elements[3]=b*e+d*f,this.elements[4]=-d*e+b*f},rotateZ:function(a){this.rotate(a)},invRotateZ:function(a){this.rotateZ(a-c.PI)},print:function(){var a=Hd(this.elements),b=""+r.nfs(this.elements[0],a,4)+" "+r.nfs(this.elements[1],a,4)+" "+r.nfs(this.elements[2],a,4)+"\n"+r.nfs(this.elements[3],a,4)+" "+r.nfs(this.elements[4],a,4)+" "+r.nfs(this.elements[5],a,4)+"\n\n";r.println(b)}};var Jd=r.PMatrix3D=function(){this.reset()};Jd.prototype={set:function(){16===arguments.length?this.elements=Array.prototype.slice.call(arguments):1===arguments.length&&arguments[0]instanceof Jd?this.elements=arguments[0].array():1===arguments.length&&arguments[0]instanceof Array&&(this.elements=arguments[0].slice())},get:function(){var a=new Jd;return a.set(this.elements),a},reset:function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},array:function(){return this.elements.slice()},translate:function(a,b,c){c===d&&(c=0),this.elements[3]+=a*this.elements[0]+b*this.elements[1]+c*this.elements[2],this.elements[7]+=a*this.elements[4]+b*this.elements[5]+c*this.elements[6],this.elements[11]+=a*this.elements[8]+b*this.elements[9]+c*this.elements[10],this.elements[15]+=a*this.elements[12]+b*this.elements[13]+c*this.elements[14]},transpose:function(){var a=this.elements[4];this.elements[4]=this.elements[1],this.elements[1]=a,a=this.elements[8],this.elements[8]=this.elements[2],this.elements[2]=a,a=this.elements[6],this.elements[6]=this.elements[9],this.elements[9]=a,a=this.elements[3],this.elements[3]=this.elements[12],this.elements[12]=a,a=this.elements[7],this.elements[7]=this.elements[13],this.elements[13]=a,a=this.elements[11],this.elements[11]=this.elements[14],this.elements[14]=a},mult:function(a,b){var c,d,e,f;return a instanceof t?(c=a.x,d=a.y,e=a.z,f=1,b||(b=new t)):a instanceof Array&&(c=a[0],d=a[1],e=a[2],f=a[3]||1,(!b||3!==b.length&&4!==b.length)&&(b=[0,0,0])),b instanceof Array&&(3===b.length?(b[0]=this.elements[0]*c+this.elements[1]*d+this.elements[2]*e+this.elements[3],b[1]=this.elements[4]*c+this.elements[5]*d+this.elements[6]*e+this.elements[7],b[2]=this.elements[8]*c+this.elements[9]*d+this.elements[10]*e+this.elements[11]):4===b.length&&(b[0]=this.elements[0]*c+this.elements[1]*d+this.elements[2]*e+this.elements[3]*f,b[1]=this.elements[4]*c+this.elements[5]*d+this.elements[6]*e+this.elements[7]*f,b[2]=this.elements[8]*c+this.elements[9]*d+this.elements[10]*e+this.elements[11]*f,b[3]=this.elements[12]*c+this.elements[13]*d+this.elements[14]*e+this.elements[15]*f)),b instanceof t&&(b.x=this.elements[0]*c+this.elements[1]*d+this.elements[2]*e+this.elements[3],b.y=this.elements[4]*c+this.elements[5]*d+this.elements[6]*e+this.elements[7],b.z=this.elements[8]*c+this.elements[9]*d+this.elements[10]*e+this.elements[11]),b},preApply:function(){var a;1===arguments.length&&arguments[0]instanceof Jd?a=arguments[0].array():16===arguments.length?a=Array.prototype.slice.call(arguments):1===arguments.length&&arguments[0]instanceof Array&&(a=arguments[0]);for(var b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=0,d=0;4>d;d++)for(var e=0;4>e;e++,c++)b[c]+=this.elements[e+0]*a[4*d+0]+this.elements[e+4]*a[4*d+1]+this.elements[e+8]*a[4*d+2]+this.elements[e+12]*a[4*d+3];this.elements=b.slice()},apply:function(){var a;1===arguments.length&&arguments[0]instanceof Jd?a=arguments[0].array():16===arguments.length?a=Array.prototype.slice.call(arguments):1===arguments.length&&arguments[0]instanceof Array&&(a=arguments[0]);for(var b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=0,d=0;4>d;d++)for(var e=0;4>e;e++,c++)b[c]+=this.elements[4*d+0]*a[e+0]+this.elements[4*d+1]*a[e+4]+this.elements[4*d+2]*a[e+8]+this.elements[4*d+3]*a[e+12];this.elements=b.slice()},rotate:function(a,b,c,d){if(c){var e=r.cos(a),f=r.sin(a),g=1-e;this.apply(g*b*b+e,g*b*c-f*d,g*b*d+f*c,0,g*b*c+f*d,g*c*c+e,g*c*d-f*b,0,g*b*d-f*c,g*c*d+f*b,g*d*d+e,0,0,0,0,1)}else this.rotateZ(a)},invApply:function(){Jc===d&&(Jc=new Jd);var a=arguments;return Jc.set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]),Jc.invert()?(this.preApply(Jc),!0):!1},rotateX:function(a){var b=r.cos(a),c=r.sin(a);this.apply([1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1])},rotateY:function(a){var b=r.cos(a),c=r.sin(a);this.apply([b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1])},rotateZ:function(a){var b=c.cos(a),d=c.sin(a);this.apply([b,-d,0,0,d,b,0,0,0,0,1,0,0,0,0,1])},scale:function(a,b,c){!a||b||c?a&&b&&!c&&(c=1):b=c=a,a&&b&&c&&(this.elements[0]*=a,this.elements[1]*=b,this.elements[2]*=c,this.elements[4]*=a,this.elements[5]*=b,this.elements[6]*=c,this.elements[8]*=a,this.elements[9]*=b,this.elements[10]*=c,this.elements[12]*=a,this.elements[13]*=b,this.elements[14]*=c)},skewX:function(a){var b=c.tan(a);this.apply(1,b,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},skewY:function(a){var b=c.tan(a);this.apply(1,0,0,0,b,1,0,0,0,0,1,0,0,0,0,1)},shearX:function(a){var b=c.tan(a);this.apply(1,b,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},shearY:function(a){var b=c.tan(a);this.apply(1,0,0,0,b,1,0,0,0,0,1,0,0,0,0,1)},multX:function(a,b,c,d){return c?d?this.elements[0]*a+this.elements[1]*b+this.elements[2]*c+this.elements[3]*d:this.elements[0]*a+this.elements[1]*b+this.elements[2]*c+this.elements[3]:this.elements[0]*a+this.elements[1]*b+this.elements[3]},multY:function(a,b,c,d){return c?d?this.elements[4]*a+this.elements[5]*b+this.elements[6]*c+this.elements[7]*d:this.elements[4]*a+this.elements[5]*b+this.elements[6]*c+this.elements[7]:this.elements[4]*a+this.elements[5]*b+this.elements[7]},multZ:function(a,b,c,d){return d?this.elements[8]*a+this.elements[9]*b+this.elements[10]*c+this.elements[11]*d:this.elements[8]*a+this.elements[9]*b+this.elements[10]*c+this.elements[11]},multW:function(a,b,c,d){return d?this.elements[12]*a+this.elements[13]*b+this.elements[14]*c+this.elements[15]*d:this.elements[12]*a+this.elements[13]*b+this.elements[14]*c+this.elements[15]},invert:function(){var a=this.elements[0]*this.elements[5]-this.elements[1]*this.elements[4],b=this.elements[0]*this.elements[6]-this.elements[2]*this.elements[4],d=this.elements[0]*this.elements[7]-this.elements[3]*this.elements[4],e=this.elements[1]*this.elements[6]-this.elements[2]*this.elements[5],f=this.elements[1]*this.elements[7]-this.elements[3]*this.elements[5],g=this.elements[2]*this.elements[7]-this.elements[3]*this.elements[6],h=this.elements[8]*this.elements[13]-this.elements[9]*this.elements[12],i=this.elements[8]*this.elements[14]-this.elements[10]*this.elements[12],j=this.elements[8]*this.elements[15]-this.elements[11]*this.elements[12],k=this.elements[9]*this.elements[14]-this.elements[10]*this.elements[13],l=this.elements[9]*this.elements[15]-this.elements[11]*this.elements[13],m=this.elements[10]*this.elements[15]-this.elements[11]*this.elements[14],n=a*m-b*l+d*k+e*j-f*i+g*h;if(c.abs(n)<=1e-9)return!1;var o=[];o[0]=+this.elements[5]*m-this.elements[6]*l+this.elements[7]*k,o[4]=-this.elements[4]*m+this.elements[6]*j-this.elements[7]*i,o[8]=+this.elements[4]*l-this.elements[5]*j+this.elements[7]*h,o[12]=-this.elements[4]*k+this.elements[5]*i-this.elements[6]*h,o[1]=-this.elements[1]*m+this.elements[2]*l-this.elements[3]*k,o[5]=+this.elements[0]*m-this.elements[2]*j+this.elements[3]*i,o[9]=-this.elements[0]*l+this.elements[1]*j-this.elements[3]*h,o[13]=+this.elements[0]*k-this.elements[1]*i+this.elements[2]*h,o[2]=+this.elements[13]*g-this.elements[14]*f+this.elements[15]*e,o[6]=-this.elements[12]*g+this.elements[14]*d-this.elements[15]*b,o[10]=+this.elements[12]*f-this.elements[13]*d+this.elements[15]*a,o[14]=-this.elements[12]*e+this.elements[13]*b-this.elements[14]*a,o[3]=-this.elements[9]*g+this.elements[10]*f-this.elements[11]*e,o[7]=+this.elements[8]*g-this.elements[10]*d+this.elements[11]*b,o[11]=-this.elements[8]*f+this.elements[9]*d-this.elements[11]*a,o[15]=+this.elements[8]*e-this.elements[9]*b+this.elements[10]*a;var p=1/n;return o[0]*=p,o[1]*=p,o[2]*=p,o[3]*=p,o[4]*=p,o[5]*=p,o[6]*=p,o[7]*=p,o[8]*=p,o[9]*=p,o[10]*=p,o[11]*=p,o[12]*=p,o[13]*=p,o[14]*=p,o[15]*=p,this.elements=o.slice(),!0},toString:function(){for(var a="",b=0;15>b;b++)a+=this.elements[b]+", ";return a+=this.elements[15]},print:function(){var a=Hd(this.elements),b=""+r.nfs(this.elements[0],a,4)+" "+r.nfs(this.elements[1],a,4)+" "+r.nfs(this.elements[2],a,4)+" "+r.nfs(this.elements[3],a,4)+"\n"+r.nfs(this.elements[4],a,4)+" "+r.nfs(this.elements[5],a,4)+" "+r.nfs(this.elements[6],a,4)+" "+r.nfs(this.elements[7],a,4)+"\n"+r.nfs(this.elements[8],a,4)+" "+r.nfs(this.elements[9],a,4)+" "+r.nfs(this.elements[10],a,4)+" "+r.nfs(this.elements[11],a,4)+"\n"+r.nfs(this.elements[12],a,4)+" "+r.nfs(this.elements[13],a,4)+" "+r.nfs(this.elements[14],a,4)+" "+r.nfs(this.elements[15],a,4)+"\n\n";r.println(b)},invTranslate:function(a,b,c){this.preApply(1,0,0,-a,0,1,0,-b,0,0,1,-c,0,0,0,1)},invRotateX:function(a){var b=c.cos(-a),d=c.sin(-a);this.preApply([1,0,0,0,0,b,-d,0,0,d,b,0,0,0,0,1])},invRotateY:function(a){var b=c.cos(-a),d=c.sin(-a);this.preApply([b,0,d,0,0,1,0,0,-d,0,b,0,0,0,0,1])},invRotateZ:function(a){var b=c.cos(-a),d=c.sin(-a);this.preApply([b,-d,0,0,d,b,0,0,0,0,1,0,0,0,0,1])},invScale:function(a,b,c){this.preApply([1/a,0,0,0,0,1/b,0,0,0,0,1/c,0,0,0,0,1])}};var Kd=r.PMatrixStack=function(){this.matrixStack=[]};Kd.prototype.load=function(){var a=w.$newPMatrix();1===arguments.length?a.set(arguments[0]):a.set(arguments),this.matrixStack.push(a)},xd.prototype.$newPMatrix=function(){return new Id},yd.prototype.$newPMatrix=function(){return new Jd},Kd.prototype.push=function(){this.matrixStack.push(this.peek())},Kd.prototype.pop=function(){return this.matrixStack.pop()},Kd.prototype.peek=function(){var a=w.$newPMatrix();return a.set(this.matrixStack[this.matrixStack.length-1]),a},Kd.prototype.mult=function(a){this.matrixStack[this.matrixStack.length-1].apply(a)},r.split=function(a,b){return a.split(b)},r.splitTokens=function(a,b){if(b===d)return a.split(/\s+/g);var g,h,c=b.split(/()/g),e="",f=a.length,i=[];for(g=0;f>g;g++)h=a[g],c.indexOf(h)>-1?(""!==e&&i.push(e),e=""):e+=h;return""!==e&&i.push(e),i},r.append=function(a,b){return a[a.length]=b,a},r.concat=function(a,b){return a.concat(b)},r.sort=function(a,b){var c=[];if(a.length>0){for(var d=b>0?b:a.length,e=0;d>e;e++)c.push(a[e]);if("string"==typeof a[0]?c.sort():c.sort(function(a,b){return a-b}),b>0)for(var f=c.length;f<a.length;f++)c.push(a[f])}return c},r.splice=function(a,b,c){if(0===b.length)return a;if(b instanceof Array)for(var d=0,e=c;d<b.length;e++,d++)a.splice(e,0,b[d]);else a.splice(c,0,b);return a},r.subset=function(a,b,c){var e=c!==d?b+c:a.length;return a.slice(b,e)},r.join=function(a,b){return a.join(b)},r.shorten=function(a){for(var b=[],c=a.length,d=0;c>d;d++)b[d]=a[d];return b.pop(),b},r.expand=function(a,b){var c=a.slice(0),d=b||2*a.length;return c.length=d,c},r.arrayCopy=function(){var a,c,f,b=0,e=0;2===arguments.length?(a=arguments[0],c=arguments[1],f=a.length):3===arguments.length?(a=arguments[0],c=arguments[1],f=arguments[2]):5===arguments.length&&(a=arguments[0],b=arguments[1],c=arguments[2],e=arguments[3],f=arguments[4]);for(var g=b,h=e;f+b>g;g++,h++){if(c[h]===d)throw"array index out of bounds exception";c[h]=a[g]}},r.reverse=function(a){return a.reverse()},r.mix=function(a,b,c){return a+((b-a)*c>>8)},r.peg=function(a){return 0>a?0:a>255?255:a},r.modes=function(){function h(a,b,c,d,e,g,h,i,j,k,l){var m=f(((4278190080&a)>>>24)+b,255)<<24,n=c+((j-c)*b>>8);n=(0>n?0:n>255?255:n)<<16;var o=d+((k-d)*b>>8);o=(0>o?0:o>255?255:o)<<8;var p=e+((l-e)*b>>8);return p=0>p?0:p>255?255:p,m|n|o|p}var a=4278190080,b=16711680,d=65280,e=255,f=c.min,g=c.max;return{replace:function(a,b){return b},blend:function(c,g){var h=(g&a)>>>24,i=c&b,j=c&d,k=c&e,l=g&b,m=g&d,n=g&e;return f(((c&a)>>>24)+h,255)<<24|i+((l-i)*h>>8)&b|j+((m-j)*h>>8)&d|k+((n-k)*h>>8)&e},add:function(c,g){var h=(g&a)>>>24;return f(((c&a)>>>24)+h,255)<<24|f((c&b)+((g&b)>>8)*h,b)&b|f((c&d)+((g&d)>>8)*h,d)&d|f((c&e)+((g&e)*h>>8),e)},subtract:function(c,h){var i=(h&a)>>>24;return f(((c&a)>>>24)+i,255)<<24|g((c&b)-((h&b)>>8)*i,d)&b|g((c&d)-((h&d)>>8)*i,e)&d|g((c&e)-((h&e)*i>>8),0)},lightest:function(c,h){var i=(h&a)>>>24;return f(((c&a)>>>24)+i,255)<<24|g(c&b,((h&b)>>8)*i)&b|g(c&d,((h&d)>>8)*i)&d|g(c&e,(h&e)*i>>8)},darkest:function(c,g){var h=(g&a)>>>24,i=c&b,j=c&d,k=c&e,l=f(c&b,((g&b)>>8)*h),m=f(c&d,((g&d)>>8)*h),n=f(c&e,(g&e)*h>>8);return f(((c&a)>>>24)+h,255)<<24|i+((l-i)*h>>8)&b|j+((m-j)*h>>8)&d|k+((n-k)*h>>8)&e},difference:function(c,f){var g=(f&a)>>>24,i=(c&b)>>16,j=(c&d)>>8,k=c&e,l=(f&b)>>16,m=(f&d)>>8,n=f&e,o=i>l?i-l:l-i,p=j>m?j-m:m-j,q=k>n?k-n:n-k;return h(c,g,i,j,k,l,m,n,o,p,q)},exclusion:function(c,f){var g=(f&a)>>>24,i=(c&b)>>16,j=(c&d)>>8,k=c&e,l=(f&b)>>16,m=(f&d)>>8,n=f&e,o=i+l-(i*l>>7),p=j+m-(j*m>>7),q=k+n-(k*n>>7);return h(c,g,i,j,k,l,m,n,o,p,q)},multiply:function(c,f){var g=(f&a)>>>24,i=(c&b)>>16,j=(c&d)>>8,k=c&e,l=(f&b)>>16,m=(f&d)>>8,n=f&e,o=i*l>>8,p=j*m>>8,q=k*n>>8;return h(c,g,i,j,k,l,m,n,o,p,q)},screen:function(c,f){var g=(f&a)>>>24,i=(c&b)>>16,j=(c&d)>>8,k=c&e,l=(f&b)>>16,m=(f&d)>>8,n=f&e,o=255-((255-i)*(255-l)>>8),p=255-((255-j)*(255-m)>>8),q=255-((255-k)*(255-n)>>8);return h(c,g,i,j,k,l,m,n,o,p,q)},hard_light:function(c,f){var g=(f&a)>>>24,i=(c&b)>>16,j=(c&d)>>8,k=c&e,l=(f&b)>>16,m=(f&d)>>8,n=f&e,o=128>l?i*l>>7:255-((255-i)*(255-l)>>7),p=128>m?j*m>>7:255-((255-j)*(255-m)>>7),q=128>n?k*n>>7:255-((255-k)*(255-n)>>7);return h(c,g,i,j,k,l,m,n,o,p,q)},soft_light:function(c,f){var g=(f&a)>>>24,i=(c&b)>>16,j=(c&d)>>8,k=c&e,l=(f&b)>>16,m=(f&d)>>8,n=f&e,o=(i*l>>7)+(i*i>>8)-(i*i*l>>15),p=(j*m>>7)+(j*j>>8)-(j*j*m>>15),q=(k*n>>7)+(k*k>>8)-(k*k*n>>15);return h(c,g,i,j,k,l,m,n,o,p,q)},overlay:function(c,f){var g=(f&a)>>>24,i=(c&b)>>16,j=(c&d)>>8,k=c&e,l=(f&b)>>16,m=(f&d)>>8,n=f&e,o=128>i?i*l>>7:255-((255-i)*(255-l)>>7),p=128>j?j*m>>7:255-((255-j)*(255-m)>>7),q=128>k?k*n>>7:255-((255-k)*(255-n)>>7);return h(c,g,i,j,k,l,m,n,o,p,q)},dodge:function(c,f){var g=(f&a)>>>24,i=(c&b)>>16,j=(c&d)>>8,k=c&e,l=(f&b)>>16,m=(f&d)>>8,n=f&e,o=255;255!==l&&(o=(i<<8)/(255-l),o=0>o?0:o>255?255:o);var p=255;255!==m&&(p=(j<<8)/(255-m),p=0>p?0:p>255?255:p);var q=255;return 255!==n&&(q=(k<<8)/(255-n),q=0>q?0:q>255?255:q),h(c,g,i,j,k,l,m,n,o,p,q)},burn:function(c,f){var g=(f&a)>>>24,i=(c&b)>>16,j=(c&d)>>8,k=c&e,l=(f&b)>>16,m=(f&d)>>8,n=f&e,o=0;0!==l&&(o=(255-i<<8)/l,o=255-(0>o?0:o>255?255:o));var p=0;0!==m&&(p=(255-j<<8)/m,p=255-(0>p?0:p>255?255:p));var q=0;return 0!==n&&(q=(255-k<<8)/n,q=255-(0>q?0:q>255?255:q)),h(c,g,i,j,k,l,m,n,o,p,q)}}}(),r.color=function(a,b,c,e){return a!==d&&b!==d&&c!==d&&e!==d?Ld(a,b,c,e):a!==d&&b!==d&&c!==d?Ld(a,b,c,gb):a!==d&&b!==d?Md(a,b):"number"==typeof a?Nd(a):Ld(hb,ib,jb,gb)},r.color.toString=function(a){return"rgba("+(255&a>>16)+","+(255&a>>8)+","+(255&a)+","+(255&a>>24)/255+")"},r.color.toInt=function(a,b,c,d){return 4278190080&d<<24|16711680&a<<16|65280&b<<8|255&c},r.color.toArray=function(a){return[255&a>>16,255&a>>8,255&a,255&a>>24]},r.color.toGLArray=function(a){return[((16711680&a)>>>16)/255,(255&a>>8)/255,(255&a)/255,(255&a>>24)/255]},r.color.toRGB=function(a,b,d){a=a>hb?hb:a,b=b>ib?ib:b,d=d>jb?jb:d,a=360*(a/hb),b=100*(b/ib),d=100*(d/jb);var e=c.round(255*(d/100));if(0===b)return[e,e,e];var f=a%360,g=f%60,h=c.round(255*(d*(100-b)/1e4)),i=c.round(255*(d*(6e3-b*g)/6e5)),j=c.round(255*(d*(6e3-b*(60-g))/6e5));switch(c.floor(f/60)){case 0:return[e,j,h];case 1:return[i,e,h];case 2:return[h,e,j];case 3:return[h,i,e];case 4:return[j,h,e];case 5:return[e,h,i]}},r.brightness=function(a){return Od(a)[2]},r.saturation=function(a){return Od(a)[1]},r.hue=function(a){return Od(a)[0]},r.red=function(a){return(255&a>>16)/255*hb},r.green=function(a){return((65280&a)>>>8)/255*ib},r.blue=function(a){return(255&a)/255*jb},r.alpha=function(a){return(255&a>>24)/255*gb},r.lerpColor=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,s,t,u,v=r.color(a),w=r.color(b);return 3===ob?(p=Od(v),k=(255&v>>24)/gb,q=Od(w),o=((4278190080&w)>>>24)/gb,t=r.lerp(p[0],q[0],c),u=r.lerp(p[1],q[1],c),f=r.lerp(p[2],q[2],c),s=r.color.toRGB(t,u,f),g=r.lerp(k,o,c)*gb,4278190080&g<<24|(255&s[0])<<16|(255&s[1])<<8|255&s[2]):(h=255&v>>16,i=255&v>>8,j=255&v,k=(255&v>>24)/gb,l=(16711680&w)>>>16,m=255&w>>8,n=255&w,o=(255&w>>24)/gb,d=0|r.lerp(h,l,c),e=0|r.lerp(i,m,c),f=0|r.lerp(j,n,c),g=r.lerp(k,o,c)*gb,4278190080&g<<24|16711680&d<<16|65280&e<<8|255&f)},r.colorMode=function(){ob=arguments[0],arguments.length>1&&(hb=arguments[1],ib=arguments[2]||arguments[1],jb=arguments[3]||arguments[1],gb=arguments[4]||arguments[1])},r.blendColor=function(a,b,c){return 0===c?r.modes.replace(a,b):1===c?r.modes.blend(a,b):2===c?r.modes.add(a,b):4===c?r.modes.subtract(a,b):8===c?r.modes.lightest(a,b):16===c?r.modes.darkest(a,b):32===c?r.modes.difference(a,b):64===c?r.modes.exclusion(a,b):128===c?r.modes.multiply(a,b):256===c?r.modes.screen(a,b):1024===c?r.modes.hard_light(a,b):2048===c?r.modes.soft_light(a,b):512===c?r.modes.overlay(a,b):4096===c?r.modes.dodge(a,b):8192===c?r.modes.burn(a,b):void 0},r.printMatrix=function(){Fc.print()},xd.prototype.translate=function(a,b){Fc.translate(a,b),Gc.invTranslate(a,b),s.translate(a,b)},yd.prototype.translate=function(a,b,c){Fc.translate(a,b,c),Gc.invTranslate(a,b,c)},xd.prototype.scale=function(a,b){Fc.scale(a,b),Gc.invScale(a,b),s.scale(a,b||a)},yd.prototype.scale=function(a,b,c){Fc.scale(a,b,c),Gc.invScale(a,b,c)},xd.prototype.transform=function(a){var b=a.array();s.transform(b[0],b[3],b[1],b[4],b[2],b[5])},yd.prototype.transformm=function(){throw"p.transform is currently not supported in 3D mode"},xd.prototype.pushMatrix=function(){Hc.load(Fc),Ic.load(Gc),Pd()},yd.prototype.pushMatrix=function(){Hc.load(Fc),Ic.load(Gc)},xd.prototype.popMatrix=function(){Fc.set(Hc.pop()),Gc.set(Ic.pop()),Qd()},yd.prototype.popMatrix=function(){Fc.set(Hc.pop()),Gc.set(Ic.pop())},xd.prototype.resetMatrix=function(){Fc.reset(),Gc.reset(),s.setTransform(1,0,0,1,0,0)},yd.prototype.resetMatrix=function(){Fc.reset(),Gc.reset()},wd.prototype.applyMatrix=function(){var a=arguments;Fc.apply(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]),Gc.invApply(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])},xd.prototype.applyMatrix=function(){for(var a=arguments,b=a.length;16>b;b++)a[b]=0;a[10]=a[15]=1,wd.prototype.applyMatrix.apply(this,a)},r.rotateX=function(a){Fc.rotateX(a),Gc.invRotateX(a)},xd.prototype.rotateZ=function(){throw"rotateZ() is not supported in 2D mode. Use rotate(float) instead."},yd.prototype.rotateZ=function(a){Fc.rotateZ(a),Gc.invRotateZ(a)},r.rotateY=function(a){Fc.rotateY(a),Gc.invRotateY(a)},xd.prototype.rotate=function(a){Fc.rotateZ(a),Gc.invRotateZ(a),s.rotate(a)},yd.prototype.rotate=function(a){r.rotateZ(a)},xd.prototype.shearX=function(a){Fc.shearX(a),s.transform(1,0,a,1,0,0)},yd.prototype.shearX=function(a){Fc.shearX(a)},xd.prototype.shearY=function(a){Fc.shearY(a),s.transform(1,a,0,1,0,0)},yd.prototype.shearY=function(a){Fc.shearY(a)},r.pushStyle=function(){Pd(),r.pushMatrix();var a={doFill:y,currentFillColor:B,doStroke:H,currentStrokeColor:J,curTint:pb,curRectMode:Q,curColorMode:ob,colorModeX:hb,colorModeZ:jb,colorModeY:ib,colorModeA:gb,curTextFont:gc,horizontalTextAlignment:$b,verticalTextAlignment:_b,textMode:ac,curFontName:bc,curTextSize:cc,curTextAscent:dc,curTextDescent:ec,curTextLeading:fc};_c.push(a)},r.popStyle=function(){var a=_c.pop();if(!a)throw"Too many popStyle() without enough pushStyle()";Qd(),r.popMatrix(),y=a.doFill,B=a.currentFillColor,H=a.doStroke,J=a.currentStrokeColor,pb=a.curTint,Q=a.curRectMode,ob=a.curColorMode,hb=a.colorModeX,jb=a.colorModeZ,ib=a.colorModeY,gb=a.colorModeA,gc=a.curTextFont,bc=a.curFontName,cc=a.curTextSize,$b=a.horizontalTextAlignment,_b=a.verticalTextAlignment,ac=a.textMode,dc=a.curTextAscent,ec=a.curTextDescent,fc=a.curTextLeading},r.year=function(){return(new Date).getFullYear()},r.month=function(){return(new Date).getMonth()+1},r.day=function(){return(new Date).getDate()},r.hour=function(){return(new Date).getHours()},r.minute=function(){return(new Date).getMinutes()},r.second=function(){return(new Date).getSeconds()},r.millis=function(){return Date.now()-sb},xd.prototype.redraw=function(){Rd(),s.lineWidth=L;var a=r.pmouseX,b=r.pmouseY;r.pmouseX=mb,r.pmouseY=nb,Pd(),r.draw(),Qd(),mb=r.mouseX,nb=r.mouseY,r.pmouseX=a,r.pmouseY=b},yd.prototype.redraw=function(){Rd();var a=r.pmouseX,b=r.pmouseY;r.pmouseX=mb,r.pmouseY=nb,s.clear(s.DEPTH_BUFFER_BIT),Cb={attributes:{},locations:{}},r.noLights(),r.lightFalloff(1,0,0),r.shininess(1),r.ambient(255,255,255),r.specular(0,0,0),r.emissive(0,0,0),r.camera(),r.draw(),mb=r.mouseX,nb=r.mouseY,r.pmouseX=a,r.pmouseY=b
  },r.noLoop=function(){O=!1,M=!1,clearInterval(P),u.onPause()},r.loop=function(){M||(tb=Date.now(),ub=0,P=a.setInterval(function(){try{u.onFrameStart(),r.redraw(),u.onFrameEnd()}catch(b){throw a.clearInterval(P),b}},X),O=!0,M=!0,u.onLoop())},r.frameRate=function(a){W=a,X=1e3/W,O&&(r.noLoop(),r.loop())};var Sd=[];r.exit=function(){a.clearInterval(P),C(r.externals.canvas.id),delete i.onmousedown;for(var b in G.lib)G.lib.hasOwnProperty(b)&&G.lib[b].hasOwnProperty("detach")&&G.lib[b].detach(r);for(var c=Sd.length;c--;)Ud(Sd[c]);u.onExit()},r.cursor=function(){if(arguments.length>1||1===arguments.length&&arguments[0]instanceof r.PImage){var b,c,a=arguments[0];if(arguments.length>=3){if(b=arguments[1],c=arguments[2],0>b||0>c||c>=a.height||b>=a.width)throw"x and y must be non-negative and less than the dimensions of the image"}else b=a.width>>>1,c=a.height>>>1;var d=a.toDataURL(),e='url("'+d+'") '+b+" "+c+", default";Y=i.style.cursor=e}else if(1===arguments.length){var f=arguments[0];Y=i.style.cursor=f}else Y=i.style.cursor=Z},r.noCursor=function(){Y=i.style.cursor=n.NOCURSOR},r.link=function(b,c){c!==d?a.open(b,c):a.location=b},r.beginDraw=e,r.endDraw=e,xd.prototype.toImageData=function(a,b,c,e){return a=a!==d?a:0,b=b!==d?b:0,c=c!==d?c:r.width,e=e!==d?e:r.height,s.getImageData(a,b,c,e)},yd.prototype.toImageData=function(a,e,f,g){a=a!==d?a:0,e=e!==d?e:0,f=f!==d?f:r.width,g=g!==d?g:r.height;var h=b.createElement("canvas"),i=h.getContext("2d"),j=i.createImageData(f,g),k=new m(4*f*g);s.readPixels(a,e,f,g,s.RGBA,s.UNSIGNED_BYTE,k);for(var l=0,n=k.length,o=j.data;n>l;l++)o[l]=k[4*(g-1-c.floor(l/4/f))*f+l%(4*f)];return j},r.status=function(b){a.status=b},r.binary=function(a,b){var c;if(b>0)c=b;else if(a instanceof Bd)c=16,a|=0;else for(c=32;c>1&&!(1&a>>>c-1);)c--;for(var d="";c>0;)d+=1&a>>>--c?"1":"0";return d},r.unbinary=function(a){for(var b=a.length-1,c=1,d=0;b>=0;){var e=a[b--];if("0"!==e&&"1"!==e)throw"the value passed into unbinary was not an 8 bit binary number";"1"===e&&(d+=c),c<<=1}return d},r.nf=function(a,b,c){return Wd(a,"","-",b,c)},r.nfs=function(a,b,c){return Wd(a," ","-",b,c)},r.nfp=function(a,b,c){return Wd(a,"+","-",b,c)},r.nfc=function(a,b,c){return Wd(a,"","-",b,c,",")};var Xd=function(a,b){b=b===d||null===b?b=8:b,0>a&&(a=4294967295+a+1);for(var c=Number(a).toString(16).toUpperCase();c.length<b;)c="0"+c;return c.length>=b&&(c=c.substring(c.length-b,c.length)),c};r.hex=function(a,b){return 1===arguments.length&&(b=a instanceof Bd?4:8),Xd(a,b)},r.unhex=function(a){if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b.push(Yd(a[c]));return b}return Yd(a)},r.loadStrings=function(a){if(localStorage[a])return localStorage[a].split("\n");var b=g(a);return"string"!=typeof b||""===b?[]:(b=b.replace(/(\r\n?)/g,"\n").replace(/\n$/,""),b.split("\n"))},r.saveStrings=function(a,b){localStorage[a]=b.join("\n")},r.loadBytes=function(a){for(var b=g(a),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return c},r.matchAll=function(a,b){for(var d,c=[],e=new RegExp(b,"g");null!==(d=e.exec(a));)c.push(d),0===d[0].length&&++e.lastIndex;return c.length>0?c:null},r.__contains=function(a,b){return"string"!=typeof a?a.contains.apply(a,Zd(arguments)):null!==a&&null!==b&&"string"==typeof b&&a.indexOf(b)>-1},r.__replaceAll=function(a,b,c){return"string"!=typeof a?a.replaceAll.apply(a,Zd(arguments)):a.replace(new RegExp(b,"g"),c)},r.__replaceFirst=function(a,b,c){return"string"!=typeof a?a.replaceFirst.apply(a,Zd(arguments)):a.replace(new RegExp(b,""),c)},r.__replace=function(a,b,c){if("string"!=typeof a)return a.replace.apply(a,Zd(arguments));if(b instanceof RegExp)return a.replace(b,c);if("string"!=typeof b&&(b=b.toString()),""===b)return a;var d=a.indexOf(b);if(0>d)return a;var e=0,f="";do f+=a.substring(e,d)+c,e=d+b.length;while((d=a.indexOf(b,e))>=0);return f+a.substring(e)},r.__equals=function(a,b){return a.equals instanceof Function?a.equals.apply(a,Zd(arguments)):a.valueOf()===b.valueOf()},r.__equalsIgnoreCase=function(a,b){return"string"!=typeof a?a.equalsIgnoreCase.apply(a,Zd(arguments)):a.toLowerCase()===b.toLowerCase()},r.__toCharArray=function(a){if("string"!=typeof a)return a.toCharArray.apply(a,Zd(arguments));for(var b=[],c=0,d=a.length;d>c;++c)b[c]=new Bd(a.charAt(c));return b},r.__split=function(a,b,c){if("string"!=typeof a)return a.split.apply(a,Zd(arguments));var e=new RegExp(b);if(c===d||1>c)return a.split(e);for(var h,f=[],g=a;-1!==(h=g.search(e))&&f.length<c-1;){var i=e.exec(g).toString();f.push(g.substring(0,h)),g=g.substring(h+i.length)}return(-1!==h||""!==g)&&f.push(g),f},r.__codePointAt=function(a,b){var d,e,c=a.charCodeAt(b);return c>=55296&&56319>=c?(d=c,e=a.charCodeAt(b+1),1024*(d-55296)+(e-56320)+65536):c},r.match=function(a,b){return a.match(b)},r.__matches=function(a,b){return new RegExp(b).test(a)},r.__startsWith=function(a,b,c){return"string"!=typeof a?a.startsWith.apply(a,Zd(arguments)):(c=c||0,0>c||c>a.length?!1:""===b||b===a?!0:a.indexOf(b)===c)},r.__endsWith=function(a,b){if("string"!=typeof a)return a.endsWith.apply(a,Zd(arguments));var c=b?b.length:0;return""===b||b===a?!0:a.indexOf(b)===a.length-c},r.__hashCode=function(a){return a.hashCode instanceof Function?a.hashCode.apply(a,Zd(arguments)):o(a)},r.__printStackTrace=function(a){r.println("Exception: "+a.toString())};var $d=[];r.println=function(a){var b=$d.length;b&&(G.logger.log($d.join("")),$d.length=0),0===arguments.length&&0===b?G.logger.log(""):0!==arguments.length&&G.logger.log(a)},r.print=function(a){$d.push(a)},r.str=function(a){if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString()+"");return b}return a.toString()+""},r.trim=function(a){if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b.push(a[c].replace(/^\s*/,"").replace(/\s*$/,"").replace(/\r*$/,""));return b}return a.replace(/^\s*/,"").replace(/\s*$/,"").replace(/\r*$/,"")},r.parseBoolean=function(a){if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b.push(_d(a[c]));return b}return _d(a)},r.parseByte=function(a){if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b.push(0-(128&a[c])|127&a[c]);return b}return 0-(128&a)|127&a},r.parseChar=function(a){if("number"==typeof a)return new Bd(String.fromCharCode(65535&a));if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b.push(new Bd(String.fromCharCode(65535&a[c])));return b}throw"char() may receive only one argument of type int, byte, int[], or byte[]."},r.parseFloat=function(a){if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b.push(ae(a[c]));return b}return ae(a)},r.parseInt=function(a,b){if(a instanceof Array){for(var c=[],d=0;d<a.length;d++)"string"!=typeof a[d]||/^\s*[+\-]?\d+\s*$/.test(a[d])?c.push(be(a[d],b)):c.push(0);return c}return be(a,b)},r.__int_cast=function(a){return 0|a},r.__instanceof=function(a,b){if("function"!=typeof b)throw"Function is expected as type argument for instanceof operator";if("string"==typeof a)return b===Object||b===String;if(a instanceof b)return!0;if("object"!=typeof a||null===a)return!1;var c=a.constructor;if(b.$isInterface){for(var d=[];c;)c.$interfaces&&(d=d.concat(c.$interfaces)),c=c.$base;for(;d.length>0;){var e=d.shift();if(e===b)return!0;e.$interfaces&&(d=d.concat(e.$interfaces))}return!1}for(;c.hasOwnProperty("$base");)if(c=c.$base,c===b)return!0;return!1},r.abs=c.abs,r.ceil=c.ceil,r.constrain=function(a,b,c){return a>c?c:b>a?b:a},r.dist=function(){var a,b,d;return 4===arguments.length?(a=arguments[0]-arguments[2],b=arguments[1]-arguments[3],c.sqrt(a*a+b*b)):6===arguments.length?(a=arguments[0]-arguments[3],b=arguments[1]-arguments[4],d=arguments[2]-arguments[5],c.sqrt(a*a+b*b+d*d)):void 0},r.exp=c.exp,r.floor=c.floor,r.lerp=function(a,b,c){return(b-a)*c+a},r.log=c.log,r.mag=function(a,b,d){return d?c.sqrt(a*a+b*b+d*d):c.sqrt(a*a+b*b)},r.map=function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},r.max=function(){if(2===arguments.length)return arguments[0]<arguments[1]?arguments[1]:arguments[0];var a=1===arguments.length?arguments[0]:arguments;if(!("length"in a&&a.length>0))throw"Non-empty array is expected";for(var b=a[0],c=a.length,d=1;c>d;++d)b<a[d]&&(b=a[d]);return b},r.min=function(){if(2===arguments.length)return arguments[0]<arguments[1]?arguments[0]:arguments[1];var a=1===arguments.length?arguments[0]:arguments;if(!("length"in a&&a.length>0))throw"Non-empty array is expected";for(var b=a[0],c=a.length,d=1;c>d;++d)b>a[d]&&(b=a[d]);return b},r.norm=function(a,b,c){return(a-b)/(c-b)},r.pow=c.pow,r.round=c.round,r.sq=function(a){return a*a},r.sqrt=c.sqrt,r.acos=c.acos,r.asin=c.asin,r.atan=c.atan,r.atan2=c.atan2,r.cos=c.cos,r.degrees=function(a){return 180*a/c.PI},r.radians=function(a){return a/180*c.PI},r.sin=c.sin,r.tan=c.tan;var ce=c.random;r.random=function(){if(0===arguments.length)return ce();if(1===arguments.length)return ce()*arguments[0];var a=arguments[0],b=arguments[1];return ce()*(b-a)+a},de.createRandomized=function(){var a=new Date;return new de(4294967295&a/6e4,4294967295&a)},r.randomSeed=function(a){ce=new de(a).nextDouble},r.Random=function(a){var e,f,b=!1;this.nextGaussian=function(){if(b)return b=!1,e;var a,d,g;do a=2*f()-1,d=2*f()-1,g=a*a+d*d;while(g>=1||0===g);var h=c.sqrt(-2*c.log(g)/g);return e=d*h,b=!0,a*h},f=a===d?c.random:new de(a).nextDouble};var fe={generator:d,octaves:4,fallout:.5,seed:d};r.noise=function(a,b,c){fe.generator===d&&(fe.generator=new ee(fe.seed));for(var e=fe.generator,f=1,g=1,h=0,i=0;i<fe.octaves;++i){switch(f*=fe.fallout,arguments.length){case 1:h+=f*(1+e.noise1d(g*a))/2;break;case 2:h+=f*(1+e.noise2d(g*a,g*b))/2;break;case 3:h+=f*(1+e.noise3d(g*a,g*b,g*c))/2}g*=2}return h},r.noiseDetail=function(a,b){fe.octaves=a,b!==d&&(fe.fallout=b)},r.noiseSeed=function(a){fe.seed=a,fe.generator=d},wd.prototype.size=function(a,b){H&&r.stroke(0),y&&r.fill(255);var e={fillStyle:s.fillStyle,strokeStyle:s.strokeStyle,lineCap:s.lineCap,lineJoin:s.lineJoin};i.style.length>0&&(i.style.removeProperty("width"),i.style.removeProperty("height")),i.width=r.width=a||100,i.height=r.height=b||100;for(var f in e)e.hasOwnProperty(f)&&(s[f]=e[f]);r.textFont(gc),r.background(),lc=c.max(1e3,.05*a*b),r.externals.context=s;for(var g=0;720>g;g++)zc[g]=r.sin(.5*g*(c.PI/180)),Ac[g]=r.cos(.5*g*(c.PI/180))},xd.prototype.size=function(){s===d&&(s=i.getContext("2d"),Hc=new Kd,Ic=new Kd,Fc=new Id,Gc=new Id),wd.prototype.size.apply(this,arguments)},yd.prototype.size=function(){var a=!1;return function(b,c){function e(a){for(var c,b=["experimental-webgl","webgl","webkit-3d"],d=0,e=b.length;e>d&&!(c=a.getContext(b[d],{antialias:!1,preserveDrawingBuffer:!0}));d++);return c}if(a)throw"Multiple calls to size() for 3D renders are not allowed.";a=!0;try{i.width=r.width=b||100,i.height=r.height=c||100,s=e(i),Sb=s.createTexture(),Tb=s.createTexture()}catch(f){G.debug(f)}if(!s)throw"WebGL context is not supported on this browser.";s.viewport(0,0,i.width,i.height),s.enable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),Eb=rd(s,hd,id),Fb=rd(s,fd,gd),r.strokeWeight(1),Db=rd(s,kd,ld),s.useProgram(Db),nd("usingTexture3d",Db,"usingTexture",Wb),r.lightFalloff(1,0,0),r.shininess(1),r.ambient(255,255,255),r.specular(0,0,0),r.emissive(0,0,0),Gb=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,Gb),s.bufferData(s.ARRAY_BUFFER,ad,s.STATIC_DRAW),Hb=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,Hb),s.bufferData(s.ARRAY_BUFFER,cd,s.STATIC_DRAW),Ib=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,Ib),s.bufferData(s.ARRAY_BUFFER,bd,s.STATIC_DRAW),Jb=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,Jb),s.bufferData(s.ARRAY_BUFFER,dd,s.STATIC_DRAW),Kb=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,Kb),s.bufferData(s.ARRAY_BUFFER,ed,s.STATIC_DRAW),Lb=s.createBuffer(),Mb=s.createBuffer(),Nb=s.createBuffer(),Ob=s.createBuffer(),Pb=s.createBuffer(),Rb=s.createBuffer(),Qb=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,Qb),s.bufferData(s.ARRAY_BUFFER,new j([0,0,0]),s.STATIC_DRAW),Xb=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,Xb),s.bufferData(s.ARRAY_BUFFER,new j([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),s.STATIC_DRAW),Yb=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,Yb),s.bufferData(s.ARRAY_BUFFER,new j([0,0,1,0,1,1,0,1]),s.STATIC_DRAW),Zb=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,Zb),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new l([0,1,2,2,3,0]),s.STATIC_DRAW),Dc=new Jd,Ec=new Jd,Fc=new Jd,Gc=new Jd,Kc=new Jd,r.camera(),r.perspective(),Hc=new Kd,Ic=new Kd,wb=new Jd,xb=new Jd,yb=new Jd,zb=new Jd,Ab=new Jd,Bb=new Jd,Bb.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0),wd.prototype.size.apply(this,arguments)}}(),xd.prototype.ambientLight=wd.prototype.a3DOnlyFunction,yd.prototype.ambientLight=function(a,b,c,d,e,f){if(8===tc)throw"can only create 8 lights";var g=new t(d,e,f),h=new Jd;h.scale(1,-1,1),h.apply(Fc.array()),h.mult(g,g);var i=Ld(a,b,c,0),j=[(255&i>>16)/255,(255&i>>8)/255,(255&i)/255];s.useProgram(Db),md("uLights.color.3d."+tc,Db,"uLights"+tc+".color",j),md("uLights.position.3d."+tc,Db,"uLights"+tc+".position",g.array()),nd("uLights.type.3d."+tc,Db,"uLights"+tc+".type",0),nd("uLightCount3d",Db,"uLightCount",++tc)},xd.prototype.directionalLight=wd.prototype.a3DOnlyFunction,yd.prototype.directionalLight=function(a,b,c,d,e,f){if(8===tc)throw"can only create 8 lights";s.useProgram(Db);var g=new Jd;g.scale(1,-1,1),g.apply(Fc.array()),g=g.array();var h=[g[0]*d+g[4]*e+g[8]*f,g[1]*d+g[5]*e+g[9]*f,g[2]*d+g[6]*e+g[10]*f],i=Ld(a,b,c,0),j=[(255&i>>16)/255,(255&i>>8)/255,(255&i)/255];md("uLights.color.3d."+tc,Db,"uLights"+tc+".color",j),md("uLights.position.3d."+tc,Db,"uLights"+tc+".position",h),nd("uLights.type.3d."+tc,Db,"uLights"+tc+".type",1),nd("uLightCount3d",Db,"uLightCount",++tc)},xd.prototype.lightFalloff=wd.prototype.a3DOnlyFunction,yd.prototype.lightFalloff=function(a,b,c){s.useProgram(Db),md("uFalloff3d",Db,"uFalloff",[a,b,c])},xd.prototype.lightSpecular=wd.prototype.a3DOnlyFunction,yd.prototype.lightSpecular=function(a,b,c){var d=Ld(a,b,c,0),e=[(255&d>>16)/255,(255&d>>8)/255,(255&d)/255];s.useProgram(Db),md("uSpecular3d",Db,"uSpecular",e)},r.lights=function(){r.ambientLight(128,128,128),r.directionalLight(128,128,128,0,0,-1),r.lightFalloff(1,0,0),r.lightSpecular(0,0,0)},xd.prototype.pointLight=wd.prototype.a3DOnlyFunction,yd.prototype.pointLight=function(a,b,c,d,e,f){if(8===tc)throw"can only create 8 lights";var g=new t(d,e,f),h=new Jd;h.scale(1,-1,1),h.apply(Fc.array()),h.mult(g,g);var i=Ld(a,b,c,0),j=[(255&i>>16)/255,(255&i>>8)/255,(255&i)/255];s.useProgram(Db),md("uLights.color.3d."+tc,Db,"uLights"+tc+".color",j),md("uLights.position.3d."+tc,Db,"uLights"+tc+".position",g.array()),nd("uLights.type.3d."+tc,Db,"uLights"+tc+".type",2),nd("uLightCount3d",Db,"uLightCount",++tc)},xd.prototype.noLights=wd.prototype.a3DOnlyFunction,yd.prototype.noLights=function(){tc=0,s.useProgram(Db),nd("uLightCount3d",Db,"uLightCount",tc)},xd.prototype.spotLight=wd.prototype.a3DOnlyFunction,yd.prototype.spotLight=function(a,b,c,d,e,f,g,h,i,j,k){if(8===tc)throw"can only create 8 lights";s.useProgram(Db);var l=new t(d,e,f),m=new Jd;m.scale(1,-1,1),m.apply(Fc.array()),m.mult(l,l),m=m.array();var n=[m[0]*g+m[4]*h+m[8]*i,m[1]*g+m[5]*h+m[9]*i,m[2]*g+m[6]*h+m[10]*i],o=Ld(a,b,c,0),p=[(255&o>>16)/255,(255&o>>8)/255,(255&o)/255];md("uLights.color.3d."+tc,Db,"uLights"+tc+".color",p),md("uLights.position.3d."+tc,Db,"uLights"+tc+".position",l.array()),md("uLights.direction.3d."+tc,Db,"uLights"+tc+".direction",n),md("uLights.concentration.3d."+tc,Db,"uLights"+tc+".concentration",k),md("uLights.angle.3d."+tc,Db,"uLights"+tc+".angle",j),nd("uLights.type.3d."+tc,Db,"uLights"+tc+".type",3),nd("uLightCount3d",Db,"uLightCount",++tc)},xd.prototype.beginCamera=function(){throw"beginCamera() is not available in 2D mode"},yd.prototype.beginCamera=function(){if(Lc)throw"You cannot call beginCamera() again before calling endCamera()";Lc=!0,Fc=Ec,Gc=Dc},xd.prototype.endCamera=function(){throw"endCamera() is not available in 2D mode"},yd.prototype.endCamera=function(){if(!Lc)throw"You cannot call endCamera() before calling beginCamera()";Fc.set(Dc),Gc.set(Ec),Lc=!1},r.camera=function(a,b,e,f,g,h,i,j,k){a===d&&(Oc=r.width/2,Pc=r.height/2,Qc=Pc/c.tan(Nc/2),a=Oc,b=Pc,e=Qc,f=Oc,g=Pc,h=0,i=0,j=1,k=0);var l=new t(a-f,b-g,e-h),m=new t(i,j,k);l.normalize();var n=t.cross(m,l);m=t.cross(l,n),n.normalize(),m.normalize();var o=n.x,p=n.y,q=n.z,s=m.x,u=m.y,v=m.z,w=l.x,x=l.y,y=l.z;Dc.set(o,p,q,0,s,u,v,0,w,x,y,0,0,0,0,1),Dc.translate(-a,-b,-e),Ec.reset(),Ec.invApply(o,p,q,0,s,u,v,0,w,x,y,0,0,0,0,1),Ec.translate(a,b,e),Fc.set(Dc),Gc.set(Ec)},r.perspective=function(a,b,d,e){0===arguments.length&&(Pc=i.height/2,Qc=Pc/c.tan(Nc/2),Rc=Qc/10,Sc=10*Qc,Tc=r.width/r.height,a=Nc,b=Tc,d=Rc,e=Sc);var f,g,h,j;f=d*c.tan(a/2),g=-f,h=f*b,j=g*b,r.frustum(j,h,g,f,d,e)},xd.prototype.frustum=function(){throw"Processing.js: frustum() is not supported in 2D mode"},yd.prototype.frustum=function(a,b,c,d,e,f){Mc=!0,Kc=new Jd,Kc.set(2*e/(b-a),0,(b+a)/(b-a),0,0,2*e/(d-c),(d+c)/(d-c),0,0,0,-(f+e)/(f-e),-(2*f*e)/(f-e),0,0,-1,0);var g=new Jd;g.set(Kc),g.transpose(),s.useProgram(Eb),od("projection2d",Eb,"uProjection",!1,g.array()),s.useProgram(Db),od("projection3d",Db,"uProjection",!1,g.array()),s.useProgram(Fb),od("uProjectionUS",Fb,"uProjection",!1,g.array())},r.ortho=function(a,b,c,d,e,f){0===arguments.length&&(a=0,b=r.width,c=0,d=r.height,e=-10,f=10);var g=2/(b-a),h=2/(d-c),i=-2/(f-e),j=-(b+a)/(b-a),k=-(d+c)/(d-c),l=-(f+e)/(f-e);Kc=new Jd,Kc.set(g,0,0,j,0,h,0,k,0,0,i,l,0,0,0,1);var m=new Jd;m.set(Kc),m.transpose(),s.useProgram(Eb),od("projection2d",Eb,"uProjection",!1,m.array()),s.useProgram(Db),od("projection3d",Db,"uProjection",!1,m.array()),s.useProgram(Fb),od("uProjectionUS",Fb,"uProjection",!1,m.array()),Mc=!1},r.printProjection=function(){Kc.print()},r.printCamera=function(){Dc.print()},xd.prototype.box=wd.prototype.a3DOnlyFunction,yd.prototype.box=function(a,b,c){b&&c||(b=c=a);var d=new Jd;d.scale(a,b,c);var e=new Jd;if(e.scale(1,-1,1),e.apply(Fc.array()),e.transpose(),y){if(s.useProgram(Db),od("model3d",Db,"uModel",!1,d.array()),od("view3d",Db,"uView",!1,e.array()),s.enable(s.POLYGON_OFFSET_FILL),s.polygonOffset(1,1),md("color3d",Db,"uColor",A),tc>0){var f=new Jd;f.set(e);var g=new Jd;g.set(d),f.mult(g);var h=new Jd;h.set(f),h.invert(),h.transpose(),od("uNormalTransform3d",Db,"uNormalTransform",!1,h.array()),pd("aNormal3d",Db,"aNormal",3,Hb)}else qd("aNormal3d",Db,"aNormal");pd("aVertex3d",Db,"aVertex",3,Gb),qd("aColor3d",Db,"aColor"),qd("aTexture3d",Db,"aTexture"),s.drawArrays(s.TRIANGLES,0,ad.length/3),s.disable(s.POLYGON_OFFSET_FILL)}L>0&&H&&(s.useProgram(Eb),od("uModel2d",Eb,"uModel",!1,d.array()),od("uView2d",Eb,"uView",!1,e.array()),md("uColor2d",Eb,"uColor",I),nd("uIsDrawingText2d",Eb,"uIsDrawingText",!1),pd("vertex2d",Eb,"aVertex",3,Ib),qd("aTextureCoord2d",Eb,"aTextureCoord"),s.drawArrays(s.LINES,0,bd.length/3))};var ge=function(){var a;for(Bc=[],a=0;vc>a;a++)Bc.push(0),Bc.push(-1),Bc.push(0),Bc.push(wc[a]),Bc.push(xc[a]),Bc.push(yc[a]);Bc.push(0),Bc.push(-1),Bc.push(0),Bc.push(wc[0]),Bc.push(xc[0]),Bc.push(yc[0]);var b,c,d,e=0;for(a=2;uc>a;a++){b=c=e,e+=vc,d=e;for(var f=0;vc>f;f++)Bc.push(wc[b]),Bc.push(xc[b]),Bc.push(yc[b++]),Bc.push(wc[d]),Bc.push(xc[d]),Bc.push(yc[d++]);b=c,d=e,Bc.push(wc[b]),Bc.push(xc[b]),Bc.push(yc[b]),Bc.push(wc[d]),Bc.push(xc[d]),Bc.push(yc[d])}for(a=0;vc>a;a++)d=e+a,Bc.push(wc[d]),Bc.push(xc[d]),Bc.push(yc[d]),Bc.push(0),Bc.push(1),Bc.push(0);Bc.push(wc[e]),Bc.push(xc[e]),Bc.push(yc[e]),Bc.push(0),Bc.push(1),Bc.push(0),s.bindBuffer(s.ARRAY_BUFFER,Lb),s.bufferData(s.ARRAY_BUFFER,new j(Bc),s.STATIC_DRAW)};r.sphereDetail=function(a,b){var c;if(1===arguments.length&&(a=b=arguments[0]),3>a&&(a=3),2>b&&(b=2),a!==vc||b!==uc){var d=720/a,e=new j(a),f=new j(a);for(c=0;a>c;c++)e[c]=Ac[0|c*d%720],f[c]=zc[0|c*d%720];var g=a*(b-1)+2,h=0;wc=new j(g),xc=new j(g),yc=new j(g);var i=360/b,k=i;for(c=1;b>c;c++){for(var l=zc[0|k%720],m=-Ac[0|k%720],n=0;a>n;n++)wc[h]=e[n]*l,xc[h]=m,yc[h++]=f[n]*l;k+=i}vc=a,uc=b,ge()}},xd.prototype.sphere=wd.prototype.a3DOnlyFunction,yd.prototype.sphere=function(){var a=arguments[0];(3>vc||2>uc)&&r.sphereDetail(30);var b=new Jd;b.scale(a,a,a);var c=new Jd;if(c.scale(1,-1,1),c.apply(Fc.array()),c.transpose(),y){if(tc>0){var d=new Jd;d.set(c);var e=new Jd;e.set(b),d.mult(e);var f=new Jd;f.set(d),f.invert(),f.transpose(),od("uNormalTransform3d",Db,"uNormalTransform",!1,f.array()),pd("aNormal3d",Db,"aNormal",3,Lb)}else qd("aNormal3d",Db,"aNormal");s.useProgram(Db),qd("aTexture3d",Db,"aTexture"),od("uModel3d",Db,"uModel",!1,b.array()),od("uView3d",Db,"uView",!1,c.array()),pd("aVertex3d",Db,"aVertex",3,Lb),qd("aColor3d",Db,"aColor"),s.enable(s.POLYGON_OFFSET_FILL),s.polygonOffset(1,1),md("uColor3d",Db,"uColor",A),s.drawArrays(s.TRIANGLE_STRIP,0,Bc.length/3),s.disable(s.POLYGON_OFFSET_FILL)}L>0&&H&&(s.useProgram(Eb),od("uModel2d",Eb,"uModel",!1,b.array()),od("uView2d",Eb,"uView",!1,c.array()),pd("aVertex2d",Eb,"aVertex",3,Lb),qd("aTextureCoord2d",Eb,"aTextureCoord"),md("uColor2d",Eb,"uColor",I),nd("uIsDrawingText",Eb,"uIsDrawingText",!1),s.drawArrays(s.LINE_STRIP,0,Bc.length/3))},r.modelX=function(a,b,c){var d=Fc.array(),e=Ec.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[0]*f+e[1]*g+e[2]*h+e[3]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;return 0!==k?j/k:j},r.modelY=function(a,b,c){var d=Fc.array(),e=Ec.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[4]*f+e[5]*g+e[6]*h+e[7]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;return 0!==k?j/k:j},r.modelZ=function(a,b,c){var d=Fc.array(),e=Ec.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[8]*f+e[9]*g+e[10]*h+e[11]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;return 0!==k?j/k:j},xd.prototype.ambient=wd.prototype.a3DOnlyFunction,yd.prototype.ambient=function(a,b,c){s.useProgram(Db),nd("uUsingMat3d",Db,"uUsingMat",!0);var d=r.color(a,b,c);md("uMaterialAmbient3d",Db,"uMaterialAmbient",r.color.toGLArray(d).slice(0,3))},xd.prototype.emissive=wd.prototype.a3DOnlyFunction,yd.prototype.emissive=function(a,b,c){s.useProgram(Db),nd("uUsingMat3d",Db,"uUsingMat",!0);var d=r.color(a,b,c);md("uMaterialEmissive3d",Db,"uMaterialEmissive",r.color.toGLArray(d).slice(0,3))},xd.prototype.shininess=wd.prototype.a3DOnlyFunction,yd.prototype.shininess=function(a){s.useProgram(Db),nd("uUsingMat3d",Db,"uUsingMat",!0),md("uShininess3d",Db,"uShininess",a)},xd.prototype.specular=wd.prototype.a3DOnlyFunction,yd.prototype.specular=function(a,b,c){s.useProgram(Db),nd("uUsingMat3d",Db,"uUsingMat",!0);var d=r.color(a,b,c);md("uMaterialSpecular3d",Db,"uMaterialSpecular",r.color.toGLArray(d).slice(0,3))},r.screenX=function(a,b,c){var d=Fc.array();if(16===d.length){var e=d[0]*a+d[1]*b+d[2]*c+d[3],f=d[4]*a+d[5]*b+d[6]*c+d[7],g=d[8]*a+d[9]*b+d[10]*c+d[11],h=d[12]*a+d[13]*b+d[14]*c+d[15],i=Kc.array(),j=i[0]*e+i[1]*f+i[2]*g+i[3]*h,k=i[12]*e+i[13]*f+i[14]*g+i[15]*h;return 0!==k&&(j/=k),r.width*(1+j)/2}return Fc.multX(a,b)},r.screenY=function(a,b,c){var d=Fc.array();if(16===d.length){var e=d[0]*a+d[1]*b+d[2]*c+d[3],f=d[4]*a+d[5]*b+d[6]*c+d[7],g=d[8]*a+d[9]*b+d[10]*c+d[11],h=d[12]*a+d[13]*b+d[14]*c+d[15],i=Kc.array(),j=i[4]*e+i[5]*f+i[6]*g+i[7]*h,k=i[12]*e+i[13]*f+i[14]*g+i[15]*h;return 0!==k&&(j/=k),r.height*(1+j)/2}return Fc.multY(a,b)},r.screenZ=function(a,b,c){var d=Fc.array();if(16!==d.length)return 0;var e=Kc.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[8]*f+e[9]*g+e[10]*h+e[11]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;return 0!==k&&(j/=k),(j+1)/2},wd.prototype.fill=function(){var a=r.color(arguments[0],arguments[1],arguments[2],arguments[3]);a===B&&y||(y=!0,B=a)},xd.prototype.fill=function(){wd.prototype.fill.apply(this,arguments),E=!0},yd.prototype.fill=function(){wd.prototype.fill.apply(this,arguments),A=r.color.toGLArray(B)},r.noFill=function(){y=!1},wd.prototype.stroke=function(){var a=r.color(arguments[0],arguments[1],arguments[2],arguments[3]);a===J&&H||(H=!0,J=a)},xd.prototype.stroke=function(){wd.prototype.stroke.apply(this,arguments),K=!0},yd.prototype.stroke=function(){wd.prototype.stroke.apply(this,arguments),I=r.color.toGLArray(J)},r.noStroke=function(){H=!1},wd.prototype.strokeWeight=function(a){L=a},xd.prototype.strokeWeight=function(a){wd.prototype.strokeWeight.apply(this,arguments),s.lineWidth=a},yd.prototype.strokeWeight=function(a){wd.prototype.strokeWeight.apply(this,arguments),s.useProgram(Eb),md("pointSize2d",Eb,"uPointSize",a),s.useProgram(Fb),md("pointSizeUnlitShape",Fb,"uPointSize",a),s.lineWidth(a)},r.strokeCap=function(a){w.$ensureContext().lineCap=a},r.strokeJoin=function(a){w.$ensureContext().lineJoin=a},xd.prototype.smooth=function(){N=!0;var a=i.style;a.setProperty("image-rendering","optimizeQuality","important"),a.setProperty("-ms-interpolation-mode","bicubic","important"),s.hasOwnProperty("mozImageSmoothingEnabled")&&(s.mozImageSmoothingEnabled=!0)},yd.prototype.smooth=function(){N=!0},xd.prototype.noSmooth=function(){N=!1;var a=i.style;a.setProperty("image-rendering","optimizeSpeed","important"),a.setProperty("image-rendering","-moz-crisp-edges","important"),a.setProperty("image-rendering","-webkit-optimize-contrast","important"),a.setProperty("image-rendering","optimize-contrast","important"),a.setProperty("-ms-interpolation-mode","nearest-neighbor","important"),s.hasOwnProperty("mozImageSmoothingEnabled")&&(s.mozImageSmoothingEnabled=!1)},yd.prototype.noSmooth=function(){N=!1},xd.prototype.point=function(a,b){H&&(a=c.round(a),b=c.round(b),s.fillStyle=r.color.toString(J),E=!0,L>1?(s.beginPath(),s.arc(a,b,L/2,0,6.283185307179586,!1),s.fill()):s.fillRect(a,b,1,1))},yd.prototype.point=function(a,b,c){var d=new Jd;d.translate(a,b,c||0),d.transpose();var e=new Jd;e.scale(1,-1,1),e.apply(Fc.array()),e.transpose(),s.useProgram(Eb),od("uModel2d",Eb,"uModel",!1,d.array()),od("uView2d",Eb,"uView",!1,e.array()),L>0&&H&&(md("uColor2d",Eb,"uColor",I),nd("uIsDrawingText2d",Eb,"uIsDrawingText",!1),nd("uSmooth2d",Eb,"uSmooth",N),pd("aVertex2d",Eb,"aVertex",3,Qb),qd("aTextureCoord2d",Eb,"aTextureCoord"),s.drawArrays(s.POINTS,0,1))},r.beginShape=function(a){$=a,ab=[],Uc=[]},xd.prototype.vertex=function(a,b,c){var d=[];Zc&&(Zc=!1),d.isVert=!0,d[0]=a,d[1]=b,d[2]=0,d[3]=0,d[4]=0,d[5]=B,d[6]=J,Uc.push(d),c&&(Uc[Uc.length-1].moveTo=c)},yd.prototype.vertex=function(a,b,c,e,f){var g=[];Zc&&(Zc=!1),g.isVert=!0,f===d&&Wb&&(f=e,e=c,c=0),e!==d&&f!==d&&(2===Vb&&(e/=Ub.width,f/=Ub.height),e=e>1?1:e,e=0>e?0:e,f=f>1?1:f,f=0>f?0:f),g[0]=a,g[1]=b,g[2]=c||0,g[3]=e||0,g[4]=f||0,g[5]=A[0],g[6]=A[1],g[7]=A[2],g[8]=A[3],g[9]=I[0],g[10]=I[1],g[11]=I[2],g[12]=I[3],g[13]=S,g[14]=T,g[15]=U,Uc.push(g)};var je=function(a,b){var c=new Jd;c.scale(1,-1,1),c.apply(Fc.array()),c.transpose(),s.useProgram(Fb),od("uViewUS",Fb,"uView",!1,c.array()),nd("uSmoothUS",Fb,"uSmooth",N),pd("aVertexUS",Fb,"aVertex",3,Qb),s.bufferData(s.ARRAY_BUFFER,new j(a),s.STREAM_DRAW),pd("aColorUS",Fb,"aColor",4,Ob),s.bufferData(s.ARRAY_BUFFER,new j(b),s.STREAM_DRAW),s.drawArrays(s.POINTS,0,a.length/3)},ke=function(a,b,c){var d;d="LINES"===b?s.LINES:"LINE_LOOP"===b?s.LINE_LOOP:s.LINE_STRIP;var e=new Jd;e.scale(1,-1,1),e.apply(Fc.array()),e.transpose(),s.useProgram(Fb),od("uViewUS",Fb,"uView",!1,e.array()),pd("aVertexUS",Fb,"aVertex",3,Mb),s.bufferData(s.ARRAY_BUFFER,new j(a),s.STREAM_DRAW),pd("aColorUS",Fb,"aColor",4,Pb),s.bufferData(s.ARRAY_BUFFER,new j(c),s.STREAM_DRAW),s.drawArrays(d,0,a.length/3)},le=function(a,b,c,d){var e;e="TRIANGLES"===b?s.TRIANGLES:"TRIANGLE_FAN"===b?s.TRIANGLE_FAN:s.TRIANGLE_STRIP;var f=new Jd;f.scale(1,-1,1),f.apply(Fc.array()),f.transpose(),s.useProgram(Db),od("model3d",Db,"uModel",!1,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),od("view3d",Db,"uView",!1,f.array()),s.enable(s.POLYGON_OFFSET_FILL),s.polygonOffset(1,1),md("color3d",Db,"uColor",[-1,0,0,0]),pd("vertex3d",Db,"aVertex",3,Nb),s.bufferData(s.ARRAY_BUFFER,new j(a),s.STREAM_DRAW),Wb&&null!==pb&&qb(c),pd("aColor3d",Db,"aColor",4,Ob),s.bufferData(s.ARRAY_BUFFER,new j(c),s.STREAM_DRAW),qd("aNormal3d",Db,"aNormal"),Wb&&(nd("uUsingTexture3d",Db,"uUsingTexture",Wb),pd("aTexture3d",Db,"aTexture",2,Rb),s.bufferData(s.ARRAY_BUFFER,new j(d),s.STREAM_DRAW)),s.drawArrays(e,0,a.length/3),s.disable(s.POLYGON_OFFSET_FILL)};xd.prototype.endShape=function(a){if(0!==Uc.length){var b=2===a;b&&Uc.push(Uc[0]);var i,e=[],f=[],g=[],h=[];Zc=!0;var j,k,m=Uc.length;for(j=0;m>j;j++)for(i=Uc[j],k=0;3>k;k++)e.push(i[k]);for(j=0;m>j;j++)for(i=Uc[j],k=5;9>k;k++)f.push(i[k]);for(j=0;m>j;j++)for(i=Uc[j],k=9;13>k;k++)g.push(i[k]);for(j=0;m>j;j++)i=Uc[j],h.push(i[3]),h.push(i[4]);if(!Xc||20!==$&&$!==d)if(!Yc||20!==$&&$!==d)if(2===$)for(j=0;m>j;j++)i=Uc[j],H&&r.stroke(i[6]),r.point(i[0],i[1]);else if(4===$)for(j=0;m>j+1;j+=2)i=Uc[j],H&&r.stroke(Uc[j+1][6]),r.line(i[0],i[1],Uc[j+1][0],Uc[j+1][1]);else if(9===$)for(j=0;m>j+2;j+=3)i=Uc[j],s.beginPath(),s.moveTo(i[0],i[1]),s.lineTo(Uc[j+1][0],Uc[j+1][1]),s.lineTo(Uc[j+2][0],Uc[j+2][1]),s.lineTo(i[0],i[1]),y&&(r.fill(Uc[j+2][5]),he()),H&&(r.stroke(Uc[j+2][6]),ie()),s.closePath();else if(10===$)for(j=0;m>j+1;j++)i=Uc[j],s.beginPath(),s.moveTo(Uc[j+1][0],Uc[j+1][1]),s.lineTo(i[0],i[1]),H&&r.stroke(Uc[j+1][6]),y&&r.fill(Uc[j+1][5]),m>j+2&&(s.lineTo(Uc[j+2][0],Uc[j+2][1]),H&&r.stroke(Uc[j+2][6]),y&&r.fill(Uc[j+2][5])),me();else if(11===$){if(m>2)for(s.beginPath(),s.moveTo(Uc[0][0],Uc[0][1]),s.lineTo(Uc[1][0],Uc[1][1]),s.lineTo(Uc[2][0],Uc[2][1]),y&&(r.fill(Uc[2][5]),he()),H&&(r.stroke(Uc[2][6]),ie()),s.closePath(),j=3;m>j;j++)i=Uc[j],s.beginPath(),s.moveTo(Uc[0][0],Uc[0][1]),s.lineTo(Uc[j-1][0],Uc[j-1][1]),s.lineTo(i[0],i[1]),y&&(r.fill(i[5]),he()),H&&(r.stroke(i[6]),ie()),s.closePath()}else if(16===$)for(j=0;m>j+3;j+=4){for(i=Uc[j],s.beginPath(),s.moveTo(i[0],i[1]),k=1;4>k;k++)s.lineTo(Uc[j+k][0],Uc[j+k][1]);s.lineTo(i[0],i[1]),y&&(r.fill(Uc[j+3][5]),he()),H&&(r.stroke(Uc[j+3][6]),ie()),s.closePath()}else if(17===$){if(m>3)for(j=0;m>j+1;j+=2)i=Uc[j],s.beginPath(),m>j+3?(s.moveTo(Uc[j+2][0],Uc[j+2][1]),s.lineTo(i[0],i[1]),s.lineTo(Uc[j+1][0],Uc[j+1][1]),s.lineTo(Uc[j+3][0],Uc[j+3][1]),y&&r.fill(Uc[j+3][5]),H&&r.stroke(Uc[j+3][6])):(s.moveTo(i[0],i[1]),s.lineTo(Uc[j+1][0],Uc[j+1][1])),me()}else{for(s.beginPath(),s.moveTo(Uc[0][0],Uc[0][1]),j=1;m>j;j++)i=Uc[j],i.isVert&&(i.moveTo?s.moveTo(i[0],i[1]):s.lineTo(i[0],i[1]));me()}else{for(s.beginPath(),j=0;m>j;j++)i=Uc[j],Uc[j].isVert?Uc[j].moveTo?s.moveTo(i[0],i[1]):s.lineTo(i[0],i[1]):s.bezierCurveTo(Uc[j][0],Uc[j][1],Uc[j][2],Uc[j][3],Uc[j][4],Uc[j][5]);me()}else if(m>3){var n=[],o=1-bb;for(s.beginPath(),s.moveTo(Uc[1][0],Uc[1][1]),j=1;m>j+2;j++)i=Uc[j],n[0]=[i[0],i[1]],n[1]=[i[0]+(o*Uc[j+1][0]-o*Uc[j-1][0])/6,i[1]+(o*Uc[j+1][1]-o*Uc[j-1][1])/6],n[2]=[Uc[j+1][0]+(o*Uc[j][0]-o*Uc[j+2][0])/6,Uc[j+1][1]+(o*Uc[j][1]-o*Uc[j+2][1])/6],n[3]=[Uc[j+1][0],Uc[j+1][1]],s.bezierCurveTo(n[1][0],n[1][1],n[2][0],n[2][1],n[3][0],n[3][1]);me()}Xc=!1,Yc=!1,Vc=[],Wc=0,b&&Uc.pop()}},yd.prototype.endShape=function(a){if(0!==Uc.length){var i,b=2===a,c=[],e=[],f=[],g=[],h=[];Zc=!0;var j,k,l,m=Uc.length;for(j=0;m>j;j++)for(i=Uc[j],k=0;3>k;k++)e.push(i[k]);for(j=0;m>j;j++)for(i=Uc[j],k=5;9>k;k++)f.push(i[k]);for(j=0;m>j;j++)for(i=Uc[j],k=9;13>k;k++)g.push(i[k]);for(j=0;m>j;j++)i=Uc[j],h.push(i[3]),h.push(i[4]);if(b){for(e.push(Uc[0][0]),e.push(Uc[0][1]),e.push(Uc[0][2]),j=5;9>j;j++)f.push(Uc[0][j]);for(j=9;13>j;j++)g.push(Uc[0][j]);h.push(Uc[0][3]),h.push(Uc[0][4])}if(!Xc||20!==$&&$!==d)if(!Yc||20!==$&&$!==d){if(2===$){for(j=0;m>j;j++)for(i=Uc[j],k=0;3>k;k++)c.push(i[k]);je(c,g)}else if(4===$){for(j=0;m>j;j++)for(i=Uc[j],k=0;3>k;k++)c.push(i[k]);for(j=0;m>j;j++)for(i=Uc[j],k=5;9>k;k++)f.push(i[k]);ke(c,"LINES",g)}else if(9===$){if(m>2)for(j=0;m>j+2;j+=3){for(e=[],h=[],c=[],f=[],g=[],k=0;3>k;k++)for(l=0;3>l;l++)c.push(Uc[j+k][l]),e.push(Uc[j+k][l]);for(k=0;3>k;k++)for(l=3;5>l;l++)h.push(Uc[j+k][l]);for(k=0;3>k;k++)for(l=5;9>l;l++)f.push(Uc[j+k][l]),g.push(Uc[j+k][l+4]);H&&ke(c,"LINE_LOOP",g),(y||Wb)&&le(e,"TRIANGLES",f,h)}}else if(10===$){if(m>2)for(j=0;m>j+2;j++){for(c=[],e=[],g=[],f=[],h=[],k=0;3>k;k++)for(l=0;3>l;l++)c.push(Uc[j+k][l]),e.push(Uc[j+k][l]);
  for(k=0;3>k;k++)for(l=3;5>l;l++)h.push(Uc[j+k][l]);for(k=0;3>k;k++)for(l=5;9>l;l++)g.push(Uc[j+k][l+4]),f.push(Uc[j+k][l]);(y||Wb)&&le(e,"TRIANGLE_STRIP",f,h),H&&ke(c,"LINE_LOOP",g)}}else if(11===$){if(m>2){for(j=0;3>j;j++)for(i=Uc[j],k=0;3>k;k++)c.push(i[k]);for(j=0;3>j;j++)for(i=Uc[j],k=9;13>k;k++)g.push(i[k]);for(H&&ke(c,"LINE_LOOP",g),j=2;m>j+1;j++){for(c=[],g=[],c.push(Uc[0][0]),c.push(Uc[0][1]),c.push(Uc[0][2]),g.push(Uc[0][9]),g.push(Uc[0][10]),g.push(Uc[0][11]),g.push(Uc[0][12]),k=0;2>k;k++)for(l=0;3>l;l++)c.push(Uc[j+k][l]);for(k=0;2>k;k++)for(l=9;13>l;l++)g.push(Uc[j+k][l]);H&&ke(c,"LINE_STRIP",g)}(y||Wb)&&le(e,"TRIANGLE_FAN",f,h)}}else if(16===$)for(j=0;m>j+3;j+=4){for(c=[],k=0;4>k;k++)for(i=Uc[j+k],l=0;3>l;l++)c.push(i[l]);if(H&&ke(c,"LINE_LOOP",g),y){for(e=[],f=[],h=[],k=0;3>k;k++)e.push(Uc[j][k]);for(k=5;9>k;k++)f.push(Uc[j][k]);for(k=0;3>k;k++)e.push(Uc[j+1][k]);for(k=5;9>k;k++)f.push(Uc[j+1][k]);for(k=0;3>k;k++)e.push(Uc[j+3][k]);for(k=5;9>k;k++)f.push(Uc[j+3][k]);for(k=0;3>k;k++)e.push(Uc[j+2][k]);for(k=5;9>k;k++)f.push(Uc[j+2][k]);Wb&&(h.push(Uc[j+0][3]),h.push(Uc[j+0][4]),h.push(Uc[j+1][3]),h.push(Uc[j+1][4]),h.push(Uc[j+3][3]),h.push(Uc[j+3][4]),h.push(Uc[j+2][3]),h.push(Uc[j+2][4])),le(e,"TRIANGLE_STRIP",f,h)}}else if(17===$){var n=[];if(m>3){for(j=0;2>j;j++)for(i=Uc[j],k=0;3>k;k++)c.push(i[k]);for(j=0;2>j;j++)for(i=Uc[j],k=9;13>k;k++)g.push(i[k]);for(ke(c,"LINE_STRIP",g),m>4&&m%2>0&&(n=e.splice(e.length-3),Uc.pop()),j=0;m>j+3;j+=2){for(c=[],g=[],k=0;3>k;k++)c.push(Uc[j+1][k]);for(k=0;3>k;k++)c.push(Uc[j+3][k]);for(k=0;3>k;k++)c.push(Uc[j+2][k]);for(k=0;3>k;k++)c.push(Uc[j+0][k]);for(k=9;13>k;k++)g.push(Uc[j+1][k]);for(k=9;13>k;k++)g.push(Uc[j+3][k]);for(k=9;13>k;k++)g.push(Uc[j+2][k]);for(k=9;13>k;k++)g.push(Uc[j+0][k]);H&&ke(c,"LINE_STRIP",g)}(y||Wb)&&le(e,"TRIANGLE_LIST",f,h)}}else if(1===m){for(k=0;3>k;k++)c.push(Uc[0][k]);for(k=9;13>k;k++)g.push(Uc[0][k]);je(c,g)}else{for(j=0;m>j;j++){for(i=Uc[j],k=0;3>k;k++)c.push(i[k]);for(k=5;9>k;k++)g.push(i[k])}H&&b?ke(c,"LINE_LOOP",g):H&&!b&&ke(c,"LINE_STRIP",g),(y||Wb)&&le(e,"TRIANGLE_FAN",f,h)}Wb=!1,s.useProgram(Db),nd("usingTexture3d",Db,"uUsingTexture",Wb)}else c=e,c.splice(c.length-3),g.splice(g.length-4),H&&ke(c,null,g),y&&le(e,"TRIANGLES",f);else c=e,H&&ke(c,null,g),y&&le(e,null,f);Xc=!1,Yc=!1,Vc=[],Wc=0}};var ne=function(a,b){var c=1/a,d=c*c,e=d*c;b.set(0,0,0,1,e,d,c,0,6*e,2*d,0,0,6*e,0,0,0)},oe=function(){yb||(wb=new Jd,yb=new Jd,db=!0);var a=bb;wb.set((a-1)/2,(a+3)/2,(-3-a)/2,(1-a)/2,1-a,(-5-a)/2,a+2,(a-1)/2,(a-1)/2,0,(1-a)/2,0,0,1,0,0),ne(cb,yb),Ab||(xb=new Jd),xb.set(wb),xb.preApply(Ab),yb.apply(wb)};xd.prototype.bezierVertex=function(){Yc=!0;var a=[];if(Zc)throw"vertex() must be used at least once before calling bezierVertex()";for(var b=0;b<arguments.length;b++)a[b]=arguments[b];Uc.push(a),Uc[Uc.length-1].isVert=!1},yd.prototype.bezierVertex=function(){if(Yc=!0,Zc)throw"vertex() must be used at least once before calling bezierVertex()";if(9===arguments.length){zb===d&&(zb=new Jd);var b=Uc.length-1;ne(fb,zb),zb.apply(Bb);for(var c=zb.array(),e=Uc[b][0],f=Uc[b][1],g=Uc[b][2],h=c[4]*e+c[5]*arguments[0]+c[6]*arguments[3]+c[7]*arguments[6],i=c[8]*e+c[9]*arguments[0]+c[10]*arguments[3]+c[11]*arguments[6],j=c[12]*e+c[13]*arguments[0]+c[14]*arguments[3]+c[15]*arguments[6],k=c[4]*f+c[5]*arguments[1]+c[6]*arguments[4]+c[7]*arguments[7],l=c[8]*f+c[9]*arguments[1]+c[10]*arguments[4]+c[11]*arguments[7],m=c[12]*f+c[13]*arguments[1]+c[14]*arguments[4]+c[15]*arguments[7],n=c[4]*g+c[5]*arguments[2]+c[6]*arguments[5]+c[7]*arguments[8],o=c[8]*g+c[9]*arguments[2]+c[10]*arguments[5]+c[11]*arguments[8],p=c[12]*g+c[13]*arguments[2]+c[14]*arguments[5]+c[15]*arguments[8],q=0;fb>q;q++)e+=h,h+=i,i+=j,f+=k,k+=l,l+=m,g+=n,n+=o,o+=p,r.vertex(e,f,g);r.vertex(arguments[6],arguments[7],arguments[8])}},r.texture=function(a){var c=w.$ensureContext();if(a.__texture)c.bindTexture(c.TEXTURE_2D,a.__texture);else if("canvas"===a.localName)c.bindTexture(c.TEXTURE_2D,Sb),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.generateMipmap(c.TEXTURE_2D),Ub.width=a.width,Ub.height=a.height;else{var g,d=c.createTexture(),e=b.createElement("canvas"),f=e.getContext("2d");if(a.width&0===a.width-1)e.width=a.width;else{for(g=1;g<a.width;)g*=2;e.width=g}if(a.height&0===a.height-1)e.height=a.height;else{for(g=1;g<a.height;)g*=2;e.height=g}f.drawImage(a.sourceImg,0,0,a.width,a.height,0,0,e.width,e.height),c.bindTexture(c.TEXTURE_2D,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,e),c.generateMipmap(c.TEXTURE_2D),a.__texture=d,Ub.width=a.width,Ub.height=a.height}Wb=!0,c.useProgram(Db),nd("usingTexture3d",Db,"uUsingTexture",Wb)},r.textureMode=function(a){Vb=a};var pe=function(a,b,c,d,e,f,g,h,i,j,k,l){var m=d,n=e,o=f,p=yb.array(),q=p[4]*a+p[5]*d+p[6]*g+p[7]*j,s=p[8]*a+p[9]*d+p[10]*g+p[11]*j,t=p[12]*a+p[13]*d+p[14]*g+p[15]*j,u=p[4]*b+p[5]*e+p[6]*h+p[7]*k,v=p[8]*b+p[9]*e+p[10]*h+p[11]*k,w=p[12]*b+p[13]*e+p[14]*h+p[15]*k,x=p[4]*c+p[5]*f+p[6]*i+p[7]*l,y=p[8]*c+p[9]*f+p[10]*i+p[11]*l,z=p[12]*c+p[13]*f+p[14]*i+p[15]*l;r.vertex(m,n,o);for(var A=0;cb>A;A++)m+=q,q+=s,s+=t,n+=u,u+=v,v+=w,o+=x,x+=y,y+=z,r.vertex(m,n,o)};xd.prototype.curveVertex=function(a,b){Xc=!0,r.vertex(a,b)},yd.prototype.curveVertex=function(a,b,c){Xc=!0,db||oe();var d=[];d[0]=a,d[1]=b,d[2]=c,Vc.push(d),Wc++,Wc>3&&pe(Vc[Wc-4][0],Vc[Wc-4][1],Vc[Wc-4][2],Vc[Wc-3][0],Vc[Wc-3][1],Vc[Wc-3][2],Vc[Wc-2][0],Vc[Wc-2][1],Vc[Wc-2][2],Vc[Wc-1][0],Vc[Wc-1][1],Vc[Wc-1][2])},xd.prototype.curve=function(a,b,c,d,e,f,g,h){r.beginShape(),r.curveVertex(a,b),r.curveVertex(c,d),r.curveVertex(e,f),r.curveVertex(g,h),r.endShape()},yd.prototype.curve=function(a,b,c,e,f,g,h,i,j,k,l,m){return m!==d?(r.beginShape(),r.curveVertex(a,b,c),r.curveVertex(e,f,g),r.curveVertex(h,i,j),r.curveVertex(k,l,m),r.endShape(),void 0):(r.beginShape(),r.curveVertex(a,b),r.curveVertex(c,e),r.curveVertex(f,g),r.curveVertex(h,i),r.endShape(),void 0)},r.curveTightness=function(a){bb=a},r.curveDetail=function(a){cb=a,oe()},r.rectMode=function(a){Q=a},r.imageMode=function(a){switch(a){case 0:td=sd;break;case 1:td=ud;break;case 3:td=vd;break;default:throw"Invalid imageMode"}},r.ellipseMode=function(a){R=a},r.arc=function(a,b,c,d,e,f){if(!(0>=c||e>f)){for(1===R?(c-=a,d-=b):2===R?(a-=c,b-=d,c=2*c,d=2*d):3===R&&(a-=c/2,b-=d/2);0>e;)e+=6.283185307179586,f+=6.283185307179586;f-e>6.283185307179586&&(e=0,f=6.283185307179586);var m,n,g=c/2,h=d/2,i=a+g,j=b+h,k=0|.5+2*e*r.RAD_TO_DEG,l=0|.5+2*f*r.RAD_TO_DEG;if(y){var o=H;for(H=!1,r.beginShape(),r.vertex(i,j),m=k;l>=m;m++)n=m%720,r.vertex(i+Ac[n]*g,j+zc[n]*h);r.endShape(2),H=o}if(H){var p=y;for(y=!1,r.beginShape(),m=k;l>=m;m++)n=m%720,r.vertex(i+Ac[n]*g,j+zc[n]*h);r.endShape(),y=p}}},xd.prototype.line=function(a,b,e,f){if(H){if(a=c.round(a),e=c.round(e),b=c.round(b),f=c.round(f),a===e&&b===f)return r.point(a,b),void 0;for(var g=d,h=d,i=!0,j=Fc.array(),k=[1,0,0,0,1,0],l=0;6>l&&i;l++)i=j[l]===k[l];i&&(a===e?(b>f&&(g=b,b=f,f=g),f++,1===L%2&&s.translate(.5,0)):b===f&&(a>e&&(g=a,a=e,e=g),e++,1===L%2&&s.translate(0,.5)),1===L&&(h=s.lineCap,s.lineCap="butt")),s.beginPath(),s.moveTo(a||0,b||0),s.lineTo(e||0,f||0),ie(),i&&(a===e&&1===L%2?s.translate(-.5,0):b===f&&1===L%2&&s.translate(0,-.5),1===L&&(s.lineCap=h))}},yd.prototype.line=function(a,b,c,e,f,g){if((f===d||g===d)&&(g=0,f=e,e=c,c=0),a===e&&b===f&&c===g)return r.point(a,b,c),void 0;var h=[a,b,c,e,f,g],i=new Jd;i.scale(1,-1,1),i.apply(Fc.array()),i.transpose(),L>0&&H&&(s.useProgram(Eb),od("uModel2d",Eb,"uModel",!1,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),od("uView2d",Eb,"uView",!1,i.array()),md("uColor2d",Eb,"uColor",I),nd("uIsDrawingText",Eb,"uIsDrawingText",!1),pd("aVertex2d",Eb,"aVertex",3,Mb),qd("aTextureCoord2d",Eb,"aTextureCoord"),s.bufferData(s.ARRAY_BUFFER,new j(h),s.STREAM_DRAW),s.drawArrays(s.LINES,0,2))},xd.prototype.bezier=function(){if(8!==arguments.length)throw"You must use 8 parameters for bezier() in 2D mode";r.beginShape(),r.vertex(arguments[0],arguments[1]),r.bezierVertex(arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]),r.endShape()},yd.prototype.bezier=function(){if(12!==arguments.length)throw"You must use 12 parameters for bezier() in 3D mode";r.beginShape(),r.vertex(arguments[0],arguments[1],arguments[2]),r.bezierVertex(arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11]),r.endShape()},r.bezierDetail=function(a){fb=a},r.bezierPoint=function(a,b,c,d,e){return(1-e)*(1-e)*(1-e)*a+3*(1-e)*(1-e)*e*b+3*(1-e)*e*e*c+e*e*e*d},r.bezierTangent=function(a,b,c,d,e){return 3*e*e*(-a+3*b-3*c+d)+6*e*(a-2*b+c)+3*(-a+b)},r.curvePoint=function(a,b,c,d,e){return.5*(2*b+(-a+c)*e+(2*a-5*b+4*c-d)*e*e+(-a+3*b-3*c+d)*e*e*e)},r.curveTangent=function(a,b,c,d,e){return.5*(-a+c+2*(2*a-5*b+4*c-d)*e+3*(-a+3*b-3*c+d)*e*e)},r.triangle=function(a,b,c,d,e,f){r.beginShape(9),r.vertex(a,b,0),r.vertex(c,d,0),r.vertex(e,f,0),r.endShape()},r.quad=function(a,b,c,d,e,f,g,h){r.beginShape(16),r.vertex(a,b,0),r.vertex(c,d,0),r.vertex(e,f,0),r.vertex(g,h,0),r.endShape()};var qe=function(a,b,e,f,g,h,i,j){j===d&&(h=g,i=g,j=g);var k=e/2,l=f/2;(g>k||g>l)&&(g=c.min(k,l)),(h>k||h>l)&&(h=c.min(k,l)),(i>k||i>l)&&(i=c.min(k,l)),(j>k||j>l)&&(j=c.min(k,l)),(!y||H)&&s.translate(.5,.5),s.beginPath(),s.moveTo(a+g,b),s.lineTo(a+e-h,b),s.quadraticCurveTo(a+e,b,a+e,b+h),s.lineTo(a+e,b+f-i),s.quadraticCurveTo(a+e,b+f,a+e-i,b+f),s.lineTo(a+j,b+f),s.quadraticCurveTo(a,b+f,a,b+f-j),s.lineTo(a,b+g),s.quadraticCurveTo(a,b,a+g,b),(!y||H)&&s.translate(-.5,-.5),he(),ie()};xd.prototype.rect=function(a,b,e,f,g,h,i,j){if(e||f){if(1===Q?(e-=a,f-=b):2===Q?(e*=2,f*=2,a-=e/2,b-=f/2):3===Q&&(a-=e/2,b-=f/2),a=c.round(a),b=c.round(b),e=c.round(e),f=c.round(f),g!==d)return qe(a,b,e,f,g,h,i,j),void 0;H&&1===L%2&&s.translate(.5,.5),s.beginPath(),s.rect(a,b,e,f),he(),ie(),H&&1===L%2&&s.translate(-.5,-.5)}},yd.prototype.rect=function(a,b,c,e,f){if(f!==d)throw"rect() with rounded corners is not supported in 3D mode";1===Q?(c-=a,e-=b):2===Q?(c*=2,e*=2,a-=c/2,b-=e/2):3===Q&&(a-=c/2,b-=e/2);var j=new Jd;j.translate(a,b,0),j.scale(c,e,1),j.transpose();var k=new Jd;if(k.scale(1,-1,1),k.apply(Fc.array()),k.transpose(),L>0&&H&&(s.useProgram(Eb),od("uModel2d",Eb,"uModel",!1,j.array()),od("uView2d",Eb,"uView",!1,k.array()),md("uColor2d",Eb,"uColor",I),nd("uIsDrawingText2d",Eb,"uIsDrawingText",!1),pd("aVertex2d",Eb,"aVertex",3,Jb),qd("aTextureCoord2d",Eb,"aTextureCoord"),s.drawArrays(s.LINE_LOOP,0,dd.length/3)),y){if(s.useProgram(Db),od("uModel3d",Db,"uModel",!1,j.array()),od("uView3d",Db,"uView",!1,k.array()),s.enable(s.POLYGON_OFFSET_FILL),s.polygonOffset(1,1),md("color3d",Db,"uColor",A),tc>0){var l=new Jd;l.set(k);var m=new Jd;m.set(j),l.mult(m);var n=new Jd;n.set(l),n.invert(),n.transpose(),od("uNormalTransform3d",Db,"uNormalTransform",!1,n.array()),pd("aNormal3d",Db,"aNormal",3,Kb)}else qd("normal3d",Db,"aNormal");pd("vertex3d",Db,"aVertex",3,Jb),s.drawArrays(s.TRIANGLE_FAN,0,dd.length/3),s.disable(s.POLYGON_OFFSET_FILL)}},xd.prototype.ellipse=function(a,b,c,d){if(a=a||0,b=b||0,!(0>=c&&0>=d))if(2===R?(c*=2,d*=2):1===R?(c-=a,d-=b,a+=c/2,b+=d/2):0===R&&(a+=c/2,b+=d/2),c===d)s.beginPath(),s.arc(a,b,c/2,0,6.283185307179586,!1),he(),ie();else{var e=c/2,f=d/2,g=.5522847498307933,h=g*e,i=g*f;r.beginShape(),r.vertex(a+e,b),r.bezierVertex(a+e,b-i,a+h,b-f,a,b-f),r.bezierVertex(a-h,b-f,a-e,b-i,a-e,b),r.bezierVertex(a-e,b+i,a-h,b+f,a,b+f),r.bezierVertex(a+h,b+f,a+e,b+i,a+e,b),r.endShape()}},yd.prototype.ellipse=function(a,b,c,d){if(a=a||0,b=b||0,!(0>=c&&0>=d)){2===R?(c*=2,d*=2):1===R?(c-=a,d-=b,a+=c/2,b+=d/2):0===R&&(a+=c/2,b+=d/2);var e=c/2,f=d/2,g=.5522847498307933,h=g*e,i=g*f;if(r.beginShape(),r.vertex(a+e,b),r.bezierVertex(a+e,b-i,0,a+h,b-f,0,a,b-f,0),r.bezierVertex(a-h,b-f,0,a-e,b-i,0,a-e,b,0),r.bezierVertex(a-e,b+i,0,a-h,b+f,0,a,b+f,0),r.bezierVertex(a+h,b+f,0,a+e,b+i,0,a+e,b,0),r.endShape(),y){var l,m,j=0,k=0;for(l=0;l<Uc.length;l++)j+=Uc[l][0],k+=Uc[l][1];j/=Uc.length,k/=Uc.length;var n=[],o=[],p=[];for(n[0]=j,n[1]=k,n[2]=0,n[3]=0,n[4]=0,n[5]=A[0],n[6]=A[1],n[7]=A[2],n[8]=A[3],n[9]=I[0],n[10]=I[1],n[11]=I[2],n[12]=I[3],n[13]=S,n[14]=T,n[15]=U,Uc.unshift(n),l=0;l<Uc.length;l++){for(m=0;3>m;m++)o.push(Uc[l][m]);for(m=5;9>m;m++)p.push(Uc[l][m])}le(o,"TRIANGLE_FAN",p)}}},r.normal=function(a,b,c){if(3!==arguments.length||"number"!=typeof a||"number"!=typeof b||"number"!=typeof c)throw"normal() requires three numeric arguments.";S=a,T=b,U=c,0!==$&&(0===V?V=1:1===V&&(V=2))},r.save=function(b,c){return c!==d?a.open(c.toDataURL(),"_blank"):a.open(r.externals.canvas.toDataURL(),"_blank")};var re=0;r.saveFrame=function(a){a===d&&(a="screen-####.png");var b=a.replace(/#+/,function(a){for(var b=""+re++;b.length<a.length;)b="0"+b;return b});r.save(b)};var se=b.createElement("canvas").getContext("2d"),te=[d,d,d],we=function(a,c,d){if(this.__isDirty=!1,a instanceof HTMLImageElement)this.fromHTMLImageData(a);else if(c||d){this.width=a||1,this.height=c||1;var e=this.sourceImg=b.createElement("canvas");if(e.width=this.width,e.height=this.height,this.imageData=e.getContext("2d").createImageData(this.width,this.height),this.format=2===d||4===d?d:1,1===this.format)for(var g=3,h=this.imageData.data,i=h.length;i>g;g+=4)h[g]=255;this.__isDirty=!0,this.updatePixels()}else this.width=0,this.height=0,this.imageData=se.createImageData(1,1),this.format=2;this.pixels=ve(this)};we.prototype={__isPImage:!0,updatePixels:function(){var a=this.sourceImg;a&&a instanceof HTMLCanvasElement&&this.__isDirty&&a.getContext("2d").putImageData(this.imageData,0,0),this.__isDirty=!1},fromHTMLImageData:function(a){var b=ue(a);try{var c=b.context.getImageData(0,0,a.width,a.height);this.fromImageData(c)}catch(d){a.width&&a.height&&(this.isRemote=!0,this.width=a.width,this.height=a.height)}this.sourceImg=a},get:function(a,b,c,d){return arguments.length?2===arguments.length?r.get(a,b,this):4===arguments.length?r.get(a,b,c,d,this):void 0:r.get(this)},set:function(a,b,c){r.set(a,b,c,this),this.__isDirty=!0},blend:function(a,b,c,d,e,f,g,h,i,j){9===arguments.length?r.blend(this,a,b,c,d,e,f,g,h,i,this):10===arguments.length&&r.blend(a,b,c,d,e,f,g,h,i,j,this),delete this.sourceImg},copy:function(a,b,c,d,e,f,g,h,i){8===arguments.length?r.blend(this,a,b,c,d,e,f,g,h,0,this):9===arguments.length&&r.blend(a,b,c,d,e,f,g,h,i,0,this),delete this.sourceImg},filter:function(a,b){2===arguments.length?r.filter(a,b,this):1===arguments.length&&r.filter(a,null,this),delete this.sourceImg},save:function(a){r.save(a,this)},resize:function(a,b){if(this.isRemote)throw"Image is loaded remotely. Cannot resize.";if(0!==this.width||0!==this.height){0===a&&0!==b?a=c.floor(this.width/this.height*b):0===b&&0!==a&&(b=c.floor(this.height/this.width*a));var d=ue(this.imageData).canvas,e=ue(d,a,b).context.getImageData(0,0,a,b);this.fromImageData(e)}},mask:function(a){var c,d,b=this.toImageData();if(a instanceof we||a.__isPImage){if(a.width!==this.width||a.height!==this.height)throw"mask must have the same dimensions as PImage.";for(a=a.toImageData(),c=2,d=4*this.width*this.height;d>c;c+=4)b.data[c+1]=a.data[c]}else if(a instanceof Array){if(this.width*this.height!==a.length)throw"mask array must be the same length as PImage pixels array.";for(c=0,d=a.length;d>c;++c)b.data[4*c+3]=a[c]}this.fromImageData(b)},loadPixels:e,toImageData:function(){if(this.isRemote)return this.sourceImg;if(!this.__isDirty)return this.imageData;var a=ue(this.sourceImg);return a.context.getImageData(0,0,this.width,this.height)},toDataURL:function(){if(this.isRemote)throw"Image is loaded remotely. Cannot create dataURI.";var a=ue(this.imageData);return a.canvas.toDataURL()},fromImageData:function(a){var c=a.width,d=a.height,e=b.createElement("canvas"),f=e.getContext("2d");this.width=e.width=c,this.height=e.height=d,f.putImageData(a,0,0),this.format=2,this.imageData=a,this.sourceImg=e}},r.PImage=we,r.createImage=function(a,b,c){return new we(a,b,c)},r.loadImage=function(a,c,d){c&&(a=a+"."+c);var e;if(u.imageCache.images[a])return e=new we(u.imageCache.images[a]),e.loaded=!0,e;e=new we;var f=b.createElement("img");return e.sourceImg=f,f.onload=function(a,b,c){var d=a,e=b,f=c;return function(){e.fromHTMLImageData(d),e.loaded=!0,f&&f()}}(f,e,d),f.src=a,e},r.requestImage=r.loadImage,r.get=function(a,b,c,d,e){return void 0!==e?Ae(a,b,c,d,e):void 0!==d?ze(a,b,c,d):void 0!==c?ye(a,b,c):void 0!==b?xe(a,b):void 0!==a?Ae(0,0,a.width,a.height,a):ze(0,0,r.width,r.height)},r.createGraphics=function(a,b,c){var d=new G;return d.size(a,b,c),d.background(0,0),d},r.set=function(a,b,c,d){3===arguments.length?"number"==typeof c?Ee(a,b,c):(c instanceof we||c.__isPImage)&&r.image(c,a,b):4===arguments.length&&Fe(a,b,c,d)},r.imageData={},r.pixels={getLength:function(){return r.imageData.data.length?r.imageData.data.length/4:0},getPixel:function(a){var b=4*a,c=r.imageData.data;return 4278190080&c[b+3]<<24|16711680&c[b+0]<<16|65280&c[b+1]<<8|255&c[b+2]},setPixel:function(a,b){var c=4*a,d=r.imageData.data;d[c+0]=(16711680&b)>>>16,d[c+1]=(65280&b)>>>8,d[c+2]=255&b,d[c+3]=(4278190080&b)>>>24},toArray:function(){for(var a=[],b=r.imageData.width*r.imageData.height,c=r.imageData.data,d=0,e=0;b>d;d++,e+=4)a.push(4278190080&c[e+3]<<24|16711680&c[e+0]<<16|65280&c[e+1]<<8|255&c[e+2]);return a},set:function(a){for(var b=0,c=a.length;c>b;b++)this.setPixel(b,a[b])}},r.loadPixels=function(){r.imageData=w.$ensureContext().getImageData(0,0,r.width,r.height)},r.updatePixels=function(){r.imageData&&w.$ensureContext().putImageData(r.imageData,0,0)},r.hint=function(a){var b=w.$ensureContext();4===a?(b.disable(b.DEPTH_TEST),b.depthMask(!1),b.clear(b.DEPTH_BUFFER_BIT)):-4===a?(b.enable(b.DEPTH_TEST),b.depthMask(!0)):-1===a||2===a?N=!0:1===a&&(N=!1)};var Ge=function(a,b,c,d){var e;if(a instanceof we||a.__isPImage){if(e=a,!e.loaded)throw"Error using image in background(): PImage not loaded.";if(e.width!==r.width||e.height!==r.height)throw"Background image must be the same dimensions as the canvas."}else e=r.color(a,b,c,d);eb=e};xd.prototype.background=function(a,b,c,e){a!==d&&Ge(a,b,c,e),eb instanceof we||eb.__isPImage?(Pd(),s.setTransform(1,0,0,1,0,0),r.image(eb,0,0),Qd()):(Pd(),s.setTransform(1,0,0,1,0,0),r.alpha(eb)!==gb&&s.clearRect(0,0,r.width,r.height),s.fillStyle=r.color.toString(eb),s.fillRect(0,0,r.width,r.height),E=!0,Qd())},yd.prototype.background=function(a,b,c,d){arguments.length>0&&Ge(a,b,c,d);var e=r.color.toGLArray(eb);s.clearColor(e[0],e[1],e[2],e[3]),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)},xd.prototype.image=function(a,b,d,e,f){if(b=c.round(b),d=c.round(d),a.width>0){e||a.width,f||a.height;var i=td(b||0,d||0,e||a.width,f||a.height,arguments.length<4),j=!!a.sourceImg&&null===pb;if(j){var k=a.sourceImg;a.__isDirty&&a.updatePixels(),s.drawImage(k,0,0,k.width,k.height,i.x,i.y,i.w,i.h)}else{var l=a.toImageData();null!==pb&&(pb(l),a.__isDirty=!0),s.drawImage(ue(l).canvas,0,0,a.width,a.height,i.x,i.y,i.w,i.h)}}},yd.prototype.image=function(a,b,d,e,f){a.width>0&&(b=c.round(b),d=c.round(d),e=e||a.width,f=f||a.height,r.beginShape(r.QUADS),r.texture(a),r.vertex(b,d,0,0,0),r.vertex(b,d+f,0,0,f),r.vertex(b+e,d+f,0,e,f),r.vertex(b+e,d,0,e,0),r.endShape())},r.tint=function(a,b,c,d){var e=r.color(a,b,c,d),f=r.red(e)/hb,g=r.green(e)/ib,h=r.blue(e)/jb,i=r.alpha(e)/gb;pb=function(a){for(var b=a.data,c=4*a.width*a.height,d=0;c>d;)b[d++]*=f,b[d++]*=g,b[d++]*=h,b[d++]*=i},qb=function(a){for(var b=0;b<a.length;)a[b++]=f,a[b++]=g,a[b++]=h,a[b++]=i}},r.noTint=function(){pb=null,qb=null},r.copy=function(a,b,c,e,f,g,h,i,j){j===d&&(j=i,i=h,h=g,g=f,f=e,e=c,c=b,b=a,a=r),r.blend(a,b,c,e,f,g,h,i,j,0)},r.blend=function(a,b,c,e,f,g,h,i,j,k,l){if(a.isRemote)throw"Image is loaded remotely. Cannot blend image.";k===d&&(k=j,j=i,i=h,h=g,g=f,f=e,e=c,c=b,b=a,a=r);var m=b+e,n=c+f,o=g+i,p=h+j,q=l||r;(l===d||k===d)&&r.loadPixels(),a.loadPixels(),a===r&&r.intersect(b,c,m,n,g,h,o,p)?r.blit_resize(r.get(b,c,m-b,n-c),0,0,m-b-1,n-c-1,q.imageData.data,q.width,q.height,g,h,o,p,k):r.blit_resize(a,b,c,m,n,q.imageData.data,q.width,q.height,g,h,o,p,k),l===d&&r.updatePixels()};var He=function(a){var c,d,b=r.floor(3.5*a);if(b=1>b?1:248>b?b:248,r.shared.blurRadius!==b){r.shared.blurRadius=b,r.shared.blurKernelSize=1+(r.shared.blurRadius<<1),r.shared.blurKernel=new j(r.shared.blurKernelSize);var e=r.shared.blurKernel,f=r.shared.blurKernelSize;for(r.shared.blurRadius,c=0;f>c;c++)e[c]=0;var h=(b-1)*(b-1);for(c=1;b>c;c++)e[b+c]=e[d]=h;e[b]=b*b}},Ie=function(a,b){var c,d,e,f,g,i,k,l,m,n,o,w,x,y,z,p=b.pixels.getLength(),q=new j(p),s=new j(p),t=new j(p),u=new j(p),v=0;He(a);var A=b.height,B=b.width,C=r.shared.blurKernelSize,D=r.shared.blurRadius,E=r.shared.blurKernel,F=b.imageData.data;for(x=0;A>x;x++){for(w=0;B>w;w++){if(f=e=d=g=c=0,k=w-D,0>k)o=-k,k=0;else{if(k>=B)break;o=0}for(y=o;C>y&&!(k>=B);y++)z=4*(k+v),i=E[y],g+=i*F[z+3],d+=i*F[z],e+=i*F[z+1],f+=i*F[z+2],c+=i,k++;l=v+w,u[l]=g/c,q[l]=d/c,s[l]=e/c,t[l]=f/c}v+=B}for(v=0,m=-D,n=m*B,x=0;A>x;x++){for(w=0;B>w;w++){if(f=e=d=g=c=0,0>m)o=l=-m,k=w;else{if(m>=A)break;o=0,l=m,k=w+n}for(y=o;C>y&&!(l>=A);y++)i=E[y],g+=i*u[k],d+=i*q[k],e+=i*s[k],f+=i*t[k],c+=i,l++,k+=B;z=4*(w+v),F[z]=d/c,F[z+1]=e/c,F[z+2]=f/c,F[z+3]=g/c}v+=B,n+=B,m++}},Je=function(a,b){var f,g,h,i,j,l,m,n,o,p,q,r,s,t,u,v,w,c=0,d=b.pixels.getLength(),e=new k(d);if(a)for(;d>c;)for(f=c,g=c+b.width;g>c;)h=i=b.pixels.getPixel(c),m=c-1,l=c+1,n=c-b.width,o=c+b.width,f>m&&(m=c),l>=g&&(l=c),0>n&&(n=0),o>=d&&(o=c),r=b.pixels.getPixel(n),q=b.pixels.getPixel(m),s=b.pixels.getPixel(o),p=b.pixels.getPixel(l),j=77*(255&h>>16)+151*(255&h>>8)+28*(255&h),u=77*(255&q>>16)+151*(255&q>>8)+28*(255&q),t=77*(255&p>>16)+151*(255&p>>8)+28*(255&p),v=77*(255&r>>16)+151*(255&r>>8)+28*(255&r),w=77*(255&s>>16)+151*(255&s>>8)+28*(255&s),j>u&&(i=q,j=u),j>t&&(i=p,j=t),j>v&&(i=r,j=v),j>w&&(i=s,j=w),e[c++]=i;else for(;d>c;)for(f=c,g=c+b.width;g>c;)h=i=b.pixels.getPixel(c),m=c-1,l=c+1,n=c-b.width,o=c+b.width,f>m&&(m=c),l>=g&&(l=c),0>n&&(n=0),o>=d&&(o=c),r=b.pixels.getPixel(n),q=b.pixels.getPixel(m),s=b.pixels.getPixel(o),p=b.pixels.getPixel(l),j=77*(255&h>>16)+151*(255&h>>8)+28*(255&h),u=77*(255&q>>16)+151*(255&q>>8)+28*(255&q),t=77*(255&p>>16)+151*(255&p>>8)+28*(255&p),v=77*(255&r>>16)+151*(255&r>>8)+28*(255&r),w=77*(255&s>>16)+151*(255&s>>8)+28*(255&s),u>j&&(i=q,j=u),t>j&&(i=p,j=t),v>j&&(i=r,j=v),w>j&&(i=s,j=w),e[c++]=i;b.pixels.set(e)};r.filter=function(a,b,c){var e,f,g,h;if(3===arguments.length?(c.loadPixels(),e=c):(r.loadPixels(),e=r),b===d&&(b=null),e.isRemote)throw"Image is loaded remotely. Cannot filter image.";var i=e.pixels.getLength();switch(a){case 11:var j=b||1;Ie(j,e);break;case 12:if(4===e.format){for(h=0;i>h;h++)f=255-e.pixels.getPixel(h),e.pixels.setPixel(h,4278190080|f<<16|f<<8|f);e.format=1}else for(h=0;i>h;h++)f=e.pixels.getPixel(h),g=77*(255&f>>16)+151*(255&f>>8)+28*(255&f)>>8,e.pixels.setPixel(h,4278190080&f|g<<16|g<<8|g);break;case 13:for(h=0;i>h;h++)e.pixels.setPixel(h,16777215^e.pixels.getPixel(h));break;case 15:if(null===b)throw"Use filter(POSTERIZE, int levels) instead of filter(POSTERIZE)";var k=r.floor(b);if(2>k||k>255)throw"Levels must be between 2 and 255 for filter(POSTERIZE, levels)";var l=k-1;for(h=0;i>h;h++){var m=255&e.pixels.getPixel(h)>>16,n=255&e.pixels.getPixel(h)>>8,o=255&e.pixels.getPixel(h);m=255*(m*k>>8)/l,n=255*(n*k>>8)/l,o=255*(o*k>>8)/l,e.pixels.setPixel(h,4278190080&e.pixels.getPixel(h)|m<<16|n<<8|o)}break;case 14:for(h=0;i>h;h++)e.pixels.setPixel(h,4278190080|e.pixels.getPixel(h));e.format=1;break;case 16:if(null===b&&(b=.5),0>b||b>1)throw"Level must be between 0 and 1 for filter(THRESHOLD, level)";var p=r.floor(255*b);for(h=0;i>h;h++){var q=r.max((16711680&e.pixels.getPixel(h))>>16,r.max((65280&e.pixels.getPixel(h))>>8,255&e.pixels.getPixel(h)));e.pixels.setPixel(h,4278190080&e.pixels.getPixel(h)|(p>q?0:16777215))}break;case 17:Je(!0,e);break;case 18:Je(!1,e)}e.updatePixels()},r.shared={fracU:0,ifU:0,fracV:0,ifV:0,u1:0,u2:0,v1:0,v2:0,sX:0,sY:0,iw:0,iw1:0,ih1:0,ul:0,ll:0,ur:0,lr:0,cUL:0,cLL:0,cUR:0,cLR:0,srcXOffset:0,srcYOffset:0,r:0,g:0,b:0,a:0,srcBuffer:null,blurRadius:0,blurKernelSize:0,blurKernel:null},r.intersect=function(a,b,c,d,e,f,g,h){var i=c-a+1,j=d-b+1,k=g-e+1,l=h-f+1;if(a>e)k+=e-a,k>i&&(k=i);else{var m=i+a-e;k>m&&(k=m)}if(b>f)l+=f-b,l>j&&(l=j);else{var n=j+b-f;l>n&&(l=n)}return!(0>=k||0>=l)};var Ke={};Ke[1]=r.modes.blend,Ke[2]=r.modes.add,Ke[4]=r.modes.subtract,Ke[8]=r.modes.lightest,Ke[16]=r.modes.darkest,Ke[0]=r.modes.replace,Ke[32]=r.modes.difference,Ke[64]=r.modes.exclusion,Ke[128]=r.modes.multiply,Ke[256]=r.modes.screen,Ke[512]=r.modes.overlay,Ke[1024]=r.modes.hard_light,Ke[2048]=r.modes.soft_light,Ke[4096]=r.modes.dodge,Ke[8192]=r.modes.burn,r.blit_resize=function(a,b,d,e,f,g,h,i,j,k,l,m,n){var o,p;0>b&&(b=0),0>d&&(d=0),e>=a.width&&(e=a.width-1),f>=a.height&&(f=a.height-1);var q=e-b,s=f-d,t=l-j,u=m-k;if(!(0>=t||0>=u||0>=q||0>=s||j>=h||k>=i||b>=a.width||d>=a.height)){var v=c.floor(32768*(q/t)),w=c.floor(32768*(s/u)),x=r.shared;x.srcXOffset=c.floor(0>j?-j*v:32768*b),x.srcYOffset=c.floor(0>k?-k*w:32768*d),0>j&&(t+=j,j=0),0>k&&(u+=k,k=0),t=c.min(t,h-j),u=c.min(u,i-k);var z,y=k*h+j;x.srcBuffer=a.imageData.data,x.iw=a.width,x.iw1=a.width-1,x.ih1=a.height-1;var D,E,F,G,H,I,C=(r.filter_bilinear,r.filter_new_scanline,Ke[n]),J=4278190080,K=16711680,L=65280,M=255,N=32767,O=15,P=1,Q=9,R=x.srcBuffer,S=c.min;for(p=0;u>p;p++){for(x.sX=x.srcXOffset,x.fracV=x.srcYOffset&N,x.ifV=N-x.fracV,x.v1=(x.srcYOffset>>O)*x.iw,x.v2=S((x.srcYOffset>>O)+1,x.ih1)*x.iw,o=0;t>o;o++)E=4*(y+o),z=g[E+3]<<24&J|g[E]<<16&K|g[E+1]<<8&L|g[E+2]&M,x.fracU=x.sX&N,x.ifU=N-x.fracU,x.ul=x.ifU*x.ifV>>O,x.ll=x.ifU*x.fracV>>O,x.ur=x.fracU*x.ifV>>O,x.lr=x.fracU*x.fracV>>O,x.u1=x.sX>>O,x.u2=S(x.u1+1,x.iw1),F=4*(x.v1+x.u1),G=4*(x.v1+x.u2),H=4*(x.v2+x.u1),I=4*(x.v2+x.u2),x.cUL=R[F+3]<<24&J|R[F]<<16&K|R[F+1]<<8&L|R[F+2]&M,x.cUR=R[G+3]<<24&J|R[G]<<16&K|R[G+1]<<8&L|R[G+2]&M,x.cLL=R[H+3]<<24&J|R[H]<<16&K|R[H+1]<<8&L|R[H+2]&M,x.cLR=R[I+3]<<24&J|R[I]<<16&K|R[I+1]<<8&L|R[I+2]&M,x.r=x.ul*((x.cUL&K)>>16)+x.ll*((x.cLL&K)>>16)+x.ur*((x.cUR&K)>>16)+x.lr*((x.cLR&K)>>16)<<P&K,x.g=x.ul*(x.cUL&L)+x.ll*(x.cLL&L)+x.ur*(x.cUR&L)+x.lr*(x.cLR&L)>>>O&L,x.b=x.ul*(x.cUL&M)+x.ll*(x.cLL&M)+x.ur*(x.cUR&M)+x.lr*(x.cLR&M)>>>O,x.a=x.ul*((x.cUL&J)>>>24)+x.ll*((x.cLL&J)>>>24)+x.ur*((x.cUR&J)>>>24)+x.lr*((x.cLR&J)>>>24)<<Q&J,D=C(z,x.a|x.r|x.g|x.b),g[E]=(D&K)>>>16,g[E+1]=(D&L)>>>8,g[E+2]=D&M,g[E+3]=(D&J)>>>24,x.sX+=v;y+=h,x.srcYOffset+=w}}},r.loadFont=function(a,b){if(a===d)throw"font name required in loadFont.";if(-1===a.indexOf(".svg"))return b===d&&(b=gc.size),F.get(a,b);var c=r.loadGlyphs(a);return{name:a,css:"12px sans-serif",glyph:!0,units_per_em:c.units_per_em,horiz_adv_x:1/c.units_per_em*c.horiz_adv_x,ascent:c.ascent,descent:c.descent,width:function(b){for(var c=0,d=b.length,e=0;d>e;e++)try{c+=parseFloat(r.glyphLook(r.glyphTable[a],b[e]).horiz_adv_x)}catch(f){G.debug(f)}return c/r.glyphTable[a].units_per_em}}},r.createFont=function(a,b){return r.loadFont(a,b)},r.textFont=function(a,b){b!==d&&(a.glyph||(a=F.get(a.name,b)),cc=b),gc=a,bc=gc.name,dc=gc.ascent,ec=gc.descent,fc=gc.leading;var c=w.$ensureContext();c.font=gc.css},r.textSize=function(a){gc=F.get(bc,a),cc=a,dc=gc.ascent,ec=gc.descent,fc=gc.leading;var b=w.$ensureContext();b.font=gc.css},r.textAscent=function(){return dc},r.textDescent=function(){return ec},r.textLeading=function(a){fc=a},r.textAlign=function(a,b){$b=a,_b=b||0},xd.prototype.textWidth=function(a){var e,b=Le(a).split(/\r?\n/g),d=0,f=b.length;for(s.font=gc.css,e=0;f>e;++e)d=c.max(d,gc.measureTextWidth(b[e]));return 0|d},yd.prototype.textWidth=function(a){var g,e=Le(a).split(/\r?\n/g),f=0,h=e.length;vb===d&&(vb=b.createElement("canvas"));var i=vb.getContext("2d");for(i.font=gc.css,g=0;h>g;++g)f=c.max(f,i.measureText(e[g]).width);return 0|f},r.glyphLook=function(a,b){try{switch(b){case"1":return a.one;case"2":return a.two;case"3":return a.three;case"4":return a.four;case"5":return a.five;case"6":return a.six;case"7":return a.seven;case"8":return a.eight;case"9":return a.nine;case"0":return a.zero;case" ":return a.space;case"$":return a.dollar;case"!":return a.exclam;case'"':return a.quotedbl;case"#":return a.numbersign;case"%":return a.percent;case"&":return a.ampersand;case"'":return a.quotesingle;case"(":return a.parenleft;case")":return a.parenright;case"*":return a.asterisk;case"+":return a.plus;case",":return a.comma;case"-":return a.hyphen;case".":return a.period;case"/":return a.slash;case"_":return a.underscore;case":":return a.colon;case";":return a.semicolon;case"<":return a.less;case"=":return a.equal;case">":return a.greater;case"?":return a.question;case"@":return a.at;case"[":return a.bracketleft;case"\\":return a.backslash;case"]":return a.bracketright;case"^":return a.asciicircum;case"`":return a.grave;case"{":return a.braceleft;case"|":return a.bar;case"}":return a.braceright;case"~":return a.asciitilde;default:return a[b]}}catch(c){G.debug(c)}},xd.prototype.text$line=function(a,b,c,d,e){var f=0,g=0;if(gc.glyph){var h=r.glyphTable[bc];Pd(),s.translate(b,c+cc),(39===e||3===e)&&(f=h.width(a),g=39===e?-f:-f/2);var i=h.units_per_em,j=1/i*cc;s.scale(j,j);for(var k=0,l=a.length;l>k;k++)try{r.glyphLook(h,a[k]).draw()}catch(m){G.debug(m)}Qd()}else a&&"fillText"in s&&(E&&(s.fillStyle=r.color.toString(B),E=!1),(39===e||3===e)&&(f=gc.measureTextWidth(a),g=39===e?-f:-f/2),s.fillText(a,b+g,c))},yd.prototype.text$line=function(a,c,e,f,g){vb===d&&(vb=b.createElement("canvas"));var h=s;s=vb.getContext("2d"),s.font=gc.css;var i=gc.measureTextWidth(a);vb.width=i,vb.height=cc,s=vb.getContext("2d"),s.font=gc.css,s.textBaseline="top",xd.prototype.text$line(a,0,0,0,37);var j=vb.width/vb.height;s=h,s.bindTexture(s.TEXTURE_2D,Tb),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,vb),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE);var k=0;39===g?k=-i:3===g&&(k=-i/2);var l=new Jd,m=.5*cc;l.translate(c+k-m/2,e-m,f),l.scale(-j*m,-m,m),l.translate(-1,-1,-1),l.transpose();var n=new Jd;n.scale(1,-1,1),n.apply(Fc.array()),n.transpose(),s.useProgram(Eb),pd("aVertex2d",Eb,"aVertex",3,Xb),pd("aTextureCoord2d",Eb,"aTextureCoord",2,Yb),nd("uSampler2d",Eb,"uSampler",[0]),nd("uIsDrawingText2d",Eb,"uIsDrawingText",!0),od("uModel2d",Eb,"uModel",!1,l.array()),od("uView2d",Eb,"uView",!1,n.array()),md("uColor2d",Eb,"uColor",A),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,Zb),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)},r.text=function(){5!==ac&&(3===arguments.length?Me(Le(arguments[0]),arguments[1],arguments[2],0):4===arguments.length?Me(Le(arguments[0]),arguments[1],arguments[2],arguments[3]):5===arguments.length?Ne(Le(arguments[0]),arguments[1],arguments[2],arguments[3],arguments[4],0):6===arguments.length&&Ne(Le(arguments[0]),arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]))},r.textMode=function(a){ac=a},r.loadGlyphs=function(e){var f,g,h,i,j,k,l,m,n,o,p,s,q="[0-9\\-]+",t=function(a,b){var e,c=0,d=[],f=new RegExp(a,"g");for(e=d[c]=f.exec(b);e;)c++,e=d[c]=f.exec(b);return d},u=function(a){var b=t("[A-Za-z][0-9\\- ]+|Z",a),d=function(){return Pd(),w.$ensureContext()},e=function(){he(),ie(),Qd()};s="return {draw:function(){var curContext=beforePathDraw();curContext.beginPath();",f=0,g=0,h=0,i=0,j=0,k=0,a=0,m=0,n="",o=b.length-1;for(var l=0;o>l;l++){var r=b[l][0],u=t(q,r);switch(r[0]){case"M":f=parseFloat(u[0][0]),g=parseFloat(u[1][0]),s+="curContext.moveTo("+f+","+-g+");";break;case"L":f=parseFloat(u[0][0]),g=parseFloat(u[1][0]),s+="curContext.lineTo("+f+","+-g+");";break;case"H":f=parseFloat(u[0][0]),s+="curContext.lineTo("+f+","+-g+");";
  break;case"V":g=parseFloat(u[0][0]),s+="curContext.lineTo("+f+","+-g+");";break;case"T":j=parseFloat(u[0][0]),k=parseFloat(u[1][0]),"Q"===n||"T"===n?(a=c.sqrt(c.pow(f-h,2)+c.pow(i-g,2)),m=c.PI+c.atan2(h-f,i-g),h=f+c.sin(m)*a,i=g+c.cos(m)*a):(h=f,i=g),s+="curContext.quadraticCurveTo("+h+","+-i+","+j+","+-k+");",f=j,g=k;break;case"Q":h=parseFloat(u[0][0]),i=parseFloat(u[1][0]),j=parseFloat(u[2][0]),k=parseFloat(u[3][0]),s+="curContext.quadraticCurveTo("+h+","+-i+","+j+","+-k+");",f=j,g=k;break;case"Z":s+="curContext.closePath();"}n=r[0]}return s+="afterPathDraw();",s+="curContext.translate("+p+",0);",s+="}}",new Function("beforePathDraw","afterPathDraw",s)(d,e)},v=function(a){var b=a.getElementsByTagName("font");r.glyphTable[e].horiz_adv_x=b[0].getAttribute("horiz-adv-x");var c=a.getElementsByTagName("font-face")[0];r.glyphTable[e].units_per_em=parseFloat(c.getAttribute("units-per-em")),r.glyphTable[e].ascent=parseFloat(c.getAttribute("ascent")),r.glyphTable[e].descent=parseFloat(c.getAttribute("descent"));for(var f=a.getElementsByTagName("glyph"),g=f.length,h=0;g>h;h++){var i=f[h].getAttribute("unicode"),j=f[h].getAttribute("glyph-name");p=f[h].getAttribute("horiz-adv-x"),null===p&&(p=r.glyphTable[e].horiz_adv_x),l=f[h].getAttribute("d"),l!==d&&(s=u(l),r.glyphTable[e][j]={name:j,unicode:i,horiz_adv_x:p,draw:s.draw})}},x=function(){var c;try{c=b.implementation.createDocument("","",null)}catch(d){return G.debug(d.message),void 0}try{c.async=!1,c.load(e),v(c.getElementsByTagName("svg")[0])}catch(f){G.debug(f);try{var g=new a.XMLHttpRequest;g.open("GET",e,!1),g.send(null),v(g.responseXML.documentElement)}catch(h){G.debug(f)}}};return r.glyphTable[e]={},x(e),r.glyphTable[e]},r.param=function(a){var b="data-processing-"+a;if(i.hasAttribute(b))return i.getAttribute(b);for(var c=0,d=i.childNodes.length;d>c;++c){var e=i.childNodes.item(c);if(1===e.nodeType&&"param"===e.tagName.toLowerCase()&&e.getAttribute("name")===a)return e.getAttribute("value")}return u.params.hasOwnProperty(a)?u.params[a]:null},zd.prototype.translate=Pe("translate"),zd.prototype.transform=Pe("transform"),zd.prototype.scale=Pe("scale"),zd.prototype.pushMatrix=Pe("pushMatrix"),zd.prototype.popMatrix=Pe("popMatrix"),zd.prototype.resetMatrix=Pe("resetMatrix"),zd.prototype.applyMatrix=Pe("applyMatrix"),zd.prototype.rotate=Pe("rotate"),zd.prototype.rotateZ=Pe("rotateZ"),zd.prototype.shearX=Pe("shearX"),zd.prototype.shearY=Pe("shearY"),zd.prototype.redraw=Pe("redraw"),zd.prototype.toImageData=Pe("toImageData"),zd.prototype.ambientLight=Pe("ambientLight"),zd.prototype.directionalLight=Pe("directionalLight"),zd.prototype.lightFalloff=Pe("lightFalloff"),zd.prototype.lightSpecular=Pe("lightSpecular"),zd.prototype.pointLight=Pe("pointLight"),zd.prototype.noLights=Pe("noLights"),zd.prototype.spotLight=Pe("spotLight"),zd.prototype.beginCamera=Pe("beginCamera"),zd.prototype.endCamera=Pe("endCamera"),zd.prototype.frustum=Pe("frustum"),zd.prototype.box=Pe("box"),zd.prototype.sphere=Pe("sphere"),zd.prototype.ambient=Pe("ambient"),zd.prototype.emissive=Pe("emissive"),zd.prototype.shininess=Pe("shininess"),zd.prototype.specular=Pe("specular"),zd.prototype.fill=Pe("fill"),zd.prototype.stroke=Pe("stroke"),zd.prototype.strokeWeight=Pe("strokeWeight"),zd.prototype.smooth=Pe("smooth"),zd.prototype.noSmooth=Pe("noSmooth"),zd.prototype.point=Pe("point"),zd.prototype.vertex=Pe("vertex"),zd.prototype.endShape=Pe("endShape"),zd.prototype.bezierVertex=Pe("bezierVertex"),zd.prototype.curveVertex=Pe("curveVertex"),zd.prototype.curve=Pe("curve"),zd.prototype.line=Pe("line"),zd.prototype.bezier=Pe("bezier"),zd.prototype.rect=Pe("rect"),zd.prototype.ellipse=Pe("ellipse"),zd.prototype.background=Pe("background"),zd.prototype.image=Pe("image"),zd.prototype.textWidth=Pe("textWidth"),zd.prototype.text$line=Pe("text$line"),zd.prototype.$ensureContext=Pe("$ensureContext"),zd.prototype.$newPMatrix=Pe("$newPMatrix"),zd.prototype.size=function(a,b,c){Oe(2===c?"3D":"2D"),r.size(a,b,c)},zd.prototype.$init=e,xd.prototype.$init=function(){r.size(r.width,r.height),s.lineCap="round",r.noSmooth(),r.disableContextMenu()},yd.prototype.$init=function(){r.use3DContext=!0,r.disableContextMenu()},wd.prototype.$ensureContext=function(){return s},Td(i,"touchstart",function(a){i.setAttribute("style","-webkit-user-select: none"),i.setAttribute("onclick","void(0)"),i.setAttribute("style","-webkit-tap-highlight-color:rgba(0,0,0,0)");for(var b=0,c=Sd.length;c>b;b++){var e=Sd[b].type;("mouseout"===e||"mousemove"===e||"mousedown"===e||"mouseup"===e||"DOMMouseScroll"===e||"mousewheel"===e||"touchstart"===e)&&Ud(Sd[b])}r.touchStart!==d||r.touchMove!==d||r.touchEnd!==d||r.touchCancel!==d?(Td(i,"touchstart",function(a){r.touchStart!==d&&(a=Se(a),r.touchStart(a))}),Td(i,"touchmove",function(a){r.touchMove!==d&&(a.preventDefault(),a=Se(a),r.touchMove(a))}),Td(i,"touchend",function(a){r.touchEnd!==d&&(a=Se(a),r.touchEnd(a))}),Td(i,"touchcancel",function(a){r.touchCancel!==d&&(a=Se(a),r.touchCancel(a))})):(Td(i,"touchstart",function(a){Re(i,a.touches[0]),r.__mousePressed=!0,r.mouseDragging=!1,r.mouseButton=37,"function"==typeof r.mousePressed&&r.mousePressed()}),Td(i,"touchmove",function(a){a.preventDefault(),Re(i,a.touches[0]),"function"!=typeof r.mouseMoved||r.__mousePressed||r.mouseMoved(),"function"==typeof r.mouseDragged&&r.__mousePressed&&(r.mouseDragged(),r.mouseDragging=!0)}),Td(i,"touchend",function(){r.__mousePressed=!1,"function"!=typeof r.mouseClicked||r.mouseDragging||r.mouseClicked(),"function"==typeof r.mouseReleased&&r.mouseReleased()})),i.dispatchEvent(a)}),function(){var a=!0,b=function(a){a.preventDefault(),a.stopPropagation()};r.disableContextMenu=function(){a&&(Td(i,"contextmenu",b),a=!1)},r.enableContextMenu=function(){a||(Ud({elem:i,type:"contextmenu",fn:b}),a=!0)}}(),Td(i,"mousemove",function(a){Re(i,a),"function"!=typeof r.mouseMoved||r.__mousePressed||r.mouseMoved(),"function"==typeof r.mouseDragged&&r.__mousePressed&&(r.mouseDragged(),r.mouseDragging=!0)}),Td(i,"mouseout",function(){"function"==typeof r.mouseOut&&r.mouseOut()}),Td(i,"mouseover",function(a){Re(i,a),"function"==typeof r.mouseOver&&r.mouseOver()}),i.onmousedown=function(){return i.focus(),!1},Td(i,"mousedown",function(a){switch(r.__mousePressed=!0,r.mouseDragging=!1,a.which){case 1:r.mouseButton=37;break;case 2:r.mouseButton=3;break;case 3:r.mouseButton=39}"function"==typeof r.mousePressed&&r.mousePressed()}),Td(i,"mouseup",function(){r.__mousePressed=!1,"function"!=typeof r.mouseClicked||r.mouseDragging||r.mouseClicked(),"function"==typeof r.mouseReleased&&r.mouseReleased()});var Te=function(b){var c=0;b.wheelDelta?(c=b.wheelDelta/120,a.opera&&(c=-c)):b.detail&&(c=-b.detail/3),r.mouseScroll=c,c&&"function"==typeof r.mouseScrolled&&r.mouseScrolled()};if(Td(b,"DOMMouseScroll",Te),Td(b,"mousewheel",Te),i.getAttribute("tabindex")||i.setAttribute("tabindex",0),p)u=new G.Sketch,Oe(),r.size=function(a,b,c){c&&2===c?Oe("3D"):Oe("2D"),r.size(a,b,c)};else{u=h instanceof G.Sketch?h:"function"==typeof h?new G.Sketch(h):h?G.compile(h):new G.Sketch(function(){}),r.externals.sketch=u,Oe(),i.onfocus=function(){r.focused=!0},i.onblur=function(){r.focused=!1,u.options.globalKeyEvents||Ye()},u.options.pauseOnBlur&&(Td(a,"focus",function(){O&&r.loop()}),Td(a,"blur",function(){O&&M&&(r.noLoop(),O=!0),Ye()}));var bf=u.options.globalKeyEvents?a:i;Td(bf,"keydown",$e),Td(bf,"keypress",_e),Td(bf,"keyup",af);for(var cf in G.lib)G.lib.hasOwnProperty(cf)&&(G.lib[cf].hasOwnProperty("attach")?G.lib[cf].attach(r):G.lib[cf]instanceof Function&&G.lib[cf].call(this));var df=100,ef=function(c){if(u.imageCache.pending||F.preloading.pending(df))a.setTimeout(function(){ef(c)},df);else{if(a.opera){var d,e,f=u.imageCache.operaCache;for(d in f)f.hasOwnProperty(d)&&(e=f[d],null!==e&&b.body.removeChild(e),delete f[d])}u.attach(c,v),u.onLoad(c),c.setup&&(c.setup(),c.resetMatrix(),u.onSetup()),Be(),c.draw&&(O?c.loop():c.redraw())}};D(this),ef(r)}};G.debug=f,G.prototype=v,G.compile=function(a){var b=new G.Sketch,c=J(a,b),d=I(c);return b.sourceCode=d,b};var K=function(){var a={},c="undefined",d="function",e=!1,f=!0,g=512,h="log";return typeof tinylog!==c&&typeof tinylog[h]===d?a[h]=tinylog[h]:typeof b===c||b.fake?typeof print===d&&(a[h]=print):function(){var c=b,d="div",i="style",j="title",k={zIndex:1e4,position:"fixed",bottom:"0px",width:"100%",height:"15%",fontFamily:"sans-serif",color:"#ccc",backgroundColor:"black"},l={position:"relative",fontFamily:"monospace",overflow:"auto",height:"100%",paddingTop:"5px"},m={height:"5px",marginTop:"-5px",cursor:"n-resize",backgroundColor:"darkgrey"},n={position:"absolute",top:"5px",right:"20px",color:"#111",MozBorderRadius:"4px",webkitBorderRadius:"4px",borderRadius:"4px",cursor:"pointer",fontWeight:"normal",textAlign:"center",padding:"3px 5px",backgroundColor:"#333",fontSize:"12px"},o={minHeight:"16px"},p={fontSize:"12px",margin:"0 8px 0 8px",maxWidth:"100%",whiteSpace:"pre-wrap",overflow:"auto"},q=c.defaultView,r=c.documentElement,s=r[i],t=function(){for(var b,c,d,a=arguments.length;a--;){c=arguments[a--],b=arguments[a][i];for(d in c)c.hasOwnProperty(d)&&(b[d]=c[d])}},u=function(a,b,c){return a.addEventListener?a.addEventListener(b,c,e):a.attachEvent&&a.attachEvent("on"+b,c),[a,b,c]},v=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,e):a.detachEvent&&a.detachEvent("on"+b,c)},w=function(a){for(var b=a.childNodes,c=b.length;c--;)a.removeChild(b.item(0))},x=function(a,b){return a.appendChild(b)},y=function(a){return c.createElement(a)},z=function(a){return c.createTextNode(a)},A=a[h]=function(b){var B,C=s.paddingBottom,D=y(d),E=D[i],F=x(D,y(d)),G=x(D,y(d)),H=x(D,y(d)),I=e,J=e,K=e,L=0,M=function(){s.paddingBottom=D.clientHeight+"px"},N=function(a){var b=q.innerHeight,c=F.clientHeight;0>a?a=0:a+c>b&&(a=b-c),E.height=100*(a/b)+"%",M()},O=[u(c,"mousemove",function(a){I&&(N(q.innerHeight-a.clientY),G.scrollTop=K)}),u(c,"mouseup",function(){I&&(I=K=e)}),u(F,"dblclick",function(a){a.preventDefault(),J?(N(J),J=e):(J=D.clientHeight,E.height="0px")}),u(F,"mousedown",function(a){a.preventDefault(),I=f,K=G.scrollTop}),u(F,"contextmenu",function(){I=e}),u(H,"click",function(){B()})];B=function(){for(var b=O.length;b--;)v.apply(a,O[b]);r.removeChild(D),s.paddingBottom=C,w(G),w(D),a[h]=A},t(D,k,G,l,F,m,H,n),H[j]="Close Log",x(H,z("\u2716")),F[j]="Double-click to toggle log minimization",r.insertBefore(D,r.firstChild),a[h]=function(a){L===g?G.removeChild(G.firstChild):L++;var b=x(G,y(d)),c=x(b,y(d));b[j]=(new Date).toLocaleTimeString(),t(b,o,c,p),x(c,z(a)),G.scrollTop=G.scrollHeight},a[h](b),M()}}(),a}();G.logger=K,G.version="1.4.1",G.lib={},G.registerLibrary=function(a,b){G.lib[a]=b,b.hasOwnProperty("init")&&b.init(v)},G.instances=A,G.getInstanceById=function(a){return A[B[a]]},G.Sketch=function(c){this.attachFunction=c,this.options={pauseOnBlur:!1,globalKeyEvents:!1},this.onLoad=e,this.onSetup=e,this.onPause=e,this.onLoop=e,this.onFrameStart=e,this.onFrameEnd=e,this.onExit=e,this.params={},this.imageCache={pending:0,images:{},operaCache:{},add:function(c,d){if(!this.images[c]&&(h||(this.images[c]=null),d||(d=new Image,d.onload=function(a){return function(){a.pending--}}(this),this.pending++,d.src=c),this.images[c]=d,a.opera)){var e=b.createElement("div");e.appendChild(d),e.style.position="absolute",e.style.opacity=0,e.style.width="1px",e.style.height="1px",this.operaCache[c]||(b.body.appendChild(e),this.operaCache[c]=e)}}},this.sourceCode=void 0,this.attach=function(a){if("function"==typeof this.attachFunction)this.attachFunction(a);else{if(!this.sourceCode)throw"Unable to attach sketch to the processing instance";var b=new Function("return ("+this.sourceCode+");")();b(a),this.attachFunction=b}},this.toString=function(){var a,b="((function(Sketch) {\n";b+="var sketch = new Sketch(\n"+this.sourceCode+");\n";for(a in this.options)if(this.options.hasOwnProperty(a)){var c=this.options[a];b+="sketch.options."+a+" = "+("string"==typeof c?'"'+c+'"':""+c)+";\n"}for(a in this.imageCache)this.options.hasOwnProperty(a)&&(b+='sketch.imageCache.add("'+a+'");\n');return b+="return sketch;\n})(Processing.Sketch))"}};var L=function(c,d){function i(b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState){var b;200!==d.status&&0!==d.status?b="Invalid XHR status "+d.status:""===d.responseText&&(b="withCredentials"in new XMLHttpRequest&&(new XMLHttpRequest).withCredentials===!1&&"file:"===a.location.protocol?"XMLHttpRequest failure, possibly due to a same-origin policy violation. You can try loading this page in another browser, or load it from http://localhost using a local webserver. See the Processing.js README for a more detailed explanation of this problem and solutions.":"File is empty."),c(d.responseText,b)}},d.open("GET",b,!0),d.overrideMimeType&&d.overrideMimeType("application/json"),d.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),d.send(null)}function j(a,d){function j(b,i){if(e[a]=b,++h,i&&f.push(d+" ==> "+i),h===g){if(0!==f.length)throw"Processing.js: Unable to load pjs sketch files: "+f.join("\n");try{return new G(c,e.join("\n"))}catch(j){throw"Processing.js: Unable to execute pjs sketch: "+j}}}if("#"===d.charAt(0)){var k=b.getElementById(d.substring(1));return k?j(k.text||k.textContent):j("","Unable to load pjs sketch: element with id '"+d.substring(1)+"' was not found"),void 0}i(d,j)}for(var e=[],f=[],g=d.length,h=0,k=0;g>k;++k)j(k,d[k])},M=function(){b.removeEventListener("DOMContentLoaded",M,!1),A=[];for(var c,a=b.getElementsByTagName("canvas"),e=0,f=a.length;f>e;e++){var g=a[e].getAttribute("data-processing-sources");if(null===g&&(g=a[e].getAttribute("data-src"),null===g&&(g=a[e].getAttribute("datasrc"))),g){c=g.split(/\s+/g);for(var h=0;h<c.length;)c[h]?h++:c.splice(h,1);L(a[e],c)}}var i,j,k,l,m=b.getElementsByTagName("script"),n=[];for(i=m.length-1;i>=0;i--)n.push(m[i]);for(i=0,j=n.length;j>i;i++){var o=n[i];if(o.getAttribute){var p=o.getAttribute("type");if(p&&("text/processing"===p.toLowerCase()||"application/processing"===p.toLowerCase())){var q=o.getAttribute("data-processing-target");if(a=d,q)a=b.getElementById(q);else{for(var r=o.nextSibling;r&&1!==r.nodeType;)r=r.nextSibling;r&&"canvas"===r.nodeName.toLowerCase()&&(a=r)}if(a){if(o.getAttribute("src")){c=o.getAttribute("src").split(/\s+/),L(a,c);continue}k=o.textContent||o.text,l=new G(a,k)}}}}};G.reload=function(){if(A.length>0)for(var a=A.length-1;a>=0;a--)A[a]&&A[a].exit();M()},G.loadSketchFromSources=L,G.disableInit=function(){h&&b.removeEventListener("DOMContentLoaded",M,!1)},h?(a.Processing=G,b.addEventListener("DOMContentLoaded",M,!1)):this.Processing=G}(window,window.document,Math);
}
if (!window.Raphael) {
  !function(a){var h,i,b="0.4.2",c="hasOwnProperty",d=/[\.\/]/,e="*",f=function(){},g=function(a,b){return a-b},j={n:{}},k=function(a,b){a=String(a);var n,d=i,e=Array.prototype.slice.call(arguments,2),f=k.listeners(a),l=0,o=[],p={},q=[],r=h;h=a,i=0;for(var t=0,u=f.length;u>t;t++)"zIndex"in f[t]&&(o.push(f[t].zIndex),f[t].zIndex<0&&(p[f[t].zIndex]=f[t]));for(o.sort(g);o[l]<0;)if(n=p[o[l++]],q.push(n.apply(b,e)),i)return i=d,q;for(t=0;u>t;t++)if(n=f[t],"zIndex"in n)if(n.zIndex==o[l]){if(q.push(n.apply(b,e)),i)break;do if(l++,n=p[o[l]],n&&q.push(n.apply(b,e)),i)break;while(n)}else p[n.zIndex]=n;else if(q.push(n.apply(b,e)),i)break;return i=d,h=r,q.length?q:null};k._events=j,k.listeners=function(a){var f,g,h,i,k,l,m,n,b=a.split(d),c=j,o=[c],p=[];for(i=0,k=b.length;k>i;i++){for(n=[],l=0,m=o.length;m>l;l++)for(c=o[l].n,g=[c[b[i]],c[e]],h=2;h--;)f=g[h],f&&(n.push(f),p=p.concat(f.f||[]));o=n}return p},k.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(d),e=j,g=0,h=c.length;h>g;g++)e=e.n,e=e.hasOwnProperty(c[g])&&e[c[g]]||(e[c[g]]={n:{}});for(e.f=e.f||[],g=0,h=e.f.length;h>g;g++)if(e.f[g]==b)return f;return e.f.push(b),function(a){+a==+a&&(b.zIndex=+a)}},k.f=function(a){var b=[].slice.call(arguments,1);return function(){k.apply(null,[a,null].concat(b).concat([].slice.call(arguments,0)))}},k.stop=function(){i=1},k.nt=function(a){return a?new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(h):h},k.nts=function(){return h.split(d)},k.off=k.unbind=function(a,b){if(!a)return k._events=j={n:{}},void 0;var g,h,i,l,m,n,o,f=a.split(d),p=[j];for(l=0,m=f.length;m>l;l++)for(n=0;n<p.length;n+=i.length-2){if(i=[n,1],g=p[n].n,f[l]!=e)g[f[l]]&&i.push(g[f[l]]);else for(h in g)g[c](h)&&i.push(g[h]);p.splice.apply(p,i)}for(l=0,m=p.length;m>l;l++)for(g=p[l];g.n;){if(b){if(g.f){for(n=0,o=g.f.length;o>n;n++)if(g.f[n]==b){g.f.splice(n,1);break}!g.f.length&&delete g.f}for(h in g.n)if(g.n[c](h)&&g.n[h].f){var q=g.n[h].f;for(n=0,o=q.length;o>n;n++)if(q[n]==b){q.splice(n,1);break}!q.length&&delete g.n[h].f}}else{delete g.f;for(h in g.n)g.n[c](h)&&g.n[h].f&&delete g.n[h].f}g=g.n}},k.once=function(a,b){var c=function(){return k.unbind(a,c),b.apply(this,arguments)};return k.on(a,c)},k.version=b,k.toString=function(){return"You are running Eve "+b},a.eve=k}(this),function(a,b){b(a,a.eve)}(this,function(a,b){function c(a){if(c.is(a,"function"))return d?a():b.on("raphael.DOMload",a);if(c.is(a,G))return c._engine.create[o](c,a.splice(0,3+c.is(a[0],E))).add(a);var e=Array.prototype.slice.call(arguments,0);if(c.is(e[e.length-1],"function")){var f=e.pop();return d?f.call(c._engine.create[o](c,e)):b.on("raphael.DOMload",function(){f.call(c._engine.create[o](c,e))})}return c._engine.create[o](c,arguments)}function ob(a){if("function"==typeof a||Object(a)!==a)return a;var b=new a.constructor;for(var c in a)a[i](c)&&(b[c]=ob(a[c]));return b}function wb(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return a.push(a.splice(c,1)[0])}function xb(a,b,c){function d(){var e=Array.prototype.slice.call(arguments,0),f=e.join("\u2400"),g=d.cache=d.cache||{},h=d.count=d.count||[];return g[i](f)?(wb(h,f),c?c(g[f]):g[f]):(h.length>=1e3&&delete g[h.shift()],h.push(f),g[f]=a[o](b,e),c?c(g[f]):g[f])}return d}function zb(){return this.hex}function Ab(a,b){for(var c=[],d=0,e=a.length;e-2*!b>d;d+=2){var f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y])}return c}function Cb(a,b,c,d,e){var f=-3*b+9*c-9*d+3*e,g=a*f+6*b-12*c+6*d;return a*g-3*b+3*c}function Db(a,b,c,d,e,f,g,h,i){null==i&&(i=1),i=i>1?1:0>i?0:i;for(var j=i/2,k=12,l=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],m=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],n=0,o=0;k>o;o++){var p=j*l[o]+j,q=Cb(p,a,c,e,g),r=Cb(p,b,d,f,h),s=q*q+r*r;n+=m[o]*y.sqrt(s)}return j*n}function Eb(a,b,c,d,e,f,g,h,i){if(!(0>i||Db(a,b,c,d,e,f,g,h)<i)){var m,j=1,k=j/2,l=j-k,n=.01;for(m=Db(a,b,c,d,e,f,g,h,l);B(m-i)>n;)k/=2,l+=(i>m?1:-1)*k,m=Db(a,b,c,d,e,f,g,h,l);return l}}function Fb(a,b,c,d,e,f,g,h){if(!(z(a,c)<A(e,g)||A(a,c)>z(e,g)||z(b,d)<A(f,h)||A(b,d)>z(f,h))){var i=(a*d-b*c)*(e-g)-(a-c)*(e*h-f*g),j=(a*d-b*c)*(f-h)-(b-d)*(e*h-f*g),k=(a-c)*(f-h)-(b-d)*(e-g);if(k){var l=i/k,m=j/k,n=+l.toFixed(2),o=+m.toFixed(2);if(!(n<+A(a,c).toFixed(2)||n>+z(a,c).toFixed(2)||n<+A(e,g).toFixed(2)||n>+z(e,g).toFixed(2)||o<+A(b,d).toFixed(2)||o>+z(b,d).toFixed(2)||o<+A(f,h).toFixed(2)||o>+z(f,h).toFixed(2)))return{x:l,y:m}}}}function Ib(a,b,d){var e=c.bezierBBox(a),f=c.bezierBBox(b);if(!c.isBBoxIntersect(e,f))return d?0:[];for(var g=Db.apply(0,a),h=Db.apply(0,b),i=z(~~(g/5),1),j=z(~~(h/5),1),k=[],l=[],m={},n=d?0:[],o=0;i+1>o;o++){var p=c.findDotsAtSegment.apply(c,a.concat(o/i));k.push({x:p.x,y:p.y,t:o/i})}for(o=0;j+1>o;o++)p=c.findDotsAtSegment.apply(c,b.concat(o/j)),l.push({x:p.x,y:p.y,t:o/j});for(o=0;i>o;o++)for(var q=0;j>q;q++){var r=k[o],s=k[o+1],t=l[q],u=l[q+1],v=B(s.x-r.x)<.001?"y":"x",w=B(u.x-t.x)<.001?"y":"x",x=Fb(r.x,r.y,s.x,s.y,t.x,t.y,u.x,u.y);if(x){if(m[x.x.toFixed(4)]==x.y.toFixed(4))continue;m[x.x.toFixed(4)]=x.y.toFixed(4);var y=r.t+B((x[v]-r[v])/(s[v]-r[v]))*(s.t-r.t),C=t.t+B((x[w]-t[w])/(u[w]-t[w]))*(u.t-t.t);y>=0&&1.001>=y&&C>=0&&1.001>=C&&(d?n++:n.push({x:x.x,y:x.y,t1:A(y,1),t2:A(C,1)}))}}return n}function Jb(a,b,d){a=c._path2curve(a),b=c._path2curve(b);for(var e,f,g,h,i,j,k,l,m,n,o=d?0:[],p=0,q=a.length;q>p;p++){var r=a[p];if("M"==r[0])e=i=r[1],f=j=r[2];else{"C"==r[0]?(m=[e,f].concat(r.slice(1)),e=m[6],f=m[7]):(m=[e,f,e,f,i,j,i,j],e=i,f=j);for(var s=0,t=b.length;t>s;s++){var u=b[s];if("M"==u[0])g=k=u[1],h=l=u[2];else{"C"==u[0]?(n=[g,h].concat(u.slice(1)),g=n[6],h=n[7]):(n=[g,h,g,h,k,l,k,l],g=k,h=l);var v=Ib(m,n,d);if(d)o+=v;else{for(var w=0,x=v.length;x>w;w++)v[w].segment1=p,v[w].segment2=s,v[w].bez1=m,v[w].bez2=n;o=o.concat(v)}}}}}return o}function dc(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function tc(){return this.x+s+this.y+s+this.width+" \xd7 "+this.height}function Fc(a,b,c,d,e,f){function m(a){return((i*a+h)*a+g)*a}function n(a,b){var c=o(a,b);return((l*c+k)*c+j)*c}function o(a,b){var c,d,e,f,j,k;for(e=a,k=0;8>k;k++){if(f=m(e)-a,B(f)<b)return e;if(j=(3*i*e+2*h)*e+g,B(j)<1e-6)break;e-=f/j}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=m(e),B(f-a)<b)return e;a>f?c=e:d=e,e=(d-c)/2+c}return e}var g=3*b,h=3*(d-b)-g,i=1-g-h,j=3*c,k=3*(e-c)-j,l=1-j-k;return n(a,1/(200*f))}function Gc(a,b){var c=[],d={};if(this.ms=b,this.times=1,a){for(var e in a)a[i](e)&&(d[S(e)]=a[e],c.push(S(e)));c.sort(fb)}this.anim=d,this.top=c[c.length-1],this.percents=c}function Hc(a,d,f,g,h,j){f=S(f);var k,l,m,o,q,r,s=a.ms,v={},w={},x={};if(g)for(z=0,A=Bc.length;A>z;z++){var y=Bc[z];if(y.el.id==d.id&&y.anim==a){y.percent!=f?(Bc.splice(z,1),m=1):l=y,d.attr(y.totalOrigin);break}}else g=+w;for(var z=0,A=a.percents.length;A>z;z++){if(a.percents[z]==f||a.percents[z]>g*a.top){f=a.percents[z],q=a.percents[z-1]||0,s=s/a.top*(f-q),o=a.percents[z+1],k=a.anim[f];break}g&&d.attr(a.anim[a.percents[z]])}if(k){if(l)l.initstatus=g,l.start=new Date-l.ms*g;else{for(var B in k)if(k[i](B)&&(W[i](B)||d.paper.customAttributes[i](B)))switch(v[B]=d.attr(B),null==v[B]&&(v[B]=V[B]),w[B]=k[B],W[B]){case E:x[B]=(w[B]-v[B])/s;break;case"colour":v[B]=c.getRGB(v[B]);var C=c.getRGB(w[B]);x[B]={r:(C.r-v[B].r)/s,g:(C.g-v[B].g)/s,b:(C.b-v[B].b)/s};break;case"path":var D=Tb(v[B],w[B]),F=D[1];for(v[B]=D[0],x[B]=[],z=0,A=v[B].length;A>z;z++){x[B][z]=[0];for(var G=1,H=v[B][z].length;H>G;G++)x[B][z][G]=(F[z][G]-v[B][z][G])/s}break;case"transform":var I=d._,J=cc(I[B],w[B]);if(J)for(v[B]=J.from,w[B]=J.to,x[B]=[],x[B].real=!0,z=0,A=v[B].length;A>z;z++)for(x[B][z]=[v[B][z][0]],G=1,H=v[B][z].length;H>G;G++)x[B][z][G]=(w[B][z][G]-v[B][z][G])/s;else{var K=d.matrix||new dc,L={_:{transform:I.transform},getBBox:function(){return d.getBBox(1)}};v[B]=[K.a,K.b,K.c,K.d,K.e,K.f],ac(L,w[B]),w[B]=L._.transform,x[B]=[(L.matrix.a-K.a)/s,(L.matrix.b-K.b)/s,(L.matrix.c-K.c)/s,(L.matrix.d-K.d)/s,(L.matrix.e-K.e)/s,(L.matrix.f-K.f)/s]}break;case"csv":var M=t(k[B])[u](e),N=t(v[B])[u](e);if("clip-rect"==B)for(v[B]=N,x[B]=[],z=N.length;z--;)x[B][z]=(M[z]-v[B][z])/s;w[B]=M;break;default:for(M=[][p](k[B]),N=[][p](v[B]),x[B]=[],z=d.paper.customAttributes[B].length;z--;)x[B][z]=((M[z]||0)-(N[z]||0))/s}var O=k.easing,Q=c.easing_formulas[O];if(!Q)if(Q=t(O).match(P),Q&&5==Q.length){var R=Q;Q=function(a){return Fc(a,+R[1],+R[2],+R[3],+R[4],s)}}else Q=hb;if(r=k.start||a.start||+new Date,y={anim:a,percent:f,timestamp:r,start:r+(a.del||0),status:0,initstatus:g||0,stop:!1,ms:s,easing:Q,from:v,diff:x,to:w,el:d,callback:k.callback,prev:q,next:o,repeat:j||a.times,origin:d.attr(),totalOrigin:h},Bc.push(y),g&&!l&&!m&&(y.stop=!0,y.start=new Date-s*g,1==Bc.length))return Dc();m&&(y.start=new Date-y.ms*g),1==Bc.length&&Cc(Dc)}b("raphael.anim.start."+d.id,d,a)}}function Ic(a){for(var b=0;b<Bc.length;b++)Bc[b].el.paper==a&&Bc.splice(b--,1)}c.version="2.1.2",c.eve=b;var d,m,e=/[, ]+/,f={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},g=/\{(\d+)\}/g,i="hasOwnProperty",j={doc:document,win:a},k={was:Object.prototype[i].call(j.win,"Raphael"),is:j.win.Raphael},l=function(){this.ca=this.customAttributes={}},o="apply",p="concat",q="ontouchstart"in j.win||j.win.DocumentTouch&&j.doc instanceof DocumentTouch,r="",s=" ",t=String,u="split",v="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[u](s),w={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},x=t.prototype.toLowerCase,y=Math,z=y.max,A=y.min,B=y.abs,C=y.pow,D=y.PI,E="number",F="string",G="array",J=Object.prototype.toString,N=(c._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),O={NaN:1,Infinity:1,"-Infinity":1},P=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,Q=y.round,S=parseFloat,T=parseInt,U=t.prototype.toUpperCase,V=c._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},W=c._availableAnimAttrs={blur:E,"clip-rect":"csv",cx:E,cy:E,fill:"colour","fill-opacity":E,"font-size":E,height:E,opacity:E,path:"path",r:E,rx:E,ry:E,stroke:"colour","stroke-opacity":E,"stroke-width":E,transform:"transform",width:E,x:E,y:E},Y=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,Z={hs:1,rg:1},$=/,?([achlmqrstvxz]),?/gi,_=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ab=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,bb=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,db=(c._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),fb=function(a,b){return S(a)-S(b)},gb=function(){},hb=function(a){return a},ib=c._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},jb=function(a,b,c,d){return null==d&&(d=c),[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},kb=c._getPath={path:function(a){return a.attr("path")},circle:function(a){var b=a.attrs;return jb(b.cx,b.cy,b.r)},ellipse:function(a){var b=a.attrs;return jb(b.cx,b.cy,b.rx,b.ry)},rect:function(a){var b=a.attrs;return ib(b.x,b.y,b.width,b.height,b.r)},image:function(a){var b=a.attrs;return ib(b.x,b.y,b.width,b.height)},text:function(a){var b=a._getBBox();return ib(b.x,b.y,b.width,b.height)},set:function(a){var b=a._getBBox();return ib(b.x,b.y,b.width,b.height)}},lb=c.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(a=Tb(a),e=0,g=a.length;g>e;e++)for(i=a[e],f=1,h=i.length;h>f;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a};if(c._g=j,c.type=j.win.SVGAngle||j.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==c.type){var nb,mb=j.doc.createElement("div");if(mb.innerHTML='<v:shape adj="1"/>',nb=mb.firstChild,nb.style.behavior="url(#default#VML)",!nb||"object"!=typeof nb.adj)return c.type=r;mb=null}c.svg=!(c.vml="VML"==c.type),c._Paper=l,c.fn=m=l.prototype=c.prototype,c._id=0,c._oid=0,c.is=function(a,b){return b=x.call(b),"finite"==b?!O[i](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||J.call(a).slice(8,-1).toLowerCase()==b},c.angle=function(a,b,d,e,f,g){if(null==f){var h=a-d,i=b-e;return h||i?(180+180*y.atan2(-i,-h)/D+360)%360:0}return c.angle(a,b,f,g)-c.angle(d,e,f,g)},c.rad=function(a){return a%360*D/180},c.deg=function(a){return 180*a/D%360},c.snapTo=function(a,b,d){if(d=c.is(d,"finite")?d:10,c.is(a,G)){for(var e=a.length;e--;)if(B(a[e]-b)<=d)return a[e]}else{a=+a;var f=b%a;if(d>f)return b-f;if(f>a-d)return b-f+a}return b},c.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=0|16*y.random(),c="x"==a?b:8|3&b;return c.toString(16)}),c.setWindow=function(a){b("raphael.setWindow",c,j.win,a),j.win=a,j.doc=j.win.document,c._engine.initWin&&c._engine.initWin(j.win)};var qb=function(a){if(c.vml){var d,b=/^\s+|\s+$/g;try{var e=new ActiveXObject("htmlfile");e.write("<body>"),e.close(),d=e.body}catch(f){d=createPopup().document.body}var g=d.createTextRange();qb=xb(function(a){try{d.style.color=t(a).replace(b,r);var c=g.queryCommandValue("ForeColor");return c=(255&c)<<16|65280&c|(16711680&c)>>>16,"#"+("000000"+c.toString(16)).slice(-6)}catch(e){return"none"}})}else{var h=j.doc.createElement("i");h.title="Rapha\xebl Colour Picker",h.style.display="none",j.doc.body.appendChild(h),qb=xb(function(a){return h.style.color=a,j.doc.defaultView.getComputedStyle(h,r).getPropertyValue("color")})}return qb(a)},rb=function(){return"hsb("+[this.h,this.s,this.b]+")"},sb=function(){return"hsl("+[this.h,this.s,this.l]+")"},tb=function(){return this.hex},ub=function(a,b,d){if(null==b&&c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(d=a.b,b=a.g,a=a.r),null==b&&c.is(a,F)){var e=c.getRGB(a);a=e.r,b=e.g,d=e.b}return(a>1||b>1||d>1)&&(a/=255,b/=255,d/=255),[a,b,d]},vb=function(a,b,d,e){a*=255,b*=255,d*=255;var f={r:a,g:b,b:d,hex:c.rgb(a,b,d),toString:tb};return c.is(e,"finite")&&(f.opacity=e),f};c.color=function(a){var b;return c.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=c.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):c.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=c.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(c.is(a,"string")&&(a=c.getRGB(a)),c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=c.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=c.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1)),a.toString=tb,a},c.hsb2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-B(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],vb(e,f,g,d)},c.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h),(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100),a*=360;var e,f,g,h,i;return a=a%360/60,i=2*b*(.5>c?c:1-c),h=i*(1-B(a%2-1)),e=f=g=c-i/2,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],vb(e,f,g,d)},c.rgb2hsb=function(a,b,c){c=ub(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g;return f=z(a,b,c),g=f-A(a,b,c),d=0==g?null:f==a?(b-c)/g:f==b?(c-a)/g+2:(a-b)/g+4,d=60*((d+360)%6)/360,e=0==g?0:g/f,{h:d,s:e,b:f,toString:rb}},c.rgb2hsl=function(a,b,c){c=ub(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g,h,i;return g=z(a,b,c),h=A(a,b,c),i=g-h,d=0==i?null:g==a?(b-c)/i:g==b?(c-a)/i+2:(a-b)/i+4,d=60*((d+360)%6)/360,f=(g+h)/2,e=0==i?0:.5>f?i/(2*f):i/(2-2*f),{h:d,s:e,l:f,toString:sb}},c._path2string=function(){return this.join(",").replace($,"$1")},c._preload=function(a,b){var c=j.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top:-9999em",c.onload=function(){b.call(this),this.onload=null,j.doc.body.removeChild(this)},c.onerror=function(){j.doc.body.removeChild(this)},j.doc.body.appendChild(c),c.src=a},c.getRGB=xb(function(a){if(!a||(a=t(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:zb};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:zb};!(Z[i](a.toLowerCase().substring(0,2))||"#"==a.charAt())&&(a=qb(a));var d,e,f,g,h,j,k=a.match(N);return k?(k[2]&&(f=T(k[2].substring(5),16),e=T(k[2].substring(3,5),16),d=T(k[2].substring(1,3),16)),k[3]&&(f=T((h=k[3].charAt(3))+h,16),e=T((h=k[3].charAt(2))+h,16),d=T((h=k[3].charAt(1))+h,16)),k[4]&&(j=k[4][u](Y),d=S(j[0]),"%"==j[0].slice(-1)&&(d*=2.55),e=S(j[1]),"%"==j[1].slice(-1)&&(e*=2.55),f=S(j[2]),"%"==j[2].slice(-1)&&(f*=2.55),"rgba"==k[1].toLowerCase().slice(0,4)&&(g=S(j[3])),j[3]&&"%"==j[3].slice(-1)&&(g/=100)),k[5]?(j=k[5][u](Y),d=S(j[0]),"%"==j[0].slice(-1)&&(d*=2.55),e=S(j[1]),"%"==j[1].slice(-1)&&(e*=2.55),f=S(j[2]),"%"==j[2].slice(-1)&&(f*=2.55),("deg"==j[0].slice(-3)||"\xb0"==j[0].slice(-1))&&(d/=360),"hsba"==k[1].toLowerCase().slice(0,4)&&(g=S(j[3])),j[3]&&"%"==j[3].slice(-1)&&(g/=100),c.hsb2rgb(d,e,f,g)):k[6]?(j=k[6][u](Y),d=S(j[0]),"%"==j[0].slice(-1)&&(d*=2.55),e=S(j[1]),"%"==j[1].slice(-1)&&(e*=2.55),f=S(j[2]),"%"==j[2].slice(-1)&&(f*=2.55),("deg"==j[0].slice(-3)||"\xb0"==j[0].slice(-1))&&(d/=360),"hsla"==k[1].toLowerCase().slice(0,4)&&(g=S(j[3])),j[3]&&"%"==j[3].slice(-1)&&(g/=100),c.hsl2rgb(d,e,f,g)):(k={r:d,g:e,b:f,toString:zb},k.hex="#"+(16777216|f|e<<8|d<<16).toString(16).slice(1),c.is(g,"finite")&&(k.opacity=g),k)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:zb}},c),c.hsb=xb(function(a,b,d){return c.hsb2rgb(a,b,d).hex}),c.hsl=xb(function(a,b,d){return c.hsl2rgb(a,b,d).hex}),c.rgb=xb(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)}),c.getColor=function(a){var b=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||.75},c=this.hsb2rgb(b.h,b.s,b.b);return b.h+=.075,b.h>1&&(b.h=0,b.s-=.2,b.s<=0&&(this.getColor.start={h:0,s:1,b:b.b})),c.hex},c.getColor.reset=function(){delete this.start},c.parsePathString=function(a){if(!a)return null;var b=Bb(a);if(b.arr)return Lb(b.arr);var d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},e=[];return c.is(a,G)&&c.is(a[0],G)&&(e=Lb(a)),e.length||t(a).replace(_,function(a,b,c){var f=[],g=b.toLowerCase();if(c.replace(bb,function(a,b){b&&f.push(+b)}),"m"==g&&f.length>2&&(e.push([b][p](f.splice(0,2))),g="l",b="m"==b?"l":"L"),"r"==g)e.push([b][p](f));else for(;f.length>=d[g]&&(e.push([b][p](f.splice(0,d[g]))),d[g]););}),e.toString=c._path2string,b.arr=Lb(e),e},c.parseTransformString=xb(function(a){if(!a)return null;var d=[];return c.is(a,G)&&c.is(a[0],G)&&(d=Lb(a)),d.length||t(a).replace(ab,function(a,b,c){var e=[];x.call(b),c.replace(bb,function(a,b){b&&e.push(+b)}),d.push([b][p](e))}),d.toString=c._path2string,d});var Bb=function(a){var b=Bb.ps=Bb.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[i](c)&&c!=a&&(b[c].sleep--,!b[c].sleep&&delete b[c])}),b[a]};c.findDotsAtSegment=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=C(j,3),l=C(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,p=k*b+3*l*i*d+3*j*i*i*f+n*h,q=a+2*i*(c-a)+m*(e-2*c+a),r=b+2*i*(d-b)+m*(f-2*d+b),s=c+2*i*(e-c)+m*(g-2*e+c),t=d+2*i*(f-d)+m*(h-2*f+d),u=j*a+i*c,v=j*b+i*d,w=j*e+i*g,x=j*f+i*h,z=90-180*y.atan2(q-s,r-t)/D;return(q>s||t>r)&&(z+=180),{x:o,y:p,m:{x:q,y:r},n:{x:s,y:t},start:{x:u,y:v},end:{x:w,y:x},alpha:z}},c.bezierBBox=function(a,b,d,e,f,g,h,i){c.is(a,"array")||(a=[a,b,d,e,f,g,h,i]);var j=Sb.apply(null,a);return{x:j.min.x,y:j.min.y,x2:j.max.x,y2:j.max.y,width:j.max.x-j.min.x,height:j.max.y-j.min.y}},c.isPointInsideBBox=function(a,b,c){return b>=a.x&&b<=a.x2&&c>=a.y&&c<=a.y2},c.isBBoxIntersect=function(a,b){var d=c.isPointInsideBBox;return d(b,a.x,a.y)||d(b,a.x2,a.y)||d(b,a.x,a.y2)||d(b,a.x2,a.y2)||d(a,b.x,b.y)||d(a,b.x2,b.y)||d(a,b.x,b.y2)||d(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)},c.pathIntersection=function(a,b){return Jb(a,b)},c.pathIntersectionNumber=function(a,b){return Jb(a,b,1)},c.isPointInsidePath=function(a,b,d){var e=c.pathBBox(a);return c.isPointInsideBBox(e,b,d)&&1==Jb(a,[["M",b,d],["H",e.x2+10]],1)%2},c._removedFactory=function(a){return function(){b("raphael.log",null,"Rapha\xebl: you are calling to method \u201c"+a+"\u201d of removed object",a)}};var Kb=c.pathBBox=function(a){var b=Bb(a);if(b.bbox)return ob(b.bbox);if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};a=Tb(a);for(var g,c=0,d=0,e=[],f=[],h=0,i=a.length;i>h;h++)if(g=a[h],"M"==g[0])c=g[1],d=g[2],e.push(c),f.push(d);else{var j=Sb(c,d,g[1],g[2],g[3],g[4],g[5],g[6]);e=e[p](j.min.x,j.max.x),f=f[p](j.min.y,j.max.y),c=g[5],d=g[6]}var k=A[o](0,e),l=A[o](0,f),m=z[o](0,e),n=z[o](0,f),q=m-k,r=n-l,s={x:k,y:l,x2:m,y2:n,width:q,height:r,cx:k+q/2,cy:l+r/2};return b.bbox=ob(s),s},Lb=function(a){var b=ob(a);return b.toString=c._path2string,b},Mb=c._pathToRelative=function(a){var b=Bb(a);if(b.rel)return Lb(b.rel);c.is(a,G)&&c.is(a&&a[0],G)||(a=c.parsePathString(a));var d=[],e=0,f=0,g=0,h=0,i=0;"M"==a[0][0]&&(e=a[0][1],f=a[0][2],g=e,h=f,i++,d.push(["M",e,f]));for(var j=i,k=a.length;k>j;j++){var l=d[j]=[],m=a[j];if(m[0]!=x.call(m[0]))switch(l[0]=x.call(m[0]),l[0]){case"a":l[1]=m[1],l[2]=m[2],l[3]=m[3],l[4]=m[4],l[5]=m[5],l[6]=+(m[6]-e).toFixed(3),l[7]=+(m[7]-f).toFixed(3);break;case"v":l[1]=+(m[1]-f).toFixed(3);break;case"m":g=m[1],h=m[2];default:for(var n=1,o=m.length;o>n;n++)l[n]=+(m[n]-(n%2?e:f)).toFixed(3)}else{l=d[j]=[],"m"==m[0]&&(g=m[1]+e,h=m[2]+f);for(var p=0,q=m.length;q>p;p++)d[j][p]=m[p]}var r=d[j].length;switch(d[j][0]){case"z":e=g,f=h;break;case"h":e+=+d[j][r-1];break;case"v":f+=+d[j][r-1];break;default:e+=+d[j][r-2],f+=+d[j][r-1]}}return d.toString=c._path2string,b.rel=Lb(d),d},Nb=c._pathToAbsolute=function(a){var b=Bb(a);if(b.abs)return Lb(b.abs);if(c.is(a,G)&&c.is(a&&a[0],G)||(a=c.parsePathString(a)),!a||!a.length)return[["M",0,0]];var d=[],e=0,f=0,g=0,h=0,i=0;"M"==a[0][0]&&(e=+a[0][1],f=+a[0][2],g=e,h=f,i++,d[0]=["M",e,f]);for(var k,l,j=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),m=i,n=a.length;n>m;m++){if(d.push(k=[]),l=a[m],l[0]!=U.call(l[0]))switch(k[0]=U.call(l[0]),k[0]){case"A":k[1]=l[1],k[2]=l[2],k[3]=l[3],k[4]=l[4],k[5]=l[5],k[6]=+(l[6]+e),k[7]=+(l[7]+f);break;case"V":k[1]=+l[1]+f;break;case"H":k[1]=+l[1]+e;break;case"R":for(var o=[e,f][p](l.slice(1)),q=2,r=o.length;r>q;q++)o[q]=+o[q]+e,o[++q]=+o[q]+f;d.pop(),d=d[p](Ab(o,j));break;case"M":g=+l[1]+e,h=+l[2]+f;default:for(q=1,r=l.length;r>q;q++)k[q]=+l[q]+(q%2?e:f)}else if("R"==l[0])o=[e,f][p](l.slice(1)),d.pop(),d=d[p](Ab(o,j)),k=["R"][p](l.slice(-2));else for(var s=0,t=l.length;t>s;s++)k[s]=l[s];switch(k[0]){case"Z":e=g,f=h;break;case"H":e=k[1];break;case"V":f=k[1];break;case"M":g=k[k.length-2],h=k[k.length-1];default:e=k[k.length-2],f=k[k.length-1]}}return d.toString=c._path2string,b.abs=Lb(d),d},Ob=function(a,b,c,d){return[a,b,c,d,c,d]},Pb=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},Qb=function(a,b,c,d,e,f,g,h,i,j){var n,k=120*D/180,l=D/180*(+e||0),m=[],o=xb(function(a,b,c){var d=a*y.cos(c)-b*y.sin(c),e=a*y.sin(c)+b*y.cos(c);return{x:d,y:e}});if(j)E=j[0],F=j[1],A=j[2],C=j[3];else{n=o(a,b,-l),a=n.x,b=n.y,n=o(h,i,-l),h=n.x,i=n.y;var s=(y.cos(D/180*e),y.sin(D/180*e),(a-h)/2),t=(b-i)/2,v=s*s/(c*c)+t*t/(d*d);v>1&&(v=y.sqrt(v),c=v*c,d=v*d);var w=c*c,x=d*d,z=(f==g?-1:1)*y.sqrt(B((w*x-w*t*t-x*s*s)/(w*t*t+x*s*s))),A=z*c*t/d+(a+h)/2,C=z*-d*s/c+(b+i)/2,E=y.asin(((b-C)/d).toFixed(9)),F=y.asin(((i-C)/d).toFixed(9));E=A>a?D-E:E,F=A>h?D-F:F,0>E&&(E=2*D+E),0>F&&(F=2*D+F),g&&E>F&&(E-=2*D),!g&&F>E&&(F-=2*D)}var G=F-E;if(B(G)>k){var H=F,I=h,J=i;F=E+k*(g&&F>E?1:-1),h=A+c*y.cos(F),i=C+d*y.sin(F),m=Qb(h,i,c,d,e,0,g,I,J,[F,H,A,C])}G=F-E;var K=y.cos(E),L=y.sin(E),M=y.cos(F),N=y.sin(F),O=y.tan(G/4),P=4/3*c*O,Q=4/3*d*O,R=[a,b],S=[a+P*L,b-Q*K],T=[h+P*N,i-Q*M],U=[h,i];if(S[0]=2*R[0]-S[0],S[1]=2*R[1]-S[1],j)return[S,T,U][p](m);m=[S,T,U][p](m).join()[u](",");for(var V=[],W=0,X=m.length;X>W;W++)V[W]=W%2?o(m[W-1],m[W],l).y:o(m[W],m[W+1],l).x;return V},Rb=function(a,b,c,d,e,f,g,h,i){var j=1-i;return{x:C(j,3)*a+3*C(j,2)*i*c+3*j*i*i*e+C(i,3)*g,y:C(j,3)*b+3*C(j,2)*i*d+3*j*i*i*f+C(i,3)*h}},Sb=xb(function(a,b,c,d,e,f,g,h){var q,i=e-2*c+a-(g-2*e+c),j=2*(c-a)-2*(e-c),k=a-c,l=(-j+y.sqrt(j*j-4*i*k))/2/i,m=(-j-y.sqrt(j*j-4*i*k))/2/i,n=[b,h],p=[a,g];return B(l)>"1e12"&&(l=.5),B(m)>"1e12"&&(m=.5),l>0&&1>l&&(q=Rb(a,b,c,d,e,f,g,h,l),p.push(q.x),n.push(q.y)),m>0&&1>m&&(q=Rb(a,b,c,d,e,f,g,h,m),p.push(q.x),n.push(q.y)),i=f-2*d+b-(h-2*f+d),j=2*(d-b)-2*(f-d),k=b-d,l=(-j+y.sqrt(j*j-4*i*k))/2/i,m=(-j-y.sqrt(j*j-4*i*k))/2/i,B(l)>"1e12"&&(l=.5),B(m)>"1e12"&&(m=.5),l>0&&1>l&&(q=Rb(a,b,c,d,e,f,g,h,l),p.push(q.x),n.push(q.y)),m>0&&1>m&&(q=Rb(a,b,c,d,e,f,g,h,m),p.push(q.x),n.push(q.y)),{min:{x:A[o](0,p),y:A[o](0,n)},max:{x:z[o](0,p),y:z[o](0,n)}}}),Tb=c._path2curve=xb(function(a,b){var c=!b&&Bb(a);if(!b&&c.curve)return Lb(c.curve);for(var d=Nb(a),e=b&&Nb(b),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=(function(a,b,c){var d,e;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null),a[0]){case"M":b.X=a[1],b.Y=a[2];break;case"A":a=["C"][p](Qb[o](0,[b.x,b.y][p](a.slice(1))));break;case"S":"C"==c||"S"==c?(d=2*b.x-b.bx,e=2*b.y-b.by):(d=b.x,e=b.y),a=["C",d,e][p](a.slice(1));break;case"T":"Q"==c||"T"==c?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y),a=["C"][p](Pb(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1],b.qy=a[2],a=["C"][p](Pb(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"][p](Ob(b.x,b.y,a[1],a[2]));break;case"H":a=["C"][p](Ob(b.x,b.y,a[1],b.y));break;case"V":a=["C"][p](Ob(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"][p](Ob(b.x,b.y,b.X,b.Y))}return a}),i=function(a,b){if(a[b].length>7){a[b].shift();for(var c=a[b];c.length;)a.splice(b++,0,["C"][p](c.splice(0,6)));a.splice(b,1),l=z(d.length,e&&e.length||0)}},j=function(a,b,c,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),c.bx=0,c.by=0,c.x=a[g][1],c.y=a[g][2],l=z(d.length,e&&e.length||0))},k=0,l=z(d.length,e&&e.length||0);l>k;k++){d[k]=h(d[k],f),i(d,k),e&&(e[k]=h(e[k],g)),e&&i(e,k),j(d,e,f,g,k),j(e,d,g,f,k);var m=d[k],n=e&&e[k],q=m.length,r=e&&n.length;f.x=m[q-2],f.y=m[q-1],f.bx=S(m[q-4])||f.x,f.by=S(m[q-3])||f.y,g.bx=e&&(S(n[r-4])||g.x),g.by=e&&(S(n[r-3])||g.y),g.x=e&&n[r-2],g.y=e&&n[r-1]}return e||(c.curve=Lb(d)),e?[d,e]:d},null,Lb),Vb=(c._parseDots=xb(function(a){for(var b=[],d=0,e=a.length;e>d;d++){var f={},g=a[d].match(/^([^:]*):?([\d\.]*)/);if(f.color=c.getRGB(g[1]),f.color.error)return null;f.color=f.color.hex,g[2]&&(f.offset=g[2]+"%"),b.push(f)}for(d=1,e=b.length-1;e>d;d++)if(!b[d].offset){for(var h=S(b[d-1].offset||0),i=0,j=d+1;e>j;j++)if(b[j].offset){i=b[j].offset;break}i||(i=100,j=e),i=S(i);for(var k=(i-h)/(j-d+1);j>d;d++)h+=k,b[d].offset=h+"%"}return b}),c._tear=function(a,b){a==b.top&&(b.top=a.prev),a==b.bottom&&(b.bottom=a.next),a.next&&(a.next.prev=a.prev),a.prev&&(a.prev.next=a.next)}),$b=(c._tofront=function(a,b){b.top!==a&&(Vb(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)},c._toback=function(a,b){b.bottom!==a&&(Vb(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)},c._insertafter=function(a,b,c){Vb(a,c),b==c.top&&(c.top=a),b.next&&(b.next.prev=a),a.next=b.next,a.prev=b,b.next=a},c._insertbefore=function(a,b,c){Vb(a,c),b==c.bottom&&(c.bottom=a),b.prev&&(b.prev.next=a),a.prev=b.prev,b.prev=a,a.next=b},c.toMatrix=function(a,b){var c=Kb(a),d={_:{transform:r},getBBox:function(){return c}};return ac(d,b),d.matrix}),ac=(c.transformPath=function(a,b){return lb(a,$b(a,b))},c._extractTransform=function(a,b){if(null==b)return a._.transform;b=t(b).replace(/\.{3}|\u2026/g,a._.transform||r);var d=c.parseTransformString(b),e=0,f=0,g=0,h=1,i=1,j=a._,k=new dc;if(j.transform=d||[],d)for(var l=0,m=d.length;m>l;l++){var u,v,w,x,y,n=d[l],o=n.length,p=t(n[0]).toLowerCase(),q=n[0]!=p,s=q?k.invert():0;"t"==p&&3==o?q?(u=s.x(0,0),v=s.y(0,0),w=s.x(n[1],n[2]),x=s.y(n[1],n[2]),k.translate(w-u,x-v)):k.translate(n[1],n[2]):"r"==p?2==o?(y=y||a.getBBox(1),k.rotate(n[1],y.x+y.width/2,y.y+y.height/2),e+=n[1]):4==o&&(q?(w=s.x(n[2],n[3]),x=s.y(n[2],n[3]),k.rotate(n[1],w,x)):k.rotate(n[1],n[2],n[3]),e+=n[1]):"s"==p?2==o||3==o?(y=y||a.getBBox(1),k.scale(n[1],n[o-1],y.x+y.width/2,y.y+y.height/2),h*=n[1],i*=n[o-1]):5==o&&(q?(w=s.x(n[3],n[4]),x=s.y(n[3],n[4]),k.scale(n[1],n[2],w,x)):k.scale(n[1],n[2],n[3],n[4]),h*=n[1],i*=n[2]):"m"==p&&7==o&&k.add(n[1],n[2],n[3],n[4],n[5],n[6]),j.dirtyT=1,a.matrix=k}a.matrix=k,j.sx=h,j.sy=i,j.deg=e,j.dx=f=k.e,j.dy=g=k.f,1==h&&1==i&&!e&&j.bbox?(j.bbox.x+=+f,j.bbox.y+=+g):j.dirtyT=1}),bc=function(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},cc=c._equaliseTransform=function(a,b){b=t(b).replace(/\.{3}|\u2026/g,a),a=c.parseTransformString(a)||[],b=c.parseTransformString(b)||[];for(var h,i,j,k,d=z(a.length,b.length),e=[],f=[],g=0;d>g;g++){if(j=a[g]||bc(b[g]),k=b[g]||bc(j),j[0]!=k[0]||"r"==j[0].toLowerCase()&&(j[2]!=k[2]||j[3]!=k[3])||"s"==j[0].toLowerCase()&&(j[3]!=k[3]||j[4]!=k[4]))return;for(e[g]=[],f[g]=[],h=0,i=z(j.length,k.length);i>h;h++)h in j&&(e[g][h]=j[h]),h in k&&(f[g][h]=k[h])}return{from:e,to:f}};c._getContainer=function(a,b,d,e){var f;
  return f=null!=e||c.is(a,"object")?a:j.doc.getElementById(a),null!=f?f.tagName?null==b?{container:f,width:f.style.pixelWidth||f.offsetWidth,height:f.style.pixelHeight||f.offsetHeight}:{container:f,width:b,height:d}:{container:1,x:a,y:b,width:d,height:e}:void 0},c.pathToRelative=Mb,c._engine={},c.path2curve=Tb,c.matrix=function(a,b,c,d,e,f){return new dc(a,b,c,d,e,f)},function(a){function b(a){return a[0]*a[0]+a[1]*a[1]}function d(a){var c=y.sqrt(b(a));a[0]&&(a[0]/=c),a[1]&&(a[1]/=c)}a.add=function(a,b,c,d,e,f){var j,k,l,m,g=[[],[],[]],h=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],i=[[a,c,e],[b,d,f],[0,0,1]];for(a&&a instanceof dc&&(i=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),j=0;3>j;j++)for(k=0;3>k;k++){for(m=0,l=0;3>l;l++)m+=h[j][l]*i[l][k];g[j][k]=m}this.a=g[0][0],this.b=g[1][0],this.c=g[0][1],this.d=g[1][1],this.e=g[0][2],this.f=g[1][2]},a.invert=function(){var a=this,b=a.a*a.d-a.b*a.c;return new dc(a.d/b,-a.b/b,-a.c/b,a.a/b,(a.c*a.f-a.d*a.e)/b,(a.b*a.e-a.a*a.f)/b)},a.clone=function(){return new dc(this.a,this.b,this.c,this.d,this.e,this.f)},a.translate=function(a,b){this.add(1,0,0,1,a,b)},a.scale=function(a,b,c,d){null==b&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d)},a.rotate=function(a,b,d){a=c.rad(a),b=b||0,d=d||0;var e=+y.cos(a).toFixed(9),f=+y.sin(a).toFixed(9);this.add(e,f,-f,e,b,d),this.add(1,0,0,1,-b,-d)},a.x=function(a,b){return a*this.a+b*this.c+this.e},a.y=function(a,b){return a*this.b+b*this.d+this.f},a.get=function(a){return+this[t.fromCharCode(97+a)].toFixed(4)},a.toString=function(){return c.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},a.split=function(){var a={};a.dx=this.e,a.dy=this.f;var e=[[this.a,this.c],[this.b,this.d]];a.scalex=y.sqrt(b(e[0])),d(e[0]),a.shear=e[0][0]*e[1][0]+e[0][1]*e[1][1],e[1]=[e[1][0]-e[0][0]*a.shear,e[1][1]-e[0][1]*a.shear],a.scaley=y.sqrt(b(e[1])),d(e[1]),a.shear/=a.scaley;var f=-e[0][1],g=e[1][1];return 0>g?(a.rotate=c.deg(y.acos(g)),0>f&&(a.rotate=360-a.rotate)):a.rotate=c.deg(y.asin(f)),a.isSimple=!(+a.shear.toFixed(9)||a.scalex.toFixed(9)!=a.scaley.toFixed(9)&&a.rotate),a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate,a.noRotation=!+a.shear.toFixed(9)&&!a.rotate,a},a.toTransformString=function(a){var b=a||this[u]();return b.isSimple?(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[b.dx,b.dy]:r)+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:r)+(b.rotate?"r"+[b.rotate,0,0]:r)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(dc.prototype);var ec=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);m.safari="Apple Computer, Inc."==navigator.vendor&&(ec&&ec[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&ec&&ec[1]<8?function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:gb;for(var fc=function(){this.returnValue=!1},gc=function(){return this.originalEvent.preventDefault()},hc=function(){this.cancelBubble=!0},ic=function(){return this.originalEvent.stopPropagation()},jc=function(a){var b=j.doc.documentElement.scrollTop||j.doc.body.scrollTop,c=j.doc.documentElement.scrollLeft||j.doc.body.scrollLeft;return{x:a.clientX+c,y:a.clientY+b}},kc=function(){return j.doc.addEventListener?function(a,b,c,d){var e=function(a){var b=jc(a);return c.call(d,a,b.x,b.y)};if(a.addEventListener(b,e,!1),q&&w[b]){var f=function(b){for(var e=jc(b),f=b,g=0,h=b.targetTouches&&b.targetTouches.length;h>g;g++)if(b.targetTouches[g].target==a){b=b.targetTouches[g],b.originalEvent=f,b.preventDefault=gc,b.stopPropagation=ic;break}return c.call(d,b,e.x,e.y)};a.addEventListener(w[b],f,!1)}return function(){return a.removeEventListener(b,e,!1),q&&w[b]&&a.removeEventListener(w[b],e,!1),!0}}:j.doc.attachEvent?function(a,b,c,d){var e=function(a){a=a||j.win.event;var b=j.doc.documentElement.scrollTop||j.doc.body.scrollTop,e=j.doc.documentElement.scrollLeft||j.doc.body.scrollLeft,f=a.clientX+e,g=a.clientY+b;return a.preventDefault=a.preventDefault||fc,a.stopPropagation=a.stopPropagation||hc,c.call(d,a,f,g)};a.attachEvent("on"+b,e);var f=function(){return a.detachEvent("on"+b,e),!0};return f}:void 0}(),lc=[],mc=function(a){for(var g,c=a.clientX,d=a.clientY,e=j.doc.documentElement.scrollTop||j.doc.body.scrollTop,f=j.doc.documentElement.scrollLeft||j.doc.body.scrollLeft,h=lc.length;h--;){if(g=lc[h],q&&a.touches){for(var k,i=a.touches.length;i--;)if(k=a.touches[i],k.identifier==g.el._drag.id){c=k.clientX,d=k.clientY,(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var m,l=g.el.node,n=l.nextSibling,o=l.parentNode,p=l.style.display;j.win.opera&&o.removeChild(l),l.style.display="none",m=g.el.paper.getElementByPoint(c,d),l.style.display=p,j.win.opera&&(n?o.insertBefore(l,n):o.appendChild(l)),m&&b("raphael.drag.over."+g.el.id,g.el,m),c+=f,d+=e,b("raphael.drag.move."+g.el.id,g.move_scope||g.el,c-g.el._drag.x,d-g.el._drag.y,c,d,a)}},nc=function(a){c.unmousemove(mc).unmouseup(nc);for(var e,d=lc.length;d--;)e=lc[d],e.el._drag={},b("raphael.drag.end."+e.el.id,e.end_scope||e.start_scope||e.move_scope||e.el,a);lc=[]},oc=c.el={},pc=v.length;pc--;)!function(a){c[a]=oc[a]=function(b,d){return c.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:kc(this.shape||this.node||j.doc,a,b,d||this)})),this},c["un"+a]=oc["un"+a]=function(b){for(var d=this.events||[],e=d.length;e--;)d[e].name!=a||!c.is(b,"undefined")&&d[e].f!=b||(d[e].unbind(),d.splice(e,1),!d.length&&delete this.events);return this}}(v[pc]);oc.data=function(a,d){var e=db[this.id]=db[this.id]||{};if(0==arguments.length)return e;if(1==arguments.length){if(c.is(a,"object")){for(var f in a)a[i](f)&&this.data(f,a[f]);return this}return b("raphael.data.get."+this.id,this,e[a],a),e[a]}return e[a]=d,b("raphael.data.set."+this.id,this,d,a),this},oc.removeData=function(a){return null==a?db[this.id]={}:db[this.id]&&delete db[this.id][a],this},oc.getData=function(){return ob(db[this.id]||{})},oc.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)},oc.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var qc=[];oc.drag=function(a,d,e,f,g,h){function i(i){(i.originalEvent||i).preventDefault();var k=i.clientX,l=i.clientY,m=j.doc.documentElement.scrollTop||j.doc.body.scrollTop,n=j.doc.documentElement.scrollLeft||j.doc.body.scrollLeft;if(this._drag.id=i.identifier,q&&i.touches)for(var p,o=i.touches.length;o--;)if(p=i.touches[o],this._drag.id=p.identifier,p.identifier==this._drag.id){k=p.clientX,l=p.clientY;break}this._drag.x=k+n,this._drag.y=l+m,!lc.length&&c.mousemove(mc).mouseup(nc),lc.push({el:this,move_scope:f,start_scope:g,end_scope:h}),d&&b.on("raphael.drag.start."+this.id,d),a&&b.on("raphael.drag.move."+this.id,a),e&&b.on("raphael.drag.end."+this.id,e),b("raphael.drag.start."+this.id,g||f||this,i.clientX+n,i.clientY+m,i)}return this._drag={},qc.push({el:this,start:i}),this.mousedown(i),this},oc.onDragOver=function(a){a?b.on("raphael.drag.over."+this.id,a):b.unbind("raphael.drag.over."+this.id)},oc.undrag=function(){for(var a=qc.length;a--;)qc[a].el==this&&(this.unmousedown(qc[a].start),qc.splice(a,1),b.unbind("raphael.drag.*."+this.id));!qc.length&&c.unmousemove(mc).unmouseup(nc),lc=[]},m.circle=function(a,b,d){var e=c._engine.circle(this,a||0,b||0,d||0);return this.__set__&&this.__set__.push(e),e},m.rect=function(a,b,d,e,f){var g=c._engine.rect(this,a||0,b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},m.ellipse=function(a,b,d,e){var f=c._engine.ellipse(this,a||0,b||0,d||0,e||0);return this.__set__&&this.__set__.push(f),f},m.path=function(a){a&&!c.is(a,F)&&!c.is(a[0],G)&&(a+=r);var b=c._engine.path(c.format[o](c,arguments),this);return this.__set__&&this.__set__.push(b),b},m.image=function(a,b,d,e,f){var g=c._engine.image(this,a||"about:blank",b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},m.text=function(a,b,d){var e=c._engine.text(this,a||0,b||0,t(d));return this.__set__&&this.__set__.push(e),e},m.set=function(a){!c.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new Jc(a);return this.__set__&&this.__set__.push(b),b.paper=this,b.type="set",b},m.setStart=function(a){this.__set__=a||this.set()},m.setFinish=function(){var b=this.__set__;return delete this.__set__,b},m.setSize=function(a,b){return c._engine.setSize.call(this,a,b)},m.setViewBox=function(a,b,d,e,f){return c._engine.setViewBox.call(this,a,b,d,e,f)},m.top=m.bottom=null,m.raphael=c;var rc=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=b.top+(j.win.pageYOffset||e.scrollTop||d.scrollTop)-f,i=b.left+(j.win.pageXOffset||e.scrollLeft||d.scrollLeft)-g;return{y:h,x:i}};m.getElementByPoint=function(a,b){var c=this,d=c.canvas,e=j.doc.elementFromPoint(a,b);if(j.win.opera&&"svg"==e.tagName){var f=rc(d),g=d.createSVGRect();g.x=a-f.x,g.y=b-f.y,g.width=g.height=1;var h=d.getIntersectionList(g,null);h.length&&(e=h[h.length-1])}if(!e)return null;for(;e.parentNode&&e!=d.parentNode&&!e.raphael;)e=e.parentNode;return e==c.canvas.parentNode&&(e=d),e=e&&e.raphael?c.getById(e.raphaelid):null},m.getElementsByBBox=function(a){var b=this.set();return this.forEach(function(d){c.isBBoxIntersect(d.getBBox(),a)&&b.push(d)}),b},m.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null},m.forEach=function(a,b){for(var c=this.bottom;c;){if(a.call(b,c)===!1)return this;c=c.next}return this},m.getElementsByPoint=function(a,b){var c=this.set();return this.forEach(function(d){d.isPointInside(a,b)&&c.push(d)}),c},oc.isPointInside=function(a,b){var d=this.realPath=kb[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(d=c.transformPath(d,this.attr("transform"))),c.isPointInsidePath(d,a,b)},oc.getBBox=function(a){if(this.removed)return{};var b=this._;return a?((b.dirty||!b.bboxwt)&&(this.realPath=kb[this.type](this),b.bboxwt=Kb(this.realPath),b.bboxwt.toString=tc,b.dirty=0),b.bboxwt):((b.dirty||b.dirtyT||!b.bbox)&&((b.dirty||!this.realPath)&&(b.bboxwt=0,this.realPath=kb[this.type](this)),b.bbox=Kb(lb(this.realPath,this.matrix)),b.bbox.toString=tc,b.dirty=b.dirtyT=0),b.bbox)},oc.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(a),a},oc.glow=function(a){if("text"==this.type)return null;a=a||{};var b={width:(a.width||10)+(+this.attr("stroke-width")||1),fill:a.fill||!1,opacity:a.opacity||.5,offsetx:a.offsetx||0,offsety:a.offsety||0,color:a.color||"#000"},c=b.width/2,d=this.paper,e=d.set(),f=this.realPath||kb[this.type](this);f=this.matrix?lb(f,this.matrix):f;for(var g=1;c+1>g;g++)e.push(d.path(f).attr({stroke:b.color,fill:b.fill?b.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b.width/c*g).toFixed(3),opacity:+(b.opacity/c).toFixed(3)}));return e.insertBefore(this).translate(b.offsetx,b.offsety)};var vc=function(a,b,d,e,f,g,h,i,j){return null==j?Db(a,b,d,e,f,g,h,i):c.findDotsAtSegment(a,b,d,e,f,g,h,i,Eb(a,b,d,e,f,g,h,i,j))},wc=function(a,b){return function(d,e,f){d=Tb(d);for(var g,h,i,j,m,k="",l={},n=0,o=0,p=d.length;p>o;o++){if(i=d[o],"M"==i[0])g=+i[1],h=+i[2];else{if(j=vc(g,h,i[1],i[2],i[3],i[4],i[5],i[6]),n+j>e){if(b&&!l.start){if(m=vc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),k+=["C"+m.start.x,m.start.y,m.m.x,m.m.y,m.x,m.y],f)return k;l.start=k,k=["M"+m.x,m.y+"C"+m.n.x,m.n.y,m.end.x,m.end.y,i[5],i[6]].join(),n+=j,g=+i[5],h=+i[6];continue}if(!a&&!b)return m=vc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),{x:m.x,y:m.y,alpha:m.alpha}}n+=j,g=+i[5],h=+i[6]}k+=i.shift()+i}return l.end=k,m=a?n:b?l:c.findDotsAtSegment(g,h,i[0],i[1],i[2],i[3],i[4],i[5],1),m.alpha&&(m={x:m.x,y:m.y,alpha:m.alpha}),m}},xc=wc(1),yc=wc(),zc=wc(0,1);c.getTotalLength=xc,c.getPointAtLength=yc,c.getSubpath=function(a,b,c){if(this.getTotalLength(a)-c<1e-6)return zc(a,b).end;var d=zc(a,c,1);return b?zc(d,b).end:d},oc.getTotalLength=function(){var a=this.getPath();if(a)return this.node.getTotalLength?this.node.getTotalLength():xc(a)},oc.getPointAtLength=function(a){var b=this.getPath();if(b)return yc(b,a)},oc.getPath=function(){var a,b=c._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return b&&(a=b(this)),a},oc.getSubpath=function(a,b){var d=this.getPath();if(d)return c.getSubpath(d,a,b)};var Ac=c.easing_formulas={linear:function(a){return a},"<":function(a){return C(a,1.7)},">":function(a){return C(a,.48)},"<>":function(a){var b=.48-a/1.04,c=y.sqrt(.1734+b*b),d=c-b,e=C(B(d),1/3)*(0>d?-1:1),f=-c-b,g=C(B(f),1/3)*(0>f?-1:1),h=e+g+.5;return 3*(1-h)*h*h+h*h*h},backIn:function(a){var b=1.70158;return a*a*((b+1)*a-b)},backOut:function(a){a-=1;var b=1.70158;return a*a*((b+1)*a+b)+1},elastic:function(a){return a==!!a?a:C(2,-10*a)*y.sin((a-.075)*2*D/.3)+1},bounce:function(a){var d,b=7.5625,c=2.75;return 1/c>a?d=b*a*a:2/c>a?(a-=1.5/c,d=b*a*a+.75):2.5/c>a?(a-=2.25/c,d=b*a*a+.9375):(a-=2.625/c,d=b*a*a+.984375),d}};Ac.easeIn=Ac["ease-in"]=Ac["<"],Ac.easeOut=Ac["ease-out"]=Ac[">"],Ac.easeInOut=Ac["ease-in-out"]=Ac["<>"],Ac["back-in"]=Ac.backIn,Ac["back-out"]=Ac.backOut;var Bc=[],Cc=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,16)},Dc=function(){for(var a=+new Date,d=0;d<Bc.length;d++){var e=Bc[d];if(!e.el.removed&&!e.paused){var q,t,f=a-e.start,g=e.ms,h=e.easing,j=e.from,k=e.diff,l=e.to,n=(e.t,e.el),o={},r={};if(e.initstatus?(f=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*g,e.status=e.initstatus,delete e.initstatus,e.stop&&Bc.splice(d--,1)):e.status=(e.prev+(e.percent-e.prev)*(f/g))/e.anim.top,!(0>f))if(g>f){var u=h(f/g);for(var v in j)if(j[i](v)){switch(W[v]){case E:q=+j[v]+u*g*k[v];break;case"colour":q="rgb("+[Ec(Q(j[v].r+u*g*k[v].r)),Ec(Q(j[v].g+u*g*k[v].g)),Ec(Q(j[v].b+u*g*k[v].b))].join(",")+")";break;case"path":q=[];for(var w=0,x=j[v].length;x>w;w++){q[w]=[j[v][w][0]];for(var y=1,z=j[v][w].length;z>y;y++)q[w][y]=+j[v][w][y]+u*g*k[v][w][y];q[w]=q[w].join(s)}q=q.join(s);break;case"transform":if(k[v].real)for(q=[],w=0,x=j[v].length;x>w;w++)for(q[w]=[j[v][w][0]],y=1,z=j[v][w].length;z>y;y++)q[w][y]=j[v][w][y]+u*g*k[v][w][y];else{var A=function(a){return+j[v][a]+u*g*k[v][a]};q=[["m",A(0),A(1),A(2),A(3),A(4),A(5)]]}break;case"csv":if("clip-rect"==v)for(q=[],w=4;w--;)q[w]=+j[v][w]+u*g*k[v][w];break;default:var B=[][p](j[v]);for(q=[],w=n.paper.customAttributes[v].length;w--;)q[w]=+B[w]+u*g*k[v][w]}o[v]=q}n.attr(o),function(a,c,d){setTimeout(function(){b("raphael.anim.frame."+a,c,d)})}(n.id,n,e.anim)}else{if(function(a,d,e){setTimeout(function(){b("raphael.anim.frame."+d.id,d,e),b("raphael.anim.finish."+d.id,d,e),c.is(a,"function")&&a.call(d)})}(e.callback,n,e.anim),n.attr(l),Bc.splice(d--,1),e.repeat>1&&!e.next){for(t in l)l[i](t)&&(r[t]=e.totalOrigin[t]);e.el.attr(r),Hc(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1)}e.next&&!e.stop&&Hc(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat)}}}c.svg&&n&&n.paper&&n.paper.safari(),Bc.length&&Cc(Dc)},Ec=function(a){return a>255?255:0>a?0:a};oc.animateWith=function(a,b,d,e,f,g){var h=this;if(h.removed)return g&&g.call(h),h;var i=d instanceof Gc?d:c.animation(d,e,f,g);Hc(i,h,i.percents[0],null,h.attr());for(var l=0,m=Bc.length;m>l;l++)if(Bc[l].anim==b&&Bc[l].el==a){Bc[m-1].start=Bc[l].start;break}return h},oc.onAnimation=function(a){return a?b.on("raphael.anim.frame."+this.id,a):b.unbind("raphael.anim.frame."+this.id),this},Gc.prototype.delay=function(a){var b=new Gc(this.anim,this.ms);return b.times=this.times,b.del=+a||0,b},Gc.prototype.repeat=function(a){var b=new Gc(this.anim,this.ms);return b.del=this.del,b.times=y.floor(z(a,0))||1,b},c.animation=function(a,b,d,e){if(a instanceof Gc)return a;(c.is(d,"function")||!d)&&(e=e||d||null,d=null),a=Object(a),b=+b||0;var g,h,f={};for(h in a)a[i](h)&&S(h)!=h&&S(h)+"%"!=h&&(g=!0,f[h]=a[h]);return g?(d&&(f.easing=d),e&&(f.callback=e),new Gc({100:f},b)):new Gc(a,b)},oc.animate=function(a,b,d,e){var f=this;if(f.removed)return e&&e.call(f),f;var g=a instanceof Gc?a:c.animation(a,b,d,e);return Hc(g,f,g.percents[0],null,f.attr()),f},oc.setTime=function(a,b){return a&&null!=b&&this.status(a,A(b,a.ms)/a.ms),this},oc.status=function(a,b){var e,f,c=[],d=0;if(null!=b)return Hc(a,this,-1,A(b,1)),this;for(e=Bc.length;e>d;d++)if(f=Bc[d],f.el.id==this.id&&(!a||f.anim==a)){if(a)return f.status;c.push({anim:f.anim,status:f.status})}return a?0:c},oc.pause=function(a){for(var c=0;c<Bc.length;c++)Bc[c].el.id!=this.id||a&&Bc[c].anim!=a||b("raphael.anim.pause."+this.id,this,Bc[c].anim)!==!1&&(Bc[c].paused=!0);return this},oc.resume=function(a){for(var c=0;c<Bc.length;c++)if(Bc[c].el.id==this.id&&(!a||Bc[c].anim==a)){var d=Bc[c];b("raphael.anim.resume."+this.id,this,d.anim)!==!1&&(delete d.paused,this.status(d.anim,d.status))}return this},oc.stop=function(a){for(var c=0;c<Bc.length;c++)Bc[c].el.id!=this.id||a&&Bc[c].anim!=a||b("raphael.anim.stop."+this.id,this,Bc[c].anim)!==!1&&Bc.splice(c--,1);return this},b.on("raphael.remove",Ic),b.on("raphael.clear",Ic),oc.toString=function(){return"Rapha\xebl\u2019s object"};var Jc=function(a){if(this.items=[],this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)!a[b]||a[b].constructor!=oc.constructor&&a[b].constructor!=Jc||(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},Kc=Jc.prototype;Kc.push=function(){for(var a,b,c=0,d=arguments.length;d>c;c++)a=arguments[c],!a||a.constructor!=oc.constructor&&a.constructor!=Jc||(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this},Kc.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},Kc.forEach=function(a,b){for(var c=0,d=this.items.length;d>c;c++)if(a.call(b,this.items[c],c)===!1)return this;return this};for(var Lc in oc)oc[i](Lc)&&(Kc[Lc]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][o](c,b)})}}(Lc));return Kc.attr=function(a,b){if(a&&c.is(a,G)&&c.is(a[0],"object"))for(var d=0,e=a.length;e>d;d++)this.items[d].attr(a[d]);else for(var f=0,g=this.items.length;g>f;f++)this.items[f].attr(a,b);return this},Kc.clear=function(){for(;this.length;)this.pop()},Kc.splice=function(a,b){a=0>a?z(this.length+a,0):a,b=z(0,A(this.length-a,b));var g,d=[],e=[],f=[];for(g=2;g<arguments.length;g++)f.push(arguments[g]);for(g=0;b>g;g++)e.push(this[a+g]);for(;g<this.length-a;g++)d.push(this[a+g]);var h=f.length;for(g=0;g<h+d.length;g++)this.items[a+g]=this[a+g]=h>g?f[g]:d[g-h];for(g=this.items.length=this.length-=b-h;this[g];)delete this[g++];return new Jc(e)},Kc.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0},Kc.animate=function(a,b,d,e){(c.is(d,"function")||!d)&&(e=d||null);var h,j,f=this.items.length,g=f,i=this;if(!f)return this;e&&(j=function(){!--f&&e.call(i)}),d=c.is(d,F)?d:j;var k=c.animation(a,b,d,j);for(h=this.items[--g].animate(k);g--;)this.items[g]&&!this.items[g].removed&&this.items[g].animateWith(h,k,k),this.items[g]&&!this.items[g].removed||f--;return this},Kc.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},Kc.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=this.items[e].getBBox();a.push(f.x),b.push(f.y),c.push(f.x+f.width),d.push(f.y+f.height)}return a=A[o](0,a),b=A[o](0,b),c=z[o](0,c),d=z[o](0,d),{x:a,y:b,x2:c,y2:d,width:c-a,height:d-b}},Kc.clone=function(a){a=this.paper.set();for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a},Kc.toString=function(){return"Rapha\xebl\u2018s set"},Kc.glow=function(a){var b=this.paper.set();return this.forEach(function(c){var e=c.glow(a);null!=e&&e.forEach(function(a){b.push(a)})}),b},Kc.isPointInside=function(a,b){var c=!1;return this.forEach(function(d){return d.isPointInside(a,b)?(console.log("runned"),c=!0,!1):void 0}),c},c.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"];for(var d in a.face)a.face[i](d)&&(b.face[d]=a.face[d]);if(this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b],!a.svg){b.face["units-per-em"]=T(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[i](e)){var f=a.glyphs[e];if(b.glyphs[e]={w:f.w,k:{},d:f.d&&"M"+f.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},f.k)for(var g in f.k)f[i](g)&&(b.glyphs[e].k[g]=f.k[g])}}return a},m.getFont=function(a,b,d,e){if(e=e||"normal",d=d||"normal",b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400,c.fonts){var f=c.fonts[a];if(!f){var g=new RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,r)+"(\\s|$)","i");for(var h in c.fonts)if(c.fonts[i](h)&&g.test(h)){f=c.fonts[h];break}}var j;if(f)for(var k=0,l=f.length;l>k&&(j=f[k],j.face["font-weight"]!=b||j.face["font-style"]!=d&&j.face["font-style"]||j.face["font-stretch"]!=e);k++);return j}},m.print=function(a,b,d,f,g,h,i,j){h=h||"middle",i=z(A(i||0,1),-1),j=z(A(j||1,3),1);var o,k=t(d)[u](r),l=0,m=0,n=r;if(c.is(f,"string")&&(f=this.getFont(f)),f){o=(g||16)/f.face["units-per-em"];for(var p=f.face.bbox[u](e),q=+p[0],s=p[3]-p[1],v=0,w=+p[1]+("baseline"==h?s+ +f.face.descent:s/2),x=0,y=k.length;y>x;x++){if("\n"==k[x])l=0,C=0,m=0,v+=s*j;else{var B=m&&f.glyphs[k[x-1]]||{},C=f.glyphs[k[x]];l+=m?(B.w||f.w)+(B.k&&B.k[k[x]]||0)+f.w*i:0,m=1}C&&C.d&&(n+=c.transformPath(C.d,["t",l*o,v*o,"s",o,o,q,w,"t",(a-q)/o,(b-w)/o]))}}return this.path(n).attr({fill:"#000",stroke:"none"})},m.add=function(a){if(c.is(a,"array"))for(var g,b=this.set(),d=0,e=a.length;e>d;d++)g=a[d]||{},f[i](g.type)&&b.push(this[g.type]().attr(g));return b},c.format=function(a,b){var d=c.is(b,G)?[0][p](b):arguments;return a&&c.is(a,F)&&d.length-1&&(a=a.replace(g,function(a,b){return null==d[++b]?r:d[b]})),a||r},c.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})}}(),c.ninja=function(){return k.was?j.win.Raphael=k.is:delete Raphael,c},c.st=Kc,function(a,b,d){function e(){/in/.test(a.readyState)?setTimeout(e,9):c.eve("raphael.DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,d=function(){a.removeEventListener(b,d,!1),a.readyState="complete"},!1),a.readyState="loading"),e()}(document,"DOMContentLoaded"),b.on("raphael.DOMload",function(){d=!0}),function(){if(c.svg){var a="hasOwnProperty",b=String,d=parseFloat,e=parseInt,f=Math,g=f.max,h=f.abs,i=f.pow,j=/[, ]+/,k=c.eve,l="",m=" ",n="http://www.w3.org/1999/xlink",o={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},p={};c.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version};var q=function(d,e){if(e){"string"==typeof d&&(d=q(d));for(var f in e)e[a](f)&&("xlink:"==f.substring(0,6)?d.setAttributeNS(n,f.substring(6),b(e[f])):d.setAttribute(f,b(e[f])))}else d=c._g.doc.createElementNS("http://www.w3.org/2000/svg",d),d.style&&(d.style.webkitTapHighlightColor="rgba(0,0,0,0)");return d},r=function(a,e){var j="linear",k=a.id+e,m=.5,n=.5,o=a.node,p=a.paper,r=o.style,s=c._g.doc.getElementById(k);if(!s){if(e=b(e).replace(c._radial_gradient,function(a,b,c){if(j="radial",b&&c){m=d(b),n=d(c);var e=2*(n>.5)-1;i(m-.5,2)+i(n-.5,2)>.25&&(n=f.sqrt(.25-i(m-.5,2))*e+.5)&&.5!=n&&(n=n.toFixed(5)-1e-5*e)}return l}),e=e.split(/\s*\-\s*/),"linear"==j){var t=e.shift();if(t=-d(t),isNaN(t))return null;var u=[0,0,f.cos(c.rad(t)),f.sin(c.rad(t))],v=1/(g(h(u[2]),h(u[3]))||1);u[2]*=v,u[3]*=v,u[2]<0&&(u[0]=-u[2],u[2]=0),u[3]<0&&(u[1]=-u[3],u[3]=0)}var w=c._parseDots(e);if(!w)return null;if(k=k.replace(/[\(\)\s,\xb0#]/g,"_"),a.gradient&&k!=a.gradient.id&&(p.defs.removeChild(a.gradient),delete a.gradient),!a.gradient){s=q(j+"Gradient",{id:k}),a.gradient=s,q(s,"radial"==j?{fx:m,fy:n}:{x1:u[0],y1:u[1],x2:u[2],y2:u[3],gradientTransform:a.matrix.invert()}),p.defs.appendChild(s);for(var x=0,y=w.length;y>x;x++)s.appendChild(q("stop",{offset:w[x].offset?w[x].offset:x?"100%":"0%","stop-color":w[x].color||"#fff"}))}}return q(o,{fill:"url(#"+k+")",opacity:1,"fill-opacity":1}),r.fill=l,r.opacity=1,r.fillOpacity=1,1},s=function(a){var b=a.getBBox(1);q(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},t=function(d,e,f){if("path"==d.type){for(var s,t,u,v,w,g=b(e).toLowerCase().split("-"),h=d.paper,i=f?"end":"start",j=d.node,k=d.attrs,m=k["stroke-width"],n=g.length,r="classic",x=3,y=3,z=5;n--;)switch(g[n]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":r=g[n];break;case"wide":y=5;break;case"narrow":y=2;break;case"long":x=5;break;case"short":x=2}if("open"==r?(x+=2,y+=2,z+=2,u=1,v=f?4:1,w={fill:"none",stroke:k.stroke}):(v=u=x/2,w={fill:k.stroke,stroke:"none"}),d._.arrows?f?(d._.arrows.endPath&&p[d._.arrows.endPath]--,d._.arrows.endMarker&&p[d._.arrows.endMarker]--):(d._.arrows.startPath&&p[d._.arrows.startPath]--,d._.arrows.startMarker&&p[d._.arrows.startMarker]--):d._.arrows={},"none"!=r){var A="raphael-marker-"+r,B="raphael-marker-"+i+r+x+y;c._g.doc.getElementById(A)?p[A]++:(h.defs.appendChild(q(q("path"),{"stroke-linecap":"round",d:o[r],id:A})),p[A]=1);var D,C=c._g.doc.getElementById(B);C?(p[B]++,D=C.getElementsByTagName("use")[0]):(C=q(q("marker"),{id:B,markerHeight:y,markerWidth:x,orient:"auto",refX:v,refY:y/2}),D=q(q("use"),{"xlink:href":"#"+A,transform:(f?"rotate(180 "+x/2+" "+y/2+") ":l)+"scale("+x/z+","+y/z+")","stroke-width":(1/((x/z+y/z)/2)).toFixed(4)}),C.appendChild(D),h.defs.appendChild(C),p[B]=1),q(D,w);var E=u*("diamond"!=r&&"oval"!=r);f?(s=d._.arrows.startdx*m||0,t=c.getTotalLength(k.path)-E*m):(s=E*m,t=c.getTotalLength(k.path)-(d._.arrows.enddx*m||0)),w={},w["marker-"+i]="url(#"+B+")",(t||s)&&(w.d=c.getSubpath(k.path,s,t)),q(j,w),d._.arrows[i+"Path"]=A,d._.arrows[i+"Marker"]=B,d._.arrows[i+"dx"]=E,d._.arrows[i+"Type"]=r,d._.arrows[i+"String"]=e}else f?(s=d._.arrows.startdx*m||0,t=c.getTotalLength(k.path)-s):(s=0,t=c.getTotalLength(k.path)-(d._.arrows.enddx*m||0)),d._.arrows[i+"Path"]&&q(j,{d:c.getSubpath(k.path,s,t)}),delete d._.arrows[i+"Path"],delete d._.arrows[i+"Marker"],delete d._.arrows[i+"dx"],delete d._.arrows[i+"Type"],delete d._.arrows[i+"String"];for(w in p)if(p[a](w)&&!p[w]){var F=c._g.doc.getElementById(w);F&&F.parentNode.removeChild(F)}}},u={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},v=function(a,c,d){if(c=u[b(c).toLowerCase()]){for(var e=a.attrs["stroke-width"]||"1",f={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,g=[],h=c.length;h--;)g[h]=c[h]*e+(h%2?1:-1)*f;q(a.node,{"stroke-dasharray":g.join(",")})}},w=function(d,f){var i=d.node,k=d.attrs,m=i.style.visibility;i.style.visibility="hidden";for(var o in f)if(f[a](o)){if(!c._availableAttrs[a](o))continue;var p=f[o];switch(k[o]=p,o){case"blur":d.blur(p);break;case"href":case"title":var u=q("title"),w=c._g.doc.createTextNode(p);u.appendChild(w),i.appendChild(u);break;case"target":var x=i.parentNode;if("a"!=x.tagName.toLowerCase()){var u=q("a");x.insertBefore(u,i),u.appendChild(i),x=u}"target"==o?x.setAttributeNS(n,"show","blank"==p?"new":p):x.setAttributeNS(n,o,p);break;case"cursor":i.style.cursor=p;break;case"transform":d.transform(p);break;case"arrow-start":t(d,p);break;case"arrow-end":t(d,p,1);break;case"clip-rect":var z=b(p).split(j);if(4==z.length){d.clip&&d.clip.parentNode.parentNode.removeChild(d.clip.parentNode);var A=q("clipPath"),B=q("rect");A.id=c.createUUID(),q(B,{x:z[0],y:z[1],width:z[2],height:z[3]}),A.appendChild(B),d.paper.defs.appendChild(A),q(i,{"clip-path":"url(#"+A.id+")"}),d.clip=B}if(!p){var C=i.getAttribute("clip-path");if(C){var D=c._g.doc.getElementById(C.replace(/(^url\(#|\)$)/g,l));D&&D.parentNode.removeChild(D),q(i,{"clip-path":l}),delete d.clip}}break;case"path":"path"==d.type&&(q(i,{d:p?k.path=c._pathToAbsolute(p):"M0,0"}),d._.dirty=1,d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1)));break;case"width":if(i.setAttribute(o,p),d._.dirty=1,!k.fx)break;o="x",p=k.x;case"x":k.fx&&(p=-k.x-(k.width||0));case"rx":if("rx"==o&&"rect"==d.type)break;case"cx":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"height":if(i.setAttribute(o,p),d._.dirty=1,!k.fy)break;o="y",p=k.y;case"y":k.fy&&(p=-k.y-(k.height||0));case"ry":if("ry"==o&&"rect"==d.type)break;case"cy":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"r":"rect"==d.type?q(i,{rx:p,ry:p}):i.setAttribute(o,p),d._.dirty=1;break;case"src":"image"==d.type&&i.setAttributeNS(n,"href",p);break;case"stroke-width":(1!=d._.sx||1!=d._.sy)&&(p/=g(h(d._.sx),h(d._.sy))||1),d.paper._vbSize&&(p*=d.paper._vbSize),i.setAttribute(o,p),k["stroke-dasharray"]&&v(d,k["stroke-dasharray"],f),d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"stroke-dasharray":v(d,p,f);break;case"fill":var E=b(p).match(c._ISURL);if(E){A=q("pattern");var F=q("image");A.id=c.createUUID(),q(A,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),q(F,{x:0,y:0,"xlink:href":E[1]}),A.appendChild(F),function(a){c._preload(E[1],function(){var b=this.offsetWidth,c=this.offsetHeight;q(a,{width:b,height:c}),q(F,{width:b,height:c}),d.paper.safari()})}(A),d.paper.defs.appendChild(A),q(i,{fill:"url(#"+A.id+")"}),d.pattern=A,d.pattern&&s(d);break}var G=c.getRGB(p);if(G.error){if(("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p)){if("opacity"in k||"fill-opacity"in k){var H=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l));if(H){var I=H.getElementsByTagName("stop");q(I[I.length-1],{"stop-opacity":("opacity"in k?k.opacity:1)*("fill-opacity"in k?k["fill-opacity"]:1)})}}k.gradient=p,k.fill="none";break}}else delete f.gradient,delete k.gradient,!c.is(k.opacity,"undefined")&&c.is(f.opacity,"undefined")&&q(i,{opacity:k.opacity}),!c.is(k["fill-opacity"],"undefined")&&c.is(f["fill-opacity"],"undefined")&&q(i,{"fill-opacity":k["fill-opacity"]});G[a]("opacity")&&q(i,{"fill-opacity":G.opacity>1?G.opacity/100:G.opacity});case"stroke":G=c.getRGB(p),i.setAttribute(o,G.hex),"stroke"==o&&G[a]("opacity")&&q(i,{"stroke-opacity":G.opacity>1?G.opacity/100:G.opacity}),"stroke"==o&&d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"gradient":("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p);break;case"opacity":k.gradient&&!k[a]("stroke-opacity")&&q(i,{"stroke-opacity":p>1?p/100:p});case"fill-opacity":if(k.gradient){H=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l)),H&&(I=H.getElementsByTagName("stop"),q(I[I.length-1],{"stop-opacity":p}));break}default:"font-size"==o&&(p=e(p,10)+"px");var J=o.replace(/(\-.)/g,function(a){return a.substring(1).toUpperCase()});i.style[J]=p,d._.dirty=1,i.setAttribute(o,p)}}y(d,f),i.style.visibility=m},x=1.2,y=function(d,f){if("text"==d.type&&(f[a]("text")||f[a]("font")||f[a]("font-size")||f[a]("x")||f[a]("y"))){var g=d.attrs,h=d.node,i=h.firstChild?e(c._g.doc.defaultView.getComputedStyle(h.firstChild,l).getPropertyValue("font-size"),10):10;
  if(f[a]("text")){for(g.text=f.text;h.firstChild;)h.removeChild(h.firstChild);for(var m,j=b(f.text).split("\n"),k=[],n=0,o=j.length;o>n;n++)m=q("tspan"),n&&q(m,{dy:i*x,x:g.x}),m.appendChild(c._g.doc.createTextNode(j[n])),h.appendChild(m),k[n]=m}else for(k=h.getElementsByTagName("tspan"),n=0,o=k.length;o>n;n++)n?q(k[n],{dy:i*x,x:g.x}):q(k[0],{dy:0});q(h,{x:g.x,y:g.y}),d._.dirty=1;var p=d._getBBox(),r=g.y-(p.y+p.height/2);r&&c.is(r,"finite")&&q(k[0],{dy:r})}},z=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.matrix=c.matrix(),this.realPath=null,this.paper=b,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},A=c.el;z.prototype=A,A.constructor=z,c._engine.path=function(a,b){var c=q("path");b.canvas&&b.canvas.appendChild(c);var d=new z(c,b);return d.type="path",w(d,{fill:"none",stroke:"#000",path:a}),d},A.rotate=function(a,c,e){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this.transform(this._.transform.concat([["r",a,c,e]])),this},A.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3])),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this},A.translate=function(a,c){return this.removed?this:(a=b(a).split(j),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this.transform(this._.transform.concat([["t",a,c]])),this)},A.transform=function(b){var d=this._;if(null==b)return d.transform;if(c._extractTransform(this,b),this.clip&&q(this.clip,{transform:this.matrix.invert()}),this.pattern&&s(this),this.node&&q(this.node,{transform:this.matrix}),1!=d.sx||1!=d.sy){var e=this.attrs[a]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":e})}return this},A.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},A.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},A.remove=function(){if(!this.removed&&this.node.parentNode){var a=this.paper;a.__set__&&a.__set__.exclude(this),k.unbind("raphael.*.*."+this.id),this.gradient&&a.defs.removeChild(this.gradient),c._tear(this,a),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var b in this)this[b]="function"==typeof this[b]?c._removedFactory(b):null;this.removed=!0}},A._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(c){}finally{b=b||{}}return a&&this.hide(),b},A.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;for(var g=b.split(j),h={},i=0,l=g.length;l>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return l-1?h:h[g[0]]}if(null==d&&c.is(b,"array")){for(h={},i=0,l=b.length;l>i;i++)h[b[i]]=this.attr(b[i]);return h}if(null!=d){var m={};m[b]=d}else null!=b&&c.is(b,"object")&&(m=b);for(var n in m)k("raphael.attr."+n+"."+this.id,this,m[n]);for(n in this.paper.customAttributes)if(this.paper.customAttributes[a](n)&&m[a](n)&&c.is(this.paper.customAttributes[n],"function")){var o=this.paper.customAttributes[n].apply(this,[].concat(m[n]));this.attrs[n]=m[n];for(var p in o)o[a](p)&&(m[p]=o[p])}return w(this,m),this},A.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var a=this.paper;return a.top!=this&&c._tofront(this,a),this},A.toBack=function(){if(this.removed)return this;var a=this.node.parentNode;return"a"==a.tagName.toLowerCase()?a.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):a.firstChild!=this.node&&a.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper),this.paper,this},A.insertAfter=function(a){if(this.removed)return this;var b=a.node||a[a.length-1].node;return b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this},A.insertBefore=function(a){if(this.removed)return this;var b=a.node||a[0].node;return b.parentNode.insertBefore(this.node,b),c._insertbefore(this,a,this.paper),this},A.blur=function(a){var b=this;if(0!==+a){var d=q("filter"),e=q("feGaussianBlur");b.attrs.blur=a,d.id=c.createUUID(),q(e,{stdDeviation:+a||1.5}),d.appendChild(e),b.paper.defs.appendChild(d),b._blur=d,q(b.node,{filter:"url(#"+d.id+")"})}else b._blur&&(b._blur.parentNode.removeChild(b._blur),delete b._blur,delete b.attrs.blur),b.node.removeAttribute("filter");return b},c._engine.circle=function(a,b,c,d){var e=q("circle");a.canvas&&a.canvas.appendChild(e);var f=new z(e,a);return f.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"},f.type="circle",q(e,f.attrs),f},c._engine.rect=function(a,b,c,d,e,f){var g=q("rect");a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"},h.type="rect",q(g,h.attrs),h},c._engine.ellipse=function(a,b,c,d,e){var f=q("ellipse");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"},g.type="ellipse",q(f,g.attrs),g},c._engine.image=function(a,b,c,d,e,f){var g=q("image");q(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"}),g.setAttributeNS(n,"href",b),a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:c,y:d,width:e,height:f,src:b},h.type="image",h},c._engine.text=function(a,b,d,e){var f=q("text");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={x:b,y:d,"text-anchor":"middle",text:e,font:c._availableAttrs.font,stroke:"none",fill:"#000"},g.type="text",w(g,g.attrs),g},c._engine.setSize=function(a,b){return this.width=a||this.width,this.height=b||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a&&a.container,d=a.x,e=a.y,f=a.width,g=a.height;if(!b)throw new Error("SVG container not found.");var j,h=q("svg"),i="overflow:hidden;";return d=d||0,e=e||0,f=f||512,g=g||342,q(h,{height:g,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"}),1==b?(h.style.cssText=i+"position:absolute;left:"+d+"px;top:"+e+"px",c._g.doc.body.appendChild(h),j=1):(h.style.cssText=i+"position:relative",b.firstChild?b.insertBefore(h,b.firstChild):b.appendChild(h)),b=new c._Paper,b.width=f,b.height=g,b.canvas=h,b.clear(),b._left=b._top=0,j&&(b.renderfix=function(){}),b.renderfix(),b},c._engine.setViewBox=function(a,b,c,d,e){k("raphael.setViewBox",this,this._viewBox,[a,b,c,d,e]);var j,l,f=g(c/this.width,d/this.height),h=this.top,i=e?"meet":"xMinYMin";for(null==a?(this._vbSize&&(f=1),delete this._vbSize,j="0 0 "+this.width+m+this.height):(this._vbSize=f,j=a+m+b+m+c+m+d),q(this.canvas,{viewBox:j,preserveAspectRatio:i});f&&h;)l="stroke-width"in h.attrs?h.attrs["stroke-width"]:1,h.attr({"stroke-width":l}),h._.dirty=1,h._.dirtyT=1,h=h.prev;return this._viewBox=[a,b,c,d,!!e],this},c.prototype.renderfix=function(){var c,a=this.canvas,b=a.style;try{c=a.getScreenCTM()||a.createSVGMatrix()}catch(d){c=a.createSVGMatrix()}var e=-c.e%1,f=-c.f%1;(e||f)&&(e&&(this._left=(this._left+e)%1,b.left=this._left+"px"),f&&(this._top=(this._top+f)%1,b.top=this._top+"px"))},c.prototype.clear=function(){c.eve("raphael.clear",this);for(var a=this.canvas;a.firstChild;)a.removeChild(a.firstChild);this.bottom=this.top=null,(this.desc=q("desc")).appendChild(c._g.doc.createTextNode("Created with Rapha\xebl "+c.version)),a.appendChild(this.desc),a.appendChild(this.defs=q("defs"))},c.prototype.remove=function(){k("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null};var B=c.st;for(var C in A)A[a](C)&&!B[a](C)&&(B[C]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(C))}}(),function(){if(c.vml){var a="hasOwnProperty",b=String,d=parseFloat,e=Math,f=e.round,g=e.max,h=e.min,i=e.abs,j="fill",k=/[, ]+/,l=c.eve,m=" progid:DXImageTransform.Microsoft",n=" ",o="",p={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},q=/([clmz]),?([^clmz]*)/gi,r=/ progid:\S+Blur\([^\)]+\)/g,s=/-?[^,\s-]+/g,t="position:absolute;left:0;top:0;width:1px;height:1px",u=21600,v={path:1,rect:1,image:1},w={circle:1,ellipse:1},x=function(a){var d=/[ahqstv]/gi,e=c._pathToAbsolute;if(b(a).match(d)&&(e=c._path2curve),d=/[clmz]/g,e==c._pathToAbsolute&&!b(a).match(d)){var g=b(a).replace(q,function(a,b,c){var d=[],e="m"==b.toLowerCase(),g=p[b];return c.replace(s,function(a){e&&2==d.length&&(g+=d+p["m"==b?"l":"L"],d=[]),d.push(f(a*u))}),g+d});return g}var i,j,h=e(a);g=[];for(var k=0,l=h.length;l>k;k++){i=h[k],j=h[k][0].toLowerCase(),"z"==j&&(j="x");for(var m=1,r=i.length;r>m;m++)j+=f(i[m]*u)+(m!=r-1?",":o);g.push(j)}return g.join(n)},y=function(a,b,d){var e=c.matrix();return e.rotate(-a,.5,.5),{dx:e.x(b,d),dy:e.y(b,d)}},z=function(a,b,c,d,e,f){var g=a._,h=a.matrix,k=g.fillpos,l=a.node,m=l.style,o=1,p="",r=u/b,s=u/c;if(m.visibility="hidden",b&&c){if(l.coordsize=i(r)+n+i(s),m.rotation=f*(0>b*c?-1:1),f){var t=y(f,d,e);d=t.dx,e=t.dy}if(0>b&&(p+="x"),0>c&&(p+=" y")&&(o=-1),m.flip=p,l.coordorigin=d*-r+n+e*-s,k||g.fillsize){var v=l.getElementsByTagName(j);v=v&&v[0],l.removeChild(v),k&&(t=y(f,h.x(k[0],k[1]),h.y(k[0],k[1])),v.position=t.dx*o+n+t.dy*o),g.fillsize&&(v.size=g.fillsize[0]*i(b)+n+g.fillsize[1]*i(c)),l.appendChild(v)}m.visibility="visible"}};c.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version};var A=function(a,c,d){for(var e=b(c).toLowerCase().split("-"),f=d?"end":"start",g=e.length,h="classic",i="medium",j="medium";g--;)switch(e[g]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":h=e[g];break;case"wide":case"narrow":j=e[g];break;case"long":case"short":i=e[g]}var k=a.node.getElementsByTagName("stroke")[0];k[f+"arrow"]=h,k[f+"arrowlength"]=i,k[f+"arrowwidth"]=j},B=function(e,i){e.attrs=e.attrs||{};var l=e.node,m=e.attrs,p=l.style,r=v[e.type]&&(i.x!=m.x||i.y!=m.y||i.width!=m.width||i.height!=m.height||i.cx!=m.cx||i.cy!=m.cy||i.rx!=m.rx||i.ry!=m.ry||i.r!=m.r),s=w[e.type]&&(m.cx!=i.cx||m.cy!=i.cy||m.r!=i.r||m.rx!=i.rx||m.ry!=i.ry),t=e;for(var y in i)i[a](y)&&(m[y]=i[y]);if(r&&(m.path=c._getPath[e.type](e),e._.dirty=1),i.href&&(l.href=i.href),i.title&&(l.title=i.title),i.target&&(l.target=i.target),i.cursor&&(p.cursor=i.cursor),"blur"in i&&e.blur(i.blur),(i.path&&"path"==e.type||r)&&(l.path=x(~b(m.path).toLowerCase().indexOf("r")?c._pathToAbsolute(m.path):m.path),"image"==e.type&&(e._.fillpos=[m.x,m.y],e._.fillsize=[m.width,m.height],z(e,1,1,0,0,0))),"transform"in i&&e.transform(i.transform),s){var B=+m.cx,D=+m.cy,E=+m.rx||+m.r||0,G=+m.ry||+m.r||0;l.path=c.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",f((B-E)*u),f((D-G)*u),f((B+E)*u),f((D+G)*u),f(B*u)),e._.dirty=1}if("clip-rect"in i){var H=b(i["clip-rect"]).split(k);if(4==H.length){H[2]=+H[2]+ +H[0],H[3]=+H[3]+ +H[1];var I=l.clipRect||c._g.doc.createElement("div"),J=I.style;J.clip=c.format("rect({1}px {2}px {3}px {0}px)",H),l.clipRect||(J.position="absolute",J.top=0,J.left=0,J.width=e.paper.width+"px",J.height=e.paper.height+"px",l.parentNode.insertBefore(I,l),I.appendChild(l),l.clipRect=I)}i["clip-rect"]||l.clipRect&&(l.clipRect.style.clip="auto")}if(e.textpath){var K=e.textpath.style;i.font&&(K.font=i.font),i["font-family"]&&(K.fontFamily='"'+i["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,o)+'"'),i["font-size"]&&(K.fontSize=i["font-size"]),i["font-weight"]&&(K.fontWeight=i["font-weight"]),i["font-style"]&&(K.fontStyle=i["font-style"])}if("arrow-start"in i&&A(t,i["arrow-start"]),"arrow-end"in i&&A(t,i["arrow-end"],1),null!=i.opacity||null!=i["stroke-width"]||null!=i.fill||null!=i.src||null!=i.stroke||null!=i["stroke-width"]||null!=i["stroke-opacity"]||null!=i["fill-opacity"]||null!=i["stroke-dasharray"]||null!=i["stroke-miterlimit"]||null!=i["stroke-linejoin"]||null!=i["stroke-linecap"]){var L=l.getElementsByTagName(j),M=!1;if(L=L&&L[0],!L&&(M=L=F(j)),"image"==e.type&&i.src&&(L.src=i.src),i.fill&&(L.on=!0),(null==L.on||"none"==i.fill||null===i.fill)&&(L.on=!1),L.on&&i.fill){var N=b(i.fill).match(c._ISURL);if(N){L.parentNode==l&&l.removeChild(L),L.rotate=!0,L.src=N[1],L.type="tile";var O=e.getBBox(1);L.position=O.x+n+O.y,e._.fillpos=[O.x,O.y],c._preload(N[1],function(){e._.fillsize=[this.offsetWidth,this.offsetHeight]})}else L.color=c.getRGB(i.fill).hex,L.src=o,L.type="solid",c.getRGB(i.fill).error&&(t.type in{circle:1,ellipse:1}||"r"!=b(i.fill).charAt())&&C(t,i.fill,L)&&(m.fill="none",m.gradient=i.fill,L.rotate=!1)}if("fill-opacity"in i||"opacity"in i){var P=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+c.getRGB(i.fill).o+1||2)-1);P=h(g(P,0),1),L.opacity=P,L.src&&(L.color="none")}l.appendChild(L);var Q=l.getElementsByTagName("stroke")&&l.getElementsByTagName("stroke")[0],R=!1;!Q&&(R=Q=F("stroke")),(i.stroke&&"none"!=i.stroke||i["stroke-width"]||null!=i["stroke-opacity"]||i["stroke-dasharray"]||i["stroke-miterlimit"]||i["stroke-linejoin"]||i["stroke-linecap"])&&(Q.on=!0),("none"==i.stroke||null===i.stroke||null==Q.on||0==i.stroke||0==i["stroke-width"])&&(Q.on=!1);var S=c.getRGB(i.stroke);Q.on&&i.stroke&&(Q.color=S.hex),P=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+S.o+1||2)-1);var T=.75*(d(i["stroke-width"])||1);if(P=h(g(P,0),1),null==i["stroke-width"]&&(T=m["stroke-width"]),i["stroke-width"]&&(Q.weight=T),T&&1>T&&(P*=T)&&(Q.weight=1),Q.opacity=P,i["stroke-linejoin"]&&(Q.joinstyle=i["stroke-linejoin"]||"miter"),Q.miterlimit=i["stroke-miterlimit"]||8,i["stroke-linecap"]&&(Q.endcap="butt"==i["stroke-linecap"]?"flat":"square"==i["stroke-linecap"]?"square":"round"),i["stroke-dasharray"]){var U={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};Q.dashstyle=U[a](i["stroke-dasharray"])?U[i["stroke-dasharray"]]:o}R&&l.appendChild(Q)}if("text"==t.type){t.paper.canvas.style.display=o;var V=t.paper.span,W=100,X=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);p=V.style,m.font&&(p.font=m.font),m["font-family"]&&(p.fontFamily=m["font-family"]),m["font-weight"]&&(p.fontWeight=m["font-weight"]),m["font-style"]&&(p.fontStyle=m["font-style"]),X=d(m["font-size"]||X&&X[0])||10,p.fontSize=X*W+"px",t.textpath.string&&(V.innerHTML=b(t.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var Y=V.getBoundingClientRect();t.W=m.w=(Y.right-Y.left)/W,t.H=m.h=(Y.bottom-Y.top)/W,t.X=m.x,t.Y=m.y+t.H/2,("x"in i||"y"in i)&&(t.path.v=c.format("m{0},{1}l{2},{1}",f(m.x*u),f(m.y*u),f(m.x*u)+1));for(var Z=["x","y","text","font","font-family","font-weight","font-style","font-size"],$=0,_=Z.length;_>$;$++)if(Z[$]in i){t._.dirty=1;break}switch(m["text-anchor"]){case"start":t.textpath.style["v-text-align"]="left",t.bbx=t.W/2;break;case"end":t.textpath.style["v-text-align"]="right",t.bbx=-t.W/2;break;default:t.textpath.style["v-text-align"]="center",t.bbx=0}t.textpath.style["v-text-kern"]=!0}},C=function(a,f,g){a.attrs=a.attrs||{};var i=(a.attrs,Math.pow),l="linear",m=".5 .5";if(a.attrs.gradient=f,f=b(f).replace(c._radial_gradient,function(a,b,c){return l="radial",b&&c&&(b=d(b),c=d(c),i(b-.5,2)+i(c-.5,2)>.25&&(c=e.sqrt(.25-i(b-.5,2))*(2*(c>.5)-1)+.5),m=b+n+c),o}),f=f.split(/\s*\-\s*/),"linear"==l){var p=f.shift();if(p=-d(p),isNaN(p))return null}var q=c._parseDots(f);if(!q)return null;if(a=a.shape||a.node,q.length){a.removeChild(g),g.on=!0,g.method="none",g.color=q[0].color,g.color2=q[q.length-1].color;for(var r=[],s=0,t=q.length;t>s;s++)q[s].offset&&r.push(q[s].offset+n+q[s].color);g.colors=r.length?r.join():"0% "+g.color,"radial"==l?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=m,g.angle=0):(g.type="gradient",g.angle=(270-p)%360),a.appendChild(g)}return 1},D=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=b,this.matrix=c.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},E=c.el;D.prototype=E,E.constructor=D,E.transform=function(a){if(null==a)return this._.transform;var f,d=this.paper._viewBoxShift,e=d?"s"+[d.scale,d.scale]+"-1-1t"+[d.dx,d.dy]:o;d&&(f=a=b(a).replace(/\.{3}|\u2026/g,this._.transform||o)),c._extractTransform(this,e+a);var j,g=this.matrix.clone(),h=this.skew,i=this.node,k=~b(this.attrs.fill).indexOf("-"),l=!b(this.attrs.fill).indexOf("url(");if(g.translate(1,1),l||k||"image"==this.type)if(h.matrix="1 0 0 1",h.offset="0 0",j=g.split(),k&&j.noRotation||!j.isSimple){i.style.filter=g.toFilter();var m=this.getBBox(),p=this.getBBox(1),q=m.x-p.x,r=m.y-p.y;i.coordorigin=q*-u+n+r*-u,z(this,1,1,q,r,0)}else i.style.filter=o,z(this,j.scalex,j.scaley,j.dx,j.dy,j.rotate);else i.style.filter=o,h.matrix=b(g),h.offset=g.offset();return f&&(this._.transform=f),this},E.rotate=function(a,c,e){if(this.removed)return this;if(null!=a){if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",a,c,e]])),this}},E.translate=function(a,c){return this.removed?this:(a=b(a).split(k),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=c),this.transform(this._.transform.concat([["t",a,c]])),this)},E.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null)),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this._.dirtyT=1,this},E.hide=function(){return!this.removed&&(this.node.style.display="none"),this},E.show=function(){return!this.removed&&(this.node.style.display=o),this},E._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},E.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),c.eve.unbind("raphael.*.*."+this.id),c._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;this.removed=!0}},E.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if(b==j&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var g=b.split(k),h={},i=0,m=g.length;m>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return m-1?h:h[g[0]]}if(this.attrs&&null==d&&c.is(b,"array")){for(h={},i=0,m=b.length;m>i;i++)h[b[i]]=this.attr(b[i]);return h}var n;null!=d&&(n={},n[b]=d),null==d&&c.is(b,"object")&&(n=b);for(var o in n)l("raphael.attr."+o+"."+this.id,this,n[o]);if(n){for(o in this.paper.customAttributes)if(this.paper.customAttributes[a](o)&&n[a](o)&&c.is(this.paper.customAttributes[o],"function")){var p=this.paper.customAttributes[o].apply(this,[].concat(n[o]));this.attrs[o]=n[o];for(var q in p)p[a](q)&&(n[q]=p[q])}n.text&&"text"==this.type&&(this.textpath.string=n.text),B(this,n)}return this},E.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&c._tofront(this,this.paper),this},E.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper)),this)},E.insertAfter=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[a.length-1]),a.node.nextSibling?a.node.parentNode.insertBefore(this.node,a.node.nextSibling):a.node.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this)},E.insertBefore=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[0]),a.node.parentNode.insertBefore(this.node,a.node),c._insertbefore(this,a,this.paper),this)},E.blur=function(a){var b=this.node.runtimeStyle,d=b.filter;return d=d.replace(r,o),0!==+a?(this.attrs.blur=a,b.filter=d+n+m+".Blur(pixelradius="+(+a||1.5)+")",b.margin=c.format("-{0}px 0 0 -{0}px",f(+a||1.5))):(b.filter=d,b.margin=0,delete this.attrs.blur),this},c._engine.path=function(a,b){var c=F("shape");c.style.cssText=t,c.coordsize=u+n+u,c.coordorigin=b.coordorigin;var d=new D(c,b),e={fill:"none",stroke:"#000"};a&&(e.path=a),d.type="path",d.path=[],d.Path=o,B(d,e),b.canvas.appendChild(c);var f=F("skew");return f.on=!0,c.appendChild(f),d.skew=f,d.transform(o),d},c._engine.rect=function(a,b,d,e,f,g){var h=c._rectPath(b,d,e,f,g),i=a.path(h),j=i.attrs;return i.X=j.x=b,i.Y=j.y=d,i.W=j.width=e,i.H=j.height=f,j.r=g,j.path=h,i.type="rect",i},c._engine.ellipse=function(a,b,c,d,e){var f=a.path();return f.attrs,f.X=b-d,f.Y=c-e,f.W=2*d,f.H=2*e,f.type="ellipse",B(f,{cx:b,cy:c,rx:d,ry:e}),f},c._engine.circle=function(a,b,c,d){var e=a.path();return e.attrs,e.X=b-d,e.Y=c-d,e.W=e.H=2*d,e.type="circle",B(e,{cx:b,cy:c,r:d}),e},c._engine.image=function(a,b,d,e,f,g){var h=c._rectPath(d,e,f,g),i=a.path(h).attr({stroke:"none"}),k=i.attrs,l=i.node,m=l.getElementsByTagName(j)[0];return k.src=b,i.X=k.x=d,i.Y=k.y=e,i.W=k.width=f,i.H=k.height=g,k.path=h,i.type="image",m.parentNode==l&&l.removeChild(m),m.rotate=!0,m.src=b,m.type="tile",i._.fillpos=[d,e],i._.fillsize=[f,g],l.appendChild(m),z(i,1,1,0,0,0),i},c._engine.text=function(a,d,e,g){var h=F("shape"),i=F("path"),j=F("textpath");d=d||0,e=e||0,g=g||"",i.v=c.format("m{0},{1}l{2},{1}",f(d*u),f(e*u),f(d*u)+1),i.textpathok=!0,j.string=b(g),j.on=!0,h.style.cssText=t,h.coordsize=u+n+u,h.coordorigin="0 0";var k=new D(h,a),l={fill:"#000",stroke:"none",font:c._availableAttrs.font,text:g};k.shape=h,k.path=i,k.textpath=j,k.type="text",k.attrs.text=b(g),k.attrs.x=d,k.attrs.y=e,k.attrs.w=1,k.attrs.h=1,B(k,l),h.appendChild(j),h.appendChild(i),a.canvas.appendChild(h);var m=F("skew");return m.on=!0,h.appendChild(m),k.skew=m,k.transform(o),k},c._engine.setSize=function(a,b){var d=this.canvas.style;return this.width=a,this.height=b,a==+a&&(a+="px"),b==+b&&(b+="px"),d.width=a,d.height=b,d.clip="rect(0 "+a+" "+b+" 0)",this._viewBox&&c._engine.setViewBox.apply(this,this._viewBox),this},c._engine.setViewBox=function(a,b,d,e,f){c.eve("raphael.setViewBox",this,this._viewBox,[a,b,d,e,f]);var k,l,h=this.width,i=this.height,j=1/g(d/h,e/i);return f&&(k=i/e,l=h/d,h>d*k&&(a-=(h-d*k)/2/k),i>e*l&&(b-=(i-e*l)/2/l)),this._viewBox=[a,b,d,e,!!f],this._viewBoxShift={dx:-a,dy:-b,scale:j},this.forEach(function(a){a.transform("...")}),this};var F;c._engine.initWin=function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),F=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){F=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},c._engine.initWin(c._g.win),c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a.container,d=a.height,f=a.width,g=a.x,h=a.y;if(!b)throw new Error("VML container not found.");var i=new c._Paper,j=i.canvas=c._g.doc.createElement("div"),k=j.style;return g=g||0,h=h||0,f=f||512,d=d||342,i.width=f,i.height=d,f==+f&&(f+="px"),d==+d&&(d+="px"),i.coordsize=1e3*u+n+1e3*u,i.coordorigin="0 0",i.span=c._g.doc.createElement("span"),i.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",j.appendChild(i.span),k.cssText=c.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",f,d),1==b?(c._g.doc.body.appendChild(j),k.left=g+"px",k.top=h+"px",k.position="absolute"):b.firstChild?b.insertBefore(j,b.firstChild):b.appendChild(j),i.renderfix=function(){},i},c.prototype.clear=function(){c.eve("raphael.clear",this),this.canvas.innerHTML=o,this.span=c._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},c.prototype.remove=function(){c.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;return!0};var G=c.st;for(var H in E)E[a](H)&&!G[a](H)&&(G[H]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(H))}}(),k.was?j.win.Raphael=c:Raphael=c,c});
}
if (!window.jQuery.ui) {
  !function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,b.href&&f&&"map"===e.nodeName.toLowerCase()?(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}a.ui=a.ui||{},a.extend(a.ui,{version:"@VERSION",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b=this.css("position"),c="absolute"===b,d=this.parents().filter(function(){var b=a(this);return c&&"static"===b.css("position")?!1:/(auto|scroll)/.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0);return"fixed"!==b&&d.length?d:a(this[0].ownerDocument||document)},uniqueId:function(){var a=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function h(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),f&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var e="Width"===d?["Left","Right"]:["Top","Bottom"],f=d.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?g["inner"+d].call(this):this.each(function(){a(this).css(f,h(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?g["outer"+d].call(this,b):this.each(function(){a(this).css(f,h(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var e,f,d=a(this[0]);d.length&&d[0]!==document;){if(e=d.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(f=parseInt(d.css("zIndex"),10),!isNaN(f)&&0!==f))return f;d=d.parent()}return 0}}),a.ui.plugin={add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c,d){var e,f=a.plugins[b];if(f&&(d||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(e=0;e<f.length;e++)a.options[f[e][0]]&&f[e][1].apply(a.element,c)}}}(jQuery),function(a,b){var c=0,d=Array.prototype.slice;a.cleanData=function(b){return function(c){for(var e,d=0;null!=(e=c[d]);d++)try{a(e).triggerHandler("remove")}catch(f){}b(c)}}(a.cleanData),a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];return b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?(arguments.length&&this._createWidget(a,b),void 0):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var f,b=this._super,c=this._superApply;return this._super=a,this._superApply=e,f=d.apply(this,arguments),this._super=b,this._superApply=c,f}}(),void 0):(i[b]=d,void 0)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g),g},a.widget.extend=function(c){for(var h,i,e=d.call(arguments,1),f=0,g=e.length;g>f;f++)for(h in e[f])i=e[f][h],e[f].hasOwnProperty(h)&&i!==b&&(c[h]=a.isPlainObject(i)?a.isPlainObject(c[h])?a.widget.extend({},c[h],i):a.widget.extend({},i):i);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,h?this.each(function(){var d,e=a.data(this,f);return"instance"===g?(j=e,!1):e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; "+"attempted to call method '"+g+"'")}):this.each(function(){var b=a.data(this,f);b?(b.option(g||{}),b._init&&b._init()):a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var f,g,h,e=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(e={},f=c.split("."),c=f.shift(),f.length){for(g=e[c]=a.widget.extend({},this.options[c]),h=0;h<f.length-1;h++)g[f[h]]=g[f[h]]||{},g=g[f[h]];if(c=f.pop(),1===arguments.length)return g[c]===b?null:g[c];g[c]=d}else{if(1===arguments.length)return this.options[c]===b?null:this.options[c];e[c]=d}return this._setOptions(e),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!b),b&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){return b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof g?f[g]:g).apply(f,arguments):void 0}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(jQuery),function(a){var c=!1;a(document).mouseup(function(){c=!1}),a.widget("ui.mouse",{version:"@VERSION",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(!c){this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=1===b.which,f="string"==typeof this.options.cancel&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;return e&&!f&&this._mouseCapture(b)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(b)!==!1,!this._mouseStarted)?(b.preventDefault(),!0):(!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0,!0)):!0}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button?this._mouseUp(b):b.which?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(b){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),c=!1,!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a){a.widget("ui.draggable",a.ui.mouse,{version:"@VERSION",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),void 0)},_mouseCapture:function(b){var c=this.document[0],d=this.options;try{c.activeElement&&"body"!==c.activeElement.nodeName.toLowerCase()&&a(c.activeElement).blur()}catch(e){}return this.helper||d.disabled||a(b.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(b),this.handle?(a(d.iframeFix===!0?"iframe":d.iframeFix).each(function(){a("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b,!1),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b,!0),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1},_mouseUp:function(b){return a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),this.element.focus(),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return this.options.handle?!!a(b.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d[0]===this.element[0]||/(fixed|absolute)/.test(d.css("position"))||d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_isRootNode:function(a){return/(html|body)/i.test(a.tagName)||a===this.document[0]},_getParentOffset:function(){var b=this.offsetParent.offset(),c=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==c&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var a=this.element.position(),b=this._isRootNode(this.scrollParent[0]);return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+(b?0:this.scrollParent.scrollTop()),left:a.left-(parseInt(this.helper.css("left"),10)||0)+(b?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options,f=this.document[0];return e.containment?"window"===e.containment?(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===e.containment?(this.containment=[0,0,a(f).width()-this.helperProportions.width-this.margins.left,(a(f).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):e.containment.constructor===Array?(this.containment=e.containment,void 0):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],d&&(b="hidden"!==c.css("overflow"),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c),void 0):(this.containment=null,void 0)},_convertPositionTo:function(a,b){b||(b=this.position);var c="absolute"===a?1:-1,d=this._isRootNode(this.scrollParent[0]);return{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.offset.scroll.top:d?0:this.offset.scroll.top)*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.offset.scroll.left:d?0:this.offset.scroll.left)*c}},_generatePosition:function(a,b){var c,d,e,f,g=this.options,h=this._isRootNode(this.scrollParent[0]),i=a.pageX,j=a.pageY;return h&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),b&&(this.containment&&(this.relative_container?(d=this.relative_container.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,a.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),a.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),a.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),a.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f),"y"===g.axis&&(i=this.originalPageX),"x"===g.axis&&(j=this.originalPageY)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:h?0:this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:h?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d,this],!0),"drag"===b&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c,d){var e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a(this).sortable("instance");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c,d){var e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,"original"===d.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c,d){var e=this;a.each(d.sortables,function(){var f=!1,g=this;this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(f=!0,a.each(d.sortables,function(){return this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this!==g&&this.instance._intersectsWith(this.instance.containerCache)&&a.contains(g.instance.element[0],this.instance.element[0])&&(f=!1),f})),f?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c,d){var e=a("body"),f=d.options;e.css("cursor")&&(f._cursor=e.css("cursor")),e.css("cursor",f.cursor)},stop:function(b,c,d){var e=d.options;e._cursor&&a("body").css("cursor",e._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("opacity")&&(f._opacity=e.css("opacity")),e.css("opacity",f.opacity)},stop:function(b,c,d){var e=d.options;e._opacity&&a(c.helper).css("opacity",e._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(a,b,c){c.scrollParent[0]!==c.document[0]&&"HTML"!==c.scrollParent[0].tagName&&(c.overflowOffset=c.scrollParent.offset())},drag:function(b,c,d){var e=d.options,f=!1,g=d.document[0];d.scrollParent[0]!==g&&"HTML"!==d.scrollParent[0].tagName?(e.axis&&"x"===e.axis||(d.overflowOffset.top+d.scrollParent[0].offsetHeight-b.pageY<e.scrollSensitivity?d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop-e.scrollSpeed)),e.axis&&"y"===e.axis||(d.overflowOffset.left+d.scrollParent[0].offsetWidth-b.pageX<e.scrollSensitivity?d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft-e.scrollSpeed))):(e.axis&&"x"===e.axis||(b.pageY-a(g).scrollTop()<e.scrollSensitivity?f=a(g).scrollTop(a(g).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(g).scrollTop())<e.scrollSensitivity&&(f=a(g).scrollTop(a(g).scrollTop()+e.scrollSpeed))),e.axis&&"y"===e.axis||(b.pageX-a(g).scrollLeft()<e.scrollSensitivity?f=a(g).scrollLeft(a(g).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(g).scrollLeft())<e.scrollSensitivity&&(f=a(g).scrollLeft(a(g).scrollLeft()+e.scrollSpeed)))),f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c,d){var e=d.options;d.snapElements=[],a(e.snap.constructor!==String?e.snap.items||":data(ui-draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!==d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=d.options,p=o.snapTolerance,q=c.offset.left,r=q+d.helperProportions.width,s=c.offset.top,t=s+d.helperProportions.height;for(m=d.snapElements.length-1;m>=0;m--)i=d.snapElements[m].left,j=i+d.snapElements[m].width,k=d.snapElements[m].top,l=k+d.snapElements[m].height,i-p>r||q>j+p||k-p>t||s>l+p||!a.contains(d.snapElements[m].item.ownerDocument,d.snapElements[m].item)?(d.snapElements[m].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=!1):("inner"!==o.snapMode&&(e=Math.abs(k-t)<=p,f=Math.abs(l-s)<=p,g=Math.abs(i-r)<=p,h=Math.abs(j-q)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k-d.helperProportions.height,left:0}).top-d.margins.top),f&&(c.position.top=d._convertPositionTo("relative",{top:l,left:0}).top-d.margins.top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i-d.helperProportions.width}).left-d.margins.left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j}).left-d.margins.left)),n=e||f||g||h,"outer"!==o.snapMode&&(e=Math.abs(k-s)<=p,f=Math.abs(l-t)<=p,g=Math.abs(i-q)<=p,h=Math.abs(j-r)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k,left:0}).top-d.margins.top),f&&(c.position.top=d._convertPositionTo("relative",{top:l-d.helperProportions.height,left:0}).top-d.margins.top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i}).left-d.margins.left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j-d.helperProportions.width}).left-d.margins.left)),!d.snapElements[m].snapping&&(e||f||g||h||n)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=e||f||g||h||n)}}),a.ui.plugin.add("draggable","stack",{start:function(b,c,d){var e,f=d.options,g=a.makeArray(a(f.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});g.length&&(e=parseInt(a(g[0]).css("zIndex"),10)||0,a(g).each(function(b){a(this).css("zIndex",e+b)}),this.css("zIndex",e+g.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("zIndex")&&(f._zIndex=e.css("zIndex")),e.css("zIndex",f.zIndex)},stop:function(b,c,d){var e=d.options;e._zIndex&&a(c.helper).css("zIndex",e._zIndex)}})}(jQuery),function(a){a.widget("ui.droppable",{version:"@VERSION",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var b,c=this.options,d=c.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(d)?d:function(a){return a.is(d)},this.proportions=function(){return arguments.length?(b=arguments[0],void 0):b?b:b={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(c.scope),c.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(b){a.ui.ddmanager.droppables[b]=a.ui.ddmanager.droppables[b]||[],a.ui.ddmanager.droppables[b].push(this)},_splice:function(a){for(var b=0;b<a.length;b++)a[b]===this&&a.splice(b,1)},_destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];this._splice(b),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(b,c){if("accept"===b)this.accept=a.isFunction(c)?c:function(a){return a.is(c)};else if("scope"===b){var d=a.ui.ddmanager.droppables[this.options.scope];this._splice(d),this._addToManager(c)}this._super(b,c)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))
  },_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current,e=!1;return d&&(d.currentItem||d.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var b=a(this).droppable("instance");return b.options.greedy&&!b.options.disabled&&b.options.scope===d.options.scope&&b.accept.call(b.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(b,{offset:b.element.offset()}),b.options.tolerance)?(e=!0,!1):void 0}),e?!1:this.accept.call(this.element[0],d.currentItem||d.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element):!1):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.ui.intersect=function(){function a(a,b,c){return a>=b&&b+c>a}return function(b,c,d){if(!c.offset)return!1;var e,f,g=(b.positionAbs||b.position.absolute).left,h=(b.positionAbs||b.position.absolute).top,i=g+b.helperProportions.width,j=h+b.helperProportions.height,k=c.offset.left,l=c.offset.top,m=k+c.proportions().width,n=l+c.proportions().height;switch(d){case"fit":return g>=k&&m>=i&&h>=l&&n>=j;case"intersect":return k<g+b.helperProportions.width/2&&i-b.helperProportions.width/2<m&&l<h+b.helperProportions.height/2&&j-b.helperProportions.height/2<n;case"pointer":return e=(b.positionAbs||b.position.absolute).left+(b.clickOffset||b.offset.click).left,f=(b.positionAbs||b.position.absolute).top+(b.clickOffset||b.offset.click).top,a(f,l,c.proportions().height)&&a(e,k,c.proportions().width);case"touch":return(h>=l&&n>=h||j>=l&&n>=j||l>h&&j>n)&&(g>=k&&m>=g||i>=k&&m>=i||k>g&&i>m);default:return!1}}}(),a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d,e,f=a.ui.ddmanager.droppables[b.options.scope]||[],g=c?c.type:null,h=(b.currentItem||b.element).find(":data(ui-droppable)").addBack();a:for(d=0;d<f.length;d++)if(!(f[d].options.disabled||b&&!f[d].accept.call(f[d].element[0],b.currentItem||b.element))){for(e=0;e<h.length;e++)if(h[e]===f[d].element[0]){f[d].proportions().height=0;continue a}f[d].visible="none"!==f[d].element.css("display"),f[d].visible&&("mousedown"===g&&f[d]._activate.call(f[d],c),f[d].offset=f[d].element.offset(),f[d].proportions({width:f[d].element[0].offsetWidth,height:f[d].element[0].offsetHeight}))}},drop:function(b,c){var d=!1;return a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,c)))}),d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var d,e,f,g=a.ui.intersect(b,this,this.options.tolerance),h=!g&&this.isover?"isout":g&&!this.isover?"isover":null;h&&(this.options.greedy&&(e=this.options.scope,f=this.element.parents(":data(ui-droppable)").filter(function(){return a(this).droppable("instance").options.scope===e}),f.length&&(d=a(f[0]).droppable("instance"),d.greedyChild="isover"===h)),d&&"isover"===h&&(d.isover=!1,d.isout=!0,d._out.call(d,c)),this[h]=!0,this["isout"===h?"isover":"isout"]=!1,this["isover"===h?"_over":"_out"].call(this,c),d&&"isout"===h&&(d.isout=!1,d.isover=!0,d._over.call(d,c)))}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}}}(jQuery),function(a){a.widget("ui.resizable",a.ui.mouse,{version:"@VERSION",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(a){return parseInt(a,10)||0},_isNumber:function(a){return!isNaN(parseInt(a,10))},_hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)},_create:function(){var b,c,d,e,f,g=this,h=this.options;if(this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(a("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=h.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),b=this.handles.split(","),this.handles={},c=0;c<b.length;c++)d=a.trim(b[c]),f="ui-resizable-"+d,e=a("<div class='ui-resizable-handle "+f+"'></div>"),e.css({zIndex:h.zIndex}),"se"===d&&e.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[d]=".ui-resizable-"+d,this.element.append(e);this._renderAxis=function(b){var c,d,e,f;b=b||this.element;for(c in this.handles)this.handles[c].constructor===String&&(this.handles[c]=a(this.handles[c],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(d=a(this.handles[c],this.element),f=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),e=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),b.css(e,f),this._proportionallyResize()),a(this.handles[c]).length},this._renderAxis(this.element),this._handles=a(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){g.resizing||(this.className&&(e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),g.axis=e&&e[1]?e[1]:"se")}),h.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").mouseenter(function(){h.disabled||(a(this).removeClass("ui-resizable-autohide"),g._handles.show())}).mouseleave(function(){h.disabled||g.resizing||(a(this).addClass("ui-resizable-autohide"),g._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var b,c=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(c(this.element),b=this.element,this.originalElement.css({position:b.css("position"),width:b.outerWidth(),height:b.outerHeight(),top:b.css("top"),left:b.css("left")}).insertAfter(b),b.remove()),this.originalElement.css("resize",this.originalResizeStyle),c(this.originalElement),this},_mouseCapture:function(b){var c,d,e=!1;for(c in this.handles)d=a(this.handles[c])[0],(d===b.target||a.contains(d,b.target))&&(e=!0);return!this.options.disabled&&e},_mouseStart:function(b){var c,d,e,f=this.options,g=this.element.position(),h=this.element;return this.resizing=!0,/absolute/.test(h.css("position"))?h.css({position:"absolute",top:h.css("top"),left:h.css("left")}):h.is(".ui-draggable")&&h.css({position:"absolute",top:g.top,left:g.left}),this._renderProxy(),c=this._num(this.helper.css("left")),d=this._num(this.helper.css("top")),f.containment&&(c+=a(f.containment).scrollLeft()||0,d+=a(f.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:c,top:d},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:h.width(),height:h.height()},this.originalSize=this._helper?{width:h.outerWidth(),height:h.outerHeight()}:{width:h.width(),height:h.height()},this.originalPosition={left:c,top:d},this.sizeDiff={width:h.outerWidth()-h.width(),height:h.outerHeight()-h.height()},this.originalMousePosition={left:b.pageX,top:b.pageY},this.aspectRatio="number"==typeof f.aspectRatio?f.aspectRatio:this.originalSize.width/this.originalSize.height||1,e=a(".ui-resizable-"+this.axis).css("cursor"),a("body").css("cursor","auto"===e?this.axis+"-resize":e),h.addClass("ui-resizable-resizing"),this._propagate("start",b),!0},_mouseDrag:function(b){var c,d=this.helper,e={},f=this.originalMousePosition,g=this.axis,h=this.position.top,i=this.position.left,j=this.size.width,k=this.size.height,l=b.pageX-f.left||0,m=b.pageY-f.top||0,n=this._change[g];return n?(c=n.apply(this,[b,l,m]),this._updateVirtualBoundaries(b.shiftKey),(this._aspectRatio||b.shiftKey)&&(c=this._updateRatio(c,b)),c=this._respectSize(c,b),this._updateCache(c),this._propagate("resize",b),this.position.top!==h&&(e.top=this.position.top+"px"),this.position.left!==i&&(e.left=this.position.left+"px"),this.size.width!==j&&(e.width=this.size.width+"px"),this.size.height!==k&&(e.height=this.size.height+"px"),d.css(e),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),a.isEmptyObject(e)||this._trigger("resize",b,this.ui()),!1):!1},_mouseStop:function(b){this.resizing=!1;var c,d,e,f,g,h,i,j=this.options,k=this;return this._helper&&(c=this._proportionallyResizeElements,d=c.length&&/textarea/i.test(c[0].nodeName),e=d&&this._hasScroll(c[0],"left")?0:k.sizeDiff.height,f=d?0:k.sizeDiff.width,g={width:k.helper.width()-f,height:k.helper.height()-e},h=parseInt(k.element.css("left"),10)+(k.position.left-k.originalPosition.left)||null,i=parseInt(k.element.css("top"),10)+(k.position.top-k.originalPosition.top)||null,j.animate||this.element.css(a.extend(g,{top:i,left:h})),k.helper.height(k.size.height),k.helper.width(k.size.width),this._helper&&!j.animate&&this._proportionallyResize()),a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(a){var b,c,d,e,f,g=this.options;f={minWidth:this._isNumber(g.minWidth)?g.minWidth:0,maxWidth:this._isNumber(g.maxWidth)?g.maxWidth:1/0,minHeight:this._isNumber(g.minHeight)?g.minHeight:0,maxHeight:this._isNumber(g.maxHeight)?g.maxHeight:1/0},(this._aspectRatio||a)&&(b=f.minHeight*this.aspectRatio,d=f.minWidth/this.aspectRatio,c=f.maxHeight*this.aspectRatio,e=f.maxWidth/this.aspectRatio,b>f.minWidth&&(f.minWidth=b),d>f.minHeight&&(f.minHeight=d),c<f.maxWidth&&(f.maxWidth=c),e<f.maxHeight&&(f.maxHeight=e)),this._vBoundaries=f},_updateCache:function(a){this.offset=this.helper.offset(),this._isNumber(a.left)&&(this.position.left=a.left),this._isNumber(a.top)&&(this.position.top=a.top),this._isNumber(a.height)&&(this.size.height=a.height),this._isNumber(a.width)&&(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,c=this.size,d=this.axis;return this._isNumber(a.height)?a.width=a.height*this.aspectRatio:this._isNumber(a.width)&&(a.height=a.width/this.aspectRatio),"sw"===d&&(a.left=b.left+(c.width-a.width),a.top=null),"nw"===d&&(a.top=b.top+(c.height-a.height),a.left=b.left+(c.width-a.width)),a},_respectSize:function(a){var b=this._vBoundaries,c=this.axis,d=this._isNumber(a.width)&&b.maxWidth&&b.maxWidth<a.width,e=this._isNumber(a.height)&&b.maxHeight&&b.maxHeight<a.height,f=this._isNumber(a.width)&&b.minWidth&&b.minWidth>a.width,g=this._isNumber(a.height)&&b.minHeight&&b.minHeight>a.height,h=this.originalPosition.left+this.originalSize.width,i=this.position.top+this.size.height,j=/sw|nw|w/.test(c),k=/nw|ne|n/.test(c);return f&&(a.width=b.minWidth),g&&(a.height=b.minHeight),d&&(a.width=b.maxWidth),e&&(a.height=b.maxHeight),f&&j&&(a.left=h-b.minWidth),d&&j&&(a.left=h-b.maxWidth),g&&k&&(a.top=i-b.minHeight),e&&k&&(a.top=i-b.maxHeight),a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null,a},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var a,b,c,d,e,f=this.helper||this.element;for(a=0;a<this._proportionallyResizeElements.length;a++){if(e=this._proportionallyResizeElements[a],!this.borderDif)for(this.borderDif=[],c=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],d=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")],b=0;b<c.length;b++)this.borderDif[b]=(parseInt(c[b],10)||0)+(parseInt(d[b],10)||0);e.css({height:f.height()-this.borderDif[0]-this.borderDif[2]||0,width:f.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset(),this._helper?(this.helper=this.helper||a("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){var c=this.originalSize,d=this.originalPosition;return{left:d.left+b,width:c.width-b}},n:function(a,b,c){var d=this.originalSize,e=this.originalPosition;return{top:e.top+c,height:d.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),"resize"!==b&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.ui.plugin.add("resizable","animate",{stop:function(b){var c=a(this).resizable("instance"),d=c.options,e=c._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&c._hasScroll(e[0],"left")?0:c.sizeDiff.height,h=f?0:c.sizeDiff.width,i={width:c.size.width-h,height:c.size.height-g},j=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,k=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;c.element.animate(a.extend(i,k&&j?{top:k,left:j}:{}),{duration:d.animateDuration,easing:d.animateEasing,step:function(){var d={width:parseInt(c.element.css("width"),10),height:parseInt(c.element.css("height"),10),top:parseInt(c.element.css("top"),10),left:parseInt(c.element.css("left"),10)};e&&e.length&&a(e[0]).css({width:d.width,height:d.height}),c._updateCache(d),c._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(){var b,c,d,e,f,g,h,i=a(this).resizable("instance"),j=i.options,k=i.element,l=j.containment,m=l instanceof a?l.get(0):/parent/.test(l)?k.parent().get(0):l;m&&(i.containerElement=a(m),/document/.test(l)||l===document?(i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}):(b=a(m),c=[],a(["Top","Right","Left","Bottom"]).each(function(a,d){c[a]=i._num(b.css("padding"+d))}),i.containerOffset=b.offset(),i.containerPosition=b.position(),i.containerSize={height:b.innerHeight()-c[3],width:b.innerWidth()-c[1]},d=i.containerOffset,e=i.containerSize.height,f=i.containerSize.width,g=i._hasScroll(m,"left")?m.scrollWidth:f,h=i._hasScroll(m)?m.scrollHeight:e,i.parentData={element:m,left:d.left,top:d.top,width:g,height:h}))},resize:function(b){var c,d,e,f,g=a(this).resizable("instance"),h=g.options,i=g.containerOffset,j=g.position,k=g._aspectRatio||b.shiftKey,l={top:0,left:0},m=g.containerElement;m[0]!==document&&/static/.test(m.css("position"))&&(l=i),j.left<(g._helper?i.left:0)&&(g.size.width=g.size.width+(g._helper?g.position.left-i.left:g.position.left-l.left),k&&(g.size.height=g.size.width/g.aspectRatio),g.position.left=h.helper?i.left:0),j.top<(g._helper?i.top:0)&&(g.size.height=g.size.height+(g._helper?g.position.top-i.top:g.position.top),k&&(g.size.width=g.size.height*g.aspectRatio),g.position.top=g._helper?i.top:0),g.offset.left=g.parentData.left+g.position.left,g.offset.top=g.parentData.top+g.position.top,c=Math.abs((g._helper?g.offset.left-l.left:g.offset.left-l.left)+g.sizeDiff.width),d=Math.abs((g._helper?g.offset.top-l.top:g.offset.top-i.top)+g.sizeDiff.height),e=g.containerElement.get(0)===g.element.parent().get(0),f=/relative|absolute/.test(g.containerElement.css("position")),e&&f&&(c-=Math.abs(g.parentData.left)),c+g.size.width>=g.parentData.width&&(g.size.width=g.parentData.width-c,k&&(g.size.height=g.size.width/g.aspectRatio)),d+g.size.height>=g.parentData.height&&(g.size.height=g.parentData.height-d,k&&(g.size.width=g.size.height*g.aspectRatio))},stop:function(){var b=a(this).resizable("instance"),c=b.options,d=b.containerOffset,e=b.containerPosition,f=b.containerElement,g=a(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width,j=g.outerHeight()-b.sizeDiff.height;b._helper&&!c.animate&&/relative/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j}),b._helper&&!c.animate&&/static/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j})}}),a.ui.plugin.add("resizable","alsoResize",{start:function(){var b=a(this).resizable("instance"),c=b.options,d=function(b){a(b).each(function(){var b=a(this);b.data("ui-resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10)})})};"object"!=typeof c.alsoResize||c.alsoResize.parentNode?d(c.alsoResize):c.alsoResize.length?(c.alsoResize=c.alsoResize[0],d(c.alsoResize)):a.each(c.alsoResize,function(a){d(a)})},resize:function(b,c){var d=a(this).resizable("instance"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0},i=function(b,d){a(b).each(function(){var b=a(this),e=a(this).data("ui-resizable-alsoresize"),f={},g=d&&d.length?d:b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(g,function(a,b){var c=(e[b]||0)+(h[b]||0);c&&c>=0&&(f[b]=c||null)}),b.css(f)})};"object"!=typeof e.alsoResize||e.alsoResize.nodeType?i(e.alsoResize):a.each(e.alsoResize,function(a,b){i(a,b)})},stop:function(){a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","ghost",{start:function(){var b=a(this).resizable("instance"),c=b.options,d=b.size;b.ghost=b.originalElement.clone(),b.ghost.css({opacity:.25,display:"block",position:"relative",height:d.height,width:d.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof c.ghost?c.ghost:""),b.ghost.appendTo(b.helper)},resize:function(){var b=a(this).resizable("instance");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=a(this).resizable("instance");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(){var b=a(this).resizable("instance"),c=b.options,d=b.size,e=b.originalSize,f=b.originalPosition,g=b.axis,h="number"==typeof c.grid?[c.grid,c.grid]:c.grid,i=h[0]||1,j=h[1]||1,k=Math.round((d.width-e.width)/i)*i,l=Math.round((d.height-e.height)/j)*j,m=e.width+k,n=e.height+l,o=c.maxWidth&&c.maxWidth<m,p=c.maxHeight&&c.maxHeight<n,q=c.minWidth&&c.minWidth>m,r=c.minHeight&&c.minHeight>n;c.grid=h,q&&(m+=i),r&&(n+=j),o&&(m-=i),p&&(n-=j),/^(se|s|e)$/.test(g)?(b.size.width=m,b.size.height=n):/^(ne)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.top=f.top-l):/^(sw)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.left=f.left-k):(b.size.width=m,b.size.height=n,b.position.top=f.top-l,b.position.left=f.left-k)}})}(jQuery),function(a){a.widget("ui.sortable",a.ui.mouse,{version:"@VERSION",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(a,b,c){return a>=b&&b+c>a},_isFloating:function(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===a.axis||this._isFloating(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(b,c){var d=null,e=!1,f=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(b),a(b.target).parents().each(function(){return a.data(this,f.widgetName+"-item")===f?(d=a(this),!1):void 0}),a.data(b.target,f.widgetName+"-item")===f&&(d=a(b.target)),d?!this.options.handle||c||(a(this.options.handle,d).find("*").addBack().each(function(){this===b.target&&(e=!0)}),e)?(this.currentItem=d,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(b,c,d){var e,f,g=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),g.containment&&this._setContainment(),g.cursor&&"auto"!==g.cursor&&(f=this.document.find("body"),this.storedCursor=f.css("cursor"),f.css("cursor",g.cursor),this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(f)),g.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",g.opacity)),g.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",g.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var c,d,e,f,g=this.options,h=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+g.scrollSpeed:b.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-g.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+g.scrollSpeed:b.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-g.scrollSpeed)):(b.pageY-a(document).scrollTop()<g.scrollSensitivity?h=a(document).scrollTop(a(document).scrollTop()-g.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<g.scrollSensitivity&&(h=a(document).scrollTop(a(document).scrollTop()+g.scrollSpeed)),b.pageX-a(document).scrollLeft()<g.scrollSensitivity?h=a(document).scrollLeft(a(document).scrollLeft()-g.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<g.scrollSensitivity&&(h=a(document).scrollLeft(a(document).scrollLeft()+g.scrollSpeed))),h!==!1&&a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=d.item[0],f=this._intersectsWithPointer(d),f&&d.instance===this.currentContainer&&e!==this.currentItem[0]&&this.placeholder[1===f?"next":"prev"]()[0]!==e&&!a.contains(this.placeholder[0],e)&&("semi-dynamic"===this.options.type?!a.contains(this.element[0],e):!0)){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d))break;this._rearrange(b,d),this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset(),f=this.options.axis,g={};f&&"x"!==f||(g.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),f&&"y"!==f||(g.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l="x"===this.options.axis||d+j>h&&i>d+j,m="y"===this.options.axis||b+k>f&&g>b+k,n=l&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?n:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(a){var b="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top,a.height),c="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,a.left,a.width),d=b&&c,e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return d?this.floating?f&&"right"===f||"down"===e?2:1:e&&("down"===e?2:1):!1},_intersectsWithSides:function(a){var b=this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),c=this._isOverAxis(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),d=this._getDragVerticalDirection(),e=this._getDragHorizontalDirection();return this.floating&&e?"right"===e&&c||"left"===e&&!c:d&&("down"===d&&b||"up"===d&&!b)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this
  },_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){function j(){g.push(this)}var c,d,e,f,g=[],h=[],i=this._connectWith();if(i&&b)for(c=i.length-1;c>=0;c--)for(e=a(i[c]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&h.push([a.isFunction(f.options.items)?f.options.items.call(f.element):a(f.options.items,f.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),f]);for(h.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),c=h.length-1;c>=0;c--)h[c][0].each(j);return a(g)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c,d,e,f,g,h,i,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(c=m.length-1;c>=0;c--)for(e=a(m[c]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&(l.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],b,{item:this.currentItem}):a(f.options.items,f.element),f]),this.containers.push(f));for(c=l.length-1;c>=0;c--)for(g=l[c][1],h=l[c][0],d=0,j=h.length;j>d;d++)i=a(h[d]),i.data(this.widgetName+"-item",g),k.push({item:i,instance:g,width:0,height:0,left:0,top:0})},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var c,d,e,f;for(c=this.items.length-1;c>=0;c--)d=this.items[c],d.instance!==this.currentContainer&&this.currentContainer&&d.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item,b||(d.width=e.outerWidth(),d.height=e.outerHeight()),f=e.offset(),d.left=f.left,d.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){b=b||this;var c,d=b.options;d.placeholder&&d.placeholder.constructor!==String||(c=d.placeholder,d.placeholder={element:function(){var d=b.currentItem[0].nodeName.toLowerCase(),e=a("<"+d+">",b.document[0]).addClass(c||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===d?b.currentItem.children().each(function(){a("<td>&#160;</td>",b.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(e)}):"img"===d&&e.attr("src",b.currentItem.attr("src")),c||e.css("visibility","hidden"),e},update:function(a,e){(!c||d.forcePlaceholderSize)&&(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}),b.placeholder=a(d.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),d.placeholder.update(b,b.placeholder)},_contactContainers:function(b){var c,d,e,f,g,h,i,j,k,l,m=null,n=null;for(c=this.containers.length-1;c>=0;c--)if(!a.contains(this.currentItem[0],this.containers[c].element[0]))if(this._intersectsWith(this.containers[c].containerCache)){if(m&&a.contains(this.containers[c].element[0],m.element[0]))continue;m=this.containers[c],n=c}else this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",b,this._uiHash(this)),this.containers[c].containerCache.over=0);if(m)if(1===this.containers.length)this.containers[n].containerCache.over||(this.containers[n]._trigger("over",b,this._uiHash(this)),this.containers[n].containerCache.over=1);else{for(e=1e4,f=null,k=m.floating||this._isFloating(this.currentItem),g=k?"left":"top",h=k?"width":"height",l=k?"clientX":"clientY",d=this.items.length-1;d>=0;d--)a.contains(this.containers[n].element[0],this.items[d].item[0])&&this.items[d].item[0]!==this.currentItem[0]&&(i=this.items[d].item.offset()[g],j=!1,b[l]-i>this.items[d][h]/2&&(j=!0),Math.abs(b[l]-i)<e&&(e=Math.abs(b[l]-i),f=this.items[d],this.direction=j?"up":"down"));if(!f&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[n])return;f?this._rearrange(b,f,null,!0):this._rearrange(b,null,this.containers[n].element,!0),this._trigger("change",b,this._uiHash()),this.containers[n]._trigger("change",b,this._uiHash(this)),this.currentContainer=this.containers[n],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",b,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"===c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!==c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!d[0].style.width||c.forceHelperSize)&&d.width(this.currentItem.width()),(!d[0].style.height||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),("document"===e.containment||"window"===e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"===e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e=this.options,f=b.pageX,g=b.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),e.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-e.grid[1]:c+e.grid[1]:c,d=this.originalPageX+Math.round((f-this.originalPageX)/e.grid[0])*e.grid[0],f=this.containment?d-this.offset.click.left>=this.containment[0]&&d-this.offset.click.left<=this.containment[2]?d:d-this.offset.click.left>=this.containment[0]?d-e.grid[0]:d+e.grid[0]:d)),{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){function e(a,b,c){return function(d){c._trigger(a,d,b._uiHash(b))}}this.reverting=!1;var c,d=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(c in this._storedCSS)("auto"===this._storedCSS[c]||"static"===this._storedCSS[c])&&(this._storedCSS[c]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!b&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||b||d.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(b||(d.push(function(a){this._trigger("remove",a,this._uiHash())}),d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)))),c=this.containers.length-1;c>=0;c--)b||d.push(e("deactivate",this,this.containers[c])),this.containers[c].containerCache.over&&(d.push(e("out",this,this.containers[c])),this.containers[c].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!b){for(this._trigger("beforeStop",a,this._uiHash()),c=0;c<d.length;c++)d[c].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!1}if(b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!b){for(c=0;c<d.length;c++)d[c].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}(jQuery),function(a){a.widget("ui.accordion",{version:"@VERSION",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var b=this.options;this.prevShow=this.prevHide=a(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),b.collapsible||b.active!==!1&&null!=b.active||(b.active=0),this._processPanels(),b.active<0&&(b.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():a()}},_createIcons:function(){var b=this.options.icons;b&&(a("<span>").addClass("ui-accordion-header-icon ui-icon "+b.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(b.header).addClass(b.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var a;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),a=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&a.css("height","")},_setOption:function(a,b){return"active"===a?(this._activate(b),void 0):("event"===a&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(b)),this._super(a,b),"collapsible"!==a||b||this.options.active!==!1||this._activate(0),"icons"===a&&(this._destroyIcons(),b&&this._createIcons()),"disabled"===a&&(this.element.toggleClass("ui-state-disabled",!!b).attr("aria-disabled",b),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!b)),void 0)},_keydown:function(b){if(!b.altKey&&!b.ctrlKey){var c=a.ui.keyCode,d=this.headers.length,e=this.headers.index(b.target),f=!1;switch(b.keyCode){case c.RIGHT:case c.DOWN:f=this.headers[(e+1)%d];break;case c.LEFT:case c.UP:f=this.headers[(e-1+d)%d];break;case c.SPACE:case c.ENTER:this._eventHandler(b);break;case c.HOME:f=this.headers[0];break;case c.END:f=this.headers[d-1]}f&&(a(b.target).attr("tabIndex",-1),a(f).attr("tabIndex",0),f.focus(),b.preventDefault())}},_panelKeyDown:function(b){b.keyCode===a.ui.keyCode.UP&&b.ctrlKey&&a(b.currentTarget).prev().focus()},refresh:function(){var b=this.options;this._processPanels(),b.active===!1&&b.collapsible===!0||!this.headers.length?(b.active=!1,this.active=a()):b.active===!1?this._activate(0):this.active.length&&!a.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(b.active=!1,this.active=a()):this._activate(Math.max(0,b.active-1)):b.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var b,c=this.options,d=c.heightStyle,e=this.element.parent();this.active=this._findActive(c.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var b=a(this),c=b.uniqueId().attr("id"),d=b.next(),e=d.uniqueId().attr("id");b.attr("aria-controls",e),d.attr("aria-labelledby",c)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(c.event),"fill"===d?(b=e.height(),this.element.siblings(":visible").each(function(){var c=a(this),d=c.css("position");"absolute"!==d&&"fixed"!==d&&(b-=c.outerHeight(!0))}),this.headers.each(function(){b-=a(this).outerHeight(!0)}),this.headers.next().each(function(){a(this).height(Math.max(0,b-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")):"auto"===d&&(b=0,this.headers.next().each(function(){b=Math.max(b,a(this).css("height","").height())}).height(b))},_activate:function(b){var c=this._findActive(b)[0];c!==this.active[0]&&(c=c||this.active[0],this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop}))},_findActive:function(b){return"number"==typeof b?this.headers.eq(b):a()},_setupEvents:function(b){var c={keydown:"_keydown"};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,c),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(b){var c=this.options,d=this.active,e=a(b.currentTarget),f=e[0]===d[0],g=f&&c.collapsible,h=g?a():e.next(),i=d.next(),j={oldHeader:d,oldPanel:i,newHeader:g?a():e,newPanel:h};b.preventDefault(),f&&!c.collapsible||this._trigger("beforeActivate",b,j)===!1||(c.active=g?!1:this.headers.index(e),this.active=f?a():e,this._toggle(j),d.removeClass("ui-accordion-header-active ui-state-active"),c.icons&&d.children(".ui-accordion-header-icon").removeClass(c.icons.activeHeader).addClass(c.icons.header),f||(e.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),c.icons&&e.children(".ui-accordion-header-icon").removeClass(c.icons.header).addClass(c.icons.activeHeader),e.next().addClass("ui-accordion-content-active")))},_toggle:function(b){var c=b.newPanel,d=this.prevShow.length?this.prevShow:b.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=c,this.prevHide=d,this.options.animate?this._animate(c,d,b):(d.hide(),c.show(),this._toggleComplete(b)),d.attr({"aria-hidden":"true"}),d.prev().attr("aria-selected","false"),c.length&&d.length?d.prev().attr({tabIndex:-1,"aria-expanded":"false"}):c.length&&this.headers.filter(function(){return 0===a(this).attr("tabIndex")}).attr("tabIndex",-1),c.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(a,b,c){var d,e,f,g=this,h=0,i=a.length&&(!b.length||a.index()<b.index()),j=this.options.animate||{},k=i&&j.down||j,l=function(){g._toggleComplete(c)};return"number"==typeof k&&(f=k),"string"==typeof k&&(e=k),e=e||k.easing||j.easing,f=f||k.duration||j.duration,b.length?a.length?(d=a.show().outerHeight(),b.animate(this.hideProps,{duration:f,easing:e,step:function(a,b){b.now=Math.round(a)}}),a.hide().animate(this.showProps,{duration:f,easing:e,complete:l,step:function(a,c){c.now=Math.round(a),"height"!==c.prop?h+=c.now:"content"!==g.options.heightStyle&&(c.now=Math.round(d-b.outerHeight()-h),h=0)}}),void 0):b.animate(this.hideProps,f,e,l):a.animate(this.showProps,f,e,l)},_toggleComplete:function(a){var b=a.oldPanel;b.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),b.length&&(b.parent()[0].className=b.parent()[0].className),this._trigger("activate",null,a)}})}(jQuery),function(a){a.widget("ui.slider",a.ui.mouse,{version:"@VERSION",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var b,c,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=[];for(c=d.values&&d.values.length||1,e.length>c&&(e.slice(c).remove(),e=e.slice(0,c)),b=e.length;c>b;b++)g.push(f);this.handles=e.add(a(g.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(b){a(this).data("ui-slider-handle-index",b)})},_createRange:function(){var b=this.options,c="";b.range?(b.range===!0&&(b.values?b.values.length&&2!==b.values.length?b.values=[b.values[0],b.values[0]]:a.isArray(b.values)&&(b.values=b.values.slice(0)):b.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=a("<div></div>").appendTo(this.element),c="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(c+("min"===b.range||"max"===b.range?" ui-slider-range-"+b.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var a=this.handles.add(this.range).filter("a");this._off(a),this._on(a,this._handleEvents),this._hoverable(a),this._focusable(a)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(b){var c,d,e,f,g,h,i,j,k=this,l=this.options;return l.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),c={x:b.pageX,y:b.pageY},d=this._normValueFromMouse(c),e=this._valueMax()-this._valueMin()+1,this.handles.each(function(b){var c=Math.abs(d-k.values(b));(e>c||e===c&&(b===k._lastChangedValue||k.values(b)===l.min))&&(e=c,f=a(this),g=b)}),h=this._start(b,g),h===!1?!1:(this._mouseSliding=!0,this._handleIndex=g,f.addClass("ui-state-active").focus(),i=f.offset(),j=!a(b.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=j?{left:0,top:0}:{left:b.pageX-i.left-f.width()/2,top:b.pageY-i.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,g,d),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return"horizontal"===this.orientation?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),0>d&&(d=0),"vertical"===this.orientation&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),2===this.options.values.length&&this.options.range===!0&&(0===b&&c>d||1===b&&d>c)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._lastChangedValue=b,this._trigger("change",a,c)}},value:function(a){return arguments.length?(this.options.value=this._trimAlignValue(a),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(b,c){var d,e,f;if(arguments.length>1)return this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),this._change(null,b),void 0;if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();for(d=this.options.values,e=arguments[0],f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;switch("range"===b&&this.options.range===!0&&("min"===c?(this.options.value=this._values(0),this.options.values=null):"max"===c&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),a.isArray(this.options.values)&&(e=this.options.values.length),"disabled"===b&&this.element.toggleClass("ui-state-disabled",!!c),this._super(b,c),b){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),d=0;e>d;d+=1)this._change(null,d);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b);if(this.options.values&&this.options.values.length){for(c=this.options.values.slice(),d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c}return[]},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return 2*Math.abs(c)>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b,c,d,e,f,g=this.options.range,h=this.options,i=this,j=this._animateOff?!1:h.animate,k={};this.options.values&&this.options.values.length?this.handles.each(function(d){c=100*((i.values(d)-i._valueMin())/(i._valueMax()-i._valueMin())),k["horizontal"===i.orientation?"left":"bottom"]=c+"%",a(this).stop(1,1)[j?"animate":"css"](k,h.animate),i.options.range===!0&&("horizontal"===i.orientation?(0===d&&i.range.stop(1,1)[j?"animate":"css"]({left:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({width:c-b+"%"},{queue:!1,duration:h.animate})):(0===d&&i.range.stop(1,1)[j?"animate":"css"]({bottom:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({height:c-b+"%"},{queue:!1,duration:h.animate}))),b=c}):(d=this.value(),e=this._valueMin(),f=this._valueMax(),c=f!==e?100*((d-e)/(f-e)):0,k["horizontal"===this.orientation?"left":"bottom"]=c+"%",this.handle.stop(1,1)[j?"animate":"css"](k,h.animate),"min"===g&&"horizontal"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({width:c+"%"},h.animate),"max"===g&&"horizontal"===this.orientation&&this.range[j?"animate":"css"]({width:100-c+"%"},{queue:!1,duration:h.animate}),"min"===g&&"vertical"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({height:c+"%"},h.animate),"max"===g&&"vertical"===this.orientation&&this.range[j?"animate":"css"]({height:100-c+"%"},{queue:!1,duration:h.animate}))},_handleEvents:{keydown:function(b){var c,d,e,f,g=a(b.target).data("ui-slider-handle-index");switch(b.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(b.preventDefault(),!this._keySliding&&(this._keySliding=!0,a(b.target).addClass("ui-state-active"),c=this._start(b,g),c===!1))return}switch(f=this.options.step,d=e=this.options.values&&this.options.values.length?this.values(g):this.value(),b.keyCode){case a.ui.keyCode.HOME:e=this._valueMin();break;case a.ui.keyCode.END:e=this._valueMax();break;case a.ui.keyCode.PAGE_UP:e=this._trimAlignValue(d+(this._valueMax()-this._valueMin())/this.numPages);break;case a.ui.keyCode.PAGE_DOWN:e=this._trimAlignValue(d-(this._valueMax()-this._valueMin())/this.numPages);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(d===this._valueMax())return;e=this._trimAlignValue(d+f);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(d===this._valueMin())return;e=this._trimAlignValue(d-f)}this._slide(b,g,e)},click:function(a){a.preventDefault()},keyup:function(b){var c=a(b.target).data("ui-slider-handle-index");
  this._keySliding&&(this._keySliding=!1,this._stop(b,c),this._change(b,c),a(b.target).removeClass("ui-state-active"))}}})}(jQuery);
}
if (!window.Hogan) {
  var Hogan={};!function(a,b){function i(a){return String(null===a||void 0===a?"":a)}function j(a){return a=i(a),h.test(a)?a.replace(c,"&amp;").replace(d,"&lt;").replace(e,"&gt;").replace(f,"&#39;").replace(g,"&quot;"):a}a.Template=function(a,c,d,e){this.r=a||this.r,this.c=d,this.options=e,this.text=c||"",this.buf=b?[]:""},a.Template.prototype={r:function(){return""},v:j,t:i,render:function(a,b,c){return this.ri([a],b||{},c)},ri:function(a,b,c){return this.r(a,b,c)},rp:function(a,b,c,d){var e=c[a];return e?(this.c&&"string"==typeof e&&(e=this.c.compile(e,this.options)),e.ri(b,c,d)):""},rs:function(a,b,c){var d=a[a.length-1];if(!k(d))return c(a,b,this),void 0;for(var e=0;e<d.length;e++)a.push(d[e]),c(a,b,this),a.pop()},s:function(a,b,c,d,e,f,g){var h;return k(a)&&0===a.length?!1:("function"==typeof a&&(a=this.ls(a,b,c,d,e,f,g)),h=""===a||!!a,!d&&h&&b&&b.push("object"==typeof a?a:b[b.length-1]),h)},d:function(a,b,c,d){var e=a.split("."),f=this.f(e[0],b,c,d),g=null;if("."===a&&k(b[b.length-2]))return b[b.length-1];for(var h=1;h<e.length;h++)f&&"object"==typeof f&&e[h]in f?(g=f,f=f[e[h]]):f="";return d&&!f?!1:(d||"function"!=typeof f||(b.push(g),f=this.lv(f,b,c),b.pop()),f)},f:function(a,b,c,d){for(var e=!1,f=null,g=!1,h=b.length-1;h>=0;h--)if(f=b[h],f&&"object"==typeof f&&a in f){e=f[a],g=!0;break}return g?(d||"function"!=typeof e||(e=this.lv(e,b,c)),e):d?!1:""},ho:function(a,b,c,d,e){var f=this.c,g=this.options;g.delimiters=e;var d=a.call(b,d);return d=null==d?String(d):d.toString(),this.b(f.compile(d,g).render(b,c)),!1},b:b?function(a){this.buf.push(a)}:function(a){this.buf+=a},fl:b?function(){var a=this.buf.join("");return this.buf=[],a}:function(){var a=this.buf;return this.buf="",a},ls:function(a,b,c,d,e,f,g){var h=b[b.length-1],i=null;if(!d&&this.c&&a.length>0)return this.ho(a,h,c,this.text.substring(e,f),g);if(i=a.call(h),"function"==typeof i){if(d)return!0;if(this.c)return this.ho(i,h,c,this.text.substring(e,f),g)}return i},lv:function(a,b,c){var d=b[b.length-1],e=a.call(d);return"function"==typeof e&&(e=i(e.call(d)),this.c&&~e.indexOf("{{"))?this.c.compile(e,this.options).render(d,c):i(e)}};var c=/&/g,d=/</g,e=/>/g,f=/\'/g,g=/\"/g,h=/[&<>\"\']/,k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}}("undefined"!=typeof exports?exports:Hogan),function(a){function h(a){"}"===a.n.substr(a.n.length-1)&&(a.n=a.n.substring(0,a.n.length-1))}function i(a){return a.trim?a.trim():a.replace(/^\s*|\s*$/g,"")}function j(a,b,c){if(b.charAt(c)!=a.charAt(0))return!1;for(var d=1,e=a.length;e>d;d++)if(b.charAt(c+d)!=a.charAt(d))return!1;return!0}function k(a,b,c,d){for(var e=[],f=null,g=null;a.length>0;)if(g=a.shift(),"#"==g.tag||"^"==g.tag||l(g,d))c.push(g),g.nodes=k(a,g.tag,c,d),e.push(g);else{if("/"==g.tag){if(0===c.length)throw new Error("Closing tag without opener: /"+g.n);if(f=c.pop(),g.n!=f.n&&!m(g.n,f.n,d))throw new Error("Nesting error: "+f.n+" vs. "+g.n);return f.end=g.i,e}e.push(g)}if(c.length>0)throw new Error("missing closing tag: "+c.pop().n);return e}function l(a,b){for(var c=0,d=b.length;d>c;c++)if(b[c].o==a.n)return a.tag="#",!0}function m(a,b,c){for(var d=0,e=c.length;e>d;d++)if(c[d].c==a&&c[d].o==b)return!0}function n(a){return a.replace(f,"\\\\").replace(c,'\\"').replace(d,"\\n").replace(e,"\\r")}function o(a){return~a.indexOf(".")?"d":"f"}function p(a){for(var b="",c=0,d=a.length;d>c;c++){var e=a[c].tag;"#"==e?b+=q(a[c].nodes,a[c].n,o(a[c].n),a[c].i,a[c].end,a[c].otag+" "+a[c].ctag):"^"==e?b+=r(a[c].nodes,a[c].n,o(a[c].n)):"<"==e||">"==e?b+=s(a[c]):"{"==e||"&"==e?b+=t(a[c].n,o(a[c].n)):"\n"==e?b+=v('"\\n"'+(a.length-1==c?"":" + i")):"_v"==e?b+=u(a[c].n,o(a[c].n)):void 0===e&&(b+=v('"'+n(a[c])+'"'))}return b}function q(a,b,c,d,e,f){return"if(_.s(_."+c+'("'+n(b)+'",c,p,1),'+"c,p,0,"+d+","+e+',"'+f+'")){'+"_.rs(c,p,"+"function(c,p,_){"+p(a)+"});c.pop();}"}function r(a,b,c){return"if(!_.s(_."+c+'("'+n(b)+'",c,p,1),c,p,1,0,0,"")){'+p(a)+"};"}function s(a){return'_.b(_.rp("'+n(a.n)+'",c,p,"'+(a.indent||"")+'"));'}function t(a,b){return"_.b(_.t(_."+b+'("'+n(a)+'",c,p,0)));'}function u(a,b){return"_.b(_.v(_."+b+'("'+n(a)+'",c,p,0)));'}function v(a){return"_.b("+a+");"}var b=/\S/,c=/\"/g,d=/\n/g,e=/\r/g,f=/\\/g,g={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};a.scan=function(a,c){function v(){o.length>0&&(p.push(new String(o)),o="")}function w(){for(var a=!0,c=s;c<p.length;c++)if(a=p[c].tag&&g[p[c].tag]<g._v||!p[c].tag&&null===p[c].match(b),!a)return!1;return a}function x(a,b){if(v(),a&&w())for(var d,c=s;c<p.length;c++)p[c].tag||((d=p[c+1])&&">"==d.tag&&(d.indent=p[c].toString()),p.splice(c,1));else b||p.push({tag:"\n"});q=!1,s=p.length}function y(a,b){var c="="+u,d=a.indexOf(c,b),e=i(a.substring(a.indexOf("=",b)+1,d)).split(" ");return t=e[0],u=e[1],d+c.length-1}var d=a.length,e=0,f=1,k=2,l=e,m=null,n=null,o="",p=[],q=!1,r=0,s=0,t="{{",u="}}";for(c&&(c=c.split(" "),t=c[0],u=c[1]),r=0;d>r;r++)l==e?j(t,a,r)?(--r,v(),l=f):"\n"==a.charAt(r)?x(q):o+=a.charAt(r):l==f?(r+=t.length-1,n=g[a.charAt(r+1)],m=n?a.charAt(r+1):"_v","="==m?(r=y(a,r),l=e):(n&&r++,l=k),q=r):j(u,a,r)?(p.push({tag:m,n:i(o),otag:t,ctag:u,i:"/"==m?q-u.length:r+t.length}),o="",r+=u.length-1,l=e,"{"==m&&("}}"==u?r++:h(p[p.length-1]))):o+=a.charAt(r);return x(q,!0),p},a.generate=function(b,c,d){var e='var _=this;_.b(i=i||"");'+p(b)+"return _.fl();";return d.asString?"function(c,p,i){"+e+";}":new a.Template(new Function("c","p","i",e),c,a,d)},a.parse=function(a,b,c){return c=c||{},k(a,"",[],c.sectionTags||[])},a.cache={},a.compile=function(a,b){b=b||{};var c=a+"||"+!!b.asString,d=this.cache[c];return d?d:(d=this.generate(this.parse(this.scan(a,b.delimiters),a,b),a,b),this.cache[c]=d)}}("undefined"!=typeof exports?exports:Hogan);
}

define('cdn.jquery', [], function() {return jQuery;});
define('cdn.jqueryui', [], function() {return jQuery;});
define('cdn.underscore', [], function() {return _;});
define('cdn.underscore.mixins', [], function() {return _;});
define('cdn.lodash', [], function() { return _; });
define('cdn.backbone', [], function() {return Backbone;});
define('cdn.marionette', [], function() {return Backbone.Marionette;});
define('cdn.processing', [], function() {return Processing;});
define('cdn.raphael', [], function() {return Raphael;});
define('cdn.hogan', [], function() {return Hogan;});
define('cdn.mustache', [], function() { return Hogan; });
define('cdn.mathjax', ['https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG&amp;delayStartupUntil=configured'], function() {
  MathJax.Hub.Config({
    config: ["MMLorHTML.js"],
    jax: ["input/TeX", "input/MathML", "input/AsciiMath", "output/HTML-CSS", "output/NativeMML"],
    extensions: ["tex2jax.js", "mml2jax.js", "asciimath2jax.js", "MathMenu.js", "MathZoom.js", "Safe.js"],
    TeX: {
      extensions: ["AMSmath.js", "AMSsymbols.js", "noErrors.js", "noUndefined.js"]
    },
    SVG: {
      scale: 110,
      blacker: 2
    },
    skipStartupTypeset: true,
    delayStartupUntil: 'configured',
    messageStyle: 'none'
  });
  MathJax.Hub.Configured();
  return MathJax;
});

define('backbone', [], function() {return Backbone;});
define('underscore', [], function() {return _;});
/*!
 * js-collab v0.2.6
 * lovingly baked from 151f0aa on 24. September 2014
 */
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        define('plugins/vs.collab',factory);
    }

    // Deprecate this as soon as player adopts loading API as AMD module
    if (!root.vs) {
      root.vs = {};
    }
    root.vs.collab = factory();
}(this, function () {
/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
//Going sloppy to avoid 'use strict' string cost, but strict practices should
//be followed.
/*jslint sloppy: true */
/*global setTimeout: false */

var requirejs, require, define;
(function (undef) {
    var main, req, makeMap, handlers,
        defined = {},
        waiting = {},
        config = {},
        defining = {},
        hasOwn = Object.prototype.hasOwnProperty,
        aps = [].slice;

    function hasProp(obj, prop) {
        return hasOwn.call(obj, prop);
    }

    /**
     * Given a relative module name, like ./something, normalize it to
     * a real name that can be mapped to a path.
     * @param {String} name the relative name
     * @param {String} baseName a real name that the name arg is relative
     * to.
     * @returns {String} normalized name
     */
    function normalize(name, baseName) {
        var nameParts, nameSegment, mapValue, foundMap,
            foundI, foundStarMap, starI, i, j, part,
            baseParts = baseName && baseName.split("/"),
            map = config.map,
            starMap = (map && map['*']) || {};

        //Adjust any relative paths.
        if (name && name.charAt(0) === ".") {
            //If have a base name, try to normalize against it,
            //otherwise, assume it is a top-level require that will
            //be relative to baseUrl in the end.
            if (baseName) {
                //Convert baseName to array, and lop off the last part,
                //so that . matches that "directory" and not name of the baseName's
                //module. For instance, baseName of "one/two/three", maps to
                //"one/two/three.js", but we want the directory, "one/two" for
                //this normalization.
                baseParts = baseParts.slice(0, baseParts.length - 1);

                name = baseParts.concat(name.split("/"));

                //start trimDots
                for (i = 0; i < name.length; i += 1) {
                    part = name[i];
                    if (part === ".") {
                        name.splice(i, 1);
                        i -= 1;
                    } else if (part === "..") {
                        if (i === 1 && (name[2] === '..' || name[0] === '..')) {
                            //End of the line. Keep at least one non-dot
                            //path segment at the front so it can be mapped
                            //correctly to disk. Otherwise, there is likely
                            //no path mapping for a path starting with '..'.
                            //This can still fail, but catches the most reasonable
                            //uses of ..
                            break;
                        } else if (i > 0) {
                            name.splice(i - 1, 2);
                            i -= 2;
                        }
                    }
                }
                //end trimDots

                name = name.join("/");
            } else if (name.indexOf('./') === 0) {
                // No baseName, so this is ID is resolved relative
                // to baseUrl, pull off the leading dot.
                name = name.substring(2);
            }
        }

        //Apply map config if available.
        if ((baseParts || starMap) && map) {
            nameParts = name.split('/');

            for (i = nameParts.length; i > 0; i -= 1) {
                nameSegment = nameParts.slice(0, i).join("/");

                if (baseParts) {
                    //Find the longest baseName segment match in the config.
                    //So, do joins on the biggest to smallest lengths of baseParts.
                    for (j = baseParts.length; j > 0; j -= 1) {
                        mapValue = map[baseParts.slice(0, j).join('/')];

                        //baseName segment has  config, find if it has one for
                        //this name.
                        if (mapValue) {
                            mapValue = mapValue[nameSegment];
                            if (mapValue) {
                                //Match, update name to the new value.
                                foundMap = mapValue;
                                foundI = i;
                                break;
                            }
                        }
                    }
                }

                if (foundMap) {
                    break;
                }

                //Check for a star map match, but just hold on to it,
                //if there is a shorter segment match later in a matching
                //config, then favor over this star map.
                if (!foundStarMap && starMap && starMap[nameSegment]) {
                    foundStarMap = starMap[nameSegment];
                    starI = i;
                }
            }

            if (!foundMap && foundStarMap) {
                foundMap = foundStarMap;
                foundI = starI;
            }

            if (foundMap) {
                nameParts.splice(0, foundI, foundMap);
                name = nameParts.join('/');
            }
        }

        return name;
    }

    function makeRequire(relName, forceSync) {
        return function () {
            //A version of a require function that passes a moduleName
            //value for items that may need to
            //look up paths relative to the moduleName
            return req.apply(undef, aps.call(arguments, 0).concat([relName, forceSync]));
        };
    }

    function makeNormalize(relName) {
        return function (name) {
            return normalize(name, relName);
        };
    }

    function makeLoad(depName) {
        return function (value) {
            defined[depName] = value;
        };
    }

    function callDep(name) {
        if (hasProp(waiting, name)) {
            var args = waiting[name];
            delete waiting[name];
            defining[name] = true;
            main.apply(undef, args);
        }

        if (!hasProp(defined, name) && !hasProp(defining, name)) {
            throw new Error('No ' + name);
        }
        return defined[name];
    }

    //Turns a plugin!resource to [plugin, resource]
    //with the plugin being undefined if the name
    //did not have a plugin prefix.
    function splitPrefix(name) {
        var prefix,
            index = name ? name.indexOf('!') : -1;
        if (index > -1) {
            prefix = name.substring(0, index);
            name = name.substring(index + 1, name.length);
        }
        return [prefix, name];
    }

    /**
     * Makes a name map, normalizing the name, and using a plugin
     * for normalization if necessary. Grabs a ref to plugin
     * too, as an optimization.
     */
    makeMap = function (name, relName) {
        var plugin,
            parts = splitPrefix(name),
            prefix = parts[0];

        name = parts[1];

        if (prefix) {
            prefix = normalize(prefix, relName);
            plugin = callDep(prefix);
        }

        //Normalize according
        if (prefix) {
            if (plugin && plugin.normalize) {
                name = plugin.normalize(name, makeNormalize(relName));
            } else {
                name = normalize(name, relName);
            }
        } else {
            name = normalize(name, relName);
            parts = splitPrefix(name);
            prefix = parts[0];
            name = parts[1];
            if (prefix) {
                plugin = callDep(prefix);
            }
        }

        //Using ridiculous property names for space reasons
        return {
            f: prefix ? prefix + '!' + name : name, //fullName
            n: name,
            pr: prefix,
            p: plugin
        };
    };

    function makeConfig(name) {
        return function () {
            return (config && config.config && config.config[name]) || {};
        };
    }

    handlers = {
        require: function (name) {
            return makeRequire(name);
        },
        exports: function (name) {
            var e = defined[name];
            if (typeof e !== 'undefined') {
                return e;
            } else {
                return (defined[name] = {});
            }
        },
        module: function (name) {
            return {
                id: name,
                uri: '',
                exports: defined[name],
                config: makeConfig(name)
            };
        }
    };

    main = function (name, deps, callback, relName) {
        var cjsModule, depName, ret, map, i,
            args = [],
            usingExports;

        //Use name if no relName
        relName = relName || name;

        //Call the callback to define the module, if necessary.
        if (typeof callback === 'function') {

            //Pull out the defined dependencies and pass the ordered
            //values to the callback.
            //Default to [require, exports, module] if no deps
            deps = !deps.length && callback.length ? ['require', 'exports', 'module'] : deps;
            for (i = 0; i < deps.length; i += 1) {
                map = makeMap(deps[i], relName);
                depName = map.f;

                //Fast path CommonJS standard dependencies.
                if (depName === "require") {
                    args[i] = handlers.require(name);
                } else if (depName === "exports") {
                    //CommonJS module spec 1.1
                    args[i] = handlers.exports(name);
                    usingExports = true;
                } else if (depName === "module") {
                    //CommonJS module spec 1.1
                    cjsModule = args[i] = handlers.module(name);
                } else if (hasProp(defined, depName) ||
                           hasProp(waiting, depName) ||
                           hasProp(defining, depName)) {
                    args[i] = callDep(depName);
                } else if (map.p) {
                    map.p.load(map.n, makeRequire(relName, true), makeLoad(depName), {});
                    args[i] = defined[depName];
                } else {
                    throw new Error(name + ' missing ' + depName);
                }
            }

            ret = callback.apply(defined[name], args);

            if (name) {
                //If setting exports via "module" is in play,
                //favor that over return value and exports. After that,
                //favor a non-undefined return value over exports use.
                if (cjsModule && cjsModule.exports !== undef &&
                        cjsModule.exports !== defined[name]) {
                    defined[name] = cjsModule.exports;
                } else if (ret !== undef || !usingExports) {
                    //Use the return value from the function.
                    defined[name] = ret;
                }
            }
        } else if (name) {
            //May just be an object definition for the module. Only
            //worry about defining if have a module name.
            defined[name] = callback;
        }
    };

    requirejs = require = req = function (deps, callback, relName, forceSync, alt) {
        if (typeof deps === "string") {
            if (handlers[deps]) {
                //callback in this case is really relName
                return handlers[deps](callback);
            }
            //Just return the module wanted. In this scenario, the
            //deps arg is the module name, and second arg (if passed)
            //is just the relName.
            //Normalize module name, if it contains . or ..
            return callDep(makeMap(deps, callback).f);
        } else if (!deps.splice) {
            //deps is a config object, not an array.
            config = deps;
            if (callback.splice) {
                //callback is an array, which means it is a dependency list.
                //Adjust args if there are dependencies
                deps = callback;
                callback = relName;
                relName = null;
            } else {
                deps = undef;
            }
        }

        //Support require(['a'])
        callback = callback || function () {};

        //If relName is a function, it is an errback handler,
        //so remove it.
        if (typeof relName === 'function') {
            relName = forceSync;
            forceSync = alt;
        }

        //Simulate async callback;
        if (forceSync) {
            main(undef, deps, callback, relName);
        } else {
            //Using a non-zero value because of concern for what old browsers
            //do, and latest browsers "upgrade" to 4 if lower value is used:
            //http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout:
            //If want a value immediately, use require('id') instead -- something
            //that works in almond on the global level, but not guaranteed and
            //unlikely to work in other AMD implementations.
            setTimeout(function () {
                main(undef, deps, callback, relName);
            }, 4);
        }

        return req;
    };

    /**
     * Just drops the config on the floor, but returns req in case
     * the config return value is used.
     */
    req.config = function (cfg) {
        config = cfg;
        if (config.deps) {
            req(config.deps, config.callback);
        }
        return req;
    };

    define = function (name, deps, callback) {

        //This module may not have dependencies
        if (!deps.splice) {
            //deps is not an array, so probably means
            //an object literal or factory function for
            //the value. Adjust args.
            callback = deps;
            deps = [];
        }

        if (!hasProp(defined, name) && !hasProp(waiting, name)) {
            waiting[name] = [name, deps, callback];
        }
    };

    define.amd = {
        jQuery: true
    };
}());
define("../src/build/almond", function(){});

(function() {
  define('vent',['underscore', 'backbone'], function(_, Backbone) {
    var Vent;
    Vent = (function() {
      function Vent() {}

      _.extend(Vent.prototype, Backbone.Events);

      return Vent;

    })();
    return new Vent();
  });

}).call(this);

/*
Each instance of Handler will listen to three things:
  1) @serverEvents (@conn) -- for events coming from the collab server
  2) @localEvents (vent) -- for events coming locally from views, collab, etc.
  3) @playerEvents (@mediator) -- for events coming from player
*/


(function() {
  define('handler',['vent'], function(vent) {
    var Handler;
    return Handler = (function() {
      function Handler(conn) {
        this.conn = conn;
        this.mediator = this.conn.mediator;
        this.conn.on('ws:open', this.listen, this);
        this.conn.on('ws:close', this.stopListening, this);
      }

      Handler.prototype.listen = function() {
        var handler, name, _ref, _ref1, _ref2, _results;
        if (this.serverEvents) {
          _ref = this.serverEvents;
          for (name in _ref) {
            handler = _ref[name];
            this.conn.on(name, this[handler], this);
          }
        }
        if (this.localEvents) {
          _ref1 = this.localEvents;
          for (name in _ref1) {
            handler = _ref1[name];
            vent.on(name, this[handler], this);
          }
        }
        if (this.playerEvents) {
          _ref2 = this.playerEvents;
          _results = [];
          for (name in _ref2) {
            handler = _ref2[name];
            _results.push(this.mediator.on(name, this[handler], this));
          }
          return _results;
        }
      };

      Handler.prototype.stopListening = function() {
        var handler, name, _ref, _ref1, _ref2, _results;
        if (this.serverEvents) {
          _ref = this.serverEvents;
          for (name in _ref) {
            handler = _ref[name];
            this.conn.off(name, this[handler], this);
          }
        }
        if (this.localEvents) {
          _ref1 = this.localEvents;
          for (name in _ref1) {
            handler = _ref1[name];
            vent.off(name, this[handler], this);
          }
        }
        if (this.playerEvents) {
          _ref2 = this.playerEvents;
          _results = [];
          for (name in _ref2) {
            handler = _ref2[name];
            _results.push(this.mediator.off(name, this[handler], this));
          }
          return _results;
        }
      };

      return Handler;

    })();
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/user',['backbone'], function(Backbone) {
    var User, _ref;
    return User = (function(_super) {
      __extends(User, _super);

      function User() {
        _ref = User.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      return User;

    })(Backbone.Model);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('collections/users',['backbone', 'models/user'], function(Backbone, User) {
    var Users, _ref;
    return Users = (function(_super) {
      __extends(Users, _super);

      function Users() {
        _ref = Users.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      Users.prototype.model = User;

      return Users;

    })(Backbone.Collection);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('handlers/users',['underscore', 'handler', 'collections/users', 'vent'], function(_, Handler, Users, vent) {
    var UsersHandler, _ref;
    return UsersHandler = (function(_super) {
      __extends(UsersHandler, _super);

      function UsersHandler() {
        _ref = UsersHandler.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      UsersHandler.prototype.playerEvents = {
        'gadget:activity': 'onGadgetActivity'
      };

      UsersHandler.prototype.serverEvents = {
        'user:me': 'onUserIdentity',
        'users:list': 'onUsersList',
        'user:add': 'onUserAdd',
        'user:remove': 'onUserRemove'
      };

      UsersHandler.prototype.onUserIdentity = function(user) {
        return this.conn.me = user;
      };

      UsersHandler.prototype.onGadgetActivity = function() {
        return this.conn.resetLastActivity();
      };

      UsersHandler.prototype.onUsersList = function(users) {
        this._activeUsers = new Users(users);
        return vent.trigger('activeUsers:update', this._activeUsers);
      };

      UsersHandler.prototype.onUserAdd = function(user) {
        this._activeUsers.add(user);
        return vent.trigger('activeUsers:update', this._activeUsers);
      };

      UsersHandler.prototype.onUserRemove = function(user) {
        this._activeUsers.remove(this._activeUsers.get(user.id));
        return vent.trigger('activeUsers:update', this._activeUsers);
      };

      return UsersHandler;

    })(Handler);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/gadget_lock',['backbone'], function(Backbone) {
    var GadgetLock, _ref;
    return GadgetLock = (function(_super) {
      __extends(GadgetLock, _super);

      function GadgetLock() {
        _ref = GadgetLock.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      GadgetLock.prototype.defaults = function() {
        return {
          createdAt: new Date
        };
      };

      GadgetLock.prototype.isLockedByMe = function() {
        return !!this.get('editable');
      };

      return GadgetLock;

    })(Backbone.Model);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('handlers/locks',['underscore', 'handler', 'models/gadget_lock', 'vent'], function(_, Handler, GadgetLock, vent) {
    var LocksHandler, _ref;
    return LocksHandler = (function(_super) {
      __extends(LocksHandler, _super);

      function LocksHandler() {
        _ref = LocksHandler.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      LocksHandler.prototype.serverEvents = {
        'locks:list': 'onLocksList',
        'lock:lock': 'onLock',
        'lock:unlock': 'onUnlock'
      };

      LocksHandler.prototype.playerEvents = {
        'gadget:editing:start': 'onGadgetEditing',
        'gadget:editing:stop': 'onGadgetStopEditing'
      };

      LocksHandler.prototype.onLocksList = function(locks) {
        var _this = this;
        locks.each(function(lock) {
          return vent.trigger('lock:lock', lock);
        });
        return this.conn.activeLocks.reset(locks.models);
      };

      LocksHandler.prototype.onGadgetEditing = function(gadget) {
        var lock;
        this.conn.triggerEvent('lock:lock', {
          gadgetId: gadget.id
        });
        lock = new GadgetLock({
          gadgetId: gadget.id,
          user: this.conn.me,
          editable: true
        });
        return vent.trigger('lock:lock', lock);
      };

      LocksHandler.prototype.onGadgetStopEditing = function(gadget) {
        return this.conn.triggerEvent('lock:unlock', {
          gadgetId: gadget.id
        });
      };

      LocksHandler.prototype.onLock = function(lock) {
        this.conn.activeLocks.add(lock);
        return vent.trigger('lock:lock', lock);
      };

      LocksHandler.prototype.onUnlock = function(lock) {
        this.conn.activeLocks.remove(this.conn.activeLocks.findWhere({
          gadgetId: lock.get('gadgetId')
        }));
        return vent.trigger('lock:unlock', lock);
      };

      return LocksHandler;

    })(Handler);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/gadget_comment',['backbone'], function(Backbone) {
    var GadgetComment, _ref;
    return GadgetComment = (function(_super) {
      __extends(GadgetComment, _super);

      function GadgetComment() {
        _ref = GadgetComment.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      GadgetComment.prototype.editable = false;

      GadgetComment.prototype.defaults = function() {
        return {
          createdAt: new Date,
          deleted: false
        };
      };

      GadgetComment.prototype.isDeleted = function() {
        return !!this.get('deleted');
      };

      return GadgetComment;

    })(Backbone.Model);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('collections/gadget_comments',['backbone', 'models/gadget_comment'], function(Backbone, GadgetComment) {
    var GadgetComments, _ref;
    return GadgetComments = (function(_super) {
      __extends(GadgetComments, _super);

      function GadgetComments() {
        _ref = GadgetComments.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      GadgetComments.prototype.model = GadgetComment;

      return GadgetComments;

    })(Backbone.Collection);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('collections/collapsible_gadget_comments',['backbone', 'collections/gadget_comments', 'models/gadget_comment'], function(Backbone, GadgetComments, GadgetComment) {
    var CollapsibleGadgetComments, _ref;
    return CollapsibleGadgetComments = (function(_super) {
      __extends(CollapsibleGadgetComments, _super);

      function CollapsibleGadgetComments() {
        _ref = CollapsibleGadgetComments.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      CollapsibleGadgetComments.prototype.initialize = function() {
        this._shadowedCollection = new GadgetComments;
        this._shadowedCollection.listenTo(this, 'all', this._onModelEvent);
        return this.model = GadgetComment;
      };

      CollapsibleGadgetComments.prototype.collapseDeletedComments = function(model) {
        var index,
          _this = this;
        if (!model || model instanceof Backbone.Collection) {
          this.models.forEach(function(model) {
            return _this.collapseDeletedComments(model);
          });
          return;
        }
        index = this.models.indexOf(model);
        if (index === -1) {
          return;
        }
        if (!model.get('deleted')) {
          return;
        }
        model._deletedStreak = [1, -1].reduce(function(streak, offset) {
          var neighborModel;
          neighborModel = _this.at(index + offset);
          if (neighborModel && neighborModel.get('deleted')) {
            _this.remove(neighborModel);
            if (neighborModel._deletedStreak != null) {
              return streak + neighborModel._deletedStreak;
            }
            return streak + 1;
          } else {
            return streak;
          }
        }, 1);
        return model.trigger('change');
      };

      return CollapsibleGadgetComments;

    })(GadgetComments);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('handlers/comments',['underscore', 'handler', 'vent', 'collections/collapsible_gadget_comments'], function(_, Handler, vent, CollapsibleGadgetComments) {
    var CommentsHandler;
    return CommentsHandler = (function(_super) {
      __extends(CommentsHandler, _super);

      CommentsHandler.prototype._unresolvedIds = {};

      CommentsHandler.prototype.serverEvents = {
        'comments:list': 'onCommentsList',
        'comment:resolve': 'onCommentResolve',
        'comment:add': 'onCommentAdd',
        'comment:delete': 'onCommentDelete'
      };

      CommentsHandler.prototype.localEvents = {
        'comment:deleted': 'onCommentDeleted',
        'comment:added': 'onCommentAdded',
        'commentsView:ready': 'replayComments'
      };

      function CommentsHandler() {
        this.comments = [];
        CommentsHandler.__super__.constructor.apply(this, arguments);
      }

      CommentsHandler.prototype.onCommentsList = function(comments) {
        var _this = this;
        return this._personalizeCollection(comments).each(function(comment) {
          return _this.onCommentAdd(comment);
        });
      };

      CommentsHandler.prototype.replayComments = function() {
        return this.comments.forEach(function(comment) {
          return vent.trigger('comment:add', comment);
        });
      };

      CommentsHandler.prototype.onCommentResolve = function(_comment) {
        var cid, comment;
        cid = _comment.get('cid');
        comment = this._unresolvedIds[cid];
        if (comment) {
          comment.set({
            id: _comment.id
          });
          return delete this._unresolvedIds[cid];
        }
      };

      CommentsHandler.prototype.onCommentAdd = function(comment) {
        vent.trigger('comment:add', comment);
        return this.comments.push(comment);
      };

      CommentsHandler.prototype.onCommentDelete = function(comment) {
        return vent.trigger('comment:delete', comment);
      };

      CommentsHandler.prototype.onCommentAdded = function(comment) {
        this.comments.push(comment);
        this._pendComment(comment);
        return this.conn.triggerEvent('comment:add', {
          gadgetId: comment.get('gadgetId'),
          body: comment.get('body'),
          cid: comment.cid
        });
      };

      CommentsHandler.prototype.onCommentDeleted = function(comment) {
        var deletion;
        deletion = {
          gadgetId: comment.get('gadgetId'),
          commentId: comment.id
        };
        return this.conn.triggerEvent('comment:delete', deletion);
      };

      CommentsHandler.prototype._personalizeCollection = function(collection) {
        var _this = this;
        collection.each(function(item) {
          if (item.get('user').id === _this.conn.me.id) {
            return item.editable = true;
          }
        });
        return collection;
      };

      CommentsHandler.prototype._pendComment = function(comment) {
        return this._unresolvedIds[comment.cid] = comment;
      };

      return CommentsHandler;

    })(Handler);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('handlers/updates',['handler', 'vent'], function(Handler, vent) {
    var UpdatesHandler, _ref;
    return UpdatesHandler = (function(_super) {
      __extends(UpdatesHandler, _super);

      function UpdatesHandler() {
        _ref = UpdatesHandler.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      UpdatesHandler.prototype.serverEvents = {
        'course:update': '_onCourseUpdate'
      };

      UpdatesHandler.prototype.playerEvents = {
        'lesson:gadget:added': '_onLessonChanged',
        'lesson:gadget:moved': '_onLessonChanged',
        'lesson:gadget:deleted': '_onLessonChanged',
        'gadget:changed': '_onGadgetChanged'
      };

      UpdatesHandler.prototype._onLessonChanged = function(lesson, gadget) {
        if (gadget) {
          return this.conn.triggerEvent('course:update', {
            gadgetId: gadget.id
          });
        } else {
          return this.conn.triggerEvent('course:update');
        }
      };

      UpdatesHandler.prototype._onGadgetChanged = function(gadget) {
        return this.conn.triggerEvent('course:update', {
          gadgetId: gadget.id
        });
      };

      UpdatesHandler.prototype._onCourseUpdate = function(update) {
        this.conn.updates.push(update);
        return vent.trigger('collab:update');
      };

      return UpdatesHandler;

    })(Handler);
  });

}).call(this);

/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
/*jslint regexp: true */
/*global require, XMLHttpRequest, ActiveXObject,
  define, window, process, Packages,
  java, location, Components, FileUtils */

define('text',['module'], function (module) {
    

    var text, fs, Cc, Ci, xpcIsWindows,
        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],
        xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
        bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
        hasLocation = typeof location !== 'undefined' && location.href,
        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''),
        defaultHostName = hasLocation && location.hostname,
        defaultPort = hasLocation && (location.port || undefined),
        buildMap = {},
        masterConfig = (module.config && module.config()) || {};

    text = {
        version: '2.0.12',

        strip: function (content) {
            //Strips <?xml ...?> declarations so that external SVG and XML
            //documents can be added to a document without worry. Also, if the string
            //is an HTML document, only the part inside the body tag is returned.
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = "";
            }
            return content;
        },

        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1')
                .replace(/[\f]/g, "\\f")
                .replace(/[\b]/g, "\\b")
                .replace(/[\n]/g, "\\n")
                .replace(/[\t]/g, "\\t")
                .replace(/[\r]/g, "\\r")
                .replace(/[\u2028]/g, "\\u2028")
                .replace(/[\u2029]/g, "\\u2029");
        },

        createXhr: masterConfig.createXhr || function () {
            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {}

                    if (xhr) {
                        progIds = [progId];  // so faster next time
                        break;
                    }
                }
            }

            return xhr;
        },

        /**
         * Parses a resource name into its component parts. Resource names
         * look like: module/name.ext!strip, where the !strip part is
         * optional.
         * @param {String} name the resource name
         * @returns {Object} with properties "moduleName", "ext" and "strip"
         * where strip is a boolean.
         */
        parseName: function (name) {
            var modName, ext, temp,
                strip = false,
                index = name.indexOf("."),
                isRelative = name.indexOf('./') === 0 ||
                             name.indexOf('../') === 0;

            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length);
            } else {
                modName = name;
            }

            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                //Pull off the strip arg.
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }

            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },

        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,

        /**
         * Is an URL on another domain. Only works for browser use, returns
         * false in non-browser environments. Only used to know if an
         * optimized .js version of a text resource should be loaded
         * instead.
         * @param {String} url
         * @returns Boolean
         */
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort,
                match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];

            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];

            return (!uProtocol || uProtocol === protocol) &&
                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&
                   ((!uPort && !uHostName) || uPort === port);
        },

        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },

        load: function (name, req, onLoad, config) {
            //Name has format: some.module.filext!strip
            //The strip part is optional.
            //if strip is present, then that means only get the string contents
            //inside a body tag in an HTML string. For XML/SVG content it means
            //removing the <?xml ...?> declarations so the content can be inserted
            //into the current doc without problems.

            // Do not bother with the work if a build and text will
            // not be inlined.
            if (config && config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }

            masterConfig.isBuild = config && config.isBuild;

            var parsed = text.parseName(name),
                nonStripName = parsed.moduleName +
                    (parsed.ext ? '.' + parsed.ext : ''),
                url = req.toUrl(nonStripName),
                useXhr = (masterConfig.useXhr) ||
                         text.useXhr;

            // Do not load if it is an empty: url
            if (url.indexOf('empty:') === 0) {
                onLoad();
                return;
            }

            //Load the text. Use XHR if possible and in a browser.
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                //Need to fetch the resource across domains. Assume
                //the resource has been optimized into a JS module. Fetch
                //by the module name + extension, but do not include the
                //!strip part to avoid file system issues.
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,
                                    parsed.strip, content, onLoad);
                });
            }
        },

        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName,
                               "define(function () { return '" +
                                   content +
                               "';});\n");
            }
        },

        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName),
                extPart = parsed.ext ? '.' + parsed.ext : '',
                nonStripName = parsed.moduleName + extPart,
                //Use a '.js' file name so that it indicates it is a
                //script that can be loaded across domains.
                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';

            //Leverage own load() method to load plugin value, but only
            //write out values that do not have the strip argument,
            //to avoid any potential issues with ! in file names.
            text.load(nonStripName, req, function (value) {
                //Use own write() method to construct full module value.
                //But need to create shell that translates writeFile's
                //write() to the right interface.
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };

                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node &&
            !process.versions['node-webkit'])) {
        //Using special require.nodeRequire, something added by r.js.
        fs = require.nodeRequire('fs');

        text.get = function (url, callback, errback) {
            try {
                var file = fs.readFileSync(url, 'utf8');
                //Remove BOM (Byte Mark Order) from utf8 files if it is there.
                if (file.indexOf('\uFEFF') === 0) {
                    file = file.substring(1);
                }
                callback(file);
            } catch (e) {
                if (errback) {
                    errback(e);
                }
            }
        };
    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&
            text.createXhr())) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);

            //Allow plugins direct access to xhr headers
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }

            //Allow overrides specified in config
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }

            xhr.onreadystatechange = function (evt) {
                var status, err;
                //Do not explicitly handle errors, those should be
                //visible via console output in the browser.
                if (xhr.readyState === 4) {
                    status = xhr.status || 0;
                    if (status > 399 && status < 600) {
                        //An http 4xx or 5xx error. Signal an error.
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        if (errback) {
                            errback(err);
                        }
                    } else {
                        callback(xhr.responseText);
                    }

                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&
            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {
        //Why Java, why is this so awkward?
        text.get = function (url, callback) {
            var stringBuffer, line,
                encoding = "utf-8",
                file = new java.io.File(url),
                lineSeparator = java.lang.System.getProperty("line.separator"),
                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),
                content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();

                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324
                // http://www.unicode.org/faq/utf_bom.html

                // Note that when we use utf-8, the BOM should appear as "EF BB BF", but it doesn't due to this bug in the JDK:
                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058
                if (line && line.length() && line.charAt(0) === 0xfeff) {
                    // Eat the BOM, since we've already found the encoding on this file,
                    // and we plan to concatenating this buffer with others; the BOM should
                    // only appear at the top of a file.
                    line = line.substring(1);
                }

                if (line !== null) {
                    stringBuffer.append(line);
                }

                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                //Make sure we return a JavaScript string and not a Java string.
                content = String(stringBuffer.toString()); //String
            } finally {
                input.close();
            }
            callback(content);
        };
    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&
            typeof Components !== 'undefined' && Components.classes &&
            Components.interfaces)) {
        //Avert your gaze!
        Cc = Components.classes;
        Ci = Components.interfaces;
        Components.utils['import']('resource://gre/modules/FileUtils.jsm');
        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);

        text.get = function (url, callback) {
            var inStream, convertStream, fileObj,
                readData = {};

            if (xpcIsWindows) {
                url = url.replace(/\//g, '\\');
            }

            fileObj = new FileUtils.File(url);

            //XPCOM, you so crazy
            try {
                inStream = Cc['@mozilla.org/network/file-input-stream;1']
                           .createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);

                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']
                                .createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, "utf-8", inStream.available(),
                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);

                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value);
            } catch (e) {
                throw new Error((fileObj && fileObj.path || '') + ': ' + e);
            }
        };
    }
    return text;
});


define('text!templates/contributor.html',[],function () { return '<a href="<%- userUrl %>" target="_blank">\n  <img src="<%- thumbnail %>" alt="<%- name() %>" class="contrib-icon" title="<%- name() %>">\n</a>\n';});


define('text!templates/contributors.html',[],function () { return '<h4>Contributors</h4>\n<div class="js-toggle-collapse">\n  <i class="collapse icon-double-angle-down"></i>\n  <i class="expand icon-double-angle-up"></i>\n</div>\n<ul class="icons js-icons"></ul>\n';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/contributors',['backbone', 'backbone.marionette', 'text!templates/contributor.html', 'text!templates/contributors.html', 'vent'], function(Backbone, Marionette, contributorTemplate, contributorsTemplate, vent) {
    var ContributorView, ContributorsView, _ref, _ref1;
    ContributorView = (function(_super) {
      __extends(ContributorView, _super);

      function ContributorView() {
        this.templateHelpers = __bind(this.templateHelpers, this);
        _ref = ContributorView.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      ContributorView.prototype.initialize = function(_arg) {
        this.site = _arg.site;
      };

      ContributorView.prototype.template = _.template(contributorTemplate);

      ContributorView.prototype.templateHelpers = function() {
        var _this = this;
        return {
          thumbnail: this.getThumbnail(),
          name: function() {
            return _this.model.get('firstname') || _this.model.get('fn') || 'Anonymous';
          },
          site: this.site,
          userUrl: "" + this.site + "/u/" + this.model.id
        };
      };

      ContributorView.prototype.tagName = 'li';

      ContributorView.prototype.className = 'contributor';

      ContributorView.prototype.getThumbnail = function() {
        var icon, _ref1;
        icon = _.findWhere((_ref1 = this.model.get('image')) != null ? _ref1.representations : void 0, {
          scale: '40x40'
        });
        return (icon != null ? icon.location : void 0) || ("" + this.site + "/assets/img/defaults/profile-retina.jpg");
      };

      return ContributorView;

    })(Marionette.ItemView);
    return ContributorsView = (function(_super) {
      __extends(ContributorsView, _super);

      function ContributorsView() {
        this.initialize = __bind(this.initialize, this);
        _ref1 = ContributorsView.__super__.constructor.apply(this, arguments);
        return _ref1;
      }

      ContributorsView.prototype.initialize = function(_arg) {
        this.mediator = _arg.mediator, this.conn = _arg.conn, this.site = _arg.site;
        return this.collection = new Backbone.Collection;
      };

      ContributorsView.prototype.onShow = function() {
        this.conn.on('ws:open', this.render, this);
        this.conn.on('ws:close', this.render, this);
        this.listenTo(this, 'composite:collection:rendered', this.onCollectionRender);
        return vent.on('activeUsers:update', this._onActiveUsersChange, this);
      };

      ContributorsView.prototype.onClose = function() {
        this.conn.off('ws:open', this.render, this);
        this.conn.off('ws:close', this.render, this);
        return vent.off('activeUsers:update', this._onActiveUsersChange, this);
      };

      ContributorsView.prototype.itemView = ContributorView;

      ContributorsView.prototype.itemViewOptions = function() {
        return {
          site: this.site
        };
      };

      ContributorsView.prototype.itemViewContainer = '.js-icons';

      ContributorsView.prototype.template = _.template(contributorsTemplate);

      ContributorsView.prototype.className = 'contributors';

      ContributorsView.prototype.onCollectionRender = function() {
        this.$el.toggle(!!this.conn.enabled && this.collection.length > 0);
        return this.trigger('sizeChanged');
      };

      ContributorsView.prototype.events = {
        'click .js-toggle-collapse': 'onCollapseToggle'
      };

      ContributorsView.prototype.onCollapseToggle = function() {
        this.$el.toggleClass('collapsed');
        return this.trigger('toggleCollapse');
      };

      ContributorsView.prototype._onActiveUsersChange = function(users) {
        return this.collection.reset(users.models);
      };

      return ContributorsView;

    })(Marionette.CompositeView);
  });

}).call(this);

// Generated by CoffeeScript 1.7.1
(function() {
  define('plugins/time_since',[], function() {
    return function(date) {
      var diff, label, max, min, unit, unitCount, _i, _len, _ref, _ref1;
      diff = (+(new Date)) - date;
      if (diff <= 30 * 1000) {
        label = 'seconds';
      } else if ((30 * 1000 < diff && diff <= 60 * 1000)) {
        label = 'less than a minute';
      } else {
        _ref = [['minute', 60 * 1000, 60 * 60 * 1000], ['hour', 60 * 60 * 1000, 24 * 60 * 60 * 1000], ['day', 24 * 60 * 60 * 1000, Infinity]];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          _ref1 = _ref[_i], unit = _ref1[0], min = _ref1[1], max = _ref1[2];
          if ((min < diff && diff <= max)) {
            unitCount = Math.floor(diff / min);
            label = "" + unitCount + " " + unit;
            if (unitCount > 1) {
              label += 's';
            }
          }
        }
      }
      return label;
    };
  });

}).call(this);


define('text!templates/gadget_comment.html',[],function () { return '<% if (deleted && deletedStreak() > 1) { %>\n  <div class="deleted_comment">\n    <p><%= deletedStreak() %> comments have been deleted</p>\n  </div>\n<% } else if (deleted) { %>\n  <div class="deleted_comment">\n    <p>Comment has been deleted</p>\n  </div>\n<% } else { %>\n  <div class="comment-inner">\n    <div class=\'js-delete-overlay delete-overlay\'>\n      <div class=\'delete-content\'>\n        Delete this comment?\n        <button class=\'js-cancel-delete\'>no</button>\n        <button class=\'js-confirm-delete action\'>yes</button>\n      </div>\n    </div>\n    <img src="<%- profileImage() %>"></img>\n    <div class="commentInfo">\n      <p class="commentAuthor"><%- name() %></p><br/>\n      <p class="commentDate"><span class="js-timestamp timestamp">seconds</span> ago</p>\n    </div>\n    <p class="js-comment-body comment-body"><%= body() %></p>\n    <div class="js-comment-actions comment-actions">\n      <span class="js-show comment-action show-more">show more</span>\n      <span class="js-show comment-action show-less">show less</span>\n      <% if (isDeletable()) { %>\n        <span class="js-delete-comment delete-comment comment-action pull-right">delete</span>\n      <% } %>\n    </div>\n  </div>\n<% } %>\n';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/comment',['backbone.marionette', 'plugins/time_since', 'text!templates/gadget_comment.html', 'vent'], function(Marionette, timeSince, template, vent) {
    var GadgetCommentView, _ref;
    return GadgetCommentView = (function(_super) {
      __extends(GadgetCommentView, _super);

      function GadgetCommentView() {
        this.updateTimeSince = __bind(this.updateTimeSince, this);
        this.profileImage = __bind(this.profileImage, this);
        this.sanitizeBody = __bind(this.sanitizeBody, this);
        _ref = GadgetCommentView.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      GadgetCommentView.prototype.updateTimeSinceEveryMs = 10 * 1000;

      GadgetCommentView.prototype.className = 'comment';

      GadgetCommentView.prototype.events = {
        'click .js-delete-comment': '_onDeleteClick',
        'click .js-show': 'toggleShow',
        'click .js-confirm-delete': '_onConfirmDelete',
        'click .js-cancel-delete': '_onCancelDelete'
      };

      GadgetCommentView.prototype.template = _.template(template);

      GadgetCommentView.prototype.ui = {
        createdAt: '.js-timestamp',
        commentBody: '.js-comment-body',
        deleteOverlay: '.js-delete-overlay'
      };

      GadgetCommentView.prototype.initialize = function(_arg) {
        this.site = _arg.site, this.mediator = _arg.mediator;
        return this.listenTo(this.model, 'change', this.render);
      };

      GadgetCommentView.prototype.toggleShow = function() {
        this.$el.toggleClass('expanded');
        return this.$el.toggleClass('compacted');
      };

      GadgetCommentView.prototype.templateHelpers = function() {
        var _this = this;
        return {
          profileImage: this.profileImage,
          name: function() {
            var _ref1, _ref2;
            return ((_ref1 = _this.model.get('user')) != null ? _ref1.firstname : void 0) || ((_ref2 = _this.model.get('user')) != null ? _ref2.fn : void 0) || 'Anonymous';
          },
          body: this.sanitizeBody,
          deletedStreak: function() {
            return _this.model._deletedStreak;
          },
          isDeletable: function() {
            return _this.model.editable && !_this.model.isNew();
          }
        };
      };

      GadgetCommentView.prototype.sanitizeBody = function() {
        var sub, substitutions, text, type;
        text = _.escape(this.model.get('body'));
        substitutions = {
          http: {
            "in": /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,
            out: '<a href="$1" target="_blank">$1</a>'
          },
          www: {
            "in": /(^|[^\/])(www\.[\S]+(\b|$))/gim,
            out: '$1<a href="http://$2" target="_blank">$2</a>'
          },
          email: {
            "in": /(^\S+@\S+\.\S+$)/gi,
            out: '<a href="mailto:$1">$1</a>'
          },
          newlines: {
            "in": /\n/g,
            out: '<br>'
          }
        };
        for (type in substitutions) {
          sub = substitutions[type];
          text = text.replace(sub["in"], sub.out);
        }
        return text;
      };

      GadgetCommentView.prototype.profileImage = function() {
        var image, user;
        user = this.model.get('user');
        if (user != null ? user.image : void 0) {
          image = _.find(user.image.representations, function(representation) {
            return representation.scale === "140x140";
          });
          return image.location;
        } else {
          return "" + this.site + "/assets/img/defaults/profile-retina.jpg";
        }
      };

      GadgetCommentView.prototype.onRender = function() {
        return this.updateTimeSince();
      };

      GadgetCommentView.prototype.onShow = function() {
        return this.determineHeight();
      };

      GadgetCommentView.prototype.onClose = function() {
        return this.stopUpdatingTimeSince();
      };

      GadgetCommentView.prototype.startUpdatingTimeSince = function() {
        if (!(this.timeSinceUpdater || this.model.get('deleted'))) {
          return this.timeSinceUpdater = setInterval(this.updateTimeSince, this.updateTimeSinceEveryMs);
        }
      };

      GadgetCommentView.prototype.stopUpdatingTimeSince = function() {
        return clearInterval(this.timeSinceUpdater);
      };

      GadgetCommentView.prototype._onDeleteClick = function() {
        return this.ui.deleteOverlay.show();
      };

      GadgetCommentView.prototype._onConfirmDelete = function() {
        this.ui.deleteOverlay.hide();
        this.model.set({
          deleted: true
        });
        return vent.trigger('comment:deleted', this.model);
      };

      GadgetCommentView.prototype._onCancelDelete = function() {
        return this.ui.deleteOverlay.hide();
      };

      GadgetCommentView.prototype.updateTimeSince = function() {
        var commentDate;
        commentDate = new Date(this.model.get('createdAt'));
        return this.ui.createdAt.text(timeSince(commentDate));
      };

      GadgetCommentView.prototype.determineHeight = function() {
        if (this.ui.commentBody.height() > 145) {
          return this.$el.addClass('compacted');
        }
      };

      return GadgetCommentView;

    })(Marionette.ItemView);
  });

}).call(this);


define('text!templates/gadget_comments.html',[],function () { return '<ul class="comments-toolbar">\n  <li class="actions">\n    <span class="comments js-comments">\n      <span class="js-comments-toggle comments-toggle icon-stack">\n        <i class="fv-bubble icon-stack-base"></i>\n        <i class="js-comments-count icon-inner-text"><%- commentCount %></i>\n      </span>\n      <div class="js-comments-box comments-box">\n        <div class="js-inner-comments inner-comments"></div>\n        <textarea class="js-submit-comment-text submit-comment-text" maxlength="800" placeholder="Write a message here..."></textarea>\n        <div class="submit-action-buttons js-submit-action-buttons">\n          <button class="cancel-button js-cancel-comment ">cancel</button>\n          <button class="action submit-button js-submit-comment pull-right">submit</button>\n        </div>\n      </div>\n    </span>\n  </li>\n</ul>\n';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/comments',['backbone.marionette', 'views/comment', 'text!templates/gadget_comments.html', 'models/gadget_comment', 'collections/collapsible_gadget_comments', 'vent'], function(Marionette, GadgetCommentView, template, GadgetComment, CollapsibleGadgetComments, vent) {
    var GadgetCommentsView, _ref;
    return GadgetCommentsView = (function(_super) {
      __extends(GadgetCommentsView, _super);

      function GadgetCommentsView() {
        this.stopCommenting = __bind(this.stopCommenting, this);
        this.startCommenting = __bind(this.startCommenting, this);
        this.onCommentsToggled = __bind(this.onCommentsToggled, this);
        this.onCommentToggleClicked = __bind(this.onCommentToggleClicked, this);
        this._onCommentsChange = __bind(this._onCommentsChange, this);
        this.enable = __bind(this.enable, this);
        this.disable = __bind(this.disable, this);
        _ref = GadgetCommentsView.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      GadgetCommentsView.prototype.className = 'comments-container';

      GadgetCommentsView.prototype.ui = {
        commentText: '.js-submit-comment-text',
        commentsCount: '.js-comments-count',
        commentsDisplay: '.js-comments-box',
        commentsSubmitButtons: '.js-submit-action-buttons',
        commentsBox: '.js-comments',
        innerCommentsBox: '.js-inner-comments'
      };

      GadgetCommentsView.prototype.events = {
        'click .js-comments-toggle': 'onCommentToggleClicked',
        'click .js-submit-comment': 'onCommentSubmit',
        'click .js-cancel-comment': 'onCommentCancel',
        'click': 'onClick'
      };

      GadgetCommentsView.prototype.template = _.template(template);

      GadgetCommentsView.prototype.templateHelpers = function() {
        return {
          commentCount: this.commentCount()
        };
      };

      GadgetCommentsView.prototype.itemView = GadgetCommentView;

      GadgetCommentsView.prototype.itemViewOptions = function() {
        return {
          site: this.site,
          mediator: this.mediator
        };
      };

      GadgetCommentsView.prototype.itemViewContainer = '.inner-comments';

      GadgetCommentsView.prototype.initialize = function(_arg) {
        this.mediator = _arg.mediator, this.site = _arg.site, this.conn = _arg.conn, this.model = _arg.model;
        this.gadget = this.model;
        this.delegateEvents();
        this.collection = new CollapsibleGadgetComments;
        return this.listenTo(this.collection, 'add remove reset change:deleted', this._onCommentsChange);
      };

      GadgetCommentsView.prototype.onRender = function() {
        if (this.conn.subscribed) {
          return this.enable();
        }
      };

      GadgetCommentsView.prototype.onShow = function() {
        vent.on('comment:add', this.addComment, this);
        vent.on('comment:delete', this.deleteComment, this);
        vent.on('comments:toggle', this.onCommentsToggled, this);
        this.conn.on('subscribed', this.enable);
        this.conn.on('unsubscribed', this.disable);
        return vent.trigger('commentsView:ready', this.gadget.id);
      };

      GadgetCommentsView.prototype.onClose = function() {
        vent.off('comment:add', this.addComment, this);
        vent.off('comment:delete', this.deleteComment, this);
        vent.off('comments:toggle', this.onCommentsToggled, this);
        this.conn.off('subscribed', this.enable);
        return this.conn.off('unsubscribed', this.disable);
      };

      GadgetCommentsView.prototype.onClick = function(e) {};

      GadgetCommentsView.prototype.disable = function() {
        return this.$el.hide();
      };

      GadgetCommentsView.prototype.enable = function() {
        return this.$el.show();
      };

      GadgetCommentsView.prototype.addComment = function(comment) {
        var gadgetId;
        gadgetId = comment.get('gadgetId');
        if (gadgetId === this.gadget.id) {
          return this.collection.add(comment);
        }
      };

      GadgetCommentsView.prototype.deleteComment = function(event) {
        var _ref1;
        if (event.gadgetId === this.gadget.id) {
          return (_ref1 = this.collection.get(event.commentId)) != null ? _ref1.set({
            deleted: true
          }) : void 0;
        }
      };

      GadgetCommentsView.prototype.onCommentSubmit = function() {
        var comment;
        if (!this.ui.commentText.val()) {
          return;
        }
        comment = new GadgetComment({
          gadgetId: this.gadget.id,
          body: this.ui.commentText.val(),
          user: this.conn.me
        });
        comment.editable = true;
        this.ui.commentText.val('');
        this.addComment(comment);
        vent.trigger('comment:added', comment);
        return this.scrollToBottom();
      };

      GadgetCommentsView.prototype.commentCount = function() {
        var comments, count;
        comments = this.collection.reject(function(comment) {
          return comment.get('deleted');
        });
        count = comments.length;
        if (count > 99) {
          return '99+';
        } else if (count <= 0) {
          return '+';
        } else {
          return count;
        }
      };

      GadgetCommentsView.prototype._onCommentsChange = function(model) {
        this.collection.collapseDeletedComments(model);
        this.ui.commentsCount.text(this.commentCount());
        return this.children.each(function(view) {
          return view.startUpdatingTimeSince();
        });
      };

      GadgetCommentsView.prototype.hideComments = function() {
        return this.ui.commentsDisplay.hide();
      };

      GadgetCommentsView.prototype.onCommentCancel = function() {
        return this.ui.commentText.val('');
      };

      GadgetCommentsView.prototype.checkForCollapsedComments = function() {
        return this.children.each(function(view) {
          return view.determineHeight();
        });
      };

      GadgetCommentsView.prototype.scrollToBottom = function() {
        return this.ui.innerCommentsBox.scrollTop(this.ui.innerCommentsBox[0].scrollHeight);
      };

      GadgetCommentsView.prototype.show = function() {
        var bottom;
        this.$el.addClass('comments-visible');
        this.checkForCollapsedComments();
        bottom = this.ui.commentsDisplay.height() + this.ui.commentsDisplay.offset().top;
        this.ui.commentsDisplay.toggleClass('above', bottom > $('body').height());
        this.scrollToBottom();
        return this.ui.commentText.focus();
      };

      GadgetCommentsView.prototype.hide = function() {
        this.$el.removeClass('comments-visible');
        this.ui.commentsDisplay.removeClass('above');
        return this.children.each(function(view) {
          return view.stopUpdatingTimeSince();
        });
      };

      GadgetCommentsView.prototype.onCommentToggleClicked = function() {
        return vent.trigger('comments:toggle', this.gadget);
      };

      GadgetCommentsView.prototype.onCommentsToggled = function(gadget) {
        if (gadget.id === this.gadget.id) {
          return this.toggleCommenting();
        } else {
          return this.stopCommenting();
        }
      };

      GadgetCommentsView.prototype.toggleCommenting = function() {
        if (this.isCommenting()) {
          return this.stopCommenting();
        } else {
          return this.startCommenting();
        }
      };

      GadgetCommentsView.prototype.isCommenting = function() {
        return !!this.gadget.get('isCommenting');
      };

      GadgetCommentsView.prototype.startCommenting = function() {
        this.gadget.set({
          isCommenting: true
        });
        this.show();
        $(window).one('click', this.stopCommenting);
        return this.$el.on('click', this._prevent);
      };

      GadgetCommentsView.prototype.stopCommenting = function() {
        this.gadget.set({
          isCommenting: false
        });
        this.hide();
        $(window).off('click', this.stopCommenting);
        return this.$el.off('click', this._prevent);
      };

      GadgetCommentsView.prototype._prevent = function(e) {
        return e.stopPropagation();
      };

      return GadgetCommentsView;

    })(Marionette.CompositeView);
  });

}).call(this);


define('text!templates/gadget_lock.html',[],function () { return '<i class="collab-lock-icon icon-lock"></i>\n<div class="collab-lock-tooltip">\n  <img class="collab-lock-avatar js-lock-avatar" src="<%- profileImage() %>"></img>\n  <%- name() %>\n</div>\n';});

/*! tether 0.6.5 */
!function(t,e){"function"==typeof define&&define.amd?define('tether',e):"object"==typeof exports?module.exports=e(require,exports,module):t.Tether=e()}(this,function(){return function(){var t,e,o,i,n,s,l,r,h,a,f,p,u,d,g,c,m,b,v,y={}.hasOwnProperty,w=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1},C=[].slice;null==this.Tether&&(this.Tether={modules:[]}),p=function(t){var e,o,i,n,s;if(o=getComputedStyle(t).position,"fixed"===o)return t;for(i=void 0,e=t;e=e.parentNode;){try{n=getComputedStyle(e)}catch(l){}if(null==n)return e;if(/(auto|scroll)/.test(n.overflow+n.overflowY+n.overflowX)&&("absolute"!==o||"relative"===(s=n.position)||"absolute"===s||"fixed"===s))return e}return document.body},m=function(){var t;return t=0,function(){return t++}}(),v={},a=function(t){var e,i,s,l,r;if(s=t._tetherZeroElement,null==s&&(s=t.createElement("div"),s.setAttribute("data-tether-id",m()),n(s.style,{top:0,left:0,position:"absolute"}),t.body.appendChild(s),t._tetherZeroElement=s),e=s.getAttribute("data-tether-id"),null==v[e]){v[e]={},r=s.getBoundingClientRect();for(i in r)l=r[i],v[e][i]=l;o(function(){return v[e]=void 0})}return v[e]},d=null,l=function(t){var e,o,i,n,s,l,r;t===document?(o=document,t=document.documentElement):o=t.ownerDocument,i=o.documentElement,e={},r=t.getBoundingClientRect();for(n in r)l=r[n],e[n]=l;return s=a(o),e.top-=s.top,e.left-=s.left,null==e.width&&(e.width=document.body.scrollWidth-e.left-e.right),null==e.height&&(e.height=document.body.scrollHeight-e.top-e.bottom),e.top=e.top-i.clientTop,e.left=e.left-i.clientLeft,e.right=o.body.clientWidth-e.width-e.left,e.bottom=o.body.clientHeight-e.height-e.top,e},h=function(t){return t.offsetParent||document.documentElement},f=function(){var t,e,o,i,s;return t=document.createElement("div"),t.style.width="100%",t.style.height="200px",e=document.createElement("div"),n(e.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),e.appendChild(t),document.body.appendChild(e),i=t.offsetWidth,e.style.overflow="scroll",s=t.offsetWidth,i===s&&(s=e.clientWidth),document.body.removeChild(e),o=i-s,{width:o,height:o}},n=function(t){var e,o,i,n,s,l,r;for(null==t&&(t={}),e=[],Array.prototype.push.apply(e,arguments),r=e.slice(1),s=0,l=r.length;l>s;s++)if(i=r[s])for(o in i)y.call(i,o)&&(n=i[o],t[o]=n);return t},g=function(t,e){var o,i,n,s,l,h;if(null!=t.classList){for(l=e.split(" "),h=[],n=0,s=l.length;s>n;n++)i=l[n],i.trim()&&h.push(t.classList.remove(i));return h}return o=r(t).replace(new RegExp("(^| )"+e.split(" ").join("|")+"( |$)","gi")," "),c(t,o)},e=function(t,e){var o,i,n,s,l;if(null!=t.classList){for(s=e.split(" "),l=[],i=0,n=s.length;n>i;i++)o=s[i],o.trim()&&l.push(t.classList.add(o));return l}return g(t,e),o=r(t)+(" "+e),c(t,o)},u=function(t,e){return null!=t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(r(t))},r=function(t){return t.className instanceof SVGAnimatedString?t.className.baseVal:t.className},c=function(t,e){return t.setAttribute("class",e)},b=function(t,o,i){var n,s,l,r,h,a;for(s=0,r=i.length;r>s;s++)n=i[s],w.call(o,n)<0&&u(t,n)&&g(t,n);for(a=[],l=0,h=o.length;h>l;l++)n=o[l],a.push(u(t,n)?void 0:e(t,n));return a},i=[],o=function(t){return i.push(t)},s=function(){var t,e;for(e=[];t=i.pop();)e.push(t());return e},t=function(){function t(){}return t.prototype.on=function(t,e,o,i){var n;return null==i&&(i=!1),null==this.bindings&&(this.bindings={}),null==(n=this.bindings)[t]&&(n[t]=[]),this.bindings[t].push({handler:e,ctx:o,once:i})},t.prototype.once=function(t,e,o){return this.on(t,e,o,!0)},t.prototype.off=function(t,e){var o,i,n;if(null!=(null!=(i=this.bindings)?i[t]:void 0)){if(null==e)return delete this.bindings[t];for(o=0,n=[];o<this.bindings[t].length;)n.push(this.bindings[t][o].handler===e?this.bindings[t].splice(o,1):o++);return n}},t.prototype.trigger=function(){var t,e,o,i,n,s,l,r,h;if(o=arguments[0],t=2<=arguments.length?C.call(arguments,1):[],null!=(l=this.bindings)?l[o]:void 0){for(n=0,h=[];n<this.bindings[o].length;)r=this.bindings[o][n],i=r.handler,e=r.ctx,s=r.once,i.apply(null!=e?e:this,t),h.push(s?this.bindings[o].splice(n,1):n++);return h}},t}(),this.Tether.Utils={getScrollParent:p,getBounds:l,getOffsetParent:h,extend:n,addClass:e,removeClass:g,hasClass:u,updateClasses:b,defer:o,flush:s,uniqueId:m,Evented:t,getScrollBarSize:f}}.call(this),function(){var t,e,o,i,n,s,l,r,h,a,f,p,u,d,g,c,m,b,v,y,w,C,O,T,x,A,E,S,W,M=[].slice,z=function(t,e){return function(){return t.apply(e,arguments)}};if(null==this.Tether)throw new Error("You must include the utils.js file before tether.js");i=this.Tether,W=i.Utils,c=W.getScrollParent,m=W.getSize,d=W.getOuterSize,p=W.getBounds,u=W.getOffsetParent,a=W.extend,n=W.addClass,O=W.removeClass,A=W.updateClasses,h=W.defer,f=W.flush,g=W.getScrollBarSize,E=function(t,e,o){return null==o&&(o=1),t+o>=e&&e>=t-o},x=function(){var t,e,o,i,n;for(t=document.createElement("div"),n=["transform","webkitTransform","OTransform","MozTransform","msTransform"],o=0,i=n.length;i>o;o++)if(e=n[o],void 0!==t.style[e])return e}(),T=[],C=function(){var t,e,o;for(e=0,o=T.length;o>e;e++)t=T[e],t.position(!1);return f()},b=function(){var t;return null!=(t="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance.now():void 0)?t:+new Date},function(){var t,e,o,i,n,s,l,r,h;for(e=null,o=null,i=null,n=function(){if(null!=o&&o>16)return o=Math.min(o-16,250),void(i=setTimeout(n,250));if(!(null!=e&&b()-e<10))return null!=i&&(clearTimeout(i),i=null),e=b(),C(),o=b()-e},r=["resize","scroll","touchmove"],h=[],s=0,l=r.length;l>s;s++)t=r[s],h.push(window.addEventListener(t,n));return h}(),t={center:"center",left:"right",right:"left"},e={middle:"middle",top:"bottom",bottom:"top"},o={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"},r=function(o,i){var n,s;return n=o.left,s=o.top,"auto"===n&&(n=t[i.left]),"auto"===s&&(s=e[i.top]),{left:n,top:s}},l=function(t){var e,i;return{left:null!=(e=o[t.left])?e:t.left,top:null!=(i=o[t.top])?i:t.top}},s=function(){var t,e,o,i,n,s,l;for(e=1<=arguments.length?M.call(arguments,0):[],o={top:0,left:0},n=0,s=e.length;s>n;n++)l=e[n],i=l.top,t=l.left,"string"==typeof i&&(i=parseFloat(i,10)),"string"==typeof t&&(t=parseFloat(t,10)),o.top+=i,o.left+=t;return o},v=function(t,e){return"string"==typeof t.left&&-1!==t.left.indexOf("%")&&(t.left=parseFloat(t.left,10)/100*e.width),"string"==typeof t.top&&-1!==t.top.indexOf("%")&&(t.top=parseFloat(t.top,10)/100*e.height),t},y=w=function(t){var e,o,i;return i=t.split(" "),o=i[0],e=i[1],{top:o,left:e}},S=function(){function t(t){this.position=z(this.position,this);var e,o,n,s,l;for(T.push(this),this.history=[],this.setOptions(t,!1),s=i.modules,o=0,n=s.length;n>o;o++)e=s[o],null!=(l=e.initialize)&&l.call(this);this.position()}return t.modules=[],t.prototype.getClass=function(t){var e,o;return(null!=(e=this.options.classes)?e[t]:void 0)?this.options.classes[t]:(null!=(o=this.options.classes)?o[t]:void 0)!==!1?this.options.classPrefix?""+this.options.classPrefix+"-"+t:t:""},t.prototype.setOptions=function(t,e){var o,i,s,l,r,h;for(this.options=t,null==e&&(e=!0),o={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"},this.options=a(o,this.options),r=this.options,this.element=r.element,this.target=r.target,this.targetModifier=r.targetModifier,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),h=["element","target"],s=0,l=h.length;l>s;s++){if(i=h[s],null==this[i])throw new Error("Tether Error: Both element and target must be defined");null!=this[i].jquery?this[i]=this[i][0]:"string"==typeof this[i]&&(this[i]=document.querySelector(this[i]))}if(n(this.element,this.getClass("element")),n(this.target,this.getClass("target")),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");return this.targetAttachment=y(this.options.targetAttachment),this.attachment=y(this.options.attachment),this.offset=w(this.options.offset),this.targetOffset=w(this.options.targetOffset),null!=this.scrollParent&&this.disable(),this.scrollParent="scroll-handle"===this.targetModifier?this.target:c(this.target),this.options.enabled!==!1?this.enable(e):void 0},t.prototype.getTargetBounds=function(){var t,e,o,i,n,s,l,r,h;if(null==this.targetModifier)return p(this.target);switch(this.targetModifier){case"visible":return this.target===document.body?{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth}:(t=p(this.target),n={height:t.height,width:t.width,top:t.top,left:t.left},n.height=Math.min(n.height,t.height-(pageYOffset-t.top)),n.height=Math.min(n.height,t.height-(t.top+t.height-(pageYOffset+innerHeight))),n.height=Math.min(innerHeight,n.height),n.height-=2,n.width=Math.min(n.width,t.width-(pageXOffset-t.left)),n.width=Math.min(n.width,t.width-(t.left+t.width-(pageXOffset+innerWidth))),n.width=Math.min(innerWidth,n.width),n.width-=2,n.top<pageYOffset&&(n.top=pageYOffset),n.left<pageXOffset&&(n.left=pageXOffset),n);case"scroll-handle":return h=this.target,h===document.body?(h=document.documentElement,t={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}):t=p(h),r=getComputedStyle(h),o=h.scrollWidth>h.clientWidth||"scroll"===[r.overflow,r.overflowX]||this.target!==document.body,s=0,o&&(s=15),i=t.height-parseFloat(r.borderTopWidth)-parseFloat(r.borderBottomWidth)-s,n={width:15,height:.975*i*(i/h.scrollHeight),left:t.left+t.width-parseFloat(r.borderLeftWidth)-15},e=0,408>i&&this.target===document.body&&(e=-11e-5*Math.pow(i,2)-.00727*i+22.58),this.target!==document.body&&(n.height=Math.max(n.height,24)),l=this.target.scrollTop/(h.scrollHeight-i),n.top=l*(i-n.height-e)+t.top+parseFloat(r.borderTopWidth),this.target===document.body&&(n.height=Math.max(n.height,24)),n}},t.prototype.clearCache=function(){return this._cache={}},t.prototype.cache=function(t,e){return null==this._cache&&(this._cache={}),null==this._cache[t]&&(this._cache[t]=e.call(this)),this._cache[t]},t.prototype.enable=function(t){return null==t&&(t=!0),n(this.target,this.getClass("enabled")),n(this.element,this.getClass("enabled")),this.enabled=!0,this.scrollParent!==document&&this.scrollParent.addEventListener("scroll",this.position),t?this.position():void 0},t.prototype.disable=function(){return O(this.target,this.getClass("enabled")),O(this.element,this.getClass("enabled")),this.enabled=!1,null!=this.scrollParent?this.scrollParent.removeEventListener("scroll",this.position):void 0},t.prototype.destroy=function(){var t,e,o,i,n;for(this.disable(),n=[],t=o=0,i=T.length;i>o;t=++o){if(e=T[t],e===this){T.splice(t,1);break}n.push(void 0)}return n},t.prototype.updateAttachClasses=function(t,e){var o,i,n,s,l,r,a,f,p,u=this;for(null==t&&(t=this.attachment),null==e&&(e=this.targetAttachment),s=["left","top","bottom","right","middle","center"],(null!=(p=this._addAttachClasses)?p.length:void 0)&&this._addAttachClasses.splice(0,this._addAttachClasses.length),o=null!=this._addAttachClasses?this._addAttachClasses:this._addAttachClasses=[],t.top&&o.push(""+this.getClass("element-attached")+"-"+t.top),t.left&&o.push(""+this.getClass("element-attached")+"-"+t.left),e.top&&o.push(""+this.getClass("target-attached")+"-"+e.top),e.left&&o.push(""+this.getClass("target-attached")+"-"+e.left),i=[],l=0,a=s.length;a>l;l++)n=s[l],i.push(""+this.getClass("element-attached")+"-"+n);for(r=0,f=s.length;f>r;r++)n=s[r],i.push(""+this.getClass("target-attached")+"-"+n);return h(function(){return null!=u._addAttachClasses?(A(u.element,u._addAttachClasses,i),A(u.target,u._addAttachClasses,i),u._addAttachClasses=void 0):void 0})},t.prototype.position=function(t){var e,o,n,h,a,d,c,m,b,y,w,C,O,T,x,A,E,S,W,M,z,B,P,_,F,L,Y,H,X,N,j,R,U,q,k,D=this;if(null==t&&(t=!0),this.enabled){for(this.clearCache(),M=r(this.targetAttachment,this.attachment),this.updateAttachClasses(this.attachment,M),e=this.cache("element-bounds",function(){return p(D.element)}),F=e.width,n=e.height,0===F&&0===n&&null!=this.lastSize?(N=this.lastSize,F=N.width,n=N.height):this.lastSize={width:F,height:n},P=B=this.cache("target-bounds",function(){return D.getTargetBounds()}),b=v(l(this.attachment),{width:F,height:n}),z=v(l(M),P),a=v(this.offset,{width:F,height:n}),d=v(this.targetOffset,P),b=s(b,a),z=s(z,d),h=B.left+z.left-b.left,_=B.top+z.top-b.top,j=i.modules,L=0,H=j.length;H>L;L++)if(c=j[L],x=c.position.call(this,{left:h,top:_,targetAttachment:M,targetPos:B,attachment:this.attachment,elementPos:e,offset:b,targetOffset:z,manualOffset:a,manualTargetOffset:d,scrollbarSize:S}),null!=x&&"object"==typeof x){if(x===!1)return!1;_=x.top,h=x.left}if(m={page:{top:_,left:h},viewport:{top:_-pageYOffset,bottom:pageYOffset-_-n+innerHeight,left:h-pageXOffset,right:pageXOffset-h-F+innerWidth}},document.body.scrollWidth>window.innerWidth&&(S=this.cache("scrollbar-size",g),m.viewport.bottom-=S.height),document.body.scrollHeight>window.innerHeight&&(S=this.cache("scrollbar-size",g),m.viewport.right-=S.width),(""!==(R=document.body.style.position)&&"static"!==R||""!==(U=document.body.parentElement.style.position)&&"static"!==U)&&(m.page.bottom=document.body.scrollHeight-_-n,m.page.right=document.body.scrollWidth-h-F),(null!=(q=this.options.optimizations)?q.moveElement:void 0)!==!1&&null==this.targetModifier){for(w=this.cache("target-offsetparent",function(){return u(D.target)}),T=this.cache("target-offsetparent-bounds",function(){return p(w)}),O=getComputedStyle(w),o=getComputedStyle(this.element),C=T,y={},k=["Top","Left","Bottom","Right"],Y=0,X=k.length;X>Y;Y++)W=k[Y],y[W.toLowerCase()]=parseFloat(O["border"+W+"Width"]);T.right=document.body.scrollWidth-T.left-C.width+y.right,T.bottom=document.body.scrollHeight-T.top-C.height+y.bottom,m.page.top>=T.top+y.top&&m.page.bottom>=T.bottom&&m.page.left>=T.left+y.left&&m.page.right>=T.right&&(E=w.scrollTop,A=w.scrollLeft,m.offset={top:m.page.top-T.top+E-y.top,left:m.page.left-T.left+A-y.left})}return this.move(m),this.history.unshift(m),this.history.length>3&&this.history.pop(),t&&f(),!0}},t.prototype.move=function(t){var e,o,i,n,s,l,r,f,p,d,g,c,m,b,v,y,w,C=this;if(null!=this.element.parentNode){f={};for(d in t){f[d]={};for(n in t[d]){for(i=!1,y=this.history,b=0,v=y.length;v>b;b++)if(r=y[b],!E(null!=(w=r[d])?w[n]:void 0,t[d][n])){i=!0;break}i||(f[d][n]=!0)}}e={top:"",left:"",right:"",bottom:""},p=function(t,o){var i,n,s;return(null!=(s=C.options.optimizations)?s.gpu:void 0)===!1?(t.top?e.top=""+o.top+"px":e.bottom=""+o.bottom+"px",t.left?e.left=""+o.left+"px":e.right=""+o.right+"px"):(t.top?(e.top=0,n=o.top):(e.bottom=0,n=-o.bottom),t.left?(e.left=0,i=o.left):(e.right=0,i=-o.right),e[x]="translateX("+Math.round(i)+"px) translateY("+Math.round(n)+"px)","msTransform"!==x?e[x]+=" translateZ(0)":void 0)},s=!1,(f.page.top||f.page.bottom)&&(f.page.left||f.page.right)?(e.position="absolute",p(f.page,t.page)):(f.viewport.top||f.viewport.bottom)&&(f.viewport.left||f.viewport.right)?(e.position="fixed",p(f.viewport,t.viewport)):null!=f.offset&&f.offset.top&&f.offset.left?(e.position="absolute",l=this.cache("target-offsetparent",function(){return u(C.target)}),u(this.element)!==l&&h(function(){return C.element.parentNode.removeChild(C.element),l.appendChild(C.element)}),p(f.offset,t.offset),s=!0):(e.position="absolute",p({top:!0,left:!0},t.page)),s||"BODY"===this.element.parentNode.tagName||(this.element.parentNode.removeChild(this.element),document.body.appendChild(this.element)),m={},c=!1;for(n in e)g=e[n],o=this.element.style[n],""===o||""===g||"top"!==n&&"left"!==n&&"bottom"!==n&&"right"!==n||(o=parseFloat(o),g=parseFloat(g)),o!==g&&(c=!0,m[n]=e[n]);return c?h(function(){return a(C.element.style,m)}):void 0}},t}(),i.position=C,this.Tether=a(S,i)}.call(this),function(){var t,e,o,i,n,s,l,r,h,a,f=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};a=this.Tether.Utils,l=a.getOuterSize,s=a.getBounds,r=a.getSize,i=a.extend,h=a.updateClasses,o=a.defer,e={left:"right",right:"left",top:"bottom",bottom:"top",middle:"middle"},t=["left","top","right","bottom"],n=function(e,o){var i,n,l,r,h,a,f;if("scrollParent"===o?o=e.scrollParent:"window"===o&&(o=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),o===document&&(o=o.documentElement),null!=o.nodeType)for(n=r=s(o),h=getComputedStyle(o),o=[n.left,n.top,r.width+n.left,r.height+n.top],i=a=0,f=t.length;f>a;i=++a)l=t[i],l=l[0].toUpperCase()+l.substr(1),"Top"===l||"Left"===l?o[i]+=parseFloat(h["border"+l+"Width"]):o[i]-=parseFloat(h["border"+l+"Width"]);return o},this.Tether.modules.push({position:function(e){var l,r,a,p,u,d,g,c,m,b,v,y,w,C,O,T,x,A,E,S,W,M,z,B,P,_,F,L,Y,H,X,N,j,R,U,q,k,D,Z,V,$,G,I,J,K,Q,te,ee=this;if(_=e.top,v=e.left,W=e.targetAttachment,!this.options.constraints)return!0;for(A=function(e){var o,i,n,s;for(ee.removeClass(e),s=[],i=0,n=t.length;n>i;i++)o=t[i],s.push(ee.removeClass(""+e+"-"+o));return s},V=this.cache("element-bounds",function(){return s(ee.element)}),b=V.height,F=V.width,0===F&&0===b&&null!=this.lastSize&&($=this.lastSize,F=$.width,b=$.height),z=this.cache("target-bounds",function(){return ee.getTargetBounds()}),M=z.height,B=z.width,S={},m={},r=[this.getClass("pinned"),this.getClass("out-of-bounds")],G=this.options.constraints,L=0,N=G.length;N>L;L++)c=G[L],c.outOfBoundsClass&&r.push(c.outOfBoundsClass),c.pinnedClass&&r.push(c.pinnedClass);for(Y=0,j=r.length;j>Y;Y++)for(g=r[Y],I=["left","top","right","bottom"],H=0,R=I.length;R>H;H++)E=I[H],r.push(""+g+"-"+E);for(l=[],S=i({},W),m=i({},this.attachment),J=this.options.constraints,X=0,U=J.length;U>X;X++){if(c=J[X],P=c.to,a=c.attachment,O=c.pin,null==a&&(a=""),f.call(a," ")>=0?(K=a.split(" "),d=K[0],u=K[1]):u=d=a,p=n(this,P),("target"===d||"both"===d)&&(_<p[1]&&"top"===S.top&&(_+=M,S.top="bottom"),_+b>p[3]&&"bottom"===S.top&&(_-=M,S.top="top")),"together"===d&&(_<p[1]&&"top"===S.top&&("bottom"===m.top?(_+=M,S.top="bottom",_+=b,m.top="top"):"top"===m.top&&(_+=M,S.top="bottom",_-=b,m.top="bottom")),_+b>p[3]&&"bottom"===S.top&&("top"===m.top?(_-=M,S.top="top",_-=b,m.top="bottom"):"bottom"===m.top&&(_-=M,S.top="top",_+=b,m.top="top")),"middle"===S.top&&(_+b>p[3]&&"top"===m.top?(_-=b,m.top="bottom"):_<p[1]&&"bottom"===m.top&&(_+=b,m.top="top"))),("target"===u||"both"===u)&&(v<p[0]&&"left"===S.left&&(v+=B,S.left="right"),v+F>p[2]&&"right"===S.left&&(v-=B,S.left="left")),"together"===u&&(v<p[0]&&"left"===S.left?"right"===m.left?(v+=B,S.left="right",v+=F,m.left="left"):"left"===m.left&&(v+=B,S.left="right",v-=F,m.left="right"):v+F>p[2]&&"right"===S.left?"left"===m.left?(v-=B,S.left="left",v-=F,m.left="right"):"right"===m.left&&(v-=B,S.left="left",v+=F,m.left="left"):"center"===S.left&&(v+F>p[2]&&"left"===m.left?(v-=F,m.left="right"):v<p[0]&&"right"===m.left&&(v+=F,m.left="left"))),("element"===d||"both"===d)&&(_<p[1]&&"bottom"===m.top&&(_+=b,m.top="top"),_+b>p[3]&&"top"===m.top&&(_-=b,m.top="bottom")),("element"===u||"both"===u)&&(v<p[0]&&"right"===m.left&&(v+=F,m.left="left"),v+F>p[2]&&"left"===m.left&&(v-=F,m.left="right")),"string"==typeof O?O=function(){var t,e,o,i;for(o=O.split(","),i=[],e=0,t=o.length;t>e;e++)C=o[e],i.push(C.trim());return i}():O===!0&&(O=["top","left","right","bottom"]),O||(O=[]),T=[],y=[],_<p[1]&&(f.call(O,"top")>=0?(_=p[1],T.push("top")):y.push("top")),_+b>p[3]&&(f.call(O,"bottom")>=0?(_=p[3]-b,T.push("bottom")):y.push("bottom")),v<p[0]&&(f.call(O,"left")>=0?(v=p[0],T.push("left")):y.push("left")),v+F>p[2]&&(f.call(O,"right")>=0?(v=p[2]-F,T.push("right")):y.push("right")),T.length)for(x=null!=(Q=this.options.pinnedClass)?Q:this.getClass("pinned"),l.push(x),D=0,q=T.length;q>D;D++)E=T[D],l.push(""+x+"-"+E);if(y.length)for(w=null!=(te=this.options.outOfBoundsClass)?te:this.getClass("out-of-bounds"),l.push(w),Z=0,k=y.length;k>Z;Z++)E=y[Z],l.push(""+w+"-"+E);(f.call(T,"left")>=0||f.call(T,"right")>=0)&&(m.left=S.left=!1),(f.call(T,"top")>=0||f.call(T,"bottom")>=0)&&(m.top=S.top=!1),(S.top!==W.top||S.left!==W.left||m.top!==this.attachment.top||m.left!==this.attachment.left)&&this.updateAttachClasses(m,S)}return o(function(){return h(ee.target,l,r),h(ee.element,l,r)}),{top:_,left:v}}})}.call(this),function(){var t,e,o,i;i=this.Tether.Utils,e=i.getBounds,o=i.updateClasses,t=i.defer,this.Tether.modules.push({position:function(i){var n,s,l,r,h,a,f,p,u,d,g,c,m,b,v,y,w,C,O,T,x,A,E,S,W,M=this;if(g=i.top,a=i.left,x=this.cache("element-bounds",function(){return e(M.element)}),h=x.height,c=x.width,d=this.getTargetBounds(),r=g+h,f=a+c,n=[],g<=d.bottom&&r>=d.top)for(A=["left","right"],m=0,w=A.length;w>m;m++)p=A[m],((E=d[p])===a||E===f)&&n.push(p);if(a<=d.right&&f>=d.left)for(S=["top","bottom"],b=0,C=S.length;C>b;b++)p=S[b],((W=d[p])===g||W===r)&&n.push(p);for(l=[],s=[],u=["left","top","right","bottom"],l.push(this.getClass("abutted")),v=0,O=u.length;O>v;v++)p=u[v],l.push(""+this.getClass("abutted")+"-"+p);for(n.length&&s.push(this.getClass("abutted")),y=0,T=n.length;T>y;y++)p=n[y],s.push(""+this.getClass("abutted")+"-"+p);return t(function(){return o(M.target,s,l),o(M.element,s,l)}),!0}})}.call(this),function(){this.Tether.modules.push({position:function(t){var e,o,i,n,s,l,r;return l=t.top,e=t.left,this.options.shift?(o=function(t){return"function"==typeof t?t.call(this,{top:l,left:e}):t},i=o(this.options.shift),"string"==typeof i?(i=i.split(" "),i[1]||(i[1]=i[0]),s=i[0],n=i[1],s=parseFloat(s,10),n=parseFloat(n,10)):(r=[i.top,i.left],s=r[0],n=r[1]),l+=s,e+=n,{top:l,left:e}):void 0}})}.call(this),this.Tether});
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/lock',['backbone.marionette', 'text!templates/gadget_lock.html', 'vent', 'tether'], function(Marionette, template, vent, Tether) {
    var CN_LOCKED, GadgetLockView, _ref;
    CN_LOCKED = 'gadget-locked';
    return GadgetLockView = (function(_super) {
      __extends(GadgetLockView, _super);

      function GadgetLockView() {
        _ref = GadgetLockView.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      GadgetLockView.prototype.template = _.template(template);

      GadgetLockView.prototype.initialize = function(_arg) {
        this.model = _arg.model, this.site = _arg.site, this.mediator = _arg.mediator, this.conn = _arg.conn;
        return this.gadget = this.model;
      };

      GadgetLockView.prototype.onShow = function() {
        var _this = this;
        vent.on('lock:lock', this.onLockLocked, this);
        vent.on('lock:unlock', this.onLockUnlocked, this);
        this.conn.on('ws:close', this._unlock, this);
        return this.conn.activeLocks.each(function(lock) {
          return _this.onLockLocked(lock);
        });
      };

      GadgetLockView.prototype.onClose = function() {
        vent.off('lock:lock', this.onLockLocked, this);
        vent.off('lock:unlock', this.onLockUnlocked, this);
        return this.conn.off('ws:close', this._unlock, this);
      };

      GadgetLockView.prototype.ui = {
        'editor': '.js-lock-avator',
        'lock': '.icon-lock'
      };

      GadgetLockView.prototype.isLocked = function() {
        return !!this.gadget.lock;
      };

      GadgetLockView.prototype.templateHelpers = function() {
        var _this = this;
        return {
          isLocked: function() {
            return _this.isLocked();
          },
          name: function() {
            if (!_this.gadget.lock) {
              return;
            }
            return _this.gadget.lock.get('user').firstname || _this.gadget.lock.get('user').fn || 'Anonymous';
          },
          profileImage: function() {
            var image, representations, _ref1;
            if (!_this.gadget.lock) {
              return;
            }
            representations = (_ref1 = _this.gadget.lock.get('user').image) != null ? _ref1.representations : void 0;
            if (representations) {
              image = _.find(representations, function(representation) {
                return representation.scale === "140x140";
              });
              return image.location;
            } else {
              return "" + _this.site + "/assets/img/defaults/profile-retina.jpg";
            }
          }
        };
      };

      GadgetLockView.prototype.onRender = function() {
        var _ref1, _ref2,
          _this = this;
        if (this.isLocked()) {
          this._lockTooltip = this.$('.collab-lock-tooltip');
          this._lockIcon = this.$('.collab-lock-icon');
          this._lockIcon.on('mouseover', function() {
            return _this._lockTooltip.css({
              'z-index': 50,
              opacity: 1
            });
          });
          this._lockIcon.on('mouseout', function() {
            _this._lockTooltip.css({
              opacity: 0
            });
            return setTimeout((function() {
              return _this._lockTooltip.css({
                'z-index': -1
              });
            }), 250);
          });
          return this._tether = new Tether({
            element: this._lockTooltip[0],
            target: this._lockIcon[0],
            attachment: 'top right',
            targetAttachment: 'middle left',
            offset: '16px 15px'
          });
        } else {
          if ((_ref1 = this._lockTooltip) != null) {
            _ref1.remove();
          }
          if ((_ref2 = this._tether) != null) {
            _ref2.destroy();
          }
          return this._tether = null;
        }
      };

      GadgetLockView.prototype.onLockLocked = function(lock) {
        if (lock.get('gadgetId') === this.gadget.id) {
          return this.updateLock(lock);
        }
      };

      GadgetLockView.prototype.updateLock = function(lock) {
        if (lock.get('user').id === this.conn.me.id) {
          return;
        }
        this.gadget.lock = lock;
        if (lock.user !== this.conn.me) {
          this.$el.closest('.gadget').toggleClass(CN_LOCKED, true);
        }
        return this.render();
      };

      GadgetLockView.prototype.onLockUnlocked = function(lock) {
        var gadgetId;
        gadgetId = lock.get('gadgetId');
        if (this.conn.gadgetHasUpdates(gadgetId)) {
          return;
        }
        if (this.gadget.lock && gadgetId === this.gadget.id) {
          return this._unlock();
        }
      };

      GadgetLockView.prototype._unlock = function() {
        if (!this.gadget.lock) {
          return;
        }
        if (this.gadget.lock.user !== this.conn.me) {
          this.$el.closest('.gadget').toggleClass(CN_LOCKED, false);
        }
        delete this.gadget.lock;
        return this.render();
      };

      return GadgetLockView;

    })(Marionette.ItemView);
  });

}).call(this);


define('text!templates/update.html',[],function () { return '<div class="updateNotification">\n  <i class="icon-refresh"></i><span class="updateNotificationMsg">See new update<span>\n</div>';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/update',['underscore', 'backbone.marionette', 'text!templates/update.html', 'vent'], function(_, Marionette, template, vent) {
    var UpdateView, _ref;
    return UpdateView = (function(_super) {
      __extends(UpdateView, _super);

      function UpdateView() {
        this.onCollabUpdate = __bind(this.onCollabUpdate, this);
        this.onCourseRefetchFail = __bind(this.onCourseRefetchFail, this);
        this.onCourseRefetchSuccess = __bind(this.onCourseRefetchSuccess, this);
        this.onUpdateNotificationClick = __bind(this.onUpdateNotificationClick, this);
        this.onLessonOpened = __bind(this.onLessonOpened, this);
        _ref = UpdateView.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      UpdateView.prototype.initialize = function(_arg) {
        this.conn = _arg.conn, this.mediator = _arg.mediator;
        return this._containerSlideTime = 80;
      };

      UpdateView.prototype.ui = {
        collabErrorMsg: '.collabErrorMsg',
        updateNotificationMsg: '.updateNotificationMsg',
        updateNotification: '.updateNotification'
      };

      UpdateView.prototype.events = {
        'click .updateNotification': 'onUpdateNotificationClick'
      };

      UpdateView.prototype.template = _.template(template);

      UpdateView.prototype.onShow = function() {
        vent.on('collab:update', this.onCollabUpdate);
        vent.on('lesson:opened', this.onLessonOpened);
        this.conn.on('collab:ready', this.onEnableCollab);
        return this.conn.on('collab:close', this.onDisableCollab);
      };

      UpdateView.prototype.onClose = function() {
        vent.off('collab:update', this.onCollabUpdate);
        vent.off('lesson:opened', this.onLessonOpened);
        this.conn.off('collab:ready', this.onEnableCollab);
        return this.conn.off('collab:close', this.onDisableCollab);
      };

      UpdateView.prototype.onLessonOpened = function(lesson) {
        return this.lesson = lesson;
      };

      UpdateView.prototype.onUpdateNotificationClick = function() {
        this.conn.resetUpdates();
        this.message('Fetching Updates...');
        return this.lesson.fetch().done(this.onCourseRefetchSuccess).fail(this.onCourseRefetchFail);
      };

      UpdateView.prototype.onCourseRefetchSuccess = function() {
        if (this.conn.hasUpdates()) {
          return this.onCollabUpdate();
        } else {
          return this.slideUp();
        }
      };

      UpdateView.prototype.onCourseRefetchFail = function() {
        return this.message('Failed to update lesson, please try again!');
      };

      UpdateView.prototype.onCollabUpdate = function() {
        var msg;
        msg = this.conn.updateCount() === 1 ? "See new update" : "See " + (this.conn.updateCount()) + " new updates";
        if (this.conn.hasGadgetUpdates()) {
          msg += '; unlock updated gadgets';
        }
        this.message(msg);
        return this.slideDown();
      };

      UpdateView.prototype.slideUp = function() {
        return this.ui.updateNotification.slideUp(this._containerSlideTime);
      };

      UpdateView.prototype.slideDown = function() {
        return this.ui.updateNotification.slideDown(this._containerSlideTime);
      };

      UpdateView.prototype.message = function(msg) {
        return this.ui.updateNotificationMsg.text(msg);
      };

      return UpdateView;

    })(Marionette.Layout);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('collections/gadget_locks',['backbone', 'models/gadget_lock'], function(Backbone, GadgetLock) {
    var GadgetLocks, _ref;
    return GadgetLocks = (function(_super) {
      __extends(GadgetLocks, _super);

      function GadgetLocks() {
        _ref = GadgetLocks.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      GadgetLocks.prototype.model = GadgetLock;

      return GadgetLocks;

    })(Backbone.Collection);
  });

}).call(this);


define('text!styles/collab-client-bundle.css',[],function () { return '.collab-lock-icon{font-size:21px;color:$typeGrayDark;position:absolute;left:7px}.collab-lock-tooltip{z-index:50;position:absolute;font-family:\'AvenirNextLTPro-Regular\',\'Helvetica Neue\',Helvetica,Arial,sans-serif;font-size:12px;line-height:24px;padding:3px 10px 3px 3px;background:#fff;box-shadow:0 0 3px 0 rgba(108,106,95,0.6);opacity:0;transition:opacity 250ms;}.collab-lock-tooltip:after{content:\'\';display:block;position:absolute;right:-10px;top:10px;width:0;height:0;border-style:solid;border-width:6px 0 6px 10.4px;border-color:transparent transparent transparent #fff}.collab-lock-avatar{width:24px;height:24px;vertical-align:top;margin-right:5px}.comments-container{display:none;}.comments-container.comments-visible .comments-box{display:block}.comments-container.comments-visible .fv-bubble{transform:none;filter:none}.comments-container.comments-visible .commentAuthor{font-family:\'AvenirNextLTPro-Regular\',\'Helvetica Neue\',Helvetica,Arial,sans-serif;font-weight:bold}.comments-toolbar{position:absolute;list-style-type:none;padding:0;margin:0;top:0;color:#454442;text-align:left;right:-30px;color:#c7c3be;width:16px;}.comments-toolbar button{margin:7px}.comments-toolbar textarea{resize:none;margin:7px;color:#454442;font:12px \'AvenirNextLTPro-Regular\',\'Helvetica Neue\',Helvetica,Arial,sans-serif;width:196px;box-sizing:border-box}.comments-toolbar .deleted_comment{font-style:italic;color:#c7c3be}.comments-toolbar .actions{height:22px}.comments-toolbar .comment{color:#454442;font:12px \'AvenirNextLTPro-Regular\',\'Helvetica Neue\',Helvetica,Arial,sans-serif;border-width:1px;border-bottom:1px #e4e3e0 solid;padding:7px;line-height:18px;position:relative;}.comments-toolbar .comment:first-child{margin-top:-8px}.comments-toolbar .comment .delete-overlay{position:absolute;top:0;left:0;width:100%;height:100%;text-align:center;background:rgba(242,241,237,0.9);display:none;z-index:100;}.comments-toolbar .comment .delete-overlay .delete-content{position:absolute;top:50%;margin-top:-35px}.comments-toolbar .comment .delete-overlay button{display:inline-block;width:80px}.comments-toolbar .comment.compacted .comment-body{overflow:hidden;max-height:142px;position:relative;z-index:1}.comments-toolbar .comment.compacted .comment-actions{position:relative;z-index:2;box-shadow:0 -15px 10px #fff;}.comments-toolbar .comment.compacted .comment-actions .show-more{display:inline}.comments-toolbar .comment.expanded .comment-actions .show-less{display:inline}.comments-toolbar .comment img{width:40px;height:40px}.comments-toolbar .comment .commentInfo{display:inline-block;line-height:.2;}.comments-toolbar .comment .commentInfo .commentDate{color:#c7c3be}.comments-toolbar .comment .comment-actions{height:16px;position:relative;}.comments-toolbar .comment .comment-actions .comment-action{color:#c7c3be;text-decoration:underline;cursor:pointer}.comments-toolbar .comment .show-less,.comments-toolbar .comment .show-more{display:none}.comments-toolbar .comments{position:absolute;}.comments-toolbar .comments .errorMsg{text-align:center;color:#454442;font:12px \'AvenirNextLTPro-Regular\',\'Helvetica Neue\',Helvetica,Arial,sans-serif;margin:5px;padding:5px 0;background-color:rgba(242,241,237,0.9)}.comments-toolbar .comments-toggle{cursor:pointer;height:24px;}.comments-toolbar .comments-toggle:hover .fv-bubble{color:#c7c3be}.comments-toolbar .fv-bubble{margin-left:-5px;margin-top:-5px;font-size:24px;color:#eae9e7;transform:scaleX(-1);filter:FlipH}.comments-toolbar .icon-inner-text{margin-top:3px;margin-left:-5px;font:11px/1 \'AvenirNextLTPro-Regular\',\'Helvetica Neue\',Helvetica,Arial,sans-serif;color:#524e47;font-weight:bold;display:table-cell;vertical-align:middle}.comments-toolbar .comments-box{display:none;position:absolute;box-shadow:0 1px 12px #c7c3be;padding:0;background-color:#fff;z-index:1002;margin-left:20px;width:210px;}.comments-toolbar .comments-box.visible{display:block}.comments-toolbar .comments-box.above{bottom:0}.comments-toolbar .comments-box p{margin:5px}.comments-toolbar .comments-box .comment-body{margin-left:0}.comments-toolbar .comments-box .inner-comments{max-height:225px;height:auto;overflow:auto;margin-top:8px}.comments-toolbar .comments-box button{padding:1px 0;line-height:28px;width:95px;}.comments-toolbar .comments-box button.cancel-button{margin-right:0}.comments-toolbar .comments-box button.submit-button{margin-left:0}.updateNotificationContainer{position:fixed;top:0;width:100%;max-width:758px;left:291px;z-index:5010;margin:0 auto;text-align:center;cursor:pointer;}.updateNotificationContainer .updateNotification{display:none;cursor:pointer;color:#486b6d;padding:10px 0;background-color:rgba(242,241,237,0.9)}.updateNotificationContainer .updateNotificationMsg{margin-left:10px}\n';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define('collab',['underscore', 'backbone', 'handlers/users', 'handlers/locks', 'handlers/comments', 'handlers/updates', 'views/contributors', 'views/comments', 'views/lock', 'views/update', 'vent', 'models/gadget_comment', 'models/gadget_lock', 'collections/gadget_comments', 'collections/collapsible_gadget_comments', 'collections/gadget_locks', 'text!styles/collab-client-bundle.css'], function(_, Backbone, UsersHandler, LocksHandler, CommentsHandler, UpdatesHandler, ContributorsView, GadgetCommentsView, GadgetLockView, UpdateView, vent, GadgetComment, GadgetLock, GadgetComments, CollapsibleGadgetComments, GadgetLocks, collabStyle) {
    var Collab;
    Collab = (function() {
      function Collab() {
        this._populatePlayerUpdate = __bind(this._populatePlayerUpdate, this);
        this._populatePlayerContrib = __bind(this._populatePlayerContrib, this);
        this.phoneHome = __bind(this.phoneHome, this);
        this.onMessage = __bind(this.onMessage, this);
        this.onClose = __bind(this.onClose, this);
        this.onOpen = __bind(this.onOpen, this);
        this.onError = __bind(this.onError, this);
        this.connect = __bind(this.connect, this);
      }

      _.extend(Collab.prototype, Backbone.Events);

      Collab.prototype.GadgetComment = GadgetComment;

      Collab.prototype.GadgetComments = GadgetComments;

      Collab.prototype.CollapsibleGadgetComments = CollapsibleGadgetComments;

      Collab.prototype.GadgetLock = GadgetLock;

      Collab.prototype.GadgetLocks = GadgetLocks;

      Collab.prototype.phoneHomeEveryMs = 60 * 1000;

      Collab.prototype.tryConnectingEveryMs = 2 * 1000;

      Collab.prototype.lastActivity = new Date;

      Collab.prototype.updates = [];

      Collab.prototype.init = function(mediator, options) {
        this.mediator = mediator;
        this.courseId = options.courseId, this.collabUrl = options.collabUrl, this.site = options.site;
        this.sessionId = options.api.sessionId;
        this.connect();
        this.resetLastActivity();
        this._injectStyles();
        new UsersHandler(this);
        new LocksHandler(this);
        new CommentsHandler(this);
        new UpdatesHandler(this);
        this.contributorsView = new ContributorsView({
          mediator: this.mediator,
          conn: this,
          site: this.site
        });
        this.updateBarView = new UpdateView({
          mediator: this.mediator,
          conn: this
        });
        this.enabled = false;
        this.subscribed = false;
        this.activeLocks = new this.GadgetLocks;
        this.initializedGadgetViewContainers = [];
        this.mediator.on('lesson:opened', this.onLessonOpened, this);
        this.mediator.on('lesson:closed', this.onLessonClosed, this);
        this.mediator.on('gadget:rendered', this.onGadgetRendered, this);
        this.mediator.on('player:authorSideBar:ready', this._populatePlayerContrib, this);
        return this.mediator.on('player:course:ready', this._populatePlayerUpdate, this);
      };

      Collab.prototype.onLessonOpened = function(lesson) {
        var _this = this;
        if (this.enabled) {
          return this.checkForIdAndSubscribe(lesson);
        } else {
          return this.once('ws:open', function() {
            return _this.checkForIdAndSubscribe(lesson);
          });
        }
      };

      Collab.prototype.checkForIdAndSubscribe = function(lesson) {
        var _this = this;
        if (this.subscribed) {
          return;
        }
        if (lesson.id) {
          this.subscribe(lesson.id);
          return vent.trigger('lesson:opened', lesson);
        } else {
          return lesson.once('sync change', function() {
            return _this.checkForIdAndSubscribe(lesson);
          });
        }
      };

      Collab.prototype.onLessonClosed = function(lesson) {
        this.unsubscribe(lesson.id);
        return this.subscribed = false;
      };

      Collab.prototype.connect = function() {
        this.socket = new WebSocket(this.collabUrl);
        this.socket.onopen = this.onOpen;
        this.socket.onclose = this.onClose;
        this.socket.onerror = this.onError;
        return this.socket.onmessage = this.onMessage;
      };

      Collab.prototype.onError = function(error) {
        var message;
        message = error.channel ? "error connecting to course " + error.channel.courseId + " lesson " + error.channel.courseId : "error connecting to " + this.collabUrl;
        return this.trigger('ws:error', message, error);
      };

      Collab.prototype.onOpen = function() {
        this.cancelRetryConnect();
        this.phoneHomePeriodically();
        this.enabled = true;
        if (this.lessonId) {
          this.subscribe(this.lessonId);
        }
        this.trigger('ws:open');
        return this.mediator.trigger('course:collab:open');
      };

      Collab.prototype.subscribe = function(lessonId) {
        this.lessonId = lessonId;
        if (!this.lessonId) {
          throw new Error('No lesson ID to subscribe to');
        }
        return this.triggerEvent('subscribe', {
          sessionId: this.sessionId
        });
      };

      Collab.prototype.unsubscribe = function() {
        this.triggerEvent('unsubscribe');
        return delete this.lessonId;
      };

      Collab.prototype.onClose = function() {
        clearTimeout(this.phoneHomeId);
        this.scheduleRetryConnect();
        this.enabled = false;
        this.subscribed = false;
        this.trigger('ws:close');
        this.trigger('unsubscribed');
        return this.mediator.trigger('course:collab:close');
      };

      Collab.prototype.resetLastActivity = function() {
        return this.lastActivity = new Date().getTime();
      };

      Collab.prototype.onMessage = function(rawPayload) {
        var data, payload;
        if (!this.subscribed) {
          this.subscribed = true;
          this.trigger('subscribed');
        }
        payload = JSON.parse(rawPayload.data);
        data = this._dataToModels(payload);
        return this.trigger(payload.name, data);
      };

      Collab.prototype.scheduleRetryConnect = function() {
        return this.retryId = setTimeout(this.connect, this.tryConnectingEveryMs);
      };

      Collab.prototype.cancelRetryConnect = function() {
        if (this.retryId) {
          return clearTimeout(this.retryId);
        }
      };

      Collab.prototype.phoneHome = function() {
        var now;
        now = new Date().getTime();
        return this.triggerEvent('ping', {
          idleMs: now - this.lastActivity
        });
      };

      Collab.prototype.phoneHomePeriodically = _.once(function() {
        return this.phoneHomeId = setInterval(this.phoneHome, this.phoneHomeEveryMs);
      });

      Collab.prototype.onGadgetRendered = function(gadget) {
        return this._populatePlayerCommentsLocks(gadget);
      };

      Collab.prototype.triggerEvent = function(name, data) {
        var channel;
        channel = {
          lessonId: this.lessonId,
          courseId: this.courseId
        };
        return this.socket.send(JSON.stringify({
          name: name,
          channel: channel,
          data: data
        }));
      };

      Collab.prototype.hasUpdates = function() {
        return !!this.updates.length;
      };

      Collab.prototype.updateCount = function() {
        return this.updates.length;
      };

      Collab.prototype.resetUpdates = function() {
        return this.updates = [];
      };

      Collab.prototype.hasGadgetUpdates = function() {
        return _.any(this.updates, function(update) {
          return _.has(update, 'gadgetId');
        });
      };

      Collab.prototype.gadgetHasUpdates = function(gadgetId) {
        return !!_.findWhere(this.updates, {
          gadgetId: gadgetId
        });
      };

      Collab.prototype._dataToModels = function(payload) {
        var action, data, key, modelMap, modelName, _ref;
        modelMap = {
          comment: 'GadgetComment',
          comments: 'GadgetComments',
          lock: 'GadgetLock',
          locks: 'GadgetLocks'
        };
        data = this._dereferenceEventData(payload);
        _ref = payload.name.split(':'), key = _ref[0], action = _ref[1];
        modelName = modelMap[key];
        if (modelName && action !== 'delete') {
          return new vs.collab[modelName](data);
        } else {
          return data;
        }
      };

      Collab.prototype._dereferenceEventData = function(payload) {
        var key;
        key = payload.name.split(':').shift();
        return payload.data[key];
      };

      Collab.prototype._generateCommentsLocks = function(gadget) {
        var commentsView, lock, lockView, _ref;
        commentsView = new GadgetCommentsView({
          model: gadget,
          mediator: this.mediator,
          site: this.site,
          conn: this
        });
        lockView = new GadgetLockView({
          model: gadget,
          mediator: this.mediator,
          site: this.site,
          conn: this
        });
        if (lock = (_ref = this.activeLocks) != null ? _ref.findWhere({
          gadgetId: gadget.id
        }) : void 0) {
          lockView.updateLock(lock);
        }
        return {
          lockView: lockView,
          commentsView: commentsView
        };
      };

      Collab.prototype._populatePlayerCommentsLocks = function(gadget) {
        var commentsView, lockView, _ref;
        _ref = this._generateCommentsLocks(gadget), lockView = _ref.lockView, commentsView = _ref.commentsView;
        this.mediator.trigger('plugin:populate:gadgetCommentsRegion', commentsView);
        return this.mediator.trigger('plugin:populate:gadgetLockRegion', lockView);
      };

      Collab.prototype._populatePlayerContrib = function() {
        return this.mediator.trigger('plugin:populate:contributorsRegion', this.contributorsView);
      };

      Collab.prototype._populatePlayerUpdate = function() {
        return this.mediator.trigger('plugin:populate:updateBar', this.updateBarView);
      };

      Collab.prototype._injectStyles = function() {
        var style;
        style = document.createElement('style');
        style.textContent = collabStyle;
        return document.getElementsByTagName('head')[0].appendChild(style);
      };

      return Collab;

    })();
    return new Collab();
  });

}).call(this);

  define('underscore', [], function(){
    return window._;
  });

  define('backbone', [], function(){
    return window.Backbone;
  });

  define('backbone.marionette', [], function(){
    return window.Backbone.Marionette;
  });

  return require('collab');
}));
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/asset',['cdn.backbone', 'cdn.underscore'], function(Backbone, _) {

    /*
    To create and upload an asset you need to:
    
      asset = new Asset # create an asset
      asset.save { # upload an asset
        content: fs.createReadStream('file/path')
        contentType: 'image/png'
      }, { upload: true }
     */
    var Asset;
    return Asset = (function(_super) {
      __extends(Asset, _super);

      Asset.prototype.urlRoot = '/assets';

      Asset.prototype.defaults = {
        tags: []
      };

      function Asset(attrs, options) {
        if (attrs == null) {
          attrs = {};
        }
        if (options == null) {
          options = {};
        }
        this.representations = new Backbone.Collection([]);
        options.parse = true;
        Asset.__super__.constructor.call(this, attrs, options);
      }

      Asset.prototype.sync = function(method, model, options) {
        if (options == null) {
          options = {};
        }
        options.parse = true;
        return Backbone.sync.apply(this, [method, model, options]);
      };

      Asset.prototype.parse = function(attrs) {
        if (attrs.representations) {
          this._expandLocations(attrs);
          this.representations.set(attrs.representations);
          delete attrs.representations;
        }
        return attrs;
      };

      Asset.prototype.toJSON = function(options) {
        var json;
        if (options == null) {
          options = {};
        }
        json = _.clone(this.attributes);
        if (!options.upload) {
          json = _.omit(json, ['content', 'contentType']);
        }
        if (options.representations) {
          _.extend(json, {
            representations: this.representations.toJSON()
          });
        }
        return json;
      };

      Asset.prototype.validate = function(attrs, options) {
        if (options == null) {
          options = {};
        }
        if (this.attributes) {
          attrs = _.extend(this.attributes, attrs);
        }
        if (options.upload) {
          if (!attrs.content) {
            return 'content is required to upload an asset';
          }
          if (!attrs.contentType) {
            return 'contentType is required to upload an asset';
          }
        }
        if (!attrs.title) {
          return 'title is required';
        }
      };

      Asset.prototype._expandLocations = function(data) {
        if (!this.baseUrl) {
          return;
        }
        return _.each(data.representations, (function(_this) {
          return function(rep) {
            if (!rep.location.match(/^https?:\/\//)) {
              return rep.location = _this.baseUrl + rep.location;
            }
          };
        })(this));
      };

      return Asset;

    })(Backbone.Model);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/gadget',['cdn.backbone', 'cdn.underscore'], function(Backbone, _) {
    var Gadget;
    return Gadget = (function(_super) {
      __extends(Gadget, _super);

      function Gadget(attrs, options) {
        if (attrs == null) {
          attrs = {};
        }
        if (options == null) {
          options = {};
        }
        this.config = new Backbone.Model;
        this.config.isNew = function() {
          return false;
        };
        this.config.url = (function(_this) {
          return function() {
            return _.result(_this, 'url') + '/config';
          };
        })(this);
        this.userState = new Backbone.Model;
        this.userState.isNew = function() {
          return false;
        };
        this.userState.url = (function(_this) {
          return function() {
            return _.result(_this, 'url') + '/userstate';
          };
        })(this);
        options.parse = true;
        Gadget.__super__.constructor.call(this, attrs, options);
      }

      Gadget.prototype._locals = ['uploadPercent'];

      Gadget.prototype.parse = function(attrs) {
        if (!attrs) {
          return;
        }
        if (attrs.config) {
          this.config.set(_.clone(attrs.config), {
            silent: true
          });
        }
        if (attrs.userState) {
          this.userState.set(_.clone(attrs.userState), {
            silent: true
          });
        }
        if (attrs.gadgetProject) {
          this.gadgetProject = attrs.gadgetProject;
        }
        return _.omit(attrs, ['config', 'userState', 'gadgetProject']);
      };

      Gadget.prototype.toJSON = function() {
        var json;
        json = _.clone(this.attributes);
        if (this.config) {
          json.config = this.config.toJSON();
        }
        if (this.userState) {
          json.userState = this.userState.toJSON();
        }
        return _.omit(json, this._locals);
      };

      Gadget.prototype.validate = function(attrs) {
        if (!attrs.type) {
          return 'Type is required. Did you call parse:true when instantiated your gadget?';
        }
      };

      return Gadget;

    })(Backbone.Model);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/gadget_project',['cdn.backbone', 'cdn.underscore', 'models/gadget'], function(Backbone, _, Gadget) {
    var GadgetProject;
    return GadgetProject = (function(_super) {
      __extends(GadgetProject, _super);

      function GadgetProject() {
        return GadgetProject.__super__.constructor.apply(this, arguments);
      }

      GadgetProject.prototype.urlRoot = '/gadgets';

      GadgetProject.prototype.url = function() {
        var base;
        base = _.result(this.collection, 'url') || this.urlRoot;
        return _.flatten(_.compact([base, this.typeSegments()])).join('/');
      };

      GadgetProject.prototype.path = function(file) {
        var base;
        base = this.urlRoot;
        if (GadgetProject.prototype.apiUrl) {
          base = GadgetProject.prototype.apiUrl.replace(/\/$/, '') + base;
        }
        return _.flatten(_.compact([base, this.typeSegments(), file])).join('/');
      };

      GadgetProject.prototype.icon = function() {
        return this.path('assets/icon.png');
      };

      GadgetProject.prototype.typeSegments = function() {
        var version;
        version = this.get('version') || 'latest';
        return [this.get('username'), this.get('name'), version];
      };

      GadgetProject.prototype.type = function() {
        var type;
        type = "" + (this.get('username')) + "/" + (this.get('name'));
        if (this.get('version')) {
          type += "@" + (this.get('version'));
        }
        return type;
      };

      GadgetProject.prototype.shortType = function() {
        return "" + (this.get('username')) + "/" + (this.get('name'));
      };

      GadgetProject.prototype.cssClassName = function() {
        return ("gadget-" + (this.typeSegments().join('-'))).replace(/[\.\s]+/g, '_');
      };

      GadgetProject.prototype.fetch = function(opts) {
        if (opts == null) {
          opts = {};
        }
        return GadgetProject.__super__.fetch.call(this, _.extend(opts, {
          url: this.manifest()
        }));
      };

      GadgetProject.prototype.isNew = function() {
        return false;
      };

      GadgetProject.prototype.toJSON = function(opts) {
        if (opts != null ? opts.include : void 0) {
          return _.pick.apply(this, this.attributes, opts.include);
        } else {
          return _.clone(this.attributes);
        }
      };

      GadgetProject.prototype.buildInstance = function(attrs) {
        var instance, options;
        options = {
          config: this.get('defaultConfig'),
          userState: this.get('defaultUserState'),
          type: this.shortType()
        };
        _.extend(options, attrs);
        return instance = new Gadget(options);
      };

      return GadgetProject;

    })(Backbone.Model);
  });

}).call(this);

(function() {
  define('app/models/patch_backbone_sync',['cdn.backbone', 'cdn.jquery', 'cdn.underscore', 'models/asset', 'models/gadget_project'], function(Backbone, $, _, Asset, GadgetProject) {
    var BrowserUploadAdapter;
    BrowserUploadAdapter = (function() {
      function BrowserUploadAdapter() {}

      BrowserUploadAdapter.prototype.ajax = function(options) {
        var requestOptions;
        requestOptions = this.createRequestOptions(options);
        _.extend(requestOptions, {
          cache: false,
          contentType: false,
          processData: false
        });
        return $.ajax(requestOptions);
      };

      BrowserUploadAdapter.prototype.createRequestOptions = function(options) {
        return options;
      };

      BrowserUploadAdapter.prototype.createFormData = function(model) {
        var formData, key, val, _ref;
        formData = new FormData;
        _ref = model.toJSON({
          upload: true
        });
        for (key in _ref) {
          val = _ref[key];
          formData.append(key, this.normalizeValue(val));
        }
        return formData;
      };

      BrowserUploadAdapter.prototype.normalizeValue = function(val) {
        if (val instanceof File || val instanceof Blob) {
          return val;
        } else if (_.isArray(val) || _.isObject(val)) {
          return JSON.stringify(val);
        } else {
          return val;
        }
      };

      BrowserUploadAdapter.prototype.sendRequest = function(options) {};

      return BrowserUploadAdapter;

    })();
    return function(options) {
      var ajax, apiUrl, sessionId, sync;
      if (options == null) {
        options = {};
      }
      this.uploadAdapter = new BrowserUploadAdapter;
      if (options.url) {
        apiUrl = options.url.replace(/\/$/, '');
        Asset.prototype.baseUrl = apiUrl;
        GadgetProject.prototype.apiUrl = apiUrl;
        sessionId = options.sessionId;
      }
      ajax = Backbone.ajax;
      Backbone.ajax = (function(_this) {
        return function(opts) {
          if (opts.upload && _this.uploadAdapter) {
            return _this.uploadAdapter.ajax.apply(_this.uploadAdapter, arguments);
          } else {
            return ajax.apply(_this, arguments);
          }
        };
      })(this);
      sync = Backbone.sync;
      return Backbone.sync = (function(_this) {
        return function(method, model, options) {
          var beforeSend, urlPath;
          if (options == null) {
            options = {};
          }
          options = _.clone(options);
          urlPath = options.url || _.result(model, 'url');
          if (urlPath.match(/^https?:\/\//)) {
            options.url = urlPath;
          } else {
            options.url = apiUrl + urlPath;
          }
          beforeSend = options.beforeSend;
          options.beforeSend = function(xhr) {
            if (sessionId) {
              xhr.setRequestHeader('SESSION_ID', sessionId);
            }
            if (beforeSend) {
              return beforeSend.apply(_this, arguments);
            }
          };
          if (options.upload) {
            options.data = _this.uploadAdapter.createFormData(model);
          }
          return sync.apply(_this, arguments);
        };
      })(this);
    };
  });

}).call(this);

/**
 * @license RequireJS text 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
/*jslint regexp: true */
/*global require: false, XMLHttpRequest: false, ActiveXObject: false,
  define: false, window: false, process: false, Packages: false,
  java: false, location: false */

define('text',['module'], function (module) {
    

    var text, fs,
        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],
        xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
        bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
        hasLocation = typeof location !== 'undefined' && location.href,
        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''),
        defaultHostName = hasLocation && location.hostname,
        defaultPort = hasLocation && (location.port || undefined),
        buildMap = [],
        masterConfig = (module.config && module.config()) || {};

    text = {
        version: '2.0.5',

        strip: function (content) {
            //Strips <?xml ...?> declarations so that external SVG and XML
            //documents can be added to a document without worry. Also, if the string
            //is an HTML document, only the part inside the body tag is returned.
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = "";
            }
            return content;
        },

        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1')
                .replace(/[\f]/g, "\\f")
                .replace(/[\b]/g, "\\b")
                .replace(/[\n]/g, "\\n")
                .replace(/[\t]/g, "\\t")
                .replace(/[\r]/g, "\\r")
                .replace(/[\u2028]/g, "\\u2028")
                .replace(/[\u2029]/g, "\\u2029");
        },

        createXhr: masterConfig.createXhr || function () {
            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {}

                    if (xhr) {
                        progIds = [progId];  // so faster next time
                        break;
                    }
                }
            }

            return xhr;
        },

        /**
         * Parses a resource name into its component parts. Resource names
         * look like: module/name.ext!strip, where the !strip part is
         * optional.
         * @param {String} name the resource name
         * @returns {Object} with properties "moduleName", "ext" and "strip"
         * where strip is a boolean.
         */
        parseName: function (name) {
            var modName, ext, temp,
                strip = false,
                index = name.indexOf("."),
                isRelative = name.indexOf('./') === 0 ||
                             name.indexOf('../') === 0;

            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length);
            } else {
                modName = name;
            }

            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                //Pull off the strip arg.
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }

            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },

        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,

        /**
         * Is an URL on another domain. Only works for browser use, returns
         * false in non-browser environments. Only used to know if an
         * optimized .js version of a text resource should be loaded
         * instead.
         * @param {String} url
         * @returns Boolean
         */
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort,
                match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];

            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];

            return (!uProtocol || uProtocol === protocol) &&
                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&
                   ((!uPort && !uHostName) || uPort === port);
        },

        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },

        load: function (name, req, onLoad, config) {
            //Name has format: some.module.filext!strip
            //The strip part is optional.
            //if strip is present, then that means only get the string contents
            //inside a body tag in an HTML string. For XML/SVG content it means
            //removing the <?xml ...?> declarations so the content can be inserted
            //into the current doc without problems.

            // Do not bother with the work if a build and text will
            // not be inlined.
            if (config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }

            masterConfig.isBuild = config.isBuild;

            var parsed = text.parseName(name),
                nonStripName = parsed.moduleName +
                    (parsed.ext ? '.' + parsed.ext : ''),
                url = req.toUrl(nonStripName),
                useXhr = (masterConfig.useXhr) ||
                         text.useXhr;

            //Load the text. Use XHR if possible and in a browser.
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                //Need to fetch the resource across domains. Assume
                //the resource has been optimized into a JS module. Fetch
                //by the module name + extension, but do not include the
                //!strip part to avoid file system issues.
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,
                                    parsed.strip, content, onLoad);
                });
            }
        },

        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName,
                               "define(function () { return '" +
                                   content +
                               "';});\n");
            }
        },

        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName),
                extPart = parsed.ext ? '.' + parsed.ext : '',
                nonStripName = parsed.moduleName + extPart,
                //Use a '.js' file name so that it indicates it is a
                //script that can be loaded across domains.
                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';

            //Leverage own load() method to load plugin value, but only
            //write out values that do not have the strip argument,
            //to avoid any potential issues with ! in file names.
            text.load(nonStripName, req, function (value) {
                //Use own write() method to construct full module value.
                //But need to create shell that translates writeFile's
                //write() to the right interface.
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };

                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node)) {
        //Using special require.nodeRequire, something added by r.js.
        fs = require.nodeRequire('fs');

        text.get = function (url, callback) {
            var file = fs.readFileSync(url, 'utf8');
            //Remove BOM (Byte Mark Order) from utf8 files if it is there.
            if (file.indexOf('\uFEFF') === 0) {
                file = file.substring(1);
            }
            callback(file);
        };
    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&
            text.createXhr())) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);

            //Allow plugins direct access to xhr headers
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }

            //Allow overrides specified in config
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }

            xhr.onreadystatechange = function (evt) {
                var status, err;
                //Do not explicitly handle errors, those should be
                //visible via console output in the browser.
                if (xhr.readyState === 4) {
                    status = xhr.status;
                    if (status > 399 && status < 600) {
                        //An http 4xx or 5xx error. Signal an error.
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        errback(err);
                    } else {
                        callback(xhr.responseText);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&
            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {
        //Why Java, why is this so awkward?
        text.get = function (url, callback) {
            var stringBuffer, line,
                encoding = "utf-8",
                file = new java.io.File(url),
                lineSeparator = java.lang.System.getProperty("line.separator"),
                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),
                content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();

                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324
                // http://www.unicode.org/faq/utf_bom.html

                // Note that when we use utf-8, the BOM should appear as "EF BB BF", but it doesn't due to this bug in the JDK:
                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058
                if (line && line.length() && line.charAt(0) === 0xfeff) {
                    // Eat the BOM, since we've already found the encoding on this file,
                    // and we plan to concatenating this buffer with others; the BOM should
                    // only appear at the top of a file.
                    line = line.substring(1);
                }

                stringBuffer.append(line);

                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                //Make sure we return a JavaScript string and not a Java string.
                content = String(stringBuffer.toString()); //String
            } finally {
                input.close();
            }
            callback(content);
        };
    }

    return text;
});


define('text!templates/course.html',[],function () { return '<div class="js-update-notification-container updateNotificationContainer"></div>\n<div class="js-loading loading"></div>\n<div class="js-lessons lessons"></div>\n<div class="js-nav nav"></div>\n';});

(function() {
  define('app/mediator',['cdn.underscore', 'cdn.backbone'], function(_, Backbone) {
    var mediator;
    return mediator = _.clone(Backbone.Events);
  });

}).call(this);

(function() {
  define('plugins/clonedeep',[], function() {
    var cloneDeep;
    return cloneDeep = function(obj) {
      var k, tmp, v;
      if (obj === null || typeof obj !== 'object') {
        return obj;
      }
      tmp = obj.constructor();
      for (k in obj) {
        v = obj[k];
        tmp[k] = cloneDeep(v);
      }
      return tmp;
    };
  });

}).call(this);

(function() {
  define('models/settings',['cdn.underscore', 'plugins/clonedeep'], function(_, cloneDeep) {
    var defaults, options;
    defaults = {
      embed: false,
      site: '//versal.com',
      container: '.player-container',
      sdk: false,
      tracker: {
        path: 'https://opstats.versal.com/appevents'
      }
    };
    options = {};
    return {
      get: function(opt) {
        return cloneDeep(options[opt]);
      },
      set: function(opts) {
        if (!_.isEmpty(options)) {
          throw new Error('Options have already been set');
        }
        if (!_.isObject(opts)) {
          throw new Error('Options must be an object');
        }
        if (opts.api == null) {
          throw new Error('Please set options.api!');
        }
        return options = _.defaults({}, opts, defaults);
      },
      toJSON: function() {
        return cloneDeep(options);
      }
    };
  });

}).call(this);

define('libs/keen',[],function() {
  // Unfortunately, the current version of keen-js only supports being loaded globally.
  // It seems that the (unstable) new version will support requirejs better
  window.Keen=window.Keen||{configure:function(e){this._cf=e},addEvent:function(e,t,n,i){this._eq=this._eq||[],this._eq.push([e,t,n,i])},setGlobalProperties:function(e){this._gp=e},onChartsReady:function(e){this._ocrq=this._ocrq||[],this._ocrq.push(e)}};(function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://":"http://")+"dc8na2hxrj29i.cloudfront.net/code/keen-2.1.0-min.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();

  return window.Keen;
});

(function() {
  define('plugins/ops-reporter',['cdn.jquery', 'models/settings'], function($, settings) {
    var interval, queue, throttledSave, _deeplyAddTypes, _ref, _save;
    queue = [];
    interval = ((_ref = settings.get('tracker')) != null ? _ref.interval : void 0) || 20000;
    _save = function() {
      var oldQueue, path, _ref1, _ref2;
      path = (_ref1 = settings.get('tracker')) != null ? _ref1.path : void 0;
      if (!path || queue.length < 1) {
        return false;
      }
      oldQueue = _.clone(queue);
      return $.ajax({
        type: 'POST',
        url: path,
        contentType: 'application/json',
        data: JSON.stringify(queue),
        success: function() {
          return queue = _.difference(queue, oldQueue);
        },
        headers: {
          AUTHSID: (_ref2 = settings.get('api')) != null ? _ref2.sessionId : void 0
        }
      });
    };
    throttledSave = _.throttle(_save, interval, {
      leading: false
    });
    _deeplyAddTypes = function(obj) {
      var pairs;
      if (_.isArray(obj)) {
        return _.map(obj, _deeplyAddTypes);
      }
      if (_.isObject(obj)) {
        pairs = _.map(_.pairs(obj), (function(_this) {
          return function(_arg) {
            var key, newKey, newVal, val, _ref1;
            key = _arg[0], val = _arg[1];
            newKey = key + ((_ref1 = key.slice(-3)) === '_i' || _ref1 === '_f' || _ref1 === '_dt' || _ref1 === '_tsd' ? '' : _.isNumber(val) ? val % 1 === 0 ? '_i' : '_f' : _.isString(val) ? '_tsd' : '');
            newVal = _.isObject(val) ? _deeplyAddTypes(val) : val;
            return [newKey, newVal];
          };
        })(this));
        return _.object(pairs);
      } else {
        return obj;
      }
    };
    return {
      addEvent: function(name, data) {
        var e, messageOfRequestedFormat;
        try {
          messageOfRequestedFormat = _deeplyAddTypes({
            source: data['_source'] || 'player',
            event: name,
            data: data,
            ts_dt: Math.round((new Date).getTime() / 1000)
          });
          queue.push(messageOfRequestedFormat);
          return throttledSave();
        } catch (_error) {
          e = _error;
          return console.error(e);
        }
      }
    };
  });

}).call(this);

(function() {
  define('plugins/tracker',['cdn.underscore', 'cdn.jquery', 'models/settings', 'libs/keen', 'plugins/ops-reporter'], function(_, $, settings, KeenReporter, OpsReporter) {
    var SESSION_KEYS, Timer, Tracker, tracker;
    if (settings.get('keen')) {
      KeenReporter.configure(settings.get('keen'));
    }
    Timer = (function() {
      function Timer(opts) {
        this._name = opts.name || '';
        this._initialData = opts.data || {};
        this._stopCb = opts.done || (function() {});
        this._startTime = this._currentTime();
      }

      Timer.prototype.stop = function(finalData) {
        return this._stopCb({
          name: this._name,
          data: _.extend({}, this._initialData, finalData),
          duration: this._currentTime() - this._startTime
        });
      };

      Timer.prototype._currentTime = function() {
        return (new Date).getTime();
      };

      return Timer;

    })();
    SESSION_KEYS = ['courseId', 'userId', 'interactionId'];
    Tracker = (function() {
      function Tracker() {
        this._sessionData = {};
      }

      Tracker.prototype.configure = function(data) {
        return _.extend(this._sessionData, _.pick(data, SESSION_KEYS));
      };

      Tracker.prototype.track = function(name, data) {
        var detail, _ref, _ref1;
        if (data == null) {
          data = {};
        }
        detail = _.defaults(data, this._sessionData);
        if ((_ref = settings.get('tracker')) != null ? _ref.path : void 0) {
          OpsReporter.addEvent(name, detail);
        }
        if (settings.get('keen')) {
          KeenReporter.addEvent(name, detail);
        }
        if ((_ref1 = settings.get('tracker')) != null ? _ref1.debug : void 0) {
          return console.log('track:', name, data);
        }
      };

      Tracker.prototype.createTimer = function(name, data) {
        var onStopped;
        if (data == null) {
          data = {};
        }
        onStopped = (function(_this) {
          return function(_arg) {
            var data, duration, name;
            name = _arg.name, data = _arg.data, duration = _arg.duration;
            return _this.track(name, _.extend(data, {
              duration: duration
            }));
          };
        })(this);
        return new Timer({
          name: name,
          data: data,
          done: onStopped
        });
      };

      Tracker.prototype.timeXHR = function(jqXHR, name, data) {
        var timer;
        timer = this.createTimer(name, data);
        return jqXHR.always(function(data, status) {
          return timer.stop({
            status: status
          });
        });
      };

      return Tracker;

    })();
    return tracker = new Tracker();
  });

}).call(this);

/* js-ui just for you! version 0.0.12 @ 1ba1292 */
define('libs/vs.ui',["cdn.backbone"],function(){var e,t,o;return function(i){function r(e,t){return b.call(e,t)}function n(e,t){var o,i,r,n,s,l,a,c,d,u,h=t&&t.split("/"),p=v.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),c=0;c<e.length;c+=1)if(u=e[c],"."===u)e.splice(c,1),c-=1;else if(".."===u){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(o=e.split("/"),c=o.length;c>0;c-=1){if(i=o.slice(0,c).join("/"),h)for(d=h.length;d>0;d-=1)if(r=p[h.slice(0,d).join("/")],r&&(r=r[i])){n=r,s=c;break}if(n)break;!l&&m&&m[i]&&(l=m[i],a=c)}!n&&l&&(n=l,s=a),n&&(o.splice(0,s,n),e=o.join("/"))}return e}function s(e,t){return function(){return p.apply(i,x.call(arguments,0).concat([e,t]))}}function l(e){return function(t){return n(t,e)}}function a(e){return function(t){g[e]=t}}function c(e){if(r(w,e)){var t=w[e];delete w[e],y[e]=!0,h.apply(i,t)}if(!r(g,e)&&!r(y,e))throw new Error("No "+e);return g[e]}function d(e){var t,o=e?e.indexOf("!"):-1;return o>-1&&(t=e.substring(0,o),e=e.substring(o+1,e.length)),[t,e]}function u(e){return function(){return v&&v.config&&v.config[e]||{}}}var h,p,m,f,g={},w={},v={},y={},b=Object.prototype.hasOwnProperty,x=[].slice;m=function(e,t){var o,i=d(e),r=i[0];return e=i[1],r&&(r=n(r,t),o=c(r)),r?e=o&&o.normalize?o.normalize(e,l(t)):n(e,t):(e=n(e,t),i=d(e),r=i[0],e=i[1],r&&(o=c(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:o}},f={require:function(e){return s(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:u(e)}}},h=function(e,t,o,n){var l,d,u,h,p,v,b=[];if(n=n||e,"function"==typeof o){for(t=!t.length&&o.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(h=m(t[p],n),d=h.f,"require"===d)b[p]=f.require(e);else if("exports"===d)b[p]=f.exports(e),v=!0;else if("module"===d)l=b[p]=f.module(e);else if(r(g,d)||r(w,d)||r(y,d))b[p]=c(d);else{if(!h.p)throw new Error(e+" missing "+d);h.p.load(h.n,s(n,!0),a(d),{}),b[p]=g[d]}u=o.apply(g[e],b),e&&(l&&l.exports!==i&&l.exports!==g[e]?g[e]=l.exports:u===i&&v||(g[e]=u))}else e&&(g[e]=o)},e=t=p=function(e,t,o,r,n){return"string"==typeof e?f[e]?f[e](t):c(m(e,t).f):(e.splice||(v=e,t.splice?(e=t,t=o,o=null):e=i),t=t||function(){},"function"==typeof o&&(o=r,r=n),r?h(i,e,t,o):setTimeout(function(){h(i,e,t,o)},4),p)},p.config=function(e){return v=e,v.deps&&p(v.deps,v.callback),p},e._defined=g,o=function(e,t,o){t.splice||(o=t,t=[]),r(g,e)||r(w,e)||(w[e]=[e,t,o])},o.amd={jQuery:!0}}(),o("libs/almond",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};o("editable_text",[],function(){var t,o,i;return o=[],i=function(e){var t,o;return t=document.createRange(),t.selectNodeContents(e),o=window.getSelection(),o.removeAllRanges(),o.addRange(t),e.focus()},t=function(){function t(t){this.onFocus=e(this.onFocus,this),this.onBlur=e(this.onBlur,this),this.onKeyUp=e(this.onKeyUp,this),this.onKeyPress=e(this.onKeyPress,this),this.onKeyDown=e(this.onKeyDown,this),o.push(this),this.options=_.defaults(t,_.result(this,"defaults")),this.$el=this.options.el,this.$el.attr("contenteditable",!1),this.$el.addClass("vs-ui-editable-text"),this._isEditing=!1,this.options.charCount&&this.attachCharacterCount(this.options.charCount),this.$el.on(this.events())}return t.prototype.defaults=function(){return{el:$("<div>"),type:"input",charCount:0,success:function(){},abort:function(){},complete:function(){},maxlength:!1}},t.prototype.events=function(){return{blur:this.onBlur,focus:this.onFocus,keyup:this.onKeyUp,keydown:this.onKeyDown,keypress:this.onKeyPress}},t.prototype.onKeyDown=function(e){return 13===e.keyCode&&"input"===this.options.type&&(e.preventDefault(),this.success(),this.$el.blur()),27===e.keyCode?(e.preventDefault(),this.setText(this._oldContent),this.abort()):void 0},t.prototype.onKeyPress=function(e){var t,o,i;return t=e.originalEvent,i=!!(t.char||t.charCode&&String.fromCharCode(t.charCode)),o=this.getPretty().length,this.options.maxlength&&o>=this.options.maxlength&&i?e.preventDefault():void 0},t.prototype.onKeyUp=function(e){var t;return t=this.getPretty().length,this.options.maxlength&&t>this.options.maxlength&&this.setText(this.getPretty().slice(0,this.options.maxlength)),t||13===e.keyCode||this.$el.empty(),this.setCurrentCount(t)},t.prototype.onBlur=function(){return this.success(),this.hideCharCount()},t.prototype.onFocus=function(){return this.showCharCount()},t.prototype.selectText=function(){var e=this;return _.defer(function(){return i(e.$el[0])})},t.prototype.toggleEdit=function(e,t){var r,n=this;return null==t&&(t=!0),r=_.isBoolean(e),r&&e===this._isEditing?void 0:(this._isEditing=r?e:!this._isEditing,this._isEditing?(this.$el.attr("contenteditable",!0),t?_.defer(function(){return i(n.$el[0])}):this.hideCharCount(),this._oldContent=this.getPretty(),_.each(o,function(e){return n!==e&&e._isEditing?e.abort():void 0})):this.$el.attr("contenteditable",!1))},t.prototype.setText=function(e){return e?(this.$el.text(e),this.$el.html(this.$el.html().replace(/\n/gi,"<br>"))):void 0},t.prototype.getPretty=function(){var e;return e=$.trim(this.$el.html().replace(/\n/gi,"").replace(/<div><br><\/div>/gi,"\n").replace(/<div>/gi,"\n").replace(/<\/div>/gi,"").replace(/<br>/gi,"\n").replace(/\&nbsp\;/gi," ")),$("<div>").html(e).text()},t.prototype.attachCharacterCount=function(e){var t;return this.count=e,t='<div class="character-count pull-right">'+this.getPretty().length+"/"+this.count+"</div>",this.charCount=$(t),this.$el.after(this.charCount)},t.prototype.setCurrentCount=function(e){if(this.charCount){if(this.charCount.text(e+"/"+this.count),e>this.count&&!this._errorSet)return this._errorSet=!0,this.charCount.addClass("character-count-over");if(e<=this.count&&this._errorSet)return this._errorSet=!1,this.charCount.removeClass("character-count-over")}},t.prototype.showCharCount=function(){return this.charCount?this.charCount.removeClass("hidden"):void 0},t.prototype.hideCharCount=function(){return this.charCount?this.charCount.addClass("hidden"):void 0},t.prototype.abort=function(){return this.options.abort(),this.options.complete("abort")},t.prototype.success=function(){return this.options.success(this.getPretty()),this.options.complete("success")},t.prototype.destroy=function(){return this._isEditing&&this.toggleEdit(!1),this.$el.off(this.events()),o=_.without(o,this)},t}()})}.call(this),function(){o("loading",[],function(){var e;return e=function(){function e(e){var t,o;this.$parent=e,o=this.$parent.position(),t=$('<div class="loading">Loading</div>').css({top:o.top,left:o.left,position:"absolute"}),this.$el=t.appendTo(this.$parent)}return e.prototype.done=function(){return this.$el.remove()},e}()})}.call(this),o("../libs/spin",[],function(){return function(){function e(e,t){var o,i=document.createElement(e||"div");for(o in t)i[o]=t[o];return i}function t(e){for(var t=1,o=arguments.length;o>t;t++)e.appendChild(arguments[t]);return e}function o(e,t,o,i){var r=["opacity",t,~~(100*e),o,i].join("-"),n=.01+o/i*100,s=Math.max(1-(1-e)/t*(100-n),e),l=c.substring(0,c.indexOf("Animation")).toLowerCase(),a=l&&"-"+l+"-"||"";return u[r]||(h.insertRule("@"+a+"keyframes "+r+"{0%{opacity:"+s+"}"+n+"%{opacity:"+e+"}"+(n+.01)+"%{opacity:1}"+(n+t)%100+"%{opacity:"+e+"}100%{opacity:"+s+"}}",h.cssRules.length),u[r]=1),r}function i(e,t){var o,i,r=e.style;if(void 0!==r[t])return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),i=0;i<d.length;i++)if(o=d[i]+t,void 0!==r[o])return o}function r(e,t){for(var o in t)e.style[i(e,o)||o]=t[o];return e}function n(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)void 0===e[i]&&(e[i]=o[i])}return e}function s(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function l(e){return"undefined"==typeof this?new l(e):void(this.opts=n(e||{},l.defaults,p))}function a(){function o(t,o){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',o)}h.addRule(".spin-vml","behavior:url(#default#VML)"),l.prototype.lines=function(e,i){function n(){return r(o("group",{coordsize:c+" "+c,coordorigin:-a+" "+-a}),{width:c,height:c})}function s(e,s,l){t(u,t(r(n(),{rotation:360/i.lines*e+"deg",left:~~s}),t(r(o("roundrect",{arcsize:i.corners}),{width:a,height:i.width,left:i.radius,top:-i.width>>1,filter:l}),o("fill",{color:i.color,opacity:i.opacity}),o("stroke",{opacity:0}))))}var l,a=i.length+i.width,c=2*a,d=2*-(i.width+i.length)+"px",u=r(n(),{position:"absolute",top:d,left:d});if(i.shadow)for(l=1;l<=i.lines;l++)s(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=i.lines;l++)s(l);return t(e,u)},l.prototype.opacity=function(e,t,o,i){var r=e.firstChild;i=i.shadow&&i.lines||0,r&&t+i<r.childNodes.length&&(r=r.childNodes[t+i],r=r&&r.firstChild,r=r&&r.firstChild,r&&(r.opacity=o))}}var c,d=["webkit","Moz","ms","O"],u={},h=function(){var o=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],o),o.sheet||o.styleSheet}(),p={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};l.defaults={},n(l.prototype,{spin:function(t){this.stop();var o,i,n=this,l=n.opts,a=n.el=r(e(0,{className:l.className}),{position:l.position,width:0,zIndex:l.zIndex}),d=l.radius+l.length+l.width;if(t&&(t.insertBefore(a,t.firstChild||null),i=s(t),o=s(a),r(a,{left:("auto"==l.left?i.x-o.x+(t.offsetWidth>>1):parseInt(l.left,10)+d)+"px",top:("auto"==l.top?i.y-o.y+(t.offsetHeight>>1):parseInt(l.top,10)+d)+"px"})),a.setAttribute("role","progressbar"),n.lines(a,n.opts),!c){var u,h=0,p=(l.lines-1)*(1-l.direction)/2,m=l.fps,f=m/l.speed,g=(1-l.opacity)/(f*l.trail/100),w=f/l.lines;!function v(){h++;for(var e=0;e<l.lines;e++)u=Math.max(1-(h+(l.lines-e)*w)%f*g,l.opacity),n.opacity(a,e*l.direction+p,u,l);n.timeout=n.el&&setTimeout(v,~~(1e3/m))}()}return n},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(i,n){function s(t,o){return r(e(),{position:"absolute",width:n.length+n.width+"px",height:n.width+"px",background:t,boxShadow:o,transformOrigin:"left",transform:"rotate("+~~(360/n.lines*a+n.rotate)+"deg) translate("+n.radius+"px,0)",borderRadius:(n.corners*n.width>>1)+"px"})}for(var l,a=0,d=(n.lines-1)*(1-n.direction)/2;a<n.lines;a++)l=r(e(),{position:"absolute",top:1+~(n.width/2)+"px",transform:n.hwaccel?"translate3d(0,0,0)":"",opacity:n.opacity,animation:c&&o(n.opacity,n.trail,d+a*n.direction,n.lines)+" "+1/n.speed+"s linear infinite"}),n.shadow&&t(l,r(s("#000","0 0 4px #000"),{top:"2px"})),t(i,t(l,s(n.color,"0 0 1px rgba(0,0,0,.1)")));return i},opacity:function(e,t,o){t<e.childNodes.length&&(e.childNodes[t].style.opacity=o)}});var m=r(e("group"),{behavior:"url(#default#VML)"});return!i(m,"transform")&&m.adj?a():c=i(m,"animation"),l}()}),function(){o("loading_indicator",["../libs/spin"],function(e){var t;return t=function(){function t(t,o){var i;null==o&&(o="#000"),i={lines:15,length:2,width:2,radius:8,corners:.4,rotate:0,direction:1,color:o,speed:.8,trail:46,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},t instanceof $&&(t=t[0]),this.spinner=new e(i).spin(t)}return t.prototype.stop=function(){return this.spinner.stop()},t}()})}.call(this),function(e){var t=!1,o=!1,i=5e3,r=2e3,n=0,s=function(){var e=document.getElementsByTagName("script"),e=e[e.length-1].src.split("?")[0];return 0<e.split("/").length?e.split("/").slice(0,-1).join("/")+"/":""}(),l=["ms","moz","webkit","o"],c=window.requestAnimationFrame||!1,d=window.cancelAnimationFrame||!1;if(!c)for(var u in l){var h=l[u];c||(c=window[h+"RequestAnimationFrame"]),d||(d=window[h+"CancelAnimationFrame"]||window[h+"CancelRequestAnimationFrame"])}var p=window.MutationObserver||window.WebKitMutationObserver||!1,m={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:!1,cursordragontouch:!1,oneaxismousemode:"auto"},f=!1,g=function(){if(f)return f;var e=document.createElement("DIV"),t={haspointerlock:"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document};t.isopera="opera"in window,t.isopera12=t.isopera&&"getUserMedia"in navigator,t.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),t.isie="all"in document&&"attachEvent"in e&&!t.isopera,t.isieold=t.isie&&!("msInterpolationMode"in e.style),t.isie7=!(!t.isie||t.isieold||"documentMode"in document&&7!=document.documentMode),t.isie8=t.isie&&"documentMode"in document&&8==document.documentMode,t.isie9=t.isie&&"performance"in window&&9<=document.documentMode,t.isie10=t.isie&&"performance"in window&&10<=document.documentMode,t.isie9mobile=/iemobile.9/i.test(navigator.userAgent),t.isie9mobile&&(t.isie9=!1),t.isie7mobile=!t.isie9mobile&&t.isie7&&/iemobile/i.test(navigator.userAgent),t.ismozilla="MozAppearance"in e.style,t.iswebkit="WebkitAppearance"in e.style,t.ischrome="chrome"in window,t.ischrome22=t.ischrome&&t.haspointerlock,t.ischrome26=t.ischrome&&"transition"in e.style,t.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,t.hasmstouch=window.navigator.msPointerEnabled||!1,t.ismac=/^mac$/i.test(navigator.platform),t.isios=t.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform),t.isios4=t.isios&&!("seal"in Object),t.isandroid=/android/i.test(navigator.userAgent),t.trstyle=!1,t.hastransform=!1,t.hastranslate3d=!1,t.transitionstyle=!1,t.hastransition=!1,t.transitionend=!1;for(var o=["transform","msTransform","webkitTransform","MozTransform","OTransform"],i=0;i<o.length;i++)if("undefined"!=typeof e.style[o[i]]){t.trstyle=o[i];break}t.hastransform=0!=t.trstyle,t.hastransform&&(e.style[t.trstyle]="translate3d(1px,2px,3px)",t.hastranslate3d=/translate3d/.test(e.style[t.trstyle])),t.transitionstyle=!1,t.prefixstyle="",t.transitionend=!1;for(var o="transition webkitTransition MozTransition OTransition OTransition msTransition KhtmlTransition".split(" "),r=" -webkit- -moz- -o- -o -ms- -khtml-".split(" "),n="transitionend webkitTransitionEnd transitionend otransitionend oTransitionEnd msTransitionEnd KhtmlTransitionEnd".split(" "),i=0;i<o.length;i++)if(o[i]in e.style){t.transitionstyle=o[i],t.prefixstyle=r[i],t.transitionend=n[i];break}t.ischrome26&&(t.prefixstyle=r[1]),t.hastransition=t.transitionstyle;e:{for(o=["-moz-grab","-webkit-grab","grab"],(t.ischrome&&!t.ischrome22||t.isie)&&(o=[]),i=0;i<o.length;i++)if(r=o[i],e.style.cursor=r,e.style.cursor==r){o=r;break e}o="url(http://www.google.com/intl/en_ALL/mapfiles/openhand.cur),n-resize"}return t.cursorgrabvalue=o,t.hasmousecapture="setCapture"in e,t.hasMutationObserver=!1!==p,f=t},w=function(l,a){function u(){var e=y.win;if("zIndex"in e)return e.zIndex();for(;0<e.length&&9!=e[0].nodeType;){var t=e.css("zIndex");if(!isNaN(t)&&0!=t)return parseInt(t);e=e.parent()}return!1}function h(e,t,o){return t=e.css(t),e=parseFloat(t),isNaN(e)?(e=z[t]||0,o=3==e?o?y.win.outerHeight()-y.win.innerHeight():y.win.outerWidth()-y.win.innerWidth():1,y.isie8&&e&&(e+=1),o?e:0):e}function f(e,t,o,i){y._bind(e,t,function(i){i=i?i:window.event;var r={original:i,target:i.target||i.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return i.preventDefault?i.preventDefault():i.returnValue=!1,!1},stopImmediatePropagation:function(){i.stopImmediatePropagation?i.stopImmediatePropagation():i.cancelBubble=!0}};return"mousewheel"==t?(r.deltaY=-.025*i.wheelDelta,i.wheelDeltaX&&(r.deltaX=-.025*i.wheelDeltaX)):r.deltaY=i.detail,o.call(e,r)},i)}function w(e,t,o){var i,r;if(0==e.deltaMode?(i=-Math.floor(e.deltaX*(y.opt.mousescrollstep/54)),r=-Math.floor(e.deltaY*(y.opt.mousescrollstep/54))):1==e.deltaMode&&(i=-Math.floor(e.deltaX*y.opt.mousescrollstep),r=-Math.floor(e.deltaY*y.opt.mousescrollstep)),t&&y.opt.oneaxismousemode&&0==i&&r&&(i=r,r=0),i&&(y.scrollmom&&y.scrollmom.stop(),y.lastdeltax+=i,y.debounced("mousewheelx",function(){var e=y.lastdeltax;y.lastdeltax=0,y.rail.drag||y.doScrollLeftBy(e)},120)),r){if(y.opt.nativeparentscrolling&&o&&!y.ispage&&!y.zoomactive)if(0>r){if(y.getScrollTop()>=y.page.maxh)return!0}else if(0>=y.getScrollTop())return!0;y.scrollmom&&y.scrollmom.stop(),y.lastdeltay+=r,y.debounced("mousewheely",function(){var e=y.lastdeltay;y.lastdeltay=0,y.rail.drag||y.doScrollBy(e)},120)}return e.stopImmediatePropagation(),e.preventDefault()}var y=this;if(this.version="3.5.2",this.name="nicescroll",this.me=a,this.opt={doc:e("body"),win:!1},e.extend(this.opt,m),this.opt.snapbackspeed=80,l)for(var b in y.opt)"undefined"!=typeof l[b]&&(y.opt[b]=l[b]);this.iddoc=(this.doc=y.opt.doc)&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/BODY|HTML/.test(y.opt.win?y.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==y.opt.win,this.win=y.opt.win||(this.ispage?e(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?e(window):this.win,this.body=e("body"),this.iframe=this.isfixed=this.viewport=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=y.opt.autohidemode,this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart=this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.observerremover=this.observer=this.scrollmom=this.scrollrunning=this.checkrtlmode=!1;do this.id="ascrail"+r++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.selectiondrag=this.cursorfreezed=this.cursor=this.rail=!1,this.visibility=!0,this.hidden=this.locked=!1,this.cursoractive=!0,this.overflowx=y.opt.overflowx,this.overflowy=y.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltay=this.lastdeltax=0,this.detected=g();var x=e.extend({},this.detected);if(this.ishwscroll=(this.canhwscroll=x.hastransform&&y.opt.hwacceleration)&&y.haswrapper,this.istouchcapable=!1,x.cantouch&&x.ischrome&&!x.isios&&!x.isandroid&&(this.istouchcapable=!0,x.cantouch=!1),x.cantouch&&x.ismozilla&&!x.isios&&!x.isandroid&&(this.istouchcapable=!0,x.cantouch=!1),y.opt.enablemouselockapi||(x.hasmousecapture=!1,x.haspointerlock=!1),this.delayed=function(e,t,o,i){var r=y.delaylist[e],n=(new Date).getTime();return!i&&r&&r.tt?!1:(r&&r.tt&&clearTimeout(r.tt),void(r&&r.last+o>n&&!r.tt?y.delaylist[e]={last:n+o,tt:setTimeout(function(){y.delaylist[e].tt=0,t.call()},o)}:r&&r.tt||(y.delaylist[e]={last:n,tt:0},setTimeout(function(){t.call()},0))))},this.debounced=function(e,t,o){var i=y.delaylist[e];(new Date).getTime(),y.delaylist[e]=t,i||setTimeout(function(){var t=y.delaylist[e];y.delaylist[e]=!1,t.call()},o)},this.synched=function(e,t){return y.synclist[e]=t,function(){y.onsync||(c(function(){y.onsync=!1;for(e in y.synclist){var t=y.synclist[e];t&&t.call(y),y.synclist[e]=!1}}),y.onsync=!0)}(),e},this.unsynched=function(e){y.synclist[e]&&(y.synclist[e]=!1)},this.css=function(e,t){for(var o in t)y.saved.css.push([e,o,e.css(o)]),e.css(o,t[o])},this.scrollTop=function(e){return"undefined"==typeof e?y.getScrollTop():y.setScrollTop(e)},this.scrollLeft=function(e){return"undefined"==typeof e?y.getScrollLeft():y.setScrollLeft(e)},BezierClass=function(e,t,o,i,r,n,s){this.st=e,this.ed=t,this.spd=o,this.p1=i||0,this.p2=r||1,this.p3=n||0,this.p4=s||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st},BezierClass.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=1-((new Date).getTime()-this.ts)/this.spd,t=this.B2(e)+this.B3(e)+this.B4(e);return 0>e?this.ed:this.st+Math.round(this.df*t)},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},x.hastranslate3d&&x.isios&&this.doc.css("-webkit-backface-visibility","hidden");var S=function(){var e=y.doc.css(x.trstyle);return e&&"matrix"==e.substr(0,6)?e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/):!1};this.getScrollTop=function(e){if(!e){if(e=S())return 16==e.length?-e[13]:-e[5];if(y.timerscroll&&y.timerscroll.bz)return y.timerscroll.bz.getNow()}return y.doc.translate.y},this.getScrollLeft=function(e){if(!e){if(e=S())return 16==e.length?-e[12]:-e[4];if(y.timerscroll&&y.timerscroll.bh)return y.timerscroll.bh.getNow()}return y.doc.translate.x},this.notifyScrollEvent=document.createEvent?function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),e.dispatchEvent(t)}:document.fireEvent?function(e){var t=document.createEventObject();e.fireEvent("onscroll"),t.cancelBubble=!0}:function(){},x.hastranslate3d&&y.opt.enabletranslate3d?(this.setScrollTop=function(e,t){y.doc.translate.y=e,y.doc.translate.ty=-1*e+"px",y.doc.css(x.trstyle,"translate3d("+y.doc.translate.tx+","+y.doc.translate.ty+",0px)"),t||y.notifyScrollEvent(y.win[0])},this.setScrollLeft=function(e,t){y.doc.translate.x=e,y.doc.translate.tx=-1*e+"px",y.doc.css(x.trstyle,"translate3d("+y.doc.translate.tx+","+y.doc.translate.ty+",0px)"),t||y.notifyScrollEvent(y.win[0])}):(this.setScrollTop=function(e,t){y.doc.translate.y=e,y.doc.translate.ty=-1*e+"px",y.doc.css(x.trstyle,"translate("+y.doc.translate.tx+","+y.doc.translate.ty+")"),t||y.notifyScrollEvent(y.win[0])},this.setScrollLeft=function(e,t){y.doc.translate.x=e,y.doc.translate.tx=-1*e+"px",y.doc.css(x.trstyle,"translate("+y.doc.translate.tx+","+y.doc.translate.ty+")"),t||y.notifyScrollEvent(y.win[0])})}else this.getScrollTop=function(){return y.docscroll.scrollTop()},this.setScrollTop=function(e){return y.docscroll.scrollTop(e)},this.getScrollLeft=function(){return y.docscroll.scrollLeft()},this.setScrollLeft=function(e){return y.docscroll.scrollLeft(e)};this.getTarget=function(e){return e?e.target?e.target:e.srcElement?e.srcElement:!1:!1},this.hasParent=function(e,t){if(!e)return!1;for(var o=e.target||e.srcElement||e||!1;o&&o.id!=t;)o=o.parentNode||!1;return!1!==o};var z={thin:1,medium:3,thick:5};this.getOffset=function(){if(y.isfixed)return{top:parseFloat(y.win.css("top")),left:parseFloat(y.win.css("left"))};if(!y.viewport)return y.win.offset();var e=y.win.offset(),t=y.viewport.offset();return{top:e.top-t.top+y.viewport.scrollTop(),left:e.left-t.left+y.viewport.scrollLeft()}},this.updateScrollBar=function(e){if(y.ishwscroll)y.rail.css({height:y.win.innerHeight()}),y.railh&&y.railh.css({width:y.win.innerWidth()});else{var t=y.getOffset(),o=t.top,i=t.left,o=o+h(y.win,"border-top-width",!0);y.win.outerWidth(),y.win.innerWidth();var i=i+(y.rail.align?y.win.outerWidth()-h(y.win,"border-right-width")-y.rail.width:h(y.win,"border-left-width")),r=y.opt.railoffset;r&&(r.top&&(o+=r.top),y.rail.align&&r.left&&(i+=r.left)),y.locked||y.rail.css({top:o,left:i,height:e?e.h:y.win.innerHeight()}),y.zoom&&y.zoom.css({top:o+1,left:1==y.rail.align?i-20:i+y.rail.width+4}),y.railh&&!y.locked&&(o=t.top,i=t.left,e=y.railh.align?o+h(y.win,"border-top-width",!0)+y.win.innerHeight()-y.railh.height:o+h(y.win,"border-top-width",!0),i+=h(y.win,"border-left-width"),y.railh.css({top:e,left:i,width:y.railh.width}))}},this.doRailClick=function(e,t,o){var i;y.locked||(y.cancelEvent(e),t?(t=o?y.doScrollLeft:y.doScrollTop,i=o?(e.pageX-y.railh.offset().left-y.cursorwidth/2)*y.scrollratio.x:(e.pageY-y.rail.offset().top-y.cursorheight/2)*y.scrollratio.y,t(i)):(t=o?y.doScrollLeftBy:y.doScrollBy,i=o?y.scroll.x:y.scroll.y,e=o?e.pageX-y.railh.offset().left:e.pageY-y.rail.offset().top,o=o?y.view.w:y.view.h,t(i>=e?o:-o)))},y.hasanimationframe=c,y.hascancelanimationframe=d,y.hasanimationframe?y.hascancelanimationframe||(d=function(){y.cancelAnimationFrame=!0}):(c=function(e){return setTimeout(e,15-Math.floor(+new Date/1e3)%16)},d=clearInterval),this.init=function(){if(y.saved.css=[],x.isie7mobile||x.isoperamini)return!0;if(x.hasmstouch&&y.css(y.ispage?e("html"):y.win,{"-ms-touch-action":"none"}),y.zindex="auto",y.zindex=y.ispage||"auto"!=y.opt.zindex?y.opt.zindex:u()||"auto",!y.ispage&&"auto"!=y.zindex&&y.zindex>n&&(n=y.zindex),y.isie&&0==y.zindex&&"auto"==y.opt.zindex&&(y.zindex="auto"),!y.ispage||!x.cantouch&&!x.isieold&&!x.isie9mobile){var r=y.docscroll;y.ispage&&(r=y.haswrapper?y.win:y.doc),x.isie9mobile||y.css(r,{"overflow-y":"hidden"}),y.ispage&&x.isie7&&("BODY"==y.doc[0].nodeName?y.css(e("html"),{"overflow-y":"hidden"}):"HTML"==y.doc[0].nodeName&&y.css(e("body"),{"overflow-y":"hidden"})),!x.isios||y.ispage||y.haswrapper||y.css(e("body"),{"-webkit-overflow-scrolling":"touch"});var l=e(document.createElement("div"));l.css({position:"relative",top:0,"float":"right",width:y.opt.cursorwidth,height:"0px","background-color":y.opt.cursorcolor,border:y.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":y.opt.cursorborderradius,"-moz-border-radius":y.opt.cursorborderradius,"border-radius":y.opt.cursorborderradius}),l.hborder=parseFloat(l.outerHeight()-l.innerHeight()),y.cursor=l;var a=e(document.createElement("div"));a.attr("id",y.id),a.addClass("nicescroll-rails");var c,d,h,m=["left","right"];for(h in m)d=m[h],(c=y.opt.railpadding[d])?a.css("padding-"+d,c+"px"):y.opt.railpadding[d]=0;if(a.append(l),a.width=Math.max(parseFloat(y.opt.cursorwidth),l.outerWidth())+y.opt.railpadding.left+y.opt.railpadding.right,a.css({width:a.width+"px",zIndex:y.zindex,background:y.opt.background,cursor:"default"}),a.visibility=!0,a.scrollable=!0,a.align="left"==y.opt.railalign?0:1,y.rail=a,l=y.rail.drag=!1,!y.opt.boxzoom||y.ispage||x.isieold||(l=document.createElement("div"),y.bind(l,"click",y.doZoom),y.zoom=e(l),y.zoom.css({cursor:"pointer","z-index":y.zindex,backgroundImage:"url("+s+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),y.opt.dblclickzoom&&y.bind(y.win,"dblclick",y.doZoom),x.cantouch&&y.opt.gesturezoom&&(y.ongesturezoom=function(e){return 1.5<e.scale&&y.doZoomIn(e),.8>e.scale&&y.doZoomOut(e),y.cancelEvent(e)},y.bind(y.win,"gestureend",y.ongesturezoom))),y.railh=!1,y.opt.horizrailenabled){y.css(r,{"overflow-x":"hidden"}),l=e(document.createElement("div")),l.css({position:"relative",top:0,height:y.opt.cursorwidth,width:"0px","background-color":y.opt.cursorcolor,border:y.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":y.opt.cursorborderradius,"-moz-border-radius":y.opt.cursorborderradius,"border-radius":y.opt.cursorborderradius}),l.wborder=parseFloat(l.outerWidth()-l.innerWidth()),y.cursorh=l;var f=e(document.createElement("div"));f.attr("id",y.id+"-hr"),f.addClass("nicescroll-rails"),f.height=Math.max(parseFloat(y.opt.cursorwidth),l.outerHeight()),f.css({height:f.height+"px",zIndex:y.zindex,background:y.opt.background}),f.append(l),f.visibility=!0,f.scrollable=!0,f.align="top"==y.opt.railvalign?0:1,y.railh=f,y.railh.drag=!1}if(y.ispage?(a.css({position:"fixed",top:"0px",height:"100%"}),a.css(a.align?{right:"0px"}:{left:"0px"}),y.body.append(a),y.railh&&(f.css({position:"fixed",left:"0px",width:"100%"}),f.css(f.align?{bottom:"0px"}:{top:"0px"}),y.body.append(f))):(y.ishwscroll?("static"==y.win.css("position")&&y.css(y.win,{position:"relative"}),r="HTML"==y.win[0].nodeName?y.body:y.win,y.zoom&&(y.zoom.css({position:"absolute",top:1,right:0,"margin-right":a.width+4}),r.append(y.zoom)),a.css({position:"absolute",top:0}),a.css(a.align?{right:0}:{left:0}),r.append(a),f&&(f.css({position:"absolute",left:0,bottom:0}),f.css(f.align?{bottom:0}:{top:0}),r.append(f))):(y.isfixed="fixed"==y.win.css("position"),r=y.isfixed?"fixed":"absolute",y.isfixed||(y.viewport=y.getViewport(y.win[0])),y.viewport&&(y.body=y.viewport,0==/fixed|relative|absolute/.test(y.viewport.css("position"))&&y.css(y.viewport,{position:"relative"})),a.css({position:r}),y.zoom&&y.zoom.css({position:r}),y.updateScrollBar(),y.body.append(a),y.zoom&&y.body.append(y.zoom),y.railh&&(f.css({position:r}),y.body.append(f))),x.isios&&y.css(y.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),x.isie&&y.opt.disableoutline&&y.win.attr("hideFocus","true"),x.iswebkit&&y.opt.disableoutline&&y.win.css({outline:"none"})),!1===y.opt.autohidemode?(y.autohidedom=!1,y.rail.css({opacity:y.opt.cursoropacitymax}),y.railh&&y.railh.css({opacity:y.opt.cursoropacitymax})):!0===y.opt.autohidemode||"leave"===y.opt.autohidemode?(y.autohidedom=e().add(y.rail),x.isie8&&(y.autohidedom=y.autohidedom.add(y.cursor)),y.railh&&(y.autohidedom=y.autohidedom.add(y.railh)),y.railh&&x.isie8&&(y.autohidedom=y.autohidedom.add(y.cursorh))):"scroll"==y.opt.autohidemode?(y.autohidedom=e().add(y.rail),y.railh&&(y.autohidedom=y.autohidedom.add(y.railh))):"cursor"==y.opt.autohidemode?(y.autohidedom=e().add(y.cursor),y.railh&&(y.autohidedom=y.autohidedom.add(y.cursorh))):"hidden"==y.opt.autohidemode&&(y.autohidedom=!1,y.hide(),y.locked=!1),x.isie9mobile)y.scrollmom=new v(y),y.onmangotouch=function(e){e=y.getScrollTop();var t=y.getScrollLeft();if(e==y.scrollmom.lastscrolly&&t==y.scrollmom.lastscrollx)return!0;var o=e-y.mangotouch.sy,i=t-y.mangotouch.sx;if(0!=Math.round(Math.sqrt(Math.pow(i,2)+Math.pow(o,2)))){var r=0>o?-1:1,n=0>i?-1:1,s=+new Date;y.mangotouch.lazy&&clearTimeout(y.mangotouch.lazy),80<s-y.mangotouch.tm||y.mangotouch.dry!=r||y.mangotouch.drx!=n?(y.scrollmom.stop(),y.scrollmom.reset(t,e),y.mangotouch.sy=e,y.mangotouch.ly=e,y.mangotouch.sx=t,y.mangotouch.lx=t,y.mangotouch.dry=r,y.mangotouch.drx=n,y.mangotouch.tm=s):(y.scrollmom.stop(),y.scrollmom.update(y.mangotouch.sx-i,y.mangotouch.sy-o),y.mangotouch.tm=s,o=Math.max(Math.abs(y.mangotouch.ly-e),Math.abs(y.mangotouch.lx-t)),y.mangotouch.ly=e,y.mangotouch.lx=t,o>2&&(y.mangotouch.lazy=setTimeout(function(){y.mangotouch.lazy=!1,y.mangotouch.dry=0,y.mangotouch.drx=0,y.mangotouch.tm=0,y.scrollmom.doMomentum(30)},100)))}},a=y.getScrollTop(),f=y.getScrollLeft(),y.mangotouch={sy:a,ly:a,dry:0,sx:f,lx:f,drx:0,lazy:!1,tm:0},y.bind(y.docscroll,"scroll",y.onmangotouch);else{if(x.cantouch||y.istouchcapable||y.opt.touchbehavior||x.hasmstouch){y.scrollmom=new v(y),y.ontouchstart=function(t){if(t.pointerType&&2!=t.pointerType)return!1;if(y.hasmoving=!1,!y.locked){if(x.hasmstouch)for(var o=t.target?t.target:!1;o;){var i=e(o).getNiceScroll();if(0<i.length&&i[0].me==y.me)break;if(0<i.length)return!1;if("DIV"==o.nodeName&&o.id==y.id)break;o=o.parentNode?o.parentNode:!1}if(y.cancelScroll(),(o=y.getTarget(t))&&/INPUT/i.test(o.nodeName)&&/range/i.test(o.type))return y.stopPropagation(t);if(!("clientX"in t)&&"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),y.forcescreen&&(i=t,t={original:t.original?t.original:t},t.clientX=i.screenX,t.clientY=i.screenY),y.rail.drag={x:t.clientX,y:t.clientY,sx:y.scroll.x,sy:y.scroll.y,st:y.getScrollTop(),sl:y.getScrollLeft(),pt:2,dl:!1},y.ispage||!y.opt.directionlockdeadzone)y.rail.drag.dl="f";else{var i=e(window).width(),r=e(window).height(),n=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),s=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),r=Math.max(0,s-r),i=Math.max(0,n-i);
y.rail.drag.ck=!y.rail.scrollable&&y.railh.scrollable?r>0?"v":!1:y.rail.scrollable&&!y.railh.scrollable&&i>0?"h":!1,y.rail.drag.ck||(y.rail.drag.dl="f")}if(y.opt.touchbehavior&&y.isiframe&&x.isie&&(i=y.win.position(),y.rail.drag.x+=i.left,y.rail.drag.y+=i.top),y.hasmoving=!1,y.lastmouseup=!1,y.scrollmom.reset(t.clientX,t.clientY),!x.cantouch&&!this.istouchcapable&&!x.hasmstouch){if(!o||!/INPUT|SELECT|TEXTAREA/i.test(o.nodeName))return!y.ispage&&x.hasmousecapture&&o.setCapture(),y.opt.touchbehavior?(o.onclick&&!o._onclick&&(o._onclick=o.onclick,o.onclick=function(e){return y.hasmoving?!1:void o._onclick.call(this,e)}),y.cancelEvent(t)):y.stopPropagation(t);/SUBMIT|CANCEL|BUTTON/i.test(e(o).attr("type"))&&(pc={tg:o,click:!1},y.preventclick=pc)}}},y.ontouchend=function(e){return e.pointerType&&2!=e.pointerType?!1:y.rail.drag&&2==y.rail.drag.pt&&(y.scrollmom.doMomentum(),y.rail.drag=!1,y.hasmoving&&(y.lastmouseup=!0,y.hideCursor(),x.hasmousecapture&&document.releaseCapture(),!x.cantouch))?y.cancelEvent(e):void 0};var g=y.opt.touchbehavior&&y.isiframe&&!x.hasmousecapture;y.ontouchmove=function(t,o){if(t.pointerType&&2!=t.pointerType)return!1;if(y.rail.drag&&2==y.rail.drag.pt){if(x.cantouch&&"undefined"==typeof t.original)return!0;if(y.hasmoving=!0,y.preventclick&&!y.preventclick.click&&(y.preventclick.click=y.preventclick.tg.onclick||!1,y.preventclick.tg.onclick=y.onpreventclick),t=e.extend({original:t},t),"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),y.forcescreen){var i=t;t={original:t.original?t.original:t},t.clientX=i.screenX,t.clientY=i.screenY}if(i=ofy=0,g&&!o){var r=y.win.position(),i=-r.left;ofy=-r.top}var n=t.clientY+ofy,r=n-y.rail.drag.y,s=t.clientX+i,l=s-y.rail.drag.x,a=y.rail.drag.st-r;if(y.ishwscroll&&y.opt.bouncescroll?0>a?a=Math.round(a/2):a>y.page.maxh&&(a=y.page.maxh+Math.round((a-y.page.maxh)/2)):(0>a&&(n=a=0),a>y.page.maxh&&(a=y.page.maxh,n=0)),y.railh&&y.railh.scrollable){var c=y.rail.drag.sl-l;y.ishwscroll&&y.opt.bouncescroll?0>c?c=Math.round(c/2):c>y.page.maxw&&(c=y.page.maxw+Math.round((c-y.page.maxw)/2)):(0>c&&(s=c=0),c>y.page.maxw&&(c=y.page.maxw,s=0))}if(i=!1,y.rail.drag.dl)i=!0,"v"==y.rail.drag.dl?c=y.rail.drag.sl:"h"==y.rail.drag.dl&&(a=y.rail.drag.st);else{var r=Math.abs(r),l=Math.abs(l),d=y.opt.directionlockdeadzone;if("v"==y.rail.drag.ck){if(r>d&&.3*r>=l)return y.rail.drag=!1,!0;l>d&&(y.rail.drag.dl="f",e("body").scrollTop(e("body").scrollTop()))}else if("h"==y.rail.drag.ck){if(l>d&&.3*l>=r)return y.rail.drag=!1,!0;r>d&&(y.rail.drag.dl="f",e("body").scrollLeft(e("body").scrollLeft()))}}if(y.synched("touchmove",function(){y.rail.drag&&2==y.rail.drag.pt&&(y.prepareTransition&&y.prepareTransition(0),y.rail.scrollable&&y.setScrollTop(a),y.scrollmom.update(s,n),y.railh&&y.railh.scrollable?(y.setScrollLeft(c),y.showCursor(a,c)):y.showCursor(a),x.isie10&&document.selection.clear())}),x.ischrome&&y.istouchcapable&&(i=!1),i)return y.cancelEvent(t)}}}if(y.onmousedown=function(e,t){if(!y.rail.drag||1==y.rail.drag.pt){if(y.locked)return y.cancelEvent(e);y.cancelScroll(),y.rail.drag={x:e.clientX,y:e.clientY,sx:y.scroll.x,sy:y.scroll.y,pt:1,hr:!!t};var o=y.getTarget(e);return!y.ispage&&x.hasmousecapture&&o.setCapture(),y.isiframe&&!x.hasmousecapture&&(y.saved.csspointerevents=y.doc.css("pointer-events"),y.css(y.doc,{"pointer-events":"none"})),y.cancelEvent(e)}},y.onmouseup=function(e){return y.rail.drag&&(x.hasmousecapture&&document.releaseCapture(),y.isiframe&&!x.hasmousecapture&&y.doc.css("pointer-events",y.saved.csspointerevents),1==y.rail.drag.pt)?(y.rail.drag=!1,y.cancelEvent(e)):void 0},y.onmousemove=function(e){if(y.rail.drag&&1==y.rail.drag.pt){if(x.ischrome&&0==e.which)return y.onmouseup(e);if(y.cursorfreezed=!0,y.rail.drag.hr){y.scroll.x=y.rail.drag.sx+(e.clientX-y.rail.drag.x),0>y.scroll.x&&(y.scroll.x=0);var t=y.scrollvaluemaxw;y.scroll.x>t&&(y.scroll.x=t)}else y.scroll.y=y.rail.drag.sy+(e.clientY-y.rail.drag.y),0>y.scroll.y&&(y.scroll.y=0),t=y.scrollvaluemax,y.scroll.y>t&&(y.scroll.y=t);return y.synched("mousemove",function(){y.rail.drag&&1==y.rail.drag.pt&&(y.showCursor(),y.rail.drag.hr?y.doScrollLeft(Math.round(y.scroll.x*y.scrollratio.x),y.opt.cursordragspeed):y.doScrollTop(Math.round(y.scroll.y*y.scrollratio.y),y.opt.cursordragspeed))}),y.cancelEvent(e)}},x.cantouch||y.opt.touchbehavior)y.onpreventclick=function(e){return y.preventclick?(y.preventclick.tg.onclick=y.preventclick.click,y.preventclick=!1,y.cancelEvent(e)):void 0},y.bind(y.win,"mousedown",y.ontouchstart),y.onclick=x.isios?!1:function(e){return y.lastmouseup?(y.lastmouseup=!1,y.cancelEvent(e)):!0},y.opt.grabcursorenabled&&x.cursorgrabvalue&&(y.css(y.ispage?y.doc:y.win,{cursor:x.cursorgrabvalue}),y.css(y.rail,{cursor:x.cursorgrabvalue}));else{var w=function(e){if(y.selectiondrag){if(e){var t=y.win.outerHeight();e=e.pageY-y.selectiondrag.top,e>0&&t>e&&(e=0),e>=t&&(e-=t),y.selectiondrag.df=e}0!=y.selectiondrag.df&&(y.doScrollBy(2*-Math.floor(y.selectiondrag.df/6)),y.debounced("doselectionscroll",function(){w()},50))}};y.hasTextSelected="getSelection"in document?function(){return 0<document.getSelection().rangeCount}:"selection"in document?function(){return"None"!=document.selection.type}:function(){return!1},y.onselectionstart=function(){y.ispage||(y.selectiondrag=y.win.offset())},y.onselectionend=function(){y.selectiondrag=!1},y.onselectiondrag=function(e){y.selectiondrag&&y.hasTextSelected()&&y.debounced("selectionscroll",function(){w(e)},250)}}x.hasmstouch&&(y.css(y.rail,{"-ms-touch-action":"none"}),y.css(y.cursor,{"-ms-touch-action":"none"}),y.bind(y.win,"MSPointerDown",y.ontouchstart),y.bind(document,"MSPointerUp",y.ontouchend),y.bind(document,"MSPointerMove",y.ontouchmove),y.bind(y.cursor,"MSGestureHold",function(e){e.preventDefault()}),y.bind(y.cursor,"contextmenu",function(e){e.preventDefault()})),this.istouchcapable&&(y.bind(y.win,"touchstart",y.ontouchstart),y.bind(document,"touchend",y.ontouchend),y.bind(document,"touchcancel",y.ontouchend),y.bind(document,"touchmove",y.ontouchmove)),y.bind(y.cursor,"mousedown",y.onmousedown),y.bind(y.cursor,"mouseup",y.onmouseup),y.railh&&(y.bind(y.cursorh,"mousedown",function(e){y.onmousedown(e,!0)}),y.bind(y.cursorh,"mouseup",function(e){return y.rail.drag&&2==y.rail.drag.pt?void 0:(y.rail.drag=!1,y.hasmoving=!1,y.hideCursor(),x.hasmousecapture&&document.releaseCapture(),y.cancelEvent(e))})),(y.opt.cursordragontouch||!x.cantouch&&!y.opt.touchbehavior)&&(y.rail.css({cursor:"default"}),y.railh&&y.railh.css({cursor:"default"}),y.jqbind(y.rail,"mouseenter",function(){y.canshowonmouseevent&&y.showCursor(),y.rail.active=!0}),y.jqbind(y.rail,"mouseleave",function(){y.rail.active=!1,y.rail.drag||y.hideCursor()}),y.opt.sensitiverail&&(y.bind(y.rail,"click",function(e){y.doRailClick(e,!1,!1)}),y.bind(y.rail,"dblclick",function(e){y.doRailClick(e,!0,!1)}),y.bind(y.cursor,"click",function(e){y.cancelEvent(e)}),y.bind(y.cursor,"dblclick",function(e){y.cancelEvent(e)})),y.railh&&(y.jqbind(y.railh,"mouseenter",function(){y.canshowonmouseevent&&y.showCursor(),y.rail.active=!0}),y.jqbind(y.railh,"mouseleave",function(){y.rail.active=!1,y.rail.drag||y.hideCursor()}),y.opt.sensitiverail&&(y.bind(y.railh,"click",function(e){y.doRailClick(e,!1,!0)}),y.bind(y.railh,"dblclick",function(e){y.doRailClick(e,!0,!0)}),y.bind(y.cursorh,"click",function(e){y.cancelEvent(e)}),y.bind(y.cursorh,"dblclick",function(e){y.cancelEvent(e)})))),x.cantouch||y.opt.touchbehavior?(y.bind(x.hasmousecapture?y.win:document,"mouseup",y.ontouchend),y.bind(document,"mousemove",y.ontouchmove),y.onclick&&y.bind(document,"click",y.onclick),y.opt.cursordragontouch&&(y.bind(y.cursor,"mousedown",y.onmousedown),y.bind(y.cursor,"mousemove",y.onmousemove),y.cursorh&&y.bind(y.cursorh,"mousedown",function(e){y.onmousedown(e,!0)}),y.cursorh&&y.bind(y.cursorh,"mousemove",y.onmousemove))):(y.bind(x.hasmousecapture?y.win:document,"mouseup",y.onmouseup),y.bind(document,"mousemove",y.onmousemove),y.onclick&&y.bind(document,"click",y.onclick),!y.ispage&&y.opt.enablescrollonselection&&(y.bind(y.win[0],"mousedown",y.onselectionstart),y.bind(document,"mouseup",y.onselectionend),y.bind(y.cursor,"mouseup",y.onselectionend),y.cursorh&&y.bind(y.cursorh,"mouseup",y.onselectionend),y.bind(document,"mousemove",y.onselectiondrag)),y.zoom&&(y.jqbind(y.zoom,"mouseenter",function(){y.canshowonmouseevent&&y.showCursor(),y.rail.active=!0}),y.jqbind(y.zoom,"mouseleave",function(){y.rail.active=!1,y.rail.drag||y.hideCursor()}))),y.opt.enablemousewheel&&(y.isiframe||y.bind(x.isie&&y.ispage?document:y.win,"mousewheel",y.onmousewheel),y.bind(y.rail,"mousewheel",y.onmousewheel),y.railh&&y.bind(y.railh,"mousewheel",y.onmousewheelhr)),y.ispage||x.cantouch||/HTML|BODY/.test(y.win[0].nodeName)||(y.win.attr("tabindex")||y.win.attr({tabindex:i++}),y.jqbind(y.win,"focus",function(e){t=y.getTarget(e).id||!0,y.hasfocus=!0,y.canshowonmouseevent&&y.noticeCursor()}),y.jqbind(y.win,"blur",function(){t=!1,y.hasfocus=!1}),y.jqbind(y.win,"mouseenter",function(e){o=y.getTarget(e).id||!0,y.hasmousefocus=!0,y.canshowonmouseevent&&y.noticeCursor()}),y.jqbind(y.win,"mouseleave",function(){o=!1,y.hasmousefocus=!1,y.rail.drag||y.hideCursor()}))}if(y.onkeypress=function(i){if(y.locked&&0==y.page.maxh)return!0;i=i?i:window.e;var r=y.getTarget(i);if(r&&/INPUT|TEXTAREA|SELECT|OPTION/.test(r.nodeName)&&(!r.getAttribute("type")&&!r.type||!/submit|button|cancel/i.tp)||e(r).attr("contenteditable"))return!0;if(y.hasfocus||y.hasmousefocus&&!t||y.ispage&&!t&&!o){if(r=i.keyCode,y.locked&&27!=r)return y.cancelEvent(i);var n=i.ctrlKey||!1,s=i.shiftKey||!1,l=!1;switch(r){case 38:case 63233:y.doScrollBy(72),l=!0;break;case 40:case 63235:y.doScrollBy(-72),l=!0;break;case 37:case 63232:y.railh&&(n?y.doScrollLeft(0):y.doScrollLeftBy(72),l=!0);break;case 39:case 63234:y.railh&&(n?y.doScrollLeft(y.page.maxw):y.doScrollLeftBy(-72),l=!0);break;case 33:case 63276:y.doScrollBy(y.view.h),l=!0;break;case 34:case 63277:y.doScrollBy(-y.view.h),l=!0;break;case 36:case 63273:y.railh&&n?y.doScrollPos(0,0):y.doScrollTo(0),l=!0;break;case 35:case 63275:y.railh&&n?y.doScrollPos(y.page.maxw,y.page.maxh):y.doScrollTo(y.page.maxh),l=!0;break;case 32:y.opt.spacebarenabled&&(y.doScrollBy(s?y.view.h:-y.view.h),l=!0);break;case 27:y.zoomactive&&(y.doZoom(),l=!0)}if(l)return y.cancelEvent(i)}},y.opt.enablekeyboard&&y.bind(document,x.isopera&&!x.isopera12?"keypress":"keydown",y.onkeypress),y.bind(window,"resize",y.lazyResize),y.bind(window,"orientationchange",y.lazyResize),y.bind(window,"load",y.lazyResize),x.ischrome&&!y.ispage&&!y.haswrapper){var b=y.win.attr("style"),a=parseFloat(y.win.css("width"))+1;y.win.css("width",a),y.synched("chromefix",function(){y.win.attr("style",b)})}y.onAttributeChange=function(){y.lazyResize(250)},y.ispage||y.haswrapper||(!1!==p?(y.observer=new p(function(e){e.forEach(y.onAttributeChange)}),y.observer.observe(y.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),y.observerremover=new p(function(e){e.forEach(function(e){if(0<e.removedNodes.length)for(var t in e.removedNodes)if(e.removedNodes[t]==y.win[0])return y.remove()})}),y.observerremover.observe(y.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(y.bind(y.win,x.isie&&!x.isie9?"propertychange":"DOMAttrModified",y.onAttributeChange),x.isie9&&y.win[0].attachEvent("onpropertychange",y.onAttributeChange),y.bind(y.win,"DOMNodeRemoved",function(e){e.target==y.win[0]&&y.remove()}))),!y.ispage&&y.opt.boxzoom&&y.bind(window,"resize",y.resizeZoom),y.istextarea&&y.bind(y.win,"mouseup",y.lazyResize),y.checkrtlmode=!0,y.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var S=function(t){y.iframexd=!1;try{var o="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(i){y.iframexd=!0,o=!1}return y.iframexd?("console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0):(y.forcescreen=!0,y.isiframe&&(y.iframe={doc:e(o),html:y.doc.contents().find("html")[0],body:y.doc.contents().find("body")[0]},y.getContentSize=function(){return{w:Math.max(y.iframe.html.scrollWidth,y.iframe.body.scrollWidth),h:Math.max(y.iframe.html.scrollHeight,y.iframe.body.scrollHeight)}},y.docscroll=e(y.iframe.body)),x.isios||!y.opt.iframeautoresize||y.isiframe||(y.win.scrollTop(0),y.doc.height(""),t=Math.max(o.getElementsByTagName("html")[0].scrollHeight,o.body.scrollHeight),y.doc.height(t)),y.lazyResize(30),x.isie7&&y.css(e(y.iframe.html),{"overflow-y":"hidden"}),y.css(e(y.iframe.body),{"overflow-y":"hidden"}),x.isios&&y.haswrapper&&y.css(e(o.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?y.bind(this.contentWindow,"scroll",y.onscroll):y.bind(o,"scroll",y.onscroll),y.opt.enablemousewheel&&y.bind(o,"mousewheel",y.onmousewheel),y.opt.enablekeyboard&&y.bind(o,x.isopera?"keypress":"keydown",y.onkeypress),(x.cantouch||y.opt.touchbehavior)&&(y.bind(o,"mousedown",y.ontouchstart),y.bind(o,"mousemove",function(e){y.ontouchmove(e,!0)}),y.opt.grabcursorenabled&&x.cursorgrabvalue&&y.css(e(o.body),{cursor:x.cursorgrabvalue})),y.bind(o,"mouseup",y.ontouchend),void(y.zoom&&(y.opt.dblclickzoom&&y.bind(o,"dblclick",y.doZoom),y.ongesturezoom&&y.bind(o,"gestureend",y.ongesturezoom))))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){S.call(y.doc[0],!1)},500),y.bind(this.doc,"load",S)}},this.showCursor=function(e,t){y.cursortimeout&&(clearTimeout(y.cursortimeout),y.cursortimeout=0),y.rail&&(y.autohidedom&&(y.autohidedom.stop().css({opacity:y.opt.cursoropacitymax}),y.cursoractive=!0),y.rail.drag&&1==y.rail.drag.pt||("undefined"!=typeof e&&!1!==e&&(y.scroll.y=Math.round(1*e/y.scrollratio.y)),"undefined"!=typeof t&&(y.scroll.x=Math.round(1*t/y.scrollratio.x))),y.cursor.css({height:y.cursorheight,top:y.scroll.y}),y.cursorh&&(y.cursorh.css(!y.rail.align&&y.rail.visibility?{width:y.cursorwidth,left:y.scroll.x+y.rail.width}:{width:y.cursorwidth,left:y.scroll.x}),y.cursoractive=!0),y.zoom&&y.zoom.stop().css({opacity:y.opt.cursoropacitymax}))},this.hideCursor=function(e){y.cursortimeout||!y.rail||!y.autohidedom||y.hasmousefocus&&"leave"==y.opt.autohidemode||(y.cursortimeout=setTimeout(function(){y.rail.active&&y.showonmouseevent||(y.autohidedom.stop().animate({opacity:y.opt.cursoropacitymin}),y.zoom&&y.zoom.stop().animate({opacity:y.opt.cursoropacitymin}),y.cursoractive=!1),y.cursortimeout=0},e||y.opt.hidecursordelay))},this.noticeCursor=function(e,t,o){y.showCursor(t,o),y.rail.active||y.hideCursor(e)},this.getContentSize=y.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:y.haswrapper?function(){return{w:y.doc.outerWidth()+parseInt(y.win.css("paddingLeft"))+parseInt(y.win.css("paddingRight")),h:y.doc.outerHeight()+parseInt(y.win.css("paddingTop"))+parseInt(y.win.css("paddingBottom"))}}:function(){return{w:y.docscroll[0].scrollWidth,h:y.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!y||!y.win)return!1;if(!y.haswrapper&&!y.ispage){if("none"==y.win.css("display"))return y.visibility&&y.hideRail().hideRailHr(),!1;y.hidden||y.visibility||y.showRail().showRailHr()}var o=y.page.maxh,i=y.page.maxw,r=y.view.w;if(y.view={w:y.ispage?y.win.width():parseInt(y.win[0].clientWidth),h:y.ispage?y.win.height():parseInt(y.win[0].clientHeight)},y.page=t?t:y.getContentSize(),y.page.maxh=Math.max(0,y.page.h-y.view.h),y.page.maxw=Math.max(0,y.page.w-y.view.w),y.page.maxh==o&&y.page.maxw==i&&y.view.w==r){if(y.ispage)return y;if(o=y.win.offset(),y.lastposition&&(i=y.lastposition,i.top==o.top&&i.left==o.left))return y;y.lastposition=o}return 0==y.page.maxh?(y.hideRail(),y.scrollvaluemax=0,y.scroll.y=0,y.scrollratio.y=0,y.cursorheight=0,y.setScrollTop(0),y.rail.scrollable=!1):y.rail.scrollable=!0,0==y.page.maxw?(y.hideRailHr(),y.scrollvaluemaxw=0,y.scroll.x=0,y.scrollratio.x=0,y.cursorwidth=0,y.setScrollLeft(0),y.railh.scrollable=!1):y.railh.scrollable=!0,y.locked=0==y.page.maxh&&0==y.page.maxw,y.locked?(y.ispage||y.updateScrollBar(y.view),!1):(y.hidden||y.visibility?y.hidden||y.railh.visibility||y.showRailHr():y.showRail().showRailHr(),y.istextarea&&y.win.css("resize")&&"none"!=y.win.css("resize")&&(y.view.h-=20),y.cursorheight=Math.min(y.view.h,Math.round(y.view.h*(y.view.h/y.page.h))),y.cursorheight=y.opt.cursorfixedheight?y.opt.cursorfixedheight:Math.max(y.opt.cursorminheight,y.cursorheight),y.cursorwidth=Math.min(y.view.w,Math.round(y.view.w*(y.view.w/y.page.w))),y.cursorwidth=y.opt.cursorfixedheight?y.opt.cursorfixedheight:Math.max(y.opt.cursorminheight,y.cursorwidth),y.scrollvaluemax=y.view.h-y.cursorheight-y.cursor.hborder,y.railh&&(y.railh.width=0<y.page.maxh?y.view.w-y.rail.width:y.view.w,y.scrollvaluemaxw=y.railh.width-y.cursorwidth-y.cursorh.wborder),y.checkrtlmode&&y.railh&&(y.checkrtlmode=!1,y.opt.rtlmode&&0==y.scroll.x&&y.setScrollLeft(y.page.maxw)),y.ispage||y.updateScrollBar(y.view),y.scrollratio={x:y.page.maxw/y.scrollvaluemaxw,y:y.page.maxh/y.scrollvaluemax},y.getScrollTop()>y.page.maxh?y.doScrollTop(y.page.maxh):(y.scroll.y=Math.round(y.getScrollTop()*(1/y.scrollratio.y)),y.scroll.x=Math.round(y.getScrollLeft()*(1/y.scrollratio.x)),y.cursoractive&&y.noticeCursor()),y.scroll.y&&0==y.getScrollTop()&&y.doScrollTo(Math.floor(y.scroll.y*y.scrollratio.y)),y)},this.resize=y.onResize,this.lazyResize=function(e){return e=isNaN(e)?30:e,y.delayed("resize",y.resize,e),y},this._bind=function(e,t,o,i){y.events.push({e:e,n:t,f:o,b:i,q:!1}),e.addEventListener?e.addEventListener(t,o,i||!1):e.attachEvent?e.attachEvent("on"+t,o):e["on"+t]=o},this.jqbind=function(t,o,i){y.events.push({e:t,n:o,f:i,q:!0}),e(t).bind(o,i)},this.bind=function(e,t,o,i){var r="jquery"in e?e[0]:e;"mousewheel"==t?"onwheel"in y.win?y._bind(r,"wheel",o,i||!1):(e="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll",f(r,e,o,i||!1),"DOMMouseScroll"==e&&f(r,"MozMousePixelScroll",o,i||!1)):r.addEventListener?(x.cantouch&&/mouseup|mousedown|mousemove/.test(t)&&y._bind(r,"mousedown"==t?"touchstart":"mouseup"==t?"touchend":"touchmove",function(e){if(e.touches){if(2>e.touches.length){var t=e.touches.length?e.touches[0]:e;t.original=e,o.call(this,t)}}else e.changedTouches&&(t=e.changedTouches[0],t.original=e,o.call(this,t))},i||!1),y._bind(r,t,o,i||!1),x.cantouch&&"mouseup"==t&&y._bind(r,"touchcancel",o,i||!1)):y._bind(r,t,function(e){return(e=e||window.event||!1)&&e.srcElement&&(e.target=e.srcElement),"pageY"in e||(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop),!1===o.call(r,e)||!1===i?y.cancelEvent(e):!0})},this._unbind=function(e,t,o,i){e.removeEventListener?e.removeEventListener(t,o,i):e.detachEvent?e.detachEvent("on"+t,o):e["on"+t]=!1},this.unbindAll=function(){for(var e=0;e<y.events.length;e++){var t=y.events[e];t.q?t.e.unbind(t.n,t.f):y._unbind(t.e,t.n,t.f,t.b)}},this.cancelEvent=function(e){return(e=e.original?e.original:e?e:window.event||!1)?(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1):!1},this.stopPropagation=function(e){return(e=e.original?e.original:e?e:window.event||!1)?e.stopPropagation?e.stopPropagation():(e.cancelBubble&&(e.cancelBubble=!0),!1):!1},this.showRail=function(){return 0==y.page.maxh||!y.ispage&&"none"==y.win.css("display")||(y.visibility=!0,y.rail.visibility=!0,y.rail.css("display","block")),y},this.showRailHr=function(){return y.railh?(0==y.page.maxw||!y.ispage&&"none"==y.win.css("display")||(y.railh.visibility=!0,y.railh.css("display","block")),y):y},this.hideRail=function(){return y.visibility=!1,y.rail.visibility=!1,y.rail.css("display","none"),y},this.hideRailHr=function(){return y.railh?(y.railh.visibility=!1,y.railh.css("display","none"),y):y},this.show=function(){return y.hidden=!1,y.locked=!1,y.showRail().showRailHr()},this.hide=function(){return y.hidden=!0,y.locked=!0,y.hideRail().hideRailHr()},this.toggle=function(){return y.hidden?y.show():y.hide()},this.remove=function(){y.stop(),y.cursortimeout&&clearTimeout(y.cursortimeout),y.doZoomOut(),y.unbindAll(),x.isie9&&y.win[0].detachEvent("onpropertychange",y.onAttributeChange),!1!==y.observer&&y.observer.disconnect(),!1!==y.observerremover&&y.observerremover.disconnect(),y.events=null,y.cursor&&y.cursor.remove(),y.cursorh&&y.cursorh.remove(),y.rail&&y.rail.remove(),y.railh&&y.railh.remove(),y.zoom&&y.zoom.remove();for(var t=0;t<y.saved.css.length;t++){var o=y.saved.css[t];o[0].css(o[1],"undefined"==typeof o[2]?"":o[2])}y.saved=!1,y.me.data("__nicescroll","");var i=e.nicescroll;i.each(function(e){if(this&&this.id===y.id){delete i[e];for(var t=++e;t<i.length;t++,e++)i[e]=i[t];i.length--,i.length&&delete i[i.length]}});for(var r in y)y[r]=null,delete y[r];y=null},this.scrollstart=function(e){return this.onscrollstart=e,y},this.scrollend=function(e){return this.onscrollend=e,y},this.scrollcancel=function(e){return this.onscrollcancel=e,y},this.zoomin=function(e){return this.onzoomin=e,y},this.zoomout=function(e){return this.onzoomout=e,y},this.isScrollable=function(t){if(t=t.target?t.target:t,"OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var o=e(t),o=o.css("overflowY")||o.css("overflowX")||o.css("overflow")||"";if(/scroll|auto/.test(o))return t.clientHeight!=t.scrollHeight;t=t.parentNode?t.parentNode:!1}return!1},this.getViewport=function(t){for(t=t&&t.parentNode?t.parentNode:!1;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var o=e(t);if(/fixed|absolute/.test(o.css("position")))return o;var i=o.css("overflowY")||o.css("overflowX")||o.css("overflow")||"";if(/scroll|auto/.test(i)&&t.clientHeight!=t.scrollHeight||0<o.getNiceScroll().length)return o;t=t.parentNode?t.parentNode:!1}return!1},this.onmousewheel=function(e){if(y.locked)return y.debounced("checkunlock",y.resize,250),!0;if(y.rail.drag)return y.cancelEvent(e);if("auto"==y.opt.oneaxismousemode&&0!=e.deltaX&&(y.opt.oneaxismousemode=!1),y.opt.oneaxismousemode&&0==e.deltaX&&!y.rail.scrollable)return y.railh&&y.railh.scrollable?y.onmousewheelhr(e):!0;var t=+new Date,o=!1;return y.opt.preservenativescrolling&&y.checkarea+600<t&&(y.nativescrollingarea=y.isScrollable(e),o=!0),y.checkarea=t,y.nativescrollingarea?!0:((e=w(e,!1,o))&&(y.checkarea=0),e)},this.onmousewheelhr=function(e){if(y.locked||!y.railh.scrollable)return!0;if(y.rail.drag)return y.cancelEvent(e);var t=+new Date,o=!1;return y.opt.preservenativescrolling&&y.checkarea+600<t&&(y.nativescrollingarea=y.isScrollable(e),o=!0),y.checkarea=t,y.nativescrollingarea?!0:y.locked?y.cancelEvent(e):w(e,!0,o)},this.stop=function(){return y.cancelScroll(),y.scrollmon&&y.scrollmon.stop(),y.cursorfreezed=!1,y.scroll.y=Math.round(y.getScrollTop()*(1/y.scrollratio.y)),y.noticeCursor(),y},this.getTransitionSpeed=function(e){var t=Math.round(10*y.opt.scrollspeed);return e=Math.min(t,Math.round(e/20*y.opt.scrollspeed)),e>20?e:0},y.opt.smoothscroll?y.ishwscroll&&x.hastransition&&y.opt.usetransition?(this.prepareTransition=function(e,t){var o=t?e>20?e:0:y.getTransitionSpeed(e),i=o?x.prefixstyle+"transform "+o+"ms ease-out":"";return y.lasttransitionstyle&&y.lasttransitionstyle==i||(y.lasttransitionstyle=i,y.doc.css(x.transitionstyle,i)),o},this.doScrollLeft=function(e,t){var o=y.scrollrunning?y.newscrolly:y.getScrollTop();y.doScrollPos(e,o,t)},this.doScrollTop=function(e,t){var o=y.scrollrunning?y.newscrollx:y.getScrollLeft();y.doScrollPos(o,e,t)},this.doScrollPos=function(e,t,o){var i=y.getScrollTop(),r=y.getScrollLeft();return(0>(y.newscrolly-i)*(t-i)||0>(y.newscrollx-r)*(e-r))&&y.cancelScroll(),0==y.opt.bouncescroll&&(0>t?t=0:t>y.page.maxh&&(t=y.page.maxh),0>e?e=0:e>y.page.maxw&&(e=y.page.maxw)),y.scrollrunning&&e==y.newscrollx&&t==y.newscrolly?!1:(y.newscrolly=t,y.newscrollx=e,y.newscrollspeed=o||!1,y.timer?!1:void(y.timer=setTimeout(function(){var o,i,r=y.getScrollTop(),n=y.getScrollLeft();o=e-n,i=t-r,o=Math.round(Math.sqrt(Math.pow(o,2)+Math.pow(i,2))),o=y.newscrollspeed&&1<y.newscrollspeed?y.newscrollspeed:y.getTransitionSpeed(o),y.newscrollspeed&&1>=y.newscrollspeed&&(o*=y.newscrollspeed),y.prepareTransition(o,!0),y.timerscroll&&y.timerscroll.tm&&clearInterval(y.timerscroll.tm),o>0&&(!y.scrollrunning&&y.onscrollstart&&y.onscrollstart.call(y,{type:"scrollstart",current:{x:n,y:r},request:{x:e,y:t},end:{x:y.newscrollx,y:y.newscrolly},speed:o}),x.transitionend?y.scrollendtrapped||(y.scrollendtrapped=!0,y.bind(y.doc,x.transitionend,y.onScrollEnd,!1)):(y.scrollendtrapped&&clearTimeout(y.scrollendtrapped),y.scrollendtrapped=setTimeout(y.onScrollEnd,o)),y.timerscroll={bz:new BezierClass(r,y.newscrolly,o,0,0,.58,1),bh:new BezierClass(n,y.newscrollx,o,0,0,.58,1)},y.cursorfreezed||(y.timerscroll.tm=setInterval(function(){y.showCursor(y.getScrollTop(),y.getScrollLeft())},60))),y.synched("doScroll-set",function(){y.timer=0,y.scrollendtrapped&&(y.scrollrunning=!0),y.setScrollTop(y.newscrolly),y.setScrollLeft(y.newscrollx),y.scrollendtrapped||y.onScrollEnd()})},50)))},this.cancelScroll=function(){if(!y.scrollendtrapped)return!0;var e=y.getScrollTop(),t=y.getScrollLeft();return y.scrollrunning=!1,x.transitionend||clearTimeout(x.transitionend),y.scrollendtrapped=!1,y._unbind(y.doc,x.transitionend,y.onScrollEnd),y.prepareTransition(0),y.setScrollTop(e),y.railh&&y.setScrollLeft(t),y.timerscroll&&y.timerscroll.tm&&clearInterval(y.timerscroll.tm),y.timerscroll=!1,y.cursorfreezed=!1,y.showCursor(e,t),y},this.onScrollEnd=function(){y.scrollendtrapped&&y._unbind(y.doc,x.transitionend,y.onScrollEnd),y.scrollendtrapped=!1,y.prepareTransition(0),y.timerscroll&&y.timerscroll.tm&&clearInterval(y.timerscroll.tm),y.timerscroll=!1;var e=y.getScrollTop(),t=y.getScrollLeft();return y.setScrollTop(e),y.railh&&y.setScrollLeft(t),y.noticeCursor(!1,e,t),y.cursorfreezed=!1,0>e?e=0:e>y.page.maxh&&(e=y.page.maxh),0>t?t=0:t>y.page.maxw&&(t=y.page.maxw),e!=y.newscrolly||t!=y.newscrollx?y.doScrollPos(t,e,y.opt.snapbackspeed):(y.onscrollend&&y.scrollrunning&&y.onscrollend.call(y,{type:"scrollend",current:{x:t,y:e},end:{x:y.newscrollx,y:y.newscrolly}}),void(y.scrollrunning=!1))}):(this.doScrollLeft=function(e,t){var o=y.scrollrunning?y.newscrolly:y.getScrollTop();y.doScrollPos(e,o,t)},this.doScrollTop=function(e,t){var o=y.scrollrunning?y.newscrollx:y.getScrollLeft();y.doScrollPos(o,e,t)},this.doScrollPos=function(e,t,o){function i(){if(y.cancelAnimationFrame)return!0;if(y.scrollrunning=!0,u=1-u)return y.timer=c(i)||1;var e=0,t=sy=y.getScrollTop();if(y.dst.ay){var t=y.bzscroll?y.dst.py+y.bzscroll.getNow()*y.dst.ay:y.newscrolly,o=t-sy;(0>o&&t<y.newscrolly||o>0&&t>y.newscrolly)&&(t=y.newscrolly),y.setScrollTop(t),t==y.newscrolly&&(e=1)}else e=1;var r=sx=y.getScrollLeft();y.dst.ax?(r=y.bzscroll?y.dst.px+y.bzscroll.getNow()*y.dst.ax:y.newscrollx,o=r-sx,(0>o&&r<y.newscrollx||o>0&&r>y.newscrollx)&&(r=y.newscrollx),y.setScrollLeft(r),r==y.newscrollx&&(e+=1)):e+=1,2==e?(y.timer=0,y.cursorfreezed=!1,y.bzscroll=!1,y.scrollrunning=!1,0>t?t=0:t>y.page.maxh&&(t=y.page.maxh),0>r?r=0:r>y.page.maxw&&(r=y.page.maxw),r!=y.newscrollx||t!=y.newscrolly?y.doScrollPos(r,t):y.onscrollend&&y.onscrollend.call(y,{type:"scrollend",current:{x:sx,y:sy},end:{x:y.newscrollx,y:y.newscrolly}})):y.timer=c(i)||1}if(t="undefined"==typeof t||!1===t?y.getScrollTop(!0):t,y.timer&&y.newscrolly==t&&y.newscrollx==e)return!0;y.timer&&d(y.timer),y.timer=0;var r=y.getScrollTop(),n=y.getScrollLeft();(0>(y.newscrolly-r)*(t-r)||0>(y.newscrollx-n)*(e-n))&&y.cancelScroll(),y.newscrolly=t,y.newscrollx=e,y.bouncescroll&&y.rail.visibility||(0>y.newscrolly?y.newscrolly=0:y.newscrolly>y.page.maxh&&(y.newscrolly=y.page.maxh)),y.bouncescroll&&y.railh.visibility||(0>y.newscrollx?y.newscrollx=0:y.newscrollx>y.page.maxw&&(y.newscrollx=y.page.maxw)),y.dst={},y.dst.x=e-n,y.dst.y=t-r,y.dst.px=n,y.dst.py=r;var s=Math.round(Math.sqrt(Math.pow(y.dst.x,2)+Math.pow(y.dst.y,2)));y.dst.ax=y.dst.x/s,y.dst.ay=y.dst.y/s;var l=0,a=s;if(0==y.dst.x?(l=r,a=t,y.dst.ay=1,y.dst.py=0):0==y.dst.y&&(l=n,a=e,y.dst.ax=1,y.dst.px=0),s=y.getTransitionSpeed(s),o&&1>=o&&(s*=o),y.bzscroll=s>0?y.bzscroll?y.bzscroll.update(a,s):new BezierClass(l,a,s,0,1,0,1):!1,!y.timer){(r==y.page.maxh&&t>=y.page.maxh||n==y.page.maxw&&e>=y.page.maxw)&&y.checkContentSize();var u=1;y.cancelAnimationFrame=!1,y.timer=1,y.onscrollstart&&!y.scrollrunning&&y.onscrollstart.call(y,{type:"scrollstart",current:{x:n,y:r},request:{x:e,y:t},end:{x:y.newscrollx,y:y.newscrolly},speed:s}),i(),(r==y.page.maxh&&t>=r||n==y.page.maxw&&e>=n)&&y.checkContentSize(),y.noticeCursor()}},this.cancelScroll=function(){return y.timer&&d(y.timer),y.timer=0,y.bzscroll=!1,y.scrollrunning=!1,y}):(this.doScrollLeft=function(e,t){var o=y.getScrollTop();y.doScrollPos(e,o,t)},this.doScrollTop=function(e,t){var o=y.getScrollLeft();y.doScrollPos(o,e,t)},this.doScrollPos=function(e,t){var o=e>y.page.maxw?y.page.maxw:e;0>o&&(o=0);var i=t>y.page.maxh?y.page.maxh:t;0>i&&(i=0),y.synched("scroll",function(){y.setScrollTop(i),y.setScrollLeft(o)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,t){var o=0,o=t?Math.floor((y.scroll.y-e)*y.scrollratio.y):(y.timer?y.newscrolly:y.getScrollTop(!0))-e;if(y.bouncescroll){var i=Math.round(y.view.h/2);-i>o?o=-i:o>y.page.maxh+i&&(o=y.page.maxh+i)}return y.cursorfreezed=!1,py=y.getScrollTop(!0),0>o&&0>=py?y.noticeCursor():o>y.page.maxh&&py>=y.page.maxh?(y.checkContentSize(),y.noticeCursor()):void y.doScrollTop(o)},this.doScrollLeftBy=function(e,t){var o=0,o=t?Math.floor((y.scroll.x-e)*y.scrollratio.x):(y.timer?y.newscrollx:y.getScrollLeft(!0))-e;if(y.bouncescroll){var i=Math.round(y.view.w/2);-i>o?o=-i:o>y.page.maxw+i&&(o=y.page.maxw+i)}return y.cursorfreezed=!1,px=y.getScrollLeft(!0),0>o&&0>=px||o>y.page.maxw&&px>=y.page.maxw?y.noticeCursor():void y.doScrollLeft(o)},this.doScrollTo=function(e,t){t&&Math.round(e*y.scrollratio.y),y.cursorfreezed=!1,y.doScrollTop(e)},this.checkContentSize=function(){var e=y.getContentSize();e.h==y.page.h&&e.w==y.page.w||y.resize(!1,e)},y.onscroll=function(){y.rail.drag||y.cursorfreezed||y.synched("scroll",function(){y.scroll.y=Math.round(y.getScrollTop()*(1/y.scrollratio.y)),y.railh&&(y.scroll.x=Math.round(y.getScrollLeft()*(1/y.scrollratio.x))),y.noticeCursor()})},y.bind(y.docscroll,"scroll",y.onscroll),this.doZoomIn=function(t){if(!y.zoomactive){y.zoomactive=!0,y.zoomrestore={style:{}};var o,i="position top left zIndex backgroundColor marginTop marginBottom marginLeft marginRight".split(" "),r=y.win[0].style;for(o in i){var s=i[o];y.zoomrestore.style[s]="undefined"!=typeof r[s]?r[s]:""}return y.zoomrestore.style.width=y.win.css("width"),y.zoomrestore.style.height=y.win.css("height"),y.zoomrestore.padding={w:y.win.outerWidth()-y.win.width(),h:y.win.outerHeight()-y.win.height()},x.isios4&&(y.zoomrestore.scrollTop=e(window).scrollTop(),e(window).scrollTop(0)),y.win.css({position:x.isios4?"absolute":"fixed",top:0,left:0,"z-index":n+100,margin:"0px"}),i=y.win.css("backgroundColor"),(""==i||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(i))&&y.win.css("backgroundColor","#fff"),y.rail.css({"z-index":n+101}),y.zoom.css({"z-index":n+102}),y.zoom.css("backgroundPosition","0px -18px"),y.resizeZoom(),y.onzoomin&&y.onzoomin.call(y),y.cancelEvent(t)}},this.doZoomOut=function(t){return y.zoomactive?(y.zoomactive=!1,y.win.css("margin",""),y.win.css(y.zoomrestore.style),x.isios4&&e(window).scrollTop(y.zoomrestore.scrollTop),y.rail.css({"z-index":y.zindex}),y.zoom.css({"z-index":y.zindex}),y.zoomrestore=!1,y.zoom.css("backgroundPosition","0px 0px"),y.onResize(),y.onzoomout&&y.onzoomout.call(y),y.cancelEvent(t)):void 0},this.doZoom=function(e){return y.zoomactive?y.doZoomOut(e):y.doZoomIn(e)},this.resizeZoom=function(){if(y.zoomactive){var t=y.getScrollTop();y.win.css({width:e(window).width()-y.zoomrestore.padding.w+"px",height:e(window).height()-y.zoomrestore.padding.h+"px"}),y.onResize(),y.setScrollTop(Math.min(y.page.maxh,t))}},this.init(),e.nicescroll.push(this)},v=function(e){var t=this;this.nc=e,this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0,this.snapy=this.snapx=!1,this.demuly=this.demulx=0,this.lastscrolly=this.lastscrollx=-1,this.timer=this.chky=this.chkx=0,this.time=function(){return+new Date
},this.reset=function(e,o){t.stop();var i=t.time();t.steptime=0,t.lasttime=i,t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=o,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,o){var i=t.time();t.steptime=i-t.lasttime,t.lasttime=i;var i=o-t.lasty,r=e-t.lastx,n=t.nc.getScrollTop(),s=t.nc.getScrollLeft(),n=n+i,s=s+r;t.snapx=0>s||s>t.nc.page.maxw,t.snapy=0>n||n>t.nc.page.maxh,t.speedx=r,t.speedy=i,t.lastx=e,t.lasty=o},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,o){var i=!1;0>o?(o=0,i=!0):o>t.nc.page.maxh&&(o=t.nc.page.maxh,i=!0),0>e?(e=0,i=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,i=!0),i&&t.nc.doScrollPos(e,o,t.nc.opt.snapbackspeed)},this.doMomentum=function(e){var o=t.time(),i=e?o+e:t.lasttime;e=t.nc.getScrollLeft();var r=t.nc.getScrollTop(),n=t.nc.page.maxh,s=t.nc.page.maxw;if(t.speedx=s>0?Math.min(60,t.speedx):0,t.speedy=n>0?Math.min(60,t.speedy):0,i=i&&60>=o-i,(0>r||r>n||0>e||e>s)&&(i=!1),e=t.speedx&&i?t.speedx:!1,t.speedy&&i&&t.speedy||e){var l=Math.max(16,t.steptime);l>50&&(e=l/50,t.speedx*=e,t.speedy*=e,l=50),t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var a=t.lastscrollx,c=t.lastscrolly,d=function(){var e=600<t.time()-o?.04:.02;t.speedx&&(a=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=a,0>a||a>s)&&(e=.1),t.speedy&&(c=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=c,0>c||c>n)&&(e=.1),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched("domomentum2d",function(){t.speedx&&(t.nc.getScrollLeft()!=t.chkx&&t.stop(),t.chkx=a,t.nc.setScrollLeft(a)),t.speedy&&(t.nc.getScrollTop()!=t.chky&&t.stop(),t.chky=c,t.nc.setScrollTop(c)),t.timer||(t.nc.hideCursor(),t.doSnapy(a,c))}),1>t.demulxy?t.timer=setTimeout(d,l):(t.stop(),t.nc.hideCursor(),t.doSnapy(a,c))};d()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},y=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(t,o){return(o=e.data(t,"__nicescroll")||!1)&&o.ishwscroll?o.getScrollTop():y.call(t)},set:function(t,o){var i=e.data(t,"__nicescroll")||!1;return i&&i.ishwscroll?i.setScrollTop(parseInt(o)):y.call(t,o),this}},e.fn.scrollTop=function(t){if("undefined"==typeof t){var o=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return o&&o.ishwscroll?o.getScrollTop():y.call(this)}return this.each(function(){var o=e.data(this,"__nicescroll")||!1;o&&o.ishwscroll?o.setScrollTop(parseInt(t)):y.call(e(this),t)})};var b=e.fn.scrollLeft;e.cssHooks.pageXOffset={get:function(t,o){return(o=e.data(t,"__nicescroll")||!1)&&o.ishwscroll?o.getScrollLeft():b.call(t)},set:function(t,o){var i=e.data(t,"__nicescroll")||!1;return i&&i.ishwscroll?i.setScrollLeft(parseInt(o)):b.call(t,o),this}},e.fn.scrollLeft=function(t){if("undefined"==typeof t){var o=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return o&&o.ishwscroll?o.getScrollLeft():b.call(this)}return this.each(function(){var o=e.data(this,"__nicescroll")||!1;o&&o.ishwscroll?o.setScrollLeft(parseInt(t)):b.call(e(this),t)})};var x=function(t){var o=this;if(this.length=0,this.name="nicescrollarray",this.each=function(e){for(var t=0,i=0;t<o.length;t++)e.call(o[t],i++);return o},this.push=function(e){o[o.length]=e,o.length++},this.eq=function(e){return o[e]},t)for(a=0;a<t.length;a++){var i=e.data(t[a],"__nicescroll")||!1;i&&(this[this.length]=i,this.length++)}return this};!function(e,t,o){for(var i=0;i<t.length;i++)o(e,t[i])}(x.prototype,"show hide toggle onResize resize remove stop doScrollPos".split(" "),function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(t){return"undefined"==typeof t?new x(this):this[t]&&e.data(this[t],"__nicescroll")||!1},e.extend(e.expr[":"],{nicescroll:function(t){return e.data(t,"__nicescroll")?!0:!1}}),e.fn.niceScroll=function(t,o){"undefined"!=typeof o||"object"!=typeof t||"jquery"in t||(o=t,t=!1);var i=new x;"undefined"==typeof o&&(o={}),t&&(o.doc=e(t),o.win=e(this));var r=!("doc"in o);return r||"win"in o||(o.win=e(this)),this.each(function(){var t=e(this).data("__nicescroll")||!1;t||(o.doc=r?e(this):o.doc,t=new w(o,e(this)),e(this).data("__nicescroll",t)),i.push(t)}),1==i.length?i[0]:i},window.NiceScroll={getjQuery:function(){return e}},e.nicescroll||(e.nicescroll=new x,e.nicescroll.options=m)}(jQuery),o("libs/jquery.nicescroll.min",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};o("scroll",["libs/jquery.nicescroll.min"],function(){var t;return t=function(){function t(o,i){var r;return this.$el=o,null==i&&(i={}),this.onScrollEnd=e(this.onScrollEnd,this),this.onScrollStart=e(this.onScrollStart,this),i.allBrowsers||(i.userAgent||(i.userAgent=/Windows\ NT/),navigator.userAgent.match(i.userAgent))?(null==i.horizontal&&(i.horizontal=!0),null==i.zindex&&(i.zindex=9e3),r={cursorcolor:"rgba(0,0,0,0.5)",cursorwidth:"8px",zindex:i.zindex,horizrailenabled:i.horizontal},this.nice=this.$el.niceScroll(r),this.nice.scrollstart(this.onScrollStart),this.nice.scrollend(this.onScrollEnd),void t.scrollers.push(this.nice)):!1}return t.scrollers=[],t.prototype._otherScrollers=function(){var e,o,i,r,n;for(e=[],n=t.scrollers,i=0,r=n.length;r>i;i++)o=n[i],o!==this.nice&&e.push(o);return e},t.prototype.onScrollStart=function(){var e,t,o,i,r;for(i=this._otherScrollers(),r=[],t=0,o=i.length;o>t;t++)e=i[t],r.push(e.hide());return r},t.prototype.onScrollEnd=function(){var e,t,o,i,r;for(i=this._otherScrollers(),r=[],t=0,o=i.length;o>t;t++)e=i[t],e.resize(),r.push(e.show());return r},t.prototype.resize=function(){return this.nice.resize()},t.prototype.destroy=function(){return t.scrollers=this._otherScrollers(),this.nice.remove()},t}()})}.call(this),function(){o("ui",["editable_text","loading","loading_indicator","scroll"],function(e,t,o,i){var r;return r={EditableText:e,Loading:t,LoadingIndicator:o,Scroll:i},"undefined"!=typeof window&&(window.vs||(window.vs={}),window.vs.ui=r),r})}.call(this),t("ui")});

define('text!templates/lesson.html',[],function () { return '<header>\n  <h1 class="lesson-title js-lesson-title"><%- title %></h1>\n</header>\n\n<div class="lesson-content js-lesson-content">\n  <div class="gadgets js-lesson-gadgets">\n    <p class="canvas-message">\n      To begin, grab a gadget and drag it onto the canvas\n    </p>\n  </div>\n</div>\n\n<div class="lesson-screen js-lesson-screen"></div>\n';});


define('text!templates/gadget_drag_image.html',[],function () { return '<div class="js-gadget-drag-image-icon gadget-drag-image-icon"></div>\n\n<div class="gadget-drag-image-details">\n  <div><%- title %></div>\n  <div><%- author %></div>\n  <div><%- version %></div>\n</div>\n';});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/gadget/drag_image',['cdn.underscore', 'cdn.marionette', 'text!templates/gadget_drag_image.html'], function(_, Marionette, template) {
    var GadgetDragImageView;
    return GadgetDragImageView = (function(_super) {
      __extends(GadgetDragImageView, _super);

      function GadgetDragImageView() {
        return GadgetDragImageView.__super__.constructor.apply(this, arguments);
      }

      GadgetDragImageView.prototype.template = _.template(template);

      GadgetDragImageView.prototype.className = 'gadget-drag-image';

      GadgetDragImageView.prototype.ui = {
        icon: '.js-gadget-drag-image-icon'
      };

      GadgetDragImageView.prototype.onRender = function() {
        var iconPath;
        if (this.model.has('icon')) {
          iconPath = this.model.get('icon');
          return this.ui.icon.css({
            'background-image': "url(" + iconPath + ")"
          });
        }
      };

      return GadgetDragImageView;

    })(Marionette.ItemView);
  });

}).call(this);


define('text!templates/property_sheet.html',[],function () { return '<div class="properties-dialog-arrow"></div>\n\n<div class="properties-dialog-header">\n  Properties\n\n  <div class="properties-dialog-error-count js-error-count-container">\n    <span class="js-error-count">1</span>\n    error<span class="js-error-count-plural">s</span>\n  </div>\n</div>\n\n<div class="js-form"></div>\n';});

/*! tether 0.6.5 */


(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('bower_components/tether/tether',factory);
  } else if (typeof exports === 'object') {
    module.exports = factory(require,exports,module);
  } else {
    root.Tether = factory();
  }
}(this, function(require,exports,module) {

(function() {
  var Evented, addClass, defer, deferred, extend, flush, getBounds, getOffsetParent, getOrigin, getScrollBarSize, getScrollParent, hasClass, node, removeClass, uniqueId, updateClasses, zeroPosCache,
    __hasProp = {}.hasOwnProperty,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
    __slice = [].slice;

  if (this.Tether == null) {
    this.Tether = {
      modules: []
    };
  }

  getScrollParent = function(el) {
    var parent, position, scrollParent, style, _ref;
    position = getComputedStyle(el).position;
    if (position === 'fixed') {
      return el;
    }
    scrollParent = void 0;
    parent = el;
    while (parent = parent.parentNode) {
      try {
        style = getComputedStyle(parent);
      } catch (_error) {}
      if (style == null) {
        return parent;
      }
      if (/(auto|scroll)/.test(style['overflow'] + style['overflowY'] + style['overflowX'])) {
        if (position !== 'absolute' || ((_ref = style['position']) === 'relative' || _ref === 'absolute' || _ref === 'fixed')) {
          return parent;
        }
      }
    }
    return document.body;
  };

  uniqueId = (function() {
    var id;
    id = 0;
    return function() {
      return id++;
    };
  })();

  zeroPosCache = {};

  getOrigin = function(doc) {
    var id, k, node, v, _ref;
    node = doc._tetherZeroElement;
    if (node == null) {
      node = doc.createElement('div');
      node.setAttribute('data-tether-id', uniqueId());
      extend(node.style, {
        top: 0,
        left: 0,
        position: 'absolute'
      });
      doc.body.appendChild(node);
      doc._tetherZeroElement = node;
    }
    id = node.getAttribute('data-tether-id');
    if (zeroPosCache[id] == null) {
      zeroPosCache[id] = {};
      _ref = node.getBoundingClientRect();
      for (k in _ref) {
        v = _ref[k];
        zeroPosCache[id][k] = v;
      }
      defer(function() {
        return zeroPosCache[id] = void 0;
      });
    }
    return zeroPosCache[id];
  };

  node = null;

  getBounds = function(el) {
    var box, doc, docEl, k, origin, v, _ref;
    if (el === document) {
      doc = document;
      el = document.documentElement;
    } else {
      doc = el.ownerDocument;
    }
    docEl = doc.documentElement;
    box = {};
    _ref = el.getBoundingClientRect();
    for (k in _ref) {
      v = _ref[k];
      box[k] = v;
    }
    origin = getOrigin(doc);
    box.top -= origin.top;
    box.left -= origin.left;
    if (box.width == null) {
      box.width = document.body.scrollWidth - box.left - box.right;
    }
    if (box.height == null) {
      box.height = document.body.scrollHeight - box.top - box.bottom;
    }
    box.top = box.top - docEl.clientTop;
    box.left = box.left - docEl.clientLeft;
    box.right = doc.body.clientWidth - box.width - box.left;
    box.bottom = doc.body.clientHeight - box.height - box.top;
    return box;
  };

  getOffsetParent = function(el) {
    return el.offsetParent || document.documentElement;
  };

  getScrollBarSize = function() {
    var inner, outer, width, widthContained, widthScroll;
    inner = document.createElement('div');
    inner.style.width = '100%';
    inner.style.height = '200px';
    outer = document.createElement('div');
    extend(outer.style, {
      position: 'absolute',
      top: 0,
      left: 0,
      pointerEvents: 'none',
      visibility: 'hidden',
      width: '200px',
      height: '150px',
      overflow: 'hidden'
    });
    outer.appendChild(inner);
    document.body.appendChild(outer);
    widthContained = inner.offsetWidth;
    outer.style.overflow = 'scroll';
    widthScroll = inner.offsetWidth;
    if (widthContained === widthScroll) {
      widthScroll = outer.clientWidth;
    }
    document.body.removeChild(outer);
    width = widthContained - widthScroll;
    return {
      width: width,
      height: width
    };
  };

  extend = function(out) {
    var args, key, obj, val, _i, _len, _ref;
    if (out == null) {
      out = {};
    }
    args = [];
    Array.prototype.push.apply(args, arguments);
    _ref = args.slice(1);
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      obj = _ref[_i];
      if (obj) {
        for (key in obj) {
          if (!__hasProp.call(obj, key)) continue;
          val = obj[key];
          out[key] = val;
        }
      }
    }
    return out;
  };

  removeClass = function(el, name) {
    var cls, _i, _len, _ref, _results;
    if (el.classList != null) {
      _ref = name.split(' ');
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        cls = _ref[_i];
        if (cls.trim()) {
          _results.push(el.classList.remove(cls));
        }
      }
      return _results;
    } else {
      return el.setAttribute('class', el.getAttribute('class').replace(new RegExp("(^| )" + (name.split(' ').join('|')) + "( |$)", 'gi'), ' '));
    }
  };

  addClass = function(el, name) {
    var cls, _i, _len, _ref, _results;
    if (el.classList != null) {
      _ref = name.split(' ');
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        cls = _ref[_i];
        if (cls.trim()) {
          _results.push(el.classList.add(cls));
        }
      }
      return _results;
    } else {
      removeClass(el, name);
      return el.className += " " + name;
    }
  };

  hasClass = function(el, name) {
    if (el.classList != null) {
      return el.classList.contains(name);
    } else {
      return new RegExp("(^| )" + name + "( |$)", 'gi').test(el.className);
    }
  };

  updateClasses = function(el, add, all) {
    var cls, _i, _j, _len, _len1, _results;
    for (_i = 0, _len = all.length; _i < _len; _i++) {
      cls = all[_i];
      if (__indexOf.call(add, cls) < 0) {
        if (hasClass(el, cls)) {
          removeClass(el, cls);
        }
      }
    }
    _results = [];
    for (_j = 0, _len1 = add.length; _j < _len1; _j++) {
      cls = add[_j];
      if (!hasClass(el, cls)) {
        _results.push(addClass(el, cls));
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  deferred = [];

  defer = function(fn) {
    return deferred.push(fn);
  };

  flush = function() {
    var fn, _results;
    _results = [];
    while (fn = deferred.pop()) {
      _results.push(fn());
    }
    return _results;
  };

  Evented = (function() {
    function Evented() {}

    Evented.prototype.on = function(event, handler, ctx, once) {
      var _base;
      if (once == null) {
        once = false;
      }
      if (this.bindings == null) {
        this.bindings = {};
      }
      if ((_base = this.bindings)[event] == null) {
        _base[event] = [];
      }
      return this.bindings[event].push({
        handler: handler,
        ctx: ctx,
        once: once
      });
    };

    Evented.prototype.once = function(event, handler, ctx) {
      return this.on(event, handler, ctx, true);
    };

    Evented.prototype.off = function(event, handler) {
      var i, _ref, _results;
      if (((_ref = this.bindings) != null ? _ref[event] : void 0) == null) {
        return;
      }
      if (handler == null) {
        return delete this.bindings[event];
      } else {
        i = 0;
        _results = [];
        while (i < this.bindings[event].length) {
          if (this.bindings[event][i].handler === handler) {
            _results.push(this.bindings[event].splice(i, 1));
          } else {
            _results.push(i++);
          }
        }
        return _results;
      }
    };

    Evented.prototype.trigger = function() {
      var args, ctx, event, handler, i, once, _ref, _ref1, _results;
      event = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      if ((_ref = this.bindings) != null ? _ref[event] : void 0) {
        i = 0;
        _results = [];
        while (i < this.bindings[event].length) {
          _ref1 = this.bindings[event][i], handler = _ref1.handler, ctx = _ref1.ctx, once = _ref1.once;
          handler.apply(ctx != null ? ctx : this, args);
          if (once) {
            _results.push(this.bindings[event].splice(i, 1));
          } else {
            _results.push(i++);
          }
        }
        return _results;
      }
    };

    return Evented;

  })();

  this.Tether.Utils = {
    getScrollParent: getScrollParent,
    getBounds: getBounds,
    getOffsetParent: getOffsetParent,
    extend: extend,
    addClass: addClass,
    removeClass: removeClass,
    hasClass: hasClass,
    updateClasses: updateClasses,
    defer: defer,
    flush: flush,
    uniqueId: uniqueId,
    Evented: Evented,
    getScrollBarSize: getScrollBarSize
  };

}).call(this);

(function() {
  var MIRROR_LR, MIRROR_TB, OFFSET_MAP, Tether, addClass, addOffset, attachmentToOffset, autoToFixedAttachment, defer, extend, flush, getBounds, getOffsetParent, getOuterSize, getScrollBarSize, getScrollParent, getSize, now, offsetToPx, parseAttachment, parseOffset, position, removeClass, tethers, transformKey, updateClasses, within, _Tether, _ref,
    __slice = [].slice,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  if (this.Tether == null) {
    throw new Error("You must include the utils.js file before tether.js");
  }

  Tether = this.Tether;

  _ref = Tether.Utils, getScrollParent = _ref.getScrollParent, getSize = _ref.getSize, getOuterSize = _ref.getOuterSize, getBounds = _ref.getBounds, getOffsetParent = _ref.getOffsetParent, extend = _ref.extend, addClass = _ref.addClass, removeClass = _ref.removeClass, updateClasses = _ref.updateClasses, defer = _ref.defer, flush = _ref.flush, getScrollBarSize = _ref.getScrollBarSize;

  within = function(a, b, diff) {
    if (diff == null) {
      diff = 1;
    }
    return (a + diff >= b && b >= a - diff);
  };

  transformKey = (function() {
    var el, key, _i, _len, _ref1;
    el = document.createElement('div');
    _ref1 = ['transform', 'webkitTransform', 'OTransform', 'MozTransform', 'msTransform'];
    for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
      key = _ref1[_i];
      if (el.style[key] !== void 0) {
        return key;
      }
    }
  })();

  tethers = [];

  position = function() {
    var tether, _i, _len;
    for (_i = 0, _len = tethers.length; _i < _len; _i++) {
      tether = tethers[_i];
      tether.position(false);
    }
    return flush();
  };

  now = function() {
    var _ref1;
    return (_ref1 = typeof performance !== "undefined" && performance !== null ? typeof performance.now === "function" ? performance.now() : void 0 : void 0) != null ? _ref1 : +(new Date);
  };

  (function() {
    var event, lastCall, lastDuration, pendingTimeout, tick, _i, _len, _ref1, _results;
    lastCall = null;
    lastDuration = null;
    pendingTimeout = null;
    tick = function() {
      if ((lastDuration != null) && lastDuration > 16) {
        lastDuration = Math.min(lastDuration - 16, 250);
        pendingTimeout = setTimeout(tick, 250);
        return;
      }
      if ((lastCall != null) && (now() - lastCall) < 10) {
        return;
      }
      if (pendingTimeout != null) {
        clearTimeout(pendingTimeout);
        pendingTimeout = null;
      }
      lastCall = now();
      position();
      return lastDuration = now() - lastCall;
    };
    _ref1 = ['resize', 'scroll', 'touchmove'];
    _results = [];
    for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
      event = _ref1[_i];
      _results.push(window.addEventListener(event, tick));
    }
    return _results;
  })();

  MIRROR_LR = {
    center: 'center',
    left: 'right',
    right: 'left'
  };

  MIRROR_TB = {
    middle: 'middle',
    top: 'bottom',
    bottom: 'top'
  };

  OFFSET_MAP = {
    top: 0,
    left: 0,
    middle: '50%',
    center: '50%',
    bottom: '100%',
    right: '100%'
  };

  autoToFixedAttachment = function(attachment, relativeToAttachment) {
    var left, top;
    left = attachment.left, top = attachment.top;
    if (left === 'auto') {
      left = MIRROR_LR[relativeToAttachment.left];
    }
    if (top === 'auto') {
      top = MIRROR_TB[relativeToAttachment.top];
    }
    return {
      left: left,
      top: top
    };
  };

  attachmentToOffset = function(attachment) {
    var _ref1, _ref2;
    return {
      left: (_ref1 = OFFSET_MAP[attachment.left]) != null ? _ref1 : attachment.left,
      top: (_ref2 = OFFSET_MAP[attachment.top]) != null ? _ref2 : attachment.top
    };
  };

  addOffset = function() {
    var left, offsets, out, top, _i, _len, _ref1;
    offsets = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    out = {
      top: 0,
      left: 0
    };
    for (_i = 0, _len = offsets.length; _i < _len; _i++) {
      _ref1 = offsets[_i], top = _ref1.top, left = _ref1.left;
      if (typeof top === 'string') {
        top = parseFloat(top, 10);
      }
      if (typeof left === 'string') {
        left = parseFloat(left, 10);
      }
      out.top += top;
      out.left += left;
    }
    return out;
  };

  offsetToPx = function(offset, size) {
    if (typeof offset.left === 'string' && offset.left.indexOf('%') !== -1) {
      offset.left = parseFloat(offset.left, 10) / 100 * size.width;
    }
    if (typeof offset.top === 'string' && offset.top.indexOf('%') !== -1) {
      offset.top = parseFloat(offset.top, 10) / 100 * size.height;
    }
    return offset;
  };

  parseAttachment = parseOffset = function(value) {
    var left, top, _ref1;
    _ref1 = value.split(' '), top = _ref1[0], left = _ref1[1];
    return {
      top: top,
      left: left
    };
  };

  _Tether = (function() {
    _Tether.modules = [];

    function _Tether(options) {
      this.position = __bind(this.position, this);
      var module, _i, _len, _ref1, _ref2;
      tethers.push(this);
      this.history = [];
      this.setOptions(options, false);
      _ref1 = Tether.modules;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        module = _ref1[_i];
        if ((_ref2 = module.initialize) != null) {
          _ref2.call(this);
        }
      }
      this.position();
    }

    _Tether.prototype.getClass = function(key) {
      var _ref1, _ref2;
      if ((_ref1 = this.options.classes) != null ? _ref1[key] : void 0) {
        return this.options.classes[key];
      } else if (((_ref2 = this.options.classes) != null ? _ref2[key] : void 0) !== false) {
        if (this.options.classPrefix) {
          return "" + this.options.classPrefix + "-" + key;
        } else {
          return key;
        }
      } else {
        return '';
      }
    };

    _Tether.prototype.setOptions = function(options, position) {
      var defaults, key, _i, _len, _ref1, _ref2;
      this.options = options;
      if (position == null) {
        position = true;
      }
      defaults = {
        offset: '0 0',
        targetOffset: '0 0',
        targetAttachment: 'auto auto',
        classPrefix: 'tether'
      };
      this.options = extend(defaults, this.options);
      _ref1 = this.options, this.element = _ref1.element, this.target = _ref1.target, this.targetModifier = _ref1.targetModifier;
      if (this.target === 'viewport') {
        this.target = document.body;
        this.targetModifier = 'visible';
      } else if (this.target === 'scroll-handle') {
        this.target = document.body;
        this.targetModifier = 'scroll-handle';
      }
      _ref2 = ['element', 'target'];
      for (_i = 0, _len = _ref2.length; _i < _len; _i++) {
        key = _ref2[_i];
        if (this[key] == null) {
          throw new Error("Tether Error: Both element and target must be defined");
        }
        if (this[key].jquery != null) {
          this[key] = this[key][0];
        } else if (typeof this[key] === 'string') {
          this[key] = document.querySelector(this[key]);
        }
      }
      addClass(this.element, this.getClass('element'));
      addClass(this.target, this.getClass('target'));
      if (!this.options.attachment) {
        throw new Error("Tether Error: You must provide an attachment");
      }
      this.targetAttachment = parseAttachment(this.options.targetAttachment);
      this.attachment = parseAttachment(this.options.attachment);
      this.offset = parseOffset(this.options.offset);
      this.targetOffset = parseOffset(this.options.targetOffset);
      if (this.scrollParent != null) {
        this.disable();
      }
      if (this.targetModifier === 'scroll-handle') {
        this.scrollParent = this.target;
      } else {
        this.scrollParent = getScrollParent(this.target);
      }
      if (this.options.enabled !== false) {
        return this.enable(position);
      }
    };

    _Tether.prototype.getTargetBounds = function() {
      var bounds, fitAdj, hasBottomScroll, height, out, scrollBottom, scrollPercentage, style, target;
      if (this.targetModifier != null) {
        switch (this.targetModifier) {
          case 'visible':
            if (this.target === document.body) {
              return {
                top: pageYOffset,
                left: pageXOffset,
                height: innerHeight,
                width: innerWidth
              };
            } else {
              bounds = getBounds(this.target);
              out = {
                height: bounds.height,
                width: bounds.width,
                top: bounds.top,
                left: bounds.left
              };
              out.height = Math.min(out.height, bounds.height - (pageYOffset - bounds.top));
              out.height = Math.min(out.height, bounds.height - ((bounds.top + bounds.height) - (pageYOffset + innerHeight)));
              out.height = Math.min(innerHeight, out.height);
              out.height -= 2;
              out.width = Math.min(out.width, bounds.width - (pageXOffset - bounds.left));
              out.width = Math.min(out.width, bounds.width - ((bounds.left + bounds.width) - (pageXOffset + innerWidth)));
              out.width = Math.min(innerWidth, out.width);
              out.width -= 2;
              if (out.top < pageYOffset) {
                out.top = pageYOffset;
              }
              if (out.left < pageXOffset) {
                out.left = pageXOffset;
              }
              return out;
            }
            break;
          case 'scroll-handle':
            target = this.target;
            if (target === document.body) {
              target = document.documentElement;
              bounds = {
                left: pageXOffset,
                top: pageYOffset,
                height: innerHeight,
                width: innerWidth
              };
            } else {
              bounds = getBounds(target);
            }
            style = getComputedStyle(target);
            hasBottomScroll = target.scrollWidth > target.clientWidth || 'scroll' === [style.overflow, style.overflowX] || this.target !== document.body;
            scrollBottom = 0;
            if (hasBottomScroll) {
              scrollBottom = 15;
            }
            height = bounds.height - parseFloat(style.borderTopWidth) - parseFloat(style.borderBottomWidth) - scrollBottom;
            out = {
              width: 15,
              height: height * 0.975 * (height / target.scrollHeight),
              left: bounds.left + bounds.width - parseFloat(style.borderLeftWidth) - 15
            };
            fitAdj = 0;
            if (height < 408 && this.target === document.body) {
              fitAdj = -0.00011 * Math.pow(height, 2) - 0.00727 * height + 22.58;
            }
            if (this.target !== document.body) {
              out.height = Math.max(out.height, 24);
            }
            scrollPercentage = this.target.scrollTop / (target.scrollHeight - height);
            out.top = scrollPercentage * (height - out.height - fitAdj) + bounds.top + parseFloat(style.borderTopWidth);
            if (this.target === document.body) {
              out.height = Math.max(out.height, 24);
            }
            return out;
        }
      } else {
        return getBounds(this.target);
      }
    };

    _Tether.prototype.clearCache = function() {
      return this._cache = {};
    };

    _Tether.prototype.cache = function(k, getter) {
      if (this._cache == null) {
        this._cache = {};
      }
      if (this._cache[k] == null) {
        this._cache[k] = getter.call(this);
      }
      return this._cache[k];
    };

    _Tether.prototype.enable = function(position) {
      if (position == null) {
        position = true;
      }
      addClass(this.target, this.getClass('enabled'));
      addClass(this.element, this.getClass('enabled'));
      this.enabled = true;
      if (this.scrollParent !== document) {
        this.scrollParent.addEventListener('scroll', this.position);
      }
      if (position) {
        return this.position();
      }
    };

    _Tether.prototype.disable = function() {
      removeClass(this.target, this.getClass('enabled'));
      removeClass(this.element, this.getClass('enabled'));
      this.enabled = false;
      if (this.scrollParent != null) {
        return this.scrollParent.removeEventListener('scroll', this.position);
      }
    };

    _Tether.prototype.destroy = function() {
      var i, tether, _i, _len, _results;
      this.disable();
      _results = [];
      for (i = _i = 0, _len = tethers.length; _i < _len; i = ++_i) {
        tether = tethers[i];
        if (tether === this) {
          tethers.splice(i, 1);
          break;
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    _Tether.prototype.updateAttachClasses = function(elementAttach, targetAttach) {
      var add, all, side, sides, _i, _j, _len, _len1, _ref1,
        _this = this;
      if (elementAttach == null) {
        elementAttach = this.attachment;
      }
      if (targetAttach == null) {
        targetAttach = this.targetAttachment;
      }
      sides = ['left', 'top', 'bottom', 'right', 'middle', 'center'];
      if ((_ref1 = this._addAttachClasses) != null ? _ref1.length : void 0) {
        this._addAttachClasses.splice(0, this._addAttachClasses.length);
      }
      add = this._addAttachClasses != null ? this._addAttachClasses : this._addAttachClasses = [];
      if (elementAttach.top) {
        add.push("" + (this.getClass('element-attached')) + "-" + elementAttach.top);
      }
      if (elementAttach.left) {
        add.push("" + (this.getClass('element-attached')) + "-" + elementAttach.left);
      }
      if (targetAttach.top) {
        add.push("" + (this.getClass('target-attached')) + "-" + targetAttach.top);
      }
      if (targetAttach.left) {
        add.push("" + (this.getClass('target-attached')) + "-" + targetAttach.left);
      }
      all = [];
      for (_i = 0, _len = sides.length; _i < _len; _i++) {
        side = sides[_i];
        all.push("" + (this.getClass('element-attached')) + "-" + side);
      }
      for (_j = 0, _len1 = sides.length; _j < _len1; _j++) {
        side = sides[_j];
        all.push("" + (this.getClass('target-attached')) + "-" + side);
      }
      return defer(function() {
        if (_this._addAttachClasses == null) {
          return;
        }
        updateClasses(_this.element, _this._addAttachClasses, all);
        updateClasses(_this.target, _this._addAttachClasses, all);
        return _this._addAttachClasses = void 0;
      });
    };

    _Tether.prototype.position = function(flushChanges) {
      var elementPos, elementStyle, height, left, manualOffset, manualTargetOffset, module, next, offset, offsetBorder, offsetParent, offsetParentSize, offsetParentStyle, offsetPosition, ret, scrollLeft, scrollTop, scrollbarSize, side, targetAttachment, targetOffset, targetPos, targetSize, top, width, _i, _j, _len, _len1, _ref1, _ref2, _ref3, _ref4, _ref5, _ref6,
        _this = this;
      if (flushChanges == null) {
        flushChanges = true;
      }
      if (!this.enabled) {
        return;
      }
      this.clearCache();
      targetAttachment = autoToFixedAttachment(this.targetAttachment, this.attachment);
      this.updateAttachClasses(this.attachment, targetAttachment);
      elementPos = this.cache('element-bounds', function() {
        return getBounds(_this.element);
      });
      width = elementPos.width, height = elementPos.height;
      if (width === 0 && height === 0 && (this.lastSize != null)) {
        _ref1 = this.lastSize, width = _ref1.width, height = _ref1.height;
      } else {
        this.lastSize = {
          width: width,
          height: height
        };
      }
      targetSize = targetPos = this.cache('target-bounds', function() {
        return _this.getTargetBounds();
      });
      offset = offsetToPx(attachmentToOffset(this.attachment), {
        width: width,
        height: height
      });
      targetOffset = offsetToPx(attachmentToOffset(targetAttachment), targetSize);
      manualOffset = offsetToPx(this.offset, {
        width: width,
        height: height
      });
      manualTargetOffset = offsetToPx(this.targetOffset, targetSize);
      offset = addOffset(offset, manualOffset);
      targetOffset = addOffset(targetOffset, manualTargetOffset);
      left = targetPos.left + targetOffset.left - offset.left;
      top = targetPos.top + targetOffset.top - offset.top;
      _ref2 = Tether.modules;
      for (_i = 0, _len = _ref2.length; _i < _len; _i++) {
        module = _ref2[_i];
        ret = module.position.call(this, {
          left: left,
          top: top,
          targetAttachment: targetAttachment,
          targetPos: targetPos,
          attachment: this.attachment,
          elementPos: elementPos,
          offset: offset,
          targetOffset: targetOffset,
          manualOffset: manualOffset,
          manualTargetOffset: manualTargetOffset,
          scrollbarSize: scrollbarSize
        });
        if ((ret == null) || typeof ret !== 'object') {
          continue;
        } else if (ret === false) {
          return false;
        } else {
          top = ret.top, left = ret.left;
        }
      }
      next = {
        page: {
          top: top,
          left: left
        },
        viewport: {
          top: top - pageYOffset,
          bottom: pageYOffset - top - height + innerHeight,
          left: left - pageXOffset,
          right: pageXOffset - left - width + innerWidth
        }
      };
      if (document.body.scrollWidth > window.innerWidth) {
        scrollbarSize = this.cache('scrollbar-size', getScrollBarSize);
        next.viewport.bottom -= scrollbarSize.height;
      }
      if (document.body.scrollHeight > window.innerHeight) {
        scrollbarSize = this.cache('scrollbar-size', getScrollBarSize);
        next.viewport.right -= scrollbarSize.width;
      }
      if (((_ref3 = document.body.style.position) !== '' && _ref3 !== 'static') || ((_ref4 = document.body.parentElement.style.position) !== '' && _ref4 !== 'static')) {
        next.page.bottom = document.body.scrollHeight - top - height;
        next.page.right = document.body.scrollWidth - left - width;
      }
      if (((_ref5 = this.options.optimizations) != null ? _ref5.moveElement : void 0) !== false && (this.targetModifier == null)) {
        offsetParent = this.cache('target-offsetparent', function() {
          return getOffsetParent(_this.target);
        });
        offsetPosition = this.cache('target-offsetparent-bounds', function() {
          return getBounds(offsetParent);
        });
        offsetParentStyle = getComputedStyle(offsetParent);
        elementStyle = getComputedStyle(this.element);
        offsetParentSize = offsetPosition;
        offsetBorder = {};
        _ref6 = ['Top', 'Left', 'Bottom', 'Right'];
        for (_j = 0, _len1 = _ref6.length; _j < _len1; _j++) {
          side = _ref6[_j];
          offsetBorder[side.toLowerCase()] = parseFloat(offsetParentStyle["border" + side + "Width"]);
        }
        offsetPosition.right = document.body.scrollWidth - offsetPosition.left - offsetParentSize.width + offsetBorder.right;
        offsetPosition.bottom = document.body.scrollHeight - offsetPosition.top - offsetParentSize.height + offsetBorder.bottom;
        if (next.page.top >= (offsetPosition.top + offsetBorder.top) && next.page.bottom >= offsetPosition.bottom) {
          if (next.page.left >= (offsetPosition.left + offsetBorder.left) && next.page.right >= offsetPosition.right) {
            scrollTop = offsetParent.scrollTop;
            scrollLeft = offsetParent.scrollLeft;
            next.offset = {
              top: next.page.top - offsetPosition.top + scrollTop - offsetBorder.top,
              left: next.page.left - offsetPosition.left + scrollLeft - offsetBorder.left
            };
          }
        }
      }
      this.move(next);
      this.history.unshift(next);
      if (this.history.length > 3) {
        this.history.pop();
      }
      if (flushChanges) {
        flush();
      }
      return true;
    };

    _Tether.prototype.move = function(position) {
      var css, elVal, found, key, moved, offsetParent, point, same, transcribe, type, val, write, writeCSS, _i, _len, _ref1, _ref2,
        _this = this;
      if (this.element.parentNode == null) {
        return;
      }
      same = {};
      for (type in position) {
        same[type] = {};
        for (key in position[type]) {
          found = false;
          _ref1 = this.history;
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            point = _ref1[_i];
            if (!within((_ref2 = point[type]) != null ? _ref2[key] : void 0, position[type][key])) {
              found = true;
              break;
            }
          }
          if (!found) {
            same[type][key] = true;
          }
        }
      }
      css = {
        top: '',
        left: '',
        right: '',
        bottom: ''
      };
      transcribe = function(same, pos) {
        var xPos, yPos, _ref3;
        if (((_ref3 = _this.options.optimizations) != null ? _ref3.gpu : void 0) !== false) {
          if (same.top) {
            css.top = 0;
            yPos = pos.top;
          } else {
            css.bottom = 0;
            yPos = -pos.bottom;
          }
          if (same.left) {
            css.left = 0;
            xPos = pos.left;
          } else {
            css.right = 0;
            xPos = -pos.right;
          }
          css[transformKey] = "translateX(" + (Math.round(xPos)) + "px) translateY(" + (Math.round(yPos)) + "px)";
          if (transformKey !== 'msTransform') {
            return css[transformKey] += " translateZ(0)";
          }
        } else {
          if (same.top) {
            css.top = "" + pos.top + "px";
          } else {
            css.bottom = "" + pos.bottom + "px";
          }
          if (same.left) {
            return css.left = "" + pos.left + "px";
          } else {
            return css.right = "" + pos.right + "px";
          }
        }
      };
      moved = false;
      if ((same.page.top || same.page.bottom) && (same.page.left || same.page.right)) {
        css.position = 'absolute';
        transcribe(same.page, position.page);
      } else if ((same.viewport.top || same.viewport.bottom) && (same.viewport.left || same.viewport.right)) {
        css.position = 'fixed';
        transcribe(same.viewport, position.viewport);
      } else if ((same.offset != null) && same.offset.top && same.offset.left) {
        css.position = 'absolute';
        offsetParent = this.cache('target-offsetparent', function() {
          return getOffsetParent(_this.target);
        });
        if (getOffsetParent(this.element) !== offsetParent) {
          defer(function() {
            _this.element.parentNode.removeChild(_this.element);
            return offsetParent.appendChild(_this.element);
          });
        }
        transcribe(same.offset, position.offset);
        moved = true;
      } else {
        css.position = 'absolute';
        transcribe({
          top: true,
          left: true
        }, position.page);
      }
      if (!moved && this.element.parentNode.tagName !== 'BODY') {
        this.element.parentNode.removeChild(this.element);
        document.body.appendChild(this.element);
      }
      writeCSS = {};
      write = false;
      for (key in css) {
        val = css[key];
        elVal = this.element.style[key];
        if (elVal !== '' && val !== '' && (key === 'top' || key === 'left' || key === 'bottom' || key === 'right')) {
          elVal = parseFloat(elVal);
          val = parseFloat(val);
        }
        if (elVal !== val) {
          write = true;
          writeCSS[key] = css[key];
        }
      }
      if (write) {
        return defer(function() {
          return extend(_this.element.style, writeCSS);
        });
      }
    };

    return _Tether;

  })();

  Tether.position = position;

  this.Tether = extend(_Tether, Tether);

}).call(this);

(function() {
  var BOUNDS_FORMAT, MIRROR_ATTACH, defer, extend, getBoundingRect, getBounds, getOuterSize, getSize, updateClasses, _ref,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  _ref = this.Tether.Utils, getOuterSize = _ref.getOuterSize, getBounds = _ref.getBounds, getSize = _ref.getSize, extend = _ref.extend, updateClasses = _ref.updateClasses, defer = _ref.defer;

  MIRROR_ATTACH = {
    left: 'right',
    right: 'left',
    top: 'bottom',
    bottom: 'top',
    middle: 'middle'
  };

  BOUNDS_FORMAT = ['left', 'top', 'right', 'bottom'];

  getBoundingRect = function(tether, to) {
    var i, pos, side, size, style, _i, _len;
    if (to === 'scrollParent') {
      to = tether.scrollParent;
    } else if (to === 'window') {
      to = [pageXOffset, pageYOffset, innerWidth + pageXOffset, innerHeight + pageYOffset];
    }
    if (to === document) {
      to = to.documentElement;
    }
    if (to.nodeType != null) {
      pos = size = getBounds(to);
      style = getComputedStyle(to);
      to = [pos.left, pos.top, size.width + pos.left, size.height + pos.top];
      for (i = _i = 0, _len = BOUNDS_FORMAT.length; _i < _len; i = ++_i) {
        side = BOUNDS_FORMAT[i];
        side = side[0].toUpperCase() + side.substr(1);
        if (side === 'Top' || side === 'Left') {
          to[i] += parseFloat(style["border" + side + "Width"]);
        } else {
          to[i] -= parseFloat(style["border" + side + "Width"]);
        }
      }
    }
    return to;
  };

  this.Tether.modules.push({
    position: function(_arg) {
      var addClasses, allClasses, attachment, bounds, changeAttachX, changeAttachY, cls, constraint, eAttachment, height, left, oob, oobClass, p, pin, pinned, pinnedClass, removeClass, side, tAttachment, targetAttachment, targetHeight, targetSize, targetWidth, to, top, width, _i, _j, _k, _l, _len, _len1, _len2, _len3, _len4, _len5, _m, _n, _ref1, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8,
        _this = this;
      top = _arg.top, left = _arg.left, targetAttachment = _arg.targetAttachment;
      if (!this.options.constraints) {
        return true;
      }
      removeClass = function(prefix) {
        var side, _i, _len, _results;
        _this.removeClass(prefix);
        _results = [];
        for (_i = 0, _len = BOUNDS_FORMAT.length; _i < _len; _i++) {
          side = BOUNDS_FORMAT[_i];
          _results.push(_this.removeClass("" + prefix + "-" + side));
        }
        return _results;
      };
      _ref1 = this.cache('element-bounds', function() {
        return getBounds(_this.element);
      }), height = _ref1.height, width = _ref1.width;
      if (width === 0 && height === 0 && (this.lastSize != null)) {
        _ref2 = this.lastSize, width = _ref2.width, height = _ref2.height;
      }
      targetSize = this.cache('target-bounds', function() {
        return _this.getTargetBounds();
      });
      targetHeight = targetSize.height;
      targetWidth = targetSize.width;
      tAttachment = {};
      eAttachment = {};
      allClasses = [this.getClass('pinned'), this.getClass('out-of-bounds')];
      _ref3 = this.options.constraints;
      for (_i = 0, _len = _ref3.length; _i < _len; _i++) {
        constraint = _ref3[_i];
        if (constraint.outOfBoundsClass) {
          allClasses.push(constraint.outOfBoundsClass);
        }
        if (constraint.pinnedClass) {
          allClasses.push(constraint.pinnedClass);
        }
      }
      for (_j = 0, _len1 = allClasses.length; _j < _len1; _j++) {
        cls = allClasses[_j];
        _ref4 = ['left', 'top', 'right', 'bottom'];
        for (_k = 0, _len2 = _ref4.length; _k < _len2; _k++) {
          side = _ref4[_k];
          allClasses.push("" + cls + "-" + side);
        }
      }
      addClasses = [];
      tAttachment = extend({}, targetAttachment);
      eAttachment = extend({}, this.attachment);
      _ref5 = this.options.constraints;
      for (_l = 0, _len3 = _ref5.length; _l < _len3; _l++) {
        constraint = _ref5[_l];
        to = constraint.to, attachment = constraint.attachment, pin = constraint.pin;
        if (attachment == null) {
          attachment = '';
        }
        if (__indexOf.call(attachment, ' ') >= 0) {
          _ref6 = attachment.split(' '), changeAttachY = _ref6[0], changeAttachX = _ref6[1];
        } else {
          changeAttachX = changeAttachY = attachment;
        }
        bounds = getBoundingRect(this, to);
        if (changeAttachY === 'target' || changeAttachY === 'both') {
          if (top < bounds[1] && tAttachment.top === 'top') {
            top += targetHeight;
            tAttachment.top = 'bottom';
          }
          if (top + height > bounds[3] && tAttachment.top === 'bottom') {
            top -= targetHeight;
            tAttachment.top = 'top';
          }
        }
        if (changeAttachY === 'together') {
          if (top < bounds[1] && tAttachment.top === 'top') {
            if (eAttachment.top === 'bottom') {
              top += targetHeight;
              tAttachment.top = 'bottom';
              top += height;
              eAttachment.top = 'top';
            } else if (eAttachment.top === 'top') {
              top += targetHeight;
              tAttachment.top = 'bottom';
              top -= height;
              eAttachment.top = 'bottom';
            }
          }
          if (top + height > bounds[3] && tAttachment.top === 'bottom') {
            if (eAttachment.top === 'top') {
              top -= targetHeight;
              tAttachment.top = 'top';
              top -= height;
              eAttachment.top = 'bottom';
            } else if (eAttachment.top === 'bottom') {
              top -= targetHeight;
              tAttachment.top = 'top';
              top += height;
              eAttachment.top = 'top';
            }
          }
          if (tAttachment.top === 'middle') {
            if (top + height > bounds[3] && eAttachment.top === 'top') {
              top -= height;
              eAttachment.top = 'bottom';
            } else if (top < bounds[1] && eAttachment.top === 'bottom') {
              top += height;
              eAttachment.top = 'top';
            }
          }
        }
        if (changeAttachX === 'target' || changeAttachX === 'both') {
          if (left < bounds[0] && tAttachment.left === 'left') {
            left += targetWidth;
            tAttachment.left = 'right';
          }
          if (left + width > bounds[2] && tAttachment.left === 'right') {
            left -= targetWidth;
            tAttachment.left = 'left';
          }
        }
        if (changeAttachX === 'together') {
          if (left < bounds[0] && tAttachment.left === 'left') {
            if (eAttachment.left === 'right') {
              left += targetWidth;
              tAttachment.left = 'right';
              left += width;
              eAttachment.left = 'left';
            } else if (eAttachment.left === 'left') {
              left += targetWidth;
              tAttachment.left = 'right';
              left -= width;
              eAttachment.left = 'right';
            }
          } else if (left + width > bounds[2] && tAttachment.left === 'right') {
            if (eAttachment.left === 'left') {
              left -= targetWidth;
              tAttachment.left = 'left';
              left -= width;
              eAttachment.left = 'right';
            } else if (eAttachment.left === 'right') {
              left -= targetWidth;
              tAttachment.left = 'left';
              left += width;
              eAttachment.left = 'left';
            }
          } else if (tAttachment.left === 'center') {
            if (left + width > bounds[2] && eAttachment.left === 'left') {
              left -= width;
              eAttachment.left = 'right';
            } else if (left < bounds[0] && eAttachment.left === 'right') {
              left += width;
              eAttachment.left = 'left';
            }
          }
        }
        if (changeAttachY === 'element' || changeAttachY === 'both') {
          if (top < bounds[1] && eAttachment.top === 'bottom') {
            top += height;
            eAttachment.top = 'top';
          }
          if (top + height > bounds[3] && eAttachment.top === 'top') {
            top -= height;
            eAttachment.top = 'bottom';
          }
        }
        if (changeAttachX === 'element' || changeAttachX === 'both') {
          if (left < bounds[0] && eAttachment.left === 'right') {
            left += width;
            eAttachment.left = 'left';
          }
          if (left + width > bounds[2] && eAttachment.left === 'left') {
            left -= width;
            eAttachment.left = 'right';
          }
        }
        if (typeof pin === 'string') {
          pin = (function() {
            var _len4, _m, _ref7, _results;
            _ref7 = pin.split(',');
            _results = [];
            for (_m = 0, _len4 = _ref7.length; _m < _len4; _m++) {
              p = _ref7[_m];
              _results.push(p.trim());
            }
            return _results;
          })();
        } else if (pin === true) {
          pin = ['top', 'left', 'right', 'bottom'];
        }
        pin || (pin = []);
        pinned = [];
        oob = [];
        if (top < bounds[1]) {
          if (__indexOf.call(pin, 'top') >= 0) {
            top = bounds[1];
            pinned.push('top');
          } else {
            oob.push('top');
          }
        }
        if (top + height > bounds[3]) {
          if (__indexOf.call(pin, 'bottom') >= 0) {
            top = bounds[3] - height;
            pinned.push('bottom');
          } else {
            oob.push('bottom');
          }
        }
        if (left < bounds[0]) {
          if (__indexOf.call(pin, 'left') >= 0) {
            left = bounds[0];
            pinned.push('left');
          } else {
            oob.push('left');
          }
        }
        if (left + width > bounds[2]) {
          if (__indexOf.call(pin, 'right') >= 0) {
            left = bounds[2] - width;
            pinned.push('right');
          } else {
            oob.push('right');
          }
        }
        if (pinned.length) {
          pinnedClass = (_ref7 = this.options.pinnedClass) != null ? _ref7 : this.getClass('pinned');
          addClasses.push(pinnedClass);
          for (_m = 0, _len4 = pinned.length; _m < _len4; _m++) {
            side = pinned[_m];
            addClasses.push("" + pinnedClass + "-" + side);
          }
        }
        if (oob.length) {
          oobClass = (_ref8 = this.options.outOfBoundsClass) != null ? _ref8 : this.getClass('out-of-bounds');
          addClasses.push(oobClass);
          for (_n = 0, _len5 = oob.length; _n < _len5; _n++) {
            side = oob[_n];
            addClasses.push("" + oobClass + "-" + side);
          }
        }
        if (__indexOf.call(pinned, 'left') >= 0 || __indexOf.call(pinned, 'right') >= 0) {
          eAttachment.left = tAttachment.left = false;
        }
        if (__indexOf.call(pinned, 'top') >= 0 || __indexOf.call(pinned, 'bottom') >= 0) {
          eAttachment.top = tAttachment.top = false;
        }
        if (tAttachment.top !== targetAttachment.top || tAttachment.left !== targetAttachment.left || eAttachment.top !== this.attachment.top || eAttachment.left !== this.attachment.left) {
          this.updateAttachClasses(eAttachment, tAttachment);
        }
      }
      defer(function() {
        updateClasses(_this.target, addClasses, allClasses);
        return updateClasses(_this.element, addClasses, allClasses);
      });
      return {
        top: top,
        left: left
      };
    }
  });

}).call(this);

(function() {
  var defer, getBounds, updateClasses, _ref;

  _ref = this.Tether.Utils, getBounds = _ref.getBounds, updateClasses = _ref.updateClasses, defer = _ref.defer;

  this.Tether.modules.push({
    position: function(_arg) {
      var abutted, addClasses, allClasses, bottom, height, left, right, side, sides, targetPos, top, width, _i, _j, _k, _l, _len, _len1, _len2, _len3, _ref1, _ref2, _ref3, _ref4, _ref5,
        _this = this;
      top = _arg.top, left = _arg.left;
      _ref1 = this.cache('element-bounds', function() {
        return getBounds(_this.element);
      }), height = _ref1.height, width = _ref1.width;
      targetPos = this.getTargetBounds();
      bottom = top + height;
      right = left + width;
      abutted = [];
      if (top <= targetPos.bottom && bottom >= targetPos.top) {
        _ref2 = ['left', 'right'];
        for (_i = 0, _len = _ref2.length; _i < _len; _i++) {
          side = _ref2[_i];
          if ((_ref3 = targetPos[side]) === left || _ref3 === right) {
            abutted.push(side);
          }
        }
      }
      if (left <= targetPos.right && right >= targetPos.left) {
        _ref4 = ['top', 'bottom'];
        for (_j = 0, _len1 = _ref4.length; _j < _len1; _j++) {
          side = _ref4[_j];
          if ((_ref5 = targetPos[side]) === top || _ref5 === bottom) {
            abutted.push(side);
          }
        }
      }
      allClasses = [];
      addClasses = [];
      sides = ['left', 'top', 'right', 'bottom'];
      allClasses.push(this.getClass('abutted'));
      for (_k = 0, _len2 = sides.length; _k < _len2; _k++) {
        side = sides[_k];
        allClasses.push("" + (this.getClass('abutted')) + "-" + side);
      }
      if (abutted.length) {
        addClasses.push(this.getClass('abutted'));
      }
      for (_l = 0, _len3 = abutted.length; _l < _len3; _l++) {
        side = abutted[_l];
        addClasses.push("" + (this.getClass('abutted')) + "-" + side);
      }
      defer(function() {
        updateClasses(_this.target, addClasses, allClasses);
        return updateClasses(_this.element, addClasses, allClasses);
      });
      return true;
    }
  });

}).call(this);

(function() {
  this.Tether.modules.push({
    position: function(_arg) {
      var left, result, shift, shiftLeft, shiftTop, top, _ref;
      top = _arg.top, left = _arg.left;
      if (!this.options.shift) {
        return;
      }
      result = function(val) {
        if (typeof val === 'function') {
          return val.call(this, {
            top: top,
            left: left
          });
        } else {
          return val;
        }
      };
      shift = result(this.options.shift);
      if (typeof shift === 'string') {
        shift = shift.split(' ');
        shift[1] || (shift[1] = shift[0]);
        shiftTop = shift[0], shiftLeft = shift[1];
        shiftTop = parseFloat(shiftTop, 10);
        shiftLeft = parseFloat(shiftLeft, 10);
      } else {
        _ref = [shift.top, shift.left], shiftTop = _ref[0], shiftLeft = _ref[1];
      }
      top += shiftTop;
      left += shiftLeft;
      return {
        top: top,
        left: left
      };
    }
  });

}).call(this);

return this.Tether;

}));

/**
 * Backbone Forms v0.12.0
 *
 * NOTE:
 * This version is for use with RequireJS
 * If using regular <script> tags to include your files, use backbone-forms.min.js
 *
 * Copyright (c) 2013 Charles Davison, Pow Media Ltd
 * 
 * License and more information at:
 * http://github.com/powmedia/backbone-forms
 */
define('libs/backbone-forms',['cdn.jquery', 'cdn.underscore', 'cdn.backbone'], function($, _, Backbone) {

  
//==================================================================================================
//FORM
//==================================================================================================

var Form = Backbone.View.extend({

  /**
   * Constructor
   * 
   * @param {Object} [options.schema]
   * @param {Backbone.Model} [options.model]
   * @param {Object} [options.data]
   * @param {String[]|Object[]} [options.fieldsets]
   * @param {String[]} [options.fields]
   * @param {String} [options.idPrefix]
   * @param {Form.Field} [options.Field]
   * @param {Form.Fieldset} [options.Fieldset]
   * @param {Function} [options.template]
   */
  initialize: function(options) {
    var self = this;

    options = options || {};

    //Find the schema to use
    var schema = this.schema = (function() {
      //Prefer schema from options
      if (options.schema) return _.result(options, 'schema');

      //Then schema on model
      var model = options.model;
      if (model && model.schema) {
        return (_.isFunction(model.schema)) ? model.schema() : model.schema;
      }

      //Then built-in schema
      if (self.schema) {
        return (_.isFunction(self.schema)) ? self.schema() : self.schema;
      }

      //Fallback to empty schema
      return {};
    })();

    //Store important data
    _.extend(this, _.pick(options, 'model', 'data', 'idPrefix'));

    //Override defaults
    var constructor = this.constructor;
    this.template = options.template || constructor.template;
    this.Fieldset = options.Fieldset || constructor.Fieldset;
    this.Field = options.Field || constructor.Field;
    this.NestedField = options.NestedField || constructor.NestedField;

    //Check which fields will be included (defaults to all)
    var selectedFields = this.selectedFields = options.fields || _.keys(schema);

    //Create fields
    var fields = this.fields = {};

    _.each(selectedFields, function(key) {
      var fieldSchema = schema[key];
      fields[key] = this.createField(key, fieldSchema);
    }, this);

    //Create fieldsets
    var fieldsetSchema = options.fieldsets || [selectedFields],
        fieldsets = this.fieldsets = [];

    _.each(fieldsetSchema, function(itemSchema) {
      this.fieldsets.push(this.createFieldset(itemSchema));
    }, this);
  },

  /**
   * Creates a Fieldset instance
   *
   * @param {String[]|Object[]} schema       Fieldset schema
   *
   * @return {Form.Fieldset}
   */
  createFieldset: function(schema) {
    var options = {
      schema: schema,
      fields: this.fields
    };

    return new this.Fieldset(options);
  },

  /**
   * Creates a Field instance
   *
   * @param {String} key
   * @param {Object} schema       Field schema
   *
   * @return {Form.Field}
   */
  createField: function(key, schema) {
    var options = {
      form: this,
      key: key,
      schema: schema,
      idPrefix: this.idPrefix
    };

    if (this.model) {
      options.model = this.model;
    } else if (this.data) {
      options.value = this.data[key];
    } else {
      options.value = null;
    }

    var field = new this.Field(options);

    this.listenTo(field.editor, 'all', this.handleEditorEvent);

    return field;
  },

  /**
   * Callback for when an editor event is fired.
   * Re-triggers events on the form as key:event and triggers additional form-level events
   *
   * @param {String} event
   * @param {Editor} editor
   */
  handleEditorEvent: function(event, editor) {
    //Re-trigger editor events on the form
    var formEvent = editor.key+':'+event;

    this.trigger.call(this, formEvent, this, editor);

    //Trigger additional events
    switch (event) {
      case 'change':
        this.trigger('change', this);
        break;

      case 'focus':
        if (!this.hasFocus) this.trigger('focus', this);
        break;

      case 'blur':
        if (this.hasFocus) {
          //TODO: Is the timeout etc needed?
          var self = this;
          setTimeout(function() {
            var focusedField = _.find(self.fields, function(field) {
              return field.editor.hasFocus;
            });

            if (!focusedField) self.trigger('blur', self);
          }, 0);
        }
        break;
    }
  },

  render: function() {
    var self = this,
        fields = this.fields;

    //Render form
    var $form = $($.trim(this.template(_.result(this, 'templateData'))));

    //Render standalone editors
    $form.find('[data-editors]').add($form).each(function(i, el) {
      var $container = $(el),
          selection = $container.attr('data-editors');

      if (_.isUndefined(selection)) return;

      //Work out which fields to include
      var keys = (selection == '*')
        ? self.selectedFields || _.keys(fields)
        : selection.split(',');

      //Add them
      _.each(keys, function(key) {
        var field = fields[key];

        $container.append(field.editor.render().el);
      });
    });

    //Render standalone fields
    $form.find('[data-fields]').add($form).each(function(i, el) {
      var $container = $(el),
          selection = $container.attr('data-fields');

      if (_.isUndefined(selection)) return;

      //Work out which fields to include
      var keys = (selection == '*')
        ? self.selectedFields || _.keys(fields)
        : selection.split(',');

      //Add them
      _.each(keys, function(key) {
        var field = fields[key];

        $container.append(field.render().el);
      });
    });

    //Render fieldsets
    $form.find('[data-fieldsets]').add($form).each(function(i, el) {
      var $container = $(el),
          selection = $container.attr('data-fieldsets');

      if (_.isUndefined(selection)) return;

      _.each(self.fieldsets, function(fieldset) {
        $container.append(fieldset.render().el);
      });
    });

    //Set the main element
    this.setElement($form);

    return this;
  },

  /**
   * Validate the data
   *
   * @return {Object}       Validation errors
   */
  validate: function() {
    var self = this,
        fields = this.fields,
        model = this.model,
        errors = {};

    //Collect errors from schema validation
    _.each(fields, function(field) {
      var error = field.validate();
      if (error) {
        errors[field.key] = error;
      }
    });

    //Get errors from default Backbone model validator
    if (model && model.validate) {
      var modelErrors = model.validate(this.getValue());

      if (modelErrors) {
        var isDictionary = _.isObject(modelErrors) && !_.isArray(modelErrors);

        //If errors are not in object form then just store on the error object
        if (!isDictionary) {
          errors._others = errors._others || [];
          errors._others.push(modelErrors);
        }

        //Merge programmatic errors (requires model.validate() to return an object e.g. { fieldKey: 'error' })
        if (isDictionary) {
          _.each(modelErrors, function(val, key) {
            //Set error on field if there isn't one already
            if (fields[key] && !errors[key]) {
              fields[key].setError(val);
              errors[key] = val;
            }

            else {
              //Otherwise add to '_others' key
              errors._others = errors._others || [];
              var tmpErr = {};
              tmpErr[key] = val;
              errors._others.push(tmpErr);
            }
          });
        }
      }
    }

    return _.isEmpty(errors) ? null : errors;
  },

  /**
   * Update the model with all latest values.
   *
   * @param {Object} [options]  Options to pass to Model#set (e.g. { silent: true })
   *
   * @return {Object}  Validation errors
   */
  commit: function(options) {
    //Validate
    var errors = this.validate();
    if (errors) return errors;

    //Commit
    var modelError;

    var setOptions = _.extend({
      error: function(model, e) {
        modelError = e;
      }
    }, options);

    this.model.set(this.getValue(), setOptions);
    
    if (modelError) return modelError;
  },

  /**
   * Get all the field values as an object.
   * Use this method when passing data instead of objects
   *
   * @param {String} [key]    Specific field value to get
   */
  getValue: function(key) {
    //Return only given key if specified
    if (key) return this.fields[key].getValue();

    //Otherwise return entire form
    var values = {};
    _.each(this.fields, function(field) {
      values[field.key] = field.getValue();
    });

    return values;
  },

  /**
   * Update field values, referenced by key
   *
   * @param {Object|String} key     New values to set, or property to set
   * @param val                     Value to set
   */
  setValue: function(prop, val) {
    var data = {};
    if (typeof prop === 'string') {
      data[prop] = val;
    } else {
      data = prop;
    }

    var key;
    for (key in this.schema) {
      if (data[key] !== undefined) {
        this.fields[key].setValue(data[key]);
      }
    }
  },

  /**
   * Returns the editor for a given field key
   *
   * @param {String} key
   *
   * @return {Editor}
   */
  getEditor: function(key) {
    var field = this.fields[key];
    if (!field) throw 'Field not found: '+key;

    return field.editor;
  },

  /**
   * Gives the first editor in the form focus
   */
  focus: function() {
    if (this.hasFocus) return;

    //Get the first field
    var fieldset = this.fieldsets[0],
        field = fieldset.getFieldAt(0);

    if (!field) return;

    //Set focus
    field.editor.focus();
  },

  /**
   * Removes focus from the currently focused editor
   */
  blur: function() {
    if (!this.hasFocus) return;

    var focusedField = _.find(this.fields, function(field) {
      return field.editor.hasFocus;
    });

    if (focusedField) focusedField.editor.blur();
  },

  /**
   * Manages the hasFocus property
   *
   * @param {String} event
   */
  trigger: function(event) {
    if (event === 'focus') {
      this.hasFocus = true;
    }
    else if (event === 'blur') {
      this.hasFocus = false;
    }

    return Backbone.View.prototype.trigger.apply(this, arguments);
  },

  /**
   * Override default remove function in order to remove embedded views
   *
   * TODO: If editors are included directly with data-editors="x", they need to be removed
   * May be best to use XView to manage adding/removing views
   */
  remove: function() {
    _.each(this.fieldsets, function(fieldset) {
      fieldset.remove();
    });

    _.each(this.fields, function(field) {
      field.remove();
    });

    Backbone.View.prototype.remove.call(this);
  }

}, {

  //STATICS
  template: _.template('\
    <form data-fieldsets></form>\
  ', null, this.templateSettings),

  templateSettings: {
    evaluate: /<%([\s\S]+?)%>/g, 
    interpolate: /<%=([\s\S]+?)%>/g, 
    escape: /<%-([\s\S]+?)%>/g
  },

  editors: {}

});

  
//==================================================================================================
//VALIDATORS
//==================================================================================================

Form.validators = (function() {

  var validators = {};

  validators.errMessages = {
    required: 'Required',
    regexp: 'Invalid',
    email: 'Invalid email address',
    url: 'Invalid URL',
    match: _.template('Must match field "<%= field %>"', null, Form.templateSettings)
  };
  
  validators.required = function(options) {
    options = _.extend({
      type: 'required',
      message: this.errMessages.required
    }, options);
     
    return function required(value) {
      options.value = value;
      
      var err = {
        type: options.type,
        message: _.isFunction(options.message) ? options.message(options) : options.message
      };
      
      if (value === null || value === undefined || value === false || value === '') return err;
    };
  };
  
  validators.regexp = function(options) {
    if (!options.regexp) throw new Error('Missing required "regexp" option for "regexp" validator');
  
    options = _.extend({
      type: 'regexp',
      message: this.errMessages.regexp
    }, options);
    
    return function regexp(value) {
      options.value = value;
      
      var err = {
        type: options.type,
        message: _.isFunction(options.message) ? options.message(options) : options.message
      };
      
      //Don't check empty values (add a 'required' validator for this)
      if (value === null || value === undefined || value === '') return;

      if (!options.regexp.test(value)) return err;
    };
  };
  
  validators.email = function(options) {
    options = _.extend({
      type: 'email',
      message: this.errMessages.email,
      regexp: /^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/
    }, options);
    
    return validators.regexp(options);
  };
  
  validators.url = function(options) {
    options = _.extend({
      type: 'url',
      message: this.errMessages.url,
      regexp: /^(http|https):\/\/(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i
    }, options);
    
    return validators.regexp(options);
  };
  
  validators.match = function(options) {
    if (!options.field) throw new Error('Missing required "field" options for "match" validator');
    
    options = _.extend({
      type: 'match',
      message: this.errMessages.match
    }, options);
    
    return function match(value, attrs) {
      options.value = value;
      
      var err = {
        type: options.type,
        message: _.isFunction(options.message) ? options.message(options) : options.message
      };
      
      //Don't check empty values (add a 'required' validator for this)
      if (value === null || value === undefined || value === '') return;
      
      if (value !== attrs[options.field]) return err;
    };
  };


  return validators;

})();


//==================================================================================================
//FIELDSET
//==================================================================================================

Form.Fieldset = Backbone.View.extend({

  /**
   * Constructor
   *
   * Valid fieldset schemas:
   *   ['field1', 'field2']
   *   { legend: 'Some Fieldset', fields: ['field1', 'field2'] }
   *
   * @param {String[]|Object[]} options.schema      Fieldset schema
   * @param {Object} options.fields           Form fields
   */
  initialize: function(options) {
    options = options || {};

    //Create the full fieldset schema, merging defaults etc.
    var schema = this.schema = this.createSchema(options.schema);

    //Store the fields for this fieldset
    this.fields = _.pick(options.fields, schema.fields);
    
    //Override defaults
    this.template = options.template || this.constructor.template;
  },

  /**
   * Creates the full fieldset schema, normalising, merging defaults etc.
   *
   * @param {String[]|Object[]} schema
   *
   * @return {Object}
   */
  createSchema: function(schema) {
    //Normalise to object
    if (_.isArray(schema)) {
      schema = { fields: schema };
    }

    //Add null legend to prevent template error
    schema.legend = schema.legend || null;

    return schema;
  },

  /**
   * Returns the field for a given index
   *
   * @param {Number} index
   *
   * @return {Field}
   */
  getFieldAt: function(index) {
    var key = this.schema.fields[index];

    return this.fields[key];
  },

  /**
   * Returns data to pass to template
   *
   * @return {Object}
   */
  templateData: function() {
    return this.schema;
  },

  /**
   * Renders the fieldset and fields
   *
   * @return {Fieldset} this
   */
  render: function() {
    var schema = this.schema,
        fields = this.fields;

    //Render fieldset
    var $fieldset = $($.trim(this.template(_.result(this, 'templateData'))));

    //Render fields
    $fieldset.find('[data-fields]').add($fieldset).each(function(i, el) {
      var $container = $(el),
          selection = $container.attr('data-fields');

      if (_.isUndefined(selection)) return;

      _.each(fields, function(field) {
        $container.append(field.render().el);
      });
    });

    this.setElement($fieldset);

    return this;
  },

  /**
   * Remove embedded views then self
   */
  remove: function() {
    _.each(this.fields, function(field) {
      field.remove();
    });

    Backbone.View.prototype.remove.call(this);
  }
  
}, {
  //STATICS

  template: _.template('\
    <fieldset data-fields>\
      <% if (legend) { %>\
        <legend><%= legend %></legend>\
      <% } %>\
    </fieldset>\
  ', null, Form.templateSettings)

});


//==================================================================================================
//FIELD
//==================================================================================================

Form.Field = Backbone.View.extend({

  /**
   * Constructor
   * 
   * @param {Object} options.key
   * @param {Object} options.form
   * @param {Object} [options.schema]
   * @param {Function} [options.schema.template]
   * @param {Backbone.Model} [options.model]
   * @param {Object} [options.value]
   * @param {String} [options.idPrefix]
   * @param {Function} [options.template]
   * @param {Function} [options.errorClassName]
   */
  initialize: function(options) {
    options = options || {};

    //Store important data
    _.extend(this, _.pick(options, 'form', 'key', 'model', 'value', 'idPrefix'));

    //Create the full field schema, merging defaults etc.
    var schema = this.schema = this.createSchema(options.schema);

    //Override defaults
    this.template = options.template || schema.template || this.constructor.template;
    this.errorClassName = options.errorClassName || this.constructor.errorClassName;

    //Create editor
    this.editor = this.createEditor();
  },

  /**
   * Creates the full field schema, merging defaults etc.
   *
   * @param {Object|String} schema
   *
   * @return {Object}
   */
  createSchema: function(schema) {
    if (_.isString(schema)) schema = { type: schema };

    //Set defaults
    schema = _.extend({
      type: 'Text',
      title: this.createTitle()
    }, schema);

    //Get the real constructor function i.e. if type is a string such as 'Text'
    schema.type = (_.isString(schema.type)) ? Form.editors[schema.type] : schema.type;

    return schema;
  },

  /**
   * Creates the editor specified in the schema; either an editor string name or
   * a constructor function
   *
   * @return {View}
   */
  createEditor: function() {
    var options = _.extend(
      _.pick(this, 'schema', 'form', 'key', 'model', 'value'),
      { id: this.createEditorId() }
    );

    var constructorFn = this.schema.type;

    return new constructorFn(options);
  },

  /**
   * Creates the ID that will be assigned to the editor
   *
   * @return {String}
   */
  createEditorId: function() {
    var prefix = this.idPrefix,
        id = this.key;

    //Replace periods with underscores (e.g. for when using paths)
    id = id.replace(/\./g, '_');

    //If a specific ID prefix is set, use it
    if (_.isString(prefix) || _.isNumber(prefix)) return prefix + id;
    if (_.isNull(prefix)) return id;

    //Otherwise, if there is a model use it's CID to avoid conflicts when multiple forms are on the page
    if (this.model) return this.model.cid + '_' + id;

    return id;
  },

  /**
   * Create the default field title (label text) from the key name.
   * (Converts 'camelCase' to 'Camel Case')
   *
   * @return {String}
   */
  createTitle: function() {
    var str = this.key;

    //Add spaces
    str = str.replace(/([A-Z])/g, ' $1');

    //Uppercase first character
    str = str.replace(/^./, function(str) { return str.toUpperCase(); });

    return str;
  },

  /**
   * Returns the data to be passed to the template
   *
   * @return {Object}
   */
  templateData: function() {
    var schema = this.schema;

    return {
      help: schema.help || '',
      title: schema.title,
      fieldAttrs: schema.fieldAttrs,
      editorAttrs: schema.editorAttrs,
      key: this.key,
      editorId: this.editor.id
    };
  },

  /**
   * Render the field and editor
   *
   * @return {Field} self
   */
  render: function() {
    var schema = this.schema,
        editor = this.editor;

    //Render field
    var $field = $($.trim(this.template(_.result(this, 'templateData'))));

    if (schema.fieldClass) $field.addClass(schema.fieldClass);
    if (schema.fieldAttrs) $field.attr(schema.fieldAttrs);

    //Render editor
    $field.find('[data-editor]').add($field).each(function(i, el) {
      var $container = $(el),
          selection = $container.attr('data-editor');

      if (_.isUndefined(selection)) return;

      $container.append(editor.render().el);
    });

    this.setElement($field);

    return this;
  },

  /**
   * Check the validity of the field
   *
   * @return {String}
   */
  validate: function() {
    var error = this.editor.validate();

    if (error) {
      this.setError(error.message);
    } else {
      this.clearError();
    }

    return error;
  },

  /**
   * Set the field into an error state, adding the error class and setting the error message
   *
   * @param {String} msg     Error message
   */
  setError: function(msg) {
    //Nested form editors (e.g. Object) set their errors internally
    if (this.editor.hasNestedForm) return;

    //Add error CSS class
    this.$el.addClass(this.errorClassName);

    //Set error message
    this.$('[data-error]').html(msg);
  },

  /**
   * Clear the error state and reset the help message
   */
  clearError: function() {
    //Remove error CSS class
    this.$el.removeClass(this.errorClassName);

    //Clear error message
    this.$('[data-error]').empty();
  },

  /**
   * Update the model with the new value from the editor
   *
   * @return {Mixed}
   */
  commit: function() {
    return this.editor.commit();
  },

  /**
   * Get the value from the editor
   *
   * @return {Mixed}
   */
  getValue: function() {
    return this.editor.getValue();
  },

  /**
   * Set/change the value of the editor
   *
   * @param {Mixed} value
   */
  setValue: function(value) {
    this.editor.setValue(value);
  },

  /**
   * Give the editor focus
   */
  focus: function() {
    this.editor.focus();
  },

  /**
   * Remove focus from the editor
   */
  blur: function() {
    this.editor.blur();
  },

  /**
   * Remove the field and editor views
   */
  remove: function() {
    this.editor.remove();

    Backbone.View.prototype.remove.call(this);
  }

}, {
  //STATICS

  template: _.template('\
    <div>\
      <label for="<%= editorId %>"><%= title %></label>\
      <div>\
        <span data-editor></span>\
        <div data-error></div>\
        <div><%= help %></div>\
      </div>\
    </div>\
  ', null, Form.templateSettings),

  /**
   * CSS class name added to the field when there is a validation error
   */
  errorClassName: 'error'

});


//==================================================================================================
//NESTEDFIELD
//==================================================================================================

Form.NestedField = Form.Field.extend({

  template: _.template($.trim('\
    <div>\
      <span data-editor></span>\
      <% if (help) { %>\
        <div><%= help %></div>\
      <% } %>\
      <div data-error></div>\
    </div>\
  '), null, Form.templateSettings)

});

/**
 * Base editor (interface). To be extended, not used directly
 *
 * @param {Object} options
 * @param {String} [options.id]         Editor ID
 * @param {Model} [options.model]       Use instead of value, and use commit()
 * @param {String} [options.key]        The model attribute key. Required when using 'model'
 * @param {Mixed} [options.value]       When not using a model. If neither provided, defaultValue will be used
 * @param {Object} [options.schema]     Field schema; may be required by some editors
 * @param {Object} [options.validators] Validators; falls back to those stored on schema
 * @param {Object} [options.form]       The form
 */
Form.Editor = Form.editors.Base = Backbone.View.extend({

  defaultValue: null,

  hasFocus: false,

  initialize: function(options) {
    var options = options || {};

    //Set initial value
    if (options.model) {
      if (!options.key) throw "Missing option: 'key'";

      this.model = options.model;

      this.value = this.model.get(options.key);
    }
    else if (options.value) {
      this.value = options.value;
    }

    if (this.value === undefined) this.value = this.defaultValue;

    //Store important data
    _.extend(this, _.pick(options, 'key', 'form'));

    var schema = this.schema = options.schema || {};

    this.validators = options.validators || schema.validators;

    //Main attributes
    this.$el.attr('id', this.id);
    this.$el.attr('name', this.getName());
    if (schema.editorClass) this.$el.addClass(schema.editorClass);
    if (schema.editorAttrs) this.$el.attr(schema.editorAttrs);
  },

  /**
   * Get the value for the form input 'name' attribute
   *
   * @return {String}
   *
   * @api private
   */
  getName: function() {
    var key = this.key || '';

    //Replace periods with underscores (e.g. for when using paths)
    return key.replace(/\./g, '_');
  },

  /**
   * Get editor value
   * Extend and override this method to reflect changes in the DOM
   *
   * @return {Mixed}
   */
  getValue: function() {
    return this.value;
  },

  /**
   * Set editor value
   * Extend and override this method to reflect changes in the DOM
   *
   * @param {Mixed} value
   */
  setValue: function(value) {
    this.value = value;
  },

  /**
   * Give the editor focus
   * Extend and override this method
   */
  focus: function() {
    throw 'Not implemented';
  },
  
  /**
   * Remove focus from the editor
   * Extend and override this method
   */
  blur: function() {
    throw 'Not implemented';
  },

  /**
   * Update the model with the current value
   *
   * @param {Object} [options]              Options to pass to model.set()
   * @param {Boolean} [options.validate]    Set to true to trigger built-in model validation
   *
   * @return {Mixed} error
   */
  commit: function(options) {
    var error = this.validate();
    if (error) return error;

    this.listenTo(this.model, 'invalid', function(model, e) {
      error = e;
    });
    this.model.set(this.key, this.getValue(), options);

    if (error) return error;
  },

  /**
   * Check validity
   *
   * @return {Object|Undefined}
   */
  validate: function() {
    var $el = this.$el,
        error = null,
        value = this.getValue(),
        formValues = this.form ? this.form.getValue() : {},
        validators = this.validators,
        getValidator = this.getValidator;

    if (validators) {
      //Run through validators until an error is found
      _.every(validators, function(validator) {
        error = getValidator(validator)(value, formValues);

        return error ? false : true;
      });
    }

    return error;
  },

  /**
   * Set this.hasFocus, or call parent trigger()
   *
   * @param {String} event
   */
  trigger: function(event) {
    if (event === 'focus') {
      this.hasFocus = true;
    }
    else if (event === 'blur') {
      this.hasFocus = false;
    }

    return Backbone.View.prototype.trigger.apply(this, arguments);
  },

  /**
   * Returns a validation function based on the type defined in the schema
   *
   * @param {RegExp|String|Function} validator
   * @return {Function}
   */
  getValidator: function(validator) {
    var validators = Form.validators;

    //Convert regular expressions to validators
    if (_.isRegExp(validator)) {
      return validators.regexp({ regexp: validator });
    }
    
    //Use a built-in validator if given a string
    if (_.isString(validator)) {
      if (!validators[validator]) throw new Error('Validator "'+validator+'" not found');
      
      return validators[validator]();
    }

    //Functions can be used directly
    if (_.isFunction(validator)) return validator;

    //Use a customised built-in validator if given an object
    if (_.isObject(validator) && validator.type) {
      var config = validator;
      
      return validators[config.type](config);
    }
    
    //Unkown validator type
    throw new Error('Invalid validator: ' + validator);
  }
});

/**
 * Text
 * 
 * Text input with focus, blur and change events
 */
Form.editors.Text = Form.Editor.extend({

  tagName: 'input',

  defaultValue: '',

  previousValue: '',

  events: {
    'keyup':    'determineChange',
    'keypress': function(event) {
      var self = this;
      setTimeout(function() {
        self.determineChange();
      }, 0);
    },
    'select':   function(event) {
      this.trigger('select', this);
    },
    'focus':    function(event) {
      this.trigger('focus', this);
    },
    'blur':     function(event) {
      this.trigger('blur', this);
    }
  },

  initialize: function(options) {
    Form.editors.Base.prototype.initialize.call(this, options);

    var schema = this.schema;

    //Allow customising text type (email, phone etc.) for HTML5 browsers
    var type = 'text';

    if (schema && schema.editorAttrs && schema.editorAttrs.type) type = schema.editorAttrs.type;
    if (schema && schema.dataType) type = schema.dataType;

    this.$el.attr('type', type);
  },

  /**
   * Adds the editor to the DOM
   */
  render: function() {
    this.setValue(this.value);

    return this;
  },

  determineChange: function(event) {
    var currentValue = this.$el.val();
    var changed = (currentValue !== this.previousValue);

    if (changed) {
      this.previousValue = currentValue;

      this.trigger('change', this);
    }
  },

  /**
   * Returns the current editor value
   * @return {String}
   */
  getValue: function() {
    return this.$el.val();
  },

  /**
   * Sets the value of the form element
   * @param {String}
   */
  setValue: function(value) {
    this.$el.val(value);
    this.previousValue = this.$el.val();
  },

  focus: function() {
    if (this.hasFocus) return;

    this.$el.focus();
  },

  blur: function() {
    if (!this.hasFocus) return;

    this.$el.blur();
  },

  select: function() {
    this.$el.select();
  }

});

/**
 * TextArea editor
 */
Form.editors.TextArea = Form.editors.Text.extend({

  tagName: 'textarea'

});

/**
 * Password editor
 */
Form.editors.Password = Form.editors.Text.extend({

  initialize: function(options) {
    Form.editors.Text.prototype.initialize.call(this, options);

    this.$el.attr('type', 'password');
  }

});

/**
 * NUMBER
 * 
 * Normal text input that only allows a number. Letters etc. are not entered.
 */
Form.editors.Number = Form.editors.Text.extend({

  defaultValue: 0,

  events: _.extend({}, Form.editors.Text.prototype.events, {
    'keypress': 'onKeyPress',
    'input':    'determineChange'
  }),

  initialize: function(options) {
    Form.editors.Text.prototype.initialize.call(this, options);

    this.$el.attr('type', 'number');
    this.$el.attr('step', 'any');
  },

  /**
   * Check value is numeric
   */
  onKeyPress: function(event) {
    var self = this,
        delayedDetermineChange = function() {
          setTimeout(function() {
            self.determineChange();
          }, 0);
        };

    //Allow backspace
    if (event.charCode === 0) {
      delayedDetermineChange();
      return;
    }

    //Get the whole new value so that we can prevent things like double decimals points etc.
    var newVal = this.$el.val() + String.fromCharCode(event.charCode);

    var numeric = /^-?[0-9]*\.?[0-9]*$/.test(newVal);

    if (numeric) {
      delayedDetermineChange();
    }
    else {
      event.preventDefault();
    }
  },

  getValue: function() {
    var value = this.$el.val();

    return value === "" ? null : parseFloat(value, 10);
  },

  setValue: function(value) {
    value = (function() {
      if (_.isNumber(value)) return value;

      if (_.isString(value) && value !== '') return parseFloat(value, 10);

      return null;
    })();

    if (_.isNaN(value)) value = null;

    Form.editors.Text.prototype.setValue.call(this, value);
  }

});

/**
 * Hidden editor
 */
Form.editors.Hidden = Form.editors.Base.extend({

  defaultValue: '',

  initialize: function(options) {
    Form.editors.Text.prototype.initialize.call(this, options);

    this.$el.attr('type', 'hidden');
  },

  focus: function() {

  },

  blur: function() {

  }

});

/**
 * Checkbox editor
 *
 * Creates a single checkbox, i.e. boolean value
 */
Form.editors.Checkbox = Form.editors.Base.extend({

  defaultValue: false,

  tagName: 'input',

  events: {
    'click':  function(event) {
      this.trigger('change', this);
    },
    'focus':  function(event) {
      this.trigger('focus', this);
    },
    'blur':   function(event) {
      this.trigger('blur', this);
    }
  },

  initialize: function(options) {
    Form.editors.Base.prototype.initialize.call(this, options);

    this.$el.attr('type', 'checkbox');
  },

  /**
   * Adds the editor to the DOM
   */
  render: function() {
    this.setValue(this.value);

    return this;
  },

  getValue: function() {
    return this.$el.prop('checked');
  },

  setValue: function(value) {
    if (value) {
      this.$el.prop('checked', true);
    }
  },

  focus: function() {
    if (this.hasFocus) return;

    this.$el.focus();
  },

  blur: function() {
    if (!this.hasFocus) return;

    this.$el.blur();
  }

});

/**
 * Select editor
 *
 * Renders a <select> with given options
 *
 * Requires an 'options' value on the schema.
 *  Can be an array of options, a function that calls back with the array of options, a string of HTML
 *  or a Backbone collection. If a collection, the models must implement a toString() method
 */
Form.editors.Select = Form.editors.Base.extend({

  tagName: 'select',

  events: {
    'change': function(event) {
      this.trigger('change', this);
    },
    'focus':  function(event) {
      this.trigger('focus', this);
    },
    'blur':   function(event) {
      this.trigger('blur', this);
    }
  },

  initialize: function(options) {
    Form.editors.Base.prototype.initialize.call(this, options);

    if (!this.schema || !this.schema.options) throw "Missing required 'schema.options'";
  },

  render: function() {
    this.setOptions(this.schema.options);

    return this;
  },

  /**
   * Sets the options that populate the <select>
   *
   * @param {Mixed} options
   */
  setOptions: function(options) {
    var self = this;

    //If a collection was passed, check if it needs fetching
    if (options instanceof Backbone.Collection) {
      var collection = options;

      //Don't do the fetch if it's already populated
      if (collection.length > 0) {
        this.renderOptions(options);
      } else {
        collection.fetch({
          success: function(collection) {
            self.renderOptions(options);
          }
        });
      }
    }

    //If a function was passed, run it to get the options
    else if (_.isFunction(options)) {
      options(function(result) {
        self.renderOptions(result);
      }, self);
    }

    //Otherwise, ready to go straight to renderOptions
    else {
      this.renderOptions(options);
    }
  },

  /**
   * Adds the <option> html to the DOM
   * @param {Mixed}   Options as a simple array e.g. ['option1', 'option2']
   *                      or as an array of objects e.g. [{val: 543, label: 'Title for object 543'}]
   *                      or as a string of <option> HTML to insert into the <select>
   */
  renderOptions: function(options) {
    var $select = this.$el,
        html;

    html = this._getOptionsHtml(options);

    //Insert options
    $select.html(html);

    //Select correct option
    this.setValue(this.value);
  },

  _getOptionsHtml: function(options) {
    var html;
    //Accept string of HTML
    if (_.isString(options)) {
      html = options;
    }

    //Or array
    else if (_.isArray(options)) {
      html = this._arrayToHtml(options);
    }

    //Or Backbone collection
    else if (options instanceof Backbone.Collection) {
      html = this._collectionToHtml(options);
    }

    else if (_.isFunction(options)) {
      var newOptions;
      
      options(function(opts) {
        newOptions = opts;
      }, this);
      
      html = this._getOptionsHtml(newOptions);
    }

    return html;
  },

  getValue: function() {
    return this.$el.val();
  },

  setValue: function(value) {
    this.$el.val(value);
  },

  focus: function() {
    if (this.hasFocus) return;

    this.$el.focus();
  },

  blur: function() {
    if (!this.hasFocus) return;

    this.$el.blur();
  },

  /**
   * Transforms a collection into HTML ready to use in the renderOptions method
   * @param {Backbone.Collection}
   * @return {String}
   */
  _collectionToHtml: function(collection) {
    //Convert collection to array first
    var array = [];
    collection.each(function(model) {
      array.push({ val: model.id, label: model.toString() });
    });

    //Now convert to HTML
    var html = this._arrayToHtml(array);

    return html;
  },

  /**
   * Create the <option> HTML
   * @param {Array}   Options as a simple array e.g. ['option1', 'option2']
   *                      or as an array of objects e.g. [{val: 543, label: 'Title for object 543'}]
   * @return {String} HTML
   */
  _arrayToHtml: function(array) {
    var html = [];

    //Generate HTML
    _.each(array, function(option) {
      if (_.isObject(option)) {
        if (option.group) {
          html.push('<optgroup label="'+option.group+'">');
          html.push(this._getOptionsHtml(option.options))
          html.push('</optgroup>');
        } else {
          var val = (option.val || option.val === 0) ? option.val : '';
          html.push('<option value="'+val+'">'+option.label+'</option>');
        }
      }
      else {
        html.push('<option>'+option+'</option>');
      }
    }, this);

    return html.join('');
  }

});

/**
 * Radio editor
 *
 * Renders a <ul> with given options represented as <li> objects containing radio buttons
 *
 * Requires an 'options' value on the schema.
 *  Can be an array of options, a function that calls back with the array of options, a string of HTML
 *  or a Backbone collection. If a collection, the models must implement a toString() method
 */
Form.editors.Radio = Form.editors.Select.extend({

  tagName: 'ul',

  events: {
    'change input[type=radio]': function() {
      this.trigger('change', this);
    },
    'focus input[type=radio]': function() {
      if (this.hasFocus) return;
      this.trigger('focus', this);
    },
    'blur input[type=radio]': function() {
      if (!this.hasFocus) return;
      var self = this;
      setTimeout(function() {
        if (self.$('input[type=radio]:focus')[0]) return;
        self.trigger('blur', self);
      }, 0);
    }
  },

  getValue: function() {
    return this.$('input[type=radio]:checked').val();
  },

  setValue: function(value) {
    this.$('input[type=radio]').val([value]);
  },

  focus: function() {
    if (this.hasFocus) return;

    var checked = this.$('input[type=radio]:checked');
    if (checked[0]) {
      checked.focus();
      return;
    }

    this.$('input[type=radio]').first().focus();
  },

  blur: function() {
    if (!this.hasFocus) return;

    this.$('input[type=radio]:focus').blur();
  },

  /**
   * Create the radio list HTML
   * @param {Array}   Options as a simple array e.g. ['option1', 'option2']
   *                      or as an array of objects e.g. [{val: 543, label: 'Title for object 543'}]
   * @return {String} HTML
   */
  _arrayToHtml: function (array) {
    var html = [];
    var self = this;

    _.each(array, function(option, index) {
      var itemHtml = '<li>';
      if (_.isObject(option)) {
        var val = (option.val || option.val === 0) ? option.val : '';
        itemHtml += ('<input type="radio" name="'+self.id+'" value="'+val+'" id="'+self.id+'-'+index+'" />');
        itemHtml += ('<label for="'+self.id+'-'+index+'">'+option.label+'</label>');
      }
      else {
        itemHtml += ('<input type="radio" name="'+self.id+'" value="'+option+'" id="'+self.id+'-'+index+'" />');
        itemHtml += ('<label for="'+self.id+'-'+index+'">'+option+'</label>');
      }
      itemHtml += '</li>';
      html.push(itemHtml);
    });

    return html.join('');
  }

});

/**
 * Checkboxes editor
 *
 * Renders a <ul> with given options represented as <li> objects containing checkboxes
 *
 * Requires an 'options' value on the schema.
 *  Can be an array of options, a function that calls back with the array of options, a string of HTML
 *  or a Backbone collection. If a collection, the models must implement a toString() method
 */
Form.editors.Checkboxes = Form.editors.Select.extend({

  tagName: 'ul',

  events: {
    'click input[type=checkbox]': function() {
      this.trigger('change', this);
    },
    'focus input[type=checkbox]': function() {
      if (this.hasFocus) return;
      this.trigger('focus', this);
    },
    'blur input[type=checkbox]':  function() {
      if (!this.hasFocus) return;
      var self = this;
      setTimeout(function() {
        if (self.$('input[type=checkbox]:focus')[0]) return;
        self.trigger('blur', self);
      }, 0);
    }
  },

  getValue: function() {
    var values = [];
    this.$('input[type=checkbox]:checked').each(function() {
      values.push($(this).val());
    });
    return values;
  },

  setValue: function(values) {
    if (!_.isArray(values)) values = [values];
    this.$('input[type=checkbox]').val(values);
  },

  focus: function() {
    if (this.hasFocus) return;

    this.$('input[type=checkbox]').first().focus();
  },

  blur: function() {
    if (!this.hasFocus) return;

    this.$('input[type=checkbox]:focus').blur();
  },

  /**
   * Create the checkbox list HTML
   * @param {Array}   Options as a simple array e.g. ['option1', 'option2']
   *                      or as an array of objects e.g. [{val: 543, label: 'Title for object 543'}]
   * @return {String} HTML
   */
  _arrayToHtml: function (array) {
    var html = [];
    var self = this;

    _.each(array, function(option, index) {
      var itemHtml = '<li>';
      if (_.isObject(option)) {
        var val = (option.val || option.val === 0) ? option.val : '';
        itemHtml += ('<input type="checkbox" name="'+self.id+'" value="'+val+'" id="'+self.id+'-'+index+'" />');
        itemHtml += ('<label for="'+self.id+'-'+index+'">'+option.label+'</label>');
      }
      else {
        itemHtml += ('<input type="checkbox" name="'+self.id+'" value="'+option+'" id="'+self.id+'-'+index+'" />');
        itemHtml += ('<label for="'+self.id+'-'+index+'">'+option+'</label>');
      }
      itemHtml += '</li>';
      html.push(itemHtml);
    });

    return html.join('');
  }

});

/**
 * Object editor
 *
 * Creates a child form. For editing Javascript objects
 *
 * @param {Object} options
 * @param {Form} options.form                 The form this editor belongs to; used to determine the constructor for the nested form
 * @param {Object} options.schema             The schema for the object
 * @param {Object} options.schema.subSchema   The schema for the nested form
 */
Form.editors.Object = Form.editors.Base.extend({
  //Prevent error classes being set on the main control; they are internally on the individual fields
  hasNestedForm: true,

  initialize: function(options) {
    //Set default value for the instance so it's not a shared object
    this.value = {};

    //Init
    Form.editors.Base.prototype.initialize.call(this, options);

    //Check required options
    if (!this.form) throw 'Missing required option "form"';
    if (!this.schema.subSchema) throw new Error("Missing required 'schema.subSchema' option for Object editor");
  },

  render: function() {
    //Get the constructor for creating the nested form; i.e. the same constructor as used by the parent form
    var NestedForm = this.form.constructor;

    //Create the nested form
    this.nestedForm = new NestedForm({
      schema: this.schema.subSchema,
      data: this.value,
      idPrefix: this.id + '_',
      Field: NestedForm.NestedField
    });

    this._observeFormEvents();

    this.$el.html(this.nestedForm.render().el);

    if (this.hasFocus) this.trigger('blur', this);

    return this;
  },

  getValue: function() {
    if (this.nestedForm) return this.nestedForm.getValue();

    return this.value;
  },

  setValue: function(value) {
    this.value = value;

    this.render();
  },

  focus: function() {
    if (this.hasFocus) return;

    this.nestedForm.focus();
  },

  blur: function() {
    if (!this.hasFocus) return;

    this.nestedForm.blur();
  },

  remove: function() {
    this.nestedForm.remove();

    Backbone.View.prototype.remove.call(this);
  },

  validate: function() {
    return this.nestedForm.validate();
  },

  _observeFormEvents: function() {
    if (!this.nestedForm) return;
    
    this.nestedForm.on('all', function() {
      // args = ["key:change", form, fieldEditor]
      var args = _.toArray(arguments);
      args[1] = this;
      // args = ["key:change", this=objectEditor, fieldEditor]

      this.trigger.apply(this, args);
    }, this);
  }

});

/**
 * NestedModel editor
 *
 * Creates a child form. For editing nested Backbone models
 *
 * Special options:
 *   schema.model:   Embedded model constructor
 */
Form.editors.NestedModel = Form.editors.Object.extend({
  initialize: function(options) {
    Form.editors.Base.prototype.initialize.call(this, options);

    if (!this.form) throw 'Missing required option "form"';
    if (!options.schema.model) throw 'Missing required "schema.model" option for NestedModel editor';
  },

  render: function() {
    //Get the constructor for creating the nested form; i.e. the same constructor as used by the parent form
    var NestedForm = this.form.constructor;

    var data = this.value || {},
        key = this.key,
        nestedModel = this.schema.model;

    //Wrap the data in a model if it isn't already a model instance
    var modelInstance = (data.constructor === nestedModel) ? data : new nestedModel(data);

    this.nestedForm = new NestedForm({
      model: modelInstance,
      idPrefix: this.id + '_',
      fieldTemplate: 'nestedField'
    });

    this._observeFormEvents();

    //Render form
    this.$el.html(this.nestedForm.render().el);

    if (this.hasFocus) this.trigger('blur', this);

    return this;
  },

  /**
   * Update the embedded model, checking for nested validation errors and pass them up
   * Then update the main model if all OK
   *
   * @return {Error|null} Validation error or null
   */
  commit: function() {
    var error = this.nestedForm.commit();
    if (error) {
      this.$el.addClass('error');
      return error;
    }

    return Form.editors.Object.prototype.commit.call(this);
  }

});

/**
 * Date editor
 *
 * Schema options
 * @param {Number|String} [options.schema.yearStart]  First year in list. Default: 100 years ago
 * @param {Number|String} [options.schema.yearEnd]    Last year in list. Default: current year
 *
 * Config options (if not set, defaults to options stored on the main Date class)
 * @param {Boolean} [options.showMonthNames]  Use month names instead of numbers. Default: true
 * @param {String[]} [options.monthNames]     Month names. Default: Full English names
 */
Form.editors.Date = Form.editors.Base.extend({

  events: {
    'change select':  function() {
      this.updateHidden();
      this.trigger('change', this);
    },
    'focus select':   function() {
      if (this.hasFocus) return;
      this.trigger('focus', this);
    },
    'blur select':    function() {
      if (!this.hasFocus) return;
      var self = this;
      setTimeout(function() {
        if (self.$('select:focus')[0]) return;
        self.trigger('blur', self);
      }, 0);
    }
  },

  initialize: function(options) {
    options = options || {};

    Form.editors.Base.prototype.initialize.call(this, options);

    var Self = Form.editors.Date,
        today = new Date();

    //Option defaults
    this.options = _.extend({
      monthNames: Self.monthNames,
      showMonthNames: Self.showMonthNames
    }, options);

    //Schema defaults
    this.schema = _.extend({
      yearStart: today.getFullYear() - 100,
      yearEnd: today.getFullYear()
    }, options.schema || {});

    //Cast to Date
    if (this.value && !_.isDate(this.value)) {
      this.value = new Date(this.value);
    }

    //Set default date
    if (!this.value) {
      var date = new Date();
      date.setSeconds(0);
      date.setMilliseconds(0);

      this.value = date;
    }

    //Template
    this.template = options.template || this.constructor.template;
  },

  render: function() {
    var options = this.options,
        schema = this.schema;

    var datesOptions = _.map(_.range(1, 32), function(date) {
      return '<option value="'+date+'">' + date + '</option>';
    });

    var monthsOptions = _.map(_.range(0, 12), function(month) {
      var value = (options.showMonthNames)
          ? options.monthNames[month]
          : (month + 1);

      return '<option value="'+month+'">' + value + '</option>';
    });

    var yearRange = (schema.yearStart < schema.yearEnd)
      ? _.range(schema.yearStart, schema.yearEnd + 1)
      : _.range(schema.yearStart, schema.yearEnd - 1, -1);

    var yearsOptions = _.map(yearRange, function(year) {
      return '<option value="'+year+'">' + year + '</option>';
    });

    //Render the selects
    var $el = $($.trim(this.template({
      dates: datesOptions.join(''),
      months: monthsOptions.join(''),
      years: yearsOptions.join('')
    })));

    //Store references to selects
    this.$date = $el.find('[data-type="date"]');
    this.$month = $el.find('[data-type="month"]');
    this.$year = $el.find('[data-type="year"]');

    //Create the hidden field to store values in case POSTed to server
    this.$hidden = $('<input type="hidden" name="'+this.key+'" />');
    $el.append(this.$hidden);

    //Set value on this and hidden field
    this.setValue(this.value);

    //Remove the wrapper tag
    this.setElement($el);
    this.$el.attr('id', this.id);
    this.$el.attr('name', this.getName());

    if (this.hasFocus) this.trigger('blur', this);

    return this;
  },

  /**
   * @return {Date}   Selected date
   */
  getValue: function() {
    var year = this.$year.val(),
        month = this.$month.val(),
        date = this.$date.val();

    if (!year || !month || !date) return null;

    return new Date(year, month, date);
  },

  /**
   * @param {Date} date
   */
  setValue: function(date) {
    this.$date.val(date.getDate());
    this.$month.val(date.getMonth());
    this.$year.val(date.getFullYear());

    this.updateHidden();
  },

  focus: function() {
    if (this.hasFocus) return;

    this.$('select').first().focus();
  },

  blur: function() {
    if (!this.hasFocus) return;

    this.$('select:focus').blur();
  },

  /**
   * Update the hidden input which is maintained for when submitting a form
   * via a normal browser POST
   */
  updateHidden: function() {
    var val = this.getValue();

    if (_.isDate(val)) val = val.toISOString();

    this.$hidden.val(val);
  }

}, {
  //STATICS
  template: _.template('\
    <div>\
      <select data-type="date"><%= dates %></select>\
      <select data-type="month"><%= months %></select>\
      <select data-type="year"><%= years %></select>\
    </div>\
  ', null, Form.templateSettings),

  //Whether to show month names instead of numbers
  showMonthNames: true,

  //Month names to use if showMonthNames is true
  //Replace for localisation, e.g. Form.editors.Date.monthNames = ['Janvier', 'Fevrier'...]
  monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
});

/**
 * DateTime editor
 *
 * @param {Editor} [options.DateEditor]           Date editor view to use (not definition)
 * @param {Number} [options.schema.minsInterval]  Interval between minutes. Default: 15
 */
Form.editors.DateTime = Form.editors.Base.extend({

  events: {
    'change select':  function() {
      this.updateHidden();
      this.trigger('change', this);
    },
    'focus select':   function() {
      if (this.hasFocus) return;
      this.trigger('focus', this);
    },
    'blur select':    function() {
      if (!this.hasFocus) return;
      var self = this;
      setTimeout(function() {
        if (self.$('select:focus')[0]) return;
        self.trigger('blur', self);
      }, 0);
    }
  },

  initialize: function(options) {
    options = options || {};

    Form.editors.Base.prototype.initialize.call(this, options);

    //Option defaults
    this.options = _.extend({
      DateEditor: Form.editors.DateTime.DateEditor
    }, options);

    //Schema defaults
    this.schema = _.extend({
      minsInterval: 15
    }, options.schema || {});

    //Create embedded date editor
    this.dateEditor = new this.options.DateEditor(options);

    this.value = this.dateEditor.value;

    //Template
    this.template = options.template || this.constructor.template;
  },

  render: function() {
    function pad(n) {
      return n < 10 ? '0' + n : n;
    }

    var schema = this.schema;

    //Create options
    var hoursOptions = _.map(_.range(0, 24), function(hour) {
      return '<option value="'+hour+'">' + pad(hour) + '</option>';
    });

    var minsOptions = _.map(_.range(0, 60, schema.minsInterval), function(min) {
      return '<option value="'+min+'">' + pad(min) + '</option>';
    });

    //Render time selects
    var $el = $($.trim(this.template({
      hours: hoursOptions.join(),
      mins: minsOptions.join()
    })));

    //Include the date editor
    $el.find('[data-date]').append(this.dateEditor.render().el);

    //Store references to selects
    this.$hour = $el.find('select[data-type="hour"]');
    this.$min = $el.find('select[data-type="min"]');

    //Get the hidden date field to store values in case POSTed to server
    this.$hidden = $el.find('input[type="hidden"]');

    //Set time
    this.setValue(this.value);

    this.setElement($el);
    this.$el.attr('id', this.id);
    this.$el.attr('name', this.getName());

    if (this.hasFocus) this.trigger('blur', this);

    return this;
  },

  /**
   * @return {Date}   Selected datetime
   */
  getValue: function() {
    var date = this.dateEditor.getValue();

    var hour = this.$hour.val(),
        min = this.$min.val();

    if (!date || !hour || !min) return null;

    date.setHours(hour);
    date.setMinutes(min);

    return date;
  },

  /**
   * @param {Date}
   */
  setValue: function(date) {
    if (!_.isDate(date)) date = new Date(date);

    this.dateEditor.setValue(date);

    this.$hour.val(date.getHours());
    this.$min.val(date.getMinutes());

    this.updateHidden();
  },

  focus: function() {
    if (this.hasFocus) return;

    this.$('select').first().focus();
  },

  blur: function() {
    if (!this.hasFocus) return;

    this.$('select:focus').blur();
  },

  /**
   * Update the hidden input which is maintained for when submitting a form
   * via a normal browser POST
   */
  updateHidden: function() {
    var val = this.getValue();
    if (_.isDate(val)) val = val.toISOString();

    this.$hidden.val(val);
  },

  /**
   * Remove the Date editor before removing self
   */
  remove: function() {
    this.dateEditor.remove();

    Form.editors.Base.prototype.remove.call(this);
  }

}, {
  //STATICS
  template: _.template('\
    <div class="bbf-datetime">\
      <div class="bbf-date-container" data-date></div>\
      <select data-type="hour"><%= hours %></select>\
      :\
      <select data-type="min"><%= mins %></select>\
    </div>\
  ', null, Form.templateSettings),

  //The date editor to use (constructor function, not instance)
  DateEditor: Form.editors.Date
});



  //Metadata
  Form.VERSION = '0.12.0';

  //Exports
  Backbone.Form = Form;

  return Form;
});


/*
Include this template file after backbone-forms.amd.js to override the default templates

'data-*' attributes control where elements are placed
 */

(function() {
  define('plugins/backbone-forms.bootstrap',["cdn.jquery", "cdn.underscore", "cdn.backbone", "libs/backbone-forms"], function($, _, Backbone) {
    var Form;
    Form = Backbone.Form;

    /*
    Bootstrap templates for Backbone Forms
     */
    Form.template = _.template("<form class=\"form\" data-fieldsets></form>");
    Form.Fieldset.template = _.template("<fieldset class=\"bbf-fieldset\" data-fields>\n  <% if (legend) { %>\n    <legend><%= legend %></legend>\n  <% } %>\n</fieldset>");
    Form.Field.template = _.template("<div class=\"control-group field-<%= key %> bbf-field\">\n  <% if (this.options.schema.type === \"Checkbox\") { %>\n    <div class=\"bbf-editor hacked-for-checkbox\" data-editor><label class=\"control-label\" for=\"<%= editorId %>\"><%= title %></label></div>\n    <div class=\"clearfix\"></div>\n  <% } else { %>\n    <label class=\"control-label\" for=\"<%= editorId %>\"><%= title %></label>\n    <div class=\"bbf-editor\" data-editor></div>\n  <% } %>\n  <div class=\"bbf-error-tooltip-container\">\n    <div class=\"bff-error-tooltip versal-tooltip versal-tooltip-text versal-tooltip-left versal-tooltip-align-top\">\n      <div class=\"versal-tooltip-arrow\"></div>\n      <div class=\"bbf-error\" data-error></div>\n    </div>\n  </div>\n</div>");
    Form.editors.Date.template = _.template("<div class=\"bbf-date\">\n  <select data-type=\"date\" class=\"bbf-date\"><%= dates %></select>\n  <select data-type=\"month\" class=\"bbf-month\"><%= months %></select>\n  <select data-type=\"year\" class=\"bbf-year\"><%= years %></select>\n</div>");
    Form.editors.DateTime.template = _.template("<div class=\"bbf-datetime\">\n  <div class=\"bbf-date-container\" data-date></div>\n  <select data-type=\"hour\" style=\"width: 4em\"><%= hours %></select>\n  :\n  <select data-type=\"min\" style=\"width: 4em\"><%= mins %></select>\n</div>");
    return Form.Field.errorClassName = "bbf-error";
  });

}).call(this);

/* Modernizr 2.6.2 (Custom Build) | MIT & BSD
 * Build: http://modernizr.com/download/#-inputtypes-shiv-cssclasses-css_pointerevents-load
 */
try { // Fix bug in firefox/pointerevents by omission.
;window.Modernizr=function(a,b,c){function v(a){j.cssText=a}function w(a,b){return v(prefixes.join(a+";")+(b||""))}function x(a,b){return typeof a===b}function y(a,b){return!!~(""+a).indexOf(b)}function z(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:x(f,"function")?f.bind(d||b):f}return!1}function A(){e.inputtypes=function(a){for(var d=0,e,f,h,i=a.length;d<i;d++)k.setAttribute("type",f=a[d]),e=k.type!=="text",e&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(k,null).WebkitAppearance!=="textfield"&&k.offsetHeight!==0,g.removeChild(k)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?e=k.checkValidity&&k.checkValidity()===!1:e=k.value!=l)),o[a[d]]=!!e;return o}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.6.2",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k=b.createElement("input"),l=":)",m={}.toString,n={},o={},p={},q=[],r=q.slice,s,t={}.hasOwnProperty,u;!x(t,"undefined")&&!x(t.call,"undefined")?u=function(a,b){return t.call(a,b)}:u=function(a,b){return b in a&&x(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=r.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(r.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(r.call(arguments)))};return e});for(var B in n)u(n,B)&&(s=B.toLowerCase(),e[s]=n[B](),q.push((e[s]?"":"no-")+s));return e.input||A(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)u(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof f!="undefined"&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},v(""),i=k=null,function(a,b){function k(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function l(){var a=r.elements;return typeof a=="string"?a.split(" "):a}function m(a){var b=i[a[g]];return b||(b={},h++,a[g]=h,i[h]=b),b}function n(a,c,f){c||(c=b);if(j)return c.createElement(a);f||(f=m(c));var g;return f.cache[a]?g=f.cache[a].cloneNode():e.test(a)?g=(f.cache[a]=f.createElem(a)).cloneNode():g=f.createElem(a),g.canHaveChildren&&!d.test(a)?f.frag.appendChild(g):g}function o(a,c){a||(a=b);if(j)return a.createDocumentFragment();c=c||m(a);var d=c.frag.cloneNode(),e=0,f=l(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function p(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?n(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+l().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function q(a){a||(a=b);var c=m(a);return r.shivCSS&&!f&&!c.hasCSS&&(c.hasCSS=!!k(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),j||p(a,c),a}var c=a.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,e=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,f,g="_html5shiv",h=0,i={},j;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",f="hidden"in a,j=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){f=!0,j=!0}})();var r={elements:c.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:c.shivCSS!==!1,supportsUnknownElements:j,shivMethods:c.shivMethods!==!1,type:"default",shivDocument:q,createElement:n,createDocumentFragment:o};a.html5=r,q(b)}(this,b),e._version=d,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+q.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("pointerevents",function(){var a=document.createElement("x"),b=document.documentElement,c=window.getComputedStyle,d;return"pointerEvents"in a.style?(a.style.pointerEvents="auto",a.style.pointerEvents="x",b.appendChild(a),d=c&&c(a,"").pointerEvents==="auto",b.removeChild(a),!!d):!1});
} catch (e) {};

define("libs/modernizr", function(){});

// Spectrum Colorpicker v1.1.1
// https://github.com/bgrins/spectrum
// Author: Brian Grinstead
// License: MIT

(function (window, $, undefined) {
    var defaultOpts = {

        // Callbacks
        beforeShow: noop,
        move: noop,
        change: noop,
        show: noop,
        hide: noop,

        // Options
        color: false,
        flat: false,
        showInput: false,
        showButtons: true,
        clickoutFiresChange: false,
        showInitial: false,
        showPalette: false,
        showPaletteOnly: false,
        showSelectionPalette: true,
        localStorageKey: false,
        appendTo: "body",
        maxSelectionSize: 7,
        cancelText: "cancel",
        chooseText: "choose",
        preferredFormat: false,
        className: "",
        showAlpha: false,
        theme: "sp-light",
        palette: ['fff', '000'],
        selectionPalette: [],
        disabled: false
    },
    spectrums = [],
    IE = !!/msie/i.exec( window.navigator.userAgent ),
    rgbaSupport = (function() {
        function contains( str, substr ) {
            return !!~('' + str).indexOf(substr);
        }

        var elem = document.createElement('div');
        var style = elem.style;
        style.cssText = 'background-color:rgba(0,0,0,.5)';
        return contains(style.backgroundColor, 'rgba') || contains(style.backgroundColor, 'hsla');
    })(),
    replaceInput = [
        "<div class='sp-replacer'>",
            "<div class='sp-preview'><div class='sp-preview-inner'></div></div>",
            "<div class='sp-dd'>&#9660;</div>",
        "</div>"
    ].join(''),
    markup = (function () {

        // IE does not support gradients with multiple stops, so we need to simulate
        //  that for the rainbow slider with 8 divs that each have a single gradient
        var gradientFix = "";
        if (IE) {
            for (var i = 1; i <= 6; i++) {
                gradientFix += "<div class='sp-" + i + "'></div>";
            }
        }

        return [
            "<div class='sp-container sp-hidden'>",
                "<div class='sp-palette-container'>",
                    "<div class='sp-palette sp-thumb sp-cf'></div>",
                "</div>",
                "<div class='sp-picker-container'>",
                    "<div class='sp-top sp-cf'>",
                        "<div class='sp-fill'></div>",
                        "<div class='sp-top-inner'>",
                            "<div class='sp-color'>",
                                "<div class='sp-sat'>",
                                    "<div class='sp-val'>",
                                        "<div class='sp-dragger'></div>",
                                    "</div>",
                                "</div>",
                            "</div>",
                            "<div class='sp-hue'>",
                                "<div class='sp-slider'></div>",
                                gradientFix,
                            "</div>",
                        "</div>",
                        "<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>",
                    "</div>",
                    "<div class='sp-input-container sp-cf'>",
                        "<input class='sp-input' type='text' spellcheck='false'  />",
                    "</div>",
                    "<div class='sp-initial sp-thumb sp-cf'></div>",
                    "<div class='sp-button-container sp-cf'>",
                        "<a class='sp-cancel' href='#'></a>",
                        "<button class='sp-choose'></button>",
                    "</div>",
                "</div>",
            "</div>"
        ].join("");
    })();

    function paletteTemplate (p, color, className) {
        var html = [];
        for (var i = 0; i < p.length; i++) {
            var tiny = tinycolor(p[i]);
            var c = tiny.toHsl().l < 0.5 ? "sp-thumb-el sp-thumb-dark" : "sp-thumb-el sp-thumb-light";
            c += (tinycolor.equals(color, p[i])) ? " sp-thumb-active" : "";

            var swatchStyle = rgbaSupport ? ("background-color:" + tiny.toRgbString()) : "filter:" + tiny.toFilter();
            html.push('<span title="' + tiny.toRgbString() + '" data-color="' + tiny.toRgbString() + '" class="' + c + '"><span class="sp-thumb-inner" style="' + swatchStyle + ';" /></span>');
        }
        return "<div class='sp-cf " + className + "'>" + html.join('') + "</div>";
    }

    function hideAll() {
        for (var i = 0; i < spectrums.length; i++) {
            if (spectrums[i]) {
                spectrums[i].hide();
            }
        }
    }

    function instanceOptions(o, callbackContext) {
        var opts = $.extend({}, defaultOpts, o);
        opts.callbacks = {
            'move': bind(opts.move, callbackContext),
            'change': bind(opts.change, callbackContext),
            'show': bind(opts.show, callbackContext),
            'hide': bind(opts.hide, callbackContext),
            'beforeShow': bind(opts.beforeShow, callbackContext)
        };

        return opts;
    }

    function spectrum(element, o) {

        var opts = instanceOptions(o, element),
            flat = opts.flat,
            showSelectionPalette = opts.showSelectionPalette,
            localStorageKey = opts.localStorageKey,
            theme = opts.theme,
            callbacks = opts.callbacks,
            resize = throttle(reflow, 10),
            visible = false,
            dragWidth = 0,
            dragHeight = 0,
            dragHelperHeight = 0,
            slideHeight = 0,
            slideWidth = 0,
            alphaWidth = 0,
            alphaSlideHelperWidth = 0,
            slideHelperHeight = 0,
            currentHue = 0,
            currentSaturation = 0,
            currentValue = 0,
            currentAlpha = 1,
            palette = opts.palette.slice(0),
            paletteArray = $.isArray(palette[0]) ? palette : [palette],
            selectionPalette = opts.selectionPalette.slice(0),
            maxSelectionSize = opts.maxSelectionSize,
            draggingClass = "sp-dragging",
            shiftMovementDirection = null;

        var doc = element.ownerDocument,
            body = doc.body,
            boundElement = $(element),
            disabled = false,
            container = $(markup, doc).addClass(theme),
            dragger = container.find(".sp-color"),
            dragHelper = container.find(".sp-dragger"),
            slider = container.find(".sp-hue"),
            slideHelper = container.find(".sp-slider"),
            alphaSliderInner = container.find(".sp-alpha-inner"),
            alphaSlider = container.find(".sp-alpha"),
            alphaSlideHelper = container.find(".sp-alpha-handle"),
            textInput = container.find(".sp-input"),
            paletteContainer = container.find(".sp-palette"),
            initialColorContainer = container.find(".sp-initial"),
            cancelButton = container.find(".sp-cancel"),
            chooseButton = container.find(".sp-choose"),
            isInput = boundElement.is("input"),
            shouldReplace = isInput && !flat,
            replacer = (shouldReplace) ? $(replaceInput).addClass(theme).addClass(opts.className) : $([]),
            offsetElement = (shouldReplace) ? replacer : boundElement,
            previewElement = replacer.find(".sp-preview-inner"),
            initialColor = opts.color || (isInput && boundElement.val()),
            colorOnShow = false,
            preferredFormat = opts.preferredFormat,
            currentPreferredFormat = preferredFormat,
            clickoutFiresChange = !opts.showButtons || opts.clickoutFiresChange;


        function applyOptions() {

            if (opts.showPaletteOnly) {
                opts.showPalette = true;
            }

            container.toggleClass("sp-flat", flat);
            container.toggleClass("sp-input-disabled", !opts.showInput);
            container.toggleClass("sp-alpha-enabled", opts.showAlpha);
            container.toggleClass("sp-buttons-disabled", !opts.showButtons);
            container.toggleClass("sp-palette-disabled", !opts.showPalette);
            container.toggleClass("sp-palette-only", opts.showPaletteOnly);
            container.toggleClass("sp-initial-disabled", !opts.showInitial);
            container.addClass(opts.className);

            reflow();
        }

        function initialize() {

            if (IE) {
                container.find("*:not(input)").attr("unselectable", "on");
            }

            applyOptions();

            if (shouldReplace) {
                boundElement.after(replacer).hide();
            }

            if (flat) {
                boundElement.after(container).hide();
            }
            else {

                var appendTo = opts.appendTo === "parent" ? boundElement.parent() : $(opts.appendTo);
                if (appendTo.length !== 1) {
                    appendTo = $("body");
                }

                appendTo.append(container);
            }

            if (localStorageKey && window.localStorage) {

                // Migrate old palettes over to new format.  May want to remove this eventually.
                try {
                    var oldPalette = window.localStorage[localStorageKey].split(",#");
                    if (oldPalette.length > 1) {
                        delete window.localStorage[localStorageKey];
                        $.each(oldPalette, function(i, c) {
                             addColorToSelectionPalette(c);
                        });
                    }
                }
                catch(e) { }

                try {
                    selectionPalette = window.localStorage[localStorageKey].split(";");
                }
                catch (e) { }
            }

            offsetElement.bind("click.spectrum touchstart.spectrum", function (e) {
                if (!disabled) {
                    toggle();
                }

                e.stopPropagation();

                if (!$(e.target).is("input")) {
                    e.preventDefault();
                }
            });

            if(boundElement.is(":disabled") || (opts.disabled === true)) {
                disable();
            }

            // Prevent clicks from bubbling up to document.  This would cause it to be hidden.
            container.click(stopPropagation);

            // Handle user typed input
            textInput.change(setFromTextInput);
            textInput.bind("paste", function () {
                setTimeout(setFromTextInput, 1);
            });
            textInput.keydown(function (e) { if (e.keyCode == 13) { setFromTextInput(); } });

            cancelButton.text(opts.cancelText);
            cancelButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
                hide("cancel");
            });

            chooseButton.text(opts.chooseText);
            chooseButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();

                if (isValid()) {
                    updateOriginalInput(true);
                    hide();
                }
            });

            draggable(alphaSlider, function (dragX, dragY, e) {
                currentAlpha = (dragX / alphaWidth);
                if (e.shiftKey) {
                    currentAlpha = Math.round(currentAlpha * 10) / 10;
                }

                move();
            });

            draggable(slider, function (dragX, dragY) {
                currentHue = parseFloat(dragY / slideHeight);
                move();
            }, dragStart, dragStop);

            draggable(dragger, function (dragX, dragY, e) {

                // shift+drag should snap the movement to either the x or y axis.
                if (!e.shiftKey) {
                    shiftMovementDirection = null;
                }
                else if (!shiftMovementDirection) {
                    var oldDragX = currentSaturation * dragWidth;
                    var oldDragY = dragHeight - (currentValue * dragHeight);
                    var furtherFromX = Math.abs(dragX - oldDragX) > Math.abs(dragY - oldDragY);

                    shiftMovementDirection = furtherFromX ? "x" : "y";
                }

                var setSaturation = !shiftMovementDirection || shiftMovementDirection === "x";
                var setValue = !shiftMovementDirection || shiftMovementDirection === "y";

                if (setSaturation) {
                    currentSaturation = parseFloat(dragX / dragWidth);
                }
                if (setValue) {
                    currentValue = parseFloat((dragHeight - dragY) / dragHeight);
                }

                move();

            }, dragStart, dragStop);

            if (!!initialColor) {
                set(initialColor);

                // In case color was black - update the preview UI and set the format
                // since the set function will not run (default color is black).
                updateUI();
                currentPreferredFormat = preferredFormat || tinycolor(initialColor).format;

                addColorToSelectionPalette(initialColor);
            }
            else {
                updateUI();
            }

            if (flat) {
                show();
            }

            function palletElementClick(e) {
                if (e.data && e.data.ignore) {
                    set($(this).data("color"));
                    move();
                }
                else {
                    set($(this).data("color"));
                    updateOriginalInput(true);
                    move();
                    hide();
                }

                return false;
            }

            var paletteEvent = IE ? "mousedown.spectrum" : "click.spectrum touchstart.spectrum";
            paletteContainer.delegate(".sp-thumb-el", paletteEvent, palletElementClick);
            initialColorContainer.delegate(".sp-thumb-el:nth-child(1)", paletteEvent, { ignore: true }, palletElementClick);
        }

        function addColorToSelectionPalette(color) {
            if (showSelectionPalette) {
                var colorRgb = tinycolor(color).toRgbString();
                if ($.inArray(colorRgb, selectionPalette) === -1) {
                    selectionPalette.push(colorRgb);
                    while(selectionPalette.length > maxSelectionSize) {
                        selectionPalette.shift();
                    }
                }

                if (localStorageKey && window.localStorage) {
                    try {
                        window.localStorage[localStorageKey] = selectionPalette.join(";");
                    }
                    catch(e) { }
                }
            }
        }

        function getUniqueSelectionPalette() {
            var unique = [];
            var p = selectionPalette;
            var paletteLookup = {};
            var rgb;

            if (opts.showPalette) {

                for (var i = 0; i < paletteArray.length; i++) {
                    for (var j = 0; j < paletteArray[i].length; j++) {
                        rgb = tinycolor(paletteArray[i][j]).toRgbString();
                        paletteLookup[rgb] = true;
                    }
                }

                for (i = 0; i < p.length; i++) {
                    rgb = tinycolor(p[i]).toRgbString();

                    if (!paletteLookup.hasOwnProperty(rgb)) {
                        unique.push(p[i]);
                        paletteLookup[rgb] = true;
                    }
                }
            }

            return unique.reverse().slice(0, opts.maxSelectionSize);
        }

        function drawPalette() {

            var currentColor = get();

            var html = $.map(paletteArray, function (palette, i) {
                return paletteTemplate(palette, currentColor, "sp-palette-row sp-palette-row-" + i);
            });

            if (selectionPalette) {
                html.push(paletteTemplate(getUniqueSelectionPalette(), currentColor, "sp-palette-row sp-palette-row-selection"));
            }

            paletteContainer.html(html.join(""));
        }

        function drawInitial() {
            if (opts.showInitial) {
                var initial = colorOnShow;
                var current = get();
                initialColorContainer.html(paletteTemplate([initial, current], current, "sp-palette-row-initial"));
            }
        }

        function dragStart() {
            if (dragHeight <= 0 || dragWidth <= 0 || slideHeight <= 0) {
                reflow();
            }
            container.addClass(draggingClass);
            shiftMovementDirection = null;
        }

        function dragStop() {
            container.removeClass(draggingClass);
        }

        function setFromTextInput() {
            var tiny = tinycolor(textInput.val());
            if (tiny.ok) {
                set(tiny);
            }
            else {
                textInput.addClass("sp-validation-error");
            }
        }

        function toggle() {
            if (visible) {
                hide();
            }
            else {
                show();
            }
        }

        function show() {
            var event = $.Event('beforeShow.spectrum');

            if (visible) {
                reflow();
                return;
            }

            boundElement.trigger(event, [ get() ]);

            if (callbacks.beforeShow(get()) === false || event.isDefaultPrevented()) {
                return;
            }

            hideAll();
            visible = true;

            $(doc).bind("click.spectrum", hide);
            $(window).bind("resize.spectrum", resize);
            replacer.addClass("sp-active");
            container.removeClass("sp-hidden");

            if (opts.showPalette) {
                drawPalette();
            }
            reflow();
            updateUI();

            colorOnShow = get();

            drawInitial();
            callbacks.show(colorOnShow);
            boundElement.trigger('show.spectrum', [ colorOnShow ]);
        }

        function hide(e) {

            // Return on right click
            if (e && e.type == "click" && e.button == 2) { return; }

            // Return if hiding is unnecessary
            if (!visible || flat) { return; }
            visible = false;

            $(doc).unbind("click.spectrum", hide);
            $(window).unbind("resize.spectrum", resize);

            replacer.removeClass("sp-active");
            container.addClass("sp-hidden");

            var colorHasChanged = !tinycolor.equals(get(), colorOnShow);

            if (colorHasChanged) {
                if (clickoutFiresChange && e !== "cancel") {
                    updateOriginalInput(true);
                }
                else {
                    revert();
                }
            }

            callbacks.hide(get());
            boundElement.trigger('hide.spectrum', [ get() ]);
        }

        function revert() {
            set(colorOnShow, true);
        }

        function set(color, ignoreFormatChange) {
            if (tinycolor.equals(color, get())) {
                return;
            }

            var newColor = tinycolor(color);
            var newHsv = newColor.toHsv();

            currentHue = (newHsv.h % 360) / 360;
            currentSaturation = newHsv.s;
            currentValue = newHsv.v;
            currentAlpha = newHsv.a;

            updateUI();

            if (newColor.ok && !ignoreFormatChange) {
                currentPreferredFormat = preferredFormat || newColor.format;
            }
        }

        function get(opts) {
            opts = opts || { };
            return tinycolor.fromRatio({
                h: currentHue,
                s: currentSaturation,
                v: currentValue,
                a: Math.round(currentAlpha * 100) / 100
            }, { format: opts.format || currentPreferredFormat });
        }

        function isValid() {
            return !textInput.hasClass("sp-validation-error");
        }

        function move() {
            updateUI();

            callbacks.move(get());
            boundElement.trigger('move.spectrum', [ get() ]);
        }

        function updateUI() {

            textInput.removeClass("sp-validation-error");

            updateHelperLocations();

            // Update dragger background color (gradients take care of saturation and value).
            var flatColor = tinycolor.fromRatio({ h: currentHue, s: 1, v: 1 });
            dragger.css("background-color", flatColor.toHexString());

            // Get a format that alpha will be included in (hex and names ignore alpha)
            var format = currentPreferredFormat;
            if (currentAlpha < 1) {
                if (format === "hex" || format === "hex3" || format === "hex6" || format === "name") {
                    format = "rgb";
                }
            }

            var realColor = get({ format: format }),
                realHex = realColor.toHexString(),
                realRgb = realColor.toRgbString();

            // Update the replaced elements background color (with actual selected color)
            if (rgbaSupport || realColor.alpha === 1) {
                previewElement.css("background-color", realRgb);
            }
            else {
                previewElement.css("background-color", "transparent");
                previewElement.css("filter", realColor.toFilter());
            }

            if (opts.showAlpha) {
                var rgb = realColor.toRgb();
                rgb.a = 0;
                var realAlpha = tinycolor(rgb).toRgbString();
                var gradient = "linear-gradient(left, " + realAlpha + ", " + realHex + ")";

                if (IE) {
                    alphaSliderInner.css("filter", tinycolor(realAlpha).toFilter({ gradientType: 1 }, realHex));
                }
                else {
                    alphaSliderInner.css("background", "-webkit-" + gradient);
                    alphaSliderInner.css("background", "-moz-" + gradient);
                    alphaSliderInner.css("background", "-ms-" + gradient);
                    alphaSliderInner.css("background", gradient);
                }
            }


            // Update the text entry input as it changes happen
            if (opts.showInput) {
                textInput.val(realColor.toString(format));
            }

            if (opts.showPalette) {
                drawPalette();
            }

            drawInitial();
        }

        function updateHelperLocations() {
            var s = currentSaturation;
            var v = currentValue;

            // Where to show the little circle in that displays your current selected color
            var dragX = s * dragWidth;
            var dragY = dragHeight - (v * dragHeight);
            dragX = Math.max(
                -dragHelperHeight,
                Math.min(dragWidth - dragHelperHeight, dragX - dragHelperHeight)
            );
            dragY = Math.max(
                -dragHelperHeight,
                Math.min(dragHeight - dragHelperHeight, dragY - dragHelperHeight)
            );
            dragHelper.css({
                "top": dragY,
                "left": dragX
            });

            var alphaX = currentAlpha * alphaWidth;
            alphaSlideHelper.css({
                "left": alphaX - (alphaSlideHelperWidth / 2)
            });

            // Where to show the bar that displays your current selected hue
            var slideY = (currentHue) * slideHeight;
            slideHelper.css({
                "top": slideY - slideHelperHeight
            });
        }

        function updateOriginalInput(fireCallback) {
            var color = get();

            if (isInput) {
                boundElement.val(color.toString(currentPreferredFormat));
            }

            var hasChanged = !tinycolor.equals(color, colorOnShow);
            colorOnShow = color;

            // Update the selection palette with the current color
            addColorToSelectionPalette(color);
            if (fireCallback && hasChanged) {
                callbacks.change(color);
                boundElement.trigger('change', [ color ]);
            }
        }

        function reflow() {
            dragWidth = dragger.width();
            dragHeight = dragger.height();
            dragHelperHeight = dragHelper.height();
            slideWidth = slider.width();
            slideHeight = slider.height();
            slideHelperHeight = slideHelper.height();
            alphaWidth = alphaSlider.width();
            alphaSlideHelperWidth = alphaSlideHelper.width();

            if (!flat) {
                container.css("position", "absolute");
                container.offset(getOffset(container, offsetElement));
            }

            updateHelperLocations();
        }

        function destroy() {
            boundElement.show();
            offsetElement.unbind("click.spectrum touchstart.spectrum");
            container.remove();
            replacer.remove();
            spectrums[spect.id] = null;
        }

        function option(optionName, optionValue) {
            if (optionName === undefined) {
                return $.extend({}, opts);
            }
            if (optionValue === undefined) {
                return opts[optionName];
            }

            opts[optionName] = optionValue;
            applyOptions();
        }

        function enable() {
            disabled = false;
            boundElement.attr("disabled", false);
            offsetElement.removeClass("sp-disabled");
        }

        function disable() {
            hide();
            disabled = true;
            boundElement.attr("disabled", true);
            offsetElement.addClass("sp-disabled");
        }

        initialize();

        var spect = {
            show: show,
            hide: hide,
            toggle: toggle,
            reflow: reflow,
            option: option,
            enable: enable,
            disable: disable,
            set: function (c) {
                set(c);
                updateOriginalInput();
            },
            get: get,
            destroy: destroy,
            container: container
        };

        spect.id = spectrums.push(spect) - 1;

        return spect;
    }

    /**
    * checkOffset - get the offset below/above and left/right element depending on screen position
    * Thanks https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js
    */
    function getOffset(picker, input) {
        var extraY = 0;
        var dpWidth = picker.outerWidth();
        var dpHeight = picker.outerHeight();
        var inputHeight = input.outerHeight();
        var doc = picker[0].ownerDocument;
        var docElem = doc.documentElement;
        var viewWidth = docElem.clientWidth + $(doc).scrollLeft();
        var viewHeight = docElem.clientHeight + $(doc).scrollTop();
        var offset = input.offset();
        offset.top += inputHeight;

        offset.left -=
            Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?
            Math.abs(offset.left + dpWidth - viewWidth) : 0);

        offset.top -=
            Math.min(offset.top, ((offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?
            Math.abs(dpHeight + inputHeight - extraY) : extraY));

        return offset;
    }

    /**
    * noop - do nothing
    */
    function noop() {

    }

    /**
    * stopPropagation - makes the code only doing this a little easier to read in line
    */
    function stopPropagation(e) {
        e.stopPropagation();
    }

    /**
    * Create a function bound to a given object
    * Thanks to underscore.js
    */
    function bind(func, obj) {
        var slice = Array.prototype.slice;
        var args = slice.call(arguments, 2);
        return function () {
            return func.apply(obj, args.concat(slice.call(arguments)));
        };
    }

    /**
    * Lightweight drag helper.  Handles containment within the element, so that
    * when dragging, the x is within [0,element.width] and y is within [0,element.height]
    */
    function draggable(element, onmove, onstart, onstop) {
        onmove = onmove || function () { };
        onstart = onstart || function () { };
        onstop = onstop || function () { };
        var doc = element.ownerDocument || document;
        var dragging = false;
        var offset = {};
        var maxHeight = 0;
        var maxWidth = 0;
        var hasTouch = ('ontouchstart' in window);

        var duringDragEvents = {};
        duringDragEvents["selectstart"] = prevent;
        duringDragEvents["dragstart"] = prevent;
        duringDragEvents["touchmove mousemove"] = move;
        duringDragEvents["touchend mouseup"] = stop;

        function prevent(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.returnValue = false;
        }

        function move(e) {
            if (dragging) {
                // Mouseup happened outside of window
                if (IE && document.documentMode < 9 && !e.button) {
                    return stop();
                }

                var touches = e.originalEvent.touches;
                var pageX = touches ? touches[0].pageX : e.pageX;
                var pageY = touches ? touches[0].pageY : e.pageY;

                var dragX = Math.max(0, Math.min(pageX - offset.left, maxWidth));
                var dragY = Math.max(0, Math.min(pageY - offset.top, maxHeight));

                if (hasTouch) {
                    // Stop scrolling in iOS
                    prevent(e);
                }

                onmove.apply(element, [dragX, dragY, e]);
            }
        }
        function start(e) {
            var rightclick = (e.which) ? (e.which == 3) : (e.button == 2);
            var touches = e.originalEvent.touches;

            if (!rightclick && !dragging) {
                if (onstart.apply(element, arguments) !== false) {
                    dragging = true;
                    maxHeight = $(element).height();
                    maxWidth = $(element).width();
                    offset = $(element).offset();

                    $(doc).bind(duringDragEvents);
                    $(doc.body).addClass("sp-dragging");

                    if (!hasTouch) {
                        move(e);
                    }

                    prevent(e);
                }
            }
        }
        function stop() {
            if (dragging) {
                $(doc).unbind(duringDragEvents);
                $(doc.body).removeClass("sp-dragging");
                onstop.apply(element, arguments);
            }
            dragging = false;
        }

        $(element).bind("touchstart mousedown", start);
    }

    function throttle(func, wait, debounce) {
        var timeout;
        return function () {
            var context = this, args = arguments;
            var throttler = function () {
                timeout = null;
                func.apply(context, args);
            };
            if (debounce) clearTimeout(timeout);
            if (debounce || !timeout) timeout = setTimeout(throttler, wait);
        };
    }


    function log(){/* jshint -W021 */if(window.console){if(Function.prototype.bind)log=Function.prototype.bind.call(console.log,console);else log=function(){Function.prototype.apply.call(console.log,console,arguments);};log.apply(this,arguments);}}

    /**
    * Define a jQuery plugin
    */
    var dataID = "spectrum.id";
    $.fn.spectrum = function (opts, extra) {

        if (typeof opts == "string") {

            var returnValue = this;
            var args = Array.prototype.slice.call( arguments, 1 );

            this.each(function () {
                var spect = spectrums[$(this).data(dataID)];
                if (spect) {

                    var method = spect[opts];
                    if (!method) {
                        throw new Error( "Spectrum: no such method: '" + opts + "'" );
                    }

                    if (opts == "get") {
                        returnValue = spect.get();
                    }
                    else if (opts == "container") {
                        returnValue = spect.container;
                    }
                    else if (opts == "option") {
                        returnValue = spect.option.apply(spect, args);
                    }
                    else if (opts == "destroy") {
                        spect.destroy();
                        $(this).removeData(dataID);
                    }
                    else {
                        method.apply(spect, args);
                    }
                }
            });

            return returnValue;
        }

        // Initializing a new instance of spectrum
        return this.spectrum("destroy").each(function () {
            var spect = spectrum(this, opts);
            $(this).data(dataID, spect.id);
        });
    };

    $.fn.spectrum.load = true;
    $.fn.spectrum.loadOpts = {};
    $.fn.spectrum.draggable = draggable;
    $.fn.spectrum.defaults = defaultOpts;

    $.spectrum = { };
    $.spectrum.localization = { };
    $.spectrum.palettes = { };

    $.fn.spectrum.processNativeColorInputs = function () {
        var colorInput = $("<input type='color' value='!' />")[0];
        var supportsColor = colorInput.type === "color" && colorInput.value != "!";

        if (!supportsColor) {
            $("input[type=color]").spectrum({
                preferredFormat: "hex6"
            });
        }
    };
    // TinyColor v0.9.14
    // https://github.com/bgrins/TinyColor
    // 2013-02-24, Brian Grinstead, MIT License

    (function(root) {

        var trimLeft = /^[\s,#]+/,
            trimRight = /\s+$/,
            tinyCounter = 0,
            math = Math,
            mathRound = math.round,
            mathMin = math.min,
            mathMax = math.max,
            mathRandom = math.random;

        function tinycolor (color, opts) {

            color = (color) ? color : '';
            opts = opts || { };

            // If input is already a tinycolor, return itself
            if (typeof color == "object" && color.hasOwnProperty("_tc_id")) {
               return color;
            }
            var rgb = inputToRGB(color);
            var r = rgb.r,
                g = rgb.g,
                b = rgb.b,
                a = rgb.a,
                roundA = mathRound(100*a) / 100,
                format = opts.format || rgb.format;

            // Don't let the range of [0,255] come back in [0,1].
            // Potentially lose a little bit of precision here, but will fix issues where
            // .5 gets interpreted as half of the total, instead of half of 1
            // If it was supposed to be 128, this was already taken care of by `inputToRgb`
            if (r < 1) { r = mathRound(r); }
            if (g < 1) { g = mathRound(g); }
            if (b < 1) { b = mathRound(b); }

            return {
                ok: rgb.ok,
                format: format,
                _tc_id: tinyCounter++,
                alpha: a,
                toHsv: function() {
                    var hsv = rgbToHsv(r, g, b);
                    return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: a };
                },
                toHsvString: function() {
                    var hsv = rgbToHsv(r, g, b);
                    var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);
                    return (a == 1) ?
                      "hsv("  + h + ", " + s + "%, " + v + "%)" :
                      "hsva(" + h + ", " + s + "%, " + v + "%, "+ roundA + ")";
                },
                toHsl: function() {
                    var hsl = rgbToHsl(r, g, b);
                    return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: a };
                },
                toHslString: function() {
                    var hsl = rgbToHsl(r, g, b);
                    var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);
                    return (a == 1) ?
                      "hsl("  + h + ", " + s + "%, " + l + "%)" :
                      "hsla(" + h + ", " + s + "%, " + l + "%, "+ roundA + ")";
                },
                toHex: function(allow3Char) {
                    return rgbToHex(r, g, b, allow3Char);
                },
                toHexString: function(allow3Char) {
                    return '#' + rgbToHex(r, g, b, allow3Char);
                },
                toRgb: function() {
                    return { r: mathRound(r), g: mathRound(g), b: mathRound(b), a: a };
                },
                toRgbString: function() {
                    return (a == 1) ?
                      "rgb("  + mathRound(r) + ", " + mathRound(g) + ", " + mathRound(b) + ")" :
                      "rgba(" + mathRound(r) + ", " + mathRound(g) + ", " + mathRound(b) + ", " + roundA + ")";
                },
                toPercentageRgb: function() {
                    return { r: mathRound(bound01(r, 255) * 100) + "%", g: mathRound(bound01(g, 255) * 100) + "%", b: mathRound(bound01(b, 255) * 100) + "%", a: a };
                },
                toPercentageRgbString: function() {
                    return (a == 1) ?
                      "rgb("  + mathRound(bound01(r, 255) * 100) + "%, " + mathRound(bound01(g, 255) * 100) + "%, " + mathRound(bound01(b, 255) * 100) + "%)" :
                      "rgba(" + mathRound(bound01(r, 255) * 100) + "%, " + mathRound(bound01(g, 255) * 100) + "%, " + mathRound(bound01(b, 255) * 100) + "%, " + roundA + ")";
                },
                toName: function() {
                    return hexNames[rgbToHex(r, g, b, true)] || false;
                },
                toFilter: function(secondColor) {
                    var hex = rgbToHex(r, g, b);
                    var secondHex = hex;
                    var alphaHex = Math.round(parseFloat(a) * 255).toString(16);
                    var secondAlphaHex = alphaHex;
                    var gradientType = opts && opts.gradientType ? "GradientType = 1, " : "";

                    if (secondColor) {
                        var s = tinycolor(secondColor);
                        secondHex = s.toHex();
                        secondAlphaHex = Math.round(parseFloat(s.alpha) * 255).toString(16);
                    }

                    return "progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr=#" + pad2(alphaHex) + hex + ",endColorstr=#" + pad2(secondAlphaHex) + secondHex + ")";
                },
                toString: function(format) {
                    format = format || this.format;
                    var formattedString = false;
                    if (format === "rgb") {
                        formattedString = this.toRgbString();
                    }
                    if (format === "prgb") {
                        formattedString = this.toPercentageRgbString();
                    }
                    if (format === "hex" || format === "hex6") {
                        formattedString = this.toHexString();
                    }
                    if (format === "hex3") {
                        formattedString = this.toHexString(true);
                    }
                    if (format === "name") {
                        formattedString = this.toName();
                    }
                    if (format === "hsl") {
                        formattedString = this.toHslString();
                    }
                    if (format === "hsv") {
                        formattedString = this.toHsvString();
                    }

                    return formattedString || this.toHexString();
                }
            };
        }

        // If input is an object, force 1 into "1.0" to handle ratios properly
        // String input requires "1.0" as input, so 1 will be treated as 1
        tinycolor.fromRatio = function(color, opts) {
            if (typeof color == "object") {
                var newColor = {};
                for (var i in color) {
                    if (color.hasOwnProperty(i)) {
                        if (i === "a") {
                            newColor[i] = color[i];
                        }
                        else {
                            newColor[i] = convertToPercentage(color[i]);
                        }
                    }
                }
                color = newColor;
            }

            return tinycolor(color, opts);
        };

        // Given a string or object, convert that input to RGB
        // Possible string inputs:
        //
        //     "red"
        //     "#f00" or "f00"
        //     "#ff0000" or "ff0000"
        //     "rgb 255 0 0" or "rgb (255, 0, 0)"
        //     "rgb 1.0 0 0" or "rgb (1, 0, 0)"
        //     "rgba (255, 0, 0, 1)" or "rgba 255, 0, 0, 1"
        //     "rgba (1.0, 0, 0, 1)" or "rgba 1.0, 0, 0, 1"
        //     "hsl(0, 100%, 50%)" or "hsl 0 100% 50%"
        //     "hsla(0, 100%, 50%, 1)" or "hsla 0 100% 50%, 1"
        //     "hsv(0, 100%, 100%)" or "hsv 0 100% 100%"
        //
        function inputToRGB(color) {

            var rgb = { r: 0, g: 0, b: 0 };
            var a = 1;
            var ok = false;
            var format = false;

            if (typeof color == "string") {
                color = stringInputToObject(color);
            }

            if (typeof color == "object") {
                if (color.hasOwnProperty("r") && color.hasOwnProperty("g") && color.hasOwnProperty("b")) {
                    rgb = rgbToRgb(color.r, color.g, color.b);
                    ok = true;
                    format = String(color.r).substr(-1) === "%" ? "prgb" : "rgb";
                }
                else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("v")) {
                    color.s = convertToPercentage(color.s);
                    color.v = convertToPercentage(color.v);
                    rgb = hsvToRgb(color.h, color.s, color.v);
                    ok = true;
                    format = "hsv";
                }
                else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("l")) {
                    color.s = convertToPercentage(color.s);
                    color.l = convertToPercentage(color.l);
                    rgb = hslToRgb(color.h, color.s, color.l);
                    ok = true;
                    format = "hsl";
                }

                if (color.hasOwnProperty("a")) {
                    a = color.a;
                }
            }

            a = parseFloat(a);

            // Handle invalid alpha characters by setting to 1
            if (isNaN(a) || a < 0 || a > 1) {
                a = 1;
            }

            return {
                ok: ok,
                format: color.format || format,
                r: mathMin(255, mathMax(rgb.r, 0)),
                g: mathMin(255, mathMax(rgb.g, 0)),
                b: mathMin(255, mathMax(rgb.b, 0)),
                a: a
            };
        }



        // Conversion Functions
        // --------------------

        // `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:
        // <http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>

        // `rgbToRgb`
        // Handle bounds / percentage checking to conform to CSS color spec
        // <http://www.w3.org/TR/css3-color/>
        // *Assumes:* r, g, b in [0, 255] or [0, 1]
        // *Returns:* { r, g, b } in [0, 255]
        function rgbToRgb(r, g, b){
            return {
                r: bound01(r, 255) * 255,
                g: bound01(g, 255) * 255,
                b: bound01(b, 255) * 255
            };
        }

        // `rgbToHsl`
        // Converts an RGB color value to HSL.
        // *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]
        // *Returns:* { h, s, l } in [0,1]
        function rgbToHsl(r, g, b) {

            r = bound01(r, 255);
            g = bound01(g, 255);
            b = bound01(b, 255);

            var max = mathMax(r, g, b), min = mathMin(r, g, b);
            var h, s, l = (max + min) / 2;

            if(max == min) {
                h = s = 0; // achromatic
            }
            else {
                var d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch(max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }

                h /= 6;
            }

            return { h: h, s: s, l: l };
        }

        // `hslToRgb`
        // Converts an HSL color value to RGB.
        // *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]
        // *Returns:* { r, g, b } in the set [0, 255]
        function hslToRgb(h, s, l) {
            var r, g, b;

            h = bound01(h, 360);
            s = bound01(s, 100);
            l = bound01(l, 100);

            function hue2rgb(p, q, t) {
                if(t < 0) t += 1;
                if(t > 1) t -= 1;
                if(t < 1/6) return p + (q - p) * 6 * t;
                if(t < 1/2) return q;
                if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                return p;
            }

            if(s === 0) {
                r = g = b = l; // achromatic
            }
            else {
                var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                var p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }

            return { r: r * 255, g: g * 255, b: b * 255 };
        }

        // `rgbToHsv`
        // Converts an RGB color value to HSV
        // *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]
        // *Returns:* { h, s, v } in [0,1]
        function rgbToHsv(r, g, b) {

            r = bound01(r, 255);
            g = bound01(g, 255);
            b = bound01(b, 255);

            var max = mathMax(r, g, b), min = mathMin(r, g, b);
            var h, s, v = max;

            var d = max - min;
            s = max === 0 ? 0 : d / max;

            if(max == min) {
                h = 0; // achromatic
            }
            else {
                switch(max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return { h: h, s: s, v: v };
        }

        // `hsvToRgb`
        // Converts an HSV color value to RGB.
        // *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]
        // *Returns:* { r, g, b } in the set [0, 255]
         function hsvToRgb(h, s, v) {

            h = bound01(h, 360) * 6;
            s = bound01(s, 100);
            v = bound01(v, 100);

            var i = math.floor(h),
                f = h - i,
                p = v * (1 - s),
                q = v * (1 - f * s),
                t = v * (1 - (1 - f) * s),
                mod = i % 6,
                r = [v, q, p, p, t, v][mod],
                g = [t, v, v, q, p, p][mod],
                b = [p, p, t, v, v, q][mod];

            return { r: r * 255, g: g * 255, b: b * 255 };
        }

        // `rgbToHex`
        // Converts an RGB color to hex
        // Assumes r, g, and b are contained in the set [0, 255]
        // Returns a 3 or 6 character hex
        function rgbToHex(r, g, b, allow3Char) {

            var hex = [
                pad2(mathRound(r).toString(16)),
                pad2(mathRound(g).toString(16)),
                pad2(mathRound(b).toString(16))
            ];

            // Return a 3 character hex if possible
            if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {
                return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);
            }

            return hex.join("");
        }

        // `equals`
        // Can be called with any tinycolor input
        tinycolor.equals = function (color1, color2) {
            if (!color1 || !color2) { return false; }
            return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();
        };
        tinycolor.random = function() {
            return tinycolor.fromRatio({
                r: mathRandom(),
                g: mathRandom(),
                b: mathRandom()
            });
        };


        // Modification Functions
        // ----------------------
        // Thanks to less.js for some of the basics here
        // <https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>


        tinycolor.desaturate = function (color, amount) {
            var hsl = tinycolor(color).toHsl();
            hsl.s -= ((amount || 10) / 100);
            hsl.s = clamp01(hsl.s);
            return tinycolor(hsl);
        };
        tinycolor.saturate = function (color, amount) {
            var hsl = tinycolor(color).toHsl();
            hsl.s += ((amount || 10) / 100);
            hsl.s = clamp01(hsl.s);
            return tinycolor(hsl);
        };
        tinycolor.greyscale = function(color) {
            return tinycolor.desaturate(color, 100);
        };
        tinycolor.lighten = function(color, amount) {
            var hsl = tinycolor(color).toHsl();
            hsl.l += ((amount || 10) / 100);
            hsl.l = clamp01(hsl.l);
            return tinycolor(hsl);
        };
        tinycolor.darken = function (color, amount) {
            var hsl = tinycolor(color).toHsl();
            hsl.l -= ((amount || 10) / 100);
            hsl.l = clamp01(hsl.l);
            return tinycolor(hsl);
        };
        tinycolor.complement = function(color) {
            var hsl = tinycolor(color).toHsl();
            hsl.h = (hsl.h + 180) % 360;
            return tinycolor(hsl);
        };


        // Combination Functions
        // ---------------------
        // Thanks to jQuery xColor for some of the ideas behind these
        // <https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>

        tinycolor.triad = function(color) {
            var hsl = tinycolor(color).toHsl();
            var h = hsl.h;
            return [
                tinycolor(color),
                tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),
                tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })
            ];
        };
        tinycolor.tetrad = function(color) {
            var hsl = tinycolor(color).toHsl();
            var h = hsl.h;
            return [
                tinycolor(color),
                tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),
                tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),
                tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })
            ];
        };
        tinycolor.splitcomplement = function(color) {
            var hsl = tinycolor(color).toHsl();
            var h = hsl.h;
            return [
                tinycolor(color),
                tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),
                tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})
            ];
        };
        tinycolor.analogous = function(color, results, slices) {
            results = results || 6;
            slices = slices || 30;

            var hsl = tinycolor(color).toHsl();
            var part = 360 / slices;
            var ret = [tinycolor(color)];

            for (hsl.h = ((hsl.h - (part * results >> 1)) + 720) % 360; --results; ) {
                hsl.h = (hsl.h + part) % 360;
                ret.push(tinycolor(hsl));
            }
            return ret;
        };
        tinycolor.monochromatic = function(color, results) {
            results = results || 6;
            var hsv = tinycolor(color).toHsv();
            var h = hsv.h, s = hsv.s, v = hsv.v;
            var ret = [];
            var modification = 1 / results;

            while (results--) {
                ret.push(tinycolor({ h: h, s: s, v: v}));
                v = (v + modification) % 1;
            }

            return ret;
        };

        // Readability Functions
        // ---------------------
        // <http://www.w3.org/TR/AERT#color-contrast>

        // `readability`
        // Analyze the 2 colors and returns an object with the following properties:
        //    `brightness`: difference in brightness between the two colors
        //    `color`: difference in color/hue between the two colors
        tinycolor.readability = function(color1, color2) {
            var a = tinycolor(color1).toRgb();
            var b = tinycolor(color2).toRgb();
            var brightnessA = (a.r * 299 + a.g * 587 + a.b * 114) / 1000;
            var brightnessB = (b.r * 299 + b.g * 587 + b.b * 114) / 1000;
            var colorDiff = (
                Math.max(a.r, b.r) - Math.min(a.r, b.r) +
                Math.max(a.g, b.g) - Math.min(a.g, b.g) +
                Math.max(a.b, b.b) - Math.min(a.b, b.b)
            );

            return {
                brightness: Math.abs(brightnessA - brightnessB),
                color: colorDiff
            };
        };

        // `readable`
        // http://www.w3.org/TR/AERT#color-contrast
        // Ensure that foreground and background color combinations provide sufficient contrast.
        // *Example*
        //    tinycolor.readable("#000", "#111") => false
        tinycolor.readable = function(color1, color2) {
            var readability = tinycolor.readability(color1, color2);
            return readability.brightness > 125 && readability.color > 500;
        };

        // `mostReadable`
        // Given a base color and a list of possible foreground or background
        // colors for that base, returns the most readable color.
        // *Example*
        //    tinycolor.mostReadable("#123", ["#fff", "#000"]) => "#000"
        tinycolor.mostReadable = function(baseColor, colorList) {
            var bestColor = null;
            var bestScore = 0;
            var bestIsReadable = false;
            for (var i=0; i < colorList.length; i++) {

                // We normalize both around the "acceptable" breaking point,
                // but rank brightness constrast higher than hue.

                var readability = tinycolor.readability(baseColor, colorList[i]);
                var readable = readability.brightness > 125 && readability.color > 500;
                var score = 3 * (readability.brightness / 125) + (readability.color / 500);

                if ((readable && ! bestIsReadable) ||
                    (readable && bestIsReadable && score > bestScore) ||
                    ((! readable) && (! bestIsReadable) && score > bestScore)) {
                    bestIsReadable = readable;
                    bestScore = score;
                    bestColor = tinycolor(colorList[i]);
                }
            }
            return bestColor;
        };


        // Big List of Colors
        // ------------------
        // <http://www.w3.org/TR/css3-color/#svg-color>
        var names = tinycolor.names = {
            aliceblue: "f0f8ff",
            antiquewhite: "faebd7",
            aqua: "0ff",
            aquamarine: "7fffd4",
            azure: "f0ffff",
            beige: "f5f5dc",
            bisque: "ffe4c4",
            black: "000",
            blanchedalmond: "ffebcd",
            blue: "00f",
            blueviolet: "8a2be2",
            brown: "a52a2a",
            burlywood: "deb887",
            burntsienna: "ea7e5d",
            cadetblue: "5f9ea0",
            chartreuse: "7fff00",
            chocolate: "d2691e",
            coral: "ff7f50",
            cornflowerblue: "6495ed",
            cornsilk: "fff8dc",
            crimson: "dc143c",
            cyan: "0ff",
            darkblue: "00008b",
            darkcyan: "008b8b",
            darkgoldenrod: "b8860b",
            darkgray: "a9a9a9",
            darkgreen: "006400",
            darkgrey: "a9a9a9",
            darkkhaki: "bdb76b",
            darkmagenta: "8b008b",
            darkolivegreen: "556b2f",
            darkorange: "ff8c00",
            darkorchid: "9932cc",
            darkred: "8b0000",
            darksalmon: "e9967a",
            darkseagreen: "8fbc8f",
            darkslateblue: "483d8b",
            darkslategray: "2f4f4f",
            darkslategrey: "2f4f4f",
            darkturquoise: "00ced1",
            darkviolet: "9400d3",
            deeppink: "ff1493",
            deepskyblue: "00bfff",
            dimgray: "696969",
            dimgrey: "696969",
            dodgerblue: "1e90ff",
            firebrick: "b22222",
            floralwhite: "fffaf0",
            forestgreen: "228b22",
            fuchsia: "f0f",
            gainsboro: "dcdcdc",
            ghostwhite: "f8f8ff",
            gold: "ffd700",
            goldenrod: "daa520",
            gray: "808080",
            green: "008000",
            greenyellow: "adff2f",
            grey: "808080",
            honeydew: "f0fff0",
            hotpink: "ff69b4",
            indianred: "cd5c5c",
            indigo: "4b0082",
            ivory: "fffff0",
            khaki: "f0e68c",
            lavender: "e6e6fa",
            lavenderblush: "fff0f5",
            lawngreen: "7cfc00",
            lemonchiffon: "fffacd",
            lightblue: "add8e6",
            lightcoral: "f08080",
            lightcyan: "e0ffff",
            lightgoldenrodyellow: "fafad2",
            lightgray: "d3d3d3",
            lightgreen: "90ee90",
            lightgrey: "d3d3d3",
            lightpink: "ffb6c1",
            lightsalmon: "ffa07a",
            lightseagreen: "20b2aa",
            lightskyblue: "87cefa",
            lightslategray: "789",
            lightslategrey: "789",
            lightsteelblue: "b0c4de",
            lightyellow: "ffffe0",
            lime: "0f0",
            limegreen: "32cd32",
            linen: "faf0e6",
            magenta: "f0f",
            maroon: "800000",
            mediumaquamarine: "66cdaa",
            mediumblue: "0000cd",
            mediumorchid: "ba55d3",
            mediumpurple: "9370db",
            mediumseagreen: "3cb371",
            mediumslateblue: "7b68ee",
            mediumspringgreen: "00fa9a",
            mediumturquoise: "48d1cc",
            mediumvioletred: "c71585",
            midnightblue: "191970",
            mintcream: "f5fffa",
            mistyrose: "ffe4e1",
            moccasin: "ffe4b5",
            navajowhite: "ffdead",
            navy: "000080",
            oldlace: "fdf5e6",
            olive: "808000",
            olivedrab: "6b8e23",
            orange: "ffa500",
            orangered: "ff4500",
            orchid: "da70d6",
            palegoldenrod: "eee8aa",
            palegreen: "98fb98",
            paleturquoise: "afeeee",
            palevioletred: "db7093",
            papayawhip: "ffefd5",
            peachpuff: "ffdab9",
            peru: "cd853f",
            pink: "ffc0cb",
            plum: "dda0dd",
            powderblue: "b0e0e6",
            purple: "800080",
            red: "f00",
            rosybrown: "bc8f8f",
            royalblue: "4169e1",
            saddlebrown: "8b4513",
            salmon: "fa8072",
            sandybrown: "f4a460",
            seagreen: "2e8b57",
            seashell: "fff5ee",
            sienna: "a0522d",
            silver: "c0c0c0",
            skyblue: "87ceeb",
            slateblue: "6a5acd",
            slategray: "708090",
            slategrey: "708090",
            snow: "fffafa",
            springgreen: "00ff7f",
            steelblue: "4682b4",
            tan: "d2b48c",
            teal: "008080",
            thistle: "d8bfd8",
            tomato: "ff6347",
            turquoise: "40e0d0",
            violet: "ee82ee",
            wheat: "f5deb3",
            white: "fff",
            whitesmoke: "f5f5f5",
            yellow: "ff0",
            yellowgreen: "9acd32"
        };

        // Make it easy to access colors via `hexNames[hex]`
        var hexNames = tinycolor.hexNames = flip(names);


        // Utilities
        // ---------

        // `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`
        function flip(o) {
            var flipped = { };
            for (var i in o) {
                if (o.hasOwnProperty(i)) {
                    flipped[o[i]] = i;
                }
            }
            return flipped;
        }

        // Take input from [0, n] and return it as [0, 1]
        function bound01(n, max) {
            if (isOnePointZero(n)) { n = "100%"; }

            var processPercent = isPercentage(n);
            n = mathMin(max, mathMax(0, parseFloat(n)));

            // Automatically convert percentage into number
            if (processPercent) {
                n = parseInt(n * max, 10) / 100;
            }

            // Handle floating point rounding errors
            if ((math.abs(n - max) < 0.000001)) {
                return 1;
            }

            // Convert into [0, 1] range if it isn't already
            return (n % max) / parseFloat(max);
        }

        // Force a number between 0 and 1
        function clamp01(val) {
            return mathMin(1, mathMax(0, val));
        }

        // Parse an integer into hex
        function parseHex(val) {
            return parseInt(val, 16);
        }

        // Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1
        // <http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>
        function isOnePointZero(n) {
            return typeof n == "string" && n.indexOf('.') != -1 && parseFloat(n) === 1;
        }

        // Check to see if string passed in is a percentage
        function isPercentage(n) {
            return typeof n === "string" && n.indexOf('%') != -1;
        }

        // Force a hex value to have 2 characters
        function pad2(c) {
            return c.length == 1 ? '0' + c : '' + c;
        }

        // Replace a decimal with it's percentage value
        function convertToPercentage(n) {
            if (n <= 1) {
                n = (n * 100) + "%";
            }

            return n;
        }

        var matchers = (function() {

            // <http://www.w3.org/TR/css3-values/#integers>
            var CSS_INTEGER = "[-\\+]?\\d+%?";

            // <http://www.w3.org/TR/css3-values/#number-value>
            var CSS_NUMBER = "[-\\+]?\\d*\\.\\d+%?";

            // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.
            var CSS_UNIT = "(?:" + CSS_NUMBER + ")|(?:" + CSS_INTEGER + ")";

            // Actual matching.
            // Parentheses and commas are optional, but not required.
            // Whitespace can take the place of commas or opening paren
            var PERMISSIVE_MATCH3 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";
            var PERMISSIVE_MATCH4 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";

            return {
                rgb: new RegExp("rgb" + PERMISSIVE_MATCH3),
                rgba: new RegExp("rgba" + PERMISSIVE_MATCH4),
                hsl: new RegExp("hsl" + PERMISSIVE_MATCH3),
                hsla: new RegExp("hsla" + PERMISSIVE_MATCH4),
                hsv: new RegExp("hsv" + PERMISSIVE_MATCH3),
                hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,
                hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/
            };
        })();

        // `stringInputToObject`
        // Permissive string parsing.  Take in a number of formats, and output an object
        // based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`
        function stringInputToObject(color) {

            color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();
            var named = false;
            if (names[color]) {
                color = names[color];
                named = true;
            }
            else if (color == 'transparent') {
                return { r: 0, g: 0, b: 0, a: 0 };
            }

            // Try to match string input using regular expressions.
            // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]
            // Just return an object and let the conversion functions handle that.
            // This way the result will be the same whether the tinycolor is initialized with string or object.
            var match;
            if ((match = matchers.rgb.exec(color))) {
                return { r: match[1], g: match[2], b: match[3] };
            }
            if ((match = matchers.rgba.exec(color))) {
                return { r: match[1], g: match[2], b: match[3], a: match[4] };
            }
            if ((match = matchers.hsl.exec(color))) {
                return { h: match[1], s: match[2], l: match[3] };
            }
            if ((match = matchers.hsla.exec(color))) {
                return { h: match[1], s: match[2], l: match[3], a: match[4] };
            }
            if ((match = matchers.hsv.exec(color))) {
                return { h: match[1], s: match[2], v: match[3] };
            }
            if ((match = matchers.hex6.exec(color))) {
                return {
                    r: parseHex(match[1]),
                    g: parseHex(match[2]),
                    b: parseHex(match[3]),
                    format: named ? "name" : "hex"
                };
            }
            if ((match = matchers.hex3.exec(color))) {
                return {
                    r: parseHex(match[1] + '' + match[1]),
                    g: parseHex(match[2] + '' + match[2]),
                    b: parseHex(match[3] + '' + match[3]),
                    format: named ? "name" : "hex"
                };
            }

            return false;
        }

        root.tinycolor = tinycolor;

    })(this);

    $(function () {
        if ($.fn.spectrum.load) {
            $.fn.spectrum.processNativeColorInputs();
        }
    });

})(window, jQuery);

define("libs/spectrum", function(){});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/backbone-forms/color',['libs/backbone-forms', 'libs/modernizr', 'libs/spectrum'], function(Form) {
    return Form.editors.Color = (function(_super) {
      __extends(Color, _super);

      function Color() {
        return Color.__super__.constructor.apply(this, arguments);
      }

      Color.prototype.events = {
        'change  input[type=color]': 'onColorChange',
        'change  input[type=text]': 'onTextChange',
        'keyup   input[type=text]': 'onTextChange',
        'keydown input[type=text]': 'onTextChange',
        focus: 'onFocus',
        blur: 'onBlur'
      };

      Color.prototype.onColorChange = function() {
        return this.setPickerColor(this.$colorInput().val());
      };

      Color.prototype.onTextChange = function() {
        this.color = this.$textInput().val();
        this.$colorInput().val(this.color);
        return this.trigger('change', this);
      };

      Color.prototype.onFocus = function() {
        return this.trigger('focus', this);
      };

      Color.prototype.onBlur = function() {
        return this.trigger('blur', this);
      };

      Color.prototype.render = function() {
        this.$el.html(this.$colorInput());
        if (!Modernizr.inputtypes.color) {
          this.$colorInput().spectrum({
            color: this.value,
            move: (function(_this) {
              return function(color) {
                return _this.setPickerColor("#" + color.toHex());
              };
            })(this)
          });
        }
        this.$el.append(this.$textInput());
        this.setValue(this.value);
        return this;
      };

      Color.prototype.setPickerColor = function(color) {
        this.color = color;
        this.$textInput().val(this.color);
        return this.trigger('change', this);
      };

      Color.prototype.$colorInput = function() {
        return this._colorInput != null ? this._colorInput : this._colorInput = $('<input class="input-color-color" type="color"></input>');
      };

      Color.prototype.$textInput = function() {
        return this._textInput != null ? this._textInput : this._textInput = $('<input class="input-color-text" type="text"></input>');
      };

      Color.prototype.getValue = function() {
        return this.color;
      };

      Color.prototype.setValue = function(color) {
        this.color = color;
        this.$colorInput().val(this.color);
        return this.$textInput().val(this.color);
      };

      Color.prototype.focus = function() {
        if (!this.hasFocus) {
          return this.$colorInput().focus();
        }
      };

      Color.prototype.blur = function() {
        if (this.hasFocus) {
          return this.$colorInput().blur();
        }
      };

      return Color;

    })(Form.editors.Base);
  });

}).call(this);

// # clayer
// **clayer** is a lightweight library for highly interactive websites.
// It provides an abstraction for mouse and (multi-)touch events, and high-level widgets.
// Clayer is based on the internal library of <worrydream.com>, Bret Victor's website, called *BVLayer* or *LayerScript*.
// You can pick and choose what you like from this library and adapt it to your own needs.
// We believe it is more useful to have a simple, readable library that you can fully understand and modify, than having a large and configurable library.

/*jshint jquery:true */
(function () {
  
  define('libs/clayer',[], function(){
    // ## Helper functions

    // Clayer uses the `clayer` global object.
    var clayer = {};
    window.clayer = clayer;

    // Modify `clayer.texts` to internationalize strings.
    clayer.texts = {
      drag: 'drag'
    };

    // `clayer.makeCall()` is used for only calling callbacks if they exist.
    clayer.makeCall = function(obj, func, args) {
      if (obj[func]) {
        return obj[func].apply(obj, args);
      }
    };

    // `clayer.setCss3()` can be used to apply proprietary CSS extensions.
    // The prefixes of the major browsers are added before the name of the attribute.
    // If `addBrowserToValue` is true, it is also added before the value, which is useful for some attributes such as transitions.
    clayer.setCss3 = function($element, name, value, addBrowserToValue) {
      addBrowserToValue = addBrowserToValue || false;
      var browsers = ['', '-ms-', '-moz-', '-webkit-', '-o-'];
      for (var i=0; i<browsers.length; i++) {
        var cssName = browsers[i] + name;
        var cssValue = (addBrowserToValue ? browsers[i] : '') + value;
        $element.css(cssName, cssValue);
      }
    };

    // `clayer.isTouch` is true or false depending on whether the browser supports touch events.
    clayer.isTouch = ('ontouchstart' in document.documentElement);

    // When `clayer.initBody()` is called, the body element is given a `clayer-body-touch` or `clayer-body-mouse` class, depending on `clayer.isTouch`.
    clayer.initBody = function() {
      if (clayer.isTouch) {
        $('body').addClass('clayer-body-touch');
      } else {
        $('body').addClass('clayer-body-mouse');
      }
    };

    // ## Touchable
    // `clayer.Touchable` provides an abstraction over touch and mouse events.
    // We make a distinction between hover and touch/click events. First we look at the latter.
    //
    clayer.Touchable = function() { return this.init.apply(this, arguments); };
    clayer.Touchable.prototype = {
      init: function($element, callbacks) {
        this.$element = $element;
        this.$document = $($element[0].ownerDocument);
        this.callbacks = callbacks;

        this.mouseDown = $.proxy(this.mouseDown, this);
        this.mouseMove = $.proxy(this.mouseMove, this);
        this.mouseUp = $.proxy(this.mouseUp, this);
        this.touchStart = $.proxy(this.touchStart, this);
        this.touchMove = $.proxy(this.touchMove, this);
        this.touchEnd = $.proxy(this.touchEnd, this);
        this.hoverMove = $.proxy(this.hoverMove, this);
        this.hoverLeave = $.proxy(this.hoverLeave, this);

        this.documentEvents = {
          mousemove: this.mouseMove,
          mouseup: this.mouseUp,
          touchmove: this.touchMove,
          touchend: this.touchEnd,
          touchcancel: this.touchEnd
        };

        this.setTouchable(false);
        this.setHoverable(false);
      },

      remove: function() {
        this.setTouchable(false);
        this.setHoverable(false);
      },

      setTouchable: function(isTouchable) {
        if (this.isTouchable === isTouchable) return;
        this.isTouchable = isTouchable;
        this.touchEvent = null;

        if (isTouchable) {
          this.$element.on({
            mousedown: this.mouseDown,
            touchstart: this.touchStart
          });
        }
        else {
          this.$element.off('mousedown touchstart');
          this.$document.off(this.documentEvents);
          // CSS3 "pointer-events: none" here? (not supported by IE)
        }
      },

      setHoverable: function(isHoverable) {
        if (this.isHoverable === isHoverable) return;
        this.isHoverable = isHoverable;
        this.hoverEvent = null;

        if (isHoverable) {
          this.$element.on({
            mousemove: this.hoverMove,
            mouseleave: this.hoverLeave
          });
        }
        else {
          this.$element.off({
            mousemove: this.hoverMove,
            mouseleave: this.hoverLeave
          });
          // CSS3 "pointer-events: none" here? (not supported by IE)
        }
      },

      mouseDown: function(event) {
        if (this.isTouchable) {
          this.$document.on({
            mousemove: this.mouseMove,
            mouseup: this.mouseUp
          });

          this.touchEvent = new clayer.PositionEvent(this.$element, event, event.timeStamp, true);
          clayer.makeCall(this.callbacks, 'touchDown', [this.touchEvent]);
        }
        return false;
      },

      mouseMove: function(event) {
        if (this.isTouchable && this.touchEvent) {
          this.touchEvent.move(event, event.timeStamp);
          clayer.makeCall(this.callbacks, 'touchMove', [this.touchEvent]);
        }
        return false;
      },

      mouseUp: function(event) {
        if (this.isTouchable && this.touchEvent) {
          this.touchEvent.up(event, event.timeStamp);
          clayer.makeCall(this.callbacks, 'touchUp', [this.touchEvent]);
          this.touchEvent = null;
        }
        this.$document.off(this.documentEvents);
        return false;
      },

      touchStart: function(event) {
        this.$element.off({
          'mousedown': this.mouseDown,
          'mousemove': this.hoverMove,
          'mouseleave': this.hoverLeave
        }); // we're on a touch device (safer than checking using clayer.isTouch)

        if (!this.isTouchable || this.touchEvent || event.originalEvent.targetTouches.length > 1) {
          this.touchEnd(event);
        } else {
          this.$document.on({
            touchmove: this.touchMove,
            touchend: this.touchEnd,
            touchcancel: this.touchEnd
          });

          this.touchEvent = new clayer.PositionEvent(this.$element, event.originalEvent.targetTouches[0], event.timeStamp, false);
          clayer.makeCall(this.callbacks, 'touchDown', [this.touchEvent]);
        }
        return false;
      },

      touchMove: function(event) {
        if (this.isTouchable && this.touchEvent) {
          var touchEvent = this.findTouchEvent(event.originalEvent.touches);
          if (touchEvent === null) {
            this.touchEnd(event);
          } else {
            this.touchEvent.move(touchEvent, event.timeStamp);
            clayer.makeCall(this.callbacks, 'touchMove', [this.touchEvent]);
          }
        }
        return false;
      },

      touchEnd: function(event) {
        if (this.isTouchable && this.touchEvent) {
          this.touchEvent.up(this.findTouchEvent(event.originalEvent.touches), event.timeStamp);
          clayer.makeCall(this.callbacks, 'touchUp', [this.touchEvent]);
          this.touchEvent = null;
        }
        this.$document.off(this.documentEvents);
        return false;
      },

      hoverMove: function(event) {
        if (this.touchEvent) {
          this.mouseMove(event);
        } else if (this.isHoverable) {
          if (!this.hoverEvent) {
            this.hoverEvent = new clayer.PositionEvent(this.$element, event, true);
          } else {
            this.hoverEvent.move(event, event.timeStamp);
          }
          clayer.makeCall(this.callbacks, 'hoverMove', [this.hoverEvent]);
        }
        return false;
      },

      hoverLeave: function(event) {
        if (this.isHoverable && this.hoverEvent) {
          this.hoverEvent.move(event);
          clayer.makeCall(this.callbacks, 'hoverLeave', [this.hoverEvent]);
          this.hoverEvent = null;
        }
        return false;
      },

      findTouchEvent: function(touches) {
        for (var i=0; i<touches.length; i++) {
          if (touches[i].identifier === this.touchEvent.event.identifier) {
            return touches[i];
          }
        }
        return null;
      }
    };

    clayer.PositionEvent = function() { return this.init.apply(this, arguments); };
    clayer.PositionEvent.prototype = {
      init: function($element, event, timestamp, mouse) {
        this.$element = $element;
        this.globalPoint = { x: event.pageX, y: event.pageY };
        this.translation = { x: 0, y: 0 };
        this.deltaTranslation = { x: 0, y: 0 };
        this.localPoint = { x: 0, y: 0 };
        this.updateLocalPoint();

        this.event = event;
        this.startTimestamp = this.timestamp = timestamp;
        this.hasMoved = false;
        this.wasTap = false;
        this.mouse = mouse;
      },

      getTimeSinceGoingDown: function () {
        return this.timestamp - this.startTimestamp;
      },

      resetDeltaTranslation: function() {
        this.deltaTranslation.x = 0;
        this.deltaTranslation.y = 0;
      },

      inElement: function() {
        return this.localPoint.x >= 0 && this.localPoint.x <= this.$element.outerWidth() &&
          this.localPoint.y >= 0 && this.localPoint.y <= this.$element.outerHeight();
      },

      move: function(event, timestamp) {
        this.event = event;
        this.timestamp = timestamp;
        this.updatePositions();
      },

      up: function(event, timestamp) {
        this.event = event || this.event;
        this.timestamp = timestamp;
        this.wasTap = !this.hasMoved && (this.getTimeSinceGoingDown() < 300);
      },

      updatePositions: function() {
        var dx = this.event.pageX - this.globalPoint.x;
        var dy = this.event.pageY - this.globalPoint.y;
        this.translation.x += dx;
        this.translation.y += dy;
        this.deltaTranslation.x += dx;
        this.deltaTranslation.y += dy;
        this.globalPoint.x = this.event.pageX;
        this.globalPoint.y = this.event.pageY;
        this.updateLocalPoint();

        if (this.translation.x*this.translation.x + this.translation.y*this.translation.y > 200) this.hasMoved = true;
      },

      updateLocalPoint: function() {
        var offset = this.$element.offset();
        this.localPoint.x = this.globalPoint.x - offset.left;
        this.localPoint.y = this.globalPoint.y - offset.top;
      }
    };

    clayer.Scrubbable = function() { return this.init.apply(this, arguments); };
    clayer.Scrubbable.prototype = {
      init: function($element, callbacks, options) {
        this.$element = $element;
        this.callbacks = callbacks;
        this.options = options || {};
        this.touchable = new clayer.Touchable($element, this);
        this.setScrubbable(true);
      },

      remove: function() {
        this.touchable.remove();
      },

      setScrubbable: function(value) {
        this.touchable.setTouchable(value);

        if (this.options.disableHover) {
          this.touchable.setHoverable(false);
        } else {
          this.touchable.setHoverable(value);
        }
      },

      hoverMove: function(event) {
        clayer.makeCall(this.callbacks, 'scrubMove', [event.localPoint.x, event.localPoint.y, false]);
      },

      hoverLeave: function(event) {
        clayer.makeCall(this.callbacks, 'scrubLeave', []);
      },

      touchDown: function(event) {
        this.touchMove(event);
      },

      touchMove: function(event) {
        clayer.makeCall(this.callbacks, 'scrubMove', [event.localPoint.x, event.localPoint.y, true]);
      },

      touchUp: function(event) {
        if (!event.mouse || !event.inElement()) {
          clayer.makeCall(this.callbacks, 'scrubLeave', []);
        } else {
          this.hoverMove(event);
        }
        if (event.wasTap) {
          clayer.makeCall(this.callbacks, 'scrubTap', [event.localPoint.x, event.localPoint.y]);
        }
      }
    };

    clayer.Slider = function() { return this.init.apply(this, arguments); };
    clayer.Slider.prototype = {
      init: function($element, callbacks, valueWidth, options) {
        this.$element = $element;
        this.$element.addClass('clayer-slider');
        this.callbacks = callbacks;

        this.valueWidth = valueWidth || 1;
        this.markerValue = 0;
        this.knobValue = 0;

        this.$container = $('<div class="clayer-slider-container"></div>');
        this.$element.append(this.$container);

        this.$bar = $('<div class="clayer-slider-bar"></div>');
        this.$container.append(this.$bar);

        this.$segmentContainer = $('<div class="clayer-slider-segment-container"></div>');
        this.$bar.append(this.$segmentContainer);

        this.$marker = $('<div class="clayer-slider-marker"></div>');
        this.markerWidth = Math.min(this.valueWidth, 10);
        this.$marker.width(this.markerWidth);
        this.$bar.append(this.$marker);

        this.$knob = $('<div class="clayer-slider-knob"></div>');
        this.$container.append(this.$knob);

        this.scrubbable = new clayer.Scrubbable(this.$element, this, options);

        this.bounceTimer = null;

        this.renderKnob();
        this.renderMarker();
      },

      remove: function() {
        this.scrubbable.remove();
        this.$segmentContainer.remove();
        this.$marker.remove();
        this.$knob.remove();
        this.$bar.remove();
        this.$container.remove();
      },

      setSegments: function(ranges) {
        this.$segmentContainer.html('');
        for (var i=0; i<ranges.length; i++) {
          var range = ranges[i];
          var $segment = $('<div class="clayer-slider-segment"></div>');
          this.$segmentContainer.append($segment);

          $segment.css('left', range.start*this.valueWidth);
          $segment.width((range.end - range.start + 1)*this.valueWidth);
          $segment.css('background-color', range.color);
        }
      },

      setValue: function(value) {
        this.markerValue = this.knobValue = value;
        this.renderKnob();
        this.renderMarker();
      },

      setKnobValue: function(value) {
        this.knobValue = value;
        this.renderKnob();
      },

      changed: function(down) {
        clayer.makeCall(this.callbacks, 'sliderChanged', [this.knobValue, down]);
      },

      updateKnob: function(x) {
        x = Math.max(0, Math.min(this.$element.width()-1, x));
        this.updateKnobValue(Math.floor(x/this.valueWidth));
      },

      updateKnobValue: function(knobValue) {
        if (this.knobValue !== knobValue) {
          this.knobValue = knobValue;
          this.renderKnob();
          this.changed(false);
        }
      },

      updateMarker: function(x) {
        x = Math.max(0, Math.min(this.$element.width()-1, x));
        var markerValue = Math.floor(x/this.valueWidth);
        if (this.markerValue !== markerValue) {
          this.knobValue = this.markerValue = markerValue;
          this.renderKnob();
          this.renderMarker();
          this.changed(true);
        }
      },

      renderKnob: function() {
        this.$knob.css('left', (this.knobValue+0.5)*this.valueWidth);
      },

      renderMarker: function() {
        this.$marker.css('left', (this.markerValue+0.5)*this.valueWidth - this.markerWidth/2);
      },

      scrubMove: function(x, y, down) {
        this.$knob.addClass('clayer-active');
        if (down) {
          this.$knob.addClass('clayer-pressed');
          this.updateMarker(x);
        } else {
          this.$knob.removeClass('clayer-pressed');
          this.updateKnob(x);
        }
      },

      scrubLeave: function() {
        this.$knob.removeClass('clayer-active clayer-pressed');
        this.updateKnobValue(this.markerValue);
        clayer.makeCall(this.callbacks, 'sliderLeave');
      },

      scrubTap: function() {
        this.$knob.removeClass('clayer-slider-knob-jump');
        setTimeout($.proxy(this.startJump, this), 0);
      },

      startJump: function() {
        this.$knob.addClass('clayer-slider-knob-jump');
      }
    };

    clayer.Draggable = function() { return this.init.apply(this, arguments); };
    clayer.Draggable.prototype = {
      init: function($element, callbacks, $parent) {
        this.$element = $element;
        this.callbacks = callbacks;
        this.$parent = $parent;
        this.touchable = new clayer.Touchable($element, this);
        this.setDraggable(true);
      },

      remove: function() {
        this.touchable.remove();
      },

      setDraggable: function(value) {
        this.touchable.setTouchable(value);
        this.touchable.setHoverable(false);
      },

      touchDown: function(event) {
        this.offsetX = event.localPoint.x + parseInt(this.$element.css('margin-left'), 10);
        this.offsetY = event.localPoint.y + parseInt(this.$element.css('margin-top'), 10);
        clayer.makeCall(this.callbacks, 'dragStart', [this.offsetX, this.offsetY]);
      },

      touchMove: function(event) {
        var x = event.globalPoint.x-this.offsetX, y = event.globalPoint.y-this.offsetY;

        if (this.$parent !== undefined) {
          var parentOffset = this.$parent.offset();
          x = Math.max(0, Math.min(this.$parent.outerWidth(), x-parentOffset.left));
          y = Math.max(0, Math.min(this.$parent.outerHeight(), y-parentOffset.top));
          this.$element.css('left', x);
          this.$element.css('top', y);
          clayer.makeCall(this.callbacks, 'dragMove', [x, y, event.globalPoint.x, event.globalPoint.y]);
        } else {
          clayer.makeCall(this.callbacks, 'dragMove', [x, y, event.globalPoint.x, event.globalPoint.y]);
        }
      },

      touchUp: function(event) {
        clayer.makeCall(this.callbacks, 'dragEnd');
        if (event.wasTap) {
          clayer.makeCall(this.callbacks, 'dragTap', [event.localPoint.x, event.localPoint.y]);
        }
      }
    };

    clayer.DragKnob = function() { return this.init.apply(this, arguments); };
    clayer.DragKnob.prototype = {
      init: function($element, callbacks, $parent) {
        this.$element = $element;
        this.$element.addClass('clayer-dragknob');
        this.$element.append('<div class="clayer-dragknob-label">' + clayer.texts.drag + '</div>');

        this.$parent = $parent;
        if (this.$parent !== undefined) {
          this.$parent.addClass('clayer-dragknob-parent');
        }

        this.callbacks = callbacks;
        this.draggable = new clayer.Draggable($element, this, $parent);
      },

      remove: function() {
        this.draggable.remove();
        this.$element.removeClass('clayer-dragknob');
        if (this.$parent !== undefined) {
          this.$parent.addClass('clayer-dragknob-parent');
        }
      },

      dragStart: function() {
        this.$element.addClass('clayer-pressed');
        this.$element.removeClass('clayer-dragknob-show-label');
        clayer.makeCall(this.callbacks, 'dragStart');
      },

      dragMove: function(x, y) {
        clayer.makeCall(this.callbacks, 'dragMove', arguments);
      },

      dragEnd: function() {
        this.$element.removeClass('clayer-pressed');
        clayer.makeCall(this.callbacks, 'dragEnd');
      },

      dragTap: function() {
        this.$element.addClass('clayer-dragknob-show-label');
        clayer.makeCall(this.callbacks, 'dragTap');
      }
    };

    return clayer;
  });
})();

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/backbone-forms/range',['cdn.jquery', 'libs/backbone-forms', 'libs/clayer'], function($, Form, clayer) {
    return Form.editors.Range = (function(_super) {
      __extends(Range, _super);

      function Range() {
        return Range.__super__.constructor.apply(this, arguments);
      }

      Range.prototype.width = 210;

      Range.prototype.initialize = function(options) {
        Range.__super__.initialize.call(this, options);
        this.min = this.schema.min || 0;
        this.max = this.schema.max || 100;
        return this.step = this.schema.step || 1;
      };

      Range.prototype.render = function() {
        var range;
        this.$el.width(this.width);
        range = (this.max - this.min) / this.step + 1;
        this.slider = new clayer.Slider(this.$el, this, this.width / range, {
          disableHover: true
        });
        this.$knob = $('<div class="clayer-slider-knob-value"></div>');
        this.$('.clayer-slider-knob').append(this.$knob);
        this.setValue(this.value || 0);
        return this;
      };

      Range.prototype.sliderChanged = function(value) {
        var decs, val;
        decs = this._decimalPlaces();
        val = Number((value * this.step + this.min).toFixed(decs));
        this.sliderValue = this._clamp(val);
        this.updateKnob();
        return this.trigger('change', this);
      };

      Range.prototype._decimalPlaces = function() {
        var decimals;
        decimals = ('' + this.step).split('.')[1] || '';
        return decimals.length;
      };

      Range.prototype._clamp = function(val) {
        return Math.min(this.max, Math.max(this.min, val));
      };

      Range.prototype.getValue = function() {
        return this.sliderValue;
      };

      Range.prototype.setValue = function(value) {
        this.sliderValue = value;
        this.slider.setValue((value - this.min) / this.step);
        return this.updateKnob();
      };

      Range.prototype.updateKnob = function() {
        return this.$knob.text(this.sliderValue);
      };

      Range.prototype.focus = function() {
        if (this.hasFocus) {

        }
      };

      Range.prototype.blur = function() {
        if (!this.hasFocus) {

        }
      };

      return Range;

    })(Form.editors.Base);
  });

}).call(this);

/* From https://github.com/Versal/Tags */

/** 
 * Simple autocomplete plugin
 * with full keyboard navigation. 
 * works great with the tagbox plugin
 * 
 * @author Bastian Allgeier <bastian@getkirby.com>
 * @copyright Bastian Allgeier 2012
 * @license MIT
 */
(function($) {

  $.autocomplete = function(element, url, options) {

    var defaults = {
      url : false,
      apply : function(string) { $element.val(string) }
    }

    var plugin = this;

    plugin.settings = {}

    var $element = $(element),
         element = element;

    plugin.init = function() {

      plugin.settings = $.extend({}, defaults, options);

      plugin.input  = $element;
      plugin.ignore = [];
      plugin.data   = {};     
      plugin.open   = false;

      plugin.load();
      
      plugin.blocker = $('<div class="autocomplete-blocker"></div>').css({'position' : 'fixed', 'top' : 0, 'left' : 0, 'right' : 0, 'bottom' : 0, 'z-index' : 1999}).hide();
      plugin.box     = $('<div class="autocomplete"></div>').css('z-index', 2000);
      plugin.tooltip = $('<div class="versal-tooltip versal-tooltip-white versal-tooltip-top versal-tooltip-align-left versal-tooltip-offset"><div class="versal-tooltip-arrow"></div></div>');
      plugin.box.append(plugin.tooltip);
      plugin.ul      = $('<ul></ul>');
      plugin.tooltip.hide();

      plugin.blocker.click(function(e) {
        plugin.kill();
        plugin.input.focus();
        e.stopPropagation();
      });
    
      $element.keyup(function(e) {
                
        plugin.pos = plugin.selection();        
                
        switch(e.keyCode) {
          case 13: // enter
            plugin.apply();
          case 27: // esc
            plugin.kill();
          case 38: // up
          case 40: // down
            return false;
          case 39: // right
            var value = plugin.value();
            if(value.length > 0 && plugin.pos == plugin.input.val().length) plugin.apply();
            break;
          case 188: // ,
            plugin.apply();
          default: 
            plugin.complete($(this).val());
            break;
        }

      });
      
      $element.keydown(function(e) {

        plugin.pos = plugin.selection();        

        switch(e.keyCode) {
          case 9:  // tab
            if(plugin.value().length > 0) {
              plugin.apply(); 
              return false;
            } else { 
              return true;
            }
            break;
          case 38: // up
            plugin.prev();
            return false;
          case 40: // down
            plugin.next();
            return false;
        }     
      });

      plugin.box.click(function(e) {
        e.stopPropagation();
      });
            
      $('body').append(plugin.box);
      $('body').append(plugin.blocker);
    
      $(window).resize(plugin.position);
      plugin.position();

    }
  
    plugin.load = function() {

      if(typeof url == 'object') {
        plugin.data = url;      
      } else {
        $.getJSON(url, function(result) {
          plugin.data = result;
        });
      }     

    }

    plugin.complete = function(search) {
    
      plugin.kill();
      plugin.position();

      var counter = 0;
      var search  = $.trim(search); 

      if(search.length == 0) return false;

      var reg = new RegExp('^' + search, 'i');

      var result = plugin.data.filter(function(str) {
        if(plugin.ignore.indexOf(str) == -1 && str.match(reg)) return str;
      });
      
      result = result.slice(0,5);
                                  
      $.each(result, function(i, string) {

        var highlightedString = '<span class="autocomplete-highlight">' +
          string.substring(0, search.length) +
          '</span>' + string.substring(search.length);

        var li = $('<li>' + highlightedString + '</li>');
        
        li.click(function() {
          plugin.apply(string)
        });
        
        li.mouseover(function() {
          plugin.ul.find('.selected').removeClass('selected');
          li.addClass('over');          
        });

        li.mouseout(function() {
          li.removeClass('over');
        });
        
        plugin.ul.append(li);

        if(counter==0) li.addClass('first selected');
        counter++;
                      
      });
      
      if(counter > 0) {
        plugin.tooltip.append(plugin.ul);        
        plugin.tooltip.show();
        plugin.blocker.show();
        plugin.open = true;
      }     
    }
        
    plugin.kill = function() {
      plugin.blocker.hide();
      plugin.ul.empty();
      plugin.tooltip.hide();
      plugin.open = false;
    }
    
    plugin.apply = function(string) {
      if(!string) {
        var string = plugin.value();
      } 
      plugin.settings.apply.call(plugin, string);
    }
    
    plugin.value = function() {
      return plugin.selected().text();
    }
    
    plugin.selected = function() {
      return plugin.ul.find('.selected');
    }
    
    plugin.select = function(element) {
      plugin.deselect();      
      element.addClass('selected');
    }
    
    plugin.deselect = function() {
      plugin.selected().removeClass('selected');
    }
    
    plugin.prev = function() {
      var sel  = plugin.selected();
      var prev = sel.prev();
      if(prev.length > 0) plugin.select(prev);
    }
    
    plugin.next = function() {
      var sel  = plugin.selected();   
      var next = (sel.length > 0) ? sel.next() : plugin.ul.find('li:first-child');
      if(next.length > 0) plugin.select(next);
    }

    plugin.selection = function() {
      var i = plugin.input[0];
      var v = plugin.val;
      if(!i.createTextRange) return i.selectionStart;
      var r = document.selection.createRange().duplicate();
      r.moveEnd('character', v.length);
      if(r.text == '') return v.length;
      return v.lastIndexOf(r.text);
    }

    plugin.position = function() {
      
      var pos    = $element.offset();
      var height = $element.innerHeight();

      pos.top = pos.top+height;
            
      plugin.box.css(pos);
          
    }
  
    plugin.init();
    
  }

  $.fn.autocomplete = function(url, options) {

    return this.each(function() {
      if(undefined == $(this).data('autocomplete')) {
        var plugin = new $.autocomplete(this, url, options);
        $(this).data('autocomplete', plugin);
      }
    });

  }

})(jQuery);


/** 
 * Tag input plugin
 * works great with the autocomplete plugin
 * 
 * @author Bastian Allgeier <bastian@getkirby.com>
 * @copyright Bastian Allgeier 2012
 * @license MIT
 */
(function($) {

  $.tagbox = function(element, options) {

    var defaults = {
      url          : false,
      autocomplete : {},
      lowercase    : true,
      classname    : 'tagbox',
      separator    : ', ',
      duplicates   : false,
      minLength    : 1,
      maxLength    : 140,
      keydown      : function() { },
      onAdd        : function() { },
      onRemove     : function() { },
      onDuplicate  : function() { return plugin.input.focus() },
      onInvalid    : function() { return plugin.input.focus() },
      onReady      : function() { }
    }

    var plugin = this;
    var autocomplete = null;

    plugin.settings = {}

    var $element = $(element),
         element = element;

    plugin.init = function() {
      plugin.settings = $.extend({}, defaults, options);

      var $name = $element.attr('name');
      var $id   = $element.attr('id');
      var $val  = $element.val();

      plugin.index   = [];
      plugin.val     = '';
      plugin.focused = false;
      plugin.origin  = $element.addClass('tagboxified').hide();
      plugin.box     = $('<div class="' + plugin.settings.classname + '"><ul><li class="new"><input autocomplete="off" tabindex="0" type="text" /></li></ul></div>');
      plugin.input   = plugin.box.find('input').css('width', 20);
      plugin.bhits   = 0;
      plugin.lhits   = 0;
            
      if(plugin.settings.url) {

        var autocompleteDefaults = {
          apply : function(string) {
            plugin.add(string); 
            this.kill();
            plugin.input.focus();
          }        
        };
        
        // initialize the autocomplete plugins with a default event
        plugin.input.autocomplete(plugin.settings.url, $.extend({}, autocompleteDefaults, plugin.settings.autocomplete));
        
        // store the autocomplete plugin object        
        plugin.autocomplete = plugin.input.data('autocomplete');
        
        // add autocomplete custom events to the tagbox plugin                
        plugin.settings.onAdd = function(tag) {
          plugin.autocomplete.ignore = plugin.serialize();
        }
        plugin.settings.onRemove = function(tag) {
          plugin.autocomplete.ignore = plugin.serialize();
        }
      
      }      

      plugin.origin.before(plugin.box);
    
      plugin.measure = $('<div style="display: inline" />').css({
        'font-size'   : plugin.input.css('font-size'),
        'font-family' : plugin.input.css('font-family'),
        'visibility'  : 'hidden',
        'position'    : 'absolute',
        'top'         : -10000,
        'left'        : -10000
      });

      $('body').append(plugin.measure);
                  
      plugin.box.click(function(e) {
        plugin.focus();
        plugin.input.focus();
        e.stopPropagation();
      });
      plugin.input.keydown(function(e) {
        plugin.val = plugin.input.val();
        plugin.position = plugin.selection();                                               
        plugin.settings.keydown.call(plugin, e, plugin.val);
      });
      plugin.input.keyup(function(e) {
        plugin.val = plugin.input.val();
        plugin.position = plugin.selection();                                               
        plugin.resize(plugin.val);
        if(plugin.val.match(new RegExp(plugin.settings.separator))) plugin.add(plugin.val);
      });
      plugin.input.focus(function(e) {
        plugin.input.focused = true;
        plugin.deselect();      
        plugin.bhits = 0;
        plugin.focus();
      });
      plugin.input.blur(function(e) {
        plugin.input.focused = false;
        plugin.bhits = 0;   
        if(plugin.val.length == 0) plugin.blur();               
      });       

      plugin.settings.onReady.call(this);

      $(document).keydown(function(e) {

        if(!plugin.focused) return true;

        switch(e.keyCode) {
          case 8: //backspace
            if(!plugin.input.focused) {
              plugin.remove();
              return false;
            }
            if(plugin.val.length == 0) {
              plugin.next();
              return false;           
            } else if(plugin.position == 0) {
              if(plugin.bhits > 0) {
                plugin.bhits = 0;
                plugin.next();
                return false;
              }
              plugin.bhits++;
            }
            break;      
          case 37: // left
            if(!plugin.input.focused) return plugin.previous();
            if(plugin.val.length == 0) {
              plugin.next();
              return false;           
            } else if(plugin.position == 0) {
              if(plugin.lhits > 0) {
                plugin.lhits = 0;
                plugin.next();
                return false;
              }
              plugin.lhits++;
            }
            break;
          case 39: // right
            if(!plugin.input.focused) {
              plugin.next();            
              return false;
            }
            break;
          case 9: // tab
            if(plugin.input.focused && plugin.val.length > plugin.settings.minLength) {
              plugin.add(plugin.val);
              return false;
            } else if(plugin.selected().length > 0) {
              plugin.deselect();
              plugin.input.focus();
              return false;
            }
            break;
          case 13: // enter
          case 188: // ,
            if(plugin.input.focused) {
              if(!plugin.settings.autocomplete) plugin.add(plugin.val);
              return false;
            }
            break;
        }
      
      }).click(function(e) {
        if(plugin.val.length > 0) plugin.add(plugin.val);
      });

      if($val.length > 0) plugin.add($val);

    }
            
    plugin.resize = function(value) {
      plugin.measure.text(value);
      plugin.input.css('width', plugin.measure.width() + 20);   
    },

    plugin.focus = function(input) {
      if(plugin.focused) return true;
      
      $('.tagboxified').not(plugin.origin).each(function() {
        if($(this).data('tagbox')) $(this).data('tagbox').blur();  
      });

      plugin.box.addClass('focus');
      plugin.focused = true;
      
      if(input == undefined) var input = true;
      if(input !== false) plugin.input.focus();
    }

    plugin.blur = function() {
      if(!plugin.focused) return true;
      plugin.box.removeClass('focus');
      plugin.focused = false;
      plugin.input.blur();    
      plugin.deselect();
    }
        
    plugin.tag = function(tag) {
      tag = tag.replace(/,/g,'').replace(/;/g,'');
      if(plugin.settings.lowercase) tag = tag.toLowerCase();
      return $.trim(tag);   
    }

    plugin.serialize = function() {
      return plugin.index;
    }

    plugin.string = function() {
      return plugin.serialize().toString();
    }

    plugin.add = function(tag) {

      plugin.input.val('');

      if(!tag && plugin.val.length > 0) {
        return plugin.add(plugin.val);
      } else if(!tag) {
        return true;
      }
            
      if($.isArray(tag) || tag.match(new RegExp(plugin.settings.separator))) {      
        var tags = ($.isArray(tag)) ? tag : tag.split(plugin.settings.separator);
        $.each(tags, function(i,t) {
          plugin.add(t);
        }); 
        return true;
      } 
        
      var tag = plugin.tag(tag);
          
      if(tag.length < plugin.settings.minLength || tag.length > plugin.settings.maxLength) {
        return plugin.settings.onInvalid.call(plugin, tag, length);
      }
      
      if(plugin.settings.duplicates == false) {
        if($.inArray(tag, plugin.index) > -1) {
          return plugin.settings.onDuplicate.call(plugin, tag);
        }
      }
      
      plugin.index.push(tag);
      
      var li = $('<li><span class="tag"></span><span class="delete">&#215;</span></li>').data('tag', tag);
      li.find('.tag').text(tag);
      li.find('.delete').click(function() { plugin.remove(li) });
                
      li.click(function(e) {
        plugin.blur();
        e.stopPropagation();          
        plugin.select(li);
      });
      li.focus(function(e) {
        plugin.select(li)
      });
    
      plugin.input.parent().before(li);
      plugin.input.val('');
      plugin.input.css('width', 20);

      var serialized = plugin.serialize();
      plugin.origin.val(serialized.join(plugin.settings.separator));
      plugin.settings.onAdd.call(plugin, tag, serialized, li);
                      
    }

    plugin.select = function(element) {

      if(typeof element == 'string') {
        var element = plugin.find(element);
        if(!element) return false;
      }

      if(element.length == 0) return false;     
      plugin.input.blur();
      this.deselect();
      element.addClass('selected');
      plugin.focus(false);
    }
      
    plugin.selected = function() {
      return plugin.box.find('.selected');  
    }

    plugin.deselect = function() {
      var selected = plugin.selected();
      selected.removeClass('selected'); 
    }

    plugin.find = function(tag) {
      var element = false;
      plugin.box.find('li').not('.new').each(function() {
        if($(this).data('tag') == tag) element = $(this);
      });     
      return element;
    }

    plugin.remove = function(element) {
      
      plugin.input.val('');
      
      if(typeof element == 'string') {
        var element = plugin.find(element);
        if(!element) return false;
      }
      
      var selected = plugin.selected();
      if(!element && selected.length > 0) var element = selected.first();
      var previous = plugin.previous(true);
      (previous.length == 0) ? plugin.next() : plugin.select(previous);
      var tag = element.find('.tag').text();
      plugin.removeFromIndex(tag);
      element.remove();
      var serialized = plugin.serialize();
      plugin.origin.val(serialized);
      plugin.settings.onRemove.call(plugin, tag, serialized, element);
    }

    plugin.removeFromIndex = function(tag) {
      var i = plugin.index.indexOf(tag);
      plugin.index.splice(i,1);
    }
    
    plugin.selection = function() {
      var i = plugin.input[0];
      var v = plugin.val;
      if(!i.createTextRange) return i.selectionStart;
      var r = document.selection.createRange().duplicate();
      r.moveEnd('character', v.length);
      if(r.text == '') return v.length;
      return v.lastIndexOf(r.text);
    }
    
    plugin.previous = function(ret) {
      var sel  = plugin.selected();
      var prev = (sel.length == 0) ? plugin.box.find('li').not('.new').first() : sel.prev().not('.new');
      return (ret) ? prev : plugin.select(prev);
    }
    
    plugin.next = function(ret) {
      var sel  = plugin.selected();
      var next = (sel.length == 0) ? plugin.box.find('li').not('.new').last() : sel.next();
      return (ret) ? next : (next.hasClass('new')) ? plugin.input.focus() : plugin.select(next);
    }

    plugin.init();
    
  }

  $.fn.tagbox = function(options) {

    return this.each(function() {
      if(undefined == $(this).data('tagbox')) {

        var plugin = new $.tagbox(this, options);
        $(this).data('tagbox', plugin);
        
      }
    });

  }

})(jQuery);

define("libs/tags", function(){});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/backbone-forms/tags',['cdn.underscore', 'libs/backbone-forms', 'libs/tags'], function(_, Form, tags) {
    return Form.editors.Tags = (function(_super) {
      __extends(Tags, _super);

      function Tags() {
        return Tags.__super__.constructor.apply(this, arguments);
      }

      Tags.prototype.width = 210;

      Tags.prototype.tagName = 'input';

      Tags.prototype.initialize = function(options) {
        Tags.__super__.initialize.call(this, options);
        return this.tagboxValue = this.value || [];
      };

      Tags.prototype.render = function() {
        _.defer((function(_this) {
          return function() {
            return _this.renderTagbox();
          };
        })(this));
        return this;
      };

      Tags.prototype.renderTagbox = function() {
        var onAdd, onRemove, _ref, _ref1, _ref2, _ref3, _ref4;
        this.tagboxOptions = (_ref = this.schema.options) != null ? _ref : [];
        this.$el.tagbox({
          url: this.tagboxOptions,
          lowercase: (_ref1 = this.schema.lowercase) != null ? _ref1 : true,
          duplicates: (_ref2 = this.schema.duplicates) != null ? _ref2 : false,
          minLength: (_ref3 = this.schema.minLength) != null ? _ref3 : 1,
          maxLength: (_ref4 = this.schema.maxLength) != null ? _ref4 : 140
        });
        this.tagbox = this.$el.data('tagbox');
        onAdd = this.tagbox.settings.onAdd;
        this.tagbox.settings.onAdd = (function(_this) {
          return function() {
            onAdd();
            if (_this.updating) {
              return;
            }
            _this.onChange();
            return _this.updateTagboxOptions();
          };
        })(this);
        onRemove = this.tagbox.settings.onRemove;
        this.tagbox.settings.onRemove = (function(_this) {
          return function() {
            onRemove();
            if (_this.updating) {
              return;
            }
            return _this.onChange();
          };
        })(this);
        return this.updateTagbox();
      };

      Tags.prototype.getValue = function() {
        if (this.tagbox != null) {
          this.tagboxValue = this.tagbox.serialize().slice(0);
        }
        return this.tagboxValue || [];
      };

      Tags.prototype.setValue = function(value) {
        if (!_.isArray(value)) {
          return;
        }
        if (_.isEqual(value, this.tagboxValue)) {
          return;
        }
        this.tagboxValue = value;
        return this.updateTagbox();
      };

      Tags.prototype.updateTagbox = function() {
        var member, _i, _len, _ref;
        if (this.tagbox == null) {
          return;
        }
        this.updating = true;
        this.clearValue();
        _ref = this.tagboxValue;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          member = _ref[_i];
          this.tagbox.add("" + member);
        }
        this.updating = false;
        return this.updateTagboxOptions();
      };

      Tags.prototype.clearValue = function() {
        var _ref, _results;
        _results = [];
        while (((_ref = this.tagbox.serialize()) != null ? _ref.length : void 0) > 0) {
          _results.push(this.tagbox.remove(0));
        }
        return _results;
      };

      Tags.prototype.onChange = function() {
        return this.trigger('change', this);
      };

      Tags.prototype.updateTagboxOptions = function() {
        var member, _i, _len, _ref, _results;
        if (!this.schema.updateAutoComplete) {
          return;
        }
        _ref = _.difference(this.tagbox.serialize(), this.tagboxOptions);
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          member = _ref[_i];
          _results.push(this.tagboxOptions.push(member));
        }
        return _results;
      };

      return Tags;

    })(Form.editors.Base);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/property_sheet',['app/mediator', 'cdn.marionette', 'text!templates/property_sheet.html', 'bower_components/tether/tether', 'libs/backbone-forms', 'plugins/backbone-forms.bootstrap', 'views/backbone-forms/color', 'views/backbone-forms/range', 'views/backbone-forms/tags'], function(mediator, Marionette, template, Tether, Form) {
    var PropertySheetView;
    return PropertySheetView = (function(_super) {
      __extends(PropertySheetView, _super);

      function PropertySheetView() {
        return PropertySheetView.__super__.constructor.apply(this, arguments);
      }

      PropertySheetView.prototype.template = _.template(template);

      PropertySheetView.prototype.className = 'properties-dialog';

      PropertySheetView.prototype.events = {
        'change input[type=number]': 'onFormChange',
        'submit .js-form': 'doNothing',
        'click': 'stopPropagation'
      };

      PropertySheetView.prototype.ui = {
        form: '.js-form',
        errorCount: '.js-error-count',
        errorCountPlural: '.js-error-count-plural',
        errorCountContainer: '.js-error-count-container'
      };

      PropertySheetView.prototype.initialize = function() {
        this.listenTo(this.options.config, 'change', this.onConfigChange);
        this.listenTo(this.options.propertySheetSchema, 'change', this.onSchemaChange);
        return this.$el.appendTo('body');
      };

      PropertySheetView.prototype.onBeforeClose = function() {
        return this._hide();
      };

      PropertySheetView.prototype.onConfigChange = function(model, options) {
        if (!options.propertySheetChanging) {
          return this.render();
        }
      };

      PropertySheetView.prototype.onSchemaChange = function() {
        return this.render();
      };

      PropertySheetView.prototype.setErrorCount = function(count) {
        this.ui.errorCount.text(count);
        this.ui.errorCountPlural.toggle(count !== 1);
        return this.ui.errorCountContainer.toggle(count > 0);
      };

      PropertySheetView.prototype._show = function() {
        this.$el.show();
        return this._tether = new Tether({
          element: this.el,
          target: this.options.targetElement,
          attachment: 'top right',
          targetAttachment: 'middle left',
          offset: '2px -4px'
        });
      };

      PropertySheetView.prototype._hide = function() {
        var _ref;
        if ((_ref = this._tether) != null) {
          _ref.destroy();
        }
        this._tether = null;
        return this.$el.hide();
      };

      PropertySheetView.prototype.onRender = function() {
        var errors;
        if (this.form != null) {
          this.stopListening(this.form);
        }
        if (this.options.propertySheetSchema.isEmpty()) {
          return this._hide();
        }
        this.form = new Form({
          data: this.options.config.toJSON(),
          schema: this.options.propertySheetSchema.sanitizedSchema()
        });
        this.form.render();
        errors = this.form.validate();
        this.setErrorCount(_.size(errors));
        this.listenTo(this.form, 'change', this.onFormChange);
        this.ui.form.html(this.form.el);
        return this._show();
      };

      PropertySheetView.prototype.doNothing = function(e) {
        return e.preventDefault();
      };

      PropertySheetView.prototype.stopPropagation = function(e) {
        return e.stopPropagation();
      };

      PropertySheetView.prototype.onFormChange = function() {
        this.form.validate();
        return this.options.config.save(this.form.getValue(), {
          propertySheetChanging: true
        });
      };

      return PropertySheetView;

    })(Marionette.ItemView);
  });

}).call(this);


define('text!templates/tray/gadget.html',[],function () { return '<div class="js-gadget-icon gadget-icon"></div>\n<div class="tray-gadget-title"><%- title %></div>\n<div class="js-draggable gadget-icon-draggable" draggable="true"></div>\n<div class="js-version-controls version-controls">\n  <div class="js-upgrade-icon upgrade-icon">\n    <i class="arrow-icon icon-circle-arrow-up"></i>\n  </div>\n  <div class="js-revert-icon revert-icon">\n    <i class="arrow-icon icon-circle-arrow-down"></i>\n  </div>\n</div>\n';});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/manifest_viewmodel',['cdn.backbone'], function(Backbone) {
    var GadgetManifest;
    return GadgetManifest = (function(_super) {
      __extends(GadgetManifest, _super);

      function GadgetManifest() {
        return GadgetManifest.__super__.constructor.apply(this, arguments);
      }

      GadgetManifest.prototype.defaults = {
        'title': 'Untitled gadget',
        'author': 'Unknown author',
        'version': '-.-.-'
      };

      return GadgetManifest;

    })(Backbone.Model);
  });

}).call(this);

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/tray/item',['cdn.underscore', 'cdn.marionette', 'text!templates/tray/gadget.html', 'models/manifest_viewmodel', 'views/gadget/drag_image', 'app/mediator'], function(_, Marionette, template, GadgetManifest, GadgetDragImageView, mediator) {
    var TrayItemView;
    return TrayItemView = (function(_super) {
      __extends(TrayItemView, _super);

      function TrayItemView() {
        this.onDragStart = __bind(this.onDragStart, this);
        return TrayItemView.__super__.constructor.apply(this, arguments);
      }

      TrayItemView.prototype.template = _.template(template);

      TrayItemView.prototype.className = 'tray-gadget';

      TrayItemView.prototype.ui = {
        icon: '.js-gadget-icon',
        versionControls: '.js-version-controls'
      };

      TrayItemView.prototype.events = {
        'dblclick': 'onGadgetSelected',
        'dragstart .js-draggable': 'onDragStart',
        'drag .js-draggable': 'onDrag',
        'dragend .js-draggable': 'onDragEnd'
      };

      TrayItemView.prototype.triggers = {
        'click .js-upgrade-icon': 'upgrade',
        'click .js-revert-icon': 'revert'
      };

      TrayItemView.prototype._checksum = function(string) {
        var sum;
        sum = _.reduce(string.split(''), function(memo, val) {
          return memo + val.charCodeAt(0);
        }, 0);
        return sum % 10;
      };

      TrayItemView.prototype._iconPath = function(originalUrl) {
        return originalUrl.replace(/^(https?:\/\/)((staging)?stack)/, "$1$2-" + (this._checksum(originalUrl)));
      };

      TrayItemView.prototype.onRender = function() {
        this.ui.icon.css({
          'background-image': "url(" + (this._iconPath(this.model.icon())) + ")"
        });
        this.$el.data('project', this.model);
        if (this._isUpgradable()) {
          return this.showUpgradable();
        } else if (this.options.revertable()) {
          return this.showRevertable();
        }
      };

      TrayItemView.prototype._isUpgradable = function() {
        var latest;
        latest = this.model.get('latestVersion');
        return (latest != null) && this.model.get('version') !== latest;
      };

      TrayItemView.prototype.showUpgradable = function() {
        return this.ui.versionControls.removeClass('reverting').addClass('upgrading');
      };

      TrayItemView.prototype.showRevertable = function() {
        return this.ui.versionControls.removeClass('upgrading').addClass('reverting');
      };

      TrayItemView.prototype.onGadgetSelected = function() {
        return mediator.trigger('tray:gadgetSelected', this.model);
      };

      TrayItemView.prototype.onDragStart = function(e) {
        var $draggable, dataTransfer, dragData, _ref;
        $draggable = $(e.target);
        dataTransfer = e != null ? (_ref = e.originalEvent) != null ? _ref.dataTransfer : void 0 : void 0;
        if (dataTransfer != null) {
          dataTransfer.effectAllowed = 'move';
          dragData = {
            action: 'create',
            type: this.model.shortType()
          };
          dataTransfer.setData('Text', JSON.stringify(dragData));
        }
        this._dragImage = new GadgetDragImageView({
          model: this._makeManifestOfProject(this.model)
        });
        this._dragImage.render().$el.appendTo('body');
        if ((dataTransfer != null ? dataTransfer.setDragImage : void 0) != null) {
          dataTransfer.setDragImage(this._dragImage.el, 30, 30);
          _.delay((function(_this) {
            return function() {
              return _this._dragImage.remove();
            };
          })(this));
        } else {
          this._dragImageNotSupported = true;
          $draggable = $(e.target);
          $draggable.hide();
          _.delay(function() {
            return $draggable.show();
          });
        }
        mediator.trigger('gadget:dragstart');
        return mediator.trigger('tray:gadget:dragstart');
      };

      TrayItemView.prototype.onDrag = function(e) {
        var position, _ref;
        if (this._dragImageNotSupported) {
          position = {
            top: e.originalEvent.clientY - 30,
            left: e.originalEvent.clientX - 30,
            'z-index': 3100,
            opacity: 0.5
          };
          if (position.top && position.left) {
            return (_ref = this._dragImage) != null ? _ref.$el.css(position) : void 0;
          }
        }
      };

      TrayItemView.prototype.onDragEnd = function() {
        var _ref;
        mediator.trigger('gadget:dragend');
        mediator.trigger('tray:gadget:dragend');
        if (this._dragImageNotSupported) {
          return (_ref = this._dragImage) != null ? _ref.remove() : void 0;
        }
      };

      TrayItemView.prototype._makeManifestOfProject = function(project) {
        var attrs;
        attrs = _.pick(project.attributes, 'title', 'author', 'version');
        attrs.icon = this._iconPath(_.result(project, 'icon'));
        return new GadgetManifest(attrs);
      };

      return TrayItemView;

    })(Marionette.ItemView);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __slice = [].slice;

  define('models/property_sheet_schema',['cdn.underscore', 'cdn.backbone'], function(_, Backbone) {
    var PropertySheetSchema;
    return PropertySheetSchema = (function(_super) {
      __extends(PropertySheetSchema, _super);

      function PropertySheetSchema() {
        return PropertySheetSchema.__super__.constructor.apply(this, arguments);
      }

      PropertySheetSchema.prototype.whiteListedAttributes = {
        Text: [],
        Number: [],
        TextArea: [],
        Checkbox: [],
        Color: [],
        Select: ['options'],
        Radio: ['options'],
        Checkboxes: ['options'],
        Date: ['yearStart', 'yearEnd'],
        DateTime: ['yearStart', 'yearEnd', 'minsInterval'],
        Range: ['min', 'max', 'step'],
        Tags: ['options', 'lowercase', 'duplicates', 'minLength', 'maxLength', 'updateAutoComplete']
      };

      PropertySheetSchema.prototype.sanitizedSchema = function() {
        var attributes, name, sanitizedAttributes, schema, _ref;
        schema = {};
        _ref = this.attributes;
        for (name in _ref) {
          attributes = _ref[name];
          if (schema[name] == null) {
            sanitizedAttributes = this.sanitizedAttributes(attributes);
            if (sanitizedAttributes != null) {
              schema[name] = sanitizedAttributes;
            }
          }
        }
        return schema;
      };

      PropertySheetSchema.prototype.isEmpty = function() {
        return _.keys(this.sanitizedSchema()).length === 0;
      };

      PropertySheetSchema.prototype.sanitizedAttributes = function(attributes) {
        var whiteListedAttributes;
        if (typeof attributes === 'string') {
          return this.sanitizedAttributes({
            type: attributes
          });
        }
        if (typeof attributes !== 'object') {
          return null;
        }
        whiteListedAttributes = this.whiteListedAttributes[attributes.type];
        if (whiteListedAttributes == null) {
          return null;
        }
        return _.pick.apply(_, [attributes, 'type', 'title', 'validators'].concat(__slice.call(whiteListedAttributes)));
      };

      PropertySheetSchema.prototype._defaultDefinitionForValue = function(value) {
        switch (typeof value) {
          case 'boolean':
            return 'Checkbox';
          case 'number':
            return 'Number';
          case 'string':
            if (/^\#[a-f0-9]{6}$/i.test(value)) {
              return 'Color';
            } else if (value.length > 20) {
              return 'TextArea';
            } else {
              return 'Text';
            }
            break;
          case 'object':
            if (_.isArray(value) && _.every(value, function(member) {
              var _ref;
              return (_ref = typeof member) === 'string' || _ref === 'number';
            })) {
              return {
                type: 'Tags',
                options: _.uniq(value),
                updateAutoComplete: true
              };
            } else {
              return null;
            }
            break;
          default:
            return null;
        }
      };

      return PropertySheetSchema;

    })(Backbone.Model);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('state/position',['cdn.backbone'], function(Backbone) {
    var Position;
    Position = (function(_super) {
      __extends(Position, _super);

      function Position() {
        return Position.__super__.constructor.apply(this, arguments);
      }

      Position.prototype.defaults = {
        lessonCid: null,
        gadgetCid: null
      };

      return Position;

    })(Backbone.Model);
    return new Position();
  });

}).call(this);


define('text!templates/gadget_instance.html',[],function () { return '<div class="toolbar">\n  <i class="drag js-draggable icon-reorder" draggable="true"></i>\n  <i class="gadget-toolbar-info js-info icon-info"></i>\n  <i class="edit js-edit icon-cog"></i>\n  <i class="delete js-trash icon-trash"></i>\n</div>\n\n<div class="gadgetContent"></div>\n<div class="js-placeholder placeholder">Click to edit this gadget</div>\n<div class="drag-overlay"></div>\n\n<div class="toolbar-right"></div>\n\n<div class="js-collab-lock-region gadget-collab-lock-region"></div>\n\n<div class="gadget-info-tooltip js-info-tooltip"></div>\n';});


define('text!templates/gadget_instance_error.html',[],function () { return '<div class="gadget-dialog js-spec-error">\n  <div class="gadget-dialog-vertical-align">\n    <div class="gadget-dialog-message">\n      Something went wrong and this gadget didn\'t load properly.<br>\n      We\'re on it. Please check back in a bit.\n    </div>\n    <div>\n      <button class="js-hide">close</button>\n      <button class="action gadget-delete-button js-delete">delete</button>\n    </div>\n  </div>\n</div>\n';});


define('text!templates/gadget_delete_warn.html',[],function () { return '<div class="gadget-dialog js-alert-warn">\n  <div class="gadget-dialog-vertical-align">\n    <div class="gadget-dialog-message">\n      Are you sure you want to delete this gadget?\n    </div>\n    <button class="js-undo-delete">cancel</button>\n    <button class="action js-delete">delete</button>\n  </div>\n</div>\n';});


define('text!templates/gadget_child_picker.html',[],function () { return '<div class=\'gadget-child-picker-inner\'>\n  <h2 class="gadget-child-picker-heading">Select slide content</h2>\n\n  <ul class=\'gadget-child-picker-list\'>\n    <% for(var gadgetType in gadgetTypes) { %>\n      <li class=\'gadget-child-picker-item js-choose-type\' data-type=\'<%= gadgetType %>\'>\n        <img class="gadget-child-picker-image" src=\'<%= gadgetTypes[gadgetType].imageUrl %>\'>\n        <label class=\'gadget-child-picker-title\'><%= gadgetTypes[gadgetType].title %></label>\n        <label class=\'gadget-child-picker-author\'><%= gadgetTypes[gadgetType].author %></label>\n      </li>\n    <% } %>\n  </ul>\n</div>\n';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/gadget/child_picker',['cdn.marionette', 'text!templates/gadget_child_picker.html'], function(Marionette, template) {
    var LegacyGadgetChildPickerView;
    return LegacyGadgetChildPickerView = (function(_super) {
      __extends(LegacyGadgetChildPickerView, _super);

      function LegacyGadgetChildPickerView() {
        this.templateHelpers = __bind(this.templateHelpers, this);
        return LegacyGadgetChildPickerView.__super__.constructor.apply(this, arguments);
      }

      LegacyGadgetChildPickerView.prototype.template = _.template(template);

      LegacyGadgetChildPickerView.prototype.className = 'gadget-child-picker';

      LegacyGadgetChildPickerView.prototype.events = {
        'click .js-choose-type': '_onTypeClick'
      };

      LegacyGadgetChildPickerView.prototype._onTypeClick = function(e) {
        var type;
        type = $(e.target).closest('li').data('type');
        this.trigger('gadget_picked_of_type', type);
        return false;
      };

      LegacyGadgetChildPickerView.prototype._imageUrl = function(name) {
        return this.options.gadgetBaseUrl + ("/assets/" + name);
      };

      LegacyGadgetChildPickerView.prototype.templateHelpers = function() {
        return {
          gadgetTypes: {
            'versal/image': {
              title: 'Image',
              author: 'Versal',
              imageUrl: this._imageUrl('image.png')
            },
            'versal/video': {
              title: 'Video',
              author: 'Versal',
              imageUrl: this._imageUrl('video.png')
            },
            'versal/markdown': {
              title: 'Markdown',
              author: 'Versal',
              imageUrl: this._imageUrl('markdown.png')
            }
          }
        };
      };

      return LegacyGadgetChildPickerView;

    })(Marionette.ItemView);
  });

}).call(this);


define('text!templates/gadget_child_container.html',[],function () { return '<div class=\'gadget-child-container-picker-region js-picker-region\'></div>\n';});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/gadget/child_container',['cdn.marionette', 'views/gadget/child_picker', 'text!templates/gadget_child_container.html'], function(Marionette, GadgetChildPickerView, template) {
    var LegacyGadgetChildContainerView;
    return LegacyGadgetChildContainerView = (function(_super) {
      __extends(LegacyGadgetChildContainerView, _super);

      function LegacyGadgetChildContainerView() {
        return LegacyGadgetChildContainerView.__super__.constructor.apply(this, arguments);
      }

      LegacyGadgetChildContainerView.prototype.template = _.template(template);

      LegacyGadgetChildContainerView.prototype.className = 'gadget-child-container';

      LegacyGadgetChildContainerView.prototype.regions = {
        pickerRegion: '.js-picker-region'
      };

      LegacyGadgetChildContainerView.prototype.onRender = function() {
        if (this.options.gadgetId != null) {
          return this._renderGadget(this.options.gadgetId);
        } else {
          return this._renderChildPicker();
        }
      };

      LegacyGadgetChildContainerView.prototype._renderGadget = function(gadgetId) {
        this.pickerRegion.close();
        return this.options.children.useGadgetAndMoveToEl(gadgetId, this.$el);
      };

      LegacyGadgetChildContainerView.prototype._renderChildPicker = function() {
        var childPicker;
        childPicker = new GadgetChildPickerView({
          gadgetBaseUrl: this.options.gadgetBaseUrl
        });
        this.listenTo(childPicker, 'gadget_picked_of_type', this._gadgetPickedOfType);
        return this.pickerRegion.show(childPicker);
      };

      LegacyGadgetChildContainerView.prototype._gadgetPickedOfType = function(type) {
        return this.options.children.build(type, (function(_this) {
          return function(gadget_id) {
            _this._renderGadget(gadget_id);
            _this.options.children.toggleEdit(true);
            return _this.trigger('selected_gadget', gadget_id);
          };
        })(this));
      };

      return LegacyGadgetChildContainerView;

    })(Marionette.Layout);
  });

}).call(this);

(function() {
  define('launchers/legacy/containers_interface',['cdn.underscore', 'views/gadget/child_container', 'app/mediator'], function(_, GadgetChildContainerView, mediator) {
    var LegacyContainersInterface;
    return LegacyContainersInterface = (function() {
      function LegacyContainersInterface(_arg) {
        var _ref;
        this.gadget = _arg.gadget, this.lesson = _arg.lesson, this.gadgetBaseUrl = _arg.gadgetBaseUrl;
        this._children = (_ref = this.gadget.config.get('_children')) != null ? _ref : [];
      }

      LegacyContainersInterface.prototype.build = function(type, success, error) {
        return mediator.trigger('catalog:findByType', type, (function(_this) {
          return function(project) {
            var gadget;
            gadget = _this.lesson.insertGadgetProjectAt(project, _this.lesson.children.length);
            gadget.config.save('_versal_container_child', true);
            return gadget != null ? gadget.once('sync', function() {
              _this._children.push(gadget.id);
              _this.gadget.config.save({
                _children: _this._children
              });
              return success(gadget.id);
            }) : void 0;
          };
        })(this));
      };

      LegacyContainersInterface.prototype.getGadgetChildContainerView = function(id) {
        if (id == null) {
          id = null;
        }
        return new GadgetChildContainerView({
          gadgetId: id,
          children: this,
          gadgetBaseUrl: this.gadgetBaseUrl
        });
      };

      LegacyContainersInterface.prototype.useGadgetAndMoveToEl = function(id, $el) {
        var model, view;
        if (!_.contains(this._children, id)) {
          return;
        }
        this._childrenInUse.push(id);
        model = this.lesson.collection.get(id);
        if (!model) {
          return;
        }
        model.config.save('_versal_container_child', true);
        this.gadget.on('destroy', function() {
          return model.destroy();
        });
        view = this.lesson.children.findByModel(model);
        $el.empty();
        view.$el.detach().find('.gadgetContent').appendTo($el);
        return view.setElement($el);
      };

      LegacyContainersInterface.prototype.renderById = function(id, $el) {
        return this.useGadgetAndMoveToEl(id, $el);
      };

      LegacyContainersInterface.prototype.destroy = function(id) {
        var model;
        if (!_.contains(this._children, id)) {
          return;
        }
        model = this.lesson.collection.get(id);
        if (model != null) {
          model.destroy();
        }
        this._children = _.without(this._children, id);
        return this._childrenInUse = _.without(this._childrenInUse, id);
      };

      LegacyContainersInterface.prototype.toggleEdit = function(bool) {
        return _.each(this._childrenInUse, (function(_this) {
          return function(id) {
            var model;
            if (model = _this.lesson.collection.get(id)) {
              return model.set({
                isEditing: bool
              });
            }
          };
        })(this));
      };

      LegacyContainersInterface.prototype._childrenInUse = [];

      return LegacyContainersInterface;

    })();
  });

}).call(this);

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/gadget/instance',['cdn.jquery', 'cdn.underscore', 'cdn.marionette', 'app/mediator', 'plugins/vs.collab', 'plugins/tracker', 'views/gadget/drag_image', 'views/property_sheet', 'views/tray/item', 'models/property_sheet_schema', 'models/manifest_viewmodel', 'state/position', 'text!templates/gadget_instance.html', 'text!templates/gadget_instance_error.html', 'text!templates/gadget_delete_warn.html', 'launchers/legacy/containers_interface', 'bower_components/tether/tether'], function($, _, Marionette, mediator, collab, tracker, GadgetDragImageView, PropertySheetView, TrayItemView, PropertySheetSchema, GadgetManifest, currentPosition, template, error_template, warn_template, LegacyContainersInterface, Tether) {
    var GadgetInstanceView;
    return GadgetInstanceView = (function(_super) {
      __extends(GadgetInstanceView, _super);

      function GadgetInstanceView() {
        this._onGadgetSeen = __bind(this._onGadgetSeen, this);
        this._handleError = __bind(this._handleError, this);
        this._scrollIntoViewIfNeeded = __bind(this._scrollIntoViewIfNeeded, this);
        this._gadgetDropped = __bind(this._gadgetDropped, this);
        this.stopEditing = __bind(this.stopEditing, this);
        this._onPopulateGadgetCommentsRegion = __bind(this._onPopulateGadgetCommentsRegion, this);
        this._onPopulateGadgetLockRegion = __bind(this._onPopulateGadgetLockRegion, this);
        return GadgetInstanceView.__super__.constructor.apply(this, arguments);
      }

      GadgetInstanceView.prototype.reportActivityEveryMs = 60 * 1000;

      GadgetInstanceView.prototype.template = _.template(template);

      GadgetInstanceView.prototype.className = 'gadget js-gadget';

      GadgetInstanceView.prototype.regions = {
        lockRegion: '.js-collab-lock-region',
        commentsRegion: '.toolbar-right'
      };

      GadgetInstanceView.prototype.events = {
        'click .js-edit': 'onEditClick',
        'click .js-trash': 'onTrashClick',
        'click .js-hide': 'onHideClick',
        'click .js-delete': 'onDeleteClick',
        'click .js-undo-delete': 'onUndoDelete',
        'mouseover .js-info': '_showInfoTooltip',
        'mouseout .js-info': '_hideInfoTooltip',
        'click .gadgetContent': 'onContentClick',
        'click .js-placeholder': 'onPlaceholderClick',
        'click .toolbar-right': 'prevent',
        'selectstart .js-placeholder': _.identity(false),
        'dragstart .js-draggable': 'ondragstart',
        'dragend .js-draggable': 'ondragend',
        'drag .js-draggable': 'ondrag'
      };

      GadgetInstanceView.prototype.modelEvents = {
        'destroy': 'onModelDestroy',
        'change:isEditing': '_onIsEditingChanged'
      };

      GadgetInstanceView.prototype.ui = {
        toolbar: '.toolbar',
        gadgetContent: '.gadgetContent',
        commentsBox: '.js-comments-box',
        editButton: '.js-edit',
        placeholder: '.js-placeholder',
        infoTooltip: '.js-info-tooltip',
        infoButton: '.js-info'
      };

      GadgetInstanceView.prototype.initialize = function(_arg) {
        var attrName, attrValue, dropped, launcherStringAttributes, src, _base, _ref;
        this.isEditable = _arg.isEditable, this.project = _arg.project, this.lesson = _arg.lesson, this.assetUrlTemplate = _arg.assetUrlTemplate, dropped = _arg.dropped;
        this.gadgetRendering = $.Deferred();
        this.once('gadgetRendered', (function(_this) {
          return function() {
            return _this.gadgetRendering.resolve();
          };
        })(this));
        if (dropped) {
          this.gadgetRendering.done(this._gadgetDropped);
        }
        this.listenTo(this.model.config, 'change', this._onGadgetConfigChange);
        this.listenTo(this.model.userState, 'change', this._onGadgetUserStateChange);
        this.listenTo(this.model.userState, 'sync', this._onGadgetUserStateSync);
        this.listenTo(this.model.userState, 'change:progress', this._onGadgetProgressChanged);
        mediator.on('plugin:populate:gadgetCommentsRegion', this._onPopulateGadgetCommentsRegion);
        mediator.on('plugin:populate:gadgetLockRegion', this._onPopulateGadgetLockRegion);
        this._propertySheetSchema = new PropertySheetSchema;
        switch ((_ref = this.project) != null ? _ref.get('launcher') : void 0) {
          case 'iframe':
            this._launcher = document.createElement('VERSAL-IFRAME-LAUNCHER');
            src = this.project.path('versal.html');
            src = src.replace('https:', '').replace('http:', '');
            this._launcher.setAttribute('src', src);
            break;
          case 'component':
            this._launcher = document.createElement('VERSAL-COMPONENT-LAUNCHER');
            src = this.project.path('versal.html');
            src = src.replace('https:', '').replace('http:', '');
            this._launcher.setAttribute('src', src);
            break;
          default:
            this._launcher = document.createElement('VERSAL-LEGACY-LAUNCHER');
            launcherStringAttributes = {
              'gadget-base-url': this.project.path(),
              'gadget-css-class-name': this.project.cssClassName()
            };
            if (this.isEditable) {
              launcherStringAttributes['editing-allowed'] = 'true';
            }
            if (!this.isChild()) {
              launcherStringAttributes['should-fire-close-event-on-detached'] = 'true';
            }
            for (attrName in launcherStringAttributes) {
              attrValue = launcherStringAttributes[attrName];
              this._launcher.setAttribute(attrName, attrValue);
            }
            if (typeof (_base = this._launcher).setLegacyContainers === "function") {
              _base.setLegacyContainers(new LegacyContainersInterface({
                gadget: this.model,
                lesson: this.lesson,
                gadgetBaseUrl: this.project.path()
              }));
            }
        }
        return Object.keys(this._launcherHandlers).forEach((function(_this) {
          return function(eventName) {
            return _this._launcher.addEventListener(eventName, _this._launcherHandlers[eventName].bind(_this));
          };
        })(this));
      };

      GadgetInstanceView.prototype.onClose = function() {
        this._closePropertySheet();
        mediator.off('plugin:populate:gadgetCommentsRegion', this._onPopulateGadgetCommentsRegion);
        mediator.off('plugin:populate:gadgetLockRegion', this._onPopulateGadgetLockRegion);
        return this.ui.gadgetContent.off();
      };

      GadgetInstanceView.prototype.ondragstart = function(e) {
        var $draggable, dataTransfer, dragData, _ref;
        dataTransfer = e != null ? (_ref = e.originalEvent) != null ? _ref.dataTransfer : void 0 : void 0;
        if (dataTransfer != null) {
          dataTransfer.effectAllowed = 'move';
          dragData = {
            action: 'reorder',
            index: this.$el.index()
          };
          e.originalEvent.dataTransfer.setData('Text', JSON.stringify(dragData));
        }
        this._dragImage = new GadgetDragImageView({
          model: this._makeManifestOfProject(this.project)
        });
        this._dragImage.render().$el.appendTo('body');
        if ((dataTransfer != null ? dataTransfer.setDragImage : void 0) != null) {
          e.originalEvent.dataTransfer.setDragImage(this._dragImage.el, 30, 30);
          _.delay((function(_this) {
            return function() {
              return _this._dragImage.remove();
            };
          })(this));
        } else {
          this._dragImageNotSupported = true;
          $draggable = $(e.target);
          $draggable.hide();
          _.delay(function() {
            return $draggable.show();
          });
        }
        this._closePropertySheet();
        return _.delay((function(_this) {
          return function() {
            _this.$el.addClass('gadget-dragging');
            return mediator.trigger('gadget:dragstart');
          };
        })(this));
      };

      GadgetInstanceView.prototype.ondrag = function(e) {
        var position, _ref;
        if (this._dragImageNotSupported) {
          position = {
            top: e.originalEvent.clientY - 30,
            left: e.originalEvent.clientX - 30,
            'z-index': 3100,
            opacity: 0.5
          };
          if (position.top && position.left) {
            return (_ref = this._dragImage) != null ? _ref.$el.css(position) : void 0;
          }
        }
      };

      GadgetInstanceView.prototype.ondragend = function() {
        var _ref;
        if ((_ref = this._dragImage) != null) {
          _ref.remove();
        }
        this.$el.removeClass('gadget-dragging');
        mediator.trigger('gadget:dragend');
        if (this.isEditing()) {
          return this._openPropertySheet();
        }
      };

      GadgetInstanceView.prototype._checksum = function(string) {
        var sum;
        sum = _.reduce(string.split(''), function(memo, val) {
          return memo + val.charCodeAt(0);
        }, 0);
        return sum % 10;
      };

      GadgetInstanceView.prototype._iconPath = function(originalUrl) {
        return originalUrl.replace(/^(https?:\/\/)((staging)?stack)/, "$1$2-" + (this._checksum(originalUrl)));
      };

      GadgetInstanceView.prototype._makeManifestOfProject = function(project) {
        var attrs;
        attrs = _.pick(project.attributes, 'title', 'author', 'version');
        attrs.icon = this._iconPath(_.result(project, 'icon'));
        return new GadgetManifest(attrs);
      };

      GadgetInstanceView.prototype._onPopulateGadgetLockRegion = function(view) {
        if (view.gadget.id !== this.model.id) {
          return;
        }
        return this.lockRegion.show(view);
      };

      GadgetInstanceView.prototype._onPopulateGadgetCommentsRegion = function(view) {
        if (view.gadget.id !== this.model.id) {
          return;
        }
        return this.commentsRegion.show(view);
      };

      GadgetInstanceView.prototype.onContentClick = function(e) {
        if (this.project.get('noToggleSwitch')) {
          this.startEditing();
          return e.stopPropagation();
        }
      };

      GadgetInstanceView.prototype.onPlaceholderClick = function(e) {
        this.startEditing();
        return e.stopPropagation();
      };

      GadgetInstanceView.prototype.isEditing = function() {
        return !!this.model.get('isEditing');
      };

      GadgetInstanceView.prototype.onEditClick = function(e) {
        this._toggleEditing();
        return e.stopPropagation();
      };

      GadgetInstanceView.prototype._toggleEditing = function() {
        if (this.isChild() || !this.isEditable) {
          return;
        }
        if (this.isEditing()) {
          return this.stopEditing();
        } else {
          return this.startEditing();
        }
      };

      GadgetInstanceView.prototype.startEditing = function() {
        if (this.isChild() || !this.isEditable) {
          return;
        }
        if (this.isEditing()) {
          return;
        }
        this.trigger('before:startEditing');
        this._configBeforeEditing = this.model.config.toJSON();
        this.model.set({
          isEditing: true
        });
        mediator.trigger('gadget:editing:start', this.model);
        this.$el.on('click', this.prevent);
        $(window).one('click', this.stopEditing);
        return this.trigger('after:startEditing');
      };

      GadgetInstanceView.prototype.stopEditing = function() {
        if (!this.isEditing()) {
          return;
        }
        if (!_.isEqual(this.model.config.toJSON(), this._configBeforeEditing)) {
          mediator.trigger('gadget:changed', this.model);
        }
        this.model.set({
          isEditing: false
        });
        mediator.trigger('gadget:editing:stop', this.model);
        $(window).off('click', this.stopEditing);
        return this.$el.off('click', this.prevent);
      };

      GadgetInstanceView.prototype._onIsEditingChanged = function(model, editable) {
        this.$el.toggleClass('editing', editable);
        if (editable) {
          this._launcher.setAttribute('editable', 'true');
          return this._openPropertySheet();
        } else {
          this._launcher.removeAttribute('editable');
          return this._closePropertySheet();
        }
      };

      GadgetInstanceView.prototype._openPropertySheet = function() {
        if (!this.isEditing()) {
          return;
        }
        if (this.isChild()) {
          return;
        }
        this._propertySheetView = new PropertySheetView({
          model: this.model,
          config: this.model.config,
          propertySheetSchema: this._propertySheetSchema,
          targetElement: this.ui.editButton
        });
        return this._propertySheetView.render();
      };

      GadgetInstanceView.prototype._closePropertySheet = function() {
        var _ref;
        return (_ref = this._propertySheetView) != null ? _ref.close() : void 0;
      };

      GadgetInstanceView.prototype.prevent = function(e) {
        return e.stopPropagation();
      };

      GadgetInstanceView.prototype.isChild = function() {
        return !!this.model.config.get('_versal_container_child');
      };

      GadgetInstanceView.prototype._gadgetDropped = function() {
        this._scrollIntoViewIfNeeded();
        return this.startEditing();
      };

      GadgetInstanceView.prototype._scrollIntoViewIfNeeded = function() {
        var rect;
        rect = this.el.getBoundingClientRect();
        if (rect.top <= 0) {
          this.el.scrollIntoView(true);
          if (rect.top <= 0) {
            return window.scrollBy(0, -37);
          }
        } else if (rect.bottom > $(window).height()) {
          return this.el.scrollIntoView(false);
        }
      };

      GadgetInstanceView.prototype.onModelDestroy = function() {
        return mediator.trigger('gadget:deleted', this.model);
      };

      GadgetInstanceView.prototype.onTrashClick = function() {
        return this.showDeleteMsg();
      };

      GadgetInstanceView.prototype.onHideClick = function() {
        return this.$el.hide();
      };

      GadgetInstanceView.prototype.showDeleteMsg = function() {
        var warnMsg;
        if (this.deleteShowing) {
          return;
        }
        this.deleteShowing = true;
        warnMsg = $(warn_template);
        this.$el.append(warnMsg);
        return this.$el.addClass('gadget-showing-dialog');
      };

      GadgetInstanceView.prototype.onUndoDelete = function() {
        this.stopEditing();
        this.deleteShowing = false;
        this.$el.find('.js-alert-warn').remove();
        return this.$el.removeClass('gadget-showing-dialog');
      };

      GadgetInstanceView.prototype.onDeleteClick = function() {
        this.stopEditing();
        return this.model.destroy();
      };

      GadgetInstanceView.prototype.onRender = function() {
        var attrData, attrName, launcherJsonAttributes;
        if (this.project == null) {
          this._handleError(new Error('Gadget project is missing'));
          return this.showCouldNotLoad();
        }
        this.ui.gadgetContent.addClass(this.project.cssClassName());
        if (this.isEditable && this.project.get('noToggleSwitch')) {
          this.$el.addClass('noToggleSwitch');
        }
        this.el.setAttribute('id', 'gadget-' + this.model.cid);
        this.el.setAttribute('data-cid', this.model.cid);
        this.el.setAttribute('data-type', this.model.get('type'));
        this.el.addEventListener('elementWasSeen', this._onGadgetSeen);
        launcherJsonAttributes = {
          'data-environment': {
            assetUrlTemplate: this.assetUrlTemplate
          },
          'data-config': this.model.config.toJSON(),
          'data-userstate': this.model.userState.toJSON()
        };
        if (this.isEditing()) {
          launcherJsonAttributes.editable = 'true';
        }
        for (attrName in launcherJsonAttributes) {
          attrData = launcherJsonAttributes[attrName];
          this._launcher.setAttribute(attrName, JSON.stringify(attrData));
        }
        this.ui.gadgetContent.append(this._launcher);
        return this.startReportingActivity();
      };

      GadgetInstanceView.prototype._handleError = function(err) {
        var _ref, _ref1;
        if (!err) {
          return;
        }
        _.extend(err, {
          gadgetType: (_ref = this.project) != null ? _ref.type() : void 0,
          gadgetId: (_ref1 = this.model) != null ? _ref1.id : void 0
        });
        if (typeof console.error === "function") {
          console.error(err);
        }
        return this._track('gadget-error', err);
      };

      GadgetInstanceView.prototype._showInfoTooltip = function() {
        if (!this._infoTooltipView) {
          this.ui.infoTooltip.show();
          if (this._infoTooltipView == null) {
            this._infoTooltipView = new GadgetDragImageView({
              model: this._makeManifestOfProject(this.project),
              el: this.ui.infoTooltip,
              tetherTarget: this.ui.infoButton
            });
          }
          this._infoTooltipView.render();
          this._infoPosition = new Tether({
            element: this._infoTooltipView.el,
            target: this.ui.infoButton[0],
            attachment: 'top right',
            targetAttachment: 'top left',
            offset: '5px 10px'
          });
        }
        this._infoPosition.position();
        return this.ui.infoTooltip.hide().fadeIn('fast');
      };

      GadgetInstanceView.prototype._hideInfoTooltip = function() {
        return this.ui.infoTooltip.fadeOut('fast');
      };

      GadgetInstanceView.prototype._onGadgetSeen = function() {
        this.trigger('gadgetSeen', _.pick(this.model.attributes, 'id', 'type'));
        return this._track('gadget-seen');
      };

      GadgetInstanceView.prototype.startReportingActivity = function() {
        var activityEvents, triggerActivity, triggerActivityDebounced;
        activityEvents = 'scroll mousedown DOMMouseScroll mousewheel keyup';
        triggerActivity = function() {
          return mediator.trigger('gadget:activity');
        };
        triggerActivityDebounced = _.debounce(triggerActivity, this.reportActivityEveryMs, true);
        this.ui.gadgetContent.on(activityEvents, triggerActivityDebounced);
        return this.listenTo(mediator, 'course:click', triggerActivityDebounced);
      };

      GadgetInstanceView.prototype.showCouldNotLoad = function() {
        this.$el.html(_.template(error_template));
        this.trigger('gadgetRendered');
        return this.$el.addClass('gadget-showing-dialog');
      };

      GadgetInstanceView.prototype.toggleEmpty = function(bool) {
        if (bool) {
          this._emptyState = this.model.config.toJSON();
        }
        return this.$el.toggleClass('empty', bool);
      };

      GadgetInstanceView.prototype._onGadgetConfigChange = function(config) {
        if (this._emptyState && !_.isEqual(config.toJSON(), this._emptyState)) {
          this.toggleEmpty(false);
        }
        this._launcher.setAttribute('data-config', JSON.stringify(config.toJSON()));
        if (!this.model.isNew()) {
          return this.trigger('gadgetConfigChanged', _.pick(this.model.attributes, 'id', 'type'));
        }
      };

      GadgetInstanceView.prototype._onGadgetUserStateChange = function(userState) {
        this._launcher.setAttribute('data-userstate', JSON.stringify(userState.toJSON()));
        if (!this.model.isNew()) {
          return this.trigger('gadgetUserStateChanged', _.pick(this.model.attributes, 'id', 'type'));
        }
      };

      GadgetInstanceView.prototype._onGadgetUserStateSync = function(model, response, options) {
        this.trigger('lessonIsCompleteMayHaveChanged');
        if (response.results != null) {
          return this._launcher.setAttribute('data-userstate', JSON.stringify(this.model.userState.toJSON()));
        }
      };

      GadgetInstanceView.prototype._track = function(name, detail) {
        var payload, _ref, _ref1, _ref2;
        payload = _.extend({}, detail, {
          _source: 'gadget',
          lessonId: (_ref = this.lesson) != null ? (_ref1 = _ref.model) != null ? _ref1.id : void 0 : void 0,
          gadgetId: this.model.id,
          gadgetType: (_ref2 = this.project) != null ? _ref2.type() : void 0
        });
        return tracker.track(name, payload);
      };

      GadgetInstanceView.prototype._launcherHandlers = {
        rendered: function(event) {
          this.trigger('gadgetRendered');
          return mediator.trigger('gadget:rendered', this.model);
        },
        setAttributes: function(event) {
          return this.model.config.save(event.detail);
        },
        setLearnerState: function(event) {
          return this.model.userState.save(event.detail);
        },
        selectAsset: function(event) {
          return mediator.trigger('asset:select', event.detail);
        },
        requestAsset: function(event) {
          var opts;
          opts = event.detail;
          return mediator.trigger('asset:select', {
            type: opts.type,
            success: (function(_this) {
              return function(asset) {
                if (opts.attribute) {
                  return _this.model.config.save(opts.attribute, asset);
                }
              };
            })(this)
          });
        },
        setPropertySheetAttributes: function(event) {
          return this._propertySheetSchema.set(event.detail);
        },
        setEmpty: function() {
          return this.toggleEmpty(true);
        },
        track: function(event) {
          var opts;
          opts = event.detail;
          return this._track(opts['@type'], _.omit(opts, '@type'));
        },
        changeBlocking: function() {
          return mediator.trigger('blocking:changed');
        },
        error: function(event) {
          var err;
          if ('string' === typeof event.detail) {
            err = new Error(event.detail);
          } else if (event.detail && event.detail.message) {
            err = event.detail;
          } else {
            err = new Error('Misformatted error');
          }
          this._handleError(err);
          return this.showCouldNotLoad();
        }
      };

      return GadgetInstanceView;

    })(Marionette.Layout);
  });

}).call(this);

(function() {
  define('plugins/feature-detection',[], function() {
    var FeatureDetector;
    FeatureDetector = (function() {
      function FeatureDetector() {}

      FeatureDetector.prototype.userAgent = function() {
        return this._userAgent != null ? this._userAgent : this._userAgent = navigator.userAgent.toLowerCase();
      };

      FeatureDetector.prototype.edgeScroll = function() {
        return this.isIE() || this.isChrome();
      };

      FeatureDetector.prototype.isIE = function() {
        return this.userAgent().indexOf('trident') > 0;
      };

      FeatureDetector.prototype.isChrome = function() {
        return this.userAgent().indexOf('chrome') > 0;
      };

      return FeatureDetector;

    })();
    return new FeatureDetector();
  });

}).call(this);

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/lesson_screen',['cdn.backbone', 'plugins/feature-detection'], function(Backbone, featureDetector) {
    var LessonScreenView;
    return LessonScreenView = (function(_super) {
      __extends(LessonScreenView, _super);

      function LessonScreenView() {
        this._stopScrolling = __bind(this._stopScrolling, this);
        this._scrollOneStep = __bind(this._scrollOneStep, this);
        this._startScrolling = __bind(this._startScrolling, this);
        return LessonScreenView.__super__.constructor.apply(this, arguments);
      }

      LessonScreenView.prototype.className = 'lesson-screen';

      LessonScreenView.prototype.events = {
        dragenter: 'onDragEnter',
        dragleave: 'onDragLeave',
        dragover: 'onDragOver',
        drop: 'onDrop'
      };

      LessonScreenView.prototype._scrollSpeed = 25;

      LessonScreenView.prototype._scrollDuration = 50;

      LessonScreenView.prototype._scrollDirection = 0;

      LessonScreenView.prototype.initialize = function(_arg) {
        this.lessonView = _arg.lessonView;
        this._scrollContainer = $('.js-main-container');
        return this._edgeScrollEnabled = featureDetector.edgeScroll();
      };

      LessonScreenView.prototype.onDragEnter = function(e) {
        e.preventDefault();
        e.originalEvent.dataTransfer.dropEffect = 'move';
        this._scrollRect = this._scrollContainer.get(0).getBoundingClientRect();
        return this._dropIndicator().appendTo(this.el);
      };

      LessonScreenView.prototype.onDragLeave = function(e) {
        this._dropIndicator().detach();
        return this._stopScrolling();
      };

      LessonScreenView.prototype.onDragOver = function(e) {
        var bottomOffset, mouseY, topOffset, _ref;
        e.preventDefault();
        e.originalEvent.dataTransfer.dropEffect = 'move';
        mouseY = e != null ? (_ref = e.originalEvent) != null ? _ref.clientY : void 0 : void 0;
        this._positionDropIndicator(mouseY);
        if (!this._edgeScrollEnabled && this._scrollRect) {
          topOffset = mouseY - this._scrollRect.top;
          bottomOffset = this._scrollRect.bottom - mouseY;
          if ((0 < topOffset && topOffset < 50)) {
            return this._startScrolling(-1);
          } else if ((0 < bottomOffset && bottomOffset < 50)) {
            return this._startScrolling(1);
          } else {
            return this._stopScrolling();
          }
        }
      };

      LessonScreenView.prototype.onDrop = function(e) {
        var dragData, gadget, newIndex, y;
        e.preventDefault();
        e.stopPropagation();
        this._stopScrolling();
        y = e.originalEvent.clientY;
        gadget = this.lessonView.gadgetAtCursor(y);
        if (gadget) {
          newIndex = $(gadget).index() + this._cursorPosition(gadget, y);
        } else {
          newIndex = this.lessonView.$el.find('.js-gadget').length;
        }
        dragData = JSON.parse(e.originalEvent.dataTransfer.getData('text'));
        return _.defer((function(_this) {
          return function() {
            var index;
            switch (dragData.action) {
              case 'reorder':
                index = dragData.index;
                if (index < newIndex) {
                  newIndex--;
                }
                return _this.lessonView.moveGadgetToIndex(index, newIndex);
              case 'create':
                return _this.lessonView.createGadgetTypeAt(dragData.type, newIndex);
            }
          };
        })(this));
      };

      LessonScreenView.prototype._startScrolling = function(direction) {
        if (this._scrollDirection === direction) {
          return;
        }
        this._scrollDirection = direction;
        return setTimeout(this._scrollOneStep.bind(this), 250);
      };

      LessonScreenView.prototype._scrollOneStep = function() {
        var scrollPosition;
        if (this._scrollDirection === 0) {
          return;
        }
        scrollPosition = this._scrollContainer.scrollTop() + this._scrollDirection * this._scrollSpeed;
        return this._scrollContainer.animate({
          scrollTop: scrollPosition
        }, this._scrollDuration, 'linear', this._scrollOneStep.bind(this));
      };

      LessonScreenView.prototype._stopScrolling = function() {
        if (this._scrollDirection === 0) {
          return;
        }
        return this._scrollDirection = 0;
      };

      LessonScreenView.prototype._positionDropIndicator = function(y) {
        var gadget, top;
        gadget = this.lessonView.gadgetAtCursor(y) || this.lessonView.$('.gadget').last()[0];
        if (gadget) {
          top = gadget.offsetTop - 1;
          top += this._cursorPosition(gadget, y) * (gadget.clientHeight + 2);
        } else {
          top = 0;
        }
        top += this._gadgetsOffset();
        return this._dropIndicator().css({
          top: top
        });
      };

      LessonScreenView.prototype._gadgetsOffset = function() {
        return this.lessonView.ui.lessonContent.position().top;
      };

      LessonScreenView.prototype._cursorPosition = function(element, y) {
        var middle, rect;
        rect = element.getBoundingClientRect();
        middle = rect.top + rect.height / 2;
        if (y > middle) {
          return 1;
        } else {
          return 0;
        }
      };

      LessonScreenView.prototype._dropIndicator = function() {
        return this.__dropIndicator != null ? this.__dropIndicator : this.__dropIndicator = $("<div>").addClass("gadget-drop-target").appendTo(this.el);
      };

      return LessonScreenView;

    })(Backbone.View);
  });

}).call(this);

(function() {
  define('plugins/backbone.move',['cdn.backbone', 'cdn.underscore'], function(Backbone, _) {
    Backbone.Collection.prototype.move = function(model, toIndex, options) {
      var fromIndex;
      fromIndex = this.indexOf(model);
      if (fromIndex === -1) {
        throw new Error("Can't move a model that's not in the collection");
      }
      if (fromIndex === toIndex) {
        return;
      }
      this.models.splice(toIndex, 0, this.models.splice(fromIndex, 1)[0]);
      this.trigger('sort', this);
      if (!(options != null ? options.silent : void 0)) {
        return this._syncOrder(options);
      }
    };
    Backbone.Collection.prototype._getIndexes = function() {
      return _.map(this.models, function(m) {
        return m.id;
      });
    };
    Backbone.Collection.prototype._syncOrder = function(options) {
      var indexes;
      if (options == null) {
        options = {};
      }
      indexes = this._getIndexes();
      if (!indexes.length) {
        return;
      }
      if (options.url == null) {
        options.url = _.result(this, 'url') + '/order';
      }
      if (options.attrs == null) {
        options.attrs = indexes;
      }
      return this.sync('update', this, options);
    };
    return Backbone;
  });

}).call(this);

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/lesson',['cdn.marionette', 'app/mediator', 'plugins/tracker', 'models/settings', 'libs/vs.ui', 'text!templates/lesson.html', 'views/gadget/instance', 'views/lesson_screen', 'state/position', 'cdn.jqueryui', 'plugins/backbone.move'], function(Marionette, mediator, tracker, settings, ui, lessonTemplate, GadgetInstanceView, LessonScreenView, currentPosition) {
    var Lesson;
    return Lesson = (function(_super) {
      __extends(Lesson, _super);

      function Lesson() {
        this.showGadget = __bind(this.showGadget, this);
        this.onTitleEdited = __bind(this.onTitleEdited, this);
        this.stopEditingTitle = __bind(this.stopEditingTitle, this);
        this._onDragEnd = __bind(this._onDragEnd, this);
        this._onDragStart = __bind(this._onDragStart, this);
        this._onGadgetInserted = __bind(this._onGadgetInserted, this);
        this.itemViewOptions = __bind(this.itemViewOptions, this);
        return Lesson.__super__.constructor.apply(this, arguments);
      }

      Lesson.prototype.template = _.template(lessonTemplate);

      Lesson.prototype.ui = {
        gadgets: '.gadgets',
        lessonTitle: '.js-lesson-title',
        lessonContent: '.js-lesson-content',
        screen: '.js-lesson-screen',
        canvasMessage: '.canvas-message'
      };

      Lesson.prototype.events = {
        'click .js-lesson-title': 'startEditingTitle'
      };

      Lesson.prototype.className = 'lesson';

      Lesson.prototype.itemViewContainer = '.gadgets';

      Lesson.prototype.itemView = GadgetInstanceView;

      Lesson.prototype.itemViewOptions = function(gadget) {
        var _ref;
        return {
          project: (_ref = this.palette) != null ? _ref.findByType(gadget.get('type')) : void 0,
          isEditable: this.isEditable,
          assetUrlTemplate: this.assetUrlTemplate,
          lesson: this,
          dropped: gadget.dropped
        };
      };

      Lesson.prototype.initialize = function(_arg) {
        this.palette = _arg.palette, this.isEditable = _arg.isEditable, this.assetUrlTemplate = _arg.assetUrlTemplate;
        this.collection = this.model.gadgets;
        this.activeView = null;
        this.on('itemview:lessonIsCompleteMayHaveChanged', (function(_this) {
          return function() {
            return _this.trigger('lessonIsCompleteMayHaveChanged');
          };
        })(this));
        this.on('itemview:before:startEditing', this.onBeforeStartEditingGadget);
        this.on('itemview:gadgetRendered', this._onGadgetRendered);
        this.on('itemview:gadgetConfigChanged', this._onGadgetConfigChanged, this);
        this.on('itemview:gadgetUserStateChanged', this._onGadgetUserStateChanged, this);
        this.on('itemview:gadgetSeen', this._onGadgetSeen, this);
        this.listenTo(this.model.gadgets, 'remove', this.onGadgetDeleted);
        this.listenTo(this.model.gadgets, 'change:isEditing', this.onGadgetEditingChanged);
        this.listenTo(this.model, 'change:title', this.onChangeTitle);
        this.listenTo(this, 'composite:collection:rendered', this.onCollectionRender);
        this.listenTo(this.model.gadgets, 'add remove', this.fixCanvasMessage);
        mediator.on('tray:gadgetSelected', this.addGadgetToTheEnd, this);
        mediator.on('gadget:dragstart', this._onDragStart, this);
        return mediator.on('gadget:dragend', this._onDragEnd, this);
      };

      Lesson.prototype.onRender = function() {
        this.fixCanvasMessage();
        currentPosition.set({
          lessonCid: this.model.cid,
          gadgetCid: null
        });
        if (this.isEditable) {
          (new LessonScreenView({
            el: this.ui.screen,
            lessonView: this
          })).render();
        }
        if (this.children.length === 0) {
          mediator.trigger('lesson:allGadgetsRendered', this.model);
        }
        if (this.isEditable && !this.editableTitle) {
          this.editableTitle = new ui.EditableText({
            el: this.ui.lessonTitle,
            success: this.onTitleEdited,
            complete: this.stopEditingTitle
          });
        }
        if (!this.isEditable) {
          return analytics.track('Viewed lesson', {
            courseId: settings.get('courseId'),
            lessonId: this.model.id
          });
        }
      };

      Lesson.prototype.onClose = function() {
        return mediator.off('tray:gadgetSelected', this.addGadgetToTheEnd, this);
      };

      Lesson.prototype.onGadgetEditingChanged = function(model, isEditing) {
        return this.$el.toggleClass('has-editing-gadget', isEditing);
      };

      Lesson.prototype._onGadgetConfigChanged = function(view, detail) {
        return analytics.track('Edited gadget', {
          courseId: settings.get('courseId'),
          lessonId: this.model.id,
          gadgetId: detail.id,
          gadgetType: detail.type
        });
      };

      Lesson.prototype._onGadgetUserStateChanged = function(view, detail) {
        if (this.isEditable) {
          return;
        }
        return analytics.track('Changed learner state', {
          courseId: settings.get('courseId'),
          lessonId: this.model.id,
          gadgetId: detail.id,
          gadgetType: detail.type
        });
      };

      Lesson.prototype._onGadgetSeen = function(view, detail) {
        if (this.isEditable) {
          return;
        }
        return analytics.track('Viewed gadget', {
          courseId: settings.get('courseId'),
          lessonId: this.model.id,
          gadgetId: detail.id,
          gadgetType: detail.type
        });
      };

      Lesson.prototype.onBeforeStartEditingGadget = function(view) {
        var _ref;
        if ((_ref = this._currentlyEditingGadget) != null) {
          _ref.stopEditing();
        }
        return this._currentlyEditingGadget = view;
      };

      Lesson.prototype.onBeforeStartCommentingGadget = function(view) {
        var _ref;
        if ((_ref = this._currentlyCommentingGadget) != null) {
          _ref.stopCommenting();
        }
        return this._currentlyCommentingGadget = view;
      };

      Lesson.prototype.createGadgetTypeAt = function(type, index) {
        var project;
        project = mediator.catalogue.findByType(type);
        if (project) {
          return this.insertGadgetProjectAt(project, index);
        } else {
          console.error('Project not found: ', type);
          return tracker.track('lesson-error', {
            message: 'project not found',
            type: type
          });
        }
      };

      Lesson.prototype.insertGadgetProjectAt = function(project, index) {
        var gadget;
        this.palette.add(project);
        if (gadget = project.buildInstance({
          index: index
        })) {
          gadget.dropped = true;
          this.collection.create(gadget, {
            at: index,
            success: this._onGadgetInserted
          });
          return gadget;
        } else {
          return console.error('Failed grabbing gadget ', project);
        }
      };

      Lesson.prototype._onGadgetInserted = function(gadget) {
        analytics.track('Added gadget', {
          courseId: settings.get('courseId'),
          lessonId: this.model.id,
          gadgetId: gadget.id,
          gadgetType: gadget.get('type')
        });
        return mediator.trigger('lesson:gadget:added', this, gadget);
      };

      Lesson.prototype.onGadgetDeleted = function(gadget) {
        analytics.track('Deleted gadget', {
          courseId: settings.get('courseId'),
          lessonId: this.model.id,
          gadgetId: gadget.id,
          gadgetType: gadget.get('type')
        });
        return mediator.trigger('lesson:gadget:deleted', this, gadget);
      };

      Lesson.prototype.moveGadgetToIndex = function(oldIndex, newIndex) {
        var $element, model;
        if (oldIndex === newIndex) {
          return;
        }
        model = this.collection.at(oldIndex);
        this.collection.move(model, newIndex);
        $element = this.children.findByModel(model).$el.detach();
        return _.defer((function(_this) {
          return function() {
            var previousView;
            if (newIndex === 0) {
              _this.ui.gadgets.prepend($element);
            } else {
              previousView = _this.children.findByModel(_this.collection.at(newIndex - 1));
              $element.insertAfter(previousView.el);
            }
            mediator.trigger('lesson:gadget:moved', _this);
            return _this._relegateChildGadgets();
          };
        })(this));
      };

      Lesson.prototype._onDragStart = function(e) {
        return this.$el.addClass('dragover');
      };

      Lesson.prototype._onDragEnd = function() {
        return this.$el.removeClass('dragover');
      };

      Lesson.prototype.gadgetAtCursor = function(y) {
        var gadgets;
        if (!this._cursorInsideElement(y, this._activeGadget)) {
          gadgets = this.el.querySelectorAll('.js-gadget');
          if (gadgets.length === 0) {
            this._activeGadget = null;
          } else if (gadgets[0].getBoundingClientRect().top >= y) {
            this._activeGadget = gadgets[0];
          } else {
            this._activeGadget = _.find(gadgets, this._cursorInsideElement.bind(null, y));
          }
        }
        return this._activeGadget;
      };

      Lesson.prototype._cursorInsideElement = function(y, element) {
        var rect;
        if (!element) {
          return;
        }
        rect = element.getBoundingClientRect();
        return (rect.top <= y && y < rect.bottom);
      };

      Lesson.prototype.onCollectionRender = function() {
        this._currentlyCommentingGadget = null;
        return this._currentlyEditingGadget = null;
      };

      Lesson.prototype.startEditingTitle = function() {
        var _ref;
        return (_ref = this.editableTitle) != null ? _ref.toggleEdit(true) : void 0;
      };

      Lesson.prototype.stopEditingTitle = function() {
        var _ref;
        return (_ref = this.editableTitle) != null ? _ref.toggleEdit(false) : void 0;
      };

      Lesson.prototype.onTitleEdited = function(title) {
        return this.model.save({
          title: title
        });
      };

      Lesson.prototype.appendHtml = function(collectionView, itemView, index) {
        var children;
        if (itemView.isChild()) {
          this._onGadgetRendered(itemView);
          return false;
        }
        children = this.ui.gadgets.children();
        if (children.size() <= index) {
          return this.ui.gadgets.append(itemView.el);
        } else {
          return children.eq(index).before(itemView.el);
        }
      };

      Lesson.prototype._onGadgetRendered = function(itemView) {
        var renderedAll;
        itemView.rendered = true;
        renderedAll = this.children.every(function(view) {
          return view.rendered;
        });
        if (renderedAll) {
          return mediator.trigger('lesson:allGadgetsRendered', this.model);
        }
      };

      Lesson.prototype.showHoverables = function(bool) {
        if (bool == null) {
          bool = true;
        }
        return this.children.each(function(itemView) {
          return itemView.showHoverables(bool);
        });
      };

      Lesson.prototype.showGadget = function(gadgetIndex) {
        var $scrollContainer, gadget;
        $scrollContainer = $('.js-main-container');
        gadget = this.children.findByIndex(gadgetIndex - 1);
        if (this._showGadget == null) {
          this._showGadget = _.debounce(function(gadget) {
            return gadget.gadgetRendering.done(function() {
              var scrollTop;
              scrollTop = gadget.$el.offset().top + $scrollContainer.scrollTop();
              scrollTop += 5;
              return $scrollContainer.animate({
                scrollTop: scrollTop
              }, 'fast');
            });
          }, 250, true);
        }
        return this._showGadget(gadget);
      };

      Lesson.prototype.isComplete = function() {
        if (this.model.collection.indexOf(this.model) < this.model.collection.length - 1) {
          throw 'Only call isComplete on the last lesson';
        }
        return this.model.gadgets.every(function(gadget) {
          var _ref;
          return (gadget.get('type') !== '6/quiz@1.0.04') || (((_ref = gadget.userState.get('results')) != null ? _ref.pass : void 0) === true);
        });
      };

      Lesson.prototype.onChangeTitle = function(model, title) {
        this.ui.lessonTitle.text(title);
        return this.ui.lessonTitle.scrollLeft(0);
      };

      Lesson.prototype.addGadgetToTheEnd = function(project) {
        return this.insertGadgetProjectAt(project, this.children.length);
      };

      Lesson.prototype._relegateChildGadgets = function() {
        var childModels;
        childModels = [];
        this.collection.each((function(_this) {
          return function(model) {
            if (model.isChild) {
              childModels.push(model);
              return _this.collection.remove(model, {
                silent: true
              });
            }
          };
        })(this));
        return this.collection.add(childModels, {
          silent: true
        });
      };

      Lesson.prototype.fixCanvasMessage = function() {
        return this.ui.canvasMessage.toggleClass('hidden', !!this.collection.length);
      };

      return Lesson;

    })(Marionette.CompositeView);
  });

}).call(this);


define('text!templates/loading.html',[],function () { return '<div class="loading-overlay">\n  <div class="loading-content">\n    <i class="spin-holder"></i>\n    Loading...\n  </div>\n</div>\n\n';});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/loading',['cdn.marionette', 'libs/vs.ui', 'text!templates/loading.html'], function(Marionette, ui, template) {
    var LoadingView;
    return LoadingView = (function(_super) {
      __extends(LoadingView, _super);

      function LoadingView() {
        return LoadingView.__super__.constructor.apply(this, arguments);
      }

      LoadingView.prototype.className = 'loading-page';

      LoadingView.prototype.template = _.template(template);

      LoadingView.prototype.onRender = function() {
        return new ui.LoadingIndicator(this.$('.spin-holder'));
      };

      LoadingView.prototype.hide = function(cb) {
        return this.$('.loading-overlay').fadeOut(400, (function(_this) {
          return function() {
            return typeof cb === "function" ? cb() : void 0;
          };
        })(this));
      };

      return LoadingView;

    })(Marionette.ItemView);
  });

}).call(this);


define('text!templates/nav-buttons.html',[],function () { return '<%= buttonIf(previousAvailable(), \'js-prev previous-button\', \'previous\', \'left\') %>\n<%= buttonIf(nextAvailable(), \'js-next next-button\', \'next\', \'right\') %>\n<%= buttonIf(isComplete() && !nextAvailable(), \'js-finish finish-button\', \'finish course\', \'right\') %>\n<div class="clearfix"></div>\n';});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/user',['cdn.backbone'], function(Backbone) {
    var User;
    return User = (function(_super) {
      __extends(User, _super);

      function User() {
        return User.__super__.constructor.apply(this, arguments);
      }

      User.prototype.urlRoot = '/users';

      User.prototype.defaults = function() {
        return {
          fn: 'Anonymous',
          location: '',
          shortDesc: '',
          longDesc: '',
          website: '',
          social: [],
          registered: false
        };
      };

      User.prototype.fetch = function(options) {
        if (options == null) {
          options = {};
        }
        if (options.self) {
          options.url = '/user';
        }
        return User.__super__.fetch.call(this, options);
      };

      return User;

    })(Backbone.Model);
  });

}).call(this);

define('libs/analytics',[], function(){
  // The below code can be already executed on the site using player,
  // so let's skip it if window.analytics already exists.
  // TODO: Reconsider this implementation with updating player to use iframe 
  // on versal.com, driverpermit.com and testpreplabs.com
  if (window.analytics) return window.analytics;

  // The code below is copied-and-pasted from
  // https://segment.io/docs/tutorials/quickstart-analytics.js/
  // and wrapped in AMD

  // Create a queue, but don't obliterate an existing one!
  window.analytics = [];

  // A list of the methods in Analytics.js to stub.
  window.analytics.methods = ['identify', 'group', 'track',
    'page', 'pageview', 'alias', 'ready', 'on', 'once', 'off',
    'trackLink', 'trackForm', 'trackClick', 'trackSubmit'];

  // Define a factory to create stubs. These are placeholders
  // for methods in Analytics.js so that you never have to wait
  // for it to load to actually record data. The `method` is
  // stored as the first argument, so we can replay the data.
  window.analytics.factory = function(method){
    return function(){
      var args = Array.prototype.slice.call(arguments);
      args.unshift(method);
      window.analytics.push(args);
      return window.analytics;
    };
  };

  // For each of our methods, generate a queueing stub.
  for (var i = 0; i < window.analytics.methods.length; i++) {
    var key = window.analytics.methods[i];
    window.analytics[key] = window.analytics.factory(key);
  }

  // Define a method to load Analytics.js from our CDN,
  // and that will be sure to only ever load it once.
  window.analytics.load = function(key){
    if (document.getElementById('analytics-js')) return;

    // Create an async script element based on your key.
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.id = 'analytics-js';
    script.async = true;
    script.src = ('https:' === document.location.protocol
      ? 'https://' : 'http://')
      + 'cdn.segment.io/analytics.js/v1/'
      + key + '/analytics.min.js';

    // Insert our script next to the first script element.
    var first = document.getElementsByTagName('script')[0];
    first.parentNode.insertBefore(script, first);
  };

  // Add a version to keep track of what's in the wild.
  window.analytics.SNIPPET_VERSION = '2.0.9';

  return window.analytics;
});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/nav_buttons',['cdn.marionette', 'text!templates/nav-buttons.html', 'app/mediator', 'models/user', 'libs/analytics'], function(Marionette, template, mediator, User, analytics) {
    var NavButtonsView;
    return NavButtonsView = (function(_super) {
      __extends(NavButtonsView, _super);

      function NavButtonsView() {
        this.templateHelpers = __bind(this.templateHelpers, this);
        this.buttonIf = __bind(this.buttonIf, this);
        this.isComplete = __bind(this.isComplete, this);
        this.nextAvailable = __bind(this.nextAvailable, this);
        this.previousAvailable = __bind(this.previousAvailable, this);
        this._onCourseEnd = __bind(this._onCourseEnd, this);
        return NavButtonsView.__super__.constructor.apply(this, arguments);
      }

      NavButtonsView.prototype.className = 'nav-buttons';

      NavButtonsView.prototype.initialize = function() {
        mediator.on('lesson:rendered', this.updateButtons, this);
        return this._isEditable = this.model.get('isEditable');
      };

      NavButtonsView.prototype.onClose = function() {
        return mediator.off('lesson:rendered', this.updateButtons);
      };

      NavButtonsView.prototype.events = {
        'click .js-prev': 'onPreviousClick',
        'click .js-next': 'onNextClick',
        'click .js-finish': 'onFinishClick'
      };

      NavButtonsView.prototype.ui = {
        finishButton: '.js-finish',
        nextButton: '.js-next',
        prevButton: '.js-prev'
      };

      NavButtonsView.prototype.template = _.template(template);

      NavButtonsView.prototype.updateButtons = function(newLessonView) {
        var _ref, _ref1, _ref2;
        if ((_ref = this.lessonView) != null) {
          _ref.off('lessonIsCompleteMayHaveChanged', this.render);
        }
        if ((_ref1 = this.next) != null) {
          _ref1.off('change:isAccessible', this.render);
        }
        this.lessonView = newLessonView;
        this.prev = this.model.lessons.at(this.model.lessons.indexOf(this.lessonView.model) - 1);
        this.next = this.model.lessons.at(this.model.lessons.indexOf(this.lessonView.model) + 1);
        this.lessonView.on('lessonIsCompleteMayHaveChanged', this.render, this);
        if ((_ref2 = this.next) != null) {
          _ref2.on('change:isAccessible', this.render, this);
        }
        return this.render();
      };

      NavButtonsView.prototype.onPreviousClick = function() {
        var destination;
        this.ui.prevButton.addClass('disabled');
        destination = 1 + this.model.lessons.indexOf(this.prev);
        return mediator.trigger('navigate:lesson', destination);
      };

      NavButtonsView.prototype.onNextClick = function() {
        var destination;
        this.ui.nextButton.addClass('disabled');
        destination = 1 + this.model.lessons.indexOf(this.next);
        return mediator.trigger('navigate:lesson', destination);
      };

      NavButtonsView.prototype._fetchCurrentUser = function() {
        return (new User).fetch({
          self: true
        });
      };

      NavButtonsView.prototype._onCourseEnd = function(user) {
        mediator.trigger('parent:notify', {
          event: 'player:course:completed',
          user: _.pick(user, 'email', 'id')
        });
        return this.ui.finishButton.removeClass('disabled');
      };

      NavButtonsView.prototype.onFinishClick = function() {
        if (this.ui.finishButton.hasClass('disabled')) {
          return;
        }
        analytics.track('Finished course', {
          courseId: this.model.id
        });
        this.ui.finishButton.addClass('disabled');
        return this.model.complete().then(this._fetchCurrentUser).then(this._onCourseEnd);
      };

      NavButtonsView.prototype.previousAvailable = function() {
        return (this.prev != null) && (this.prev.get('isAccessible') || this._isEditable);
      };

      NavButtonsView.prototype.nextAvailable = function() {
        return (this.next != null) && (this.next.get('isAccessible') || this._isEditable);
      };

      NavButtonsView.prototype.isComplete = function() {
        var _ref;
        return !this.next && ((_ref = this.lessonView) != null ? _ref.isComplete() : void 0);
      };

      NavButtonsView.prototype.buttonIf = function(criterion, classname, content, position) {
        if (criterion) {
          return "<a class='nav-button " + classname + " pull-" + position + "'>\n  <i class='icon-caret-" + position + " pull-" + position + "'></i>\n  <span class='nav-button-text'>" + content + "</span>\n</a>";
        }
      };

      NavButtonsView.prototype.templateHelpers = function() {
        return {
          previousAvailable: this.previousAvailable,
          nextAvailable: this.nextAvailable,
          isComplete: this.isComplete,
          buttonIf: this.buttonIf
        };
      };

      return NavButtonsView;

    })(Marionette.CompositeView);
  });

}).call(this);

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/course',['cdn.jquery', 'cdn.marionette', 'text!templates/course.html', 'views/lesson', 'views/loading', 'app/mediator', 'plugins/tracker', 'views/nav_buttons'], function($, Marionette, template, LessonView, LoadingView, mediator, tracker, NavButtonsView) {
    var Course;
    return Course = (function(_super) {
      __extends(Course, _super);

      function Course() {
        this._refetchSections = __bind(this._refetchSections, this);
        this.onClick = __bind(this.onClick, this);
        return Course.__super__.constructor.apply(this, arguments);
      }

      Course.prototype.initialize = function() {
        this.listenTo(this.model.lessons, 'add', this.onLessonsAdd, this);
        this.listenTo(this.model.lessons, 'select', this.onLessonSelected, this);
        mediator.on('tray:gadgetUpdated', this.rerenderLesson, this);
        mediator.on('blocking:changed', this._onBlockingChanged, this);
        mediator.on('plugin:populate:updateBar', this._onPopulateUpdateBar, this);
        return this._isEditable = this.model.get('isEditable');
      };

      Course.prototype.onClose = function() {
        mediator.off('tray:gadgetUpdated', this.rerenderLesson, this);
        mediator.off('blocking:changed', this._onBlockingChanged, this);
        mediator.off('plugin:populate:updateBar', this._onPopulateUpdateBar, this);
        mediator.off('course:save:error', this.showSaveErrorMsg, this);
        return mediator.off('course:save:success', this.hideSaveErrorMsg, this);
      };

      Course.prototype.ui = {
        saveErrorMsg: '.saveErrorMsg'
      };

      Course.prototype.regions = {
        updateNotificationContainer: '.js-update-notification-container',
        lessonRegion: '.js-lessons',
        loadingRegion: '.js-loading',
        nav: '.js-nav'
      };

      Course.prototype.template = _.template(template);

      Course.prototype.className = function() {
        if (this._isEditable) {
          return 'course editable';
        } else {
          return 'course';
        }
      };

      Course.prototype.getLessonView = function(lesson) {
        return this.children.findByModel(lesson);
      };

      Course.prototype.activeLessonIndex = function() {
        return this.model.lessons.indexOf(this._activeLesson);
      };

      Course.prototype.activateLesson = function(lesson) {
        if (this.loadingLesson) {
          this.loadingLesson.abort();
        }
        this.renderingLesson = $.Deferred();
        if (this.model.lessons.indexOf(lesson) === -1 || lesson === this._activeLesson) {
          this.renderingLesson.resolve();
          return false;
        }
        this.loadingLesson = lesson.fetch();
        tracker.timeXHR(this.loadingLesson, 'fetch-lesson', {
          lessonId: lesson.id
        });
        if (this._activeLesson) {
          this._loadingView = new LoadingView;
          this.loadingRegion.show(this._loadingView);
        }
        this._activeLesson = null;
        return this.loadingLesson.done((function(_this) {
          return function() {
            return _this.displayLesson(lesson);
          };
        })(this));
      };

      Course.prototype.displayLesson = function(lesson) {
        var lastActiveLesson, lessonIndex, _ref, _ref1;
        lastActiveLesson = this._activeLesson;
        this._activeLesson = lesson;
        if (this._loadingView) {
          this._loadingView.hide((function(_this) {
            return function() {
              return _this.loadingRegion.close();
            };
          })(this));
        }
        lessonIndex = this.activeLessonIndex() + 1;
        if (this.model.progress.get('lessonIndex') !== lessonIndex) {
          if ((_ref = this.renderingLesson) != null) {
            _ref.done((function(_this) {
              return function() {
                return _this.model.progress.save({
                  lessonIndex: lessonIndex
                });
              };
            })(this));
          }
        }
        if ((_ref1 = this._lessonView) != null) {
          _ref1.close();
        }
        this._lessonView = new LessonView({
          model: this._activeLesson,
          palette: this.model.palette,
          isEditable: this._isEditable,
          assetUrlTemplate: this.model.get('assetUrlTemplate')
        });
        this.lessonRegion.show(this._lessonView);
        $('.js-main-container').scrollTop(0);
        if (this.renderingLesson) {
          this.renderingLesson.resolve();
        }
        mediator.trigger('lesson:rendered', this._lessonView);
        if (lastActiveLesson) {
          mediator.trigger('lesson:closed', lastActiveLesson);
        }
        return mediator.trigger('lesson:opened', this._activeLesson);
      };

      Course.prototype.startEditing = function(field) {
        if (!this._isEditable) {
          return;
        }
        field.toggleEdit(true);
        field.$el.parent().addClass('editing');
        return this._lessonView.showHoverables(false);
      };

      Course.prototype.onLessonSelected = function(lesson) {
        return this.activateLesson(lesson);
      };

      Course.prototype.onRender = function() {
        this._rendered = true;
        this.el.className = this.className();
        this.activateLesson(this._activeLesson || this.model.lessons.first());
        this.navView = new NavButtonsView({
          model: this.model
        });
        this.nav.show(this.navView);
        mediator.on('course:save:error', this.showSaveErrorMsg, this);
        return mediator.on('course:save:success', this.hideSaveErrorMsg, this);
      };

      Course.prototype._onPopulateUpdateBar = function(view) {
        this.updateNotificationContainer.show(view);
        return $(window).on('click', this.onClick);
      };

      Course.prototype.onShow = function() {
        return mediator.trigger('player:course:ready');
      };

      Course.prototype.onClick = function(e) {
        if (!this.isModalOpen()) {
          return mediator.trigger('course:click', e);
        }
      };

      Course.prototype.isModalOpen = function() {
        return !!$('.modal').length;
      };

      Course.prototype.showLesson = function(lessonIndex) {
        return this.showGadget(lessonIndex, null);
      };

      Course.prototype.showGadget = function(lessonIndex, gadgetIndex) {
        var lesson;
        if (lesson = this.model.lessons.at(lessonIndex - 1)) {
          this.activateLesson(lesson);
        }
        return this.renderingLesson.done((function(_this) {
          return function() {
            if (gadgetIndex) {
              return _this._lessonView.showGadget(gadgetIndex);
            } else {
              return $('.js-main-container').animate({
                scrollTop: 0
              });
            }
          };
        })(this));
      };

      Course.prototype.showSaveErrorMsg = function() {
        if (!(this.saveErrorShowing || !this._isEditable)) {
          this.ui.saveErrorMsg.slideDown(50);
          return this.saveErrorShowing = true;
        }
      };

      Course.prototype.hideSaveErrorMsg = function() {
        if (this.saveErrorShowing) {
          this.saveErrorShowing = false;
          return this.ui.saveErrorMsg.slideUp(50);
        }
      };

      Course.prototype._onBlockingChanged = function() {
        return setTimeout(this._refetchSections, 100);
      };

      Course.prototype._refetchSections = function() {
        var fetchingSections;
        fetchingSections = this.model.fetch({
          data: {
            depth: 'sections'
          },
          success: (function(_this) {
            return function() {
              return _this.navView.updateButtons(_this._lessonView);
            };
          })(this)
        });
        return tracker.timeXHR(fetchingSections, 'fetch-sections', {
          courseId: this.model.id
        });
      };

      Course.prototype.rerenderLesson = function() {
        return this.displayLesson(this._activeLesson);
      };

      return Course;

    })(Marionette.Layout);
  });

}).call(this);

/**
 * React (with addons) v0.11.2
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define('react',[],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.React=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule AutoFocusMixin
 * @typechecks static-only
 */



var focusNode = _dereq_("./focusNode");

var AutoFocusMixin = {
  componentDidMount: function() {
    if (this.props.autoFocus) {
      focusNode(this.getDOMNode());
    }
  }
};

module.exports = AutoFocusMixin;

},{"./focusNode":120}],2:[function(_dereq_,module,exports){
/**
 * Copyright 2013 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule BeforeInputEventPlugin
 * @typechecks static-only
 */



var EventConstants = _dereq_("./EventConstants");
var EventPropagators = _dereq_("./EventPropagators");
var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");
var SyntheticInputEvent = _dereq_("./SyntheticInputEvent");

var keyOf = _dereq_("./keyOf");

var canUseTextInputEvent = (
  ExecutionEnvironment.canUseDOM &&
  'TextEvent' in window &&
  !('documentMode' in document || isPresto())
);

/**
 * Opera <= 12 includes TextEvent in window, but does not fire
 * text input events. Rely on keypress instead.
 */
function isPresto() {
  var opera = window.opera;
  return (
    typeof opera === 'object' &&
    typeof opera.version === 'function' &&
    parseInt(opera.version(), 10) <= 12
  );
}

var SPACEBAR_CODE = 32;
var SPACEBAR_CHAR = String.fromCharCode(SPACEBAR_CODE);

var topLevelTypes = EventConstants.topLevelTypes;

// Events and their corresponding property names.
var eventTypes = {
  beforeInput: {
    phasedRegistrationNames: {
      bubbled: keyOf({onBeforeInput: null}),
      captured: keyOf({onBeforeInputCapture: null})
    },
    dependencies: [
      topLevelTypes.topCompositionEnd,
      topLevelTypes.topKeyPress,
      topLevelTypes.topTextInput,
      topLevelTypes.topPaste
    ]
  }
};

// Track characters inserted via keypress and composition events.
var fallbackChars = null;

/**
 * Return whether a native keypress event is assumed to be a command.
 * This is required because Firefox fires `keypress` events for key commands
 * (cut, copy, select-all, etc.) even though no character is inserted.
 */
function isKeypressCommand(nativeEvent) {
  return (
    (nativeEvent.ctrlKey || nativeEvent.altKey || nativeEvent.metaKey) &&
    // ctrlKey && altKey is equivalent to AltGr, and is not a command.
    !(nativeEvent.ctrlKey && nativeEvent.altKey)
  );
}

/**
 * Create an `onBeforeInput` event to match
 * http://www.w3.org/TR/2013/WD-DOM-Level-3-Events-20131105/#events-inputevents.
 *
 * This event plugin is based on the native `textInput` event
 * available in Chrome, Safari, Opera, and IE. This event fires after
 * `onKeyPress` and `onCompositionEnd`, but before `onInput`.
 *
 * `beforeInput` is spec'd but not implemented in any browsers, and
 * the `input` event does not provide any useful information about what has
 * actually been added, contrary to the spec. Thus, `textInput` is the best
 * available event to identify the characters that have actually been inserted
 * into the target node.
 */
var BeforeInputEventPlugin = {

  eventTypes: eventTypes,

  /**
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {DOMEventTarget} topLevelTarget The listening component root node.
   * @param {string} topLevelTargetID ID of `topLevelTarget`.
   * @param {object} nativeEvent Native browser event.
   * @return {*} An accumulation of synthetic events.
   * @see {EventPluginHub.extractEvents}
   */
  extractEvents: function(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent) {

    var chars;

    if (canUseTextInputEvent) {
      switch (topLevelType) {
        case topLevelTypes.topKeyPress:
          /**
           * If native `textInput` events are available, our goal is to make
           * use of them. However, there is a special case: the spacebar key.
           * In Webkit, preventing default on a spacebar `textInput` event
           * cancels character insertion, but it *also* causes the browser
           * to fall back to its default spacebar behavior of scrolling the
           * page.
           *
           * Tracking at:
           * https://code.google.com/p/chromium/issues/detail?id=355103
           *
           * To avoid this issue, use the keypress event as if no `textInput`
           * event is available.
           */
          var which = nativeEvent.which;
          if (which !== SPACEBAR_CODE) {
            return;
          }

          chars = String.fromCharCode(which);
          break;

        case topLevelTypes.topTextInput:
          // Record the characters to be added to the DOM.
          chars = nativeEvent.data;

          // If it's a spacebar character, assume that we have already handled
          // it at the keypress level and bail immediately.
          if (chars === SPACEBAR_CHAR) {
            return;
          }

          // Otherwise, carry on.
          break;

        default:
          // For other native event types, do nothing.
          return;
      }
    } else {
      switch (topLevelType) {
        case topLevelTypes.topPaste:
          // If a paste event occurs after a keypress, throw out the input
          // chars. Paste events should not lead to BeforeInput events.
          fallbackChars = null;
          break;
        case topLevelTypes.topKeyPress:
          /**
           * As of v27, Firefox may fire keypress events even when no character
           * will be inserted. A few possibilities:
           *
           * - `which` is `0`. Arrow keys, Esc key, etc.
           *
           * - `which` is the pressed key code, but no char is available.
           *   Ex: 'AltGr + d` in Polish. There is no modified character for
           *   this key combination and no character is inserted into the
           *   document, but FF fires the keypress for char code `100` anyway.
           *   No `input` event will occur.
           *
           * - `which` is the pressed key code, but a command combination is
           *   being used. Ex: `Cmd+C`. No character is inserted, and no
           *   `input` event will occur.
           */
          if (nativeEvent.which && !isKeypressCommand(nativeEvent)) {
            fallbackChars = String.fromCharCode(nativeEvent.which);
          }
          break;
        case topLevelTypes.topCompositionEnd:
          fallbackChars = nativeEvent.data;
          break;
      }

      // If no changes have occurred to the fallback string, no relevant
      // event has fired and we're done.
      if (fallbackChars === null) {
        return;
      }

      chars = fallbackChars;
    }

    // If no characters are being inserted, no BeforeInput event should
    // be fired.
    if (!chars) {
      return;
    }

    var event = SyntheticInputEvent.getPooled(
      eventTypes.beforeInput,
      topLevelTargetID,
      nativeEvent
    );

    event.data = chars;
    fallbackChars = null;
    EventPropagators.accumulateTwoPhaseDispatches(event);
    return event;
  }
};

module.exports = BeforeInputEventPlugin;

},{"./EventConstants":16,"./EventPropagators":21,"./ExecutionEnvironment":22,"./SyntheticInputEvent":98,"./keyOf":141}],3:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule CSSCore
 * @typechecks
 */

var invariant = _dereq_("./invariant");

/**
 * The CSSCore module specifies the API (and implements most of the methods)
 * that should be used when dealing with the display of elements (via their
 * CSS classes and visibility on screen. It is an API focused on mutating the
 * display and not reading it as no logical state should be encoded in the
 * display of elements.
 */

var CSSCore = {

  /**
   * Adds the class passed in to the element if it doesn't already have it.
   *
   * @param {DOMElement} element the element to set the class on
   * @param {string} className the CSS className
   * @return {DOMElement} the element passed in
   */
  addClass: function(element, className) {
    ("production" !== "development" ? invariant(
      !/\s/.test(className),
      'CSSCore.addClass takes only a single class name. "%s" contains ' +
      'multiple classes.', className
    ) : invariant(!/\s/.test(className)));

    if (className) {
      if (element.classList) {
        element.classList.add(className);
      } else if (!CSSCore.hasClass(element, className)) {
        element.className = element.className + ' ' + className;
      }
    }
    return element;
  },

  /**
   * Removes the class passed in from the element
   *
   * @param {DOMElement} element the element to set the class on
   * @param {string} className the CSS className
   * @return {DOMElement} the element passed in
   */
  removeClass: function(element, className) {
    ("production" !== "development" ? invariant(
      !/\s/.test(className),
      'CSSCore.removeClass takes only a single class name. "%s" contains ' +
      'multiple classes.', className
    ) : invariant(!/\s/.test(className)));

    if (className) {
      if (element.classList) {
        element.classList.remove(className);
      } else if (CSSCore.hasClass(element, className)) {
        element.className = element.className
          .replace(new RegExp('(^|\\s)' + className + '(?:\\s|$)', 'g'), '$1')
          .replace(/\s+/g, ' ') // multiple spaces to one
          .replace(/^\s*|\s*$/g, ''); // trim the ends
      }
    }
    return element;
  },

  /**
   * Helper to add or remove a class from an element based on a condition.
   *
   * @param {DOMElement} element the element to set the class on
   * @param {string} className the CSS className
   * @param {*} bool condition to whether to add or remove the class
   * @return {DOMElement} the element passed in
   */
  conditionClass: function(element, className, bool) {
    return (bool ? CSSCore.addClass : CSSCore.removeClass)(element, className);
  },

  /**
   * Tests whether the element has the class specified.
   *
   * @param {DOMNode|DOMWindow} element the element to set the class on
   * @param {string} className the CSS className
   * @returns {boolean} true if the element has the class, false if not
   */
  hasClass: function(element, className) {
    ("production" !== "development" ? invariant(
      !/\s/.test(className),
      'CSS.hasClass takes only a single class name.'
    ) : invariant(!/\s/.test(className)));
    if (element.classList) {
      return !!className && element.classList.contains(className);
    }
    return (' ' + element.className + ' ').indexOf(' ' + className + ' ') > -1;
  }

};

module.exports = CSSCore;

},{"./invariant":134}],4:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule CSSProperty
 */



/**
 * CSS properties which accept numbers but are not in units of "px".
 */
var isUnitlessNumber = {
  columnCount: true,
  fillOpacity: true,
  flex: true,
  flexGrow: true,
  flexShrink: true,
  fontWeight: true,
  lineClamp: true,
  lineHeight: true,
  opacity: true,
  order: true,
  orphans: true,
  widows: true,
  zIndex: true,
  zoom: true
};

/**
 * @param {string} prefix vendor-specific prefix, eg: Webkit
 * @param {string} key style name, eg: transitionDuration
 * @return {string} style name prefixed with `prefix`, properly camelCased, eg:
 * WebkitTransitionDuration
 */
function prefixKey(prefix, key) {
  return prefix + key.charAt(0).toUpperCase() + key.substring(1);
}

/**
 * Support style names that may come passed in prefixed by adding permutations
 * of vendor prefixes.
 */
var prefixes = ['Webkit', 'ms', 'Moz', 'O'];

// Using Object.keys here, or else the vanilla for-in loop makes IE8 go into an
// infinite loop, because it iterates over the newly added props too.
Object.keys(isUnitlessNumber).forEach(function(prop) {
  prefixes.forEach(function(prefix) {
    isUnitlessNumber[prefixKey(prefix, prop)] = isUnitlessNumber[prop];
  });
});

/**
 * Most style properties can be unset by doing .style[prop] = '' but IE8
 * doesn't like doing that with shorthand properties so for the properties that
 * IE8 breaks on, which are listed here, we instead unset each of the
 * individual properties. See http://bugs.jquery.com/ticket/12385.
 * The 4-value 'clock' properties like margin, padding, border-width seem to
 * behave without any problems. Curiously, list-style works too without any
 * special prodding.
 */
var shorthandPropertyExpansions = {
  background: {
    backgroundImage: true,
    backgroundPosition: true,
    backgroundRepeat: true,
    backgroundColor: true
  },
  border: {
    borderWidth: true,
    borderStyle: true,
    borderColor: true
  },
  borderBottom: {
    borderBottomWidth: true,
    borderBottomStyle: true,
    borderBottomColor: true
  },
  borderLeft: {
    borderLeftWidth: true,
    borderLeftStyle: true,
    borderLeftColor: true
  },
  borderRight: {
    borderRightWidth: true,
    borderRightStyle: true,
    borderRightColor: true
  },
  borderTop: {
    borderTopWidth: true,
    borderTopStyle: true,
    borderTopColor: true
  },
  font: {
    fontStyle: true,
    fontVariant: true,
    fontWeight: true,
    fontSize: true,
    lineHeight: true,
    fontFamily: true
  }
};

var CSSProperty = {
  isUnitlessNumber: isUnitlessNumber,
  shorthandPropertyExpansions: shorthandPropertyExpansions
};

module.exports = CSSProperty;

},{}],5:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule CSSPropertyOperations
 * @typechecks static-only
 */



var CSSProperty = _dereq_("./CSSProperty");

var dangerousStyleValue = _dereq_("./dangerousStyleValue");
var hyphenateStyleName = _dereq_("./hyphenateStyleName");
var memoizeStringOnly = _dereq_("./memoizeStringOnly");

var processStyleName = memoizeStringOnly(function(styleName) {
  return hyphenateStyleName(styleName);
});

/**
 * Operations for dealing with CSS properties.
 */
var CSSPropertyOperations = {

  /**
   * Serializes a mapping of style properties for use as inline styles:
   *
   *   > createMarkupForStyles({width: '200px', height: 0})
   *   "width:200px;height:0;"
   *
   * Undefined values are ignored so that declarative programming is easier.
   * The result should be HTML-escaped before insertion into the DOM.
   *
   * @param {object} styles
   * @return {?string}
   */
  createMarkupForStyles: function(styles) {
    var serialized = '';
    for (var styleName in styles) {
      if (!styles.hasOwnProperty(styleName)) {
        continue;
      }
      var styleValue = styles[styleName];
      if (styleValue != null) {
        serialized += processStyleName(styleName) + ':';
        serialized += dangerousStyleValue(styleName, styleValue) + ';';
      }
    }
    return serialized || null;
  },

  /**
   * Sets the value for multiple styles on a node.  If a value is specified as
   * '' (empty string), the corresponding style property will be unset.
   *
   * @param {DOMElement} node
   * @param {object} styles
   */
  setValueForStyles: function(node, styles) {
    var style = node.style;
    for (var styleName in styles) {
      if (!styles.hasOwnProperty(styleName)) {
        continue;
      }
      var styleValue = dangerousStyleValue(styleName, styles[styleName]);
      if (styleValue) {
        style[styleName] = styleValue;
      } else {
        var expansion = CSSProperty.shorthandPropertyExpansions[styleName];
        if (expansion) {
          // Shorthand property that IE8 won't like unsetting, so unset each
          // component to placate it
          for (var individualStyleName in expansion) {
            style[individualStyleName] = '';
          }
        } else {
          style[styleName] = '';
        }
      }
    }
  }

};

module.exports = CSSPropertyOperations;

},{"./CSSProperty":4,"./dangerousStyleValue":115,"./hyphenateStyleName":132,"./memoizeStringOnly":143}],6:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule CallbackQueue
 */



var PooledClass = _dereq_("./PooledClass");

var invariant = _dereq_("./invariant");
var mixInto = _dereq_("./mixInto");

/**
 * A specialized pseudo-event module to help keep track of components waiting to
 * be notified when their DOM representations are available for use.
 *
 * This implements `PooledClass`, so you should never need to instantiate this.
 * Instead, use `CallbackQueue.getPooled()`.
 *
 * @class ReactMountReady
 * @implements PooledClass
 * @internal
 */
function CallbackQueue() {
  this._callbacks = null;
  this._contexts = null;
}

mixInto(CallbackQueue, {

  /**
   * Enqueues a callback to be invoked when `notifyAll` is invoked.
   *
   * @param {function} callback Invoked when `notifyAll` is invoked.
   * @param {?object} context Context to call `callback` with.
   * @internal
   */
  enqueue: function(callback, context) {
    this._callbacks = this._callbacks || [];
    this._contexts = this._contexts || [];
    this._callbacks.push(callback);
    this._contexts.push(context);
  },

  /**
   * Invokes all enqueued callbacks and clears the queue. This is invoked after
   * the DOM representation of a component has been created or updated.
   *
   * @internal
   */
  notifyAll: function() {
    var callbacks = this._callbacks;
    var contexts = this._contexts;
    if (callbacks) {
      ("production" !== "development" ? invariant(
        callbacks.length === contexts.length,
        "Mismatched list of contexts in callback queue"
      ) : invariant(callbacks.length === contexts.length));
      this._callbacks = null;
      this._contexts = null;
      for (var i = 0, l = callbacks.length; i < l; i++) {
        callbacks[i].call(contexts[i]);
      }
      callbacks.length = 0;
      contexts.length = 0;
    }
  },

  /**
   * Resets the internal queue.
   *
   * @internal
   */
  reset: function() {
    this._callbacks = null;
    this._contexts = null;
  },

  /**
   * `PooledClass` looks for this.
   */
  destructor: function() {
    this.reset();
  }

});

PooledClass.addPoolingTo(CallbackQueue);

module.exports = CallbackQueue;

},{"./PooledClass":28,"./invariant":134,"./mixInto":147}],7:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ChangeEventPlugin
 */



var EventConstants = _dereq_("./EventConstants");
var EventPluginHub = _dereq_("./EventPluginHub");
var EventPropagators = _dereq_("./EventPropagators");
var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");
var ReactUpdates = _dereq_("./ReactUpdates");
var SyntheticEvent = _dereq_("./SyntheticEvent");

var isEventSupported = _dereq_("./isEventSupported");
var isTextInputElement = _dereq_("./isTextInputElement");
var keyOf = _dereq_("./keyOf");

var topLevelTypes = EventConstants.topLevelTypes;

var eventTypes = {
  change: {
    phasedRegistrationNames: {
      bubbled: keyOf({onChange: null}),
      captured: keyOf({onChangeCapture: null})
    },
    dependencies: [
      topLevelTypes.topBlur,
      topLevelTypes.topChange,
      topLevelTypes.topClick,
      topLevelTypes.topFocus,
      topLevelTypes.topInput,
      topLevelTypes.topKeyDown,
      topLevelTypes.topKeyUp,
      topLevelTypes.topSelectionChange
    ]
  }
};

/**
 * For IE shims
 */
var activeElement = null;
var activeElementID = null;
var activeElementValue = null;
var activeElementValueProp = null;

/**
 * SECTION: handle `change` event
 */
function shouldUseChangeEvent(elem) {
  return (
    elem.nodeName === 'SELECT' ||
    (elem.nodeName === 'INPUT' && elem.type === 'file')
  );
}

var doesChangeEventBubble = false;
if (ExecutionEnvironment.canUseDOM) {
  // See `handleChange` comment below
  doesChangeEventBubble = isEventSupported('change') && (
    !('documentMode' in document) || document.documentMode > 8
  );
}

function manualDispatchChangeEvent(nativeEvent) {
  var event = SyntheticEvent.getPooled(
    eventTypes.change,
    activeElementID,
    nativeEvent
  );
  EventPropagators.accumulateTwoPhaseDispatches(event);

  // If change and propertychange bubbled, we'd just bind to it like all the
  // other events and have it go through ReactBrowserEventEmitter. Since it
  // doesn't, we manually listen for the events and so we have to enqueue and
  // process the abstract event manually.
  //
  // Batching is necessary here in order to ensure that all event handlers run
  // before the next rerender (including event handlers attached to ancestor
  // elements instead of directly on the input). Without this, controlled
  // components don't work properly in conjunction with event bubbling because
  // the component is rerendered and the value reverted before all the event
  // handlers can run. See https://github.com/facebook/react/issues/708.
  ReactUpdates.batchedUpdates(runEventInBatch, event);
}

function runEventInBatch(event) {
  EventPluginHub.enqueueEvents(event);
  EventPluginHub.processEventQueue();
}

function startWatchingForChangeEventIE8(target, targetID) {
  activeElement = target;
  activeElementID = targetID;
  activeElement.attachEvent('onchange', manualDispatchChangeEvent);
}

function stopWatchingForChangeEventIE8() {
  if (!activeElement) {
    return;
  }
  activeElement.detachEvent('onchange', manualDispatchChangeEvent);
  activeElement = null;
  activeElementID = null;
}

function getTargetIDForChangeEvent(
    topLevelType,
    topLevelTarget,
    topLevelTargetID) {
  if (topLevelType === topLevelTypes.topChange) {
    return topLevelTargetID;
  }
}
function handleEventsForChangeEventIE8(
    topLevelType,
    topLevelTarget,
    topLevelTargetID) {
  if (topLevelType === topLevelTypes.topFocus) {
    // stopWatching() should be a noop here but we call it just in case we
    // missed a blur event somehow.
    stopWatchingForChangeEventIE8();
    startWatchingForChangeEventIE8(topLevelTarget, topLevelTargetID);
  } else if (topLevelType === topLevelTypes.topBlur) {
    stopWatchingForChangeEventIE8();
  }
}


/**
 * SECTION: handle `input` event
 */
var isInputEventSupported = false;
if (ExecutionEnvironment.canUseDOM) {
  // IE9 claims to support the input event but fails to trigger it when
  // deleting text, so we ignore its input events
  isInputEventSupported = isEventSupported('input') && (
    !('documentMode' in document) || document.documentMode > 9
  );
}

/**
 * (For old IE.) Replacement getter/setter for the `value` property that gets
 * set on the active element.
 */
var newValueProp =  {
  get: function() {
    return activeElementValueProp.get.call(this);
  },
  set: function(val) {
    // Cast to a string so we can do equality checks.
    activeElementValue = '' + val;
    activeElementValueProp.set.call(this, val);
  }
};

/**
 * (For old IE.) Starts tracking propertychange events on the passed-in element
 * and override the value property so that we can distinguish user events from
 * value changes in JS.
 */
function startWatchingForValueChange(target, targetID) {
  activeElement = target;
  activeElementID = targetID;
  activeElementValue = target.value;
  activeElementValueProp = Object.getOwnPropertyDescriptor(
    target.constructor.prototype,
    'value'
  );

  Object.defineProperty(activeElement, 'value', newValueProp);
  activeElement.attachEvent('onpropertychange', handlePropertyChange);
}

/**
 * (For old IE.) Removes the event listeners from the currently-tracked element,
 * if any exists.
 */
function stopWatchingForValueChange() {
  if (!activeElement) {
    return;
  }

  // delete restores the original property definition
  delete activeElement.value;
  activeElement.detachEvent('onpropertychange', handlePropertyChange);

  activeElement = null;
  activeElementID = null;
  activeElementValue = null;
  activeElementValueProp = null;
}

/**
 * (For old IE.) Handles a propertychange event, sending a `change` event if
 * the value of the active element has changed.
 */
function handlePropertyChange(nativeEvent) {
  if (nativeEvent.propertyName !== 'value') {
    return;
  }
  var value = nativeEvent.srcElement.value;
  if (value === activeElementValue) {
    return;
  }
  activeElementValue = value;

  manualDispatchChangeEvent(nativeEvent);
}

/**
 * If a `change` event should be fired, returns the target's ID.
 */
function getTargetIDForInputEvent(
    topLevelType,
    topLevelTarget,
    topLevelTargetID) {
  if (topLevelType === topLevelTypes.topInput) {
    // In modern browsers (i.e., not IE8 or IE9), the input event is exactly
    // what we want so fall through here and trigger an abstract event
    return topLevelTargetID;
  }
}

// For IE8 and IE9.
function handleEventsForInputEventIE(
    topLevelType,
    topLevelTarget,
    topLevelTargetID) {
  if (topLevelType === topLevelTypes.topFocus) {
    // In IE8, we can capture almost all .value changes by adding a
    // propertychange handler and looking for events with propertyName
    // equal to 'value'
    // In IE9, propertychange fires for most input events but is buggy and
    // doesn't fire when text is deleted, but conveniently, selectionchange
    // appears to fire in all of the remaining cases so we catch those and
    // forward the event if the value has changed
    // In either case, we don't want to call the event handler if the value
    // is changed from JS so we redefine a setter for `.value` that updates
    // our activeElementValue variable, allowing us to ignore those changes
    //
    // stopWatching() should be a noop here but we call it just in case we
    // missed a blur event somehow.
    stopWatchingForValueChange();
    startWatchingForValueChange(topLevelTarget, topLevelTargetID);
  } else if (topLevelType === topLevelTypes.topBlur) {
    stopWatchingForValueChange();
  }
}

// For IE8 and IE9.
function getTargetIDForInputEventIE(
    topLevelType,
    topLevelTarget,
    topLevelTargetID) {
  if (topLevelType === topLevelTypes.topSelectionChange ||
      topLevelType === topLevelTypes.topKeyUp ||
      topLevelType === topLevelTypes.topKeyDown) {
    // On the selectionchange event, the target is just document which isn't
    // helpful for us so just check activeElement instead.
    //
    // 99% of the time, keydown and keyup aren't necessary. IE8 fails to fire
    // propertychange on the first input event after setting `value` from a
    // script and fires only keydown, keypress, keyup. Catching keyup usually
    // gets it and catching keydown lets us fire an event for the first
    // keystroke if user does a key repeat (it'll be a little delayed: right
    // before the second keystroke). Other input methods (e.g., paste) seem to
    // fire selectionchange normally.
    if (activeElement && activeElement.value !== activeElementValue) {
      activeElementValue = activeElement.value;
      return activeElementID;
    }
  }
}


/**
 * SECTION: handle `click` event
 */
function shouldUseClickEvent(elem) {
  // Use the `click` event to detect changes to checkbox and radio inputs.
  // This approach works across all browsers, whereas `change` does not fire
  // until `blur` in IE8.
  return (
    elem.nodeName === 'INPUT' &&
    (elem.type === 'checkbox' || elem.type === 'radio')
  );
}

function getTargetIDForClickEvent(
    topLevelType,
    topLevelTarget,
    topLevelTargetID) {
  if (topLevelType === topLevelTypes.topClick) {
    return topLevelTargetID;
  }
}

/**
 * This plugin creates an `onChange` event that normalizes change events
 * across form elements. This event fires at a time when it's possible to
 * change the element's value without seeing a flicker.
 *
 * Supported elements are:
 * - input (see `isTextInputElement`)
 * - textarea
 * - select
 */
var ChangeEventPlugin = {

  eventTypes: eventTypes,

  /**
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {DOMEventTarget} topLevelTarget The listening component root node.
   * @param {string} topLevelTargetID ID of `topLevelTarget`.
   * @param {object} nativeEvent Native browser event.
   * @return {*} An accumulation of synthetic events.
   * @see {EventPluginHub.extractEvents}
   */
  extractEvents: function(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent) {

    var getTargetIDFunc, handleEventFunc;
    if (shouldUseChangeEvent(topLevelTarget)) {
      if (doesChangeEventBubble) {
        getTargetIDFunc = getTargetIDForChangeEvent;
      } else {
        handleEventFunc = handleEventsForChangeEventIE8;
      }
    } else if (isTextInputElement(topLevelTarget)) {
      if (isInputEventSupported) {
        getTargetIDFunc = getTargetIDForInputEvent;
      } else {
        getTargetIDFunc = getTargetIDForInputEventIE;
        handleEventFunc = handleEventsForInputEventIE;
      }
    } else if (shouldUseClickEvent(topLevelTarget)) {
      getTargetIDFunc = getTargetIDForClickEvent;
    }

    if (getTargetIDFunc) {
      var targetID = getTargetIDFunc(
        topLevelType,
        topLevelTarget,
        topLevelTargetID
      );
      if (targetID) {
        var event = SyntheticEvent.getPooled(
          eventTypes.change,
          targetID,
          nativeEvent
        );
        EventPropagators.accumulateTwoPhaseDispatches(event);
        return event;
      }
    }

    if (handleEventFunc) {
      handleEventFunc(
        topLevelType,
        topLevelTarget,
        topLevelTargetID
      );
    }
  }

};

module.exports = ChangeEventPlugin;

},{"./EventConstants":16,"./EventPluginHub":18,"./EventPropagators":21,"./ExecutionEnvironment":22,"./ReactUpdates":87,"./SyntheticEvent":96,"./isEventSupported":135,"./isTextInputElement":137,"./keyOf":141}],8:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ClientReactRootIndex
 * @typechecks
 */



var nextReactRootIndex = 0;

var ClientReactRootIndex = {
  createReactRootIndex: function() {
    return nextReactRootIndex++;
  }
};

module.exports = ClientReactRootIndex;

},{}],9:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule CompositionEventPlugin
 * @typechecks static-only
 */



var EventConstants = _dereq_("./EventConstants");
var EventPropagators = _dereq_("./EventPropagators");
var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");
var ReactInputSelection = _dereq_("./ReactInputSelection");
var SyntheticCompositionEvent = _dereq_("./SyntheticCompositionEvent");

var getTextContentAccessor = _dereq_("./getTextContentAccessor");
var keyOf = _dereq_("./keyOf");

var END_KEYCODES = [9, 13, 27, 32]; // Tab, Return, Esc, Space
var START_KEYCODE = 229;

var useCompositionEvent = (
  ExecutionEnvironment.canUseDOM &&
  'CompositionEvent' in window
);

// In IE9+, we have access to composition events, but the data supplied
// by the native compositionend event may be incorrect. In Korean, for example,
// the compositionend event contains only one character regardless of
// how many characters have been composed since compositionstart.
// We therefore use the fallback data while still using the native
// events as triggers.
var useFallbackData = (
  !useCompositionEvent ||
  (
    'documentMode' in document &&
    document.documentMode > 8 &&
    document.documentMode <= 11
  )
);

var topLevelTypes = EventConstants.topLevelTypes;
var currentComposition = null;

// Events and their corresponding property names.
var eventTypes = {
  compositionEnd: {
    phasedRegistrationNames: {
      bubbled: keyOf({onCompositionEnd: null}),
      captured: keyOf({onCompositionEndCapture: null})
    },
    dependencies: [
      topLevelTypes.topBlur,
      topLevelTypes.topCompositionEnd,
      topLevelTypes.topKeyDown,
      topLevelTypes.topKeyPress,
      topLevelTypes.topKeyUp,
      topLevelTypes.topMouseDown
    ]
  },
  compositionStart: {
    phasedRegistrationNames: {
      bubbled: keyOf({onCompositionStart: null}),
      captured: keyOf({onCompositionStartCapture: null})
    },
    dependencies: [
      topLevelTypes.topBlur,
      topLevelTypes.topCompositionStart,
      topLevelTypes.topKeyDown,
      topLevelTypes.topKeyPress,
      topLevelTypes.topKeyUp,
      topLevelTypes.topMouseDown
    ]
  },
  compositionUpdate: {
    phasedRegistrationNames: {
      bubbled: keyOf({onCompositionUpdate: null}),
      captured: keyOf({onCompositionUpdateCapture: null})
    },
    dependencies: [
      topLevelTypes.topBlur,
      topLevelTypes.topCompositionUpdate,
      topLevelTypes.topKeyDown,
      topLevelTypes.topKeyPress,
      topLevelTypes.topKeyUp,
      topLevelTypes.topMouseDown
    ]
  }
};

/**
 * Translate native top level events into event types.
 *
 * @param {string} topLevelType
 * @return {object}
 */
function getCompositionEventType(topLevelType) {
  switch (topLevelType) {
    case topLevelTypes.topCompositionStart:
      return eventTypes.compositionStart;
    case topLevelTypes.topCompositionEnd:
      return eventTypes.compositionEnd;
    case topLevelTypes.topCompositionUpdate:
      return eventTypes.compositionUpdate;
  }
}

/**
 * Does our fallback best-guess model think this event signifies that
 * composition has begun?
 *
 * @param {string} topLevelType
 * @param {object} nativeEvent
 * @return {boolean}
 */
function isFallbackStart(topLevelType, nativeEvent) {
  return (
    topLevelType === topLevelTypes.topKeyDown &&
    nativeEvent.keyCode === START_KEYCODE
  );
}

/**
 * Does our fallback mode think that this event is the end of composition?
 *
 * @param {string} topLevelType
 * @param {object} nativeEvent
 * @return {boolean}
 */
function isFallbackEnd(topLevelType, nativeEvent) {
  switch (topLevelType) {
    case topLevelTypes.topKeyUp:
      // Command keys insert or clear IME input.
      return (END_KEYCODES.indexOf(nativeEvent.keyCode) !== -1);
    case topLevelTypes.topKeyDown:
      // Expect IME keyCode on each keydown. If we get any other
      // code we must have exited earlier.
      return (nativeEvent.keyCode !== START_KEYCODE);
    case topLevelTypes.topKeyPress:
    case topLevelTypes.topMouseDown:
    case topLevelTypes.topBlur:
      // Events are not possible without cancelling IME.
      return true;
    default:
      return false;
  }
}

/**
 * Helper class stores information about selection and document state
 * so we can figure out what changed at a later date.
 *
 * @param {DOMEventTarget} root
 */
function FallbackCompositionState(root) {
  this.root = root;
  this.startSelection = ReactInputSelection.getSelection(root);
  this.startValue = this.getText();
}

/**
 * Get current text of input.
 *
 * @return {string}
 */
FallbackCompositionState.prototype.getText = function() {
  return this.root.value || this.root[getTextContentAccessor()];
};

/**
 * Text that has changed since the start of composition.
 *
 * @return {string}
 */
FallbackCompositionState.prototype.getData = function() {
  var endValue = this.getText();
  var prefixLength = this.startSelection.start;
  var suffixLength = this.startValue.length - this.startSelection.end;

  return endValue.substr(
    prefixLength,
    endValue.length - suffixLength - prefixLength
  );
};

/**
 * This plugin creates `onCompositionStart`, `onCompositionUpdate` and
 * `onCompositionEnd` events on inputs, textareas and contentEditable
 * nodes.
 */
var CompositionEventPlugin = {

  eventTypes: eventTypes,

  /**
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {DOMEventTarget} topLevelTarget The listening component root node.
   * @param {string} topLevelTargetID ID of `topLevelTarget`.
   * @param {object} nativeEvent Native browser event.
   * @return {*} An accumulation of synthetic events.
   * @see {EventPluginHub.extractEvents}
   */
  extractEvents: function(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent) {

    var eventType;
    var data;

    if (useCompositionEvent) {
      eventType = getCompositionEventType(topLevelType);
    } else if (!currentComposition) {
      if (isFallbackStart(topLevelType, nativeEvent)) {
        eventType = eventTypes.compositionStart;
      }
    } else if (isFallbackEnd(topLevelType, nativeEvent)) {
      eventType = eventTypes.compositionEnd;
    }

    if (useFallbackData) {
      // The current composition is stored statically and must not be
      // overwritten while composition continues.
      if (!currentComposition && eventType === eventTypes.compositionStart) {
        currentComposition = new FallbackCompositionState(topLevelTarget);
      } else if (eventType === eventTypes.compositionEnd) {
        if (currentComposition) {
          data = currentComposition.getData();
          currentComposition = null;
        }
      }
    }

    if (eventType) {
      var event = SyntheticCompositionEvent.getPooled(
        eventType,
        topLevelTargetID,
        nativeEvent
      );
      if (data) {
        // Inject data generated from fallback path into the synthetic event.
        // This matches the property of native CompositionEventInterface.
        event.data = data;
      }
      EventPropagators.accumulateTwoPhaseDispatches(event);
      return event;
    }
  }
};

module.exports = CompositionEventPlugin;

},{"./EventConstants":16,"./EventPropagators":21,"./ExecutionEnvironment":22,"./ReactInputSelection":63,"./SyntheticCompositionEvent":94,"./getTextContentAccessor":129,"./keyOf":141}],10:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule DOMChildrenOperations
 * @typechecks static-only
 */



var Danger = _dereq_("./Danger");
var ReactMultiChildUpdateTypes = _dereq_("./ReactMultiChildUpdateTypes");

var getTextContentAccessor = _dereq_("./getTextContentAccessor");
var invariant = _dereq_("./invariant");

/**
 * The DOM property to use when setting text content.
 *
 * @type {string}
 * @private
 */
var textContentAccessor = getTextContentAccessor();

/**
 * Inserts `childNode` as a child of `parentNode` at the `index`.
 *
 * @param {DOMElement} parentNode Parent node in which to insert.
 * @param {DOMElement} childNode Child node to insert.
 * @param {number} index Index at which to insert the child.
 * @internal
 */
function insertChildAt(parentNode, childNode, index) {
  // By exploiting arrays returning `undefined` for an undefined index, we can
  // rely exclusively on `insertBefore(node, null)` instead of also using
  // `appendChild(node)`. However, using `undefined` is not allowed by all
  // browsers so we must replace it with `null`.
  parentNode.insertBefore(
    childNode,
    parentNode.childNodes[index] || null
  );
}

var updateTextContent;
if (textContentAccessor === 'textContent') {
  /**
   * Sets the text content of `node` to `text`.
   *
   * @param {DOMElement} node Node to change
   * @param {string} text New text content
   */
  updateTextContent = function(node, text) {
    node.textContent = text;
  };
} else {
  /**
   * Sets the text content of `node` to `text`.
   *
   * @param {DOMElement} node Node to change
   * @param {string} text New text content
   */
  updateTextContent = function(node, text) {
    // In order to preserve newlines correctly, we can't use .innerText to set
    // the contents (see #1080), so we empty the element then append a text node
    while (node.firstChild) {
      node.removeChild(node.firstChild);
    }
    if (text) {
      var doc = node.ownerDocument || document;
      node.appendChild(doc.createTextNode(text));
    }
  };
}

/**
 * Operations for updating with DOM children.
 */
var DOMChildrenOperations = {

  dangerouslyReplaceNodeWithMarkup: Danger.dangerouslyReplaceNodeWithMarkup,

  updateTextContent: updateTextContent,

  /**
   * Updates a component's children by processing a series of updates. The
   * update configurations are each expected to have a `parentNode` property.
   *
   * @param {array<object>} updates List of update configurations.
   * @param {array<string>} markupList List of markup strings.
   * @internal
   */
  processUpdates: function(updates, markupList) {
    var update;
    // Mapping from parent IDs to initial child orderings.
    var initialChildren = null;
    // List of children that will be moved or removed.
    var updatedChildren = null;

    for (var i = 0; update = updates[i]; i++) {
      if (update.type === ReactMultiChildUpdateTypes.MOVE_EXISTING ||
          update.type === ReactMultiChildUpdateTypes.REMOVE_NODE) {
        var updatedIndex = update.fromIndex;
        var updatedChild = update.parentNode.childNodes[updatedIndex];
        var parentID = update.parentID;

        ("production" !== "development" ? invariant(
          updatedChild,
          'processUpdates(): Unable to find child %s of element. This ' +
          'probably means the DOM was unexpectedly mutated (e.g., by the ' +
          'browser), usually due to forgetting a <tbody> when using tables, ' +
          'nesting <p> or <a> tags, or using non-SVG elements in an <svg> '+
          'parent. Try inspecting the child nodes of the element with React ' +
          'ID `%s`.',
          updatedIndex,
          parentID
        ) : invariant(updatedChild));

        initialChildren = initialChildren || {};
        initialChildren[parentID] = initialChildren[parentID] || [];
        initialChildren[parentID][updatedIndex] = updatedChild;

        updatedChildren = updatedChildren || [];
        updatedChildren.push(updatedChild);
      }
    }

    var renderedMarkup = Danger.dangerouslyRenderMarkup(markupList);

    // Remove updated children first so that `toIndex` is consistent.
    if (updatedChildren) {
      for (var j = 0; j < updatedChildren.length; j++) {
        updatedChildren[j].parentNode.removeChild(updatedChildren[j]);
      }
    }

    for (var k = 0; update = updates[k]; k++) {
      switch (update.type) {
        case ReactMultiChildUpdateTypes.INSERT_MARKUP:
          insertChildAt(
            update.parentNode,
            renderedMarkup[update.markupIndex],
            update.toIndex
          );
          break;
        case ReactMultiChildUpdateTypes.MOVE_EXISTING:
          insertChildAt(
            update.parentNode,
            initialChildren[update.parentID][update.fromIndex],
            update.toIndex
          );
          break;
        case ReactMultiChildUpdateTypes.TEXT_CONTENT:
          updateTextContent(
            update.parentNode,
            update.textContent
          );
          break;
        case ReactMultiChildUpdateTypes.REMOVE_NODE:
          // Already removed by the for-loop above.
          break;
      }
    }
  }

};

module.exports = DOMChildrenOperations;

},{"./Danger":13,"./ReactMultiChildUpdateTypes":69,"./getTextContentAccessor":129,"./invariant":134}],11:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule DOMProperty
 * @typechecks static-only
 */

/*jslint bitwise: true */



var invariant = _dereq_("./invariant");

var DOMPropertyInjection = {
  /**
   * Mapping from normalized, camelcased property names to a configuration that
   * specifies how the associated DOM property should be accessed or rendered.
   */
  MUST_USE_ATTRIBUTE: 0x1,
  MUST_USE_PROPERTY: 0x2,
  HAS_SIDE_EFFECTS: 0x4,
  HAS_BOOLEAN_VALUE: 0x8,
  HAS_NUMERIC_VALUE: 0x10,
  HAS_POSITIVE_NUMERIC_VALUE: 0x20 | 0x10,
  HAS_OVERLOADED_BOOLEAN_VALUE: 0x40,

  /**
   * Inject some specialized knowledge about the DOM. This takes a config object
   * with the following properties:
   *
   * isCustomAttribute: function that given an attribute name will return true
   * if it can be inserted into the DOM verbatim. Useful for data-* or aria-*
   * attributes where it's impossible to enumerate all of the possible
   * attribute names,
   *
   * Properties: object mapping DOM property name to one of the
   * DOMPropertyInjection constants or null. If your attribute isn't in here,
   * it won't get written to the DOM.
   *
   * DOMAttributeNames: object mapping React attribute name to the DOM
   * attribute name. Attribute names not specified use the **lowercase**
   * normalized name.
   *
   * DOMPropertyNames: similar to DOMAttributeNames but for DOM properties.
   * Property names not specified use the normalized name.
   *
   * DOMMutationMethods: Properties that require special mutation methods. If
   * `value` is undefined, the mutation method should unset the property.
   *
   * @param {object} domPropertyConfig the config as described above.
   */
  injectDOMPropertyConfig: function(domPropertyConfig) {
    var Properties = domPropertyConfig.Properties || {};
    var DOMAttributeNames = domPropertyConfig.DOMAttributeNames || {};
    var DOMPropertyNames = domPropertyConfig.DOMPropertyNames || {};
    var DOMMutationMethods = domPropertyConfig.DOMMutationMethods || {};

    if (domPropertyConfig.isCustomAttribute) {
      DOMProperty._isCustomAttributeFunctions.push(
        domPropertyConfig.isCustomAttribute
      );
    }

    for (var propName in Properties) {
      ("production" !== "development" ? invariant(
        !DOMProperty.isStandardName.hasOwnProperty(propName),
        'injectDOMPropertyConfig(...): You\'re trying to inject DOM property ' +
        '\'%s\' which has already been injected. You may be accidentally ' +
        'injecting the same DOM property config twice, or you may be ' +
        'injecting two configs that have conflicting property names.',
        propName
      ) : invariant(!DOMProperty.isStandardName.hasOwnProperty(propName)));

      DOMProperty.isStandardName[propName] = true;

      var lowerCased = propName.toLowerCase();
      DOMProperty.getPossibleStandardName[lowerCased] = propName;

      if (DOMAttributeNames.hasOwnProperty(propName)) {
        var attributeName = DOMAttributeNames[propName];
        DOMProperty.getPossibleStandardName[attributeName] = propName;
        DOMProperty.getAttributeName[propName] = attributeName;
      } else {
        DOMProperty.getAttributeName[propName] = lowerCased;
      }

      DOMProperty.getPropertyName[propName] =
        DOMPropertyNames.hasOwnProperty(propName) ?
          DOMPropertyNames[propName] :
          propName;

      if (DOMMutationMethods.hasOwnProperty(propName)) {
        DOMProperty.getMutationMethod[propName] = DOMMutationMethods[propName];
      } else {
        DOMProperty.getMutationMethod[propName] = null;
      }

      var propConfig = Properties[propName];
      DOMProperty.mustUseAttribute[propName] =
        propConfig & DOMPropertyInjection.MUST_USE_ATTRIBUTE;
      DOMProperty.mustUseProperty[propName] =
        propConfig & DOMPropertyInjection.MUST_USE_PROPERTY;
      DOMProperty.hasSideEffects[propName] =
        propConfig & DOMPropertyInjection.HAS_SIDE_EFFECTS;
      DOMProperty.hasBooleanValue[propName] =
        propConfig & DOMPropertyInjection.HAS_BOOLEAN_VALUE;
      DOMProperty.hasNumericValue[propName] =
        propConfig & DOMPropertyInjection.HAS_NUMERIC_VALUE;
      DOMProperty.hasPositiveNumericValue[propName] =
        propConfig & DOMPropertyInjection.HAS_POSITIVE_NUMERIC_VALUE;
      DOMProperty.hasOverloadedBooleanValue[propName] =
        propConfig & DOMPropertyInjection.HAS_OVERLOADED_BOOLEAN_VALUE;

      ("production" !== "development" ? invariant(
        !DOMProperty.mustUseAttribute[propName] ||
          !DOMProperty.mustUseProperty[propName],
        'DOMProperty: Cannot require using both attribute and property: %s',
        propName
      ) : invariant(!DOMProperty.mustUseAttribute[propName] ||
        !DOMProperty.mustUseProperty[propName]));
      ("production" !== "development" ? invariant(
        DOMProperty.mustUseProperty[propName] ||
          !DOMProperty.hasSideEffects[propName],
        'DOMProperty: Properties that have side effects must use property: %s',
        propName
      ) : invariant(DOMProperty.mustUseProperty[propName] ||
        !DOMProperty.hasSideEffects[propName]));
      ("production" !== "development" ? invariant(
        !!DOMProperty.hasBooleanValue[propName] +
          !!DOMProperty.hasNumericValue[propName] +
          !!DOMProperty.hasOverloadedBooleanValue[propName] <= 1,
        'DOMProperty: Value can be one of boolean, overloaded boolean, or ' +
        'numeric value, but not a combination: %s',
        propName
      ) : invariant(!!DOMProperty.hasBooleanValue[propName] +
        !!DOMProperty.hasNumericValue[propName] +
        !!DOMProperty.hasOverloadedBooleanValue[propName] <= 1));
    }
  }
};
var defaultValueCache = {};

/**
 * DOMProperty exports lookup objects that can be used like functions:
 *
 *   > DOMProperty.isValid['id']
 *   true
 *   > DOMProperty.isValid['foobar']
 *   undefined
 *
 * Although this may be confusing, it performs better in general.
 *
 * @see http://jsperf.com/key-exists
 * @see http://jsperf.com/key-missing
 */
var DOMProperty = {

  ID_ATTRIBUTE_NAME: 'data-reactid',

  /**
   * Checks whether a property name is a standard property.
   * @type {Object}
   */
  isStandardName: {},

  /**
   * Mapping from lowercase property names to the properly cased version, used
   * to warn in the case of missing properties.
   * @type {Object}
   */
  getPossibleStandardName: {},

  /**
   * Mapping from normalized names to attribute names that differ. Attribute
   * names are used when rendering markup or with `*Attribute()`.
   * @type {Object}
   */
  getAttributeName: {},

  /**
   * Mapping from normalized names to properties on DOM node instances.
   * (This includes properties that mutate due to external factors.)
   * @type {Object}
   */
  getPropertyName: {},

  /**
   * Mapping from normalized names to mutation methods. This will only exist if
   * mutation cannot be set simply by the property or `setAttribute()`.
   * @type {Object}
   */
  getMutationMethod: {},

  /**
   * Whether the property must be accessed and mutated as an object property.
   * @type {Object}
   */
  mustUseAttribute: {},

  /**
   * Whether the property must be accessed and mutated using `*Attribute()`.
   * (This includes anything that fails `<propName> in <element>`.)
   * @type {Object}
   */
  mustUseProperty: {},

  /**
   * Whether or not setting a value causes side effects such as triggering
   * resources to be loaded or text selection changes. We must ensure that
   * the value is only set if it has changed.
   * @type {Object}
   */
  hasSideEffects: {},

  /**
   * Whether the property should be removed when set to a falsey value.
   * @type {Object}
   */
  hasBooleanValue: {},

  /**
   * Whether the property must be numeric or parse as a
   * numeric and should be removed when set to a falsey value.
   * @type {Object}
   */
  hasNumericValue: {},

  /**
   * Whether the property must be positive numeric or parse as a positive
   * numeric and should be removed when set to a falsey value.
   * @type {Object}
   */
  hasPositiveNumericValue: {},

  /**
   * Whether the property can be used as a flag as well as with a value. Removed
   * when strictly equal to false; present without a value when strictly equal
   * to true; present with a value otherwise.
   * @type {Object}
   */
  hasOverloadedBooleanValue: {},

  /**
   * All of the isCustomAttribute() functions that have been injected.
   */
  _isCustomAttributeFunctions: [],

  /**
   * Checks whether a property name is a custom attribute.
   * @method
   */
  isCustomAttribute: function(attributeName) {
    for (var i = 0; i < DOMProperty._isCustomAttributeFunctions.length; i++) {
      var isCustomAttributeFn = DOMProperty._isCustomAttributeFunctions[i];
      if (isCustomAttributeFn(attributeName)) {
        return true;
      }
    }
    return false;
  },

  /**
   * Returns the default property value for a DOM property (i.e., not an
   * attribute). Most default values are '' or false, but not all. Worse yet,
   * some (in particular, `type`) vary depending on the type of element.
   *
   * TODO: Is it better to grab all the possible properties when creating an
   * element to avoid having to create the same element twice?
   */
  getDefaultValueForProperty: function(nodeName, prop) {
    var nodeDefaults = defaultValueCache[nodeName];
    var testElement;
    if (!nodeDefaults) {
      defaultValueCache[nodeName] = nodeDefaults = {};
    }
    if (!(prop in nodeDefaults)) {
      testElement = document.createElement(nodeName);
      nodeDefaults[prop] = testElement[prop];
    }
    return nodeDefaults[prop];
  },

  injection: DOMPropertyInjection
};

module.exports = DOMProperty;

},{"./invariant":134}],12:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule DOMPropertyOperations
 * @typechecks static-only
 */



var DOMProperty = _dereq_("./DOMProperty");

var escapeTextForBrowser = _dereq_("./escapeTextForBrowser");
var memoizeStringOnly = _dereq_("./memoizeStringOnly");
var warning = _dereq_("./warning");

function shouldIgnoreValue(name, value) {
  return value == null ||
    (DOMProperty.hasBooleanValue[name] && !value) ||
    (DOMProperty.hasNumericValue[name] && isNaN(value)) ||
    (DOMProperty.hasPositiveNumericValue[name] && (value < 1)) ||
    (DOMProperty.hasOverloadedBooleanValue[name] && value === false);
}

var processAttributeNameAndPrefix = memoizeStringOnly(function(name) {
  return escapeTextForBrowser(name) + '="';
});

if ("production" !== "development") {
  var reactProps = {
    children: true,
    dangerouslySetInnerHTML: true,
    key: true,
    ref: true
  };
  var warnedProperties = {};

  var warnUnknownProperty = function(name) {
    if (reactProps.hasOwnProperty(name) && reactProps[name] ||
        warnedProperties.hasOwnProperty(name) && warnedProperties[name]) {
      return;
    }

    warnedProperties[name] = true;
    var lowerCasedName = name.toLowerCase();

    // data-* attributes should be lowercase; suggest the lowercase version
    var standardName = (
      DOMProperty.isCustomAttribute(lowerCasedName) ?
        lowerCasedName :
      DOMProperty.getPossibleStandardName.hasOwnProperty(lowerCasedName) ?
        DOMProperty.getPossibleStandardName[lowerCasedName] :
        null
    );

    // For now, only warn when we have a suggested correction. This prevents
    // logging too much when using transferPropsTo.
    ("production" !== "development" ? warning(
      standardName == null,
      'Unknown DOM property ' + name + '. Did you mean ' + standardName + '?'
    ) : null);

  };
}

/**
 * Operations for dealing with DOM properties.
 */
var DOMPropertyOperations = {

  /**
   * Creates markup for the ID property.
   *
   * @param {string} id Unescaped ID.
   * @return {string} Markup string.
   */
  createMarkupForID: function(id) {
    return processAttributeNameAndPrefix(DOMProperty.ID_ATTRIBUTE_NAME) +
      escapeTextForBrowser(id) + '"';
  },

  /**
   * Creates markup for a property.
   *
   * @param {string} name
   * @param {*} value
   * @return {?string} Markup string, or null if the property was invalid.
   */
  createMarkupForProperty: function(name, value) {
    if (DOMProperty.isStandardName.hasOwnProperty(name) &&
        DOMProperty.isStandardName[name]) {
      if (shouldIgnoreValue(name, value)) {
        return '';
      }
      var attributeName = DOMProperty.getAttributeName[name];
      if (DOMProperty.hasBooleanValue[name] ||
          (DOMProperty.hasOverloadedBooleanValue[name] && value === true)) {
        return escapeTextForBrowser(attributeName);
      }
      return processAttributeNameAndPrefix(attributeName) +
        escapeTextForBrowser(value) + '"';
    } else if (DOMProperty.isCustomAttribute(name)) {
      if (value == null) {
        return '';
      }
      return processAttributeNameAndPrefix(name) +
        escapeTextForBrowser(value) + '"';
    } else if ("production" !== "development") {
      warnUnknownProperty(name);
    }
    return null;
  },

  /**
   * Sets the value for a property on a node.
   *
   * @param {DOMElement} node
   * @param {string} name
   * @param {*} value
   */
  setValueForProperty: function(node, name, value) {
    if (DOMProperty.isStandardName.hasOwnProperty(name) &&
        DOMProperty.isStandardName[name]) {
      var mutationMethod = DOMProperty.getMutationMethod[name];
      if (mutationMethod) {
        mutationMethod(node, value);
      } else if (shouldIgnoreValue(name, value)) {
        this.deleteValueForProperty(node, name);
      } else if (DOMProperty.mustUseAttribute[name]) {
        node.setAttribute(DOMProperty.getAttributeName[name], '' + value);
      } else {
        var propName = DOMProperty.getPropertyName[name];
        if (!DOMProperty.hasSideEffects[name] || node[propName] !== value) {
          node[propName] = value;
        }
      }
    } else if (DOMProperty.isCustomAttribute(name)) {
      if (value == null) {
        node.removeAttribute(name);
      } else {
        node.setAttribute(name, '' + value);
      }
    } else if ("production" !== "development") {
      warnUnknownProperty(name);
    }
  },

  /**
   * Deletes the value for a property on a node.
   *
   * @param {DOMElement} node
   * @param {string} name
   */
  deleteValueForProperty: function(node, name) {
    if (DOMProperty.isStandardName.hasOwnProperty(name) &&
        DOMProperty.isStandardName[name]) {
      var mutationMethod = DOMProperty.getMutationMethod[name];
      if (mutationMethod) {
        mutationMethod(node, undefined);
      } else if (DOMProperty.mustUseAttribute[name]) {
        node.removeAttribute(DOMProperty.getAttributeName[name]);
      } else {
        var propName = DOMProperty.getPropertyName[name];
        var defaultValue = DOMProperty.getDefaultValueForProperty(
          node.nodeName,
          propName
        );
        if (!DOMProperty.hasSideEffects[name] ||
            node[propName] !== defaultValue) {
          node[propName] = defaultValue;
        }
      }
    } else if (DOMProperty.isCustomAttribute(name)) {
      node.removeAttribute(name);
    } else if ("production" !== "development") {
      warnUnknownProperty(name);
    }
  }

};

module.exports = DOMPropertyOperations;

},{"./DOMProperty":11,"./escapeTextForBrowser":118,"./memoizeStringOnly":143,"./warning":158}],13:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule Danger
 * @typechecks static-only
 */

/*jslint evil: true, sub: true */



var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

var createNodesFromMarkup = _dereq_("./createNodesFromMarkup");
var emptyFunction = _dereq_("./emptyFunction");
var getMarkupWrap = _dereq_("./getMarkupWrap");
var invariant = _dereq_("./invariant");

var OPEN_TAG_NAME_EXP = /^(<[^ \/>]+)/;
var RESULT_INDEX_ATTR = 'data-danger-index';

/**
 * Extracts the `nodeName` from a string of markup.
 *
 * NOTE: Extracting the `nodeName` does not require a regular expression match
 * because we make assumptions about React-generated markup (i.e. there are no
 * spaces surrounding the opening tag and there is at least one attribute).
 *
 * @param {string} markup String of markup.
 * @return {string} Node name of the supplied markup.
 * @see http://jsperf.com/extract-nodename
 */
function getNodeName(markup) {
  return markup.substring(1, markup.indexOf(' '));
}

var Danger = {

  /**
   * Renders markup into an array of nodes. The markup is expected to render
   * into a list of root nodes. Also, the length of `resultList` and
   * `markupList` should be the same.
   *
   * @param {array<string>} markupList List of markup strings to render.
   * @return {array<DOMElement>} List of rendered nodes.
   * @internal
   */
  dangerouslyRenderMarkup: function(markupList) {
    ("production" !== "development" ? invariant(
      ExecutionEnvironment.canUseDOM,
      'dangerouslyRenderMarkup(...): Cannot render markup in a Worker ' +
      'thread. This is likely a bug in the framework. Please report ' +
      'immediately.'
    ) : invariant(ExecutionEnvironment.canUseDOM));
    var nodeName;
    var markupByNodeName = {};
    // Group markup by `nodeName` if a wrap is necessary, else by '*'.
    for (var i = 0; i < markupList.length; i++) {
      ("production" !== "development" ? invariant(
        markupList[i],
        'dangerouslyRenderMarkup(...): Missing markup.'
      ) : invariant(markupList[i]));
      nodeName = getNodeName(markupList[i]);
      nodeName = getMarkupWrap(nodeName) ? nodeName : '*';
      markupByNodeName[nodeName] = markupByNodeName[nodeName] || [];
      markupByNodeName[nodeName][i] = markupList[i];
    }
    var resultList = [];
    var resultListAssignmentCount = 0;
    for (nodeName in markupByNodeName) {
      if (!markupByNodeName.hasOwnProperty(nodeName)) {
        continue;
      }
      var markupListByNodeName = markupByNodeName[nodeName];

      // This for-in loop skips the holes of the sparse array. The order of
      // iteration should follow the order of assignment, which happens to match
      // numerical index order, but we don't rely on that.
      for (var resultIndex in markupListByNodeName) {
        if (markupListByNodeName.hasOwnProperty(resultIndex)) {
          var markup = markupListByNodeName[resultIndex];

          // Push the requested markup with an additional RESULT_INDEX_ATTR
          // attribute.  If the markup does not start with a < character, it
          // will be discarded below (with an appropriate console.error).
          markupListByNodeName[resultIndex] = markup.replace(
            OPEN_TAG_NAME_EXP,
            // This index will be parsed back out below.
            '$1 ' + RESULT_INDEX_ATTR + '="' + resultIndex + '" '
          );
        }
      }

      // Render each group of markup with similar wrapping `nodeName`.
      var renderNodes = createNodesFromMarkup(
        markupListByNodeName.join(''),
        emptyFunction // Do nothing special with <script> tags.
      );

      for (i = 0; i < renderNodes.length; ++i) {
        var renderNode = renderNodes[i];
        if (renderNode.hasAttribute &&
            renderNode.hasAttribute(RESULT_INDEX_ATTR)) {

          resultIndex = +renderNode.getAttribute(RESULT_INDEX_ATTR);
          renderNode.removeAttribute(RESULT_INDEX_ATTR);

          ("production" !== "development" ? invariant(
            !resultList.hasOwnProperty(resultIndex),
            'Danger: Assigning to an already-occupied result index.'
          ) : invariant(!resultList.hasOwnProperty(resultIndex)));

          resultList[resultIndex] = renderNode;

          // This should match resultList.length and markupList.length when
          // we're done.
          resultListAssignmentCount += 1;

        } else if ("production" !== "development") {
          console.error(
            "Danger: Discarding unexpected node:",
            renderNode
          );
        }
      }
    }

    // Although resultList was populated out of order, it should now be a dense
    // array.
    ("production" !== "development" ? invariant(
      resultListAssignmentCount === resultList.length,
      'Danger: Did not assign to every index of resultList.'
    ) : invariant(resultListAssignmentCount === resultList.length));

    ("production" !== "development" ? invariant(
      resultList.length === markupList.length,
      'Danger: Expected markup to render %s nodes, but rendered %s.',
      markupList.length,
      resultList.length
    ) : invariant(resultList.length === markupList.length));

    return resultList;
  },

  /**
   * Replaces a node with a string of markup at its current position within its
   * parent. The markup must render into a single root node.
   *
   * @param {DOMElement} oldChild Child node to replace.
   * @param {string} markup Markup to render in place of the child node.
   * @internal
   */
  dangerouslyReplaceNodeWithMarkup: function(oldChild, markup) {
    ("production" !== "development" ? invariant(
      ExecutionEnvironment.canUseDOM,
      'dangerouslyReplaceNodeWithMarkup(...): Cannot render markup in a ' +
      'worker thread. This is likely a bug in the framework. Please report ' +
      'immediately.'
    ) : invariant(ExecutionEnvironment.canUseDOM));
    ("production" !== "development" ? invariant(markup, 'dangerouslyReplaceNodeWithMarkup(...): Missing markup.') : invariant(markup));
    ("production" !== "development" ? invariant(
      oldChild.tagName.toLowerCase() !== 'html',
      'dangerouslyReplaceNodeWithMarkup(...): Cannot replace markup of the ' +
      '<html> node. This is because browser quirks make this unreliable ' +
      'and/or slow. If you want to render to the root you must use ' +
      'server rendering. See renderComponentToString().'
    ) : invariant(oldChild.tagName.toLowerCase() !== 'html'));

    var newChild = createNodesFromMarkup(markup, emptyFunction)[0];
    oldChild.parentNode.replaceChild(newChild, oldChild);
  }

};

module.exports = Danger;

},{"./ExecutionEnvironment":22,"./createNodesFromMarkup":113,"./emptyFunction":116,"./getMarkupWrap":126,"./invariant":134}],14:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule DefaultEventPluginOrder
 */



 var keyOf = _dereq_("./keyOf");

/**
 * Module that is injectable into `EventPluginHub`, that specifies a
 * deterministic ordering of `EventPlugin`s. A convenient way to reason about
 * plugins, without having to package every one of them. This is better than
 * having plugins be ordered in the same order that they are injected because
 * that ordering would be influenced by the packaging order.
 * `ResponderEventPlugin` must occur before `SimpleEventPlugin` so that
 * preventing default on events is convenient in `SimpleEventPlugin` handlers.
 */
var DefaultEventPluginOrder = [
  keyOf({ResponderEventPlugin: null}),
  keyOf({SimpleEventPlugin: null}),
  keyOf({TapEventPlugin: null}),
  keyOf({EnterLeaveEventPlugin: null}),
  keyOf({ChangeEventPlugin: null}),
  keyOf({SelectEventPlugin: null}),
  keyOf({CompositionEventPlugin: null}),
  keyOf({BeforeInputEventPlugin: null}),
  keyOf({AnalyticsEventPlugin: null}),
  keyOf({MobileSafariClickEventPlugin: null})
];

module.exports = DefaultEventPluginOrder;

},{"./keyOf":141}],15:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule EnterLeaveEventPlugin
 * @typechecks static-only
 */



var EventConstants = _dereq_("./EventConstants");
var EventPropagators = _dereq_("./EventPropagators");
var SyntheticMouseEvent = _dereq_("./SyntheticMouseEvent");

var ReactMount = _dereq_("./ReactMount");
var keyOf = _dereq_("./keyOf");

var topLevelTypes = EventConstants.topLevelTypes;
var getFirstReactDOM = ReactMount.getFirstReactDOM;

var eventTypes = {
  mouseEnter: {
    registrationName: keyOf({onMouseEnter: null}),
    dependencies: [
      topLevelTypes.topMouseOut,
      topLevelTypes.topMouseOver
    ]
  },
  mouseLeave: {
    registrationName: keyOf({onMouseLeave: null}),
    dependencies: [
      topLevelTypes.topMouseOut,
      topLevelTypes.topMouseOver
    ]
  }
};

var extractedEvents = [null, null];

var EnterLeaveEventPlugin = {

  eventTypes: eventTypes,

  /**
   * For almost every interaction we care about, there will be both a top-level
   * `mouseover` and `mouseout` event that occurs. Only use `mouseout` so that
   * we do not extract duplicate events. However, moving the mouse into the
   * browser from outside will not fire a `mouseout` event. In this case, we use
   * the `mouseover` top-level event.
   *
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {DOMEventTarget} topLevelTarget The listening component root node.
   * @param {string} topLevelTargetID ID of `topLevelTarget`.
   * @param {object} nativeEvent Native browser event.
   * @return {*} An accumulation of synthetic events.
   * @see {EventPluginHub.extractEvents}
   */
  extractEvents: function(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent) {
    if (topLevelType === topLevelTypes.topMouseOver &&
        (nativeEvent.relatedTarget || nativeEvent.fromElement)) {
      return null;
    }
    if (topLevelType !== topLevelTypes.topMouseOut &&
        topLevelType !== topLevelTypes.topMouseOver) {
      // Must not be a mouse in or mouse out - ignoring.
      return null;
    }

    var win;
    if (topLevelTarget.window === topLevelTarget) {
      // `topLevelTarget` is probably a window object.
      win = topLevelTarget;
    } else {
      // TODO: Figure out why `ownerDocument` is sometimes undefined in IE8.
      var doc = topLevelTarget.ownerDocument;
      if (doc) {
        win = doc.defaultView || doc.parentWindow;
      } else {
        win = window;
      }
    }

    var from, to;
    if (topLevelType === topLevelTypes.topMouseOut) {
      from = topLevelTarget;
      to =
        getFirstReactDOM(nativeEvent.relatedTarget || nativeEvent.toElement) ||
        win;
    } else {
      from = win;
      to = topLevelTarget;
    }

    if (from === to) {
      // Nothing pertains to our managed components.
      return null;
    }

    var fromID = from ? ReactMount.getID(from) : '';
    var toID = to ? ReactMount.getID(to) : '';

    var leave = SyntheticMouseEvent.getPooled(
      eventTypes.mouseLeave,
      fromID,
      nativeEvent
    );
    leave.type = 'mouseleave';
    leave.target = from;
    leave.relatedTarget = to;

    var enter = SyntheticMouseEvent.getPooled(
      eventTypes.mouseEnter,
      toID,
      nativeEvent
    );
    enter.type = 'mouseenter';
    enter.target = to;
    enter.relatedTarget = from;

    EventPropagators.accumulateEnterLeaveDispatches(leave, enter, fromID, toID);

    extractedEvents[0] = leave;
    extractedEvents[1] = enter;

    return extractedEvents;
  }

};

module.exports = EnterLeaveEventPlugin;

},{"./EventConstants":16,"./EventPropagators":21,"./ReactMount":67,"./SyntheticMouseEvent":100,"./keyOf":141}],16:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule EventConstants
 */



var keyMirror = _dereq_("./keyMirror");

var PropagationPhases = keyMirror({bubbled: null, captured: null});

/**
 * Types of raw signals from the browser caught at the top level.
 */
var topLevelTypes = keyMirror({
  topBlur: null,
  topChange: null,
  topClick: null,
  topCompositionEnd: null,
  topCompositionStart: null,
  topCompositionUpdate: null,
  topContextMenu: null,
  topCopy: null,
  topCut: null,
  topDoubleClick: null,
  topDrag: null,
  topDragEnd: null,
  topDragEnter: null,
  topDragExit: null,
  topDragLeave: null,
  topDragOver: null,
  topDragStart: null,
  topDrop: null,
  topError: null,
  topFocus: null,
  topInput: null,
  topKeyDown: null,
  topKeyPress: null,
  topKeyUp: null,
  topLoad: null,
  topMouseDown: null,
  topMouseMove: null,
  topMouseOut: null,
  topMouseOver: null,
  topMouseUp: null,
  topPaste: null,
  topReset: null,
  topScroll: null,
  topSelectionChange: null,
  topSubmit: null,
  topTextInput: null,
  topTouchCancel: null,
  topTouchEnd: null,
  topTouchMove: null,
  topTouchStart: null,
  topWheel: null
});

var EventConstants = {
  topLevelTypes: topLevelTypes,
  PropagationPhases: PropagationPhases
};

module.exports = EventConstants;

},{"./keyMirror":140}],17:[function(_dereq_,module,exports){
/**
 * @providesModule EventListener
 * @typechecks
 */

var emptyFunction = _dereq_("./emptyFunction");

/**
 * Upstream version of event listener. Does not take into account specific
 * nature of platform.
 */
var EventListener = {
  /**
   * Listen to DOM events during the bubble phase.
   *
   * @param {DOMEventTarget} target DOM element to register listener on.
   * @param {string} eventType Event type, e.g. 'click' or 'mouseover'.
   * @param {function} callback Callback function.
   * @return {object} Object with a `remove` method.
   */
  listen: function(target, eventType, callback) {
    if (target.addEventListener) {
      target.addEventListener(eventType, callback, false);
      return {
        remove: function() {
          target.removeEventListener(eventType, callback, false);
        }
      };
    } else if (target.attachEvent) {
      target.attachEvent('on' + eventType, callback);
      return {
        remove: function() {
          target.detachEvent('on' + eventType, callback);
        }
      };
    }
  },

  /**
   * Listen to DOM events during the capture phase.
   *
   * @param {DOMEventTarget} target DOM element to register listener on.
   * @param {string} eventType Event type, e.g. 'click' or 'mouseover'.
   * @param {function} callback Callback function.
   * @return {object} Object with a `remove` method.
   */
  capture: function(target, eventType, callback) {
    if (!target.addEventListener) {
      if ("production" !== "development") {
        console.error(
          'Attempted to listen to events during the capture phase on a ' +
          'browser that does not support the capture phase. Your application ' +
          'will not receive some events.'
        );
      }
      return {
        remove: emptyFunction
      };
    } else {
      target.addEventListener(eventType, callback, true);
      return {
        remove: function() {
          target.removeEventListener(eventType, callback, true);
        }
      };
    }
  },

  registerDefault: function() {}
};

module.exports = EventListener;

},{"./emptyFunction":116}],18:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule EventPluginHub
 */



var EventPluginRegistry = _dereq_("./EventPluginRegistry");
var EventPluginUtils = _dereq_("./EventPluginUtils");

var accumulate = _dereq_("./accumulate");
var forEachAccumulated = _dereq_("./forEachAccumulated");
var invariant = _dereq_("./invariant");
var isEventSupported = _dereq_("./isEventSupported");
var monitorCodeUse = _dereq_("./monitorCodeUse");

/**
 * Internal store for event listeners
 */
var listenerBank = {};

/**
 * Internal queue of events that have accumulated their dispatches and are
 * waiting to have their dispatches executed.
 */
var eventQueue = null;

/**
 * Dispatches an event and releases it back into the pool, unless persistent.
 *
 * @param {?object} event Synthetic event to be dispatched.
 * @private
 */
var executeDispatchesAndRelease = function(event) {
  if (event) {
    var executeDispatch = EventPluginUtils.executeDispatch;
    // Plugins can provide custom behavior when dispatching events.
    var PluginModule = EventPluginRegistry.getPluginModuleForEvent(event);
    if (PluginModule && PluginModule.executeDispatch) {
      executeDispatch = PluginModule.executeDispatch;
    }
    EventPluginUtils.executeDispatchesInOrder(event, executeDispatch);

    if (!event.isPersistent()) {
      event.constructor.release(event);
    }
  }
};

/**
 * - `InstanceHandle`: [required] Module that performs logical traversals of DOM
 *   hierarchy given ids of the logical DOM elements involved.
 */
var InstanceHandle = null;

function validateInstanceHandle() {
  var invalid = !InstanceHandle||
    !InstanceHandle.traverseTwoPhase ||
    !InstanceHandle.traverseEnterLeave;
  if (invalid) {
    throw new Error('InstanceHandle not injected before use!');
  }
}

/**
 * This is a unified interface for event plugins to be installed and configured.
 *
 * Event plugins can implement the following properties:
 *
 *   `extractEvents` {function(string, DOMEventTarget, string, object): *}
 *     Required. When a top-level event is fired, this method is expected to
 *     extract synthetic events that will in turn be queued and dispatched.
 *
 *   `eventTypes` {object}
 *     Optional, plugins that fire events must publish a mapping of registration
 *     names that are used to register listeners. Values of this mapping must
 *     be objects that contain `registrationName` or `phasedRegistrationNames`.
 *
 *   `executeDispatch` {function(object, function, string)}
 *     Optional, allows plugins to override how an event gets dispatched. By
 *     default, the listener is simply invoked.
 *
 * Each plugin that is injected into `EventsPluginHub` is immediately operable.
 *
 * @public
 */
var EventPluginHub = {

  /**
   * Methods for injecting dependencies.
   */
  injection: {

    /**
     * @param {object} InjectedMount
     * @public
     */
    injectMount: EventPluginUtils.injection.injectMount,

    /**
     * @param {object} InjectedInstanceHandle
     * @public
     */
    injectInstanceHandle: function(InjectedInstanceHandle) {
      InstanceHandle = InjectedInstanceHandle;
      if ("production" !== "development") {
        validateInstanceHandle();
      }
    },

    getInstanceHandle: function() {
      if ("production" !== "development") {
        validateInstanceHandle();
      }
      return InstanceHandle;
    },

    /**
     * @param {array} InjectedEventPluginOrder
     * @public
     */
    injectEventPluginOrder: EventPluginRegistry.injectEventPluginOrder,

    /**
     * @param {object} injectedNamesToPlugins Map from names to plugin modules.
     */
    injectEventPluginsByName: EventPluginRegistry.injectEventPluginsByName

  },

  eventNameDispatchConfigs: EventPluginRegistry.eventNameDispatchConfigs,

  registrationNameModules: EventPluginRegistry.registrationNameModules,

  /**
   * Stores `listener` at `listenerBank[registrationName][id]`. Is idempotent.
   *
   * @param {string} id ID of the DOM element.
   * @param {string} registrationName Name of listener (e.g. `onClick`).
   * @param {?function} listener The callback to store.
   */
  putListener: function(id, registrationName, listener) {
    ("production" !== "development" ? invariant(
      !listener || typeof listener === 'function',
      'Expected %s listener to be a function, instead got type %s',
      registrationName, typeof listener
    ) : invariant(!listener || typeof listener === 'function'));

    if ("production" !== "development") {
      // IE8 has no API for event capturing and the `onScroll` event doesn't
      // bubble.
      if (registrationName === 'onScroll' &&
          !isEventSupported('scroll', true)) {
        monitorCodeUse('react_no_scroll_event');
        console.warn('This browser doesn\'t support the `onScroll` event');
      }
    }
    var bankForRegistrationName =
      listenerBank[registrationName] || (listenerBank[registrationName] = {});
    bankForRegistrationName[id] = listener;
  },

  /**
   * @param {string} id ID of the DOM element.
   * @param {string} registrationName Name of listener (e.g. `onClick`).
   * @return {?function} The stored callback.
   */
  getListener: function(id, registrationName) {
    var bankForRegistrationName = listenerBank[registrationName];
    return bankForRegistrationName && bankForRegistrationName[id];
  },

  /**
   * Deletes a listener from the registration bank.
   *
   * @param {string} id ID of the DOM element.
   * @param {string} registrationName Name of listener (e.g. `onClick`).
   */
  deleteListener: function(id, registrationName) {
    var bankForRegistrationName = listenerBank[registrationName];
    if (bankForRegistrationName) {
      delete bankForRegistrationName[id];
    }
  },

  /**
   * Deletes all listeners for the DOM element with the supplied ID.
   *
   * @param {string} id ID of the DOM element.
   */
  deleteAllListeners: function(id) {
    for (var registrationName in listenerBank) {
      delete listenerBank[registrationName][id];
    }
  },

  /**
   * Allows registered plugins an opportunity to extract events from top-level
   * native browser events.
   *
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {DOMEventTarget} topLevelTarget The listening component root node.
   * @param {string} topLevelTargetID ID of `topLevelTarget`.
   * @param {object} nativeEvent Native browser event.
   * @return {*} An accumulation of synthetic events.
   * @internal
   */
  extractEvents: function(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent) {
    var events;
    var plugins = EventPluginRegistry.plugins;
    for (var i = 0, l = plugins.length; i < l; i++) {
      // Not every plugin in the ordering may be loaded at runtime.
      var possiblePlugin = plugins[i];
      if (possiblePlugin) {
        var extractedEvents = possiblePlugin.extractEvents(
          topLevelType,
          topLevelTarget,
          topLevelTargetID,
          nativeEvent
        );
        if (extractedEvents) {
          events = accumulate(events, extractedEvents);
        }
      }
    }
    return events;
  },

  /**
   * Enqueues a synthetic event that should be dispatched when
   * `processEventQueue` is invoked.
   *
   * @param {*} events An accumulation of synthetic events.
   * @internal
   */
  enqueueEvents: function(events) {
    if (events) {
      eventQueue = accumulate(eventQueue, events);
    }
  },

  /**
   * Dispatches all synthetic events on the event queue.
   *
   * @internal
   */
  processEventQueue: function() {
    // Set `eventQueue` to null before processing it so that we can tell if more
    // events get enqueued while processing.
    var processingEventQueue = eventQueue;
    eventQueue = null;
    forEachAccumulated(processingEventQueue, executeDispatchesAndRelease);
    ("production" !== "development" ? invariant(
      !eventQueue,
      'processEventQueue(): Additional events were enqueued while processing ' +
      'an event queue. Support for this has not yet been implemented.'
    ) : invariant(!eventQueue));
  },

  /**
   * These are needed for tests only. Do not use!
   */
  __purge: function() {
    listenerBank = {};
  },

  __getListenerBank: function() {
    return listenerBank;
  }

};

module.exports = EventPluginHub;

},{"./EventPluginRegistry":19,"./EventPluginUtils":20,"./accumulate":106,"./forEachAccumulated":121,"./invariant":134,"./isEventSupported":135,"./monitorCodeUse":148}],19:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule EventPluginRegistry
 * @typechecks static-only
 */



var invariant = _dereq_("./invariant");

/**
 * Injectable ordering of event plugins.
 */
var EventPluginOrder = null;

/**
 * Injectable mapping from names to event plugin modules.
 */
var namesToPlugins = {};

/**
 * Recomputes the plugin list using the injected plugins and plugin ordering.
 *
 * @private
 */
function recomputePluginOrdering() {
  if (!EventPluginOrder) {
    // Wait until an `EventPluginOrder` is injected.
    return;
  }
  for (var pluginName in namesToPlugins) {
    var PluginModule = namesToPlugins[pluginName];
    var pluginIndex = EventPluginOrder.indexOf(pluginName);
    ("production" !== "development" ? invariant(
      pluginIndex > -1,
      'EventPluginRegistry: Cannot inject event plugins that do not exist in ' +
      'the plugin ordering, `%s`.',
      pluginName
    ) : invariant(pluginIndex > -1));
    if (EventPluginRegistry.plugins[pluginIndex]) {
      continue;
    }
    ("production" !== "development" ? invariant(
      PluginModule.extractEvents,
      'EventPluginRegistry: Event plugins must implement an `extractEvents` ' +
      'method, but `%s` does not.',
      pluginName
    ) : invariant(PluginModule.extractEvents));
    EventPluginRegistry.plugins[pluginIndex] = PluginModule;
    var publishedEvents = PluginModule.eventTypes;
    for (var eventName in publishedEvents) {
      ("production" !== "development" ? invariant(
        publishEventForPlugin(
          publishedEvents[eventName],
          PluginModule,
          eventName
        ),
        'EventPluginRegistry: Failed to publish event `%s` for plugin `%s`.',
        eventName,
        pluginName
      ) : invariant(publishEventForPlugin(
        publishedEvents[eventName],
        PluginModule,
        eventName
      )));
    }
  }
}

/**
 * Publishes an event so that it can be dispatched by the supplied plugin.
 *
 * @param {object} dispatchConfig Dispatch configuration for the event.
 * @param {object} PluginModule Plugin publishing the event.
 * @return {boolean} True if the event was successfully published.
 * @private
 */
function publishEventForPlugin(dispatchConfig, PluginModule, eventName) {
  ("production" !== "development" ? invariant(
    !EventPluginRegistry.eventNameDispatchConfigs.hasOwnProperty(eventName),
    'EventPluginHub: More than one plugin attempted to publish the same ' +
    'event name, `%s`.',
    eventName
  ) : invariant(!EventPluginRegistry.eventNameDispatchConfigs.hasOwnProperty(eventName)));
  EventPluginRegistry.eventNameDispatchConfigs[eventName] = dispatchConfig;

  var phasedRegistrationNames = dispatchConfig.phasedRegistrationNames;
  if (phasedRegistrationNames) {
    for (var phaseName in phasedRegistrationNames) {
      if (phasedRegistrationNames.hasOwnProperty(phaseName)) {
        var phasedRegistrationName = phasedRegistrationNames[phaseName];
        publishRegistrationName(
          phasedRegistrationName,
          PluginModule,
          eventName
        );
      }
    }
    return true;
  } else if (dispatchConfig.registrationName) {
    publishRegistrationName(
      dispatchConfig.registrationName,
      PluginModule,
      eventName
    );
    return true;
  }
  return false;
}

/**
 * Publishes a registration name that is used to identify dispatched events and
 * can be used with `EventPluginHub.putListener` to register listeners.
 *
 * @param {string} registrationName Registration name to add.
 * @param {object} PluginModule Plugin publishing the event.
 * @private
 */
function publishRegistrationName(registrationName, PluginModule, eventName) {
  ("production" !== "development" ? invariant(
    !EventPluginRegistry.registrationNameModules[registrationName],
    'EventPluginHub: More than one plugin attempted to publish the same ' +
    'registration name, `%s`.',
    registrationName
  ) : invariant(!EventPluginRegistry.registrationNameModules[registrationName]));
  EventPluginRegistry.registrationNameModules[registrationName] = PluginModule;
  EventPluginRegistry.registrationNameDependencies[registrationName] =
    PluginModule.eventTypes[eventName].dependencies;
}

/**
 * Registers plugins so that they can extract and dispatch events.
 *
 * @see {EventPluginHub}
 */
var EventPluginRegistry = {

  /**
   * Ordered list of injected plugins.
   */
  plugins: [],

  /**
   * Mapping from event name to dispatch config
   */
  eventNameDispatchConfigs: {},

  /**
   * Mapping from registration name to plugin module
   */
  registrationNameModules: {},

  /**
   * Mapping from registration name to event name
   */
  registrationNameDependencies: {},

  /**
   * Injects an ordering of plugins (by plugin name). This allows the ordering
   * to be decoupled from injection of the actual plugins so that ordering is
   * always deterministic regardless of packaging, on-the-fly injection, etc.
   *
   * @param {array} InjectedEventPluginOrder
   * @internal
   * @see {EventPluginHub.injection.injectEventPluginOrder}
   */
  injectEventPluginOrder: function(InjectedEventPluginOrder) {
    ("production" !== "development" ? invariant(
      !EventPluginOrder,
      'EventPluginRegistry: Cannot inject event plugin ordering more than ' +
      'once. You are likely trying to load more than one copy of React.'
    ) : invariant(!EventPluginOrder));
    // Clone the ordering so it cannot be dynamically mutated.
    EventPluginOrder = Array.prototype.slice.call(InjectedEventPluginOrder);
    recomputePluginOrdering();
  },

  /**
   * Injects plugins to be used by `EventPluginHub`. The plugin names must be
   * in the ordering injected by `injectEventPluginOrder`.
   *
   * Plugins can be injected as part of page initialization or on-the-fly.
   *
   * @param {object} injectedNamesToPlugins Map from names to plugin modules.
   * @internal
   * @see {EventPluginHub.injection.injectEventPluginsByName}
   */
  injectEventPluginsByName: function(injectedNamesToPlugins) {
    var isOrderingDirty = false;
    for (var pluginName in injectedNamesToPlugins) {
      if (!injectedNamesToPlugins.hasOwnProperty(pluginName)) {
        continue;
      }
      var PluginModule = injectedNamesToPlugins[pluginName];
      if (!namesToPlugins.hasOwnProperty(pluginName) ||
          namesToPlugins[pluginName] !== PluginModule) {
        ("production" !== "development" ? invariant(
          !namesToPlugins[pluginName],
          'EventPluginRegistry: Cannot inject two different event plugins ' +
          'using the same name, `%s`.',
          pluginName
        ) : invariant(!namesToPlugins[pluginName]));
        namesToPlugins[pluginName] = PluginModule;
        isOrderingDirty = true;
      }
    }
    if (isOrderingDirty) {
      recomputePluginOrdering();
    }
  },

  /**
   * Looks up the plugin for the supplied event.
   *
   * @param {object} event A synthetic event.
   * @return {?object} The plugin that created the supplied event.
   * @internal
   */
  getPluginModuleForEvent: function(event) {
    var dispatchConfig = event.dispatchConfig;
    if (dispatchConfig.registrationName) {
      return EventPluginRegistry.registrationNameModules[
        dispatchConfig.registrationName
      ] || null;
    }
    for (var phase in dispatchConfig.phasedRegistrationNames) {
      if (!dispatchConfig.phasedRegistrationNames.hasOwnProperty(phase)) {
        continue;
      }
      var PluginModule = EventPluginRegistry.registrationNameModules[
        dispatchConfig.phasedRegistrationNames[phase]
      ];
      if (PluginModule) {
        return PluginModule;
      }
    }
    return null;
  },

  /**
   * Exposed for unit testing.
   * @private
   */
  _resetEventPlugins: function() {
    EventPluginOrder = null;
    for (var pluginName in namesToPlugins) {
      if (namesToPlugins.hasOwnProperty(pluginName)) {
        delete namesToPlugins[pluginName];
      }
    }
    EventPluginRegistry.plugins.length = 0;

    var eventNameDispatchConfigs = EventPluginRegistry.eventNameDispatchConfigs;
    for (var eventName in eventNameDispatchConfigs) {
      if (eventNameDispatchConfigs.hasOwnProperty(eventName)) {
        delete eventNameDispatchConfigs[eventName];
      }
    }

    var registrationNameModules = EventPluginRegistry.registrationNameModules;
    for (var registrationName in registrationNameModules) {
      if (registrationNameModules.hasOwnProperty(registrationName)) {
        delete registrationNameModules[registrationName];
      }
    }
  }

};

module.exports = EventPluginRegistry;

},{"./invariant":134}],20:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule EventPluginUtils
 */



var EventConstants = _dereq_("./EventConstants");

var invariant = _dereq_("./invariant");

/**
 * Injected dependencies:
 */

/**
 * - `Mount`: [required] Module that can convert between React dom IDs and
 *   actual node references.
 */
var injection = {
  Mount: null,
  injectMount: function(InjectedMount) {
    injection.Mount = InjectedMount;
    if ("production" !== "development") {
      ("production" !== "development" ? invariant(
        InjectedMount && InjectedMount.getNode,
        'EventPluginUtils.injection.injectMount(...): Injected Mount module ' +
        'is missing getNode.'
      ) : invariant(InjectedMount && InjectedMount.getNode));
    }
  }
};

var topLevelTypes = EventConstants.topLevelTypes;

function isEndish(topLevelType) {
  return topLevelType === topLevelTypes.topMouseUp ||
         topLevelType === topLevelTypes.topTouchEnd ||
         topLevelType === topLevelTypes.topTouchCancel;
}

function isMoveish(topLevelType) {
  return topLevelType === topLevelTypes.topMouseMove ||
         topLevelType === topLevelTypes.topTouchMove;
}
function isStartish(topLevelType) {
  return topLevelType === topLevelTypes.topMouseDown ||
         topLevelType === topLevelTypes.topTouchStart;
}


var validateEventDispatches;
if ("production" !== "development") {
  validateEventDispatches = function(event) {
    var dispatchListeners = event._dispatchListeners;
    var dispatchIDs = event._dispatchIDs;

    var listenersIsArr = Array.isArray(dispatchListeners);
    var idsIsArr = Array.isArray(dispatchIDs);
    var IDsLen = idsIsArr ? dispatchIDs.length : dispatchIDs ? 1 : 0;
    var listenersLen = listenersIsArr ?
      dispatchListeners.length :
      dispatchListeners ? 1 : 0;

    ("production" !== "development" ? invariant(
      idsIsArr === listenersIsArr && IDsLen === listenersLen,
      'EventPluginUtils: Invalid `event`.'
    ) : invariant(idsIsArr === listenersIsArr && IDsLen === listenersLen));
  };
}

/**
 * Invokes `cb(event, listener, id)`. Avoids using call if no scope is
 * provided. The `(listener,id)` pair effectively forms the "dispatch" but are
 * kept separate to conserve memory.
 */
function forEachEventDispatch(event, cb) {
  var dispatchListeners = event._dispatchListeners;
  var dispatchIDs = event._dispatchIDs;
  if ("production" !== "development") {
    validateEventDispatches(event);
  }
  if (Array.isArray(dispatchListeners)) {
    for (var i = 0; i < dispatchListeners.length; i++) {
      if (event.isPropagationStopped()) {
        break;
      }
      // Listeners and IDs are two parallel arrays that are always in sync.
      cb(event, dispatchListeners[i], dispatchIDs[i]);
    }
  } else if (dispatchListeners) {
    cb(event, dispatchListeners, dispatchIDs);
  }
}

/**
 * Default implementation of PluginModule.executeDispatch().
 * @param {SyntheticEvent} SyntheticEvent to handle
 * @param {function} Application-level callback
 * @param {string} domID DOM id to pass to the callback.
 */
function executeDispatch(event, listener, domID) {
  event.currentTarget = injection.Mount.getNode(domID);
  var returnValue = listener(event, domID);
  event.currentTarget = null;
  return returnValue;
}

/**
 * Standard/simple iteration through an event's collected dispatches.
 */
function executeDispatchesInOrder(event, executeDispatch) {
  forEachEventDispatch(event, executeDispatch);
  event._dispatchListeners = null;
  event._dispatchIDs = null;
}

/**
 * Standard/simple iteration through an event's collected dispatches, but stops
 * at the first dispatch execution returning true, and returns that id.
 *
 * @return id of the first dispatch execution who's listener returns true, or
 * null if no listener returned true.
 */
function executeDispatchesInOrderStopAtTrueImpl(event) {
  var dispatchListeners = event._dispatchListeners;
  var dispatchIDs = event._dispatchIDs;
  if ("production" !== "development") {
    validateEventDispatches(event);
  }
  if (Array.isArray(dispatchListeners)) {
    for (var i = 0; i < dispatchListeners.length; i++) {
      if (event.isPropagationStopped()) {
        break;
      }
      // Listeners and IDs are two parallel arrays that are always in sync.
      if (dispatchListeners[i](event, dispatchIDs[i])) {
        return dispatchIDs[i];
      }
    }
  } else if (dispatchListeners) {
    if (dispatchListeners(event, dispatchIDs)) {
      return dispatchIDs;
    }
  }
  return null;
}

/**
 * @see executeDispatchesInOrderStopAtTrueImpl
 */
function executeDispatchesInOrderStopAtTrue(event) {
  var ret = executeDispatchesInOrderStopAtTrueImpl(event);
  event._dispatchIDs = null;
  event._dispatchListeners = null;
  return ret;
}

/**
 * Execution of a "direct" dispatch - there must be at most one dispatch
 * accumulated on the event or it is considered an error. It doesn't really make
 * sense for an event with multiple dispatches (bubbled) to keep track of the
 * return values at each dispatch execution, but it does tend to make sense when
 * dealing with "direct" dispatches.
 *
 * @return The return value of executing the single dispatch.
 */
function executeDirectDispatch(event) {
  if ("production" !== "development") {
    validateEventDispatches(event);
  }
  var dispatchListener = event._dispatchListeners;
  var dispatchID = event._dispatchIDs;
  ("production" !== "development" ? invariant(
    !Array.isArray(dispatchListener),
    'executeDirectDispatch(...): Invalid `event`.'
  ) : invariant(!Array.isArray(dispatchListener)));
  var res = dispatchListener ?
    dispatchListener(event, dispatchID) :
    null;
  event._dispatchListeners = null;
  event._dispatchIDs = null;
  return res;
}

/**
 * @param {SyntheticEvent} event
 * @return {bool} True iff number of dispatches accumulated is greater than 0.
 */
function hasDispatches(event) {
  return !!event._dispatchListeners;
}

/**
 * General utilities that are useful in creating custom Event Plugins.
 */
var EventPluginUtils = {
  isEndish: isEndish,
  isMoveish: isMoveish,
  isStartish: isStartish,

  executeDirectDispatch: executeDirectDispatch,
  executeDispatch: executeDispatch,
  executeDispatchesInOrder: executeDispatchesInOrder,
  executeDispatchesInOrderStopAtTrue: executeDispatchesInOrderStopAtTrue,
  hasDispatches: hasDispatches,
  injection: injection,
  useTouchEvents: false
};

module.exports = EventPluginUtils;

},{"./EventConstants":16,"./invariant":134}],21:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule EventPropagators
 */



var EventConstants = _dereq_("./EventConstants");
var EventPluginHub = _dereq_("./EventPluginHub");

var accumulate = _dereq_("./accumulate");
var forEachAccumulated = _dereq_("./forEachAccumulated");

var PropagationPhases = EventConstants.PropagationPhases;
var getListener = EventPluginHub.getListener;

/**
 * Some event types have a notion of different registration names for different
 * "phases" of propagation. This finds listeners by a given phase.
 */
function listenerAtPhase(id, event, propagationPhase) {
  var registrationName =
    event.dispatchConfig.phasedRegistrationNames[propagationPhase];
  return getListener(id, registrationName);
}

/**
 * Tags a `SyntheticEvent` with dispatched listeners. Creating this function
 * here, allows us to not have to bind or create functions for each event.
 * Mutating the event's members allows us to not have to create a wrapping
 * "dispatch" object that pairs the event with the listener.
 */
function accumulateDirectionalDispatches(domID, upwards, event) {
  if ("production" !== "development") {
    if (!domID) {
      throw new Error('Dispatching id must not be null');
    }
  }
  var phase = upwards ? PropagationPhases.bubbled : PropagationPhases.captured;
  var listener = listenerAtPhase(domID, event, phase);
  if (listener) {
    event._dispatchListeners = accumulate(event._dispatchListeners, listener);
    event._dispatchIDs = accumulate(event._dispatchIDs, domID);
  }
}

/**
 * Collect dispatches (must be entirely collected before dispatching - see unit
 * tests). Lazily allocate the array to conserve memory.  We must loop through
 * each event and perform the traversal for each one. We can not perform a
 * single traversal for the entire collection of events because each event may
 * have a different target.
 */
function accumulateTwoPhaseDispatchesSingle(event) {
  if (event && event.dispatchConfig.phasedRegistrationNames) {
    EventPluginHub.injection.getInstanceHandle().traverseTwoPhase(
      event.dispatchMarker,
      accumulateDirectionalDispatches,
      event
    );
  }
}


/**
 * Accumulates without regard to direction, does not look for phased
 * registration names. Same as `accumulateDirectDispatchesSingle` but without
 * requiring that the `dispatchMarker` be the same as the dispatched ID.
 */
function accumulateDispatches(id, ignoredDirection, event) {
  if (event && event.dispatchConfig.registrationName) {
    var registrationName = event.dispatchConfig.registrationName;
    var listener = getListener(id, registrationName);
    if (listener) {
      event._dispatchListeners = accumulate(event._dispatchListeners, listener);
      event._dispatchIDs = accumulate(event._dispatchIDs, id);
    }
  }
}

/**
 * Accumulates dispatches on an `SyntheticEvent`, but only for the
 * `dispatchMarker`.
 * @param {SyntheticEvent} event
 */
function accumulateDirectDispatchesSingle(event) {
  if (event && event.dispatchConfig.registrationName) {
    accumulateDispatches(event.dispatchMarker, null, event);
  }
}

function accumulateTwoPhaseDispatches(events) {
  forEachAccumulated(events, accumulateTwoPhaseDispatchesSingle);
}

function accumulateEnterLeaveDispatches(leave, enter, fromID, toID) {
  EventPluginHub.injection.getInstanceHandle().traverseEnterLeave(
    fromID,
    toID,
    accumulateDispatches,
    leave,
    enter
  );
}


function accumulateDirectDispatches(events) {
  forEachAccumulated(events, accumulateDirectDispatchesSingle);
}



/**
 * A small set of propagation patterns, each of which will accept a small amount
 * of information, and generate a set of "dispatch ready event objects" - which
 * are sets of events that have already been annotated with a set of dispatched
 * listener functions/ids. The API is designed this way to discourage these
 * propagation strategies from actually executing the dispatches, since we
 * always want to collect the entire set of dispatches before executing event a
 * single one.
 *
 * @constructor EventPropagators
 */
var EventPropagators = {
  accumulateTwoPhaseDispatches: accumulateTwoPhaseDispatches,
  accumulateDirectDispatches: accumulateDirectDispatches,
  accumulateEnterLeaveDispatches: accumulateEnterLeaveDispatches
};

module.exports = EventPropagators;

},{"./EventConstants":16,"./EventPluginHub":18,"./accumulate":106,"./forEachAccumulated":121}],22:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ExecutionEnvironment
 */

/*jslint evil: true */



var canUseDOM = !!(
  typeof window !== 'undefined' &&
  window.document &&
  window.document.createElement
);

/**
 * Simple, lightweight module assisting with the detection and context of
 * Worker. Helps avoid circular dependencies and allows code to reason about
 * whether or not they are in a Worker, even if they never include the main
 * `ReactWorker` dependency.
 */
var ExecutionEnvironment = {

  canUseDOM: canUseDOM,

  canUseWorkers: typeof Worker !== 'undefined',

  canUseEventListeners:
    canUseDOM && !!(window.addEventListener || window.attachEvent),

  canUseViewport: canUseDOM && !!window.screen,

  isInWorker: !canUseDOM // For now, this is true - might change in the future.

};

module.exports = ExecutionEnvironment;

},{}],23:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule HTMLDOMPropertyConfig
 */

/*jslint bitwise: true*/



var DOMProperty = _dereq_("./DOMProperty");
var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

var MUST_USE_ATTRIBUTE = DOMProperty.injection.MUST_USE_ATTRIBUTE;
var MUST_USE_PROPERTY = DOMProperty.injection.MUST_USE_PROPERTY;
var HAS_BOOLEAN_VALUE = DOMProperty.injection.HAS_BOOLEAN_VALUE;
var HAS_SIDE_EFFECTS = DOMProperty.injection.HAS_SIDE_EFFECTS;
var HAS_NUMERIC_VALUE = DOMProperty.injection.HAS_NUMERIC_VALUE;
var HAS_POSITIVE_NUMERIC_VALUE =
  DOMProperty.injection.HAS_POSITIVE_NUMERIC_VALUE;
var HAS_OVERLOADED_BOOLEAN_VALUE =
  DOMProperty.injection.HAS_OVERLOADED_BOOLEAN_VALUE;

var hasSVG;
if (ExecutionEnvironment.canUseDOM) {
  var implementation = document.implementation;
  hasSVG = (
    implementation &&
    implementation.hasFeature &&
    implementation.hasFeature(
      'http://www.w3.org/TR/SVG11/feature#BasicStructure',
      '1.1'
    )
  );
}


var HTMLDOMPropertyConfig = {
  isCustomAttribute: RegExp.prototype.test.bind(
    /^(data|aria)-[a-z_][a-z\d_.\-]*$/
  ),
  Properties: {
    /**
     * Standard Properties
     */
    accept: null,
    accessKey: null,
    action: null,
    allowFullScreen: MUST_USE_ATTRIBUTE | HAS_BOOLEAN_VALUE,
    allowTransparency: MUST_USE_ATTRIBUTE,
    alt: null,
    async: HAS_BOOLEAN_VALUE,
    autoComplete: null,
    // autoFocus is polyfilled/normalized by AutoFocusMixin
    // autoFocus: HAS_BOOLEAN_VALUE,
    autoPlay: HAS_BOOLEAN_VALUE,
    cellPadding: null,
    cellSpacing: null,
    charSet: MUST_USE_ATTRIBUTE,
    checked: MUST_USE_PROPERTY | HAS_BOOLEAN_VALUE,
    // To set className on SVG elements, it's necessary to use .setAttribute;
    // this works on HTML elements too in all browsers except IE8. Conveniently,
    // IE8 doesn't support SVG and so we can simply use the attribute in
    // browsers that support SVG and the property in browsers that don't,
    // regardless of whether the element is HTML or SVG.
    className: hasSVG ? MUST_USE_ATTRIBUTE : MUST_USE_PROPERTY,
    cols: MUST_USE_ATTRIBUTE | HAS_POSITIVE_NUMERIC_VALUE,
    colSpan: null,
    content: null,
    contentEditable: null,
    contextMenu: MUST_USE_ATTRIBUTE,
    controls: MUST_USE_PROPERTY | HAS_BOOLEAN_VALUE,
    coords: null,
    crossOrigin: null,
    data: null, // For `<object />` acts as `src`.
    dateTime: MUST_USE_ATTRIBUTE,
    defer: HAS_BOOLEAN_VALUE,
    dir: null,
    disabled: MUST_USE_ATTRIBUTE | HAS_BOOLEAN_VALUE,
    download: HAS_OVERLOADED_BOOLEAN_VALUE,
    draggable: null,
    encType: null,
    form: MUST_USE_ATTRIBUTE,
    formNoValidate: HAS_BOOLEAN_VALUE,
    frameBorder: MUST_USE_ATTRIBUTE,
    height: MUST_USE_ATTRIBUTE,
    hidden: MUST_USE_ATTRIBUTE | HAS_BOOLEAN_VALUE,
    href: null,
    hrefLang: null,
    htmlFor: null,
    httpEquiv: null,
    icon: null,
    id: MUST_USE_PROPERTY,
    label: null,
    lang: null,
    list: null,
    loop: MUST_USE_PROPERTY | HAS_BOOLEAN_VALUE,
    max: null,
    maxLength: MUST_USE_ATTRIBUTE,
    media: MUST_USE_ATTRIBUTE,
    mediaGroup: null,
    method: null,
    min: null,
    multiple: MUST_USE_PROPERTY | HAS_BOOLEAN_VALUE,
    muted: MUST_USE_PROPERTY | HAS_BOOLEAN_VALUE,
    name: null,
    noValidate: HAS_BOOLEAN_VALUE,
    open: null,
    pattern: null,
    placeholder: null,
    poster: null,
    preload: null,
    radioGroup: null,
    readOnly: MUST_USE_PROPERTY | HAS_BOOLEAN_VALUE,
    rel: null,
    required: HAS_BOOLEAN_VALUE,
    role: MUST_USE_ATTRIBUTE,
    rows: MUST_USE_ATTRIBUTE | HAS_POSITIVE_NUMERIC_VALUE,
    rowSpan: null,
    sandbox: null,
    scope: null,
    scrollLeft: MUST_USE_PROPERTY,
    scrolling: null,
    scrollTop: MUST_USE_PROPERTY,
    seamless: MUST_USE_ATTRIBUTE | HAS_BOOLEAN_VALUE,
    selected: MUST_USE_PROPERTY | HAS_BOOLEAN_VALUE,
    shape: null,
    size: MUST_USE_ATTRIBUTE | HAS_POSITIVE_NUMERIC_VALUE,
    sizes: MUST_USE_ATTRIBUTE,
    span: HAS_POSITIVE_NUMERIC_VALUE,
    spellCheck: null,
    src: null,
    srcDoc: MUST_USE_PROPERTY,
    srcSet: MUST_USE_ATTRIBUTE,
    start: HAS_NUMERIC_VALUE,
    step: null,
    style: null,
    tabIndex: null,
    target: null,
    title: null,
    type: null,
    useMap: null,
    value: MUST_USE_PROPERTY | HAS_SIDE_EFFECTS,
    width: MUST_USE_ATTRIBUTE,
    wmode: MUST_USE_ATTRIBUTE,

    /**
     * Non-standard Properties
     */
    autoCapitalize: null, // Supported in Mobile Safari for keyboard hints
    autoCorrect: null, // Supported in Mobile Safari for keyboard hints
    itemProp: MUST_USE_ATTRIBUTE, // Microdata: http://schema.org/docs/gs.html
    itemScope: MUST_USE_ATTRIBUTE | HAS_BOOLEAN_VALUE, // Microdata: http://schema.org/docs/gs.html
    itemType: MUST_USE_ATTRIBUTE, // Microdata: http://schema.org/docs/gs.html
    property: null // Supports OG in meta tags
  },
  DOMAttributeNames: {
    className: 'class',
    htmlFor: 'for',
    httpEquiv: 'http-equiv'
  },
  DOMPropertyNames: {
    autoCapitalize: 'autocapitalize',
    autoComplete: 'autocomplete',
    autoCorrect: 'autocorrect',
    autoFocus: 'autofocus',
    autoPlay: 'autoplay',
    encType: 'enctype',
    hrefLang: 'hreflang',
    radioGroup: 'radiogroup',
    spellCheck: 'spellcheck',
    srcDoc: 'srcdoc',
    srcSet: 'srcset'
  }
};

module.exports = HTMLDOMPropertyConfig;

},{"./DOMProperty":11,"./ExecutionEnvironment":22}],24:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule LinkedStateMixin
 * @typechecks static-only
 */



var ReactLink = _dereq_("./ReactLink");
var ReactStateSetters = _dereq_("./ReactStateSetters");

/**
 * A simple mixin around ReactLink.forState().
 */
var LinkedStateMixin = {
  /**
   * Create a ReactLink that's linked to part of this component's state. The
   * ReactLink will have the current value of this.state[key] and will call
   * setState() when a change is requested.
   *
   * @param {string} key state key to update. Note: you may want to use keyOf()
   * if you're using Google Closure Compiler advanced mode.
   * @return {ReactLink} ReactLink instance linking to the state.
   */
  linkState: function(key) {
    return new ReactLink(
      this.state[key],
      ReactStateSetters.createStateKeySetter(this, key)
    );
  }
};

module.exports = LinkedStateMixin;

},{"./ReactLink":65,"./ReactStateSetters":81}],25:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule LinkedValueUtils
 * @typechecks static-only
 */



var ReactPropTypes = _dereq_("./ReactPropTypes");

var invariant = _dereq_("./invariant");

var hasReadOnlyValue = {
  'button': true,
  'checkbox': true,
  'image': true,
  'hidden': true,
  'radio': true,
  'reset': true,
  'submit': true
};

function _assertSingleLink(input) {
  ("production" !== "development" ? invariant(
    input.props.checkedLink == null || input.props.valueLink == null,
    'Cannot provide a checkedLink and a valueLink. If you want to use ' +
    'checkedLink, you probably don\'t want to use valueLink and vice versa.'
  ) : invariant(input.props.checkedLink == null || input.props.valueLink == null));
}
function _assertValueLink(input) {
  _assertSingleLink(input);
  ("production" !== "development" ? invariant(
    input.props.value == null && input.props.onChange == null,
    'Cannot provide a valueLink and a value or onChange event. If you want ' +
    'to use value or onChange, you probably don\'t want to use valueLink.'
  ) : invariant(input.props.value == null && input.props.onChange == null));
}

function _assertCheckedLink(input) {
  _assertSingleLink(input);
  ("production" !== "development" ? invariant(
    input.props.checked == null && input.props.onChange == null,
    'Cannot provide a checkedLink and a checked property or onChange event. ' +
    'If you want to use checked or onChange, you probably don\'t want to ' +
    'use checkedLink'
  ) : invariant(input.props.checked == null && input.props.onChange == null));
}

/**
 * @param {SyntheticEvent} e change event to handle
 */
function _handleLinkedValueChange(e) {
  /*jshint validthis:true */
  this.props.valueLink.requestChange(e.target.value);
}

/**
  * @param {SyntheticEvent} e change event to handle
  */
function _handleLinkedCheckChange(e) {
  /*jshint validthis:true */
  this.props.checkedLink.requestChange(e.target.checked);
}

/**
 * Provide a linked `value` attribute for controlled forms. You should not use
 * this outside of the ReactDOM controlled form components.
 */
var LinkedValueUtils = {
  Mixin: {
    propTypes: {
      value: function(props, propName, componentName) {
        if (!props[propName] ||
            hasReadOnlyValue[props.type] ||
            props.onChange ||
            props.readOnly ||
            props.disabled) {
          return;
        }
        return new Error(
          'You provided a `value` prop to a form field without an ' +
          '`onChange` handler. This will render a read-only field. If ' +
          'the field should be mutable use `defaultValue`. Otherwise, ' +
          'set either `onChange` or `readOnly`.'
        );
      },
      checked: function(props, propName, componentName) {
        if (!props[propName] ||
            props.onChange ||
            props.readOnly ||
            props.disabled) {
          return;
        }
        return new Error(
          'You provided a `checked` prop to a form field without an ' +
          '`onChange` handler. This will render a read-only field. If ' +
          'the field should be mutable use `defaultChecked`. Otherwise, ' +
          'set either `onChange` or `readOnly`.'
        );
      },
      onChange: ReactPropTypes.func
    }
  },

  /**
   * @param {ReactComponent} input Form component
   * @return {*} current value of the input either from value prop or link.
   */
  getValue: function(input) {
    if (input.props.valueLink) {
      _assertValueLink(input);
      return input.props.valueLink.value;
    }
    return input.props.value;
  },

  /**
   * @param {ReactComponent} input Form component
   * @return {*} current checked status of the input either from checked prop
   *             or link.
   */
  getChecked: function(input) {
    if (input.props.checkedLink) {
      _assertCheckedLink(input);
      return input.props.checkedLink.value;
    }
    return input.props.checked;
  },

  /**
   * @param {ReactComponent} input Form component
   * @return {function} change callback either from onChange prop or link.
   */
  getOnChange: function(input) {
    if (input.props.valueLink) {
      _assertValueLink(input);
      return _handleLinkedValueChange;
    } else if (input.props.checkedLink) {
      _assertCheckedLink(input);
      return _handleLinkedCheckChange;
    }
    return input.props.onChange;
  }
};

module.exports = LinkedValueUtils;

},{"./ReactPropTypes":75,"./invariant":134}],26:[function(_dereq_,module,exports){
/**
 * Copyright 2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule LocalEventTrapMixin
 */



var ReactBrowserEventEmitter = _dereq_("./ReactBrowserEventEmitter");

var accumulate = _dereq_("./accumulate");
var forEachAccumulated = _dereq_("./forEachAccumulated");
var invariant = _dereq_("./invariant");

function remove(event) {
  event.remove();
}

var LocalEventTrapMixin = {
  trapBubbledEvent:function(topLevelType, handlerBaseName) {
    ("production" !== "development" ? invariant(this.isMounted(), 'Must be mounted to trap events') : invariant(this.isMounted()));
    var listener = ReactBrowserEventEmitter.trapBubbledEvent(
      topLevelType,
      handlerBaseName,
      this.getDOMNode()
    );
    this._localEventListeners = accumulate(this._localEventListeners, listener);
  },

  // trapCapturedEvent would look nearly identical. We don't implement that
  // method because it isn't currently needed.

  componentWillUnmount:function() {
    if (this._localEventListeners) {
      forEachAccumulated(this._localEventListeners, remove);
    }
  }
};

module.exports = LocalEventTrapMixin;

},{"./ReactBrowserEventEmitter":31,"./accumulate":106,"./forEachAccumulated":121,"./invariant":134}],27:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule MobileSafariClickEventPlugin
 * @typechecks static-only
 */



var EventConstants = _dereq_("./EventConstants");

var emptyFunction = _dereq_("./emptyFunction");

var topLevelTypes = EventConstants.topLevelTypes;

/**
 * Mobile Safari does not fire properly bubble click events on non-interactive
 * elements, which means delegated click listeners do not fire. The workaround
 * for this bug involves attaching an empty click listener on the target node.
 *
 * This particular plugin works around the bug by attaching an empty click
 * listener on `touchstart` (which does fire on every element).
 */
var MobileSafariClickEventPlugin = {

  eventTypes: null,

  /**
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {DOMEventTarget} topLevelTarget The listening component root node.
   * @param {string} topLevelTargetID ID of `topLevelTarget`.
   * @param {object} nativeEvent Native browser event.
   * @return {*} An accumulation of synthetic events.
   * @see {EventPluginHub.extractEvents}
   */
  extractEvents: function(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent) {
    if (topLevelType === topLevelTypes.topTouchStart) {
      var target = nativeEvent.target;
      if (target && !target.onclick) {
        target.onclick = emptyFunction;
      }
    }
  }

};

module.exports = MobileSafariClickEventPlugin;

},{"./EventConstants":16,"./emptyFunction":116}],28:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule PooledClass
 */



var invariant = _dereq_("./invariant");

/**
 * Static poolers. Several custom versions for each potential number of
 * arguments. A completely generic pooler is easy to implement, but would
 * require accessing the `arguments` object. In each of these, `this` refers to
 * the Class itself, not an instance. If any others are needed, simply add them
 * here, or in their own files.
 */
var oneArgumentPooler = function(copyFieldsFrom) {
  var Klass = this;
  if (Klass.instancePool.length) {
    var instance = Klass.instancePool.pop();
    Klass.call(instance, copyFieldsFrom);
    return instance;
  } else {
    return new Klass(copyFieldsFrom);
  }
};

var twoArgumentPooler = function(a1, a2) {
  var Klass = this;
  if (Klass.instancePool.length) {
    var instance = Klass.instancePool.pop();
    Klass.call(instance, a1, a2);
    return instance;
  } else {
    return new Klass(a1, a2);
  }
};

var threeArgumentPooler = function(a1, a2, a3) {
  var Klass = this;
  if (Klass.instancePool.length) {
    var instance = Klass.instancePool.pop();
    Klass.call(instance, a1, a2, a3);
    return instance;
  } else {
    return new Klass(a1, a2, a3);
  }
};

var fiveArgumentPooler = function(a1, a2, a3, a4, a5) {
  var Klass = this;
  if (Klass.instancePool.length) {
    var instance = Klass.instancePool.pop();
    Klass.call(instance, a1, a2, a3, a4, a5);
    return instance;
  } else {
    return new Klass(a1, a2, a3, a4, a5);
  }
};

var standardReleaser = function(instance) {
  var Klass = this;
  ("production" !== "development" ? invariant(
    instance instanceof Klass,
    'Trying to release an instance into a pool of a different type.'
  ) : invariant(instance instanceof Klass));
  if (instance.destructor) {
    instance.destructor();
  }
  if (Klass.instancePool.length < Klass.poolSize) {
    Klass.instancePool.push(instance);
  }
};

var DEFAULT_POOL_SIZE = 10;
var DEFAULT_POOLER = oneArgumentPooler;

/**
 * Augments `CopyConstructor` to be a poolable class, augmenting only the class
 * itself (statically) not adding any prototypical fields. Any CopyConstructor
 * you give this may have a `poolSize` property, and will look for a
 * prototypical `destructor` on instances (optional).
 *
 * @param {Function} CopyConstructor Constructor that can be used to reset.
 * @param {Function} pooler Customizable pooler.
 */
var addPoolingTo = function(CopyConstructor, pooler) {
  var NewKlass = CopyConstructor;
  NewKlass.instancePool = [];
  NewKlass.getPooled = pooler || DEFAULT_POOLER;
  if (!NewKlass.poolSize) {
    NewKlass.poolSize = DEFAULT_POOL_SIZE;
  }
  NewKlass.release = standardReleaser;
  return NewKlass;
};

var PooledClass = {
  addPoolingTo: addPoolingTo,
  oneArgumentPooler: oneArgumentPooler,
  twoArgumentPooler: twoArgumentPooler,
  threeArgumentPooler: threeArgumentPooler,
  fiveArgumentPooler: fiveArgumentPooler
};

module.exports = PooledClass;

},{"./invariant":134}],29:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule React
 */



var DOMPropertyOperations = _dereq_("./DOMPropertyOperations");
var EventPluginUtils = _dereq_("./EventPluginUtils");
var ReactChildren = _dereq_("./ReactChildren");
var ReactComponent = _dereq_("./ReactComponent");
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");
var ReactContext = _dereq_("./ReactContext");
var ReactCurrentOwner = _dereq_("./ReactCurrentOwner");
var ReactDescriptor = _dereq_("./ReactDescriptor");
var ReactDOM = _dereq_("./ReactDOM");
var ReactDOMComponent = _dereq_("./ReactDOMComponent");
var ReactDefaultInjection = _dereq_("./ReactDefaultInjection");
var ReactInstanceHandles = _dereq_("./ReactInstanceHandles");
var ReactMount = _dereq_("./ReactMount");
var ReactMultiChild = _dereq_("./ReactMultiChild");
var ReactPerf = _dereq_("./ReactPerf");
var ReactPropTypes = _dereq_("./ReactPropTypes");
var ReactServerRendering = _dereq_("./ReactServerRendering");
var ReactTextComponent = _dereq_("./ReactTextComponent");

var onlyChild = _dereq_("./onlyChild");
var warning = _dereq_("./warning");

ReactDefaultInjection.inject();

// Specifying arguments isn't necessary since we just use apply anyway, but it
// makes it clear for those actually consuming this API.
function createDescriptor(type, props, children) {
  var args = Array.prototype.slice.call(arguments, 1);
  return type.apply(null, args);
}

if ("production" !== "development") {
  var _warnedForDeprecation = false;
}

var React = {
  Children: {
    map: ReactChildren.map,
    forEach: ReactChildren.forEach,
    count: ReactChildren.count,
    only: onlyChild
  },
  DOM: ReactDOM,
  PropTypes: ReactPropTypes,
  initializeTouchEvents: function(shouldUseTouch) {
    EventPluginUtils.useTouchEvents = shouldUseTouch;
  },
  createClass: ReactCompositeComponent.createClass,
  createDescriptor: function() {
    if ("production" !== "development") {
      ("production" !== "development" ? warning(
        _warnedForDeprecation,
        'React.createDescriptor is deprecated and will be removed in the ' +
        'next version of React. Use React.createElement instead.'
      ) : null);
      _warnedForDeprecation = true;
    }
    return createDescriptor.apply(this, arguments);
  },
  createElement: createDescriptor,
  constructAndRenderComponent: ReactMount.constructAndRenderComponent,
  constructAndRenderComponentByID: ReactMount.constructAndRenderComponentByID,
  renderComponent: ReactPerf.measure(
    'React',
    'renderComponent',
    ReactMount.renderComponent
  ),
  renderComponentToString: ReactServerRendering.renderComponentToString,
  renderComponentToStaticMarkup:
    ReactServerRendering.renderComponentToStaticMarkup,
  unmountComponentAtNode: ReactMount.unmountComponentAtNode,
  isValidClass: ReactDescriptor.isValidFactory,
  isValidComponent: ReactDescriptor.isValidDescriptor,
  withContext: ReactContext.withContext,
  __internals: {
    Component: ReactComponent,
    CurrentOwner: ReactCurrentOwner,
    DOMComponent: ReactDOMComponent,
    DOMPropertyOperations: DOMPropertyOperations,
    InstanceHandles: ReactInstanceHandles,
    Mount: ReactMount,
    MultiChild: ReactMultiChild,
    TextComponent: ReactTextComponent
  }
};

if ("production" !== "development") {
  var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");
  if (ExecutionEnvironment.canUseDOM &&
      window.top === window.self &&
      navigator.userAgent.indexOf('Chrome') > -1) {
    console.debug(
      'Download the React DevTools for a better development experience: ' +
      'http://fb.me/react-devtools'
    );

    var expectedFeatures = [
      // shims
      Array.isArray,
      Array.prototype.every,
      Array.prototype.forEach,
      Array.prototype.indexOf,
      Array.prototype.map,
      Date.now,
      Function.prototype.bind,
      Object.keys,
      String.prototype.split,
      String.prototype.trim,

      // shams
      Object.create,
      Object.freeze
    ];

    for (var i in expectedFeatures) {
      if (!expectedFeatures[i]) {
        console.error(
          'One or more ES5 shim/shams expected by React are not available: ' +
          'http://fb.me/react-warning-polyfills'
        );
        break;
      }
    }
  }
}

// Version exists only in the open-source version of React, not in Facebook's
// internal version.
React.version = '0.11.2';

module.exports = React;

},{"./DOMPropertyOperations":12,"./EventPluginUtils":20,"./ExecutionEnvironment":22,"./ReactChildren":34,"./ReactComponent":35,"./ReactCompositeComponent":38,"./ReactContext":39,"./ReactCurrentOwner":40,"./ReactDOM":41,"./ReactDOMComponent":43,"./ReactDefaultInjection":53,"./ReactDescriptor":56,"./ReactInstanceHandles":64,"./ReactMount":67,"./ReactMultiChild":68,"./ReactPerf":71,"./ReactPropTypes":75,"./ReactServerRendering":79,"./ReactTextComponent":83,"./onlyChild":149,"./warning":158}],30:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactBrowserComponentMixin
 */



var ReactEmptyComponent = _dereq_("./ReactEmptyComponent");
var ReactMount = _dereq_("./ReactMount");

var invariant = _dereq_("./invariant");

var ReactBrowserComponentMixin = {
  /**
   * Returns the DOM node rendered by this component.
   *
   * @return {DOMElement} The root node of this component.
   * @final
   * @protected
   */
  getDOMNode: function() {
    ("production" !== "development" ? invariant(
      this.isMounted(),
      'getDOMNode(): A component must be mounted to have a DOM node.'
    ) : invariant(this.isMounted()));
    if (ReactEmptyComponent.isNullComponentID(this._rootNodeID)) {
      return null;
    }
    return ReactMount.getNode(this._rootNodeID);
  }
};

module.exports = ReactBrowserComponentMixin;

},{"./ReactEmptyComponent":58,"./ReactMount":67,"./invariant":134}],31:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactBrowserEventEmitter
 * @typechecks static-only
 */



var EventConstants = _dereq_("./EventConstants");
var EventPluginHub = _dereq_("./EventPluginHub");
var EventPluginRegistry = _dereq_("./EventPluginRegistry");
var ReactEventEmitterMixin = _dereq_("./ReactEventEmitterMixin");
var ViewportMetrics = _dereq_("./ViewportMetrics");

var isEventSupported = _dereq_("./isEventSupported");
var merge = _dereq_("./merge");

/**
 * Summary of `ReactBrowserEventEmitter` event handling:
 *
 *  - Top-level delegation is used to trap most native browser events. This
 *    may only occur in the main thread and is the responsibility of
 *    ReactEventListener, which is injected and can therefore support pluggable
 *    event sources. This is the only work that occurs in the main thread.
 *
 *  - We normalize and de-duplicate events to account for browser quirks. This
 *    may be done in the worker thread.
 *
 *  - Forward these native events (with the associated top-level type used to
 *    trap it) to `EventPluginHub`, which in turn will ask plugins if they want
 *    to extract any synthetic events.
 *
 *  - The `EventPluginHub` will then process each event by annotating them with
 *    "dispatches", a sequence of listeners and IDs that care about that event.
 *
 *  - The `EventPluginHub` then dispatches the events.
 *
 * Overview of React and the event system:
 *
 * +------------+    .
 * |    DOM     |    .
 * +------------+    .
 *       |           .
 *       v           .
 * +------------+    .
 * | ReactEvent |    .
 * |  Listener  |    .
 * +------------+    .                         +-----------+
 *       |           .               +--------+|SimpleEvent|
 *       |           .               |         |Plugin     |
 * +-----|------+    .               v         +-----------+
 * |     |      |    .    +--------------+                    +------------+
 * |     +-----------.--->|EventPluginHub|                    |    Event   |
 * |            |    .    |              |     +-----------+  | Propagators|
 * | ReactEvent |    .    |              |     |TapEvent   |  |------------|
 * |  Emitter   |    .    |              |<---+|Plugin     |  |other plugin|
 * |            |    .    |              |     +-----------+  |  utilities |
 * |     +-----------.--->|              |                    +------------+
 * |     |      |    .    +--------------+
 * +-----|------+    .                ^        +-----------+
 *       |           .                |        |Enter/Leave|
 *       +           .                +-------+|Plugin     |
 * +-------------+   .                         +-----------+
 * | application |   .
 * |-------------|   .
 * |             |   .
 * |             |   .
 * +-------------+   .
 *                   .
 *    React Core     .  General Purpose Event Plugin System
 */

var alreadyListeningTo = {};
var isMonitoringScrollValue = false;
var reactTopListenersCounter = 0;

// For events like 'submit' which don't consistently bubble (which we trap at a
// lower node than `document`), binding at `document` would cause duplicate
// events so we don't include them here
var topEventMapping = {
  topBlur: 'blur',
  topChange: 'change',
  topClick: 'click',
  topCompositionEnd: 'compositionend',
  topCompositionStart: 'compositionstart',
  topCompositionUpdate: 'compositionupdate',
  topContextMenu: 'contextmenu',
  topCopy: 'copy',
  topCut: 'cut',
  topDoubleClick: 'dblclick',
  topDrag: 'drag',
  topDragEnd: 'dragend',
  topDragEnter: 'dragenter',
  topDragExit: 'dragexit',
  topDragLeave: 'dragleave',
  topDragOver: 'dragover',
  topDragStart: 'dragstart',
  topDrop: 'drop',
  topFocus: 'focus',
  topInput: 'input',
  topKeyDown: 'keydown',
  topKeyPress: 'keypress',
  topKeyUp: 'keyup',
  topMouseDown: 'mousedown',
  topMouseMove: 'mousemove',
  topMouseOut: 'mouseout',
  topMouseOver: 'mouseover',
  topMouseUp: 'mouseup',
  topPaste: 'paste',
  topScroll: 'scroll',
  topSelectionChange: 'selectionchange',
  topTextInput: 'textInput',
  topTouchCancel: 'touchcancel',
  topTouchEnd: 'touchend',
  topTouchMove: 'touchmove',
  topTouchStart: 'touchstart',
  topWheel: 'wheel'
};

/**
 * To ensure no conflicts with other potential React instances on the page
 */
var topListenersIDKey = "_reactListenersID" + String(Math.random()).slice(2);

function getListeningForDocument(mountAt) {
  // In IE8, `mountAt` is a host object and doesn't have `hasOwnProperty`
  // directly.
  if (!Object.prototype.hasOwnProperty.call(mountAt, topListenersIDKey)) {
    mountAt[topListenersIDKey] = reactTopListenersCounter++;
    alreadyListeningTo[mountAt[topListenersIDKey]] = {};
  }
  return alreadyListeningTo[mountAt[topListenersIDKey]];
}

/**
 * `ReactBrowserEventEmitter` is used to attach top-level event listeners. For
 * example:
 *
 *   ReactBrowserEventEmitter.putListener('myID', 'onClick', myFunction);
 *
 * This would allocate a "registration" of `('onClick', myFunction)` on 'myID'.
 *
 * @internal
 */
var ReactBrowserEventEmitter = merge(ReactEventEmitterMixin, {

  /**
   * Injectable event backend
   */
  ReactEventListener: null,

  injection: {
    /**
     * @param {object} ReactEventListener
     */
    injectReactEventListener: function(ReactEventListener) {
      ReactEventListener.setHandleTopLevel(
        ReactBrowserEventEmitter.handleTopLevel
      );
      ReactBrowserEventEmitter.ReactEventListener = ReactEventListener;
    }
  },

  /**
   * Sets whether or not any created callbacks should be enabled.
   *
   * @param {boolean} enabled True if callbacks should be enabled.
   */
  setEnabled: function(enabled) {
    if (ReactBrowserEventEmitter.ReactEventListener) {
      ReactBrowserEventEmitter.ReactEventListener.setEnabled(enabled);
    }
  },

  /**
   * @return {boolean} True if callbacks are enabled.
   */
  isEnabled: function() {
    return !!(
      ReactBrowserEventEmitter.ReactEventListener &&
      ReactBrowserEventEmitter.ReactEventListener.isEnabled()
    );
  },

  /**
   * We listen for bubbled touch events on the document object.
   *
   * Firefox v8.01 (and possibly others) exhibited strange behavior when
   * mounting `onmousemove` events at some node that was not the document
   * element. The symptoms were that if your mouse is not moving over something
   * contained within that mount point (for example on the background) the
   * top-level listeners for `onmousemove` won't be called. However, if you
   * register the `mousemove` on the document object, then it will of course
   * catch all `mousemove`s. This along with iOS quirks, justifies restricting
   * top-level listeners to the document object only, at least for these
   * movement types of events and possibly all events.
   *
   * @see http://www.quirksmode.org/blog/archives/2010/09/click_event_del.html
   *
   * Also, `keyup`/`keypress`/`keydown` do not bubble to the window on IE, but
   * they bubble to document.
   *
   * @param {string} registrationName Name of listener (e.g. `onClick`).
   * @param {object} contentDocumentHandle Document which owns the container
   */
  listenTo: function(registrationName, contentDocumentHandle) {
    var mountAt = contentDocumentHandle;
    var isListening = getListeningForDocument(mountAt);
    var dependencies = EventPluginRegistry.
      registrationNameDependencies[registrationName];

    var topLevelTypes = EventConstants.topLevelTypes;
    for (var i = 0, l = dependencies.length; i < l; i++) {
      var dependency = dependencies[i];
      if (!(
            isListening.hasOwnProperty(dependency) &&
            isListening[dependency]
          )) {
        if (dependency === topLevelTypes.topWheel) {
          if (isEventSupported('wheel')) {
            ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(
              topLevelTypes.topWheel,
              'wheel',
              mountAt
            );
          } else if (isEventSupported('mousewheel')) {
            ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(
              topLevelTypes.topWheel,
              'mousewheel',
              mountAt
            );
          } else {
            // Firefox needs to capture a different mouse scroll event.
            // @see http://www.quirksmode.org/dom/events/tests/scroll.html
            ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(
              topLevelTypes.topWheel,
              'DOMMouseScroll',
              mountAt
            );
          }
        } else if (dependency === topLevelTypes.topScroll) {

          if (isEventSupported('scroll', true)) {
            ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent(
              topLevelTypes.topScroll,
              'scroll',
              mountAt
            );
          } else {
            ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(
              topLevelTypes.topScroll,
              'scroll',
              ReactBrowserEventEmitter.ReactEventListener.WINDOW_HANDLE
            );
          }
        } else if (dependency === topLevelTypes.topFocus ||
            dependency === topLevelTypes.topBlur) {

          if (isEventSupported('focus', true)) {
            ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent(
              topLevelTypes.topFocus,
              'focus',
              mountAt
            );
            ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent(
              topLevelTypes.topBlur,
              'blur',
              mountAt
            );
          } else if (isEventSupported('focusin')) {
            // IE has `focusin` and `focusout` events which bubble.
            // @see http://www.quirksmode.org/blog/archives/2008/04/delegating_the.html
            ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(
              topLevelTypes.topFocus,
              'focusin',
              mountAt
            );
            ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(
              topLevelTypes.topBlur,
              'focusout',
              mountAt
            );
          }

          // to make sure blur and focus event listeners are only attached once
          isListening[topLevelTypes.topBlur] = true;
          isListening[topLevelTypes.topFocus] = true;
        } else if (topEventMapping.hasOwnProperty(dependency)) {
          ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(
            dependency,
            topEventMapping[dependency],
            mountAt
          );
        }

        isListening[dependency] = true;
      }
    }
  },

  trapBubbledEvent: function(topLevelType, handlerBaseName, handle) {
    return ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(
      topLevelType,
      handlerBaseName,
      handle
    );
  },

  trapCapturedEvent: function(topLevelType, handlerBaseName, handle) {
    return ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent(
      topLevelType,
      handlerBaseName,
      handle
    );
  },

  /**
   * Listens to window scroll and resize events. We cache scroll values so that
   * application code can access them without triggering reflows.
   *
   * NOTE: Scroll events do not bubble.
   *
   * @see http://www.quirksmode.org/dom/events/scroll.html
   */
  ensureScrollValueMonitoring: function(){
    if (!isMonitoringScrollValue) {
      var refresh = ViewportMetrics.refreshScrollValues;
      ReactBrowserEventEmitter.ReactEventListener.monitorScrollValue(refresh);
      isMonitoringScrollValue = true;
    }
  },

  eventNameDispatchConfigs: EventPluginHub.eventNameDispatchConfigs,

  registrationNameModules: EventPluginHub.registrationNameModules,

  putListener: EventPluginHub.putListener,

  getListener: EventPluginHub.getListener,

  deleteListener: EventPluginHub.deleteListener,

  deleteAllListeners: EventPluginHub.deleteAllListeners

});

module.exports = ReactBrowserEventEmitter;

},{"./EventConstants":16,"./EventPluginHub":18,"./EventPluginRegistry":19,"./ReactEventEmitterMixin":60,"./ViewportMetrics":105,"./isEventSupported":135,"./merge":144}],32:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @typechecks
 * @providesModule ReactCSSTransitionGroup
 */



var React = _dereq_("./React");

var ReactTransitionGroup = _dereq_("./ReactTransitionGroup");
var ReactCSSTransitionGroupChild = _dereq_("./ReactCSSTransitionGroupChild");

var ReactCSSTransitionGroup = React.createClass({
  displayName: 'ReactCSSTransitionGroup',

  propTypes: {
    transitionName: React.PropTypes.string.isRequired,
    transitionEnter: React.PropTypes.bool,
    transitionLeave: React.PropTypes.bool
  },

  getDefaultProps: function() {
    return {
      transitionEnter: true,
      transitionLeave: true
    };
  },

  _wrapChild: function(child) {
    // We need to provide this childFactory so that
    // ReactCSSTransitionGroupChild can receive updates to name, enter, and
    // leave while it is leaving.
    return ReactCSSTransitionGroupChild(
      {
        name: this.props.transitionName,
        enter: this.props.transitionEnter,
        leave: this.props.transitionLeave
      },
      child
    );
  },

  render: function() {
    return this.transferPropsTo(
      ReactTransitionGroup(
        {childFactory: this._wrapChild},
        this.props.children
      )
    );
  }
});

module.exports = ReactCSSTransitionGroup;

},{"./React":29,"./ReactCSSTransitionGroupChild":33,"./ReactTransitionGroup":86}],33:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @typechecks
 * @providesModule ReactCSSTransitionGroupChild
 */



var React = _dereq_("./React");

var CSSCore = _dereq_("./CSSCore");
var ReactTransitionEvents = _dereq_("./ReactTransitionEvents");

var onlyChild = _dereq_("./onlyChild");

// We don't remove the element from the DOM until we receive an animationend or
// transitionend event. If the user screws up and forgets to add an animation
// their node will be stuck in the DOM forever, so we detect if an animation
// does not start and if it doesn't, we just call the end listener immediately.
var TICK = 17;
var NO_EVENT_TIMEOUT = 5000;

var noEventListener = null;


if ("production" !== "development") {
  noEventListener = function() {
    console.warn(
      'transition(): tried to perform an animation without ' +
      'an animationend or transitionend event after timeout (' +
      NO_EVENT_TIMEOUT + 'ms). You should either disable this ' +
      'transition in JS or add a CSS animation/transition.'
    );
  };
}

var ReactCSSTransitionGroupChild = React.createClass({
  displayName: 'ReactCSSTransitionGroupChild',

  transition: function(animationType, finishCallback) {
    var node = this.getDOMNode();
    var className = this.props.name + '-' + animationType;
    var activeClassName = className + '-active';
    var noEventTimeout = null;

    var endListener = function() {
      if ("production" !== "development") {
        clearTimeout(noEventTimeout);
      }

      CSSCore.removeClass(node, className);
      CSSCore.removeClass(node, activeClassName);

      ReactTransitionEvents.removeEndEventListener(node, endListener);

      // Usually this optional callback is used for informing an owner of
      // a leave animation and telling it to remove the child.
      finishCallback && finishCallback();
    };

    ReactTransitionEvents.addEndEventListener(node, endListener);

    CSSCore.addClass(node, className);

    // Need to do this to actually trigger a transition.
    this.queueClass(activeClassName);

    if ("production" !== "development") {
      noEventTimeout = setTimeout(noEventListener, NO_EVENT_TIMEOUT);
    }
  },

  queueClass: function(className) {
    this.classNameQueue.push(className);

    if (!this.timeout) {
      this.timeout = setTimeout(this.flushClassNameQueue, TICK);
    }
  },

  flushClassNameQueue: function() {
    if (this.isMounted()) {
      this.classNameQueue.forEach(
        CSSCore.addClass.bind(CSSCore, this.getDOMNode())
      );
    }
    this.classNameQueue.length = 0;
    this.timeout = null;
  },

  componentWillMount: function() {
    this.classNameQueue = [];
  },

  componentWillUnmount: function() {
    if (this.timeout) {
      clearTimeout(this.timeout);
    }
  },

  componentWillEnter: function(done) {
    if (this.props.enter) {
      this.transition('enter', done);
    } else {
      done();
    }
  },

  componentWillLeave: function(done) {
    if (this.props.leave) {
      this.transition('leave', done);
    } else {
      done();
    }
  },

  render: function() {
    return onlyChild(this.props.children);
  }
});

module.exports = ReactCSSTransitionGroupChild;

},{"./CSSCore":3,"./React":29,"./ReactTransitionEvents":85,"./onlyChild":149}],34:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactChildren
 */



var PooledClass = _dereq_("./PooledClass");

var traverseAllChildren = _dereq_("./traverseAllChildren");
var warning = _dereq_("./warning");

var twoArgumentPooler = PooledClass.twoArgumentPooler;
var threeArgumentPooler = PooledClass.threeArgumentPooler;

/**
 * PooledClass representing the bookkeeping associated with performing a child
 * traversal. Allows avoiding binding callbacks.
 *
 * @constructor ForEachBookKeeping
 * @param {!function} forEachFunction Function to perform traversal with.
 * @param {?*} forEachContext Context to perform context with.
 */
function ForEachBookKeeping(forEachFunction, forEachContext) {
  this.forEachFunction = forEachFunction;
  this.forEachContext = forEachContext;
}
PooledClass.addPoolingTo(ForEachBookKeeping, twoArgumentPooler);

function forEachSingleChild(traverseContext, child, name, i) {
  var forEachBookKeeping = traverseContext;
  forEachBookKeeping.forEachFunction.call(
    forEachBookKeeping.forEachContext, child, i);
}

/**
 * Iterates through children that are typically specified as `props.children`.
 *
 * The provided forEachFunc(child, index) will be called for each
 * leaf child.
 *
 * @param {?*} children Children tree container.
 * @param {function(*, int)} forEachFunc.
 * @param {*} forEachContext Context for forEachContext.
 */
function forEachChildren(children, forEachFunc, forEachContext) {
  if (children == null) {
    return children;
  }

  var traverseContext =
    ForEachBookKeeping.getPooled(forEachFunc, forEachContext);
  traverseAllChildren(children, forEachSingleChild, traverseContext);
  ForEachBookKeeping.release(traverseContext);
}

/**
 * PooledClass representing the bookkeeping associated with performing a child
 * mapping. Allows avoiding binding callbacks.
 *
 * @constructor MapBookKeeping
 * @param {!*} mapResult Object containing the ordered map of results.
 * @param {!function} mapFunction Function to perform mapping with.
 * @param {?*} mapContext Context to perform mapping with.
 */
function MapBookKeeping(mapResult, mapFunction, mapContext) {
  this.mapResult = mapResult;
  this.mapFunction = mapFunction;
  this.mapContext = mapContext;
}
PooledClass.addPoolingTo(MapBookKeeping, threeArgumentPooler);

function mapSingleChildIntoContext(traverseContext, child, name, i) {
  var mapBookKeeping = traverseContext;
  var mapResult = mapBookKeeping.mapResult;

  var keyUnique = !mapResult.hasOwnProperty(name);
  ("production" !== "development" ? warning(
    keyUnique,
    'ReactChildren.map(...): Encountered two children with the same key, ' +
    '`%s`. Child keys must be unique; when two children share a key, only ' +
    'the first child will be used.',
    name
  ) : null);

  if (keyUnique) {
    var mappedChild =
      mapBookKeeping.mapFunction.call(mapBookKeeping.mapContext, child, i);
    mapResult[name] = mappedChild;
  }
}

/**
 * Maps children that are typically specified as `props.children`.
 *
 * The provided mapFunction(child, key, index) will be called for each
 * leaf child.
 *
 * TODO: This may likely break any calls to `ReactChildren.map` that were
 * previously relying on the fact that we guarded against null children.
 *
 * @param {?*} children Children tree container.
 * @param {function(*, int)} mapFunction.
 * @param {*} mapContext Context for mapFunction.
 * @return {object} Object containing the ordered map of results.
 */
function mapChildren(children, func, context) {
  if (children == null) {
    return children;
  }

  var mapResult = {};
  var traverseContext = MapBookKeeping.getPooled(mapResult, func, context);
  traverseAllChildren(children, mapSingleChildIntoContext, traverseContext);
  MapBookKeeping.release(traverseContext);
  return mapResult;
}

function forEachSingleChildDummy(traverseContext, child, name, i) {
  return null;
}

/**
 * Count the number of children that are typically specified as
 * `props.children`.
 *
 * @param {?*} children Children tree container.
 * @return {number} The number of children.
 */
function countChildren(children, context) {
  return traverseAllChildren(children, forEachSingleChildDummy, null);
}

var ReactChildren = {
  forEach: forEachChildren,
  map: mapChildren,
  count: countChildren
};

module.exports = ReactChildren;

},{"./PooledClass":28,"./traverseAllChildren":156,"./warning":158}],35:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactComponent
 */



var ReactDescriptor = _dereq_("./ReactDescriptor");
var ReactOwner = _dereq_("./ReactOwner");
var ReactUpdates = _dereq_("./ReactUpdates");

var invariant = _dereq_("./invariant");
var keyMirror = _dereq_("./keyMirror");
var merge = _dereq_("./merge");

/**
 * Every React component is in one of these life cycles.
 */
var ComponentLifeCycle = keyMirror({
  /**
   * Mounted components have a DOM node representation and are capable of
   * receiving new props.
   */
  MOUNTED: null,
  /**
   * Unmounted components are inactive and cannot receive new props.
   */
  UNMOUNTED: null
});

var injected = false;

/**
 * Optionally injectable environment dependent cleanup hook. (server vs.
 * browser etc). Example: A browser system caches DOM nodes based on component
 * ID and must remove that cache entry when this instance is unmounted.
 *
 * @private
 */
var unmountIDFromEnvironment = null;

/**
 * The "image" of a component tree, is the platform specific (typically
 * serialized) data that represents a tree of lower level UI building blocks.
 * On the web, this "image" is HTML markup which describes a construction of
 * low level `div` and `span` nodes. Other platforms may have different
 * encoding of this "image". This must be injected.
 *
 * @private
 */
var mountImageIntoNode = null;

/**
 * Components are the basic units of composition in React.
 *
 * Every component accepts a set of keyed input parameters known as "props" that
 * are initialized by the constructor. Once a component is mounted, the props
 * can be mutated using `setProps` or `replaceProps`.
 *
 * Every component is capable of the following operations:
 *
 *   `mountComponent`
 *     Initializes the component, renders markup, and registers event listeners.
 *
 *   `receiveComponent`
 *     Updates the rendered DOM nodes to match the given component.
 *
 *   `unmountComponent`
 *     Releases any resources allocated by this component.
 *
 * Components can also be "owned" by other components. Being owned by another
 * component means being constructed by that component. This is different from
 * being the child of a component, which means having a DOM representation that
 * is a child of the DOM representation of that component.
 *
 * @class ReactComponent
 */
var ReactComponent = {

  injection: {
    injectEnvironment: function(ReactComponentEnvironment) {
      ("production" !== "development" ? invariant(
        !injected,
        'ReactComponent: injectEnvironment() can only be called once.'
      ) : invariant(!injected));
      mountImageIntoNode = ReactComponentEnvironment.mountImageIntoNode;
      unmountIDFromEnvironment =
        ReactComponentEnvironment.unmountIDFromEnvironment;
      ReactComponent.BackendIDOperations =
        ReactComponentEnvironment.BackendIDOperations;
      injected = true;
    }
  },

  /**
   * @internal
   */
  LifeCycle: ComponentLifeCycle,

  /**
   * Injected module that provides ability to mutate individual properties.
   * Injected into the base class because many different subclasses need access
   * to this.
   *
   * @internal
   */
  BackendIDOperations: null,

  /**
   * Base functionality for every ReactComponent constructor. Mixed into the
   * `ReactComponent` prototype, but exposed statically for easy access.
   *
   * @lends {ReactComponent.prototype}
   */
  Mixin: {

    /**
     * Checks whether or not this component is mounted.
     *
     * @return {boolean} True if mounted, false otherwise.
     * @final
     * @protected
     */
    isMounted: function() {
      return this._lifeCycleState === ComponentLifeCycle.MOUNTED;
    },

    /**
     * Sets a subset of the props.
     *
     * @param {object} partialProps Subset of the next props.
     * @param {?function} callback Called after props are updated.
     * @final
     * @public
     */
    setProps: function(partialProps, callback) {
      // Merge with the pending descriptor if it exists, otherwise with existing
      // descriptor props.
      var descriptor = this._pendingDescriptor || this._descriptor;
      this.replaceProps(
        merge(descriptor.props, partialProps),
        callback
      );
    },

    /**
     * Replaces all of the props.
     *
     * @param {object} props New props.
     * @param {?function} callback Called after props are updated.
     * @final
     * @public
     */
    replaceProps: function(props, callback) {
      ("production" !== "development" ? invariant(
        this.isMounted(),
        'replaceProps(...): Can only update a mounted component.'
      ) : invariant(this.isMounted()));
      ("production" !== "development" ? invariant(
        this._mountDepth === 0,
        'replaceProps(...): You called `setProps` or `replaceProps` on a ' +
        'component with a parent. This is an anti-pattern since props will ' +
        'get reactively updated when rendered. Instead, change the owner\'s ' +
        '`render` method to pass the correct value as props to the component ' +
        'where it is created.'
      ) : invariant(this._mountDepth === 0));
      // This is a deoptimized path. We optimize for always having a descriptor.
      // This creates an extra internal descriptor.
      this._pendingDescriptor = ReactDescriptor.cloneAndReplaceProps(
        this._pendingDescriptor || this._descriptor,
        props
      );
      ReactUpdates.enqueueUpdate(this, callback);
    },

    /**
     * Schedule a partial update to the props. Only used for internal testing.
     *
     * @param {object} partialProps Subset of the next props.
     * @param {?function} callback Called after props are updated.
     * @final
     * @internal
     */
    _setPropsInternal: function(partialProps, callback) {
      // This is a deoptimized path. We optimize for always having a descriptor.
      // This creates an extra internal descriptor.
      var descriptor = this._pendingDescriptor || this._descriptor;
      this._pendingDescriptor = ReactDescriptor.cloneAndReplaceProps(
        descriptor,
        merge(descriptor.props, partialProps)
      );
      ReactUpdates.enqueueUpdate(this, callback);
    },

    /**
     * Base constructor for all React components.
     *
     * Subclasses that override this method should make sure to invoke
     * `ReactComponent.Mixin.construct.call(this, ...)`.
     *
     * @param {ReactDescriptor} descriptor
     * @internal
     */
    construct: function(descriptor) {
      // This is the public exposed props object after it has been processed
      // with default props. The descriptor's props represents the true internal
      // state of the props.
      this.props = descriptor.props;
      // Record the component responsible for creating this component.
      // This is accessible through the descriptor but we maintain an extra
      // field for compatibility with devtools and as a way to make an
      // incremental update. TODO: Consider deprecating this field.
      this._owner = descriptor._owner;

      // All components start unmounted.
      this._lifeCycleState = ComponentLifeCycle.UNMOUNTED;

      // See ReactUpdates.
      this._pendingCallbacks = null;

      // We keep the old descriptor and a reference to the pending descriptor
      // to track updates.
      this._descriptor = descriptor;
      this._pendingDescriptor = null;
    },

    /**
     * Initializes the component, renders markup, and registers event listeners.
     *
     * NOTE: This does not insert any nodes into the DOM.
     *
     * Subclasses that override this method should make sure to invoke
     * `ReactComponent.Mixin.mountComponent.call(this, ...)`.
     *
     * @param {string} rootID DOM ID of the root node.
     * @param {ReactReconcileTransaction|ReactServerRenderingTransaction} transaction
     * @param {number} mountDepth number of components in the owner hierarchy.
     * @return {?string} Rendered markup to be inserted into the DOM.
     * @internal
     */
    mountComponent: function(rootID, transaction, mountDepth) {
      ("production" !== "development" ? invariant(
        !this.isMounted(),
        'mountComponent(%s, ...): Can only mount an unmounted component. ' +
        'Make sure to avoid storing components between renders or reusing a ' +
        'single component instance in multiple places.',
        rootID
      ) : invariant(!this.isMounted()));
      var props = this._descriptor.props;
      if (props.ref != null) {
        var owner = this._descriptor._owner;
        ReactOwner.addComponentAsRefTo(this, props.ref, owner);
      }
      this._rootNodeID = rootID;
      this._lifeCycleState = ComponentLifeCycle.MOUNTED;
      this._mountDepth = mountDepth;
      // Effectively: return '';
    },

    /**
     * Releases any resources allocated by `mountComponent`.
     *
     * NOTE: This does not remove any nodes from the DOM.
     *
     * Subclasses that override this method should make sure to invoke
     * `ReactComponent.Mixin.unmountComponent.call(this)`.
     *
     * @internal
     */
    unmountComponent: function() {
      ("production" !== "development" ? invariant(
        this.isMounted(),
        'unmountComponent(): Can only unmount a mounted component.'
      ) : invariant(this.isMounted()));
      var props = this.props;
      if (props.ref != null) {
        ReactOwner.removeComponentAsRefFrom(this, props.ref, this._owner);
      }
      unmountIDFromEnvironment(this._rootNodeID);
      this._rootNodeID = null;
      this._lifeCycleState = ComponentLifeCycle.UNMOUNTED;
    },

    /**
     * Given a new instance of this component, updates the rendered DOM nodes
     * as if that instance was rendered instead.
     *
     * Subclasses that override this method should make sure to invoke
     * `ReactComponent.Mixin.receiveComponent.call(this, ...)`.
     *
     * @param {object} nextComponent Next set of properties.
     * @param {ReactReconcileTransaction} transaction
     * @internal
     */
    receiveComponent: function(nextDescriptor, transaction) {
      ("production" !== "development" ? invariant(
        this.isMounted(),
        'receiveComponent(...): Can only update a mounted component.'
      ) : invariant(this.isMounted()));
      this._pendingDescriptor = nextDescriptor;
      this.performUpdateIfNecessary(transaction);
    },

    /**
     * If `_pendingDescriptor` is set, update the component.
     *
     * @param {ReactReconcileTransaction} transaction
     * @internal
     */
    performUpdateIfNecessary: function(transaction) {
      if (this._pendingDescriptor == null) {
        return;
      }
      var prevDescriptor = this._descriptor;
      var nextDescriptor = this._pendingDescriptor;
      this._descriptor = nextDescriptor;
      this.props = nextDescriptor.props;
      this._owner = nextDescriptor._owner;
      this._pendingDescriptor = null;
      this.updateComponent(transaction, prevDescriptor);
    },

    /**
     * Updates the component's currently mounted representation.
     *
     * @param {ReactReconcileTransaction} transaction
     * @param {object} prevDescriptor
     * @internal
     */
    updateComponent: function(transaction, prevDescriptor) {
      var nextDescriptor = this._descriptor;

      // If either the owner or a `ref` has changed, make sure the newest owner
      // has stored a reference to `this`, and the previous owner (if different)
      // has forgotten the reference to `this`. We use the descriptor instead
      // of the public this.props because the post processing cannot determine
      // a ref. The ref conceptually lives on the descriptor.

      // TODO: Should this even be possible? The owner cannot change because
      // it's forbidden by shouldUpdateReactComponent. The ref can change
      // if you swap the keys of but not the refs. Reconsider where this check
      // is made. It probably belongs where the key checking and
      // instantiateReactComponent is done.

      if (nextDescriptor._owner !== prevDescriptor._owner ||
          nextDescriptor.props.ref !== prevDescriptor.props.ref) {
        if (prevDescriptor.props.ref != null) {
          ReactOwner.removeComponentAsRefFrom(
            this, prevDescriptor.props.ref, prevDescriptor._owner
          );
        }
        // Correct, even if the owner is the same, and only the ref has changed.
        if (nextDescriptor.props.ref != null) {
          ReactOwner.addComponentAsRefTo(
            this,
            nextDescriptor.props.ref,
            nextDescriptor._owner
          );
        }
      }
    },

    /**
     * Mounts this component and inserts it into the DOM.
     *
     * @param {string} rootID DOM ID of the root node.
     * @param {DOMElement} container DOM element to mount into.
     * @param {boolean} shouldReuseMarkup If true, do not insert markup
     * @final
     * @internal
     * @see {ReactMount.renderComponent}
     */
    mountComponentIntoNode: function(rootID, container, shouldReuseMarkup) {
      var transaction = ReactUpdates.ReactReconcileTransaction.getPooled();
      transaction.perform(
        this._mountComponentIntoNode,
        this,
        rootID,
        container,
        transaction,
        shouldReuseMarkup
      );
      ReactUpdates.ReactReconcileTransaction.release(transaction);
    },

    /**
     * @param {string} rootID DOM ID of the root node.
     * @param {DOMElement} container DOM element to mount into.
     * @param {ReactReconcileTransaction} transaction
     * @param {boolean} shouldReuseMarkup If true, do not insert markup
     * @final
     * @private
     */
    _mountComponentIntoNode: function(
        rootID,
        container,
        transaction,
        shouldReuseMarkup) {
      var markup = this.mountComponent(rootID, transaction, 0);
      mountImageIntoNode(markup, container, shouldReuseMarkup);
    },

    /**
     * Checks if this component is owned by the supplied `owner` component.
     *
     * @param {ReactComponent} owner Component to check.
     * @return {boolean} True if `owners` owns this component.
     * @final
     * @internal
     */
    isOwnedBy: function(owner) {
      return this._owner === owner;
    },

    /**
     * Gets another component, that shares the same owner as this one, by ref.
     *
     * @param {string} ref of a sibling Component.
     * @return {?ReactComponent} the actual sibling Component.
     * @final
     * @internal
     */
    getSiblingByRef: function(ref) {
      var owner = this._owner;
      if (!owner || !owner.refs) {
        return null;
      }
      return owner.refs[ref];
    }
  }
};

module.exports = ReactComponent;

},{"./ReactDescriptor":56,"./ReactOwner":70,"./ReactUpdates":87,"./invariant":134,"./keyMirror":140,"./merge":144}],36:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactComponentBrowserEnvironment
 */

/*jslint evil: true */



var ReactDOMIDOperations = _dereq_("./ReactDOMIDOperations");
var ReactMarkupChecksum = _dereq_("./ReactMarkupChecksum");
var ReactMount = _dereq_("./ReactMount");
var ReactPerf = _dereq_("./ReactPerf");
var ReactReconcileTransaction = _dereq_("./ReactReconcileTransaction");

var getReactRootElementInContainer = _dereq_("./getReactRootElementInContainer");
var invariant = _dereq_("./invariant");
var setInnerHTML = _dereq_("./setInnerHTML");


var ELEMENT_NODE_TYPE = 1;
var DOC_NODE_TYPE = 9;


/**
 * Abstracts away all functionality of `ReactComponent` requires knowledge of
 * the browser context.
 */
var ReactComponentBrowserEnvironment = {
  ReactReconcileTransaction: ReactReconcileTransaction,

  BackendIDOperations: ReactDOMIDOperations,

  /**
   * If a particular environment requires that some resources be cleaned up,
   * specify this in the injected Mixin. In the DOM, we would likely want to
   * purge any cached node ID lookups.
   *
   * @private
   */
  unmountIDFromEnvironment: function(rootNodeID) {
    ReactMount.purgeID(rootNodeID);
  },

  /**
   * @param {string} markup Markup string to place into the DOM Element.
   * @param {DOMElement} container DOM Element to insert markup into.
   * @param {boolean} shouldReuseMarkup Should reuse the existing markup in the
   * container if possible.
   */
  mountImageIntoNode: ReactPerf.measure(
    'ReactComponentBrowserEnvironment',
    'mountImageIntoNode',
    function(markup, container, shouldReuseMarkup) {
      ("production" !== "development" ? invariant(
        container && (
          container.nodeType === ELEMENT_NODE_TYPE ||
            container.nodeType === DOC_NODE_TYPE
        ),
        'mountComponentIntoNode(...): Target container is not valid.'
      ) : invariant(container && (
        container.nodeType === ELEMENT_NODE_TYPE ||
          container.nodeType === DOC_NODE_TYPE
      )));

      if (shouldReuseMarkup) {
        if (ReactMarkupChecksum.canReuseMarkup(
          markup,
          getReactRootElementInContainer(container))) {
          return;
        } else {
          ("production" !== "development" ? invariant(
            container.nodeType !== DOC_NODE_TYPE,
            'You\'re trying to render a component to the document using ' +
            'server rendering but the checksum was invalid. This usually ' +
            'means you rendered a different component type or props on ' +
            'the client from the one on the server, or your render() ' +
            'methods are impure. React cannot handle this case due to ' +
            'cross-browser quirks by rendering at the document root. You ' +
            'should look for environment dependent code in your components ' +
            'and ensure the props are the same client and server side.'
          ) : invariant(container.nodeType !== DOC_NODE_TYPE));

          if ("production" !== "development") {
            console.warn(
              'React attempted to use reuse markup in a container but the ' +
              'checksum was invalid. This generally means that you are ' +
              'using server rendering and the markup generated on the ' +
              'server was not what the client was expecting. React injected ' +
              'new markup to compensate which works but you have lost many ' +
              'of the benefits of server rendering. Instead, figure out ' +
              'why the markup being generated is different on the client ' +
              'or server.'
            );
          }
        }
      }

      ("production" !== "development" ? invariant(
        container.nodeType !== DOC_NODE_TYPE,
        'You\'re trying to render a component to the document but ' +
          'you didn\'t use server rendering. We can\'t do this ' +
          'without using server rendering due to cross-browser quirks. ' +
          'See renderComponentToString() for server rendering.'
      ) : invariant(container.nodeType !== DOC_NODE_TYPE));

      setInnerHTML(container, markup);
    }
  )
};

module.exports = ReactComponentBrowserEnvironment;

},{"./ReactDOMIDOperations":45,"./ReactMarkupChecksum":66,"./ReactMount":67,"./ReactPerf":71,"./ReactReconcileTransaction":77,"./getReactRootElementInContainer":128,"./invariant":134,"./setInnerHTML":152}],37:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
* @providesModule ReactComponentWithPureRenderMixin
*/



var shallowEqual = _dereq_("./shallowEqual");

/**
 * If your React component's render function is "pure", e.g. it will render the
 * same result given the same props and state, provide this Mixin for a
 * considerable performance boost.
 *
 * Most React components have pure render functions.
 *
 * Example:
 *
 *   var ReactComponentWithPureRenderMixin =
 *     require('ReactComponentWithPureRenderMixin');
 *   React.createClass({
 *     mixins: [ReactComponentWithPureRenderMixin],
 *
 *     render: function() {
 *       return <div className={this.props.className}>foo</div>;
 *     }
 *   });
 *
 * Note: This only checks shallow equality for props and state. If these contain
 * complex data structures this mixin may have false-negatives for deeper
 * differences. Only mixin to components which have simple props and state, or
 * use `forceUpdate()` when you know deep data structures have changed.
 */
var ReactComponentWithPureRenderMixin = {
  shouldComponentUpdate: function(nextProps, nextState) {
    return !shallowEqual(this.props, nextProps) ||
           !shallowEqual(this.state, nextState);
  }
};

module.exports = ReactComponentWithPureRenderMixin;

},{"./shallowEqual":153}],38:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactCompositeComponent
 */



var ReactComponent = _dereq_("./ReactComponent");
var ReactContext = _dereq_("./ReactContext");
var ReactCurrentOwner = _dereq_("./ReactCurrentOwner");
var ReactDescriptor = _dereq_("./ReactDescriptor");
var ReactDescriptorValidator = _dereq_("./ReactDescriptorValidator");
var ReactEmptyComponent = _dereq_("./ReactEmptyComponent");
var ReactErrorUtils = _dereq_("./ReactErrorUtils");
var ReactOwner = _dereq_("./ReactOwner");
var ReactPerf = _dereq_("./ReactPerf");
var ReactPropTransferer = _dereq_("./ReactPropTransferer");
var ReactPropTypeLocations = _dereq_("./ReactPropTypeLocations");
var ReactPropTypeLocationNames = _dereq_("./ReactPropTypeLocationNames");
var ReactUpdates = _dereq_("./ReactUpdates");

var instantiateReactComponent = _dereq_("./instantiateReactComponent");
var invariant = _dereq_("./invariant");
var keyMirror = _dereq_("./keyMirror");
var merge = _dereq_("./merge");
var mixInto = _dereq_("./mixInto");
var monitorCodeUse = _dereq_("./monitorCodeUse");
var mapObject = _dereq_("./mapObject");
var shouldUpdateReactComponent = _dereq_("./shouldUpdateReactComponent");
var warning = _dereq_("./warning");

/**
 * Policies that describe methods in `ReactCompositeComponentInterface`.
 */
var SpecPolicy = keyMirror({
  /**
   * These methods may be defined only once by the class specification or mixin.
   */
  DEFINE_ONCE: null,
  /**
   * These methods may be defined by both the class specification and mixins.
   * Subsequent definitions will be chained. These methods must return void.
   */
  DEFINE_MANY: null,
  /**
   * These methods are overriding the base ReactCompositeComponent class.
   */
  OVERRIDE_BASE: null,
  /**
   * These methods are similar to DEFINE_MANY, except we assume they return
   * objects. We try to merge the keys of the return values of all the mixed in
   * functions. If there is a key conflict we throw.
   */
  DEFINE_MANY_MERGED: null
});


var injectedMixins = [];

/**
 * Composite components are higher-level components that compose other composite
 * or native components.
 *
 * To create a new type of `ReactCompositeComponent`, pass a specification of
 * your new class to `React.createClass`. The only requirement of your class
 * specification is that you implement a `render` method.
 *
 *   var MyComponent = React.createClass({
 *     render: function() {
 *       return <div>Hello World</div>;
 *     }
 *   });
 *
 * The class specification supports a specific protocol of methods that have
 * special meaning (e.g. `render`). See `ReactCompositeComponentInterface` for
 * more the comprehensive protocol. Any other properties and methods in the
 * class specification will available on the prototype.
 *
 * @interface ReactCompositeComponentInterface
 * @internal
 */
var ReactCompositeComponentInterface = {

  /**
   * An array of Mixin objects to include when defining your component.
   *
   * @type {array}
   * @optional
   */
  mixins: SpecPolicy.DEFINE_MANY,

  /**
   * An object containing properties and methods that should be defined on
   * the component's constructor instead of its prototype (static methods).
   *
   * @type {object}
   * @optional
   */
  statics: SpecPolicy.DEFINE_MANY,

  /**
   * Definition of prop types for this component.
   *
   * @type {object}
   * @optional
   */
  propTypes: SpecPolicy.DEFINE_MANY,

  /**
   * Definition of context types for this component.
   *
   * @type {object}
   * @optional
   */
  contextTypes: SpecPolicy.DEFINE_MANY,

  /**
   * Definition of context types this component sets for its children.
   *
   * @type {object}
   * @optional
   */
  childContextTypes: SpecPolicy.DEFINE_MANY,

  // ==== Definition methods ====

  /**
   * Invoked when the component is mounted. Values in the mapping will be set on
   * `this.props` if that prop is not specified (i.e. using an `in` check).
   *
   * This method is invoked before `getInitialState` and therefore cannot rely
   * on `this.state` or use `this.setState`.
   *
   * @return {object}
   * @optional
   */
  getDefaultProps: SpecPolicy.DEFINE_MANY_MERGED,

  /**
   * Invoked once before the component is mounted. The return value will be used
   * as the initial value of `this.state`.
   *
   *   getInitialState: function() {
   *     return {
   *       isOn: false,
   *       fooBaz: new BazFoo()
   *     }
   *   }
   *
   * @return {object}
   * @optional
   */
  getInitialState: SpecPolicy.DEFINE_MANY_MERGED,

  /**
   * @return {object}
   * @optional
   */
  getChildContext: SpecPolicy.DEFINE_MANY_MERGED,

  /**
   * Uses props from `this.props` and state from `this.state` to render the
   * structure of the component.
   *
   * No guarantees are made about when or how often this method is invoked, so
   * it must not have side effects.
   *
   *   render: function() {
   *     var name = this.props.name;
   *     return <div>Hello, {name}!</div>;
   *   }
   *
   * @return {ReactComponent}
   * @nosideeffects
   * @required
   */
  render: SpecPolicy.DEFINE_ONCE,



  // ==== Delegate methods ====

  /**
   * Invoked when the component is initially created and about to be mounted.
   * This may have side effects, but any external subscriptions or data created
   * by this method must be cleaned up in `componentWillUnmount`.
   *
   * @optional
   */
  componentWillMount: SpecPolicy.DEFINE_MANY,

  /**
   * Invoked when the component has been mounted and has a DOM representation.
   * However, there is no guarantee that the DOM node is in the document.
   *
   * Use this as an opportunity to operate on the DOM when the component has
   * been mounted (initialized and rendered) for the first time.
   *
   * @param {DOMElement} rootNode DOM element representing the component.
   * @optional
   */
  componentDidMount: SpecPolicy.DEFINE_MANY,

  /**
   * Invoked before the component receives new props.
   *
   * Use this as an opportunity to react to a prop transition by updating the
   * state using `this.setState`. Current props are accessed via `this.props`.
   *
   *   componentWillReceiveProps: function(nextProps, nextContext) {
   *     this.setState({
   *       likesIncreasing: nextProps.likeCount > this.props.likeCount
   *     });
   *   }
   *
   * NOTE: There is no equivalent `componentWillReceiveState`. An incoming prop
   * transition may cause a state change, but the opposite is not true. If you
   * need it, you are probably looking for `componentWillUpdate`.
   *
   * @param {object} nextProps
   * @optional
   */
  componentWillReceiveProps: SpecPolicy.DEFINE_MANY,

  /**
   * Invoked while deciding if the component should be updated as a result of
   * receiving new props, state and/or context.
   *
   * Use this as an opportunity to `return false` when you're certain that the
   * transition to the new props/state/context will not require a component
   * update.
   *
   *   shouldComponentUpdate: function(nextProps, nextState, nextContext) {
   *     return !equal(nextProps, this.props) ||
   *       !equal(nextState, this.state) ||
   *       !equal(nextContext, this.context);
   *   }
   *
   * @param {object} nextProps
   * @param {?object} nextState
   * @param {?object} nextContext
   * @return {boolean} True if the component should update.
   * @optional
   */
  shouldComponentUpdate: SpecPolicy.DEFINE_ONCE,

  /**
   * Invoked when the component is about to update due to a transition from
   * `this.props`, `this.state` and `this.context` to `nextProps`, `nextState`
   * and `nextContext`.
   *
   * Use this as an opportunity to perform preparation before an update occurs.
   *
   * NOTE: You **cannot** use `this.setState()` in this method.
   *
   * @param {object} nextProps
   * @param {?object} nextState
   * @param {?object} nextContext
   * @param {ReactReconcileTransaction} transaction
   * @optional
   */
  componentWillUpdate: SpecPolicy.DEFINE_MANY,

  /**
   * Invoked when the component's DOM representation has been updated.
   *
   * Use this as an opportunity to operate on the DOM when the component has
   * been updated.
   *
   * @param {object} prevProps
   * @param {?object} prevState
   * @param {?object} prevContext
   * @param {DOMElement} rootNode DOM element representing the component.
   * @optional
   */
  componentDidUpdate: SpecPolicy.DEFINE_MANY,

  /**
   * Invoked when the component is about to be removed from its parent and have
   * its DOM representation destroyed.
   *
   * Use this as an opportunity to deallocate any external resources.
   *
   * NOTE: There is no `componentDidUnmount` since your component will have been
   * destroyed by that point.
   *
   * @optional
   */
  componentWillUnmount: SpecPolicy.DEFINE_MANY,



  // ==== Advanced methods ====

  /**
   * Updates the component's currently mounted DOM representation.
   *
   * By default, this implements React's rendering and reconciliation algorithm.
   * Sophisticated clients may wish to override this.
   *
   * @param {ReactReconcileTransaction} transaction
   * @internal
   * @overridable
   */
  updateComponent: SpecPolicy.OVERRIDE_BASE

};

/**
 * Mapping from class specification keys to special processing functions.
 *
 * Although these are declared like instance properties in the specification
 * when defining classes using `React.createClass`, they are actually static
 * and are accessible on the constructor instead of the prototype. Despite
 * being static, they must be defined outside of the "statics" key under
 * which all other static methods are defined.
 */
var RESERVED_SPEC_KEYS = {
  displayName: function(Constructor, displayName) {
    Constructor.displayName = displayName;
  },
  mixins: function(Constructor, mixins) {
    if (mixins) {
      for (var i = 0; i < mixins.length; i++) {
        mixSpecIntoComponent(Constructor, mixins[i]);
      }
    }
  },
  childContextTypes: function(Constructor, childContextTypes) {
    validateTypeDef(
      Constructor,
      childContextTypes,
      ReactPropTypeLocations.childContext
    );
    Constructor.childContextTypes = merge(
      Constructor.childContextTypes,
      childContextTypes
    );
  },
  contextTypes: function(Constructor, contextTypes) {
    validateTypeDef(
      Constructor,
      contextTypes,
      ReactPropTypeLocations.context
    );
    Constructor.contextTypes = merge(Constructor.contextTypes, contextTypes);
  },
  /**
   * Special case getDefaultProps which should move into statics but requires
   * automatic merging.
   */
  getDefaultProps: function(Constructor, getDefaultProps) {
    if (Constructor.getDefaultProps) {
      Constructor.getDefaultProps = createMergedResultFunction(
        Constructor.getDefaultProps,
        getDefaultProps
      );
    } else {
      Constructor.getDefaultProps = getDefaultProps;
    }
  },
  propTypes: function(Constructor, propTypes) {
    validateTypeDef(
      Constructor,
      propTypes,
      ReactPropTypeLocations.prop
    );
    Constructor.propTypes = merge(Constructor.propTypes, propTypes);
  },
  statics: function(Constructor, statics) {
    mixStaticSpecIntoComponent(Constructor, statics);
  }
};

function getDeclarationErrorAddendum(component) {
  var owner = component._owner || null;
  if (owner && owner.constructor && owner.constructor.displayName) {
    return ' Check the render method of `' + owner.constructor.displayName +
      '`.';
  }
  return '';
}

function validateTypeDef(Constructor, typeDef, location) {
  for (var propName in typeDef) {
    if (typeDef.hasOwnProperty(propName)) {
      ("production" !== "development" ? invariant(
        typeof typeDef[propName] == 'function',
        '%s: %s type `%s` is invalid; it must be a function, usually from ' +
        'React.PropTypes.',
        Constructor.displayName || 'ReactCompositeComponent',
        ReactPropTypeLocationNames[location],
        propName
      ) : invariant(typeof typeDef[propName] == 'function'));
    }
  }
}

function validateMethodOverride(proto, name) {
  var specPolicy = ReactCompositeComponentInterface.hasOwnProperty(name) ?
    ReactCompositeComponentInterface[name] :
    null;

  // Disallow overriding of base class methods unless explicitly allowed.
  if (ReactCompositeComponentMixin.hasOwnProperty(name)) {
    ("production" !== "development" ? invariant(
      specPolicy === SpecPolicy.OVERRIDE_BASE,
      'ReactCompositeComponentInterface: You are attempting to override ' +
      '`%s` from your class specification. Ensure that your method names ' +
      'do not overlap with React methods.',
      name
    ) : invariant(specPolicy === SpecPolicy.OVERRIDE_BASE));
  }

  // Disallow defining methods more than once unless explicitly allowed.
  if (proto.hasOwnProperty(name)) {
    ("production" !== "development" ? invariant(
      specPolicy === SpecPolicy.DEFINE_MANY ||
      specPolicy === SpecPolicy.DEFINE_MANY_MERGED,
      'ReactCompositeComponentInterface: You are attempting to define ' +
      '`%s` on your component more than once. This conflict may be due ' +
      'to a mixin.',
      name
    ) : invariant(specPolicy === SpecPolicy.DEFINE_MANY ||
    specPolicy === SpecPolicy.DEFINE_MANY_MERGED));
  }
}

function validateLifeCycleOnReplaceState(instance) {
  var compositeLifeCycleState = instance._compositeLifeCycleState;
  ("production" !== "development" ? invariant(
    instance.isMounted() ||
      compositeLifeCycleState === CompositeLifeCycle.MOUNTING,
    'replaceState(...): Can only update a mounted or mounting component.'
  ) : invariant(instance.isMounted() ||
    compositeLifeCycleState === CompositeLifeCycle.MOUNTING));
  ("production" !== "development" ? invariant(compositeLifeCycleState !== CompositeLifeCycle.RECEIVING_STATE,
    'replaceState(...): Cannot update during an existing state transition ' +
    '(such as within `render`). This could potentially cause an infinite ' +
    'loop so it is forbidden.'
  ) : invariant(compositeLifeCycleState !== CompositeLifeCycle.RECEIVING_STATE));
  ("production" !== "development" ? invariant(compositeLifeCycleState !== CompositeLifeCycle.UNMOUNTING,
    'replaceState(...): Cannot update while unmounting component. This ' +
    'usually means you called setState() on an unmounted component.'
  ) : invariant(compositeLifeCycleState !== CompositeLifeCycle.UNMOUNTING));
}

/**
 * Custom version of `mixInto` which handles policy validation and reserved
 * specification keys when building `ReactCompositeComponent` classses.
 */
function mixSpecIntoComponent(Constructor, spec) {
  ("production" !== "development" ? invariant(
    !ReactDescriptor.isValidFactory(spec),
    'ReactCompositeComponent: You\'re attempting to ' +
    'use a component class as a mixin. Instead, just use a regular object.'
  ) : invariant(!ReactDescriptor.isValidFactory(spec)));
  ("production" !== "development" ? invariant(
    !ReactDescriptor.isValidDescriptor(spec),
    'ReactCompositeComponent: You\'re attempting to ' +
    'use a component as a mixin. Instead, just use a regular object.'
  ) : invariant(!ReactDescriptor.isValidDescriptor(spec)));

  var proto = Constructor.prototype;
  for (var name in spec) {
    var property = spec[name];
    if (!spec.hasOwnProperty(name)) {
      continue;
    }

    validateMethodOverride(proto, name);

    if (RESERVED_SPEC_KEYS.hasOwnProperty(name)) {
      RESERVED_SPEC_KEYS[name](Constructor, property);
    } else {
      // Setup methods on prototype:
      // The following member methods should not be automatically bound:
      // 1. Expected ReactCompositeComponent methods (in the "interface").
      // 2. Overridden methods (that were mixed in).
      var isCompositeComponentMethod =
        ReactCompositeComponentInterface.hasOwnProperty(name);
      var isAlreadyDefined = proto.hasOwnProperty(name);
      var markedDontBind = property && property.__reactDontBind;
      var isFunction = typeof property === 'function';
      var shouldAutoBind =
        isFunction &&
        !isCompositeComponentMethod &&
        !isAlreadyDefined &&
        !markedDontBind;

      if (shouldAutoBind) {
        if (!proto.__reactAutoBindMap) {
          proto.__reactAutoBindMap = {};
        }
        proto.__reactAutoBindMap[name] = property;
        proto[name] = property;
      } else {
        if (isAlreadyDefined) {
          var specPolicy = ReactCompositeComponentInterface[name];

          // These cases should already be caught by validateMethodOverride
          ("production" !== "development" ? invariant(
            isCompositeComponentMethod && (
              specPolicy === SpecPolicy.DEFINE_MANY_MERGED ||
              specPolicy === SpecPolicy.DEFINE_MANY
            ),
            'ReactCompositeComponent: Unexpected spec policy %s for key %s ' +
            'when mixing in component specs.',
            specPolicy,
            name
          ) : invariant(isCompositeComponentMethod && (
            specPolicy === SpecPolicy.DEFINE_MANY_MERGED ||
            specPolicy === SpecPolicy.DEFINE_MANY
          )));

          // For methods which are defined more than once, call the existing
          // methods before calling the new property, merging if appropriate.
          if (specPolicy === SpecPolicy.DEFINE_MANY_MERGED) {
            proto[name] = createMergedResultFunction(proto[name], property);
          } else if (specPolicy === SpecPolicy.DEFINE_MANY) {
            proto[name] = createChainedFunction(proto[name], property);
          }
        } else {
          proto[name] = property;
          if ("production" !== "development") {
            // Add verbose displayName to the function, which helps when looking
            // at profiling tools.
            if (typeof property === 'function' && spec.displayName) {
              proto[name].displayName = spec.displayName + '_' + name;
            }
          }
        }
      }
    }
  }
}

function mixStaticSpecIntoComponent(Constructor, statics) {
  if (!statics) {
    return;
  }
  for (var name in statics) {
    var property = statics[name];
    if (!statics.hasOwnProperty(name)) {
      continue;
    }

    var isInherited = name in Constructor;
    var result = property;
    if (isInherited) {
      var existingProperty = Constructor[name];
      var existingType = typeof existingProperty;
      var propertyType = typeof property;
      ("production" !== "development" ? invariant(
        existingType === 'function' && propertyType === 'function',
        'ReactCompositeComponent: You are attempting to define ' +
        '`%s` on your component more than once, but that is only supported ' +
        'for functions, which are chained together. This conflict may be ' +
        'due to a mixin.',
        name
      ) : invariant(existingType === 'function' && propertyType === 'function'));
      result = createChainedFunction(existingProperty, property);
    }
    Constructor[name] = result;
  }
}

/**
 * Merge two objects, but throw if both contain the same key.
 *
 * @param {object} one The first object, which is mutated.
 * @param {object} two The second object
 * @return {object} one after it has been mutated to contain everything in two.
 */
function mergeObjectsWithNoDuplicateKeys(one, two) {
  ("production" !== "development" ? invariant(
    one && two && typeof one === 'object' && typeof two === 'object',
    'mergeObjectsWithNoDuplicateKeys(): Cannot merge non-objects'
  ) : invariant(one && two && typeof one === 'object' && typeof two === 'object'));

  mapObject(two, function(value, key) {
    ("production" !== "development" ? invariant(
      one[key] === undefined,
      'mergeObjectsWithNoDuplicateKeys(): ' +
      'Tried to merge two objects with the same key: %s',
      key
    ) : invariant(one[key] === undefined));
    one[key] = value;
  });
  return one;
}

/**
 * Creates a function that invokes two functions and merges their return values.
 *
 * @param {function} one Function to invoke first.
 * @param {function} two Function to invoke second.
 * @return {function} Function that invokes the two argument functions.
 * @private
 */
function createMergedResultFunction(one, two) {
  return function mergedResult() {
    var a = one.apply(this, arguments);
    var b = two.apply(this, arguments);
    if (a == null) {
      return b;
    } else if (b == null) {
      return a;
    }
    return mergeObjectsWithNoDuplicateKeys(a, b);
  };
}

/**
 * Creates a function that invokes two functions and ignores their return vales.
 *
 * @param {function} one Function to invoke first.
 * @param {function} two Function to invoke second.
 * @return {function} Function that invokes the two argument functions.
 * @private
 */
function createChainedFunction(one, two) {
  return function chainedFunction() {
    one.apply(this, arguments);
    two.apply(this, arguments);
  };
}

/**
 * `ReactCompositeComponent` maintains an auxiliary life cycle state in
 * `this._compositeLifeCycleState` (which can be null).
 *
 * This is different from the life cycle state maintained by `ReactComponent` in
 * `this._lifeCycleState`. The following diagram shows how the states overlap in
 * time. There are times when the CompositeLifeCycle is null - at those times it
 * is only meaningful to look at ComponentLifeCycle alone.
 *
 * Top Row: ReactComponent.ComponentLifeCycle
 * Low Row: ReactComponent.CompositeLifeCycle
 *
 * +-------+------------------------------------------------------+--------+
 * |  UN   |                    MOUNTED                           |   UN   |
 * |MOUNTED|                                                      | MOUNTED|
 * +-------+------------------------------------------------------+--------+
 * |       ^--------+   +------+   +------+   +------+   +--------^        |
 * |       |        |   |      |   |      |   |      |   |        |        |
 * |    0--|MOUNTING|-0-|RECEIV|-0-|RECEIV|-0-|RECEIV|-0-|   UN   |--->0   |
 * |       |        |   |PROPS |   | PROPS|   | STATE|   |MOUNTING|        |
 * |       |        |   |      |   |      |   |      |   |        |        |
 * |       |        |   |      |   |      |   |      |   |        |        |
 * |       +--------+   +------+   +------+   +------+   +--------+        |
 * |       |                                                      |        |
 * +-------+------------------------------------------------------+--------+
 */
var CompositeLifeCycle = keyMirror({
  /**
   * Components in the process of being mounted respond to state changes
   * differently.
   */
  MOUNTING: null,
  /**
   * Components in the process of being unmounted are guarded against state
   * changes.
   */
  UNMOUNTING: null,
  /**
   * Components that are mounted and receiving new props respond to state
   * changes differently.
   */
  RECEIVING_PROPS: null,
  /**
   * Components that are mounted and receiving new state are guarded against
   * additional state changes.
   */
  RECEIVING_STATE: null
});

/**
 * @lends {ReactCompositeComponent.prototype}
 */
var ReactCompositeComponentMixin = {

  /**
   * Base constructor for all composite component.
   *
   * @param {ReactDescriptor} descriptor
   * @final
   * @internal
   */
  construct: function(descriptor) {
    // Children can be either an array or more than one argument
    ReactComponent.Mixin.construct.apply(this, arguments);
    ReactOwner.Mixin.construct.apply(this, arguments);

    this.state = null;
    this._pendingState = null;

    // This is the public post-processed context. The real context and pending
    // context lives on the descriptor.
    this.context = null;

    this._compositeLifeCycleState = null;
  },

  /**
   * Checks whether or not this composite component is mounted.
   * @return {boolean} True if mounted, false otherwise.
   * @protected
   * @final
   */
  isMounted: function() {
    return ReactComponent.Mixin.isMounted.call(this) &&
      this._compositeLifeCycleState !== CompositeLifeCycle.MOUNTING;
  },

  /**
   * Initializes the component, renders markup, and registers event listeners.
   *
   * @param {string} rootID DOM ID of the root node.
   * @param {ReactReconcileTransaction|ReactServerRenderingTransaction} transaction
   * @param {number} mountDepth number of components in the owner hierarchy
   * @return {?string} Rendered markup to be inserted into the DOM.
   * @final
   * @internal
   */
  mountComponent: ReactPerf.measure(
    'ReactCompositeComponent',
    'mountComponent',
    function(rootID, transaction, mountDepth) {
      ReactComponent.Mixin.mountComponent.call(
        this,
        rootID,
        transaction,
        mountDepth
      );
      this._compositeLifeCycleState = CompositeLifeCycle.MOUNTING;

      if (this.__reactAutoBindMap) {
        this._bindAutoBindMethods();
      }

      this.context = this._processContext(this._descriptor._context);
      this.props = this._processProps(this.props);

      this.state = this.getInitialState ? this.getInitialState() : null;
      ("production" !== "development" ? invariant(
        typeof this.state === 'object' && !Array.isArray(this.state),
        '%s.getInitialState(): must return an object or null',
        this.constructor.displayName || 'ReactCompositeComponent'
      ) : invariant(typeof this.state === 'object' && !Array.isArray(this.state)));

      this._pendingState = null;
      this._pendingForceUpdate = false;

      if (this.componentWillMount) {
        this.componentWillMount();
        // When mounting, calls to `setState` by `componentWillMount` will set
        // `this._pendingState` without triggering a re-render.
        if (this._pendingState) {
          this.state = this._pendingState;
          this._pendingState = null;
        }
      }

      this._renderedComponent = instantiateReactComponent(
        this._renderValidatedComponent()
      );

      // Done with mounting, `setState` will now trigger UI changes.
      this._compositeLifeCycleState = null;
      var markup = this._renderedComponent.mountComponent(
        rootID,
        transaction,
        mountDepth + 1
      );
      if (this.componentDidMount) {
        transaction.getReactMountReady().enqueue(this.componentDidMount, this);
      }
      return markup;
    }
  ),

  /**
   * Releases any resources allocated by `mountComponent`.
   *
   * @final
   * @internal
   */
  unmountComponent: function() {
    this._compositeLifeCycleState = CompositeLifeCycle.UNMOUNTING;
    if (this.componentWillUnmount) {
      this.componentWillUnmount();
    }
    this._compositeLifeCycleState = null;

    this._renderedComponent.unmountComponent();
    this._renderedComponent = null;

    ReactComponent.Mixin.unmountComponent.call(this);

    // Some existing components rely on this.props even after they've been
    // destroyed (in event handlers).
    // TODO: this.props = null;
    // TODO: this.state = null;
  },

  /**
   * Sets a subset of the state. Always use this or `replaceState` to mutate
   * state. You should treat `this.state` as immutable.
   *
   * There is no guarantee that `this.state` will be immediately updated, so
   * accessing `this.state` after calling this method may return the old value.
   *
   * There is no guarantee that calls to `setState` will run synchronously,
   * as they may eventually be batched together.  You can provide an optional
   * callback that will be executed when the call to setState is actually
   * completed.
   *
   * @param {object} partialState Next partial state to be merged with state.
   * @param {?function} callback Called after state is updated.
   * @final
   * @protected
   */
  setState: function(partialState, callback) {
    ("production" !== "development" ? invariant(
      typeof partialState === 'object' || partialState == null,
      'setState(...): takes an object of state variables to update.'
    ) : invariant(typeof partialState === 'object' || partialState == null));
    if ("production" !== "development"){
      ("production" !== "development" ? warning(
        partialState != null,
        'setState(...): You passed an undefined or null state object; ' +
        'instead, use forceUpdate().'
      ) : null);
    }
    // Merge with `_pendingState` if it exists, otherwise with existing state.
    this.replaceState(
      merge(this._pendingState || this.state, partialState),
      callback
    );
  },

  /**
   * Replaces all of the state. Always use this or `setState` to mutate state.
   * You should treat `this.state` as immutable.
   *
   * There is no guarantee that `this.state` will be immediately updated, so
   * accessing `this.state` after calling this method may return the old value.
   *
   * @param {object} completeState Next state.
   * @param {?function} callback Called after state is updated.
   * @final
   * @protected
   */
  replaceState: function(completeState, callback) {
    validateLifeCycleOnReplaceState(this);
    this._pendingState = completeState;
    if (this._compositeLifeCycleState !== CompositeLifeCycle.MOUNTING) {
      // If we're in a componentWillMount handler, don't enqueue a rerender
      // because ReactUpdates assumes we're in a browser context (which is wrong
      // for server rendering) and we're about to do a render anyway.
      // TODO: The callback here is ignored when setState is called from
      // componentWillMount. Either fix it or disallow doing so completely in
      // favor of getInitialState.
      ReactUpdates.enqueueUpdate(this, callback);
    }
  },

  /**
   * Filters the context object to only contain keys specified in
   * `contextTypes`, and asserts that they are valid.
   *
   * @param {object} context
   * @return {?object}
   * @private
   */
  _processContext: function(context) {
    var maskedContext = null;
    var contextTypes = this.constructor.contextTypes;
    if (contextTypes) {
      maskedContext = {};
      for (var contextName in contextTypes) {
        maskedContext[contextName] = context[contextName];
      }
      if ("production" !== "development") {
        this._checkPropTypes(
          contextTypes,
          maskedContext,
          ReactPropTypeLocations.context
        );
      }
    }
    return maskedContext;
  },

  /**
   * @param {object} currentContext
   * @return {object}
   * @private
   */
  _processChildContext: function(currentContext) {
    var childContext = this.getChildContext && this.getChildContext();
    var displayName = this.constructor.displayName || 'ReactCompositeComponent';
    if (childContext) {
      ("production" !== "development" ? invariant(
        typeof this.constructor.childContextTypes === 'object',
        '%s.getChildContext(): childContextTypes must be defined in order to ' +
        'use getChildContext().',
        displayName
      ) : invariant(typeof this.constructor.childContextTypes === 'object'));
      if ("production" !== "development") {
        this._checkPropTypes(
          this.constructor.childContextTypes,
          childContext,
          ReactPropTypeLocations.childContext
        );
      }
      for (var name in childContext) {
        ("production" !== "development" ? invariant(
          name in this.constructor.childContextTypes,
          '%s.getChildContext(): key "%s" is not defined in childContextTypes.',
          displayName,
          name
        ) : invariant(name in this.constructor.childContextTypes));
      }
      return merge(currentContext, childContext);
    }
    return currentContext;
  },

  /**
   * Processes props by setting default values for unspecified props and
   * asserting that the props are valid. Does not mutate its argument; returns
   * a new props object with defaults merged in.
   *
   * @param {object} newProps
   * @return {object}
   * @private
   */
  _processProps: function(newProps) {
    var defaultProps = this.constructor.defaultProps;
    var props;
    if (defaultProps) {
      props = merge(newProps);
      for (var propName in defaultProps) {
        if (typeof props[propName] === 'undefined') {
          props[propName] = defaultProps[propName];
        }
      }
    } else {
      props = newProps;
    }
    if ("production" !== "development") {
      var propTypes = this.constructor.propTypes;
      if (propTypes) {
        this._checkPropTypes(propTypes, props, ReactPropTypeLocations.prop);
      }
    }
    return props;
  },

  /**
   * Assert that the props are valid
   *
   * @param {object} propTypes Map of prop name to a ReactPropType
   * @param {object} props
   * @param {string} location e.g. "prop", "context", "child context"
   * @private
   */
  _checkPropTypes: function(propTypes, props, location) {
    // TODO: Stop validating prop types here and only use the descriptor
    // validation.
    var componentName = this.constructor.displayName;
    for (var propName in propTypes) {
      if (propTypes.hasOwnProperty(propName)) {
        var error =
          propTypes[propName](props, propName, componentName, location);
        if (error instanceof Error) {
          // We may want to extend this logic for similar errors in
          // renderComponent calls, so I'm abstracting it away into
          // a function to minimize refactoring in the future
          var addendum = getDeclarationErrorAddendum(this);
          ("production" !== "development" ? warning(false, error.message + addendum) : null);
        }
      }
    }
  },

  /**
   * If any of `_pendingDescriptor`, `_pendingState`, or `_pendingForceUpdate`
   * is set, update the component.
   *
   * @param {ReactReconcileTransaction} transaction
   * @internal
   */
  performUpdateIfNecessary: function(transaction) {
    var compositeLifeCycleState = this._compositeLifeCycleState;
    // Do not trigger a state transition if we are in the middle of mounting or
    // receiving props because both of those will already be doing this.
    if (compositeLifeCycleState === CompositeLifeCycle.MOUNTING ||
        compositeLifeCycleState === CompositeLifeCycle.RECEIVING_PROPS) {
      return;
    }

    if (this._pendingDescriptor == null &&
        this._pendingState == null &&
        !this._pendingForceUpdate) {
      return;
    }

    var nextContext = this.context;
    var nextProps = this.props;
    var nextDescriptor = this._descriptor;
    if (this._pendingDescriptor != null) {
      nextDescriptor = this._pendingDescriptor;
      nextContext = this._processContext(nextDescriptor._context);
      nextProps = this._processProps(nextDescriptor.props);
      this._pendingDescriptor = null;

      this._compositeLifeCycleState = CompositeLifeCycle.RECEIVING_PROPS;
      if (this.componentWillReceiveProps) {
        this.componentWillReceiveProps(nextProps, nextContext);
      }
    }

    this._compositeLifeCycleState = CompositeLifeCycle.RECEIVING_STATE;

    var nextState = this._pendingState || this.state;
    this._pendingState = null;

    try {
      var shouldUpdate =
        this._pendingForceUpdate ||
        !this.shouldComponentUpdate ||
        this.shouldComponentUpdate(nextProps, nextState, nextContext);

      if ("production" !== "development") {
        if (typeof shouldUpdate === "undefined") {
          console.warn(
            (this.constructor.displayName || 'ReactCompositeComponent') +
            '.shouldComponentUpdate(): Returned undefined instead of a ' +
            'boolean value. Make sure to return true or false.'
          );
        }
      }

      if (shouldUpdate) {
        this._pendingForceUpdate = false;
        // Will set `this.props`, `this.state` and `this.context`.
        this._performComponentUpdate(
          nextDescriptor,
          nextProps,
          nextState,
          nextContext,
          transaction
        );
      } else {
        // If it's determined that a component should not update, we still want
        // to set props and state.
        this._descriptor = nextDescriptor;
        this.props = nextProps;
        this.state = nextState;
        this.context = nextContext;

        // Owner cannot change because shouldUpdateReactComponent doesn't allow
        // it. TODO: Remove this._owner completely.
        this._owner = nextDescriptor._owner;
      }
    } finally {
      this._compositeLifeCycleState = null;
    }
  },

  /**
   * Merges new props and state, notifies delegate methods of update and
   * performs update.
   *
   * @param {ReactDescriptor} nextDescriptor Next descriptor
   * @param {object} nextProps Next public object to set as properties.
   * @param {?object} nextState Next object to set as state.
   * @param {?object} nextContext Next public object to set as context.
   * @param {ReactReconcileTransaction} transaction
   * @private
   */
  _performComponentUpdate: function(
    nextDescriptor,
    nextProps,
    nextState,
    nextContext,
    transaction
  ) {
    var prevDescriptor = this._descriptor;
    var prevProps = this.props;
    var prevState = this.state;
    var prevContext = this.context;

    if (this.componentWillUpdate) {
      this.componentWillUpdate(nextProps, nextState, nextContext);
    }

    this._descriptor = nextDescriptor;
    this.props = nextProps;
    this.state = nextState;
    this.context = nextContext;

    // Owner cannot change because shouldUpdateReactComponent doesn't allow
    // it. TODO: Remove this._owner completely.
    this._owner = nextDescriptor._owner;

    this.updateComponent(
      transaction,
      prevDescriptor
    );

    if (this.componentDidUpdate) {
      transaction.getReactMountReady().enqueue(
        this.componentDidUpdate.bind(this, prevProps, prevState, prevContext),
        this
      );
    }
  },

  receiveComponent: function(nextDescriptor, transaction) {
    if (nextDescriptor === this._descriptor &&
        nextDescriptor._owner != null) {
      // Since descriptors are immutable after the owner is rendered,
      // we can do a cheap identity compare here to determine if this is a
      // superfluous reconcile. It's possible for state to be mutable but such
      // change should trigger an update of the owner which would recreate
      // the descriptor. We explicitly check for the existence of an owner since
      // it's possible for a descriptor created outside a composite to be
      // deeply mutated and reused.
      return;
    }

    ReactComponent.Mixin.receiveComponent.call(
      this,
      nextDescriptor,
      transaction
    );
  },

  /**
   * Updates the component's currently mounted DOM representation.
   *
   * By default, this implements React's rendering and reconciliation algorithm.
   * Sophisticated clients may wish to override this.
   *
   * @param {ReactReconcileTransaction} transaction
   * @param {ReactDescriptor} prevDescriptor
   * @internal
   * @overridable
   */
  updateComponent: ReactPerf.measure(
    'ReactCompositeComponent',
    'updateComponent',
    function(transaction, prevParentDescriptor) {
      ReactComponent.Mixin.updateComponent.call(
        this,
        transaction,
        prevParentDescriptor
      );

      var prevComponentInstance = this._renderedComponent;
      var prevDescriptor = prevComponentInstance._descriptor;
      var nextDescriptor = this._renderValidatedComponent();
      if (shouldUpdateReactComponent(prevDescriptor, nextDescriptor)) {
        prevComponentInstance.receiveComponent(nextDescriptor, transaction);
      } else {
        // These two IDs are actually the same! But nothing should rely on that.
        var thisID = this._rootNodeID;
        var prevComponentID = prevComponentInstance._rootNodeID;
        prevComponentInstance.unmountComponent();
        this._renderedComponent = instantiateReactComponent(nextDescriptor);
        var nextMarkup = this._renderedComponent.mountComponent(
          thisID,
          transaction,
          this._mountDepth + 1
        );
        ReactComponent.BackendIDOperations.dangerouslyReplaceNodeWithMarkupByID(
          prevComponentID,
          nextMarkup
        );
      }
    }
  ),

  /**
   * Forces an update. This should only be invoked when it is known with
   * certainty that we are **not** in a DOM transaction.
   *
   * You may want to call this when you know that some deeper aspect of the
   * component's state has changed but `setState` was not called.
   *
   * This will not invoke `shouldUpdateComponent`, but it will invoke
   * `componentWillUpdate` and `componentDidUpdate`.
   *
   * @param {?function} callback Called after update is complete.
   * @final
   * @protected
   */
  forceUpdate: function(callback) {
    var compositeLifeCycleState = this._compositeLifeCycleState;
    ("production" !== "development" ? invariant(
      this.isMounted() ||
        compositeLifeCycleState === CompositeLifeCycle.MOUNTING,
      'forceUpdate(...): Can only force an update on mounted or mounting ' +
        'components.'
    ) : invariant(this.isMounted() ||
      compositeLifeCycleState === CompositeLifeCycle.MOUNTING));
    ("production" !== "development" ? invariant(
      compositeLifeCycleState !== CompositeLifeCycle.RECEIVING_STATE &&
      compositeLifeCycleState !== CompositeLifeCycle.UNMOUNTING,
      'forceUpdate(...): Cannot force an update while unmounting component ' +
      'or during an existing state transition (such as within `render`).'
    ) : invariant(compositeLifeCycleState !== CompositeLifeCycle.RECEIVING_STATE &&
    compositeLifeCycleState !== CompositeLifeCycle.UNMOUNTING));
    this._pendingForceUpdate = true;
    ReactUpdates.enqueueUpdate(this, callback);
  },

  /**
   * @private
   */
  _renderValidatedComponent: ReactPerf.measure(
    'ReactCompositeComponent',
    '_renderValidatedComponent',
    function() {
      var renderedComponent;
      var previousContext = ReactContext.current;
      ReactContext.current = this._processChildContext(
        this._descriptor._context
      );
      ReactCurrentOwner.current = this;
      try {
        renderedComponent = this.render();
        if (renderedComponent === null || renderedComponent === false) {
          renderedComponent = ReactEmptyComponent.getEmptyComponent();
          ReactEmptyComponent.registerNullComponentID(this._rootNodeID);
        } else {
          ReactEmptyComponent.deregisterNullComponentID(this._rootNodeID);
        }
      } finally {
        ReactContext.current = previousContext;
        ReactCurrentOwner.current = null;
      }
      ("production" !== "development" ? invariant(
        ReactDescriptor.isValidDescriptor(renderedComponent),
        '%s.render(): A valid ReactComponent must be returned. You may have ' +
          'returned undefined, an array or some other invalid object.',
        this.constructor.displayName || 'ReactCompositeComponent'
      ) : invariant(ReactDescriptor.isValidDescriptor(renderedComponent)));
      return renderedComponent;
    }
  ),

  /**
   * @private
   */
  _bindAutoBindMethods: function() {
    for (var autoBindKey in this.__reactAutoBindMap) {
      if (!this.__reactAutoBindMap.hasOwnProperty(autoBindKey)) {
        continue;
      }
      var method = this.__reactAutoBindMap[autoBindKey];
      this[autoBindKey] = this._bindAutoBindMethod(ReactErrorUtils.guard(
        method,
        this.constructor.displayName + '.' + autoBindKey
      ));
    }
  },

  /**
   * Binds a method to the component.
   *
   * @param {function} method Method to be bound.
   * @private
   */
  _bindAutoBindMethod: function(method) {
    var component = this;
    var boundMethod = function() {
      return method.apply(component, arguments);
    };
    if ("production" !== "development") {
      boundMethod.__reactBoundContext = component;
      boundMethod.__reactBoundMethod = method;
      boundMethod.__reactBoundArguments = null;
      var componentName = component.constructor.displayName;
      var _bind = boundMethod.bind;
      boundMethod.bind = function(newThis ) {var args=Array.prototype.slice.call(arguments,1);
        // User is trying to bind() an autobound method; we effectively will
        // ignore the value of "this" that the user is trying to use, so
        // let's warn.
        if (newThis !== component && newThis !== null) {
          monitorCodeUse('react_bind_warning', { component: componentName });
          console.warn(
            'bind(): React component methods may only be bound to the ' +
            'component instance. See ' + componentName
          );
        } else if (!args.length) {
          monitorCodeUse('react_bind_warning', { component: componentName });
          console.warn(
            'bind(): You are binding a component method to the component. ' +
            'React does this for you automatically in a high-performance ' +
            'way, so you can safely remove this call. See ' + componentName
          );
          return boundMethod;
        }
        var reboundMethod = _bind.apply(boundMethod, arguments);
        reboundMethod.__reactBoundContext = component;
        reboundMethod.__reactBoundMethod = method;
        reboundMethod.__reactBoundArguments = args;
        return reboundMethod;
      };
    }
    return boundMethod;
  }
};

var ReactCompositeComponentBase = function() {};
mixInto(ReactCompositeComponentBase, ReactComponent.Mixin);
mixInto(ReactCompositeComponentBase, ReactOwner.Mixin);
mixInto(ReactCompositeComponentBase, ReactPropTransferer.Mixin);
mixInto(ReactCompositeComponentBase, ReactCompositeComponentMixin);

/**
 * Module for creating composite components.
 *
 * @class ReactCompositeComponent
 * @extends ReactComponent
 * @extends ReactOwner
 * @extends ReactPropTransferer
 */
var ReactCompositeComponent = {

  LifeCycle: CompositeLifeCycle,

  Base: ReactCompositeComponentBase,

  /**
   * Creates a composite component class given a class specification.
   *
   * @param {object} spec Class specification (which must define `render`).
   * @return {function} Component constructor function.
   * @public
   */
  createClass: function(spec) {
    var Constructor = function(props, owner) {
      this.construct(props, owner);
    };
    Constructor.prototype = new ReactCompositeComponentBase();
    Constructor.prototype.constructor = Constructor;

    injectedMixins.forEach(
      mixSpecIntoComponent.bind(null, Constructor)
    );

    mixSpecIntoComponent(Constructor, spec);

    // Initialize the defaultProps property after all mixins have been merged
    if (Constructor.getDefaultProps) {
      Constructor.defaultProps = Constructor.getDefaultProps();
    }

    ("production" !== "development" ? invariant(
      Constructor.prototype.render,
      'createClass(...): Class specification must implement a `render` method.'
    ) : invariant(Constructor.prototype.render));

    if ("production" !== "development") {
      if (Constructor.prototype.componentShouldUpdate) {
        monitorCodeUse(
          'react_component_should_update_warning',
          { component: spec.displayName }
        );
        console.warn(
          (spec.displayName || 'A component') + ' has a method called ' +
          'componentShouldUpdate(). Did you mean shouldComponentUpdate()? ' +
          'The name is phrased as a question because the function is ' +
          'expected to return a value.'
         );
      }
    }

    // Reduce time spent doing lookups by setting these on the prototype.
    for (var methodName in ReactCompositeComponentInterface) {
      if (!Constructor.prototype[methodName]) {
        Constructor.prototype[methodName] = null;
      }
    }

    var descriptorFactory = ReactDescriptor.createFactory(Constructor);

    if ("production" !== "development") {
      return ReactDescriptorValidator.createFactory(
        descriptorFactory,
        Constructor.propTypes,
        Constructor.contextTypes
      );
    }

    return descriptorFactory;
  },

  injection: {
    injectMixin: function(mixin) {
      injectedMixins.push(mixin);
    }
  }
};

module.exports = ReactCompositeComponent;

},{"./ReactComponent":35,"./ReactContext":39,"./ReactCurrentOwner":40,"./ReactDescriptor":56,"./ReactDescriptorValidator":57,"./ReactEmptyComponent":58,"./ReactErrorUtils":59,"./ReactOwner":70,"./ReactPerf":71,"./ReactPropTransferer":72,"./ReactPropTypeLocationNames":73,"./ReactPropTypeLocations":74,"./ReactUpdates":87,"./instantiateReactComponent":133,"./invariant":134,"./keyMirror":140,"./mapObject":142,"./merge":144,"./mixInto":147,"./monitorCodeUse":148,"./shouldUpdateReactComponent":154,"./warning":158}],39:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactContext
 */



var merge = _dereq_("./merge");

/**
 * Keeps track of the current context.
 *
 * The context is automatically passed down the component ownership hierarchy
 * and is accessible via `this.context` on ReactCompositeComponents.
 */
var ReactContext = {

  /**
   * @internal
   * @type {object}
   */
  current: {},

  /**
   * Temporarily extends the current context while executing scopedCallback.
   *
   * A typical use case might look like
   *
   *  render: function() {
   *    var children = ReactContext.withContext({foo: 'foo'} () => (
   *
   *    ));
   *    return <div>{children}</div>;
   *  }
   *
   * @param {object} newContext New context to merge into the existing context
   * @param {function} scopedCallback Callback to run with the new context
   * @return {ReactComponent|array<ReactComponent>}
   */
  withContext: function(newContext, scopedCallback) {
    var result;
    var previousContext = ReactContext.current;
    ReactContext.current = merge(previousContext, newContext);
    try {
      result = scopedCallback();
    } finally {
      ReactContext.current = previousContext;
    }
    return result;
  }

};

module.exports = ReactContext;

},{"./merge":144}],40:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactCurrentOwner
 */



/**
 * Keeps track of the current owner.
 *
 * The current owner is the component who should own any components that are
 * currently being constructed.
 *
 * The depth indicate how many composite components are above this render level.
 */
var ReactCurrentOwner = {

  /**
   * @internal
   * @type {ReactComponent}
   */
  current: null

};

module.exports = ReactCurrentOwner;

},{}],41:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOM
 * @typechecks static-only
 */



var ReactDescriptor = _dereq_("./ReactDescriptor");
var ReactDescriptorValidator = _dereq_("./ReactDescriptorValidator");
var ReactDOMComponent = _dereq_("./ReactDOMComponent");

var mergeInto = _dereq_("./mergeInto");
var mapObject = _dereq_("./mapObject");

/**
 * Creates a new React class that is idempotent and capable of containing other
 * React components. It accepts event listeners and DOM properties that are
 * valid according to `DOMProperty`.
 *
 *  - Event listeners: `onClick`, `onMouseDown`, etc.
 *  - DOM properties: `className`, `name`, `title`, etc.
 *
 * The `style` property functions differently from the DOM API. It accepts an
 * object mapping of style properties to values.
 *
 * @param {boolean} omitClose True if the close tag should be omitted.
 * @param {string} tag Tag name (e.g. `div`).
 * @private
 */
function createDOMComponentClass(omitClose, tag) {
  var Constructor = function(descriptor) {
    this.construct(descriptor);
  };
  Constructor.prototype = new ReactDOMComponent(tag, omitClose);
  Constructor.prototype.constructor = Constructor;
  Constructor.displayName = tag;

  var ConvenienceConstructor = ReactDescriptor.createFactory(Constructor);

  if ("production" !== "development") {
    return ReactDescriptorValidator.createFactory(
      ConvenienceConstructor
    );
  }

  return ConvenienceConstructor;
}

/**
 * Creates a mapping from supported HTML tags to `ReactDOMComponent` classes.
 * This is also accessible via `React.DOM`.
 *
 * @public
 */
var ReactDOM = mapObject({
  a: false,
  abbr: false,
  address: false,
  area: true,
  article: false,
  aside: false,
  audio: false,
  b: false,
  base: true,
  bdi: false,
  bdo: false,
  big: false,
  blockquote: false,
  body: false,
  br: true,
  button: false,
  canvas: false,
  caption: false,
  cite: false,
  code: false,
  col: true,
  colgroup: false,
  data: false,
  datalist: false,
  dd: false,
  del: false,
  details: false,
  dfn: false,
  dialog: false,
  div: false,
  dl: false,
  dt: false,
  em: false,
  embed: true,
  fieldset: false,
  figcaption: false,
  figure: false,
  footer: false,
  form: false, // NOTE: Injected, see `ReactDOMForm`.
  h1: false,
  h2: false,
  h3: false,
  h4: false,
  h5: false,
  h6: false,
  head: false,
  header: false,
  hr: true,
  html: false,
  i: false,
  iframe: false,
  img: true,
  input: true,
  ins: false,
  kbd: false,
  keygen: true,
  label: false,
  legend: false,
  li: false,
  link: true,
  main: false,
  map: false,
  mark: false,
  menu: false,
  menuitem: false, // NOTE: Close tag should be omitted, but causes problems.
  meta: true,
  meter: false,
  nav: false,
  noscript: false,
  object: false,
  ol: false,
  optgroup: false,
  option: false,
  output: false,
  p: false,
  param: true,
  picture: false,
  pre: false,
  progress: false,
  q: false,
  rp: false,
  rt: false,
  ruby: false,
  s: false,
  samp: false,
  script: false,
  section: false,
  select: false,
  small: false,
  source: true,
  span: false,
  strong: false,
  style: false,
  sub: false,
  summary: false,
  sup: false,
  table: false,
  tbody: false,
  td: false,
  textarea: false, // NOTE: Injected, see `ReactDOMTextarea`.
  tfoot: false,
  th: false,
  thead: false,
  time: false,
  title: false,
  tr: false,
  track: true,
  u: false,
  ul: false,
  'var': false,
  video: false,
  wbr: true,

  // SVG
  circle: false,
  defs: false,
  ellipse: false,
  g: false,
  line: false,
  linearGradient: false,
  mask: false,
  path: false,
  pattern: false,
  polygon: false,
  polyline: false,
  radialGradient: false,
  rect: false,
  stop: false,
  svg: false,
  text: false,
  tspan: false
}, createDOMComponentClass);

var injection = {
  injectComponentClasses: function(componentClasses) {
    mergeInto(ReactDOM, componentClasses);
  }
};

ReactDOM.injection = injection;

module.exports = ReactDOM;

},{"./ReactDOMComponent":43,"./ReactDescriptor":56,"./ReactDescriptorValidator":57,"./mapObject":142,"./mergeInto":146}],42:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMButton
 */



var AutoFocusMixin = _dereq_("./AutoFocusMixin");
var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");
var ReactDOM = _dereq_("./ReactDOM");

var keyMirror = _dereq_("./keyMirror");

// Store a reference to the <button> `ReactDOMComponent`.
var button = ReactDOM.button;

var mouseListenerNames = keyMirror({
  onClick: true,
  onDoubleClick: true,
  onMouseDown: true,
  onMouseMove: true,
  onMouseUp: true,
  onClickCapture: true,
  onDoubleClickCapture: true,
  onMouseDownCapture: true,
  onMouseMoveCapture: true,
  onMouseUpCapture: true
});

/**
 * Implements a <button> native component that does not receive mouse events
 * when `disabled` is set.
 */
var ReactDOMButton = ReactCompositeComponent.createClass({
  displayName: 'ReactDOMButton',

  mixins: [AutoFocusMixin, ReactBrowserComponentMixin],

  render: function() {
    var props = {};

    // Copy the props; except the mouse listeners if we're disabled
    for (var key in this.props) {
      if (this.props.hasOwnProperty(key) &&
          (!this.props.disabled || !mouseListenerNames[key])) {
        props[key] = this.props[key];
      }
    }

    return button(props, this.props.children);
  }

});

module.exports = ReactDOMButton;

},{"./AutoFocusMixin":1,"./ReactBrowserComponentMixin":30,"./ReactCompositeComponent":38,"./ReactDOM":41,"./keyMirror":140}],43:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMComponent
 * @typechecks static-only
 */



var CSSPropertyOperations = _dereq_("./CSSPropertyOperations");
var DOMProperty = _dereq_("./DOMProperty");
var DOMPropertyOperations = _dereq_("./DOMPropertyOperations");
var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactComponent = _dereq_("./ReactComponent");
var ReactBrowserEventEmitter = _dereq_("./ReactBrowserEventEmitter");
var ReactMount = _dereq_("./ReactMount");
var ReactMultiChild = _dereq_("./ReactMultiChild");
var ReactPerf = _dereq_("./ReactPerf");

var escapeTextForBrowser = _dereq_("./escapeTextForBrowser");
var invariant = _dereq_("./invariant");
var keyOf = _dereq_("./keyOf");
var merge = _dereq_("./merge");
var mixInto = _dereq_("./mixInto");

var deleteListener = ReactBrowserEventEmitter.deleteListener;
var listenTo = ReactBrowserEventEmitter.listenTo;
var registrationNameModules = ReactBrowserEventEmitter.registrationNameModules;

// For quickly matching children type, to test if can be treated as content.
var CONTENT_TYPES = {'string': true, 'number': true};

var STYLE = keyOf({style: null});

var ELEMENT_NODE_TYPE = 1;

/**
 * @param {?object} props
 */
function assertValidProps(props) {
  if (!props) {
    return;
  }
  // Note the use of `==` which checks for null or undefined.
  ("production" !== "development" ? invariant(
    props.children == null || props.dangerouslySetInnerHTML == null,
    'Can only set one of `children` or `props.dangerouslySetInnerHTML`.'
  ) : invariant(props.children == null || props.dangerouslySetInnerHTML == null));
  ("production" !== "development" ? invariant(
    props.style == null || typeof props.style === 'object',
    'The `style` prop expects a mapping from style properties to values, ' +
    'not a string.'
  ) : invariant(props.style == null || typeof props.style === 'object'));
}

function putListener(id, registrationName, listener, transaction) {
  var container = ReactMount.findReactContainerForID(id);
  if (container) {
    var doc = container.nodeType === ELEMENT_NODE_TYPE ?
      container.ownerDocument :
      container;
    listenTo(registrationName, doc);
  }
  transaction.getPutListenerQueue().enqueuePutListener(
    id,
    registrationName,
    listener
  );
}


/**
 * @constructor ReactDOMComponent
 * @extends ReactComponent
 * @extends ReactMultiChild
 */
function ReactDOMComponent(tag, omitClose) {
  this._tagOpen = '<' + tag;
  this._tagClose = omitClose ? '' : '</' + tag + '>';
  this.tagName = tag.toUpperCase();
}

ReactDOMComponent.Mixin = {

  /**
   * Generates root tag markup then recurses. This method has side effects and
   * is not idempotent.
   *
   * @internal
   * @param {string} rootID The root DOM ID for this node.
   * @param {ReactReconcileTransaction|ReactServerRenderingTransaction} transaction
   * @param {number} mountDepth number of components in the owner hierarchy
   * @return {string} The computed markup.
   */
  mountComponent: ReactPerf.measure(
    'ReactDOMComponent',
    'mountComponent',
    function(rootID, transaction, mountDepth) {
      ReactComponent.Mixin.mountComponent.call(
        this,
        rootID,
        transaction,
        mountDepth
      );
      assertValidProps(this.props);
      return (
        this._createOpenTagMarkupAndPutListeners(transaction) +
        this._createContentMarkup(transaction) +
        this._tagClose
      );
    }
  ),

  /**
   * Creates markup for the open tag and all attributes.
   *
   * This method has side effects because events get registered.
   *
   * Iterating over object properties is faster than iterating over arrays.
   * @see http://jsperf.com/obj-vs-arr-iteration
   *
   * @private
   * @param {ReactReconcileTransaction|ReactServerRenderingTransaction} transaction
   * @return {string} Markup of opening tag.
   */
  _createOpenTagMarkupAndPutListeners: function(transaction) {
    var props = this.props;
    var ret = this._tagOpen;

    for (var propKey in props) {
      if (!props.hasOwnProperty(propKey)) {
        continue;
      }
      var propValue = props[propKey];
      if (propValue == null) {
        continue;
      }
      if (registrationNameModules.hasOwnProperty(propKey)) {
        putListener(this._rootNodeID, propKey, propValue, transaction);
      } else {
        if (propKey === STYLE) {
          if (propValue) {
            propValue = props.style = merge(props.style);
          }
          propValue = CSSPropertyOperations.createMarkupForStyles(propValue);
        }
        var markup =
          DOMPropertyOperations.createMarkupForProperty(propKey, propValue);
        if (markup) {
          ret += ' ' + markup;
        }
      }
    }

    // For static pages, no need to put React ID and checksum. Saves lots of
    // bytes.
    if (transaction.renderToStaticMarkup) {
      return ret + '>';
    }

    var markupForID = DOMPropertyOperations.createMarkupForID(this._rootNodeID);
    return ret + ' ' + markupForID + '>';
  },

  /**
   * Creates markup for the content between the tags.
   *
   * @private
   * @param {ReactReconcileTransaction|ReactServerRenderingTransaction} transaction
   * @return {string} Content markup.
   */
  _createContentMarkup: function(transaction) {
    // Intentional use of != to avoid catching zero/false.
    var innerHTML = this.props.dangerouslySetInnerHTML;
    if (innerHTML != null) {
      if (innerHTML.__html != null) {
        return innerHTML.__html;
      }
    } else {
      var contentToUse =
        CONTENT_TYPES[typeof this.props.children] ? this.props.children : null;
      var childrenToUse = contentToUse != null ? null : this.props.children;
      if (contentToUse != null) {
        return escapeTextForBrowser(contentToUse);
      } else if (childrenToUse != null) {
        var mountImages = this.mountChildren(
          childrenToUse,
          transaction
        );
        return mountImages.join('');
      }
    }
    return '';
  },

  receiveComponent: function(nextDescriptor, transaction) {
    if (nextDescriptor === this._descriptor &&
        nextDescriptor._owner != null) {
      // Since descriptors are immutable after the owner is rendered,
      // we can do a cheap identity compare here to determine if this is a
      // superfluous reconcile. It's possible for state to be mutable but such
      // change should trigger an update of the owner which would recreate
      // the descriptor. We explicitly check for the existence of an owner since
      // it's possible for a descriptor created outside a composite to be
      // deeply mutated and reused.
      return;
    }

    ReactComponent.Mixin.receiveComponent.call(
      this,
      nextDescriptor,
      transaction
    );
  },

  /**
   * Updates a native DOM component after it has already been allocated and
   * attached to the DOM. Reconciles the root DOM node, then recurses.
   *
   * @param {ReactReconcileTransaction} transaction
   * @param {ReactDescriptor} prevDescriptor
   * @internal
   * @overridable
   */
  updateComponent: ReactPerf.measure(
    'ReactDOMComponent',
    'updateComponent',
    function(transaction, prevDescriptor) {
      assertValidProps(this._descriptor.props);
      ReactComponent.Mixin.updateComponent.call(
        this,
        transaction,
        prevDescriptor
      );
      this._updateDOMProperties(prevDescriptor.props, transaction);
      this._updateDOMChildren(prevDescriptor.props, transaction);
    }
  ),

  /**
   * Reconciles the properties by detecting differences in property values and
   * updating the DOM as necessary. This function is probably the single most
   * critical path for performance optimization.
   *
   * TODO: Benchmark whether checking for changed values in memory actually
   *       improves performance (especially statically positioned elements).
   * TODO: Benchmark the effects of putting this at the top since 99% of props
   *       do not change for a given reconciliation.
   * TODO: Benchmark areas that can be improved with caching.
   *
   * @private
   * @param {object} lastProps
   * @param {ReactReconcileTransaction} transaction
   */
  _updateDOMProperties: function(lastProps, transaction) {
    var nextProps = this.props;
    var propKey;
    var styleName;
    var styleUpdates;
    for (propKey in lastProps) {
      if (nextProps.hasOwnProperty(propKey) ||
         !lastProps.hasOwnProperty(propKey)) {
        continue;
      }
      if (propKey === STYLE) {
        var lastStyle = lastProps[propKey];
        for (styleName in lastStyle) {
          if (lastStyle.hasOwnProperty(styleName)) {
            styleUpdates = styleUpdates || {};
            styleUpdates[styleName] = '';
          }
        }
      } else if (registrationNameModules.hasOwnProperty(propKey)) {
        deleteListener(this._rootNodeID, propKey);
      } else if (
          DOMProperty.isStandardName[propKey] ||
          DOMProperty.isCustomAttribute(propKey)) {
        ReactComponent.BackendIDOperations.deletePropertyByID(
          this._rootNodeID,
          propKey
        );
      }
    }
    for (propKey in nextProps) {
      var nextProp = nextProps[propKey];
      var lastProp = lastProps[propKey];
      if (!nextProps.hasOwnProperty(propKey) || nextProp === lastProp) {
        continue;
      }
      if (propKey === STYLE) {
        if (nextProp) {
          nextProp = nextProps.style = merge(nextProp);
        }
        if (lastProp) {
          // Unset styles on `lastProp` but not on `nextProp`.
          for (styleName in lastProp) {
            if (lastProp.hasOwnProperty(styleName) &&
                (!nextProp || !nextProp.hasOwnProperty(styleName))) {
              styleUpdates = styleUpdates || {};
              styleUpdates[styleName] = '';
            }
          }
          // Update styles that changed since `lastProp`.
          for (styleName in nextProp) {
            if (nextProp.hasOwnProperty(styleName) &&
                lastProp[styleName] !== nextProp[styleName]) {
              styleUpdates = styleUpdates || {};
              styleUpdates[styleName] = nextProp[styleName];
            }
          }
        } else {
          // Relies on `updateStylesByID` not mutating `styleUpdates`.
          styleUpdates = nextProp;
        }
      } else if (registrationNameModules.hasOwnProperty(propKey)) {
        putListener(this._rootNodeID, propKey, nextProp, transaction);
      } else if (
          DOMProperty.isStandardName[propKey] ||
          DOMProperty.isCustomAttribute(propKey)) {
        ReactComponent.BackendIDOperations.updatePropertyByID(
          this._rootNodeID,
          propKey,
          nextProp
        );
      }
    }
    if (styleUpdates) {
      ReactComponent.BackendIDOperations.updateStylesByID(
        this._rootNodeID,
        styleUpdates
      );
    }
  },

  /**
   * Reconciles the children with the various properties that affect the
   * children content.
   *
   * @param {object} lastProps
   * @param {ReactReconcileTransaction} transaction
   */
  _updateDOMChildren: function(lastProps, transaction) {
    var nextProps = this.props;

    var lastContent =
      CONTENT_TYPES[typeof lastProps.children] ? lastProps.children : null;
    var nextContent =
      CONTENT_TYPES[typeof nextProps.children] ? nextProps.children : null;

    var lastHtml =
      lastProps.dangerouslySetInnerHTML &&
      lastProps.dangerouslySetInnerHTML.__html;
    var nextHtml =
      nextProps.dangerouslySetInnerHTML &&
      nextProps.dangerouslySetInnerHTML.__html;

    // Note the use of `!=` which checks for null or undefined.
    var lastChildren = lastContent != null ? null : lastProps.children;
    var nextChildren = nextContent != null ? null : nextProps.children;

    // If we're switching from children to content/html or vice versa, remove
    // the old content
    var lastHasContentOrHtml = lastContent != null || lastHtml != null;
    var nextHasContentOrHtml = nextContent != null || nextHtml != null;
    if (lastChildren != null && nextChildren == null) {
      this.updateChildren(null, transaction);
    } else if (lastHasContentOrHtml && !nextHasContentOrHtml) {
      this.updateTextContent('');
    }

    if (nextContent != null) {
      if (lastContent !== nextContent) {
        this.updateTextContent('' + nextContent);
      }
    } else if (nextHtml != null) {
      if (lastHtml !== nextHtml) {
        ReactComponent.BackendIDOperations.updateInnerHTMLByID(
          this._rootNodeID,
          nextHtml
        );
      }
    } else if (nextChildren != null) {
      this.updateChildren(nextChildren, transaction);
    }
  },

  /**
   * Destroys all event registrations for this instance. Does not remove from
   * the DOM. That must be done by the parent.
   *
   * @internal
   */
  unmountComponent: function() {
    this.unmountChildren();
    ReactBrowserEventEmitter.deleteAllListeners(this._rootNodeID);
    ReactComponent.Mixin.unmountComponent.call(this);
  }

};

mixInto(ReactDOMComponent, ReactComponent.Mixin);
mixInto(ReactDOMComponent, ReactDOMComponent.Mixin);
mixInto(ReactDOMComponent, ReactMultiChild.Mixin);
mixInto(ReactDOMComponent, ReactBrowserComponentMixin);

module.exports = ReactDOMComponent;

},{"./CSSPropertyOperations":5,"./DOMProperty":11,"./DOMPropertyOperations":12,"./ReactBrowserComponentMixin":30,"./ReactBrowserEventEmitter":31,"./ReactComponent":35,"./ReactMount":67,"./ReactMultiChild":68,"./ReactPerf":71,"./escapeTextForBrowser":118,"./invariant":134,"./keyOf":141,"./merge":144,"./mixInto":147}],44:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMForm
 */



var EventConstants = _dereq_("./EventConstants");
var LocalEventTrapMixin = _dereq_("./LocalEventTrapMixin");
var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");
var ReactDOM = _dereq_("./ReactDOM");

// Store a reference to the <form> `ReactDOMComponent`.
var form = ReactDOM.form;

/**
 * Since onSubmit doesn't bubble OR capture on the top level in IE8, we need
 * to capture it on the <form> element itself. There are lots of hacks we could
 * do to accomplish this, but the most reliable is to make <form> a
 * composite component and use `componentDidMount` to attach the event handlers.
 */
var ReactDOMForm = ReactCompositeComponent.createClass({
  displayName: 'ReactDOMForm',

  mixins: [ReactBrowserComponentMixin, LocalEventTrapMixin],

  render: function() {
    // TODO: Instead of using `ReactDOM` directly, we should use JSX. However,
    // `jshint` fails to parse JSX so in order for linting to work in the open
    // source repo, we need to just use `ReactDOM.form`.
    return this.transferPropsTo(form(null, this.props.children));
  },

  componentDidMount: function() {
    this.trapBubbledEvent(EventConstants.topLevelTypes.topReset, 'reset');
    this.trapBubbledEvent(EventConstants.topLevelTypes.topSubmit, 'submit');
  }
});

module.exports = ReactDOMForm;

},{"./EventConstants":16,"./LocalEventTrapMixin":26,"./ReactBrowserComponentMixin":30,"./ReactCompositeComponent":38,"./ReactDOM":41}],45:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMIDOperations
 * @typechecks static-only
 */

/*jslint evil: true */



var CSSPropertyOperations = _dereq_("./CSSPropertyOperations");
var DOMChildrenOperations = _dereq_("./DOMChildrenOperations");
var DOMPropertyOperations = _dereq_("./DOMPropertyOperations");
var ReactMount = _dereq_("./ReactMount");
var ReactPerf = _dereq_("./ReactPerf");

var invariant = _dereq_("./invariant");
var setInnerHTML = _dereq_("./setInnerHTML");

/**
 * Errors for properties that should not be updated with `updatePropertyById()`.
 *
 * @type {object}
 * @private
 */
var INVALID_PROPERTY_ERRORS = {
  dangerouslySetInnerHTML:
    '`dangerouslySetInnerHTML` must be set using `updateInnerHTMLByID()`.',
  style: '`style` must be set using `updateStylesByID()`.'
};

/**
 * Operations used to process updates to DOM nodes. This is made injectable via
 * `ReactComponent.BackendIDOperations`.
 */
var ReactDOMIDOperations = {

  /**
   * Updates a DOM node with new property values. This should only be used to
   * update DOM properties in `DOMProperty`.
   *
   * @param {string} id ID of the node to update.
   * @param {string} name A valid property name, see `DOMProperty`.
   * @param {*} value New value of the property.
   * @internal
   */
  updatePropertyByID: ReactPerf.measure(
    'ReactDOMIDOperations',
    'updatePropertyByID',
    function(id, name, value) {
      var node = ReactMount.getNode(id);
      ("production" !== "development" ? invariant(
        !INVALID_PROPERTY_ERRORS.hasOwnProperty(name),
        'updatePropertyByID(...): %s',
        INVALID_PROPERTY_ERRORS[name]
      ) : invariant(!INVALID_PROPERTY_ERRORS.hasOwnProperty(name)));

      // If we're updating to null or undefined, we should remove the property
      // from the DOM node instead of inadvertantly setting to a string. This
      // brings us in line with the same behavior we have on initial render.
      if (value != null) {
        DOMPropertyOperations.setValueForProperty(node, name, value);
      } else {
        DOMPropertyOperations.deleteValueForProperty(node, name);
      }
    }
  ),

  /**
   * Updates a DOM node to remove a property. This should only be used to remove
   * DOM properties in `DOMProperty`.
   *
   * @param {string} id ID of the node to update.
   * @param {string} name A property name to remove, see `DOMProperty`.
   * @internal
   */
  deletePropertyByID: ReactPerf.measure(
    'ReactDOMIDOperations',
    'deletePropertyByID',
    function(id, name, value) {
      var node = ReactMount.getNode(id);
      ("production" !== "development" ? invariant(
        !INVALID_PROPERTY_ERRORS.hasOwnProperty(name),
        'updatePropertyByID(...): %s',
        INVALID_PROPERTY_ERRORS[name]
      ) : invariant(!INVALID_PROPERTY_ERRORS.hasOwnProperty(name)));
      DOMPropertyOperations.deleteValueForProperty(node, name, value);
    }
  ),

  /**
   * Updates a DOM node with new style values. If a value is specified as '',
   * the corresponding style property will be unset.
   *
   * @param {string} id ID of the node to update.
   * @param {object} styles Mapping from styles to values.
   * @internal
   */
  updateStylesByID: ReactPerf.measure(
    'ReactDOMIDOperations',
    'updateStylesByID',
    function(id, styles) {
      var node = ReactMount.getNode(id);
      CSSPropertyOperations.setValueForStyles(node, styles);
    }
  ),

  /**
   * Updates a DOM node's innerHTML.
   *
   * @param {string} id ID of the node to update.
   * @param {string} html An HTML string.
   * @internal
   */
  updateInnerHTMLByID: ReactPerf.measure(
    'ReactDOMIDOperations',
    'updateInnerHTMLByID',
    function(id, html) {
      var node = ReactMount.getNode(id);
      setInnerHTML(node, html);
    }
  ),

  /**
   * Updates a DOM node's text content set by `props.content`.
   *
   * @param {string} id ID of the node to update.
   * @param {string} content Text content.
   * @internal
   */
  updateTextContentByID: ReactPerf.measure(
    'ReactDOMIDOperations',
    'updateTextContentByID',
    function(id, content) {
      var node = ReactMount.getNode(id);
      DOMChildrenOperations.updateTextContent(node, content);
    }
  ),

  /**
   * Replaces a DOM node that exists in the document with markup.
   *
   * @param {string} id ID of child to be replaced.
   * @param {string} markup Dangerous markup to inject in place of child.
   * @internal
   * @see {Danger.dangerouslyReplaceNodeWithMarkup}
   */
  dangerouslyReplaceNodeWithMarkupByID: ReactPerf.measure(
    'ReactDOMIDOperations',
    'dangerouslyReplaceNodeWithMarkupByID',
    function(id, markup) {
      var node = ReactMount.getNode(id);
      DOMChildrenOperations.dangerouslyReplaceNodeWithMarkup(node, markup);
    }
  ),

  /**
   * Updates a component's children by processing a series of updates.
   *
   * @param {array<object>} updates List of update configurations.
   * @param {array<string>} markup List of markup strings.
   * @internal
   */
  dangerouslyProcessChildrenUpdates: ReactPerf.measure(
    'ReactDOMIDOperations',
    'dangerouslyProcessChildrenUpdates',
    function(updates, markup) {
      for (var i = 0; i < updates.length; i++) {
        updates[i].parentNode = ReactMount.getNode(updates[i].parentID);
      }
      DOMChildrenOperations.processUpdates(updates, markup);
    }
  )
};

module.exports = ReactDOMIDOperations;

},{"./CSSPropertyOperations":5,"./DOMChildrenOperations":10,"./DOMPropertyOperations":12,"./ReactMount":67,"./ReactPerf":71,"./invariant":134,"./setInnerHTML":152}],46:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMImg
 */



var EventConstants = _dereq_("./EventConstants");
var LocalEventTrapMixin = _dereq_("./LocalEventTrapMixin");
var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");
var ReactDOM = _dereq_("./ReactDOM");

// Store a reference to the <img> `ReactDOMComponent`.
var img = ReactDOM.img;

/**
 * Since onLoad doesn't bubble OR capture on the top level in IE8, we need to
 * capture it on the <img> element itself. There are lots of hacks we could do
 * to accomplish this, but the most reliable is to make <img> a composite
 * component and use `componentDidMount` to attach the event handlers.
 */
var ReactDOMImg = ReactCompositeComponent.createClass({
  displayName: 'ReactDOMImg',
  tagName: 'IMG',

  mixins: [ReactBrowserComponentMixin, LocalEventTrapMixin],

  render: function() {
    return img(this.props);
  },

  componentDidMount: function() {
    this.trapBubbledEvent(EventConstants.topLevelTypes.topLoad, 'load');
    this.trapBubbledEvent(EventConstants.topLevelTypes.topError, 'error');
  }
});

module.exports = ReactDOMImg;

},{"./EventConstants":16,"./LocalEventTrapMixin":26,"./ReactBrowserComponentMixin":30,"./ReactCompositeComponent":38,"./ReactDOM":41}],47:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMInput
 */



var AutoFocusMixin = _dereq_("./AutoFocusMixin");
var DOMPropertyOperations = _dereq_("./DOMPropertyOperations");
var LinkedValueUtils = _dereq_("./LinkedValueUtils");
var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");
var ReactDOM = _dereq_("./ReactDOM");
var ReactMount = _dereq_("./ReactMount");

var invariant = _dereq_("./invariant");
var merge = _dereq_("./merge");

// Store a reference to the <input> `ReactDOMComponent`.
var input = ReactDOM.input;

var instancesByReactID = {};

/**
 * Implements an <input> native component that allows setting these optional
 * props: `checked`, `value`, `defaultChecked`, and `defaultValue`.
 *
 * If `checked` or `value` are not supplied (or null/undefined), user actions
 * that affect the checked state or value will trigger updates to the element.
 *
 * If they are supplied (and not null/undefined), the rendered element will not
 * trigger updates to the element. Instead, the props must change in order for
 * the rendered element to be updated.
 *
 * The rendered element will be initialized as unchecked (or `defaultChecked`)
 * with an empty value (or `defaultValue`).
 *
 * @see http://www.w3.org/TR/2012/WD-html5-20121025/the-input-element.html
 */
var ReactDOMInput = ReactCompositeComponent.createClass({
  displayName: 'ReactDOMInput',

  mixins: [AutoFocusMixin, LinkedValueUtils.Mixin, ReactBrowserComponentMixin],

  getInitialState: function() {
    var defaultValue = this.props.defaultValue;
    return {
      checked: this.props.defaultChecked || false,
      value: defaultValue != null ? defaultValue : null
    };
  },

  shouldComponentUpdate: function() {
    // Defer any updates to this component during the `onChange` handler.
    return !this._isChanging;
  },

  render: function() {
    // Clone `this.props` so we don't mutate the input.
    var props = merge(this.props);

    props.defaultChecked = null;
    props.defaultValue = null;

    var value = LinkedValueUtils.getValue(this);
    props.value = value != null ? value : this.state.value;

    var checked = LinkedValueUtils.getChecked(this);
    props.checked = checked != null ? checked : this.state.checked;

    props.onChange = this._handleChange;

    return input(props, this.props.children);
  },

  componentDidMount: function() {
    var id = ReactMount.getID(this.getDOMNode());
    instancesByReactID[id] = this;
  },

  componentWillUnmount: function() {
    var rootNode = this.getDOMNode();
    var id = ReactMount.getID(rootNode);
    delete instancesByReactID[id];
  },

  componentDidUpdate: function(prevProps, prevState, prevContext) {
    var rootNode = this.getDOMNode();
    if (this.props.checked != null) {
      DOMPropertyOperations.setValueForProperty(
        rootNode,
        'checked',
        this.props.checked || false
      );
    }

    var value = LinkedValueUtils.getValue(this);
    if (value != null) {
      // Cast `value` to a string to ensure the value is set correctly. While
      // browsers typically do this as necessary, jsdom doesn't.
      DOMPropertyOperations.setValueForProperty(rootNode, 'value', '' + value);
    }
  },

  _handleChange: function(event) {
    var returnValue;
    var onChange = LinkedValueUtils.getOnChange(this);
    if (onChange) {
      this._isChanging = true;
      returnValue = onChange.call(this, event);
      this._isChanging = false;
    }
    this.setState({
      checked: event.target.checked,
      value: event.target.value
    });

    var name = this.props.name;
    if (this.props.type === 'radio' && name != null) {
      var rootNode = this.getDOMNode();
      var queryRoot = rootNode;

      while (queryRoot.parentNode) {
        queryRoot = queryRoot.parentNode;
      }

      // If `rootNode.form` was non-null, then we could try `form.elements`,
      // but that sometimes behaves strangely in IE8. We could also try using
      // `form.getElementsByName`, but that will only return direct children
      // and won't include inputs that use the HTML5 `form=` attribute. Since
      // the input might not even be in a form, let's just use the global
      // `querySelectorAll` to ensure we don't miss anything.
      var group = queryRoot.querySelectorAll(
        'input[name=' + JSON.stringify('' + name) + '][type="radio"]');

      for (var i = 0, groupLen = group.length; i < groupLen; i++) {
        var otherNode = group[i];
        if (otherNode === rootNode ||
            otherNode.form !== rootNode.form) {
          continue;
        }
        var otherID = ReactMount.getID(otherNode);
        ("production" !== "development" ? invariant(
          otherID,
          'ReactDOMInput: Mixing React and non-React radio inputs with the ' +
          'same `name` is not supported.'
        ) : invariant(otherID));
        var otherInstance = instancesByReactID[otherID];
        ("production" !== "development" ? invariant(
          otherInstance,
          'ReactDOMInput: Unknown radio button ID %s.',
          otherID
        ) : invariant(otherInstance));
        // In some cases, this will actually change the `checked` state value.
        // In other cases, there's no change but this forces a reconcile upon
        // which componentDidUpdate will reset the DOM property to whatever it
        // should be.
        otherInstance.setState({
          checked: false
        });
      }
    }

    return returnValue;
  }

});

module.exports = ReactDOMInput;

},{"./AutoFocusMixin":1,"./DOMPropertyOperations":12,"./LinkedValueUtils":25,"./ReactBrowserComponentMixin":30,"./ReactCompositeComponent":38,"./ReactDOM":41,"./ReactMount":67,"./invariant":134,"./merge":144}],48:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMOption
 */



var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");
var ReactDOM = _dereq_("./ReactDOM");

var warning = _dereq_("./warning");

// Store a reference to the <option> `ReactDOMComponent`.
var option = ReactDOM.option;

/**
 * Implements an <option> native component that warns when `selected` is set.
 */
var ReactDOMOption = ReactCompositeComponent.createClass({
  displayName: 'ReactDOMOption',

  mixins: [ReactBrowserComponentMixin],

  componentWillMount: function() {
    // TODO (yungsters): Remove support for `selected` in <option>.
    if ("production" !== "development") {
      ("production" !== "development" ? warning(
        this.props.selected == null,
        'Use the `defaultValue` or `value` props on <select> instead of ' +
        'setting `selected` on <option>.'
      ) : null);
    }
  },

  render: function() {
    return option(this.props, this.props.children);
  }

});

module.exports = ReactDOMOption;

},{"./ReactBrowserComponentMixin":30,"./ReactCompositeComponent":38,"./ReactDOM":41,"./warning":158}],49:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMSelect
 */



var AutoFocusMixin = _dereq_("./AutoFocusMixin");
var LinkedValueUtils = _dereq_("./LinkedValueUtils");
var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");
var ReactDOM = _dereq_("./ReactDOM");

var merge = _dereq_("./merge");

// Store a reference to the <select> `ReactDOMComponent`.
var select = ReactDOM.select;

/**
 * Validation function for `value` and `defaultValue`.
 * @private
 */
function selectValueType(props, propName, componentName) {
  if (props[propName] == null) {
    return;
  }
  if (props.multiple) {
    if (!Array.isArray(props[propName])) {
      return new Error(
        ("The `" + propName + "` prop supplied to <select> must be an array if ") +
        ("`multiple` is true.")
      );
    }
  } else {
    if (Array.isArray(props[propName])) {
      return new Error(
        ("The `" + propName + "` prop supplied to <select> must be a scalar ") +
        ("value if `multiple` is false.")
      );
    }
  }
}

/**
 * If `value` is supplied, updates <option> elements on mount and update.
 * @param {ReactComponent} component Instance of ReactDOMSelect
 * @param {?*} propValue For uncontrolled components, null/undefined. For
 * controlled components, a string (or with `multiple`, a list of strings).
 * @private
 */
function updateOptions(component, propValue) {
  var multiple = component.props.multiple;
  var value = propValue != null ? propValue : component.state.value;
  var options = component.getDOMNode().options;
  var selectedValue, i, l;
  if (multiple) {
    selectedValue = {};
    for (i = 0, l = value.length; i < l; ++i) {
      selectedValue['' + value[i]] = true;
    }
  } else {
    selectedValue = '' + value;
  }
  for (i = 0, l = options.length; i < l; i++) {
    var selected = multiple ?
      selectedValue.hasOwnProperty(options[i].value) :
      options[i].value === selectedValue;

    if (selected !== options[i].selected) {
      options[i].selected = selected;
    }
  }
}

/**
 * Implements a <select> native component that allows optionally setting the
 * props `value` and `defaultValue`. If `multiple` is false, the prop must be a
 * string. If `multiple` is true, the prop must be an array of strings.
 *
 * If `value` is not supplied (or null/undefined), user actions that change the
 * selected option will trigger updates to the rendered options.
 *
 * If it is supplied (and not null/undefined), the rendered options will not
 * update in response to user actions. Instead, the `value` prop must change in
 * order for the rendered options to update.
 *
 * If `defaultValue` is provided, any options with the supplied values will be
 * selected.
 */
var ReactDOMSelect = ReactCompositeComponent.createClass({
  displayName: 'ReactDOMSelect',

  mixins: [AutoFocusMixin, LinkedValueUtils.Mixin, ReactBrowserComponentMixin],

  propTypes: {
    defaultValue: selectValueType,
    value: selectValueType
  },

  getInitialState: function() {
    return {value: this.props.defaultValue || (this.props.multiple ? [] : '')};
  },

  componentWillReceiveProps: function(nextProps) {
    if (!this.props.multiple && nextProps.multiple) {
      this.setState({value: [this.state.value]});
    } else if (this.props.multiple && !nextProps.multiple) {
      this.setState({value: this.state.value[0]});
    }
  },

  shouldComponentUpdate: function() {
    // Defer any updates to this component during the `onChange` handler.
    return !this._isChanging;
  },

  render: function() {
    // Clone `this.props` so we don't mutate the input.
    var props = merge(this.props);

    props.onChange = this._handleChange;
    props.value = null;

    return select(props, this.props.children);
  },

  componentDidMount: function() {
    updateOptions(this, LinkedValueUtils.getValue(this));
  },

  componentDidUpdate: function(prevProps) {
    var value = LinkedValueUtils.getValue(this);
    var prevMultiple = !!prevProps.multiple;
    var multiple = !!this.props.multiple;
    if (value != null || prevMultiple !== multiple) {
      updateOptions(this, value);
    }
  },

  _handleChange: function(event) {
    var returnValue;
    var onChange = LinkedValueUtils.getOnChange(this);
    if (onChange) {
      this._isChanging = true;
      returnValue = onChange.call(this, event);
      this._isChanging = false;
    }

    var selectedValue;
    if (this.props.multiple) {
      selectedValue = [];
      var options = event.target.options;
      for (var i = 0, l = options.length; i < l; i++) {
        if (options[i].selected) {
          selectedValue.push(options[i].value);
        }
      }
    } else {
      selectedValue = event.target.value;
    }

    this.setState({value: selectedValue});
    return returnValue;
  }

});

module.exports = ReactDOMSelect;

},{"./AutoFocusMixin":1,"./LinkedValueUtils":25,"./ReactBrowserComponentMixin":30,"./ReactCompositeComponent":38,"./ReactDOM":41,"./merge":144}],50:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMSelection
 */



var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

var getNodeForCharacterOffset = _dereq_("./getNodeForCharacterOffset");
var getTextContentAccessor = _dereq_("./getTextContentAccessor");

/**
 * While `isCollapsed` is available on the Selection object and `collapsed`
 * is available on the Range object, IE11 sometimes gets them wrong.
 * If the anchor/focus nodes and offsets are the same, the range is collapsed.
 */
function isCollapsed(anchorNode, anchorOffset, focusNode, focusOffset) {
  return anchorNode === focusNode && anchorOffset === focusOffset;
}

/**
 * Get the appropriate anchor and focus node/offset pairs for IE.
 *
 * The catch here is that IE's selection API doesn't provide information
 * about whether the selection is forward or backward, so we have to
 * behave as though it's always forward.
 *
 * IE text differs from modern selection in that it behaves as though
 * block elements end with a new line. This means character offsets will
 * differ between the two APIs.
 *
 * @param {DOMElement} node
 * @return {object}
 */
function getIEOffsets(node) {
  var selection = document.selection;
  var selectedRange = selection.createRange();
  var selectedLength = selectedRange.text.length;

  // Duplicate selection so we can move range without breaking user selection.
  var fromStart = selectedRange.duplicate();
  fromStart.moveToElementText(node);
  fromStart.setEndPoint('EndToStart', selectedRange);

  var startOffset = fromStart.text.length;
  var endOffset = startOffset + selectedLength;

  return {
    start: startOffset,
    end: endOffset
  };
}

/**
 * @param {DOMElement} node
 * @return {?object}
 */
function getModernOffsets(node) {
  var selection = window.getSelection();

  if (selection.rangeCount === 0) {
    return null;
  }

  var anchorNode = selection.anchorNode;
  var anchorOffset = selection.anchorOffset;
  var focusNode = selection.focusNode;
  var focusOffset = selection.focusOffset;

  var currentRange = selection.getRangeAt(0);

  // If the node and offset values are the same, the selection is collapsed.
  // `Selection.isCollapsed` is available natively, but IE sometimes gets
  // this value wrong.
  var isSelectionCollapsed = isCollapsed(
    selection.anchorNode,
    selection.anchorOffset,
    selection.focusNode,
    selection.focusOffset
  );

  var rangeLength = isSelectionCollapsed ? 0 : currentRange.toString().length;

  var tempRange = currentRange.cloneRange();
  tempRange.selectNodeContents(node);
  tempRange.setEnd(currentRange.startContainer, currentRange.startOffset);

  var isTempRangeCollapsed = isCollapsed(
    tempRange.startContainer,
    tempRange.startOffset,
    tempRange.endContainer,
    tempRange.endOffset
  );

  var start = isTempRangeCollapsed ? 0 : tempRange.toString().length;
  var end = start + rangeLength;

  // Detect whether the selection is backward.
  var detectionRange = document.createRange();
  detectionRange.setStart(anchorNode, anchorOffset);
  detectionRange.setEnd(focusNode, focusOffset);
  var isBackward = detectionRange.collapsed;
  detectionRange.detach();

  return {
    start: isBackward ? end : start,
    end: isBackward ? start : end
  };
}

/**
 * @param {DOMElement|DOMTextNode} node
 * @param {object} offsets
 */
function setIEOffsets(node, offsets) {
  var range = document.selection.createRange().duplicate();
  var start, end;

  if (typeof offsets.end === 'undefined') {
    start = offsets.start;
    end = start;
  } else if (offsets.start > offsets.end) {
    start = offsets.end;
    end = offsets.start;
  } else {
    start = offsets.start;
    end = offsets.end;
  }

  range.moveToElementText(node);
  range.moveStart('character', start);
  range.setEndPoint('EndToStart', range);
  range.moveEnd('character', end - start);
  range.select();
}

/**
 * In modern non-IE browsers, we can support both forward and backward
 * selections.
 *
 * Note: IE10+ supports the Selection object, but it does not support
 * the `extend` method, which means that even in modern IE, it's not possible
 * to programatically create a backward selection. Thus, for all IE
 * versions, we use the old IE API to create our selections.
 *
 * @param {DOMElement|DOMTextNode} node
 * @param {object} offsets
 */
function setModernOffsets(node, offsets) {
  var selection = window.getSelection();

  var length = node[getTextContentAccessor()].length;
  var start = Math.min(offsets.start, length);
  var end = typeof offsets.end === 'undefined' ?
            start : Math.min(offsets.end, length);

  // IE 11 uses modern selection, but doesn't support the extend method.
  // Flip backward selections, so we can set with a single range.
  if (!selection.extend && start > end) {
    var temp = end;
    end = start;
    start = temp;
  }

  var startMarker = getNodeForCharacterOffset(node, start);
  var endMarker = getNodeForCharacterOffset(node, end);

  if (startMarker && endMarker) {
    var range = document.createRange();
    range.setStart(startMarker.node, startMarker.offset);
    selection.removeAllRanges();

    if (start > end) {
      selection.addRange(range);
      selection.extend(endMarker.node, endMarker.offset);
    } else {
      range.setEnd(endMarker.node, endMarker.offset);
      selection.addRange(range);
    }

    range.detach();
  }
}

var useIEOffsets = ExecutionEnvironment.canUseDOM && document.selection;

var ReactDOMSelection = {
  /**
   * @param {DOMElement} node
   */
  getOffsets: useIEOffsets ? getIEOffsets : getModernOffsets,

  /**
   * @param {DOMElement|DOMTextNode} node
   * @param {object} offsets
   */
  setOffsets: useIEOffsets ? setIEOffsets : setModernOffsets
};

module.exports = ReactDOMSelection;

},{"./ExecutionEnvironment":22,"./getNodeForCharacterOffset":127,"./getTextContentAccessor":129}],51:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDOMTextarea
 */



var AutoFocusMixin = _dereq_("./AutoFocusMixin");
var DOMPropertyOperations = _dereq_("./DOMPropertyOperations");
var LinkedValueUtils = _dereq_("./LinkedValueUtils");
var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");
var ReactDOM = _dereq_("./ReactDOM");

var invariant = _dereq_("./invariant");
var merge = _dereq_("./merge");

var warning = _dereq_("./warning");

// Store a reference to the <textarea> `ReactDOMComponent`.
var textarea = ReactDOM.textarea;

/**
 * Implements a <textarea> native component that allows setting `value`, and
 * `defaultValue`. This differs from the traditional DOM API because value is
 * usually set as PCDATA children.
 *
 * If `value` is not supplied (or null/undefined), user actions that affect the
 * value will trigger updates to the element.
 *
 * If `value` is supplied (and not null/undefined), the rendered element will
 * not trigger updates to the element. Instead, the `value` prop must change in
 * order for the rendered element to be updated.
 *
 * The rendered element will be initialized with an empty value, the prop
 * `defaultValue` if specified, or the children content (deprecated).
 */
var ReactDOMTextarea = ReactCompositeComponent.createClass({
  displayName: 'ReactDOMTextarea',

  mixins: [AutoFocusMixin, LinkedValueUtils.Mixin, ReactBrowserComponentMixin],

  getInitialState: function() {
    var defaultValue = this.props.defaultValue;
    // TODO (yungsters): Remove support for children content in <textarea>.
    var children = this.props.children;
    if (children != null) {
      if ("production" !== "development") {
        ("production" !== "development" ? warning(
          false,
          'Use the `defaultValue` or `value` props instead of setting ' +
          'children on <textarea>.'
        ) : null);
      }
      ("production" !== "development" ? invariant(
        defaultValue == null,
        'If you supply `defaultValue` on a <textarea>, do not pass children.'
      ) : invariant(defaultValue == null));
      if (Array.isArray(children)) {
        ("production" !== "development" ? invariant(
          children.length <= 1,
          '<textarea> can only have at most one child.'
        ) : invariant(children.length <= 1));
        children = children[0];
      }

      defaultValue = '' + children;
    }
    if (defaultValue == null) {
      defaultValue = '';
    }
    var value = LinkedValueUtils.getValue(this);
    return {
      // We save the initial value so that `ReactDOMComponent` doesn't update
      // `textContent` (unnecessary since we update value).
      // The initial value can be a boolean or object so that's why it's
      // forced to be a string.
      initialValue: '' + (value != null ? value : defaultValue)
    };
  },

  shouldComponentUpdate: function() {
    // Defer any updates to this component during the `onChange` handler.
    return !this._isChanging;
  },

  render: function() {
    // Clone `this.props` so we don't mutate the input.
    var props = merge(this.props);

    ("production" !== "development" ? invariant(
      props.dangerouslySetInnerHTML == null,
      '`dangerouslySetInnerHTML` does not make sense on <textarea>.'
    ) : invariant(props.dangerouslySetInnerHTML == null));

    props.defaultValue = null;
    props.value = null;
    props.onChange = this._handleChange;

    // Always set children to the same thing. In IE9, the selection range will
    // get reset if `textContent` is mutated.
    return textarea(props, this.state.initialValue);
  },

  componentDidUpdate: function(prevProps, prevState, prevContext) {
    var value = LinkedValueUtils.getValue(this);
    if (value != null) {
      var rootNode = this.getDOMNode();
      // Cast `value` to a string to ensure the value is set correctly. While
      // browsers typically do this as necessary, jsdom doesn't.
      DOMPropertyOperations.setValueForProperty(rootNode, 'value', '' + value);
    }
  },

  _handleChange: function(event) {
    var returnValue;
    var onChange = LinkedValueUtils.getOnChange(this);
    if (onChange) {
      this._isChanging = true;
      returnValue = onChange.call(this, event);
      this._isChanging = false;
    }
    this.setState({value: event.target.value});
    return returnValue;
  }

});

module.exports = ReactDOMTextarea;

},{"./AutoFocusMixin":1,"./DOMPropertyOperations":12,"./LinkedValueUtils":25,"./ReactBrowserComponentMixin":30,"./ReactCompositeComponent":38,"./ReactDOM":41,"./invariant":134,"./merge":144,"./warning":158}],52:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDefaultBatchingStrategy
 */



var ReactUpdates = _dereq_("./ReactUpdates");
var Transaction = _dereq_("./Transaction");

var emptyFunction = _dereq_("./emptyFunction");
var mixInto = _dereq_("./mixInto");

var RESET_BATCHED_UPDATES = {
  initialize: emptyFunction,
  close: function() {
    ReactDefaultBatchingStrategy.isBatchingUpdates = false;
  }
};

var FLUSH_BATCHED_UPDATES = {
  initialize: emptyFunction,
  close: ReactUpdates.flushBatchedUpdates.bind(ReactUpdates)
};

var TRANSACTION_WRAPPERS = [FLUSH_BATCHED_UPDATES, RESET_BATCHED_UPDATES];

function ReactDefaultBatchingStrategyTransaction() {
  this.reinitializeTransaction();
}

mixInto(ReactDefaultBatchingStrategyTransaction, Transaction.Mixin);
mixInto(ReactDefaultBatchingStrategyTransaction, {
  getTransactionWrappers: function() {
    return TRANSACTION_WRAPPERS;
  }
});

var transaction = new ReactDefaultBatchingStrategyTransaction();

var ReactDefaultBatchingStrategy = {
  isBatchingUpdates: false,

  /**
   * Call the provided function in a context within which calls to `setState`
   * and friends are batched such that components aren't updated unnecessarily.
   */
  batchedUpdates: function(callback, a, b) {
    var alreadyBatchingUpdates = ReactDefaultBatchingStrategy.isBatchingUpdates;

    ReactDefaultBatchingStrategy.isBatchingUpdates = true;

    // The code is written this way to avoid extra allocations
    if (alreadyBatchingUpdates) {
      callback(a, b);
    } else {
      transaction.perform(callback, null, a, b);
    }
  }
};

module.exports = ReactDefaultBatchingStrategy;

},{"./ReactUpdates":87,"./Transaction":104,"./emptyFunction":116,"./mixInto":147}],53:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDefaultInjection
 */



var BeforeInputEventPlugin = _dereq_("./BeforeInputEventPlugin");
var ChangeEventPlugin = _dereq_("./ChangeEventPlugin");
var ClientReactRootIndex = _dereq_("./ClientReactRootIndex");
var CompositionEventPlugin = _dereq_("./CompositionEventPlugin");
var DefaultEventPluginOrder = _dereq_("./DefaultEventPluginOrder");
var EnterLeaveEventPlugin = _dereq_("./EnterLeaveEventPlugin");
var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");
var HTMLDOMPropertyConfig = _dereq_("./HTMLDOMPropertyConfig");
var MobileSafariClickEventPlugin = _dereq_("./MobileSafariClickEventPlugin");
var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactComponentBrowserEnvironment =
  _dereq_("./ReactComponentBrowserEnvironment");
var ReactDefaultBatchingStrategy = _dereq_("./ReactDefaultBatchingStrategy");
var ReactDOM = _dereq_("./ReactDOM");
var ReactDOMButton = _dereq_("./ReactDOMButton");
var ReactDOMForm = _dereq_("./ReactDOMForm");
var ReactDOMImg = _dereq_("./ReactDOMImg");
var ReactDOMInput = _dereq_("./ReactDOMInput");
var ReactDOMOption = _dereq_("./ReactDOMOption");
var ReactDOMSelect = _dereq_("./ReactDOMSelect");
var ReactDOMTextarea = _dereq_("./ReactDOMTextarea");
var ReactEventListener = _dereq_("./ReactEventListener");
var ReactInjection = _dereq_("./ReactInjection");
var ReactInstanceHandles = _dereq_("./ReactInstanceHandles");
var ReactMount = _dereq_("./ReactMount");
var SelectEventPlugin = _dereq_("./SelectEventPlugin");
var ServerReactRootIndex = _dereq_("./ServerReactRootIndex");
var SimpleEventPlugin = _dereq_("./SimpleEventPlugin");
var SVGDOMPropertyConfig = _dereq_("./SVGDOMPropertyConfig");

var createFullPageComponent = _dereq_("./createFullPageComponent");

function inject() {
  ReactInjection.EventEmitter.injectReactEventListener(
    ReactEventListener
  );

  /**
   * Inject modules for resolving DOM hierarchy and plugin ordering.
   */
  ReactInjection.EventPluginHub.injectEventPluginOrder(DefaultEventPluginOrder);
  ReactInjection.EventPluginHub.injectInstanceHandle(ReactInstanceHandles);
  ReactInjection.EventPluginHub.injectMount(ReactMount);

  /**
   * Some important event plugins included by default (without having to require
   * them).
   */
  ReactInjection.EventPluginHub.injectEventPluginsByName({
    SimpleEventPlugin: SimpleEventPlugin,
    EnterLeaveEventPlugin: EnterLeaveEventPlugin,
    ChangeEventPlugin: ChangeEventPlugin,
    CompositionEventPlugin: CompositionEventPlugin,
    MobileSafariClickEventPlugin: MobileSafariClickEventPlugin,
    SelectEventPlugin: SelectEventPlugin,
    BeforeInputEventPlugin: BeforeInputEventPlugin
  });

  ReactInjection.DOM.injectComponentClasses({
    button: ReactDOMButton,
    form: ReactDOMForm,
    img: ReactDOMImg,
    input: ReactDOMInput,
    option: ReactDOMOption,
    select: ReactDOMSelect,
    textarea: ReactDOMTextarea,

    html: createFullPageComponent(ReactDOM.html),
    head: createFullPageComponent(ReactDOM.head),
    body: createFullPageComponent(ReactDOM.body)
  });

  // This needs to happen after createFullPageComponent() otherwise the mixin
  // gets double injected.
  ReactInjection.CompositeComponent.injectMixin(ReactBrowserComponentMixin);

  ReactInjection.DOMProperty.injectDOMPropertyConfig(HTMLDOMPropertyConfig);
  ReactInjection.DOMProperty.injectDOMPropertyConfig(SVGDOMPropertyConfig);

  ReactInjection.EmptyComponent.injectEmptyComponent(ReactDOM.noscript);

  ReactInjection.Updates.injectReconcileTransaction(
    ReactComponentBrowserEnvironment.ReactReconcileTransaction
  );
  ReactInjection.Updates.injectBatchingStrategy(
    ReactDefaultBatchingStrategy
  );

  ReactInjection.RootIndex.injectCreateReactRootIndex(
    ExecutionEnvironment.canUseDOM ?
      ClientReactRootIndex.createReactRootIndex :
      ServerReactRootIndex.createReactRootIndex
  );

  ReactInjection.Component.injectEnvironment(ReactComponentBrowserEnvironment);

  if ("production" !== "development") {
    var url = (ExecutionEnvironment.canUseDOM && window.location.href) || '';
    if ((/[?&]react_perf\b/).test(url)) {
      var ReactDefaultPerf = _dereq_("./ReactDefaultPerf");
      ReactDefaultPerf.start();
    }
  }
}

module.exports = {
  inject: inject
};

},{"./BeforeInputEventPlugin":2,"./ChangeEventPlugin":7,"./ClientReactRootIndex":8,"./CompositionEventPlugin":9,"./DefaultEventPluginOrder":14,"./EnterLeaveEventPlugin":15,"./ExecutionEnvironment":22,"./HTMLDOMPropertyConfig":23,"./MobileSafariClickEventPlugin":27,"./ReactBrowserComponentMixin":30,"./ReactComponentBrowserEnvironment":36,"./ReactDOM":41,"./ReactDOMButton":42,"./ReactDOMForm":44,"./ReactDOMImg":46,"./ReactDOMInput":47,"./ReactDOMOption":48,"./ReactDOMSelect":49,"./ReactDOMTextarea":51,"./ReactDefaultBatchingStrategy":52,"./ReactDefaultPerf":54,"./ReactEventListener":61,"./ReactInjection":62,"./ReactInstanceHandles":64,"./ReactMount":67,"./SVGDOMPropertyConfig":89,"./SelectEventPlugin":90,"./ServerReactRootIndex":91,"./SimpleEventPlugin":92,"./createFullPageComponent":112}],54:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDefaultPerf
 * @typechecks static-only
 */



var DOMProperty = _dereq_("./DOMProperty");
var ReactDefaultPerfAnalysis = _dereq_("./ReactDefaultPerfAnalysis");
var ReactMount = _dereq_("./ReactMount");
var ReactPerf = _dereq_("./ReactPerf");

var performanceNow = _dereq_("./performanceNow");

function roundFloat(val) {
  return Math.floor(val * 100) / 100;
}

function addValue(obj, key, val) {
  obj[key] = (obj[key] || 0) + val;
}

var ReactDefaultPerf = {
  _allMeasurements: [], // last item in the list is the current one
  _mountStack: [0],
  _injected: false,

  start: function() {
    if (!ReactDefaultPerf._injected) {
      ReactPerf.injection.injectMeasure(ReactDefaultPerf.measure);
    }

    ReactDefaultPerf._allMeasurements.length = 0;
    ReactPerf.enableMeasure = true;
  },

  stop: function() {
    ReactPerf.enableMeasure = false;
  },

  getLastMeasurements: function() {
    return ReactDefaultPerf._allMeasurements;
  },

  printExclusive: function(measurements) {
    measurements = measurements || ReactDefaultPerf._allMeasurements;
    var summary = ReactDefaultPerfAnalysis.getExclusiveSummary(measurements);
    console.table(summary.map(function(item) {
      return {
        'Component class name': item.componentName,
        'Total inclusive time (ms)': roundFloat(item.inclusive),
        'Exclusive mount time (ms)': roundFloat(item.exclusive),
        'Exclusive render time (ms)': roundFloat(item.render),
        'Mount time per instance (ms)': roundFloat(item.exclusive / item.count),
        'Render time per instance (ms)': roundFloat(item.render / item.count),
        'Instances': item.count
      };
    }));
    // TODO: ReactDefaultPerfAnalysis.getTotalTime() does not return the correct
    // number.
  },

  printInclusive: function(measurements) {
    measurements = measurements || ReactDefaultPerf._allMeasurements;
    var summary = ReactDefaultPerfAnalysis.getInclusiveSummary(measurements);
    console.table(summary.map(function(item) {
      return {
        'Owner > component': item.componentName,
        'Inclusive time (ms)': roundFloat(item.time),
        'Instances': item.count
      };
    }));
    console.log(
      'Total time:',
      ReactDefaultPerfAnalysis.getTotalTime(measurements).toFixed(2) + ' ms'
    );
  },

  printWasted: function(measurements) {
    measurements = measurements || ReactDefaultPerf._allMeasurements;
    var summary = ReactDefaultPerfAnalysis.getInclusiveSummary(
      measurements,
      true
    );
    console.table(summary.map(function(item) {
      return {
        'Owner > component': item.componentName,
        'Wasted time (ms)': item.time,
        'Instances': item.count
      };
    }));
    console.log(
      'Total time:',
      ReactDefaultPerfAnalysis.getTotalTime(measurements).toFixed(2) + ' ms'
    );
  },

  printDOM: function(measurements) {
    measurements = measurements || ReactDefaultPerf._allMeasurements;
    var summary = ReactDefaultPerfAnalysis.getDOMSummary(measurements);
    console.table(summary.map(function(item) {
      var result = {};
      result[DOMProperty.ID_ATTRIBUTE_NAME] = item.id;
      result['type'] = item.type;
      result['args'] = JSON.stringify(item.args);
      return result;
    }));
    console.log(
      'Total time:',
      ReactDefaultPerfAnalysis.getTotalTime(measurements).toFixed(2) + ' ms'
    );
  },

  _recordWrite: function(id, fnName, totalTime, args) {
    // TODO: totalTime isn't that useful since it doesn't count paints/reflows
    var writes =
      ReactDefaultPerf
        ._allMeasurements[ReactDefaultPerf._allMeasurements.length - 1]
        .writes;
    writes[id] = writes[id] || [];
    writes[id].push({
      type: fnName,
      time: totalTime,
      args: args
    });
  },

  measure: function(moduleName, fnName, func) {
    return function() {var args=Array.prototype.slice.call(arguments,0);
      var totalTime;
      var rv;
      var start;

      if (fnName === '_renderNewRootComponent' ||
          fnName === 'flushBatchedUpdates') {
        // A "measurement" is a set of metrics recorded for each flush. We want
        // to group the metrics for a given flush together so we can look at the
        // components that rendered and the DOM operations that actually
        // happened to determine the amount of "wasted work" performed.
        ReactDefaultPerf._allMeasurements.push({
          exclusive: {},
          inclusive: {},
          render: {},
          counts: {},
          writes: {},
          displayNames: {},
          totalTime: 0
        });
        start = performanceNow();
        rv = func.apply(this, args);
        ReactDefaultPerf._allMeasurements[
          ReactDefaultPerf._allMeasurements.length - 1
        ].totalTime = performanceNow() - start;
        return rv;
      } else if (moduleName === 'ReactDOMIDOperations' ||
        moduleName === 'ReactComponentBrowserEnvironment') {
        start = performanceNow();
        rv = func.apply(this, args);
        totalTime = performanceNow() - start;

        if (fnName === 'mountImageIntoNode') {
          var mountID = ReactMount.getID(args[1]);
          ReactDefaultPerf._recordWrite(mountID, fnName, totalTime, args[0]);
        } else if (fnName === 'dangerouslyProcessChildrenUpdates') {
          // special format
          args[0].forEach(function(update) {
            var writeArgs = {};
            if (update.fromIndex !== null) {
              writeArgs.fromIndex = update.fromIndex;
            }
            if (update.toIndex !== null) {
              writeArgs.toIndex = update.toIndex;
            }
            if (update.textContent !== null) {
              writeArgs.textContent = update.textContent;
            }
            if (update.markupIndex !== null) {
              writeArgs.markup = args[1][update.markupIndex];
            }
            ReactDefaultPerf._recordWrite(
              update.parentID,
              update.type,
              totalTime,
              writeArgs
            );
          });
        } else {
          // basic format
          ReactDefaultPerf._recordWrite(
            args[0],
            fnName,
            totalTime,
            Array.prototype.slice.call(args, 1)
          );
        }
        return rv;
      } else if (moduleName === 'ReactCompositeComponent' && (
        fnName === 'mountComponent' ||
        fnName === 'updateComponent' || // TODO: receiveComponent()?
        fnName === '_renderValidatedComponent')) {

        var rootNodeID = fnName === 'mountComponent' ?
          args[0] :
          this._rootNodeID;
        var isRender = fnName === '_renderValidatedComponent';
        var isMount = fnName === 'mountComponent';

        var mountStack = ReactDefaultPerf._mountStack;
        var entry = ReactDefaultPerf._allMeasurements[
          ReactDefaultPerf._allMeasurements.length - 1
        ];

        if (isRender) {
          addValue(entry.counts, rootNodeID, 1);
        } else if (isMount) {
          mountStack.push(0);
        }

        start = performanceNow();
        rv = func.apply(this, args);
        totalTime = performanceNow() - start;

        if (isRender) {
          addValue(entry.render, rootNodeID, totalTime);
        } else if (isMount) {
          var subMountTime = mountStack.pop();
          mountStack[mountStack.length - 1] += totalTime;
          addValue(entry.exclusive, rootNodeID, totalTime - subMountTime);
          addValue(entry.inclusive, rootNodeID, totalTime);
        } else {
          addValue(entry.inclusive, rootNodeID, totalTime);
        }

        entry.displayNames[rootNodeID] = {
          current: this.constructor.displayName,
          owner: this._owner ? this._owner.constructor.displayName : '<root>'
        };

        return rv;
      } else {
        return func.apply(this, args);
      }
    };
  }
};

module.exports = ReactDefaultPerf;

},{"./DOMProperty":11,"./ReactDefaultPerfAnalysis":55,"./ReactMount":67,"./ReactPerf":71,"./performanceNow":151}],55:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDefaultPerfAnalysis
 */

var merge = _dereq_("./merge");

// Don't try to save users less than 1.2ms (a number I made up)
var DONT_CARE_THRESHOLD = 1.2;
var DOM_OPERATION_TYPES = {
  'mountImageIntoNode': 'set innerHTML',
  INSERT_MARKUP: 'set innerHTML',
  MOVE_EXISTING: 'move',
  REMOVE_NODE: 'remove',
  TEXT_CONTENT: 'set textContent',
  'updatePropertyByID': 'update attribute',
  'deletePropertyByID': 'delete attribute',
  'updateStylesByID': 'update styles',
  'updateInnerHTMLByID': 'set innerHTML',
  'dangerouslyReplaceNodeWithMarkupByID': 'replace'
};

function getTotalTime(measurements) {
  // TODO: return number of DOM ops? could be misleading.
  // TODO: measure dropped frames after reconcile?
  // TODO: log total time of each reconcile and the top-level component
  // class that triggered it.
  var totalTime = 0;
  for (var i = 0; i < measurements.length; i++) {
    var measurement = measurements[i];
    totalTime += measurement.totalTime;
  }
  return totalTime;
}

function getDOMSummary(measurements) {
  var items = [];
  for (var i = 0; i < measurements.length; i++) {
    var measurement = measurements[i];
    var id;

    for (id in measurement.writes) {
      measurement.writes[id].forEach(function(write) {
        items.push({
          id: id,
          type: DOM_OPERATION_TYPES[write.type] || write.type,
          args: write.args
        });
      });
    }
  }
  return items;
}

function getExclusiveSummary(measurements) {
  var candidates = {};
  var displayName;

  for (var i = 0; i < measurements.length; i++) {
    var measurement = measurements[i];
    var allIDs = merge(measurement.exclusive, measurement.inclusive);

    for (var id in allIDs) {
      displayName = measurement.displayNames[id].current;

      candidates[displayName] = candidates[displayName] || {
        componentName: displayName,
        inclusive: 0,
        exclusive: 0,
        render: 0,
        count: 0
      };
      if (measurement.render[id]) {
        candidates[displayName].render += measurement.render[id];
      }
      if (measurement.exclusive[id]) {
        candidates[displayName].exclusive += measurement.exclusive[id];
      }
      if (measurement.inclusive[id]) {
        candidates[displayName].inclusive += measurement.inclusive[id];
      }
      if (measurement.counts[id]) {
        candidates[displayName].count += measurement.counts[id];
      }
    }
  }

  // Now make a sorted array with the results.
  var arr = [];
  for (displayName in candidates) {
    if (candidates[displayName].exclusive >= DONT_CARE_THRESHOLD) {
      arr.push(candidates[displayName]);
    }
  }

  arr.sort(function(a, b) {
    return b.exclusive - a.exclusive;
  });

  return arr;
}

function getInclusiveSummary(measurements, onlyClean) {
  var candidates = {};
  var inclusiveKey;

  for (var i = 0; i < measurements.length; i++) {
    var measurement = measurements[i];
    var allIDs = merge(measurement.exclusive, measurement.inclusive);
    var cleanComponents;

    if (onlyClean) {
      cleanComponents = getUnchangedComponents(measurement);
    }

    for (var id in allIDs) {
      if (onlyClean && !cleanComponents[id]) {
        continue;
      }

      var displayName = measurement.displayNames[id];

      // Inclusive time is not useful for many components without knowing where
      // they are instantiated. So we aggregate inclusive time with both the
      // owner and current displayName as the key.
      inclusiveKey = displayName.owner + ' > ' + displayName.current;

      candidates[inclusiveKey] = candidates[inclusiveKey] || {
        componentName: inclusiveKey,
        time: 0,
        count: 0
      };

      if (measurement.inclusive[id]) {
        candidates[inclusiveKey].time += measurement.inclusive[id];
      }
      if (measurement.counts[id]) {
        candidates[inclusiveKey].count += measurement.counts[id];
      }
    }
  }

  // Now make a sorted array with the results.
  var arr = [];
  for (inclusiveKey in candidates) {
    if (candidates[inclusiveKey].time >= DONT_CARE_THRESHOLD) {
      arr.push(candidates[inclusiveKey]);
    }
  }

  arr.sort(function(a, b) {
    return b.time - a.time;
  });

  return arr;
}

function getUnchangedComponents(measurement) {
  // For a given reconcile, look at which components did not actually
  // render anything to the DOM and return a mapping of their ID to
  // the amount of time it took to render the entire subtree.
  var cleanComponents = {};
  var dirtyLeafIDs = Object.keys(measurement.writes);
  var allIDs = merge(measurement.exclusive, measurement.inclusive);

  for (var id in allIDs) {
    var isDirty = false;
    // For each component that rendered, see if a component that triggerd
    // a DOM op is in its subtree.
    for (var i = 0; i < dirtyLeafIDs.length; i++) {
      if (dirtyLeafIDs[i].indexOf(id) === 0) {
        isDirty = true;
        break;
      }
    }
    if (!isDirty && measurement.counts[id] > 0) {
      cleanComponents[id] = true;
    }
  }
  return cleanComponents;
}

var ReactDefaultPerfAnalysis = {
  getExclusiveSummary: getExclusiveSummary,
  getInclusiveSummary: getInclusiveSummary,
  getDOMSummary: getDOMSummary,
  getTotalTime: getTotalTime
};

module.exports = ReactDefaultPerfAnalysis;

},{"./merge":144}],56:[function(_dereq_,module,exports){
/**
 * Copyright 2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDescriptor
 */



var ReactContext = _dereq_("./ReactContext");
var ReactCurrentOwner = _dereq_("./ReactCurrentOwner");

var merge = _dereq_("./merge");
var warning = _dereq_("./warning");

/**
 * Warn for mutations.
 *
 * @internal
 * @param {object} object
 * @param {string} key
 */
function defineWarningProperty(object, key) {
  Object.defineProperty(object, key, {

    configurable: false,
    enumerable: true,

    get: function() {
      if (!this._store) {
        return null;
      }
      return this._store[key];
    },

    set: function(value) {
      ("production" !== "development" ? warning(
        false,
        'Don\'t set the ' + key + ' property of the component. ' +
        'Mutate the existing props object instead.'
      ) : null);
      this._store[key] = value;
    }

  });
}

/**
 * This is updated to true if the membrane is successfully created.
 */
var useMutationMembrane = false;

/**
 * Warn for mutations.
 *
 * @internal
 * @param {object} descriptor
 */
function defineMutationMembrane(prototype) {
  try {
    var pseudoFrozenProperties = {
      props: true
    };
    for (var key in pseudoFrozenProperties) {
      defineWarningProperty(prototype, key);
    }
    useMutationMembrane = true;
  } catch (x) {
    // IE will fail on defineProperty
  }
}

/**
 * Transfer static properties from the source to the target. Functions are
 * rebound to have this reflect the original source.
 */
function proxyStaticMethods(target, source) {
  if (typeof source !== 'function') {
    return;
  }
  for (var key in source) {
    if (source.hasOwnProperty(key)) {
      var value = source[key];
      if (typeof value === 'function') {
        var bound = value.bind(source);
        // Copy any properties defined on the function, such as `isRequired` on
        // a PropTypes validator. (mergeInto refuses to work on functions.)
        for (var k in value) {
          if (value.hasOwnProperty(k)) {
            bound[k] = value[k];
          }
        }
        target[key] = bound;
      } else {
        target[key] = value;
      }
    }
  }
}

/**
 * Base constructor for all React descriptors. This is only used to make this
 * work with a dynamic instanceof check. Nothing should live on this prototype.
 *
 * @param {*} type
 * @internal
 */
var ReactDescriptor = function() {};

if ("production" !== "development") {
  defineMutationMembrane(ReactDescriptor.prototype);
}

ReactDescriptor.createFactory = function(type) {

  var descriptorPrototype = Object.create(ReactDescriptor.prototype);

  var factory = function(props, children) {
    // For consistency we currently allocate a new object for every descriptor.
    // This protects the descriptor from being mutated by the original props
    // object being mutated. It also protects the original props object from
    // being mutated by children arguments and default props. This behavior
    // comes with a performance cost and could be deprecated in the future.
    // It could also be optimized with a smarter JSX transform.
    if (props == null) {
      props = {};
    } else if (typeof props === 'object') {
      props = merge(props);
    }

    // Children can be more than one argument, and those are transferred onto
    // the newly allocated props object.
    var childrenLength = arguments.length - 1;
    if (childrenLength === 1) {
      props.children = children;
    } else if (childrenLength > 1) {
      var childArray = Array(childrenLength);
      for (var i = 0; i < childrenLength; i++) {
        childArray[i] = arguments[i + 1];
      }
      props.children = childArray;
    }

    // Initialize the descriptor object
    var descriptor = Object.create(descriptorPrototype);

    // Record the component responsible for creating this descriptor.
    descriptor._owner = ReactCurrentOwner.current;

    // TODO: Deprecate withContext, and then the context becomes accessible
    // through the owner.
    descriptor._context = ReactContext.current;

    if ("production" !== "development") {
      // The validation flag and props are currently mutative. We put them on
      // an external backing store so that we can freeze the whole object.
      // This can be replaced with a WeakMap once they are implemented in
      // commonly used development environments.
      descriptor._store = { validated: false, props: props };

      // We're not allowed to set props directly on the object so we early
      // return and rely on the prototype membrane to forward to the backing
      // store.
      if (useMutationMembrane) {
        Object.freeze(descriptor);
        return descriptor;
      }
    }

    descriptor.props = props;
    return descriptor;
  };

  // Currently we expose the prototype of the descriptor so that
  // <Foo /> instanceof Foo works. This is controversial pattern.
  factory.prototype = descriptorPrototype;

  // Expose the type on the factory and the prototype so that it can be
  // easily accessed on descriptors. E.g. <Foo />.type === Foo.type and for
  // static methods like <Foo />.type.staticMethod();
  // This should not be named constructor since this may not be the function
  // that created the descriptor, and it may not even be a constructor.
  factory.type = type;
  descriptorPrototype.type = type;

  proxyStaticMethods(factory, type);

  // Expose a unique constructor on the prototype is that this works with type
  // systems that compare constructor properties: <Foo />.constructor === Foo
  // This may be controversial since it requires a known factory function.
  descriptorPrototype.constructor = factory;

  return factory;

};

ReactDescriptor.cloneAndReplaceProps = function(oldDescriptor, newProps) {
  var newDescriptor = Object.create(oldDescriptor.constructor.prototype);
  // It's important that this property order matches the hidden class of the
  // original descriptor to maintain perf.
  newDescriptor._owner = oldDescriptor._owner;
  newDescriptor._context = oldDescriptor._context;

  if ("production" !== "development") {
    newDescriptor._store = {
      validated: oldDescriptor._store.validated,
      props: newProps
    };
    if (useMutationMembrane) {
      Object.freeze(newDescriptor);
      return newDescriptor;
    }
  }

  newDescriptor.props = newProps;
  return newDescriptor;
};

/**
 * Checks if a value is a valid descriptor constructor.
 *
 * @param {*}
 * @return {boolean}
 * @public
 */
ReactDescriptor.isValidFactory = function(factory) {
  return typeof factory === 'function' &&
         factory.prototype instanceof ReactDescriptor;
};

/**
 * @param {?object} object
 * @return {boolean} True if `object` is a valid component.
 * @final
 */
ReactDescriptor.isValidDescriptor = function(object) {
  return object instanceof ReactDescriptor;
};

module.exports = ReactDescriptor;

},{"./ReactContext":39,"./ReactCurrentOwner":40,"./merge":144,"./warning":158}],57:[function(_dereq_,module,exports){
/**
 * Copyright 2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactDescriptorValidator
 */

/**
 * ReactDescriptorValidator provides a wrapper around a descriptor factory
 * which validates the props passed to the descriptor. This is intended to be
 * used only in DEV and could be replaced by a static type checker for languages
 * that support it.
 */



var ReactDescriptor = _dereq_("./ReactDescriptor");
var ReactPropTypeLocations = _dereq_("./ReactPropTypeLocations");
var ReactCurrentOwner = _dereq_("./ReactCurrentOwner");

var monitorCodeUse = _dereq_("./monitorCodeUse");

/**
 * Warn if there's no key explicitly set on dynamic arrays of children or
 * object keys are not valid. This allows us to keep track of children between
 * updates.
 */
var ownerHasKeyUseWarning = {
  'react_key_warning': {},
  'react_numeric_key_warning': {}
};
var ownerHasMonitoredObjectMap = {};

var loggedTypeFailures = {};

var NUMERIC_PROPERTY_REGEX = /^\d+$/;

/**
 * Gets the current owner's displayName for use in warnings.
 *
 * @internal
 * @return {?string} Display name or undefined
 */
function getCurrentOwnerDisplayName() {
  var current = ReactCurrentOwner.current;
  return current && current.constructor.displayName || undefined;
}

/**
 * Warn if the component doesn't have an explicit key assigned to it.
 * This component is in an array. The array could grow and shrink or be
 * reordered. All children that haven't already been validated are required to
 * have a "key" property assigned to it.
 *
 * @internal
 * @param {ReactComponent} component Component that requires a key.
 * @param {*} parentType component's parent's type.
 */
function validateExplicitKey(component, parentType) {
  if (component._store.validated || component.props.key != null) {
    return;
  }
  component._store.validated = true;

  warnAndMonitorForKeyUse(
    'react_key_warning',
    'Each child in an array should have a unique "key" prop.',
    component,
    parentType
  );
}

/**
 * Warn if the key is being defined as an object property but has an incorrect
 * value.
 *
 * @internal
 * @param {string} name Property name of the key.
 * @param {ReactComponent} component Component that requires a key.
 * @param {*} parentType component's parent's type.
 */
function validatePropertyKey(name, component, parentType) {
  if (!NUMERIC_PROPERTY_REGEX.test(name)) {
    return;
  }
  warnAndMonitorForKeyUse(
    'react_numeric_key_warning',
    'Child objects should have non-numeric keys so ordering is preserved.',
    component,
    parentType
  );
}

/**
 * Shared warning and monitoring code for the key warnings.
 *
 * @internal
 * @param {string} warningID The id used when logging.
 * @param {string} message The base warning that gets output.
 * @param {ReactComponent} component Component that requires a key.
 * @param {*} parentType component's parent's type.
 */
function warnAndMonitorForKeyUse(warningID, message, component, parentType) {
  var ownerName = getCurrentOwnerDisplayName();
  var parentName = parentType.displayName;

  var useName = ownerName || parentName;
  var memoizer = ownerHasKeyUseWarning[warningID];
  if (memoizer.hasOwnProperty(useName)) {
    return;
  }
  memoizer[useName] = true;

  message += ownerName ?
    (" Check the render method of " + ownerName + ".") :
    (" Check the renderComponent call using <" + parentName + ">.");

  // Usually the current owner is the offender, but if it accepts children as a
  // property, it may be the creator of the child that's responsible for
  // assigning it a key.
  var childOwnerName = null;
  if (component._owner && component._owner !== ReactCurrentOwner.current) {
    // Name of the component that originally created this child.
    childOwnerName = component._owner.constructor.displayName;

    message += (" It was passed a child from " + childOwnerName + ".");
  }

  message += ' See http://fb.me/react-warning-keys for more information.';
  monitorCodeUse(warningID, {
    component: useName,
    componentOwner: childOwnerName
  });
  console.warn(message);
}

/**
 * Log that we're using an object map. We're considering deprecating this
 * feature and replace it with proper Map and ImmutableMap data structures.
 *
 * @internal
 */
function monitorUseOfObjectMap() {
  var currentName = getCurrentOwnerDisplayName() || '';
  if (ownerHasMonitoredObjectMap.hasOwnProperty(currentName)) {
    return;
  }
  ownerHasMonitoredObjectMap[currentName] = true;
  monitorCodeUse('react_object_map_children');
}

/**
 * Ensure that every component either is passed in a static location, in an
 * array with an explicit keys property defined, or in an object literal
 * with valid key property.
 *
 * @internal
 * @param {*} component Statically passed child of any type.
 * @param {*} parentType component's parent's type.
 * @return {boolean}
 */
function validateChildKeys(component, parentType) {
  if (Array.isArray(component)) {
    for (var i = 0; i < component.length; i++) {
      var child = component[i];
      if (ReactDescriptor.isValidDescriptor(child)) {
        validateExplicitKey(child, parentType);
      }
    }
  } else if (ReactDescriptor.isValidDescriptor(component)) {
    // This component was passed in a valid location.
    component._store.validated = true;
  } else if (component && typeof component === 'object') {
    monitorUseOfObjectMap();
    for (var name in component) {
      validatePropertyKey(name, component[name], parentType);
    }
  }
}

/**
 * Assert that the props are valid
 *
 * @param {string} componentName Name of the component for error messages.
 * @param {object} propTypes Map of prop name to a ReactPropType
 * @param {object} props
 * @param {string} location e.g. "prop", "context", "child context"
 * @private
 */
function checkPropTypes(componentName, propTypes, props, location) {
  for (var propName in propTypes) {
    if (propTypes.hasOwnProperty(propName)) {
      var error;
      // Prop type validation may throw. In case they do, we don't want to
      // fail the render phase where it didn't fail before. So we log it.
      // After these have been cleaned up, we'll let them throw.
      try {
        error = propTypes[propName](props, propName, componentName, location);
      } catch (ex) {
        error = ex;
      }
      if (error instanceof Error && !(error.message in loggedTypeFailures)) {
        // Only monitor this failure once because there tends to be a lot of the
        // same error.
        loggedTypeFailures[error.message] = true;
        // This will soon use the warning module
        monitorCodeUse(
          'react_failed_descriptor_type_check',
          { message: error.message }
        );
      }
    }
  }
}

var ReactDescriptorValidator = {

  /**
   * Wraps a descriptor factory function in another function which validates
   * the props and context of the descriptor and warns about any failed type
   * checks.
   *
   * @param {function} factory The original descriptor factory
   * @param {object?} propTypes A prop type definition set
   * @param {object?} contextTypes A context type definition set
   * @return {object} The component descriptor, which may be invalid.
   * @private
   */
  createFactory: function(factory, propTypes, contextTypes) {
    var validatedFactory = function(props, children) {
      var descriptor = factory.apply(this, arguments);

      for (var i = 1; i < arguments.length; i++) {
        validateChildKeys(arguments[i], descriptor.type);
      }

      var name = descriptor.type.displayName;
      if (propTypes) {
        checkPropTypes(
          name,
          propTypes,
          descriptor.props,
          ReactPropTypeLocations.prop
        );
      }
      if (contextTypes) {
        checkPropTypes(
          name,
          contextTypes,
          descriptor._context,
          ReactPropTypeLocations.context
        );
      }
      return descriptor;
    };

    validatedFactory.prototype = factory.prototype;
    validatedFactory.type = factory.type;

    // Copy static properties
    for (var key in factory) {
      if (factory.hasOwnProperty(key)) {
        validatedFactory[key] = factory[key];
      }
    }

    return validatedFactory;
  }

};

module.exports = ReactDescriptorValidator;

},{"./ReactCurrentOwner":40,"./ReactDescriptor":56,"./ReactPropTypeLocations":74,"./monitorCodeUse":148}],58:[function(_dereq_,module,exports){
/**
 * Copyright 2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactEmptyComponent
 */



var invariant = _dereq_("./invariant");

var component;
// This registry keeps track of the React IDs of the components that rendered to
// `null` (in reality a placeholder such as `noscript`)
var nullComponentIdsRegistry = {};

var ReactEmptyComponentInjection = {
  injectEmptyComponent: function(emptyComponent) {
    component = emptyComponent;
  }
};

/**
 * @return {ReactComponent} component The injected empty component.
 */
function getEmptyComponent() {
  ("production" !== "development" ? invariant(
    component,
    'Trying to return null from a render, but no null placeholder component ' +
    'was injected.'
  ) : invariant(component));
  return component();
}

/**
 * Mark the component as having rendered to null.
 * @param {string} id Component's `_rootNodeID`.
 */
function registerNullComponentID(id) {
  nullComponentIdsRegistry[id] = true;
}

/**
 * Unmark the component as having rendered to null: it renders to something now.
 * @param {string} id Component's `_rootNodeID`.
 */
function deregisterNullComponentID(id) {
  delete nullComponentIdsRegistry[id];
}

/**
 * @param {string} id Component's `_rootNodeID`.
 * @return {boolean} True if the component is rendered to null.
 */
function isNullComponentID(id) {
  return nullComponentIdsRegistry[id];
}

var ReactEmptyComponent = {
  deregisterNullComponentID: deregisterNullComponentID,
  getEmptyComponent: getEmptyComponent,
  injection: ReactEmptyComponentInjection,
  isNullComponentID: isNullComponentID,
  registerNullComponentID: registerNullComponentID
};

module.exports = ReactEmptyComponent;

},{"./invariant":134}],59:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactErrorUtils
 * @typechecks
 */



var ReactErrorUtils = {
  /**
   * Creates a guarded version of a function. This is supposed to make debugging
   * of event handlers easier. To aid debugging with the browser's debugger,
   * this currently simply returns the original function.
   *
   * @param {function} func Function to be executed
   * @param {string} name The name of the guard
   * @return {function}
   */
  guard: function(func, name) {
    return func;
  }
};

module.exports = ReactErrorUtils;

},{}],60:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactEventEmitterMixin
 */



var EventPluginHub = _dereq_("./EventPluginHub");

function runEventQueueInBatch(events) {
  EventPluginHub.enqueueEvents(events);
  EventPluginHub.processEventQueue();
}

var ReactEventEmitterMixin = {

  /**
   * Streams a fired top-level event to `EventPluginHub` where plugins have the
   * opportunity to create `ReactEvent`s to be dispatched.
   *
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {object} topLevelTarget The listening component root node.
   * @param {string} topLevelTargetID ID of `topLevelTarget`.
   * @param {object} nativeEvent Native environment event.
   */
  handleTopLevel: function(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent) {
    var events = EventPluginHub.extractEvents(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent
    );

    runEventQueueInBatch(events);
  }
};

module.exports = ReactEventEmitterMixin;

},{"./EventPluginHub":18}],61:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactEventListener
 * @typechecks static-only
 */



var EventListener = _dereq_("./EventListener");
var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");
var PooledClass = _dereq_("./PooledClass");
var ReactInstanceHandles = _dereq_("./ReactInstanceHandles");
var ReactMount = _dereq_("./ReactMount");
var ReactUpdates = _dereq_("./ReactUpdates");

var getEventTarget = _dereq_("./getEventTarget");
var getUnboundedScrollPosition = _dereq_("./getUnboundedScrollPosition");
var mixInto = _dereq_("./mixInto");

/**
 * Finds the parent React component of `node`.
 *
 * @param {*} node
 * @return {?DOMEventTarget} Parent container, or `null` if the specified node
 *                           is not nested.
 */
function findParent(node) {
  // TODO: It may be a good idea to cache this to prevent unnecessary DOM
  // traversal, but caching is difficult to do correctly without using a
  // mutation observer to listen for all DOM changes.
  var nodeID = ReactMount.getID(node);
  var rootID = ReactInstanceHandles.getReactRootIDFromNodeID(nodeID);
  var container = ReactMount.findReactContainerForID(rootID);
  var parent = ReactMount.getFirstReactDOM(container);
  return parent;
}

// Used to store ancestor hierarchy in top level callback
function TopLevelCallbackBookKeeping(topLevelType, nativeEvent) {
  this.topLevelType = topLevelType;
  this.nativeEvent = nativeEvent;
  this.ancestors = [];
}
mixInto(TopLevelCallbackBookKeeping, {
  destructor: function() {
    this.topLevelType = null;
    this.nativeEvent = null;
    this.ancestors.length = 0;
  }
});
PooledClass.addPoolingTo(
  TopLevelCallbackBookKeeping,
  PooledClass.twoArgumentPooler
);

function handleTopLevelImpl(bookKeeping) {
  var topLevelTarget = ReactMount.getFirstReactDOM(
    getEventTarget(bookKeeping.nativeEvent)
  ) || window;

  // Loop through the hierarchy, in case there's any nested components.
  // It's important that we build the array of ancestors before calling any
  // event handlers, because event handlers can modify the DOM, leading to
  // inconsistencies with ReactMount's node cache. See #1105.
  var ancestor = topLevelTarget;
  while (ancestor) {
    bookKeeping.ancestors.push(ancestor);
    ancestor = findParent(ancestor);
  }

  for (var i = 0, l = bookKeeping.ancestors.length; i < l; i++) {
    topLevelTarget = bookKeeping.ancestors[i];
    var topLevelTargetID = ReactMount.getID(topLevelTarget) || '';
    ReactEventListener._handleTopLevel(
      bookKeeping.topLevelType,
      topLevelTarget,
      topLevelTargetID,
      bookKeeping.nativeEvent
    );
  }
}

function scrollValueMonitor(cb) {
  var scrollPosition = getUnboundedScrollPosition(window);
  cb(scrollPosition);
}

var ReactEventListener = {
  _enabled: true,
  _handleTopLevel: null,

  WINDOW_HANDLE: ExecutionEnvironment.canUseDOM ? window : null,

  setHandleTopLevel: function(handleTopLevel) {
    ReactEventListener._handleTopLevel = handleTopLevel;
  },

  setEnabled: function(enabled) {
    ReactEventListener._enabled = !!enabled;
  },

  isEnabled: function() {
    return ReactEventListener._enabled;
  },


  /**
   * Traps top-level events by using event bubbling.
   *
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {string} handlerBaseName Event name (e.g. "click").
   * @param {object} handle Element on which to attach listener.
   * @return {object} An object with a remove function which will forcefully
   *                  remove the listener.
   * @internal
   */
  trapBubbledEvent: function(topLevelType, handlerBaseName, handle) {
    var element = handle;
    if (!element) {
      return;
    }
    return EventListener.listen(
      element,
      handlerBaseName,
      ReactEventListener.dispatchEvent.bind(null, topLevelType)
    );
  },

  /**
   * Traps a top-level event by using event capturing.
   *
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {string} handlerBaseName Event name (e.g. "click").
   * @param {object} handle Element on which to attach listener.
   * @return {object} An object with a remove function which will forcefully
   *                  remove the listener.
   * @internal
   */
  trapCapturedEvent: function(topLevelType, handlerBaseName, handle) {
    var element = handle;
    if (!element) {
      return;
    }
    return EventListener.capture(
      element,
      handlerBaseName,
      ReactEventListener.dispatchEvent.bind(null, topLevelType)
    );
  },

  monitorScrollValue: function(refresh) {
    var callback = scrollValueMonitor.bind(null, refresh);
    EventListener.listen(window, 'scroll', callback);
    EventListener.listen(window, 'resize', callback);
  },

  dispatchEvent: function(topLevelType, nativeEvent) {
    if (!ReactEventListener._enabled) {
      return;
    }

    var bookKeeping = TopLevelCallbackBookKeeping.getPooled(
      topLevelType,
      nativeEvent
    );
    try {
      // Event queue being processed in the same cycle allows
      // `preventDefault`.
      ReactUpdates.batchedUpdates(handleTopLevelImpl, bookKeeping);
    } finally {
      TopLevelCallbackBookKeeping.release(bookKeeping);
    }
  }
};

module.exports = ReactEventListener;

},{"./EventListener":17,"./ExecutionEnvironment":22,"./PooledClass":28,"./ReactInstanceHandles":64,"./ReactMount":67,"./ReactUpdates":87,"./getEventTarget":125,"./getUnboundedScrollPosition":130,"./mixInto":147}],62:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactInjection
 */



var DOMProperty = _dereq_("./DOMProperty");
var EventPluginHub = _dereq_("./EventPluginHub");
var ReactComponent = _dereq_("./ReactComponent");
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");
var ReactDOM = _dereq_("./ReactDOM");
var ReactEmptyComponent = _dereq_("./ReactEmptyComponent");
var ReactBrowserEventEmitter = _dereq_("./ReactBrowserEventEmitter");
var ReactPerf = _dereq_("./ReactPerf");
var ReactRootIndex = _dereq_("./ReactRootIndex");
var ReactUpdates = _dereq_("./ReactUpdates");

var ReactInjection = {
  Component: ReactComponent.injection,
  CompositeComponent: ReactCompositeComponent.injection,
  DOMProperty: DOMProperty.injection,
  EmptyComponent: ReactEmptyComponent.injection,
  EventPluginHub: EventPluginHub.injection,
  DOM: ReactDOM.injection,
  EventEmitter: ReactBrowserEventEmitter.injection,
  Perf: ReactPerf.injection,
  RootIndex: ReactRootIndex.injection,
  Updates: ReactUpdates.injection
};

module.exports = ReactInjection;

},{"./DOMProperty":11,"./EventPluginHub":18,"./ReactBrowserEventEmitter":31,"./ReactComponent":35,"./ReactCompositeComponent":38,"./ReactDOM":41,"./ReactEmptyComponent":58,"./ReactPerf":71,"./ReactRootIndex":78,"./ReactUpdates":87}],63:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactInputSelection
 */



var ReactDOMSelection = _dereq_("./ReactDOMSelection");

var containsNode = _dereq_("./containsNode");
var focusNode = _dereq_("./focusNode");
var getActiveElement = _dereq_("./getActiveElement");

function isInDocument(node) {
  return containsNode(document.documentElement, node);
}

/**
 * @ReactInputSelection: React input selection module. Based on Selection.js,
 * but modified to be suitable for react and has a couple of bug fixes (doesn't
 * assume buttons have range selections allowed).
 * Input selection module for React.
 */
var ReactInputSelection = {

  hasSelectionCapabilities: function(elem) {
    return elem && (
      (elem.nodeName === 'INPUT' && elem.type === 'text') ||
      elem.nodeName === 'TEXTAREA' ||
      elem.contentEditable === 'true'
    );
  },

  getSelectionInformation: function() {
    var focusedElem = getActiveElement();
    return {
      focusedElem: focusedElem,
      selectionRange:
          ReactInputSelection.hasSelectionCapabilities(focusedElem) ?
          ReactInputSelection.getSelection(focusedElem) :
          null
    };
  },

  /**
   * @restoreSelection: If any selection information was potentially lost,
   * restore it. This is useful when performing operations that could remove dom
   * nodes and place them back in, resulting in focus being lost.
   */
  restoreSelection: function(priorSelectionInformation) {
    var curFocusedElem = getActiveElement();
    var priorFocusedElem = priorSelectionInformation.focusedElem;
    var priorSelectionRange = priorSelectionInformation.selectionRange;
    if (curFocusedElem !== priorFocusedElem &&
        isInDocument(priorFocusedElem)) {
      if (ReactInputSelection.hasSelectionCapabilities(priorFocusedElem)) {
        ReactInputSelection.setSelection(
          priorFocusedElem,
          priorSelectionRange
        );
      }
      focusNode(priorFocusedElem);
    }
  },

  /**
   * @getSelection: Gets the selection bounds of a focused textarea, input or
   * contentEditable node.
   * -@input: Look up selection bounds of this input
   * -@return {start: selectionStart, end: selectionEnd}
   */
  getSelection: function(input) {
    var selection;

    if ('selectionStart' in input) {
      // Modern browser with input or textarea.
      selection = {
        start: input.selectionStart,
        end: input.selectionEnd
      };
    } else if (document.selection && input.nodeName === 'INPUT') {
      // IE8 input.
      var range = document.selection.createRange();
      // There can only be one selection per document in IE, so it must
      // be in our element.
      if (range.parentElement() === input) {
        selection = {
          start: -range.moveStart('character', -input.value.length),
          end: -range.moveEnd('character', -input.value.length)
        };
      }
    } else {
      // Content editable or old IE textarea.
      selection = ReactDOMSelection.getOffsets(input);
    }

    return selection || {start: 0, end: 0};
  },

  /**
   * @setSelection: Sets the selection bounds of a textarea or input and focuses
   * the input.
   * -@input     Set selection bounds of this input or textarea
   * -@offsets   Object of same form that is returned from get*
   */
  setSelection: function(input, offsets) {
    var start = offsets.start;
    var end = offsets.end;
    if (typeof end === 'undefined') {
      end = start;
    }

    if ('selectionStart' in input) {
      input.selectionStart = start;
      input.selectionEnd = Math.min(end, input.value.length);
    } else if (document.selection && input.nodeName === 'INPUT') {
      var range = input.createTextRange();
      range.collapse(true);
      range.moveStart('character', start);
      range.moveEnd('character', end - start);
      range.select();
    } else {
      ReactDOMSelection.setOffsets(input, offsets);
    }
  }
};

module.exports = ReactInputSelection;

},{"./ReactDOMSelection":50,"./containsNode":109,"./focusNode":120,"./getActiveElement":122}],64:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactInstanceHandles
 * @typechecks static-only
 */



var ReactRootIndex = _dereq_("./ReactRootIndex");

var invariant = _dereq_("./invariant");

var SEPARATOR = '.';
var SEPARATOR_LENGTH = SEPARATOR.length;

/**
 * Maximum depth of traversals before we consider the possibility of a bad ID.
 */
var MAX_TREE_DEPTH = 100;

/**
 * Creates a DOM ID prefix to use when mounting React components.
 *
 * @param {number} index A unique integer
 * @return {string} React root ID.
 * @internal
 */
function getReactRootIDString(index) {
  return SEPARATOR + index.toString(36);
}

/**
 * Checks if a character in the supplied ID is a separator or the end.
 *
 * @param {string} id A React DOM ID.
 * @param {number} index Index of the character to check.
 * @return {boolean} True if the character is a separator or end of the ID.
 * @private
 */
function isBoundary(id, index) {
  return id.charAt(index) === SEPARATOR || index === id.length;
}

/**
 * Checks if the supplied string is a valid React DOM ID.
 *
 * @param {string} id A React DOM ID, maybe.
 * @return {boolean} True if the string is a valid React DOM ID.
 * @private
 */
function isValidID(id) {
  return id === '' || (
    id.charAt(0) === SEPARATOR && id.charAt(id.length - 1) !== SEPARATOR
  );
}

/**
 * Checks if the first ID is an ancestor of or equal to the second ID.
 *
 * @param {string} ancestorID
 * @param {string} descendantID
 * @return {boolean} True if `ancestorID` is an ancestor of `descendantID`.
 * @internal
 */
function isAncestorIDOf(ancestorID, descendantID) {
  return (
    descendantID.indexOf(ancestorID) === 0 &&
    isBoundary(descendantID, ancestorID.length)
  );
}

/**
 * Gets the parent ID of the supplied React DOM ID, `id`.
 *
 * @param {string} id ID of a component.
 * @return {string} ID of the parent, or an empty string.
 * @private
 */
function getParentID(id) {
  return id ? id.substr(0, id.lastIndexOf(SEPARATOR)) : '';
}

/**
 * Gets the next DOM ID on the tree path from the supplied `ancestorID` to the
 * supplied `destinationID`. If they are equal, the ID is returned.
 *
 * @param {string} ancestorID ID of an ancestor node of `destinationID`.
 * @param {string} destinationID ID of the destination node.
 * @return {string} Next ID on the path from `ancestorID` to `destinationID`.
 * @private
 */
function getNextDescendantID(ancestorID, destinationID) {
  ("production" !== "development" ? invariant(
    isValidID(ancestorID) && isValidID(destinationID),
    'getNextDescendantID(%s, %s): Received an invalid React DOM ID.',
    ancestorID,
    destinationID
  ) : invariant(isValidID(ancestorID) && isValidID(destinationID)));
  ("production" !== "development" ? invariant(
    isAncestorIDOf(ancestorID, destinationID),
    'getNextDescendantID(...): React has made an invalid assumption about ' +
    'the DOM hierarchy. Expected `%s` to be an ancestor of `%s`.',
    ancestorID,
    destinationID
  ) : invariant(isAncestorIDOf(ancestorID, destinationID)));
  if (ancestorID === destinationID) {
    return ancestorID;
  }
  // Skip over the ancestor and the immediate separator. Traverse until we hit
  // another separator or we reach the end of `destinationID`.
  var start = ancestorID.length + SEPARATOR_LENGTH;
  for (var i = start; i < destinationID.length; i++) {
    if (isBoundary(destinationID, i)) {
      break;
    }
  }
  return destinationID.substr(0, i);
}

/**
 * Gets the nearest common ancestor ID of two IDs.
 *
 * Using this ID scheme, the nearest common ancestor ID is the longest common
 * prefix of the two IDs that immediately preceded a "marker" in both strings.
 *
 * @param {string} oneID
 * @param {string} twoID
 * @return {string} Nearest common ancestor ID, or the empty string if none.
 * @private
 */
function getFirstCommonAncestorID(oneID, twoID) {
  var minLength = Math.min(oneID.length, twoID.length);
  if (minLength === 0) {
    return '';
  }
  var lastCommonMarkerIndex = 0;
  // Use `<=` to traverse until the "EOL" of the shorter string.
  for (var i = 0; i <= minLength; i++) {
    if (isBoundary(oneID, i) && isBoundary(twoID, i)) {
      lastCommonMarkerIndex = i;
    } else if (oneID.charAt(i) !== twoID.charAt(i)) {
      break;
    }
  }
  var longestCommonID = oneID.substr(0, lastCommonMarkerIndex);
  ("production" !== "development" ? invariant(
    isValidID(longestCommonID),
    'getFirstCommonAncestorID(%s, %s): Expected a valid React DOM ID: %s',
    oneID,
    twoID,
    longestCommonID
  ) : invariant(isValidID(longestCommonID)));
  return longestCommonID;
}

/**
 * Traverses the parent path between two IDs (either up or down). The IDs must
 * not be the same, and there must exist a parent path between them. If the
 * callback returns `false`, traversal is stopped.
 *
 * @param {?string} start ID at which to start traversal.
 * @param {?string} stop ID at which to end traversal.
 * @param {function} cb Callback to invoke each ID with.
 * @param {?boolean} skipFirst Whether or not to skip the first node.
 * @param {?boolean} skipLast Whether or not to skip the last node.
 * @private
 */
function traverseParentPath(start, stop, cb, arg, skipFirst, skipLast) {
  start = start || '';
  stop = stop || '';
  ("production" !== "development" ? invariant(
    start !== stop,
    'traverseParentPath(...): Cannot traverse from and to the same ID, `%s`.',
    start
  ) : invariant(start !== stop));
  var traverseUp = isAncestorIDOf(stop, start);
  ("production" !== "development" ? invariant(
    traverseUp || isAncestorIDOf(start, stop),
    'traverseParentPath(%s, %s, ...): Cannot traverse from two IDs that do ' +
    'not have a parent path.',
    start,
    stop
  ) : invariant(traverseUp || isAncestorIDOf(start, stop)));
  // Traverse from `start` to `stop` one depth at a time.
  var depth = 0;
  var traverse = traverseUp ? getParentID : getNextDescendantID;
  for (var id = start; /* until break */; id = traverse(id, stop)) {
    var ret;
    if ((!skipFirst || id !== start) && (!skipLast || id !== stop)) {
      ret = cb(id, traverseUp, arg);
    }
    if (ret === false || id === stop) {
      // Only break //after// visiting `stop`.
      break;
    }
    ("production" !== "development" ? invariant(
      depth++ < MAX_TREE_DEPTH,
      'traverseParentPath(%s, %s, ...): Detected an infinite loop while ' +
      'traversing the React DOM ID tree. This may be due to malformed IDs: %s',
      start, stop
    ) : invariant(depth++ < MAX_TREE_DEPTH));
  }
}

/**
 * Manages the IDs assigned to DOM representations of React components. This
 * uses a specific scheme in order to traverse the DOM efficiently (e.g. in
 * order to simulate events).
 *
 * @internal
 */
var ReactInstanceHandles = {

  /**
   * Constructs a React root ID
   * @return {string} A React root ID.
   */
  createReactRootID: function() {
    return getReactRootIDString(ReactRootIndex.createReactRootIndex());
  },

  /**
   * Constructs a React ID by joining a root ID with a name.
   *
   * @param {string} rootID Root ID of a parent component.
   * @param {string} name A component's name (as flattened children).
   * @return {string} A React ID.
   * @internal
   */
  createReactID: function(rootID, name) {
    return rootID + name;
  },

  /**
   * Gets the DOM ID of the React component that is the root of the tree that
   * contains the React component with the supplied DOM ID.
   *
   * @param {string} id DOM ID of a React component.
   * @return {?string} DOM ID of the React component that is the root.
   * @internal
   */
  getReactRootIDFromNodeID: function(id) {
    if (id && id.charAt(0) === SEPARATOR && id.length > 1) {
      var index = id.indexOf(SEPARATOR, 1);
      return index > -1 ? id.substr(0, index) : id;
    }
    return null;
  },

  /**
   * Traverses the ID hierarchy and invokes the supplied `cb` on any IDs that
   * should would receive a `mouseEnter` or `mouseLeave` event.
   *
   * NOTE: Does not invoke the callback on the nearest common ancestor because
   * nothing "entered" or "left" that element.
   *
   * @param {string} leaveID ID being left.
   * @param {string} enterID ID being entered.
   * @param {function} cb Callback to invoke on each entered/left ID.
   * @param {*} upArg Argument to invoke the callback with on left IDs.
   * @param {*} downArg Argument to invoke the callback with on entered IDs.
   * @internal
   */
  traverseEnterLeave: function(leaveID, enterID, cb, upArg, downArg) {
    var ancestorID = getFirstCommonAncestorID(leaveID, enterID);
    if (ancestorID !== leaveID) {
      traverseParentPath(leaveID, ancestorID, cb, upArg, false, true);
    }
    if (ancestorID !== enterID) {
      traverseParentPath(ancestorID, enterID, cb, downArg, true, false);
    }
  },

  /**
   * Simulates the traversal of a two-phase, capture/bubble event dispatch.
   *
   * NOTE: This traversal happens on IDs without touching the DOM.
   *
   * @param {string} targetID ID of the target node.
   * @param {function} cb Callback to invoke.
   * @param {*} arg Argument to invoke the callback with.
   * @internal
   */
  traverseTwoPhase: function(targetID, cb, arg) {
    if (targetID) {
      traverseParentPath('', targetID, cb, arg, true, false);
      traverseParentPath(targetID, '', cb, arg, false, true);
    }
  },

  /**
   * Traverse a node ID, calling the supplied `cb` for each ancestor ID. For
   * example, passing `.0.$row-0.1` would result in `cb` getting called
   * with `.0`, `.0.$row-0`, and `.0.$row-0.1`.
   *
   * NOTE: This traversal happens on IDs without touching the DOM.
   *
   * @param {string} targetID ID of the target node.
   * @param {function} cb Callback to invoke.
   * @param {*} arg Argument to invoke the callback with.
   * @internal
   */
  traverseAncestors: function(targetID, cb, arg) {
    traverseParentPath('', targetID, cb, arg, true, false);
  },

  /**
   * Exposed for unit testing.
   * @private
   */
  _getFirstCommonAncestorID: getFirstCommonAncestorID,

  /**
   * Exposed for unit testing.
   * @private
   */
  _getNextDescendantID: getNextDescendantID,

  isAncestorIDOf: isAncestorIDOf,

  SEPARATOR: SEPARATOR

};

module.exports = ReactInstanceHandles;

},{"./ReactRootIndex":78,"./invariant":134}],65:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactLink
 * @typechecks static-only
 */



/**
 * ReactLink encapsulates a common pattern in which a component wants to modify
 * a prop received from its parent. ReactLink allows the parent to pass down a
 * value coupled with a callback that, when invoked, expresses an intent to
 * modify that value. For example:
 *
 * React.createClass({
 *   getInitialState: function() {
 *     return {value: ''};
 *   },
 *   render: function() {
 *     var valueLink = new ReactLink(this.state.value, this._handleValueChange);
 *     return <input valueLink={valueLink} />;
 *   },
 *   this._handleValueChange: function(newValue) {
 *     this.setState({value: newValue});
 *   }
 * });
 *
 * We have provided some sugary mixins to make the creation and
 * consumption of ReactLink easier; see LinkedValueUtils and LinkedStateMixin.
 */

var React = _dereq_("./React");

/**
 * @param {*} value current value of the link
 * @param {function} requestChange callback to request a change
 */
function ReactLink(value, requestChange) {
  this.value = value;
  this.requestChange = requestChange;
}

/**
 * Creates a PropType that enforces the ReactLink API and optionally checks the
 * type of the value being passed inside the link. Example:
 *
 * MyComponent.propTypes = {
 *   tabIndexLink: ReactLink.PropTypes.link(React.PropTypes.number)
 * }
 */
function createLinkTypeChecker(linkType) {
  var shapes = {
    value: typeof linkType === 'undefined' ?
      React.PropTypes.any.isRequired :
      linkType.isRequired,
    requestChange: React.PropTypes.func.isRequired
  };
  return React.PropTypes.shape(shapes);
}

ReactLink.PropTypes = {
  link: createLinkTypeChecker
};

module.exports = ReactLink;

},{"./React":29}],66:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactMarkupChecksum
 */



var adler32 = _dereq_("./adler32");

var ReactMarkupChecksum = {
  CHECKSUM_ATTR_NAME: 'data-react-checksum',

  /**
   * @param {string} markup Markup string
   * @return {string} Markup string with checksum attribute attached
   */
  addChecksumToMarkup: function(markup) {
    var checksum = adler32(markup);
    return markup.replace(
      '>',
      ' ' + ReactMarkupChecksum.CHECKSUM_ATTR_NAME + '="' + checksum + '">'
    );
  },

  /**
   * @param {string} markup to use
   * @param {DOMElement} element root React element
   * @returns {boolean} whether or not the markup is the same
   */
  canReuseMarkup: function(markup, element) {
    var existingChecksum = element.getAttribute(
      ReactMarkupChecksum.CHECKSUM_ATTR_NAME
    );
    existingChecksum = existingChecksum && parseInt(existingChecksum, 10);
    var markupChecksum = adler32(markup);
    return markupChecksum === existingChecksum;
  }
};

module.exports = ReactMarkupChecksum;

},{"./adler32":107}],67:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactMount
 */



var DOMProperty = _dereq_("./DOMProperty");
var ReactBrowserEventEmitter = _dereq_("./ReactBrowserEventEmitter");
var ReactCurrentOwner = _dereq_("./ReactCurrentOwner");
var ReactDescriptor = _dereq_("./ReactDescriptor");
var ReactInstanceHandles = _dereq_("./ReactInstanceHandles");
var ReactPerf = _dereq_("./ReactPerf");

var containsNode = _dereq_("./containsNode");
var getReactRootElementInContainer = _dereq_("./getReactRootElementInContainer");
var instantiateReactComponent = _dereq_("./instantiateReactComponent");
var invariant = _dereq_("./invariant");
var shouldUpdateReactComponent = _dereq_("./shouldUpdateReactComponent");
var warning = _dereq_("./warning");

var SEPARATOR = ReactInstanceHandles.SEPARATOR;

var ATTR_NAME = DOMProperty.ID_ATTRIBUTE_NAME;
var nodeCache = {};

var ELEMENT_NODE_TYPE = 1;
var DOC_NODE_TYPE = 9;

/** Mapping from reactRootID to React component instance. */
var instancesByReactRootID = {};

/** Mapping from reactRootID to `container` nodes. */
var containersByReactRootID = {};

if ("production" !== "development") {
  /** __DEV__-only mapping from reactRootID to root elements. */
  var rootElementsByReactRootID = {};
}

// Used to store breadth-first search state in findComponentRoot.
var findComponentRootReusableArray = [];

/**
 * @param {DOMElement} container DOM element that may contain a React component.
 * @return {?string} A "reactRoot" ID, if a React component is rendered.
 */
function getReactRootID(container) {
  var rootElement = getReactRootElementInContainer(container);
  return rootElement && ReactMount.getID(rootElement);
}

/**
 * Accessing node[ATTR_NAME] or calling getAttribute(ATTR_NAME) on a form
 * element can return its control whose name or ID equals ATTR_NAME. All
 * DOM nodes support `getAttributeNode` but this can also get called on
 * other objects so just return '' if we're given something other than a
 * DOM node (such as window).
 *
 * @param {?DOMElement|DOMWindow|DOMDocument|DOMTextNode} node DOM node.
 * @return {string} ID of the supplied `domNode`.
 */
function getID(node) {
  var id = internalGetID(node);
  if (id) {
    if (nodeCache.hasOwnProperty(id)) {
      var cached = nodeCache[id];
      if (cached !== node) {
        ("production" !== "development" ? invariant(
          !isValid(cached, id),
          'ReactMount: Two valid but unequal nodes with the same `%s`: %s',
          ATTR_NAME, id
        ) : invariant(!isValid(cached, id)));

        nodeCache[id] = node;
      }
    } else {
      nodeCache[id] = node;
    }
  }

  return id;
}

function internalGetID(node) {
  // If node is something like a window, document, or text node, none of
  // which support attributes or a .getAttribute method, gracefully return
  // the empty string, as if the attribute were missing.
  return node && node.getAttribute && node.getAttribute(ATTR_NAME) || '';
}

/**
 * Sets the React-specific ID of the given node.
 *
 * @param {DOMElement} node The DOM node whose ID will be set.
 * @param {string} id The value of the ID attribute.
 */
function setID(node, id) {
  var oldID = internalGetID(node);
  if (oldID !== id) {
    delete nodeCache[oldID];
  }
  node.setAttribute(ATTR_NAME, id);
  nodeCache[id] = node;
}

/**
 * Finds the node with the supplied React-generated DOM ID.
 *
 * @param {string} id A React-generated DOM ID.
 * @return {DOMElement} DOM node with the suppled `id`.
 * @internal
 */
function getNode(id) {
  if (!nodeCache.hasOwnProperty(id) || !isValid(nodeCache[id], id)) {
    nodeCache[id] = ReactMount.findReactNodeByID(id);
  }
  return nodeCache[id];
}

/**
 * A node is "valid" if it is contained by a currently mounted container.
 *
 * This means that the node does not have to be contained by a document in
 * order to be considered valid.
 *
 * @param {?DOMElement} node The candidate DOM node.
 * @param {string} id The expected ID of the node.
 * @return {boolean} Whether the node is contained by a mounted container.
 */
function isValid(node, id) {
  if (node) {
    ("production" !== "development" ? invariant(
      internalGetID(node) === id,
      'ReactMount: Unexpected modification of `%s`',
      ATTR_NAME
    ) : invariant(internalGetID(node) === id));

    var container = ReactMount.findReactContainerForID(id);
    if (container && containsNode(container, node)) {
      return true;
    }
  }

  return false;
}

/**
 * Causes the cache to forget about one React-specific ID.
 *
 * @param {string} id The ID to forget.
 */
function purgeID(id) {
  delete nodeCache[id];
}

var deepestNodeSoFar = null;
function findDeepestCachedAncestorImpl(ancestorID) {
  var ancestor = nodeCache[ancestorID];
  if (ancestor && isValid(ancestor, ancestorID)) {
    deepestNodeSoFar = ancestor;
  } else {
    // This node isn't populated in the cache, so presumably none of its
    // descendants are. Break out of the loop.
    return false;
  }
}

/**
 * Return the deepest cached node whose ID is a prefix of `targetID`.
 */
function findDeepestCachedAncestor(targetID) {
  deepestNodeSoFar = null;
  ReactInstanceHandles.traverseAncestors(
    targetID,
    findDeepestCachedAncestorImpl
  );

  var foundNode = deepestNodeSoFar;
  deepestNodeSoFar = null;
  return foundNode;
}

/**
 * Mounting is the process of initializing a React component by creatings its
 * representative DOM elements and inserting them into a supplied `container`.
 * Any prior content inside `container` is destroyed in the process.
 *
 *   ReactMount.renderComponent(
 *     component,
 *     document.getElementById('container')
 *   );
 *
 *   <div id="container">                   <-- Supplied `container`.
 *     <div data-reactid=".3">              <-- Rendered reactRoot of React
 *       // ...                                 component.
 *     </div>
 *   </div>
 *
 * Inside of `container`, the first element rendered is the "reactRoot".
 */
var ReactMount = {
  /** Exposed for debugging purposes **/
  _instancesByReactRootID: instancesByReactRootID,

  /**
   * This is a hook provided to support rendering React components while
   * ensuring that the apparent scroll position of its `container` does not
   * change.
   *
   * @param {DOMElement} container The `container` being rendered into.
   * @param {function} renderCallback This must be called once to do the render.
   */
  scrollMonitor: function(container, renderCallback) {
    renderCallback();
  },

  /**
   * Take a component that's already mounted into the DOM and replace its props
   * @param {ReactComponent} prevComponent component instance already in the DOM
   * @param {ReactComponent} nextComponent component instance to render
   * @param {DOMElement} container container to render into
   * @param {?function} callback function triggered on completion
   */
  _updateRootComponent: function(
      prevComponent,
      nextComponent,
      container,
      callback) {
    var nextProps = nextComponent.props;
    ReactMount.scrollMonitor(container, function() {
      prevComponent.replaceProps(nextProps, callback);
    });

    if ("production" !== "development") {
      // Record the root element in case it later gets transplanted.
      rootElementsByReactRootID[getReactRootID(container)] =
        getReactRootElementInContainer(container);
    }

    return prevComponent;
  },

  /**
   * Register a component into the instance map and starts scroll value
   * monitoring
   * @param {ReactComponent} nextComponent component instance to render
   * @param {DOMElement} container container to render into
   * @return {string} reactRoot ID prefix
   */
  _registerComponent: function(nextComponent, container) {
    ("production" !== "development" ? invariant(
      container && (
        container.nodeType === ELEMENT_NODE_TYPE ||
        container.nodeType === DOC_NODE_TYPE
      ),
      '_registerComponent(...): Target container is not a DOM element.'
    ) : invariant(container && (
      container.nodeType === ELEMENT_NODE_TYPE ||
      container.nodeType === DOC_NODE_TYPE
    )));

    ReactBrowserEventEmitter.ensureScrollValueMonitoring();

    var reactRootID = ReactMount.registerContainer(container);
    instancesByReactRootID[reactRootID] = nextComponent;
    return reactRootID;
  },

  /**
   * Render a new component into the DOM.
   * @param {ReactComponent} nextComponent component instance to render
   * @param {DOMElement} container container to render into
   * @param {boolean} shouldReuseMarkup if we should skip the markup insertion
   * @return {ReactComponent} nextComponent
   */
  _renderNewRootComponent: ReactPerf.measure(
    'ReactMount',
    '_renderNewRootComponent',
    function(
        nextComponent,
        container,
        shouldReuseMarkup) {
      // Various parts of our code (such as ReactCompositeComponent's
      // _renderValidatedComponent) assume that calls to render aren't nested;
      // verify that that's the case.
      ("production" !== "development" ? warning(
        ReactCurrentOwner.current == null,
        '_renderNewRootComponent(): Render methods should be a pure function ' +
        'of props and state; triggering nested component updates from ' +
        'render is not allowed. If necessary, trigger nested updates in ' +
        'componentDidUpdate.'
      ) : null);

      var componentInstance = instantiateReactComponent(nextComponent);
      var reactRootID = ReactMount._registerComponent(
        componentInstance,
        container
      );
      componentInstance.mountComponentIntoNode(
        reactRootID,
        container,
        shouldReuseMarkup
      );

      if ("production" !== "development") {
        // Record the root element in case it later gets transplanted.
        rootElementsByReactRootID[reactRootID] =
          getReactRootElementInContainer(container);
      }

      return componentInstance;
    }
  ),

  /**
   * Renders a React component into the DOM in the supplied `container`.
   *
   * If the React component was previously rendered into `container`, this will
   * perform an update on it and only mutate the DOM as necessary to reflect the
   * latest React component.
   *
   * @param {ReactDescriptor} nextDescriptor Component descriptor to render.
   * @param {DOMElement} container DOM element to render into.
   * @param {?function} callback function triggered on completion
   * @return {ReactComponent} Component instance rendered in `container`.
   */
  renderComponent: function(nextDescriptor, container, callback) {
    ("production" !== "development" ? invariant(
      ReactDescriptor.isValidDescriptor(nextDescriptor),
      'renderComponent(): Invalid component descriptor.%s',
      (
        ReactDescriptor.isValidFactory(nextDescriptor) ?
          ' Instead of passing a component class, make sure to instantiate ' +
          'it first by calling it with props.' :
        // Check if it quacks like a descriptor
        typeof nextDescriptor.props !== "undefined" ?
          ' This may be caused by unintentionally loading two independent ' +
          'copies of React.' :
          ''
      )
    ) : invariant(ReactDescriptor.isValidDescriptor(nextDescriptor)));

    var prevComponent = instancesByReactRootID[getReactRootID(container)];

    if (prevComponent) {
      var prevDescriptor = prevComponent._descriptor;
      if (shouldUpdateReactComponent(prevDescriptor, nextDescriptor)) {
        return ReactMount._updateRootComponent(
          prevComponent,
          nextDescriptor,
          container,
          callback
        );
      } else {
        ReactMount.unmountComponentAtNode(container);
      }
    }

    var reactRootElement = getReactRootElementInContainer(container);
    var containerHasReactMarkup =
      reactRootElement && ReactMount.isRenderedByReact(reactRootElement);

    var shouldReuseMarkup = containerHasReactMarkup && !prevComponent;

    var component = ReactMount._renderNewRootComponent(
      nextDescriptor,
      container,
      shouldReuseMarkup
    );
    callback && callback.call(component);
    return component;
  },

  /**
   * Constructs a component instance of `constructor` with `initialProps` and
   * renders it into the supplied `container`.
   *
   * @param {function} constructor React component constructor.
   * @param {?object} props Initial props of the component instance.
   * @param {DOMElement} container DOM element to render into.
   * @return {ReactComponent} Component instance rendered in `container`.
   */
  constructAndRenderComponent: function(constructor, props, container) {
    return ReactMount.renderComponent(constructor(props), container);
  },

  /**
   * Constructs a component instance of `constructor` with `initialProps` and
   * renders it into a container node identified by supplied `id`.
   *
   * @param {function} componentConstructor React component constructor
   * @param {?object} props Initial props of the component instance.
   * @param {string} id ID of the DOM element to render into.
   * @return {ReactComponent} Component instance rendered in the container node.
   */
  constructAndRenderComponentByID: function(constructor, props, id) {
    var domNode = document.getElementById(id);
    ("production" !== "development" ? invariant(
      domNode,
      'Tried to get element with id of "%s" but it is not present on the page.',
      id
    ) : invariant(domNode));
    return ReactMount.constructAndRenderComponent(constructor, props, domNode);
  },

  /**
   * Registers a container node into which React components will be rendered.
   * This also creates the "reactRoot" ID that will be assigned to the element
   * rendered within.
   *
   * @param {DOMElement} container DOM element to register as a container.
   * @return {string} The "reactRoot" ID of elements rendered within.
   */
  registerContainer: function(container) {
    var reactRootID = getReactRootID(container);
    if (reactRootID) {
      // If one exists, make sure it is a valid "reactRoot" ID.
      reactRootID = ReactInstanceHandles.getReactRootIDFromNodeID(reactRootID);
    }
    if (!reactRootID) {
      // No valid "reactRoot" ID found, create one.
      reactRootID = ReactInstanceHandles.createReactRootID();
    }
    containersByReactRootID[reactRootID] = container;
    return reactRootID;
  },

  /**
   * Unmounts and destroys the React component rendered in the `container`.
   *
   * @param {DOMElement} container DOM element containing a React component.
   * @return {boolean} True if a component was found in and unmounted from
   *                   `container`
   */
  unmountComponentAtNode: function(container) {
    // Various parts of our code (such as ReactCompositeComponent's
    // _renderValidatedComponent) assume that calls to render aren't nested;
    // verify that that's the case. (Strictly speaking, unmounting won't cause a
    // render but we still don't expect to be in a render call here.)
    ("production" !== "development" ? warning(
      ReactCurrentOwner.current == null,
      'unmountComponentAtNode(): Render methods should be a pure function of ' +
      'props and state; triggering nested component updates from render is ' +
      'not allowed. If necessary, trigger nested updates in ' +
      'componentDidUpdate.'
    ) : null);

    var reactRootID = getReactRootID(container);
    var component = instancesByReactRootID[reactRootID];
    if (!component) {
      return false;
    }
    ReactMount.unmountComponentFromNode(component, container);
    delete instancesByReactRootID[reactRootID];
    delete containersByReactRootID[reactRootID];
    if ("production" !== "development") {
      delete rootElementsByReactRootID[reactRootID];
    }
    return true;
  },

  /**
   * Unmounts a component and removes it from the DOM.
   *
   * @param {ReactComponent} instance React component instance.
   * @param {DOMElement} container DOM element to unmount from.
   * @final
   * @internal
   * @see {ReactMount.unmountComponentAtNode}
   */
  unmountComponentFromNode: function(instance, container) {
    instance.unmountComponent();

    if (container.nodeType === DOC_NODE_TYPE) {
      container = container.documentElement;
    }

    // http://jsperf.com/emptying-a-node
    while (container.lastChild) {
      container.removeChild(container.lastChild);
    }
  },

  /**
   * Finds the container DOM element that contains React component to which the
   * supplied DOM `id` belongs.
   *
   * @param {string} id The ID of an element rendered by a React component.
   * @return {?DOMElement} DOM element that contains the `id`.
   */
  findReactContainerForID: function(id) {
    var reactRootID = ReactInstanceHandles.getReactRootIDFromNodeID(id);
    var container = containersByReactRootID[reactRootID];

    if ("production" !== "development") {
      var rootElement = rootElementsByReactRootID[reactRootID];
      if (rootElement && rootElement.parentNode !== container) {
        ("production" !== "development" ? invariant(
          // Call internalGetID here because getID calls isValid which calls
          // findReactContainerForID (this function).
          internalGetID(rootElement) === reactRootID,
          'ReactMount: Root element ID differed from reactRootID.'
        ) : invariant(// Call internalGetID here because getID calls isValid which calls
        // findReactContainerForID (this function).
        internalGetID(rootElement) === reactRootID));

        var containerChild = container.firstChild;
        if (containerChild &&
            reactRootID === internalGetID(containerChild)) {
          // If the container has a new child with the same ID as the old
          // root element, then rootElementsByReactRootID[reactRootID] is
          // just stale and needs to be updated. The case that deserves a
          // warning is when the container is empty.
          rootElementsByReactRootID[reactRootID] = containerChild;
        } else {
          console.warn(
            'ReactMount: Root element has been removed from its original ' +
            'container. New container:', rootElement.parentNode
          );
        }
      }
    }

    return container;
  },

  /**
   * Finds an element rendered by React with the supplied ID.
   *
   * @param {string} id ID of a DOM node in the React component.
   * @return {DOMElement} Root DOM node of the React component.
   */
  findReactNodeByID: function(id) {
    var reactRoot = ReactMount.findReactContainerForID(id);
    return ReactMount.findComponentRoot(reactRoot, id);
  },

  /**
   * True if the supplied `node` is rendered by React.
   *
   * @param {*} node DOM Element to check.
   * @return {boolean} True if the DOM Element appears to be rendered by React.
   * @internal
   */
  isRenderedByReact: function(node) {
    if (node.nodeType !== 1) {
      // Not a DOMElement, therefore not a React component
      return false;
    }
    var id = ReactMount.getID(node);
    return id ? id.charAt(0) === SEPARATOR : false;
  },

  /**
   * Traverses up the ancestors of the supplied node to find a node that is a
   * DOM representation of a React component.
   *
   * @param {*} node
   * @return {?DOMEventTarget}
   * @internal
   */
  getFirstReactDOM: function(node) {
    var current = node;
    while (current && current.parentNode !== current) {
      if (ReactMount.isRenderedByReact(current)) {
        return current;
      }
      current = current.parentNode;
    }
    return null;
  },

  /**
   * Finds a node with the supplied `targetID` inside of the supplied
   * `ancestorNode`.  Exploits the ID naming scheme to perform the search
   * quickly.
   *
   * @param {DOMEventTarget} ancestorNode Search from this root.
   * @pararm {string} targetID ID of the DOM representation of the component.
   * @return {DOMEventTarget} DOM node with the supplied `targetID`.
   * @internal
   */
  findComponentRoot: function(ancestorNode, targetID) {
    var firstChildren = findComponentRootReusableArray;
    var childIndex = 0;

    var deepestAncestor = findDeepestCachedAncestor(targetID) || ancestorNode;

    firstChildren[0] = deepestAncestor.firstChild;
    firstChildren.length = 1;

    while (childIndex < firstChildren.length) {
      var child = firstChildren[childIndex++];
      var targetChild;

      while (child) {
        var childID = ReactMount.getID(child);
        if (childID) {
          // Even if we find the node we're looking for, we finish looping
          // through its siblings to ensure they're cached so that we don't have
          // to revisit this node again. Otherwise, we make n^2 calls to getID
          // when visiting the many children of a single node in order.

          if (targetID === childID) {
            targetChild = child;
          } else if (ReactInstanceHandles.isAncestorIDOf(childID, targetID)) {
            // If we find a child whose ID is an ancestor of the given ID,
            // then we can be sure that we only want to search the subtree
            // rooted at this child, so we can throw out the rest of the
            // search state.
            firstChildren.length = childIndex = 0;
            firstChildren.push(child.firstChild);
          }

        } else {
          // If this child had no ID, then there's a chance that it was
          // injected automatically by the browser, as when a `<table>`
          // element sprouts an extra `<tbody>` child as a side effect of
          // `.innerHTML` parsing. Optimistically continue down this
          // branch, but not before examining the other siblings.
          firstChildren.push(child.firstChild);
        }

        child = child.nextSibling;
      }

      if (targetChild) {
        // Emptying firstChildren/findComponentRootReusableArray is
        // not necessary for correctness, but it helps the GC reclaim
        // any nodes that were left at the end of the search.
        firstChildren.length = 0;

        return targetChild;
      }
    }

    firstChildren.length = 0;

    ("production" !== "development" ? invariant(
      false,
      'findComponentRoot(..., %s): Unable to find element. This probably ' +
      'means the DOM was unexpectedly mutated (e.g., by the browser), ' +
      'usually due to forgetting a <tbody> when using tables, nesting <p> ' +
      'or <a> tags, or using non-SVG elements in an <svg> parent. Try ' +
      'inspecting the child nodes of the element with React ID `%s`.',
      targetID,
      ReactMount.getID(ancestorNode)
    ) : invariant(false));
  },


  /**
   * React ID utilities.
   */

  getReactRootID: getReactRootID,

  getID: getID,

  setID: setID,

  getNode: getNode,

  purgeID: purgeID
};

module.exports = ReactMount;

},{"./DOMProperty":11,"./ReactBrowserEventEmitter":31,"./ReactCurrentOwner":40,"./ReactDescriptor":56,"./ReactInstanceHandles":64,"./ReactPerf":71,"./containsNode":109,"./getReactRootElementInContainer":128,"./instantiateReactComponent":133,"./invariant":134,"./shouldUpdateReactComponent":154,"./warning":158}],68:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactMultiChild
 * @typechecks static-only
 */



var ReactComponent = _dereq_("./ReactComponent");
var ReactMultiChildUpdateTypes = _dereq_("./ReactMultiChildUpdateTypes");

var flattenChildren = _dereq_("./flattenChildren");
var instantiateReactComponent = _dereq_("./instantiateReactComponent");
var shouldUpdateReactComponent = _dereq_("./shouldUpdateReactComponent");

/**
 * Updating children of a component may trigger recursive updates. The depth is
 * used to batch recursive updates to render markup more efficiently.
 *
 * @type {number}
 * @private
 */
var updateDepth = 0;

/**
 * Queue of update configuration objects.
 *
 * Each object has a `type` property that is in `ReactMultiChildUpdateTypes`.
 *
 * @type {array<object>}
 * @private
 */
var updateQueue = [];

/**
 * Queue of markup to be rendered.
 *
 * @type {array<string>}
 * @private
 */
var markupQueue = [];

/**
 * Enqueues markup to be rendered and inserted at a supplied index.
 *
 * @param {string} parentID ID of the parent component.
 * @param {string} markup Markup that renders into an element.
 * @param {number} toIndex Destination index.
 * @private
 */
function enqueueMarkup(parentID, markup, toIndex) {
  // NOTE: Null values reduce hidden classes.
  updateQueue.push({
    parentID: parentID,
    parentNode: null,
    type: ReactMultiChildUpdateTypes.INSERT_MARKUP,
    markupIndex: markupQueue.push(markup) - 1,
    textContent: null,
    fromIndex: null,
    toIndex: toIndex
  });
}

/**
 * Enqueues moving an existing element to another index.
 *
 * @param {string} parentID ID of the parent component.
 * @param {number} fromIndex Source index of the existing element.
 * @param {number} toIndex Destination index of the element.
 * @private
 */
function enqueueMove(parentID, fromIndex, toIndex) {
  // NOTE: Null values reduce hidden classes.
  updateQueue.push({
    parentID: parentID,
    parentNode: null,
    type: ReactMultiChildUpdateTypes.MOVE_EXISTING,
    markupIndex: null,
    textContent: null,
    fromIndex: fromIndex,
    toIndex: toIndex
  });
}

/**
 * Enqueues removing an element at an index.
 *
 * @param {string} parentID ID of the parent component.
 * @param {number} fromIndex Index of the element to remove.
 * @private
 */
function enqueueRemove(parentID, fromIndex) {
  // NOTE: Null values reduce hidden classes.
  updateQueue.push({
    parentID: parentID,
    parentNode: null,
    type: ReactMultiChildUpdateTypes.REMOVE_NODE,
    markupIndex: null,
    textContent: null,
    fromIndex: fromIndex,
    toIndex: null
  });
}

/**
 * Enqueues setting the text content.
 *
 * @param {string} parentID ID of the parent component.
 * @param {string} textContent Text content to set.
 * @private
 */
function enqueueTextContent(parentID, textContent) {
  // NOTE: Null values reduce hidden classes.
  updateQueue.push({
    parentID: parentID,
    parentNode: null,
    type: ReactMultiChildUpdateTypes.TEXT_CONTENT,
    markupIndex: null,
    textContent: textContent,
    fromIndex: null,
    toIndex: null
  });
}

/**
 * Processes any enqueued updates.
 *
 * @private
 */
function processQueue() {
  if (updateQueue.length) {
    ReactComponent.BackendIDOperations.dangerouslyProcessChildrenUpdates(
      updateQueue,
      markupQueue
    );
    clearQueue();
  }
}

/**
 * Clears any enqueued updates.
 *
 * @private
 */
function clearQueue() {
  updateQueue.length = 0;
  markupQueue.length = 0;
}

/**
 * ReactMultiChild are capable of reconciling multiple children.
 *
 * @class ReactMultiChild
 * @internal
 */
var ReactMultiChild = {

  /**
   * Provides common functionality for components that must reconcile multiple
   * children. This is used by `ReactDOMComponent` to mount, update, and
   * unmount child components.
   *
   * @lends {ReactMultiChild.prototype}
   */
  Mixin: {

    /**
     * Generates a "mount image" for each of the supplied children. In the case
     * of `ReactDOMComponent`, a mount image is a string of markup.
     *
     * @param {?object} nestedChildren Nested child maps.
     * @return {array} An array of mounted representations.
     * @internal
     */
    mountChildren: function(nestedChildren, transaction) {
      var children = flattenChildren(nestedChildren);
      var mountImages = [];
      var index = 0;
      this._renderedChildren = children;
      for (var name in children) {
        var child = children[name];
        if (children.hasOwnProperty(name)) {
          // The rendered children must be turned into instances as they're
          // mounted.
          var childInstance = instantiateReactComponent(child);
          children[name] = childInstance;
          // Inlined for performance, see `ReactInstanceHandles.createReactID`.
          var rootID = this._rootNodeID + name;
          var mountImage = childInstance.mountComponent(
            rootID,
            transaction,
            this._mountDepth + 1
          );
          childInstance._mountIndex = index;
          mountImages.push(mountImage);
          index++;
        }
      }
      return mountImages;
    },

    /**
     * Replaces any rendered children with a text content string.
     *
     * @param {string} nextContent String of content.
     * @internal
     */
    updateTextContent: function(nextContent) {
      updateDepth++;
      var errorThrown = true;
      try {
        var prevChildren = this._renderedChildren;
        // Remove any rendered children.
        for (var name in prevChildren) {
          if (prevChildren.hasOwnProperty(name)) {
            this._unmountChildByName(prevChildren[name], name);
          }
        }
        // Set new text content.
        this.setTextContent(nextContent);
        errorThrown = false;
      } finally {
        updateDepth--;
        if (!updateDepth) {
          errorThrown ? clearQueue() : processQueue();
        }
      }
    },

    /**
     * Updates the rendered children with new children.
     *
     * @param {?object} nextNestedChildren Nested child maps.
     * @param {ReactReconcileTransaction} transaction
     * @internal
     */
    updateChildren: function(nextNestedChildren, transaction) {
      updateDepth++;
      var errorThrown = true;
      try {
        this._updateChildren(nextNestedChildren, transaction);
        errorThrown = false;
      } finally {
        updateDepth--;
        if (!updateDepth) {
          errorThrown ? clearQueue() : processQueue();
        }
      }
    },

    /**
     * Improve performance by isolating this hot code path from the try/catch
     * block in `updateChildren`.
     *
     * @param {?object} nextNestedChildren Nested child maps.
     * @param {ReactReconcileTransaction} transaction
     * @final
     * @protected
     */
    _updateChildren: function(nextNestedChildren, transaction) {
      var nextChildren = flattenChildren(nextNestedChildren);
      var prevChildren = this._renderedChildren;
      if (!nextChildren && !prevChildren) {
        return;
      }
      var name;
      // `nextIndex` will increment for each child in `nextChildren`, but
      // `lastIndex` will be the last index visited in `prevChildren`.
      var lastIndex = 0;
      var nextIndex = 0;
      for (name in nextChildren) {
        if (!nextChildren.hasOwnProperty(name)) {
          continue;
        }
        var prevChild = prevChildren && prevChildren[name];
        var prevDescriptor = prevChild && prevChild._descriptor;
        var nextDescriptor = nextChildren[name];
        if (shouldUpdateReactComponent(prevDescriptor, nextDescriptor)) {
          this.moveChild(prevChild, nextIndex, lastIndex);
          lastIndex = Math.max(prevChild._mountIndex, lastIndex);
          prevChild.receiveComponent(nextDescriptor, transaction);
          prevChild._mountIndex = nextIndex;
        } else {
          if (prevChild) {
            // Update `lastIndex` before `_mountIndex` gets unset by unmounting.
            lastIndex = Math.max(prevChild._mountIndex, lastIndex);
            this._unmountChildByName(prevChild, name);
          }
          // The child must be instantiated before it's mounted.
          var nextChildInstance = instantiateReactComponent(nextDescriptor);
          this._mountChildByNameAtIndex(
            nextChildInstance, name, nextIndex, transaction
          );
        }
        nextIndex++;
      }
      // Remove children that are no longer present.
      for (name in prevChildren) {
        if (prevChildren.hasOwnProperty(name) &&
            !(nextChildren && nextChildren[name])) {
          this._unmountChildByName(prevChildren[name], name);
        }
      }
    },

    /**
     * Unmounts all rendered children. This should be used to clean up children
     * when this component is unmounted.
     *
     * @internal
     */
    unmountChildren: function() {
      var renderedChildren = this._renderedChildren;
      for (var name in renderedChildren) {
        var renderedChild = renderedChildren[name];
        // TODO: When is this not true?
        if (renderedChild.unmountComponent) {
          renderedChild.unmountComponent();
        }
      }
      this._renderedChildren = null;
    },

    /**
     * Moves a child component to the supplied index.
     *
     * @param {ReactComponent} child Component to move.
     * @param {number} toIndex Destination index of the element.
     * @param {number} lastIndex Last index visited of the siblings of `child`.
     * @protected
     */
    moveChild: function(child, toIndex, lastIndex) {
      // If the index of `child` is less than `lastIndex`, then it needs to
      // be moved. Otherwise, we do not need to move it because a child will be
      // inserted or moved before `child`.
      if (child._mountIndex < lastIndex) {
        enqueueMove(this._rootNodeID, child._mountIndex, toIndex);
      }
    },

    /**
     * Creates a child component.
     *
     * @param {ReactComponent} child Component to create.
     * @param {string} mountImage Markup to insert.
     * @protected
     */
    createChild: function(child, mountImage) {
      enqueueMarkup(this._rootNodeID, mountImage, child._mountIndex);
    },

    /**
     * Removes a child component.
     *
     * @param {ReactComponent} child Child to remove.
     * @protected
     */
    removeChild: function(child) {
      enqueueRemove(this._rootNodeID, child._mountIndex);
    },

    /**
     * Sets this text content string.
     *
     * @param {string} textContent Text content to set.
     * @protected
     */
    setTextContent: function(textContent) {
      enqueueTextContent(this._rootNodeID, textContent);
    },

    /**
     * Mounts a child with the supplied name.
     *
     * NOTE: This is part of `updateChildren` and is here for readability.
     *
     * @param {ReactComponent} child Component to mount.
     * @param {string} name Name of the child.
     * @param {number} index Index at which to insert the child.
     * @param {ReactReconcileTransaction} transaction
     * @private
     */
    _mountChildByNameAtIndex: function(child, name, index, transaction) {
      // Inlined for performance, see `ReactInstanceHandles.createReactID`.
      var rootID = this._rootNodeID + name;
      var mountImage = child.mountComponent(
        rootID,
        transaction,
        this._mountDepth + 1
      );
      child._mountIndex = index;
      this.createChild(child, mountImage);
      this._renderedChildren = this._renderedChildren || {};
      this._renderedChildren[name] = child;
    },

    /**
     * Unmounts a rendered child by name.
     *
     * NOTE: This is part of `updateChildren` and is here for readability.
     *
     * @param {ReactComponent} child Component to unmount.
     * @param {string} name Name of the child in `this._renderedChildren`.
     * @private
     */
    _unmountChildByName: function(child, name) {
      this.removeChild(child);
      child._mountIndex = null;
      child.unmountComponent();
      delete this._renderedChildren[name];
    }

  }

};

module.exports = ReactMultiChild;

},{"./ReactComponent":35,"./ReactMultiChildUpdateTypes":69,"./flattenChildren":119,"./instantiateReactComponent":133,"./shouldUpdateReactComponent":154}],69:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactMultiChildUpdateTypes
 */



var keyMirror = _dereq_("./keyMirror");

/**
 * When a component's children are updated, a series of update configuration
 * objects are created in order to batch and serialize the required changes.
 *
 * Enumerates all the possible types of update configurations.
 *
 * @internal
 */
var ReactMultiChildUpdateTypes = keyMirror({
  INSERT_MARKUP: null,
  MOVE_EXISTING: null,
  REMOVE_NODE: null,
  TEXT_CONTENT: null
});

module.exports = ReactMultiChildUpdateTypes;

},{"./keyMirror":140}],70:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactOwner
 */



var emptyObject = _dereq_("./emptyObject");
var invariant = _dereq_("./invariant");

/**
 * ReactOwners are capable of storing references to owned components.
 *
 * All components are capable of //being// referenced by owner components, but
 * only ReactOwner components are capable of //referencing// owned components.
 * The named reference is known as a "ref".
 *
 * Refs are available when mounted and updated during reconciliation.
 *
 *   var MyComponent = React.createClass({
 *     render: function() {
 *       return (
 *         <div onClick={this.handleClick}>
 *           <CustomComponent ref="custom" />
 *         </div>
 *       );
 *     },
 *     handleClick: function() {
 *       this.refs.custom.handleClick();
 *     },
 *     componentDidMount: function() {
 *       this.refs.custom.initialize();
 *     }
 *   });
 *
 * Refs should rarely be used. When refs are used, they should only be done to
 * control data that is not handled by React's data flow.
 *
 * @class ReactOwner
 */
var ReactOwner = {

  /**
   * @param {?object} object
   * @return {boolean} True if `object` is a valid owner.
   * @final
   */
  isValidOwner: function(object) {
    return !!(
      object &&
      typeof object.attachRef === 'function' &&
      typeof object.detachRef === 'function'
    );
  },

  /**
   * Adds a component by ref to an owner component.
   *
   * @param {ReactComponent} component Component to reference.
   * @param {string} ref Name by which to refer to the component.
   * @param {ReactOwner} owner Component on which to record the ref.
   * @final
   * @internal
   */
  addComponentAsRefTo: function(component, ref, owner) {
    ("production" !== "development" ? invariant(
      ReactOwner.isValidOwner(owner),
      'addComponentAsRefTo(...): Only a ReactOwner can have refs. This ' +
      'usually means that you\'re trying to add a ref to a component that ' +
      'doesn\'t have an owner (that is, was not created inside of another ' +
      'component\'s `render` method). Try rendering this component inside of ' +
      'a new top-level component which will hold the ref.'
    ) : invariant(ReactOwner.isValidOwner(owner)));
    owner.attachRef(ref, component);
  },

  /**
   * Removes a component by ref from an owner component.
   *
   * @param {ReactComponent} component Component to dereference.
   * @param {string} ref Name of the ref to remove.
   * @param {ReactOwner} owner Component on which the ref is recorded.
   * @final
   * @internal
   */
  removeComponentAsRefFrom: function(component, ref, owner) {
    ("production" !== "development" ? invariant(
      ReactOwner.isValidOwner(owner),
      'removeComponentAsRefFrom(...): Only a ReactOwner can have refs. This ' +
      'usually means that you\'re trying to remove a ref to a component that ' +
      'doesn\'t have an owner (that is, was not created inside of another ' +
      'component\'s `render` method). Try rendering this component inside of ' +
      'a new top-level component which will hold the ref.'
    ) : invariant(ReactOwner.isValidOwner(owner)));
    // Check that `component` is still the current ref because we do not want to
    // detach the ref if another component stole it.
    if (owner.refs[ref] === component) {
      owner.detachRef(ref);
    }
  },

  /**
   * A ReactComponent must mix this in to have refs.
   *
   * @lends {ReactOwner.prototype}
   */
  Mixin: {

    construct: function() {
      this.refs = emptyObject;
    },

    /**
     * Lazily allocates the refs object and stores `component` as `ref`.
     *
     * @param {string} ref Reference name.
     * @param {component} component Component to store as `ref`.
     * @final
     * @private
     */
    attachRef: function(ref, component) {
      ("production" !== "development" ? invariant(
        component.isOwnedBy(this),
        'attachRef(%s, ...): Only a component\'s owner can store a ref to it.',
        ref
      ) : invariant(component.isOwnedBy(this)));
      var refs = this.refs === emptyObject ? (this.refs = {}) : this.refs;
      refs[ref] = component;
    },

    /**
     * Detaches a reference name.
     *
     * @param {string} ref Name to dereference.
     * @final
     * @private
     */
    detachRef: function(ref) {
      delete this.refs[ref];
    }

  }

};

module.exports = ReactOwner;

},{"./emptyObject":117,"./invariant":134}],71:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactPerf
 * @typechecks static-only
 */



/**
 * ReactPerf is a general AOP system designed to measure performance. This
 * module only has the hooks: see ReactDefaultPerf for the analysis tool.
 */
var ReactPerf = {
  /**
   * Boolean to enable/disable measurement. Set to false by default to prevent
   * accidental logging and perf loss.
   */
  enableMeasure: false,

  /**
   * Holds onto the measure function in use. By default, don't measure
   * anything, but we'll override this if we inject a measure function.
   */
  storedMeasure: _noMeasure,

  /**
   * Use this to wrap methods you want to measure. Zero overhead in production.
   *
   * @param {string} objName
   * @param {string} fnName
   * @param {function} func
   * @return {function}
   */
  measure: function(objName, fnName, func) {
    if ("production" !== "development") {
      var measuredFunc = null;
      return function() {
        if (ReactPerf.enableMeasure) {
          if (!measuredFunc) {
            measuredFunc = ReactPerf.storedMeasure(objName, fnName, func);
          }
          return measuredFunc.apply(this, arguments);
        }
        return func.apply(this, arguments);
      };
    }
    return func;
  },

  injection: {
    /**
     * @param {function} measure
     */
    injectMeasure: function(measure) {
      ReactPerf.storedMeasure = measure;
    }
  }
};

/**
 * Simply passes through the measured function, without measuring it.
 *
 * @param {string} objName
 * @param {string} fnName
 * @param {function} func
 * @return {function}
 */
function _noMeasure(objName, fnName, func) {
  return func;
}

module.exports = ReactPerf;

},{}],72:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactPropTransferer
 */



var emptyFunction = _dereq_("./emptyFunction");
var invariant = _dereq_("./invariant");
var joinClasses = _dereq_("./joinClasses");
var merge = _dereq_("./merge");

/**
 * Creates a transfer strategy that will merge prop values using the supplied
 * `mergeStrategy`. If a prop was previously unset, this just sets it.
 *
 * @param {function} mergeStrategy
 * @return {function}
 */
function createTransferStrategy(mergeStrategy) {
  return function(props, key, value) {
    if (!props.hasOwnProperty(key)) {
      props[key] = value;
    } else {
      props[key] = mergeStrategy(props[key], value);
    }
  };
}

var transferStrategyMerge = createTransferStrategy(function(a, b) {
  // `merge` overrides the first object's (`props[key]` above) keys using the
  // second object's (`value`) keys. An object's style's existing `propA` would
  // get overridden. Flip the order here.
  return merge(b, a);
});

/**
 * Transfer strategies dictate how props are transferred by `transferPropsTo`.
 * NOTE: if you add any more exceptions to this list you should be sure to
 * update `cloneWithProps()` accordingly.
 */
var TransferStrategies = {
  /**
   * Never transfer `children`.
   */
  children: emptyFunction,
  /**
   * Transfer the `className` prop by merging them.
   */
  className: createTransferStrategy(joinClasses),
  /**
   * Never transfer the `key` prop.
   */
  key: emptyFunction,
  /**
   * Never transfer the `ref` prop.
   */
  ref: emptyFunction,
  /**
   * Transfer the `style` prop (which is an object) by merging them.
   */
  style: transferStrategyMerge
};

/**
 * Mutates the first argument by transferring the properties from the second
 * argument.
 *
 * @param {object} props
 * @param {object} newProps
 * @return {object}
 */
function transferInto(props, newProps) {
  for (var thisKey in newProps) {
    if (!newProps.hasOwnProperty(thisKey)) {
      continue;
    }

    var transferStrategy = TransferStrategies[thisKey];

    if (transferStrategy && TransferStrategies.hasOwnProperty(thisKey)) {
      transferStrategy(props, thisKey, newProps[thisKey]);
    } else if (!props.hasOwnProperty(thisKey)) {
      props[thisKey] = newProps[thisKey];
    }
  }
  return props;
}

/**
 * ReactPropTransferer are capable of transferring props to another component
 * using a `transferPropsTo` method.
 *
 * @class ReactPropTransferer
 */
var ReactPropTransferer = {

  TransferStrategies: TransferStrategies,

  /**
   * Merge two props objects using TransferStrategies.
   *
   * @param {object} oldProps original props (they take precedence)
   * @param {object} newProps new props to merge in
   * @return {object} a new object containing both sets of props merged.
   */
  mergeProps: function(oldProps, newProps) {
    return transferInto(merge(oldProps), newProps);
  },

  /**
   * @lends {ReactPropTransferer.prototype}
   */
  Mixin: {

    /**
     * Transfer props from this component to a target component.
     *
     * Props that do not have an explicit transfer strategy will be transferred
     * only if the target component does not already have the prop set.
     *
     * This is usually used to pass down props to a returned root component.
     *
     * @param {ReactDescriptor} descriptor Component receiving the properties.
     * @return {ReactDescriptor} The supplied `component`.
     * @final
     * @protected
     */
    transferPropsTo: function(descriptor) {
      ("production" !== "development" ? invariant(
        descriptor._owner === this,
        '%s: You can\'t call transferPropsTo() on a component that you ' +
        'don\'t own, %s. This usually means you are calling ' +
        'transferPropsTo() on a component passed in as props or children.',
        this.constructor.displayName,
        descriptor.type.displayName
      ) : invariant(descriptor._owner === this));

      // Because descriptors are immutable we have to merge into the existing
      // props object rather than clone it.
      transferInto(descriptor.props, this.props);

      return descriptor;
    }

  }
};

module.exports = ReactPropTransferer;

},{"./emptyFunction":116,"./invariant":134,"./joinClasses":139,"./merge":144}],73:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactPropTypeLocationNames
 */



var ReactPropTypeLocationNames = {};

if ("production" !== "development") {
  ReactPropTypeLocationNames = {
    prop: 'prop',
    context: 'context',
    childContext: 'child context'
  };
}

module.exports = ReactPropTypeLocationNames;

},{}],74:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactPropTypeLocations
 */



var keyMirror = _dereq_("./keyMirror");

var ReactPropTypeLocations = keyMirror({
  prop: null,
  context: null,
  childContext: null
});

module.exports = ReactPropTypeLocations;

},{"./keyMirror":140}],75:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactPropTypes
 */



var ReactDescriptor = _dereq_("./ReactDescriptor");
var ReactPropTypeLocationNames = _dereq_("./ReactPropTypeLocationNames");

var emptyFunction = _dereq_("./emptyFunction");

/**
 * Collection of methods that allow declaration and validation of props that are
 * supplied to React components. Example usage:
 *
 *   var Props = require('ReactPropTypes');
 *   var MyArticle = React.createClass({
 *     propTypes: {
 *       // An optional string prop named "description".
 *       description: Props.string,
 *
 *       // A required enum prop named "category".
 *       category: Props.oneOf(['News','Photos']).isRequired,
 *
 *       // A prop named "dialog" that requires an instance of Dialog.
 *       dialog: Props.instanceOf(Dialog).isRequired
 *     },
 *     render: function() { ... }
 *   });
 *
 * A more formal specification of how these methods are used:
 *
 *   type := array|bool|func|object|number|string|oneOf([...])|instanceOf(...)
 *   decl := ReactPropTypes.{type}(.isRequired)?
 *
 * Each and every declaration produces a function with the same signature. This
 * allows the creation of custom validation functions. For example:
 *
 *  var MyLink = React.createClass({
 *    propTypes: {
 *      // An optional string or URI prop named "href".
 *      href: function(props, propName, componentName) {
 *        var propValue = props[propName];
 *        if (propValue != null && typeof propValue !== 'string' &&
 *            !(propValue instanceof URI)) {
 *          return new Error(
 *            'Expected a string or an URI for ' + propName + ' in ' +
 *            componentName
 *          );
 *        }
 *      }
 *    },
 *    render: function() {...}
 *  });
 *
 * @internal
 */

var ANONYMOUS = '<<anonymous>>';

var ReactPropTypes = {
  array: createPrimitiveTypeChecker('array'),
  bool: createPrimitiveTypeChecker('boolean'),
  func: createPrimitiveTypeChecker('function'),
  number: createPrimitiveTypeChecker('number'),
  object: createPrimitiveTypeChecker('object'),
  string: createPrimitiveTypeChecker('string'),

  any: createAnyTypeChecker(),
  arrayOf: createArrayOfTypeChecker,
  component: createComponentTypeChecker(),
  instanceOf: createInstanceTypeChecker,
  objectOf: createObjectOfTypeChecker,
  oneOf: createEnumTypeChecker,
  oneOfType: createUnionTypeChecker,
  renderable: createRenderableTypeChecker(),
  shape: createShapeTypeChecker
};

function createChainableTypeChecker(validate) {
  function checkType(isRequired, props, propName, componentName, location) {
    componentName = componentName || ANONYMOUS;
    if (props[propName] == null) {
      var locationName = ReactPropTypeLocationNames[location];
      if (isRequired) {
        return new Error(
          ("Required " + locationName + " `" + propName + "` was not specified in ")+
          ("`" + componentName + "`.")
        );
      }
    } else {
      return validate(props, propName, componentName, location);
    }
  }

  var chainedCheckType = checkType.bind(null, false);
  chainedCheckType.isRequired = checkType.bind(null, true);

  return chainedCheckType;
}

function createPrimitiveTypeChecker(expectedType) {
  function validate(props, propName, componentName, location) {
    var propValue = props[propName];
    var propType = getPropType(propValue);
    if (propType !== expectedType) {
      var locationName = ReactPropTypeLocationNames[location];
      // `propValue` being instance of, say, date/regexp, pass the 'object'
      // check, but we can offer a more precise error message here rather than
      // 'of type `object`'.
      var preciseType = getPreciseType(propValue);

      return new Error(
        ("Invalid " + locationName + " `" + propName + "` of type `" + preciseType + "` ") +
        ("supplied to `" + componentName + "`, expected `" + expectedType + "`.")
      );
    }
  }
  return createChainableTypeChecker(validate);
}

function createAnyTypeChecker() {
  return createChainableTypeChecker(emptyFunction.thatReturns());
}

function createArrayOfTypeChecker(typeChecker) {
  function validate(props, propName, componentName, location) {
    var propValue = props[propName];
    if (!Array.isArray(propValue)) {
      var locationName = ReactPropTypeLocationNames[location];
      var propType = getPropType(propValue);
      return new Error(
        ("Invalid " + locationName + " `" + propName + "` of type ") +
        ("`" + propType + "` supplied to `" + componentName + "`, expected an array.")
      );
    }
    for (var i = 0; i < propValue.length; i++) {
      var error = typeChecker(propValue, i, componentName, location);
      if (error instanceof Error) {
        return error;
      }
    }
  }
  return createChainableTypeChecker(validate);
}

function createComponentTypeChecker() {
  function validate(props, propName, componentName, location) {
    if (!ReactDescriptor.isValidDescriptor(props[propName])) {
      var locationName = ReactPropTypeLocationNames[location];
      return new Error(
        ("Invalid " + locationName + " `" + propName + "` supplied to ") +
        ("`" + componentName + "`, expected a React component.")
      );
    }
  }
  return createChainableTypeChecker(validate);
}

function createInstanceTypeChecker(expectedClass) {
  function validate(props, propName, componentName, location) {
    if (!(props[propName] instanceof expectedClass)) {
      var locationName = ReactPropTypeLocationNames[location];
      var expectedClassName = expectedClass.name || ANONYMOUS;
      return new Error(
        ("Invalid " + locationName + " `" + propName + "` supplied to ") +
        ("`" + componentName + "`, expected instance of `" + expectedClassName + "`.")
      );
    }
  }
  return createChainableTypeChecker(validate);
}

function createEnumTypeChecker(expectedValues) {
  function validate(props, propName, componentName, location) {
    var propValue = props[propName];
    for (var i = 0; i < expectedValues.length; i++) {
      if (propValue === expectedValues[i]) {
        return;
      }
    }

    var locationName = ReactPropTypeLocationNames[location];
    var valuesString = JSON.stringify(expectedValues);
    return new Error(
      ("Invalid " + locationName + " `" + propName + "` of value `" + propValue + "` ") +
      ("supplied to `" + componentName + "`, expected one of " + valuesString + ".")
    );
  }
  return createChainableTypeChecker(validate);
}

function createObjectOfTypeChecker(typeChecker) {
  function validate(props, propName, componentName, location) {
    var propValue = props[propName];
    var propType = getPropType(propValue);
    if (propType !== 'object') {
      var locationName = ReactPropTypeLocationNames[location];
      return new Error(
        ("Invalid " + locationName + " `" + propName + "` of type ") +
        ("`" + propType + "` supplied to `" + componentName + "`, expected an object.")
      );
    }
    for (var key in propValue) {
      if (propValue.hasOwnProperty(key)) {
        var error = typeChecker(propValue, key, componentName, location);
        if (error instanceof Error) {
          return error;
        }
      }
    }
  }
  return createChainableTypeChecker(validate);
}

function createUnionTypeChecker(arrayOfTypeCheckers) {
  function validate(props, propName, componentName, location) {
    for (var i = 0; i < arrayOfTypeCheckers.length; i++) {
      var checker = arrayOfTypeCheckers[i];
      if (checker(props, propName, componentName, location) == null) {
        return;
      }
    }

    var locationName = ReactPropTypeLocationNames[location];
    return new Error(
      ("Invalid " + locationName + " `" + propName + "` supplied to ") +
      ("`" + componentName + "`.")
    );
  }
  return createChainableTypeChecker(validate);
}

function createRenderableTypeChecker() {
  function validate(props, propName, componentName, location) {
    if (!isRenderable(props[propName])) {
      var locationName = ReactPropTypeLocationNames[location];
      return new Error(
        ("Invalid " + locationName + " `" + propName + "` supplied to ") +
        ("`" + componentName + "`, expected a renderable prop.")
      );
    }
  }
  return createChainableTypeChecker(validate);
}

function createShapeTypeChecker(shapeTypes) {
  function validate(props, propName, componentName, location) {
    var propValue = props[propName];
    var propType = getPropType(propValue);
    if (propType !== 'object') {
      var locationName = ReactPropTypeLocationNames[location];
      return new Error(
        ("Invalid " + locationName + " `" + propName + "` of type `" + propType + "` ") +
        ("supplied to `" + componentName + "`, expected `object`.")
      );
    }
    for (var key in shapeTypes) {
      var checker = shapeTypes[key];
      if (!checker) {
        continue;
      }
      var error = checker(propValue, key, componentName, location);
      if (error) {
        return error;
      }
    }
  }
  return createChainableTypeChecker(validate, 'expected `object`');
}

function isRenderable(propValue) {
  switch(typeof propValue) {
    // TODO: this was probably written with the assumption that we're not
    // returning `this.props.component` directly from `render`. This is
    // currently not supported but we should, to make it consistent.
    case 'number':
    case 'string':
      return true;
    case 'boolean':
      return !propValue;
    case 'object':
      if (Array.isArray(propValue)) {
        return propValue.every(isRenderable);
      }
      if (ReactDescriptor.isValidDescriptor(propValue)) {
        return true;
      }
      for (var k in propValue) {
        if (!isRenderable(propValue[k])) {
          return false;
        }
      }
      return true;
    default:
      return false;
  }
}

// Equivalent of `typeof` but with special handling for array and regexp.
function getPropType(propValue) {
  var propType = typeof propValue;
  if (Array.isArray(propValue)) {
    return 'array';
  }
  if (propValue instanceof RegExp) {
    // Old webkits (at least until Android 4.0) return 'function' rather than
    // 'object' for typeof a RegExp. We'll normalize this here so that /bla/
    // passes PropTypes.object.
    return 'object';
  }
  return propType;
}

// This handles more types than `getPropType`. Only used for error messages.
// See `createPrimitiveTypeChecker`.
function getPreciseType(propValue) {
  var propType = getPropType(propValue);
  if (propType === 'object') {
    if (propValue instanceof Date) {
      return 'date';
    } else if (propValue instanceof RegExp) {
      return 'regexp';
    }
  }
  return propType;
}

module.exports = ReactPropTypes;

},{"./ReactDescriptor":56,"./ReactPropTypeLocationNames":73,"./emptyFunction":116}],76:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactPutListenerQueue
 */



var PooledClass = _dereq_("./PooledClass");
var ReactBrowserEventEmitter = _dereq_("./ReactBrowserEventEmitter");

var mixInto = _dereq_("./mixInto");

function ReactPutListenerQueue() {
  this.listenersToPut = [];
}

mixInto(ReactPutListenerQueue, {
  enqueuePutListener: function(rootNodeID, propKey, propValue) {
    this.listenersToPut.push({
      rootNodeID: rootNodeID,
      propKey: propKey,
      propValue: propValue
    });
  },

  putListeners: function() {
    for (var i = 0; i < this.listenersToPut.length; i++) {
      var listenerToPut = this.listenersToPut[i];
      ReactBrowserEventEmitter.putListener(
        listenerToPut.rootNodeID,
        listenerToPut.propKey,
        listenerToPut.propValue
      );
    }
  },

  reset: function() {
    this.listenersToPut.length = 0;
  },

  destructor: function() {
    this.reset();
  }
});

PooledClass.addPoolingTo(ReactPutListenerQueue);

module.exports = ReactPutListenerQueue;

},{"./PooledClass":28,"./ReactBrowserEventEmitter":31,"./mixInto":147}],77:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactReconcileTransaction
 * @typechecks static-only
 */



var CallbackQueue = _dereq_("./CallbackQueue");
var PooledClass = _dereq_("./PooledClass");
var ReactBrowserEventEmitter = _dereq_("./ReactBrowserEventEmitter");
var ReactInputSelection = _dereq_("./ReactInputSelection");
var ReactPutListenerQueue = _dereq_("./ReactPutListenerQueue");
var Transaction = _dereq_("./Transaction");

var mixInto = _dereq_("./mixInto");

/**
 * Ensures that, when possible, the selection range (currently selected text
 * input) is not disturbed by performing the transaction.
 */
var SELECTION_RESTORATION = {
  /**
   * @return {Selection} Selection information.
   */
  initialize: ReactInputSelection.getSelectionInformation,
  /**
   * @param {Selection} sel Selection information returned from `initialize`.
   */
  close: ReactInputSelection.restoreSelection
};

/**
 * Suppresses events (blur/focus) that could be inadvertently dispatched due to
 * high level DOM manipulations (like temporarily removing a text input from the
 * DOM).
 */
var EVENT_SUPPRESSION = {
  /**
   * @return {boolean} The enabled status of `ReactBrowserEventEmitter` before
   * the reconciliation.
   */
  initialize: function() {
    var currentlyEnabled = ReactBrowserEventEmitter.isEnabled();
    ReactBrowserEventEmitter.setEnabled(false);
    return currentlyEnabled;
  },

  /**
   * @param {boolean} previouslyEnabled Enabled status of
   *   `ReactBrowserEventEmitter` before the reconciliation occured. `close`
   *   restores the previous value.
   */
  close: function(previouslyEnabled) {
    ReactBrowserEventEmitter.setEnabled(previouslyEnabled);
  }
};

/**
 * Provides a queue for collecting `componentDidMount` and
 * `componentDidUpdate` callbacks during the the transaction.
 */
var ON_DOM_READY_QUEUEING = {
  /**
   * Initializes the internal `onDOMReady` queue.
   */
  initialize: function() {
    this.reactMountReady.reset();
  },

  /**
   * After DOM is flushed, invoke all registered `onDOMReady` callbacks.
   */
  close: function() {
    this.reactMountReady.notifyAll();
  }
};

var PUT_LISTENER_QUEUEING = {
  initialize: function() {
    this.putListenerQueue.reset();
  },

  close: function() {
    this.putListenerQueue.putListeners();
  }
};

/**
 * Executed within the scope of the `Transaction` instance. Consider these as
 * being member methods, but with an implied ordering while being isolated from
 * each other.
 */
var TRANSACTION_WRAPPERS = [
  PUT_LISTENER_QUEUEING,
  SELECTION_RESTORATION,
  EVENT_SUPPRESSION,
  ON_DOM_READY_QUEUEING
];

/**
 * Currently:
 * - The order that these are listed in the transaction is critical:
 * - Suppresses events.
 * - Restores selection range.
 *
 * Future:
 * - Restore document/overflow scroll positions that were unintentionally
 *   modified via DOM insertions above the top viewport boundary.
 * - Implement/integrate with customized constraint based layout system and keep
 *   track of which dimensions must be remeasured.
 *
 * @class ReactReconcileTransaction
 */
function ReactReconcileTransaction() {
  this.reinitializeTransaction();
  // Only server-side rendering really needs this option (see
  // `ReactServerRendering`), but server-side uses
  // `ReactServerRenderingTransaction` instead. This option is here so that it's
  // accessible and defaults to false when `ReactDOMComponent` and
  // `ReactTextComponent` checks it in `mountComponent`.`
  this.renderToStaticMarkup = false;
  this.reactMountReady = CallbackQueue.getPooled(null);
  this.putListenerQueue = ReactPutListenerQueue.getPooled();
}

var Mixin = {
  /**
   * @see Transaction
   * @abstract
   * @final
   * @return {array<object>} List of operation wrap proceedures.
   *   TODO: convert to array<TransactionWrapper>
   */
  getTransactionWrappers: function() {
    return TRANSACTION_WRAPPERS;
  },

  /**
   * @return {object} The queue to collect `onDOMReady` callbacks with.
   */
  getReactMountReady: function() {
    return this.reactMountReady;
  },

  getPutListenerQueue: function() {
    return this.putListenerQueue;
  },

  /**
   * `PooledClass` looks for this, and will invoke this before allowing this
   * instance to be resused.
   */
  destructor: function() {
    CallbackQueue.release(this.reactMountReady);
    this.reactMountReady = null;

    ReactPutListenerQueue.release(this.putListenerQueue);
    this.putListenerQueue = null;
  }
};


mixInto(ReactReconcileTransaction, Transaction.Mixin);
mixInto(ReactReconcileTransaction, Mixin);

PooledClass.addPoolingTo(ReactReconcileTransaction);

module.exports = ReactReconcileTransaction;

},{"./CallbackQueue":6,"./PooledClass":28,"./ReactBrowserEventEmitter":31,"./ReactInputSelection":63,"./ReactPutListenerQueue":76,"./Transaction":104,"./mixInto":147}],78:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactRootIndex
 * @typechecks
 */



var ReactRootIndexInjection = {
  /**
   * @param {function} _createReactRootIndex
   */
  injectCreateReactRootIndex: function(_createReactRootIndex) {
    ReactRootIndex.createReactRootIndex = _createReactRootIndex;
  }
};

var ReactRootIndex = {
  createReactRootIndex: null,
  injection: ReactRootIndexInjection
};

module.exports = ReactRootIndex;

},{}],79:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @typechecks static-only
 * @providesModule ReactServerRendering
 */


var ReactDescriptor = _dereq_("./ReactDescriptor");
var ReactInstanceHandles = _dereq_("./ReactInstanceHandles");
var ReactMarkupChecksum = _dereq_("./ReactMarkupChecksum");
var ReactServerRenderingTransaction =
  _dereq_("./ReactServerRenderingTransaction");

var instantiateReactComponent = _dereq_("./instantiateReactComponent");
var invariant = _dereq_("./invariant");

/**
 * @param {ReactComponent} component
 * @return {string} the HTML markup
 */
function renderComponentToString(component) {
  ("production" !== "development" ? invariant(
    ReactDescriptor.isValidDescriptor(component),
    'renderComponentToString(): You must pass a valid ReactComponent.'
  ) : invariant(ReactDescriptor.isValidDescriptor(component)));

  ("production" !== "development" ? invariant(
    !(arguments.length === 2 && typeof arguments[1] === 'function'),
    'renderComponentToString(): This function became synchronous and now ' +
    'returns the generated markup. Please remove the second parameter.'
  ) : invariant(!(arguments.length === 2 && typeof arguments[1] === 'function')));

  var transaction;
  try {
    var id = ReactInstanceHandles.createReactRootID();
    transaction = ReactServerRenderingTransaction.getPooled(false);

    return transaction.perform(function() {
      var componentInstance = instantiateReactComponent(component);
      var markup = componentInstance.mountComponent(id, transaction, 0);
      return ReactMarkupChecksum.addChecksumToMarkup(markup);
    }, null);
  } finally {
    ReactServerRenderingTransaction.release(transaction);
  }
}

/**
 * @param {ReactComponent} component
 * @return {string} the HTML markup, without the extra React ID and checksum
* (for generating static pages)
 */
function renderComponentToStaticMarkup(component) {
  ("production" !== "development" ? invariant(
    ReactDescriptor.isValidDescriptor(component),
    'renderComponentToStaticMarkup(): You must pass a valid ReactComponent.'
  ) : invariant(ReactDescriptor.isValidDescriptor(component)));

  var transaction;
  try {
    var id = ReactInstanceHandles.createReactRootID();
    transaction = ReactServerRenderingTransaction.getPooled(true);

    return transaction.perform(function() {
      var componentInstance = instantiateReactComponent(component);
      return componentInstance.mountComponent(id, transaction, 0);
    }, null);
  } finally {
    ReactServerRenderingTransaction.release(transaction);
  }
}

module.exports = {
  renderComponentToString: renderComponentToString,
  renderComponentToStaticMarkup: renderComponentToStaticMarkup
};

},{"./ReactDescriptor":56,"./ReactInstanceHandles":64,"./ReactMarkupChecksum":66,"./ReactServerRenderingTransaction":80,"./instantiateReactComponent":133,"./invariant":134}],80:[function(_dereq_,module,exports){
/**
 * Copyright 2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactServerRenderingTransaction
 * @typechecks
 */



var PooledClass = _dereq_("./PooledClass");
var CallbackQueue = _dereq_("./CallbackQueue");
var ReactPutListenerQueue = _dereq_("./ReactPutListenerQueue");
var Transaction = _dereq_("./Transaction");

var emptyFunction = _dereq_("./emptyFunction");
var mixInto = _dereq_("./mixInto");

/**
 * Provides a `CallbackQueue` queue for collecting `onDOMReady` callbacks
 * during the performing of the transaction.
 */
var ON_DOM_READY_QUEUEING = {
  /**
   * Initializes the internal `onDOMReady` queue.
   */
  initialize: function() {
    this.reactMountReady.reset();
  },

  close: emptyFunction
};

var PUT_LISTENER_QUEUEING = {
  initialize: function() {
    this.putListenerQueue.reset();
  },

  close: emptyFunction
};

/**
 * Executed within the scope of the `Transaction` instance. Consider these as
 * being member methods, but with an implied ordering while being isolated from
 * each other.
 */
var TRANSACTION_WRAPPERS = [
  PUT_LISTENER_QUEUEING,
  ON_DOM_READY_QUEUEING
];

/**
 * @class ReactServerRenderingTransaction
 * @param {boolean} renderToStaticMarkup
 */
function ReactServerRenderingTransaction(renderToStaticMarkup) {
  this.reinitializeTransaction();
  this.renderToStaticMarkup = renderToStaticMarkup;
  this.reactMountReady = CallbackQueue.getPooled(null);
  this.putListenerQueue = ReactPutListenerQueue.getPooled();
}

var Mixin = {
  /**
   * @see Transaction
   * @abstract
   * @final
   * @return {array} Empty list of operation wrap proceedures.
   */
  getTransactionWrappers: function() {
    return TRANSACTION_WRAPPERS;
  },

  /**
   * @return {object} The queue to collect `onDOMReady` callbacks with.
   */
  getReactMountReady: function() {
    return this.reactMountReady;
  },

  getPutListenerQueue: function() {
    return this.putListenerQueue;
  },

  /**
   * `PooledClass` looks for this, and will invoke this before allowing this
   * instance to be resused.
   */
  destructor: function() {
    CallbackQueue.release(this.reactMountReady);
    this.reactMountReady = null;

    ReactPutListenerQueue.release(this.putListenerQueue);
    this.putListenerQueue = null;
  }
};


mixInto(ReactServerRenderingTransaction, Transaction.Mixin);
mixInto(ReactServerRenderingTransaction, Mixin);

PooledClass.addPoolingTo(ReactServerRenderingTransaction);

module.exports = ReactServerRenderingTransaction;

},{"./CallbackQueue":6,"./PooledClass":28,"./ReactPutListenerQueue":76,"./Transaction":104,"./emptyFunction":116,"./mixInto":147}],81:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactStateSetters
 */



var ReactStateSetters = {
  /**
   * Returns a function that calls the provided function, and uses the result
   * of that to set the component's state.
   *
   * @param {ReactCompositeComponent} component
   * @param {function} funcReturningState Returned callback uses this to
   *                                      determine how to update state.
   * @return {function} callback that when invoked uses funcReturningState to
   *                    determined the object literal to setState.
   */
  createStateSetter: function(component, funcReturningState) {
    return function(a, b, c, d, e, f) {
      var partialState = funcReturningState.call(component, a, b, c, d, e, f);
      if (partialState) {
        component.setState(partialState);
      }
    };
  },

  /**
   * Returns a single-argument callback that can be used to update a single
   * key in the component's state.
   *
   * Note: this is memoized function, which makes it inexpensive to call.
   *
   * @param {ReactCompositeComponent} component
   * @param {string} key The key in the state that you should update.
   * @return {function} callback of 1 argument which calls setState() with
   *                    the provided keyName and callback argument.
   */
  createStateKeySetter: function(component, key) {
    // Memoize the setters.
    var cache = component.__keySetters || (component.__keySetters = {});
    return cache[key] || (cache[key] = createStateKeySetter(component, key));
  }
};

function createStateKeySetter(component, key) {
  // Partial state is allocated outside of the function closure so it can be
  // reused with every call, avoiding memory allocation when this function
  // is called.
  var partialState = {};
  return function stateKeySetter(value) {
    partialState[key] = value;
    component.setState(partialState);
  };
}

ReactStateSetters.Mixin = {
  /**
   * Returns a function that calls the provided function, and uses the result
   * of that to set the component's state.
   *
   * For example, these statements are equivalent:
   *
   *   this.setState({x: 1});
   *   this.createStateSetter(function(xValue) {
   *     return {x: xValue};
   *   })(1);
   *
   * @param {function} funcReturningState Returned callback uses this to
   *                                      determine how to update state.
   * @return {function} callback that when invoked uses funcReturningState to
   *                    determined the object literal to setState.
   */
  createStateSetter: function(funcReturningState) {
    return ReactStateSetters.createStateSetter(this, funcReturningState);
  },

  /**
   * Returns a single-argument callback that can be used to update a single
   * key in the component's state.
   *
   * For example, these statements are equivalent:
   *
   *   this.setState({x: 1});
   *   this.createStateKeySetter('x')(1);
   *
   * Note: this is memoized function, which makes it inexpensive to call.
   *
   * @param {string} key The key in the state that you should update.
   * @return {function} callback of 1 argument which calls setState() with
   *                    the provided keyName and callback argument.
   */
  createStateKeySetter: function(key) {
    return ReactStateSetters.createStateKeySetter(this, key);
  }
};

module.exports = ReactStateSetters;

},{}],82:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactTestUtils
 */



var EventConstants = _dereq_("./EventConstants");
var EventPluginHub = _dereq_("./EventPluginHub");
var EventPropagators = _dereq_("./EventPropagators");
var React = _dereq_("./React");
var ReactDescriptor = _dereq_("./ReactDescriptor");
var ReactDOM = _dereq_("./ReactDOM");
var ReactBrowserEventEmitter = _dereq_("./ReactBrowserEventEmitter");
var ReactMount = _dereq_("./ReactMount");
var ReactTextComponent = _dereq_("./ReactTextComponent");
var ReactUpdates = _dereq_("./ReactUpdates");
var SyntheticEvent = _dereq_("./SyntheticEvent");

var mergeInto = _dereq_("./mergeInto");
var copyProperties = _dereq_("./copyProperties");

var topLevelTypes = EventConstants.topLevelTypes;

function Event(suffix) {}

/**
 * @class ReactTestUtils
 */

/**
 * Todo: Support the entire DOM.scry query syntax. For now, these simple
 * utilities will suffice for testing purposes.
 * @lends ReactTestUtils
 */
var ReactTestUtils = {
  renderIntoDocument: function(instance) {
    var div = document.createElement('div');
    // None of our tests actually require attaching the container to the
    // DOM, and doing so creates a mess that we rely on test isolation to
    // clean up, so we're going to stop honoring the name of this method
    // (and probably rename it eventually) if no problems arise.
    // document.documentElement.appendChild(div);
    return React.renderComponent(instance, div);
  },

  isDescriptor: function(descriptor) {
    return ReactDescriptor.isValidDescriptor(descriptor);
  },

  isDescriptorOfType: function(inst, convenienceConstructor) {
    return (
      ReactDescriptor.isValidDescriptor(inst) &&
      inst.type === convenienceConstructor.type
    );
  },

  isDOMComponent: function(inst) {
    return !!(inst && inst.mountComponent && inst.tagName);
  },

  isDOMComponentDescriptor: function(inst) {
    return !!(inst &&
              ReactDescriptor.isValidDescriptor(inst) &&
              !!inst.tagName);
  },

  isCompositeComponent: function(inst) {
    return typeof inst.render === 'function' &&
           typeof inst.setState === 'function';
  },

  isCompositeComponentWithType: function(inst, type) {
    return !!(ReactTestUtils.isCompositeComponent(inst) &&
             (inst.constructor === type.type));
  },

  isCompositeComponentDescriptor: function(inst) {
    if (!ReactDescriptor.isValidDescriptor(inst)) {
      return false;
    }
    // We check the prototype of the type that will get mounted, not the
    // instance itself. This is a future proof way of duck typing.
    var prototype = inst.type.prototype;
    return (
      typeof prototype.render === 'function' &&
      typeof prototype.setState === 'function'
    );
  },

  isCompositeComponentDescriptorWithType: function(inst, type) {
    return !!(ReactTestUtils.isCompositeComponentDescriptor(inst) &&
             (inst.constructor === type));
  },

  isTextComponent: function(inst) {
    return inst instanceof ReactTextComponent.type;
  },

  findAllInRenderedTree: function(inst, test) {
    if (!inst) {
      return [];
    }
    var ret = test(inst) ? [inst] : [];
    if (ReactTestUtils.isDOMComponent(inst)) {
      var renderedChildren = inst._renderedChildren;
      var key;
      for (key in renderedChildren) {
        if (!renderedChildren.hasOwnProperty(key)) {
          continue;
        }
        ret = ret.concat(
          ReactTestUtils.findAllInRenderedTree(renderedChildren[key], test)
        );
      }
    } else if (ReactTestUtils.isCompositeComponent(inst)) {
      ret = ret.concat(
        ReactTestUtils.findAllInRenderedTree(inst._renderedComponent, test)
      );
    }
    return ret;
  },

  /**
   * Finds all instance of components in the rendered tree that are DOM
   * components with the class name matching `className`.
   * @return an array of all the matches.
   */
  scryRenderedDOMComponentsWithClass: function(root, className) {
    return ReactTestUtils.findAllInRenderedTree(root, function(inst) {
      var instClassName = inst.props.className;
      return ReactTestUtils.isDOMComponent(inst) && (
        instClassName &&
        (' ' + instClassName + ' ').indexOf(' ' + className + ' ') !== -1
      );
    });
  },

  /**
   * Like scryRenderedDOMComponentsWithClass but expects there to be one result,
   * and returns that one result, or throws exception if there is any other
   * number of matches besides one.
   * @return {!ReactDOMComponent} The one match.
   */
  findRenderedDOMComponentWithClass: function(root, className) {
    var all =
      ReactTestUtils.scryRenderedDOMComponentsWithClass(root, className);
    if (all.length !== 1) {
      throw new Error('Did not find exactly one match for class:' + className);
    }
    return all[0];
  },


  /**
   * Finds all instance of components in the rendered tree that are DOM
   * components with the tag name matching `tagName`.
   * @return an array of all the matches.
   */
  scryRenderedDOMComponentsWithTag: function(root, tagName) {
    return ReactTestUtils.findAllInRenderedTree(root, function(inst) {
      return ReactTestUtils.isDOMComponent(inst) &&
            inst.tagName === tagName.toUpperCase();
    });
  },

  /**
   * Like scryRenderedDOMComponentsWithTag but expects there to be one result,
   * and returns that one result, or throws exception if there is any other
   * number of matches besides one.
   * @return {!ReactDOMComponent} The one match.
   */
  findRenderedDOMComponentWithTag: function(root, tagName) {
    var all = ReactTestUtils.scryRenderedDOMComponentsWithTag(root, tagName);
    if (all.length !== 1) {
      throw new Error('Did not find exactly one match for tag:' + tagName);
    }
    return all[0];
  },


  /**
   * Finds all instances of components with type equal to `componentType`.
   * @return an array of all the matches.
   */
  scryRenderedComponentsWithType: function(root, componentType) {
    return ReactTestUtils.findAllInRenderedTree(root, function(inst) {
      return ReactTestUtils.isCompositeComponentWithType(
        inst,
        componentType
      );
    });
  },

  /**
   * Same as `scryRenderedComponentsWithType` but expects there to be one result
   * and returns that one result, or throws exception if there is any other
   * number of matches besides one.
   * @return {!ReactComponent} The one match.
   */
  findRenderedComponentWithType: function(root, componentType) {
    var all = ReactTestUtils.scryRenderedComponentsWithType(
      root,
      componentType
    );
    if (all.length !== 1) {
      throw new Error(
        'Did not find exactly one match for componentType:' + componentType
      );
    }
    return all[0];
  },

  /**
   * Pass a mocked component module to this method to augment it with
   * useful methods that allow it to be used as a dummy React component.
   * Instead of rendering as usual, the component will become a simple
   * <div> containing any provided children.
   *
   * @param {object} module the mock function object exported from a
   *                        module that defines the component to be mocked
   * @param {?string} mockTagName optional dummy root tag name to return
   *                              from render method (overrides
   *                              module.mockTagName if provided)
   * @return {object} the ReactTestUtils object (for chaining)
   */
  mockComponent: function(module, mockTagName) {
    var ConvenienceConstructor = React.createClass({
      render: function() {
        var mockTagName = mockTagName || module.mockTagName || "div";
        return ReactDOM[mockTagName](null, this.props.children);
      }
    });

    copyProperties(module, ConvenienceConstructor);
    module.mockImplementation(ConvenienceConstructor);

    return this;
  },

  /**
   * Simulates a top level event being dispatched from a raw event that occured
   * on an `Element` node.
   * @param topLevelType {Object} A type from `EventConstants.topLevelTypes`
   * @param {!Element} node The dom to simulate an event occurring on.
   * @param {?Event} fakeNativeEvent Fake native event to use in SyntheticEvent.
   */
  simulateNativeEventOnNode: function(topLevelType, node, fakeNativeEvent) {
    fakeNativeEvent.target = node;
    ReactBrowserEventEmitter.ReactEventListener.dispatchEvent(
      topLevelType,
      fakeNativeEvent
    );
  },

  /**
   * Simulates a top level event being dispatched from a raw event that occured
   * on the `ReactDOMComponent` `comp`.
   * @param topLevelType {Object} A type from `EventConstants.topLevelTypes`.
   * @param comp {!ReactDOMComponent}
   * @param {?Event} fakeNativeEvent Fake native event to use in SyntheticEvent.
   */
  simulateNativeEventOnDOMComponent: function(
      topLevelType,
      comp,
      fakeNativeEvent) {
    ReactTestUtils.simulateNativeEventOnNode(
      topLevelType,
      comp.getDOMNode(),
      fakeNativeEvent
    );
  },

  nativeTouchData: function(x, y) {
    return {
      touches: [
        {pageX: x, pageY: y}
      ]
    };
  },

  Simulate: null,
  SimulateNative: {}
};

/**
 * Exports:
 *
 * - `ReactTestUtils.Simulate.click(Element/ReactDOMComponent)`
 * - `ReactTestUtils.Simulate.mouseMove(Element/ReactDOMComponent)`
 * - `ReactTestUtils.Simulate.change(Element/ReactDOMComponent)`
 * - ... (All keys from event plugin `eventTypes` objects)
 */
function makeSimulator(eventType) {
  return function(domComponentOrNode, eventData) {
    var node;
    if (ReactTestUtils.isDOMComponent(domComponentOrNode)) {
      node = domComponentOrNode.getDOMNode();
    } else if (domComponentOrNode.tagName) {
      node = domComponentOrNode;
    }

    var fakeNativeEvent = new Event();
    fakeNativeEvent.target = node;
    // We don't use SyntheticEvent.getPooled in order to not have to worry about
    // properly destroying any properties assigned from `eventData` upon release
    var event = new SyntheticEvent(
      ReactBrowserEventEmitter.eventNameDispatchConfigs[eventType],
      ReactMount.getID(node),
      fakeNativeEvent
    );
    mergeInto(event, eventData);
    EventPropagators.accumulateTwoPhaseDispatches(event);

    ReactUpdates.batchedUpdates(function() {
      EventPluginHub.enqueueEvents(event);
      EventPluginHub.processEventQueue();
    });
  };
}

function buildSimulators() {
  ReactTestUtils.Simulate = {};

  var eventType;
  for (eventType in ReactBrowserEventEmitter.eventNameDispatchConfigs) {
    /**
     * @param {!Element || ReactDOMComponent} domComponentOrNode
     * @param {?object} eventData Fake event data to use in SyntheticEvent.
     */
    ReactTestUtils.Simulate[eventType] = makeSimulator(eventType);
  }
}

// Rebuild ReactTestUtils.Simulate whenever event plugins are injected
var oldInjectEventPluginOrder = EventPluginHub.injection.injectEventPluginOrder;
EventPluginHub.injection.injectEventPluginOrder = function() {
  oldInjectEventPluginOrder.apply(this, arguments);
  buildSimulators();
};
var oldInjectEventPlugins = EventPluginHub.injection.injectEventPluginsByName;
EventPluginHub.injection.injectEventPluginsByName = function() {
  oldInjectEventPlugins.apply(this, arguments);
  buildSimulators();
};

buildSimulators();

/**
 * Exports:
 *
 * - `ReactTestUtils.SimulateNative.click(Element/ReactDOMComponent)`
 * - `ReactTestUtils.SimulateNative.mouseMove(Element/ReactDOMComponent)`
 * - `ReactTestUtils.SimulateNative.mouseIn/ReactDOMComponent)`
 * - `ReactTestUtils.SimulateNative.mouseOut(Element/ReactDOMComponent)`
 * - ... (All keys from `EventConstants.topLevelTypes`)
 *
 * Note: Top level event types are a subset of the entire set of handler types
 * (which include a broader set of "synthetic" events). For example, onDragDone
 * is a synthetic event. Except when testing an event plugin or React's event
 * handling code specifically, you probably want to use ReactTestUtils.Simulate
 * to dispatch synthetic events.
 */

function makeNativeSimulator(eventType) {
  return function(domComponentOrNode, nativeEventData) {
    var fakeNativeEvent = new Event(eventType);
    mergeInto(fakeNativeEvent, nativeEventData);
    if (ReactTestUtils.isDOMComponent(domComponentOrNode)) {
      ReactTestUtils.simulateNativeEventOnDOMComponent(
        eventType,
        domComponentOrNode,
        fakeNativeEvent
      );
    } else if (!!domComponentOrNode.tagName) {
      // Will allow on actual dom nodes.
      ReactTestUtils.simulateNativeEventOnNode(
        eventType,
        domComponentOrNode,
        fakeNativeEvent
      );
    }
  };
}

var eventType;
for (eventType in topLevelTypes) {
  // Event type is stored as 'topClick' - we transform that to 'click'
  var convenienceName = eventType.indexOf('top') === 0 ?
    eventType.charAt(3).toLowerCase() + eventType.substr(4) : eventType;
  /**
   * @param {!Element || ReactDOMComponent} domComponentOrNode
   * @param {?Event} nativeEventData Fake native event to use in SyntheticEvent.
   */
  ReactTestUtils.SimulateNative[convenienceName] =
    makeNativeSimulator(eventType);
}

module.exports = ReactTestUtils;

},{"./EventConstants":16,"./EventPluginHub":18,"./EventPropagators":21,"./React":29,"./ReactBrowserEventEmitter":31,"./ReactDOM":41,"./ReactDescriptor":56,"./ReactMount":67,"./ReactTextComponent":83,"./ReactUpdates":87,"./SyntheticEvent":96,"./copyProperties":110,"./mergeInto":146}],83:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactTextComponent
 * @typechecks static-only
 */



var DOMPropertyOperations = _dereq_("./DOMPropertyOperations");
var ReactBrowserComponentMixin = _dereq_("./ReactBrowserComponentMixin");
var ReactComponent = _dereq_("./ReactComponent");
var ReactDescriptor = _dereq_("./ReactDescriptor");

var escapeTextForBrowser = _dereq_("./escapeTextForBrowser");
var mixInto = _dereq_("./mixInto");

/**
 * Text nodes violate a couple assumptions that React makes about components:
 *
 *  - When mounting text into the DOM, adjacent text nodes are merged.
 *  - Text nodes cannot be assigned a React root ID.
 *
 * This component is used to wrap strings in elements so that they can undergo
 * the same reconciliation that is applied to elements.
 *
 * TODO: Investigate representing React components in the DOM with text nodes.
 *
 * @class ReactTextComponent
 * @extends ReactComponent
 * @internal
 */
var ReactTextComponent = function(descriptor) {
  this.construct(descriptor);
};

mixInto(ReactTextComponent, ReactComponent.Mixin);
mixInto(ReactTextComponent, ReactBrowserComponentMixin);
mixInto(ReactTextComponent, {

  /**
   * Creates the markup for this text node. This node is not intended to have
   * any features besides containing text content.
   *
   * @param {string} rootID DOM ID of the root node.
   * @param {ReactReconcileTransaction|ReactServerRenderingTransaction} transaction
   * @param {number} mountDepth number of components in the owner hierarchy
   * @return {string} Markup for this text node.
   * @internal
   */
  mountComponent: function(rootID, transaction, mountDepth) {
    ReactComponent.Mixin.mountComponent.call(
      this,
      rootID,
      transaction,
      mountDepth
    );

    var escapedText = escapeTextForBrowser(this.props);

    if (transaction.renderToStaticMarkup) {
      // Normally we'd wrap this in a `span` for the reasons stated above, but
      // since this is a situation where React won't take over (static pages),
      // we can simply return the text as it is.
      return escapedText;
    }

    return (
      '<span ' + DOMPropertyOperations.createMarkupForID(rootID) + '>' +
        escapedText +
      '</span>'
    );
  },

  /**
   * Updates this component by updating the text content.
   *
   * @param {object} nextComponent Contains the next text content.
   * @param {ReactReconcileTransaction} transaction
   * @internal
   */
  receiveComponent: function(nextComponent, transaction) {
    var nextProps = nextComponent.props;
    if (nextProps !== this.props) {
      this.props = nextProps;
      ReactComponent.BackendIDOperations.updateTextContentByID(
        this._rootNodeID,
        nextProps
      );
    }
  }

});

module.exports = ReactDescriptor.createFactory(ReactTextComponent);

},{"./DOMPropertyOperations":12,"./ReactBrowserComponentMixin":30,"./ReactComponent":35,"./ReactDescriptor":56,"./escapeTextForBrowser":118,"./mixInto":147}],84:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @typechecks static-only
 * @providesModule ReactTransitionChildMapping
 */



var ReactChildren = _dereq_("./ReactChildren");

var ReactTransitionChildMapping = {
  /**
   * Given `this.props.children`, return an object mapping key to child. Just
   * simple syntactic sugar around ReactChildren.map().
   *
   * @param {*} children `this.props.children`
   * @return {object} Mapping of key to child
   */
  getChildMapping: function(children) {
    return ReactChildren.map(children, function(child) {
      return child;
    });
  },

  /**
   * When you're adding or removing children some may be added or removed in the
   * same render pass. We want ot show *both* since we want to simultaneously
   * animate elements in and out. This function takes a previous set of keys
   * and a new set of keys and merges them with its best guess of the correct
   * ordering. In the future we may expose some of the utilities in
   * ReactMultiChild to make this easy, but for now React itself does not
   * directly have this concept of the union of prevChildren and nextChildren
   * so we implement it here.
   *
   * @param {object} prev prev children as returned from
   * `ReactTransitionChildMapping.getChildMapping()`.
   * @param {object} next next children as returned from
   * `ReactTransitionChildMapping.getChildMapping()`.
   * @return {object} a key set that contains all keys in `prev` and all keys
   * in `next` in a reasonable order.
   */
  mergeChildMappings: function(prev, next) {
    prev = prev || {};
    next = next || {};

    function getValueForKey(key) {
      if (next.hasOwnProperty(key)) {
        return next[key];
      } else {
        return prev[key];
      }
    }

    // For each key of `next`, the list of keys to insert before that key in
    // the combined list
    var nextKeysPending = {};

    var pendingKeys = [];
    for (var prevKey in prev) {
      if (next.hasOwnProperty(prevKey)) {
        if (pendingKeys.length) {
          nextKeysPending[prevKey] = pendingKeys;
          pendingKeys = [];
        }
      } else {
        pendingKeys.push(prevKey);
      }
    }

    var i;
    var childMapping = {};
    for (var nextKey in next) {
      if (nextKeysPending.hasOwnProperty(nextKey)) {
        for (i = 0; i < nextKeysPending[nextKey].length; i++) {
          var pendingNextKey = nextKeysPending[nextKey][i];
          childMapping[nextKeysPending[nextKey][i]] = getValueForKey(
            pendingNextKey
          );
        }
      }
      childMapping[nextKey] = getValueForKey(nextKey);
    }

    // Finally, add the keys which didn't appear before any key in `next`
    for (i = 0; i < pendingKeys.length; i++) {
      childMapping[pendingKeys[i]] = getValueForKey(pendingKeys[i]);
    }

    return childMapping;
  }
};

module.exports = ReactTransitionChildMapping;

},{"./ReactChildren":34}],85:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactTransitionEvents
 */



var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

/**
 * EVENT_NAME_MAP is used to determine which event fired when a
 * transition/animation ends, based on the style property used to
 * define that event.
 */
var EVENT_NAME_MAP = {
  transitionend: {
    'transition': 'transitionend',
    'WebkitTransition': 'webkitTransitionEnd',
    'MozTransition': 'mozTransitionEnd',
    'OTransition': 'oTransitionEnd',
    'msTransition': 'MSTransitionEnd'
  },

  animationend: {
    'animation': 'animationend',
    'WebkitAnimation': 'webkitAnimationEnd',
    'MozAnimation': 'mozAnimationEnd',
    'OAnimation': 'oAnimationEnd',
    'msAnimation': 'MSAnimationEnd'
  }
};

var endEvents = [];

function detectEvents() {
  var testEl = document.createElement('div');
  var style = testEl.style;

  // On some platforms, in particular some releases of Android 4.x,
  // the un-prefixed "animation" and "transition" properties are defined on the
  // style object but the events that fire will still be prefixed, so we need
  // to check if the un-prefixed events are useable, and if not remove them
  // from the map
  if (!('AnimationEvent' in window)) {
    delete EVENT_NAME_MAP.animationend.animation;
  }

  if (!('TransitionEvent' in window)) {
    delete EVENT_NAME_MAP.transitionend.transition;
  }

  for (var baseEventName in EVENT_NAME_MAP) {
    var baseEvents = EVENT_NAME_MAP[baseEventName];
    for (var styleName in baseEvents) {
      if (styleName in style) {
        endEvents.push(baseEvents[styleName]);
        break;
      }
    }
  }
}

if (ExecutionEnvironment.canUseDOM) {
  detectEvents();
}

// We use the raw {add|remove}EventListener() call because EventListener
// does not know how to remove event listeners and we really should
// clean up. Also, these events are not triggered in older browsers
// so we should be A-OK here.

function addEventListener(node, eventName, eventListener) {
  node.addEventListener(eventName, eventListener, false);
}

function removeEventListener(node, eventName, eventListener) {
  node.removeEventListener(eventName, eventListener, false);
}

var ReactTransitionEvents = {
  addEndEventListener: function(node, eventListener) {
    if (endEvents.length === 0) {
      // If CSS transitions are not supported, trigger an "end animation"
      // event immediately.
      window.setTimeout(eventListener, 0);
      return;
    }
    endEvents.forEach(function(endEvent) {
      addEventListener(node, endEvent, eventListener);
    });
  },

  removeEndEventListener: function(node, eventListener) {
    if (endEvents.length === 0) {
      return;
    }
    endEvents.forEach(function(endEvent) {
      removeEventListener(node, endEvent, eventListener);
    });
  }
};

module.exports = ReactTransitionEvents;

},{"./ExecutionEnvironment":22}],86:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactTransitionGroup
 */



var React = _dereq_("./React");
var ReactTransitionChildMapping = _dereq_("./ReactTransitionChildMapping");

var cloneWithProps = _dereq_("./cloneWithProps");
var emptyFunction = _dereq_("./emptyFunction");
var merge = _dereq_("./merge");

var ReactTransitionGroup = React.createClass({
  displayName: 'ReactTransitionGroup',

  propTypes: {
    component: React.PropTypes.func,
    childFactory: React.PropTypes.func
  },

  getDefaultProps: function() {
    return {
      component: React.DOM.span,
      childFactory: emptyFunction.thatReturnsArgument
    };
  },

  getInitialState: function() {
    return {
      children: ReactTransitionChildMapping.getChildMapping(this.props.children)
    };
  },

  componentWillReceiveProps: function(nextProps) {
    var nextChildMapping = ReactTransitionChildMapping.getChildMapping(
      nextProps.children
    );
    var prevChildMapping = this.state.children;

    this.setState({
      children: ReactTransitionChildMapping.mergeChildMappings(
        prevChildMapping,
        nextChildMapping
      )
    });

    var key;

    for (key in nextChildMapping) {
      var hasPrev = prevChildMapping && prevChildMapping.hasOwnProperty(key);
      if (nextChildMapping[key] && !hasPrev &&
          !this.currentlyTransitioningKeys[key]) {
        this.keysToEnter.push(key);
      }
    }

    for (key in prevChildMapping) {
      var hasNext = nextChildMapping && nextChildMapping.hasOwnProperty(key);
      if (prevChildMapping[key] && !hasNext &&
          !this.currentlyTransitioningKeys[key]) {
        this.keysToLeave.push(key);
      }
    }

    // If we want to someday check for reordering, we could do it here.
  },

  componentWillMount: function() {
    this.currentlyTransitioningKeys = {};
    this.keysToEnter = [];
    this.keysToLeave = [];
  },

  componentDidUpdate: function() {
    var keysToEnter = this.keysToEnter;
    this.keysToEnter = [];
    keysToEnter.forEach(this.performEnter);

    var keysToLeave = this.keysToLeave;
    this.keysToLeave = [];
    keysToLeave.forEach(this.performLeave);
  },

  performEnter: function(key) {
    this.currentlyTransitioningKeys[key] = true;

    var component = this.refs[key];

    if (component.componentWillEnter) {
      component.componentWillEnter(
        this._handleDoneEntering.bind(this, key)
      );
    } else {
      this._handleDoneEntering(key);
    }
  },

  _handleDoneEntering: function(key) {
    var component = this.refs[key];
    if (component.componentDidEnter) {
      component.componentDidEnter();
    }

    delete this.currentlyTransitioningKeys[key];

    var currentChildMapping = ReactTransitionChildMapping.getChildMapping(
      this.props.children
    );

    if (!currentChildMapping || !currentChildMapping.hasOwnProperty(key)) {
      // This was removed before it had fully entered. Remove it.
      this.performLeave(key);
    }
  },

  performLeave: function(key) {
    this.currentlyTransitioningKeys[key] = true;

    var component = this.refs[key];
    if (component.componentWillLeave) {
      component.componentWillLeave(this._handleDoneLeaving.bind(this, key));
    } else {
      // Note that this is somewhat dangerous b/c it calls setState()
      // again, effectively mutating the component before all the work
      // is done.
      this._handleDoneLeaving(key);
    }
  },

  _handleDoneLeaving: function(key) {
    var component = this.refs[key];

    if (component.componentDidLeave) {
      component.componentDidLeave();
    }

    delete this.currentlyTransitioningKeys[key];

    var currentChildMapping = ReactTransitionChildMapping.getChildMapping(
      this.props.children
    );

    if (currentChildMapping && currentChildMapping.hasOwnProperty(key)) {
      // This entered again before it fully left. Add it again.
      this.performEnter(key);
    } else {
      var newChildren = merge(this.state.children);
      delete newChildren[key];
      this.setState({children: newChildren});
    }
  },

  render: function() {
    // TODO: we could get rid of the need for the wrapper node
    // by cloning a single child
    var childrenToRender = {};
    for (var key in this.state.children) {
      var child = this.state.children[key];
      if (child) {
        // You may need to apply reactive updates to a child as it is leaving.
        // The normal React way to do it won't work since the child will have
        // already been removed. In case you need this behavior you can provide
        // a childFactory function to wrap every child, even the ones that are
        // leaving.
        childrenToRender[key] = cloneWithProps(
          this.props.childFactory(child),
          {ref: key}
        );
      }
    }
    return this.transferPropsTo(this.props.component(null, childrenToRender));
  }
});

module.exports = ReactTransitionGroup;

},{"./React":29,"./ReactTransitionChildMapping":84,"./cloneWithProps":108,"./emptyFunction":116,"./merge":144}],87:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactUpdates
 */



var CallbackQueue = _dereq_("./CallbackQueue");
var PooledClass = _dereq_("./PooledClass");
var ReactCurrentOwner = _dereq_("./ReactCurrentOwner");
var ReactPerf = _dereq_("./ReactPerf");
var Transaction = _dereq_("./Transaction");

var invariant = _dereq_("./invariant");
var mixInto = _dereq_("./mixInto");
var warning = _dereq_("./warning");

var dirtyComponents = [];

var batchingStrategy = null;

function ensureInjected() {
  ("production" !== "development" ? invariant(
    ReactUpdates.ReactReconcileTransaction && batchingStrategy,
    'ReactUpdates: must inject a reconcile transaction class and batching ' +
    'strategy'
  ) : invariant(ReactUpdates.ReactReconcileTransaction && batchingStrategy));
}

var NESTED_UPDATES = {
  initialize: function() {
    this.dirtyComponentsLength = dirtyComponents.length;
  },
  close: function() {
    if (this.dirtyComponentsLength !== dirtyComponents.length) {
      // Additional updates were enqueued by componentDidUpdate handlers or
      // similar; before our own UPDATE_QUEUEING wrapper closes, we want to run
      // these new updates so that if A's componentDidUpdate calls setState on
      // B, B will update before the callback A's updater provided when calling
      // setState.
      dirtyComponents.splice(0, this.dirtyComponentsLength);
      flushBatchedUpdates();
    } else {
      dirtyComponents.length = 0;
    }
  }
};

var UPDATE_QUEUEING = {
  initialize: function() {
    this.callbackQueue.reset();
  },
  close: function() {
    this.callbackQueue.notifyAll();
  }
};

var TRANSACTION_WRAPPERS = [NESTED_UPDATES, UPDATE_QUEUEING];

function ReactUpdatesFlushTransaction() {
  this.reinitializeTransaction();
  this.dirtyComponentsLength = null;
  this.callbackQueue = CallbackQueue.getPooled(null);
  this.reconcileTransaction =
    ReactUpdates.ReactReconcileTransaction.getPooled();
}

mixInto(ReactUpdatesFlushTransaction, Transaction.Mixin);
mixInto(ReactUpdatesFlushTransaction, {
  getTransactionWrappers: function() {
    return TRANSACTION_WRAPPERS;
  },

  destructor: function() {
    this.dirtyComponentsLength = null;
    CallbackQueue.release(this.callbackQueue);
    this.callbackQueue = null;
    ReactUpdates.ReactReconcileTransaction.release(this.reconcileTransaction);
    this.reconcileTransaction = null;
  },

  perform: function(method, scope, a) {
    // Essentially calls `this.reconcileTransaction.perform(method, scope, a)`
    // with this transaction's wrappers around it.
    return Transaction.Mixin.perform.call(
      this,
      this.reconcileTransaction.perform,
      this.reconcileTransaction,
      method,
      scope,
      a
    );
  }
});

PooledClass.addPoolingTo(ReactUpdatesFlushTransaction);

function batchedUpdates(callback, a, b) {
  ensureInjected();
  batchingStrategy.batchedUpdates(callback, a, b);
}

/**
 * Array comparator for ReactComponents by owner depth
 *
 * @param {ReactComponent} c1 first component you're comparing
 * @param {ReactComponent} c2 second component you're comparing
 * @return {number} Return value usable by Array.prototype.sort().
 */
function mountDepthComparator(c1, c2) {
  return c1._mountDepth - c2._mountDepth;
}

function runBatchedUpdates(transaction) {
  var len = transaction.dirtyComponentsLength;
  ("production" !== "development" ? invariant(
    len === dirtyComponents.length,
    'Expected flush transaction\'s stored dirty-components length (%s) to ' +
    'match dirty-components array length (%s).',
    len,
    dirtyComponents.length
  ) : invariant(len === dirtyComponents.length));

  // Since reconciling a component higher in the owner hierarchy usually (not
  // always -- see shouldComponentUpdate()) will reconcile children, reconcile
  // them before their children by sorting the array.
  dirtyComponents.sort(mountDepthComparator);

  for (var i = 0; i < len; i++) {
    // If a component is unmounted before pending changes apply, ignore them
    // TODO: Queue unmounts in the same list to avoid this happening at all
    var component = dirtyComponents[i];
    if (component.isMounted()) {
      // If performUpdateIfNecessary happens to enqueue any new updates, we
      // shouldn't execute the callbacks until the next render happens, so
      // stash the callbacks first
      var callbacks = component._pendingCallbacks;
      component._pendingCallbacks = null;
      component.performUpdateIfNecessary(transaction.reconcileTransaction);

      if (callbacks) {
        for (var j = 0; j < callbacks.length; j++) {
          transaction.callbackQueue.enqueue(
            callbacks[j],
            component
          );
        }
      }
    }
  }
}

var flushBatchedUpdates = ReactPerf.measure(
  'ReactUpdates',
  'flushBatchedUpdates',
  function() {
    // ReactUpdatesFlushTransaction's wrappers will clear the dirtyComponents
    // array and perform any updates enqueued by mount-ready handlers (i.e.,
    // componentDidUpdate) but we need to check here too in order to catch
    // updates enqueued by setState callbacks.
    while (dirtyComponents.length) {
      var transaction = ReactUpdatesFlushTransaction.getPooled();
      transaction.perform(runBatchedUpdates, null, transaction);
      ReactUpdatesFlushTransaction.release(transaction);
    }
  }
);

/**
 * Mark a component as needing a rerender, adding an optional callback to a
 * list of functions which will be executed once the rerender occurs.
 */
function enqueueUpdate(component, callback) {
  ("production" !== "development" ? invariant(
    !callback || typeof callback === "function",
    'enqueueUpdate(...): You called `setProps`, `replaceProps`, ' +
    '`setState`, `replaceState`, or `forceUpdate` with a callback that ' +
    'isn\'t callable.'
  ) : invariant(!callback || typeof callback === "function"));
  ensureInjected();

  // Various parts of our code (such as ReactCompositeComponent's
  // _renderValidatedComponent) assume that calls to render aren't nested;
  // verify that that's the case. (This is called by each top-level update
  // function, like setProps, setState, forceUpdate, etc.; creation and
  // destruction of top-level components is guarded in ReactMount.)
  ("production" !== "development" ? warning(
    ReactCurrentOwner.current == null,
    'enqueueUpdate(): Render methods should be a pure function of props ' +
    'and state; triggering nested component updates from render is not ' +
    'allowed. If necessary, trigger nested updates in ' +
    'componentDidUpdate.'
  ) : null);

  if (!batchingStrategy.isBatchingUpdates) {
    batchingStrategy.batchedUpdates(enqueueUpdate, component, callback);
    return;
  }

  dirtyComponents.push(component);

  if (callback) {
    if (component._pendingCallbacks) {
      component._pendingCallbacks.push(callback);
    } else {
      component._pendingCallbacks = [callback];
    }
  }
}

var ReactUpdatesInjection = {
  injectReconcileTransaction: function(ReconcileTransaction) {
    ("production" !== "development" ? invariant(
      ReconcileTransaction,
      'ReactUpdates: must provide a reconcile transaction class'
    ) : invariant(ReconcileTransaction));
    ReactUpdates.ReactReconcileTransaction = ReconcileTransaction;
  },

  injectBatchingStrategy: function(_batchingStrategy) {
    ("production" !== "development" ? invariant(
      _batchingStrategy,
      'ReactUpdates: must provide a batching strategy'
    ) : invariant(_batchingStrategy));
    ("production" !== "development" ? invariant(
      typeof _batchingStrategy.batchedUpdates === 'function',
      'ReactUpdates: must provide a batchedUpdates() function'
    ) : invariant(typeof _batchingStrategy.batchedUpdates === 'function'));
    ("production" !== "development" ? invariant(
      typeof _batchingStrategy.isBatchingUpdates === 'boolean',
      'ReactUpdates: must provide an isBatchingUpdates boolean attribute'
    ) : invariant(typeof _batchingStrategy.isBatchingUpdates === 'boolean'));
    batchingStrategy = _batchingStrategy;
  }
};

var ReactUpdates = {
  /**
   * React references `ReactReconcileTransaction` using this property in order
   * to allow dependency injection.
   *
   * @internal
   */
  ReactReconcileTransaction: null,

  batchedUpdates: batchedUpdates,
  enqueueUpdate: enqueueUpdate,
  flushBatchedUpdates: flushBatchedUpdates,
  injection: ReactUpdatesInjection
};

module.exports = ReactUpdates;

},{"./CallbackQueue":6,"./PooledClass":28,"./ReactCurrentOwner":40,"./ReactPerf":71,"./Transaction":104,"./invariant":134,"./mixInto":147,"./warning":158}],88:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ReactWithAddons
 */

/**
 * This module exists purely in the open source project, and is meant as a way
 * to create a separate standalone build of React. This build has "addons", or
 * functionality we've built and think might be useful but doesn't have a good
 * place to live inside React core.
 */



var LinkedStateMixin = _dereq_("./LinkedStateMixin");
var React = _dereq_("./React");
var ReactComponentWithPureRenderMixin =
  _dereq_("./ReactComponentWithPureRenderMixin");
var ReactCSSTransitionGroup = _dereq_("./ReactCSSTransitionGroup");
var ReactTransitionGroup = _dereq_("./ReactTransitionGroup");

var cx = _dereq_("./cx");
var cloneWithProps = _dereq_("./cloneWithProps");
var update = _dereq_("./update");

React.addons = {
  CSSTransitionGroup: ReactCSSTransitionGroup,
  LinkedStateMixin: LinkedStateMixin,
  PureRenderMixin: ReactComponentWithPureRenderMixin,
  TransitionGroup: ReactTransitionGroup,

  classSet: cx,
  cloneWithProps: cloneWithProps,
  update: update
};

if ("production" !== "development") {
  React.addons.Perf = _dereq_("./ReactDefaultPerf");
  React.addons.TestUtils = _dereq_("./ReactTestUtils");
}

module.exports = React;


},{"./LinkedStateMixin":24,"./React":29,"./ReactCSSTransitionGroup":32,"./ReactComponentWithPureRenderMixin":37,"./ReactDefaultPerf":54,"./ReactTestUtils":82,"./ReactTransitionGroup":86,"./cloneWithProps":108,"./cx":114,"./update":157}],89:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SVGDOMPropertyConfig
 */

/*jslint bitwise: true*/



var DOMProperty = _dereq_("./DOMProperty");

var MUST_USE_ATTRIBUTE = DOMProperty.injection.MUST_USE_ATTRIBUTE;

var SVGDOMPropertyConfig = {
  Properties: {
    cx: MUST_USE_ATTRIBUTE,
    cy: MUST_USE_ATTRIBUTE,
    d: MUST_USE_ATTRIBUTE,
    dx: MUST_USE_ATTRIBUTE,
    dy: MUST_USE_ATTRIBUTE,
    fill: MUST_USE_ATTRIBUTE,
    fillOpacity: MUST_USE_ATTRIBUTE,
    fontFamily: MUST_USE_ATTRIBUTE,
    fontSize: MUST_USE_ATTRIBUTE,
    fx: MUST_USE_ATTRIBUTE,
    fy: MUST_USE_ATTRIBUTE,
    gradientTransform: MUST_USE_ATTRIBUTE,
    gradientUnits: MUST_USE_ATTRIBUTE,
    markerEnd: MUST_USE_ATTRIBUTE,
    markerMid: MUST_USE_ATTRIBUTE,
    markerStart: MUST_USE_ATTRIBUTE,
    offset: MUST_USE_ATTRIBUTE,
    opacity: MUST_USE_ATTRIBUTE,
    patternContentUnits: MUST_USE_ATTRIBUTE,
    patternUnits: MUST_USE_ATTRIBUTE,
    points: MUST_USE_ATTRIBUTE,
    preserveAspectRatio: MUST_USE_ATTRIBUTE,
    r: MUST_USE_ATTRIBUTE,
    rx: MUST_USE_ATTRIBUTE,
    ry: MUST_USE_ATTRIBUTE,
    spreadMethod: MUST_USE_ATTRIBUTE,
    stopColor: MUST_USE_ATTRIBUTE,
    stopOpacity: MUST_USE_ATTRIBUTE,
    stroke: MUST_USE_ATTRIBUTE,
    strokeDasharray: MUST_USE_ATTRIBUTE,
    strokeLinecap: MUST_USE_ATTRIBUTE,
    strokeOpacity: MUST_USE_ATTRIBUTE,
    strokeWidth: MUST_USE_ATTRIBUTE,
    textAnchor: MUST_USE_ATTRIBUTE,
    transform: MUST_USE_ATTRIBUTE,
    version: MUST_USE_ATTRIBUTE,
    viewBox: MUST_USE_ATTRIBUTE,
    x1: MUST_USE_ATTRIBUTE,
    x2: MUST_USE_ATTRIBUTE,
    x: MUST_USE_ATTRIBUTE,
    y1: MUST_USE_ATTRIBUTE,
    y2: MUST_USE_ATTRIBUTE,
    y: MUST_USE_ATTRIBUTE
  },
  DOMAttributeNames: {
    fillOpacity: 'fill-opacity',
    fontFamily: 'font-family',
    fontSize: 'font-size',
    gradientTransform: 'gradientTransform',
    gradientUnits: 'gradientUnits',
    markerEnd: 'marker-end',
    markerMid: 'marker-mid',
    markerStart: 'marker-start',
    patternContentUnits: 'patternContentUnits',
    patternUnits: 'patternUnits',
    preserveAspectRatio: 'preserveAspectRatio',
    spreadMethod: 'spreadMethod',
    stopColor: 'stop-color',
    stopOpacity: 'stop-opacity',
    strokeDasharray: 'stroke-dasharray',
    strokeLinecap: 'stroke-linecap',
    strokeOpacity: 'stroke-opacity',
    strokeWidth: 'stroke-width',
    textAnchor: 'text-anchor',
    viewBox: 'viewBox'
  }
};

module.exports = SVGDOMPropertyConfig;

},{"./DOMProperty":11}],90:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SelectEventPlugin
 */



var EventConstants = _dereq_("./EventConstants");
var EventPropagators = _dereq_("./EventPropagators");
var ReactInputSelection = _dereq_("./ReactInputSelection");
var SyntheticEvent = _dereq_("./SyntheticEvent");

var getActiveElement = _dereq_("./getActiveElement");
var isTextInputElement = _dereq_("./isTextInputElement");
var keyOf = _dereq_("./keyOf");
var shallowEqual = _dereq_("./shallowEqual");

var topLevelTypes = EventConstants.topLevelTypes;

var eventTypes = {
  select: {
    phasedRegistrationNames: {
      bubbled: keyOf({onSelect: null}),
      captured: keyOf({onSelectCapture: null})
    },
    dependencies: [
      topLevelTypes.topBlur,
      topLevelTypes.topContextMenu,
      topLevelTypes.topFocus,
      topLevelTypes.topKeyDown,
      topLevelTypes.topMouseDown,
      topLevelTypes.topMouseUp,
      topLevelTypes.topSelectionChange
    ]
  }
};

var activeElement = null;
var activeElementID = null;
var lastSelection = null;
var mouseDown = false;

/**
 * Get an object which is a unique representation of the current selection.
 *
 * The return value will not be consistent across nodes or browsers, but
 * two identical selections on the same node will return identical objects.
 *
 * @param {DOMElement} node
 * @param {object}
 */
function getSelection(node) {
  if ('selectionStart' in node &&
      ReactInputSelection.hasSelectionCapabilities(node)) {
    return {
      start: node.selectionStart,
      end: node.selectionEnd
    };
  } else if (document.selection) {
    var range = document.selection.createRange();
    return {
      parentElement: range.parentElement(),
      text: range.text,
      top: range.boundingTop,
      left: range.boundingLeft
    };
  } else {
    var selection = window.getSelection();
    return {
      anchorNode: selection.anchorNode,
      anchorOffset: selection.anchorOffset,
      focusNode: selection.focusNode,
      focusOffset: selection.focusOffset
    };
  }
}

/**
 * Poll selection to see whether it's changed.
 *
 * @param {object} nativeEvent
 * @return {?SyntheticEvent}
 */
function constructSelectEvent(nativeEvent) {
  // Ensure we have the right element, and that the user is not dragging a
  // selection (this matches native `select` event behavior). In HTML5, select
  // fires only on input and textarea thus if there's no focused element we
  // won't dispatch.
  if (mouseDown ||
      activeElement == null ||
      activeElement != getActiveElement()) {
    return;
  }

  // Only fire when selection has actually changed.
  var currentSelection = getSelection(activeElement);
  if (!lastSelection || !shallowEqual(lastSelection, currentSelection)) {
    lastSelection = currentSelection;

    var syntheticEvent = SyntheticEvent.getPooled(
      eventTypes.select,
      activeElementID,
      nativeEvent
    );

    syntheticEvent.type = 'select';
    syntheticEvent.target = activeElement;

    EventPropagators.accumulateTwoPhaseDispatches(syntheticEvent);

    return syntheticEvent;
  }
}

/**
 * This plugin creates an `onSelect` event that normalizes select events
 * across form elements.
 *
 * Supported elements are:
 * - input (see `isTextInputElement`)
 * - textarea
 * - contentEditable
 *
 * This differs from native browser implementations in the following ways:
 * - Fires on contentEditable fields as well as inputs.
 * - Fires for collapsed selection.
 * - Fires after user input.
 */
var SelectEventPlugin = {

  eventTypes: eventTypes,

  /**
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {DOMEventTarget} topLevelTarget The listening component root node.
   * @param {string} topLevelTargetID ID of `topLevelTarget`.
   * @param {object} nativeEvent Native browser event.
   * @return {*} An accumulation of synthetic events.
   * @see {EventPluginHub.extractEvents}
   */
  extractEvents: function(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent) {

    switch (topLevelType) {
      // Track the input node that has focus.
      case topLevelTypes.topFocus:
        if (isTextInputElement(topLevelTarget) ||
            topLevelTarget.contentEditable === 'true') {
          activeElement = topLevelTarget;
          activeElementID = topLevelTargetID;
          lastSelection = null;
        }
        break;
      case topLevelTypes.topBlur:
        activeElement = null;
        activeElementID = null;
        lastSelection = null;
        break;

      // Don't fire the event while the user is dragging. This matches the
      // semantics of the native select event.
      case topLevelTypes.topMouseDown:
        mouseDown = true;
        break;
      case topLevelTypes.topContextMenu:
      case topLevelTypes.topMouseUp:
        mouseDown = false;
        return constructSelectEvent(nativeEvent);

      // Chrome and IE fire non-standard event when selection is changed (and
      // sometimes when it hasn't).
      // Firefox doesn't support selectionchange, so check selection status
      // after each key entry. The selection changes after keydown and before
      // keyup, but we check on keydown as well in the case of holding down a
      // key, when multiple keydown events are fired but only one keyup is.
      case topLevelTypes.topSelectionChange:
      case topLevelTypes.topKeyDown:
      case topLevelTypes.topKeyUp:
        return constructSelectEvent(nativeEvent);
    }
  }
};

module.exports = SelectEventPlugin;

},{"./EventConstants":16,"./EventPropagators":21,"./ReactInputSelection":63,"./SyntheticEvent":96,"./getActiveElement":122,"./isTextInputElement":137,"./keyOf":141,"./shallowEqual":153}],91:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ServerReactRootIndex
 * @typechecks
 */



/**
 * Size of the reactRoot ID space. We generate random numbers for React root
 * IDs and if there's a collision the events and DOM update system will
 * get confused. In the future we need a way to generate GUIDs but for
 * now this will work on a smaller scale.
 */
var GLOBAL_MOUNT_POINT_MAX = Math.pow(2, 53);

var ServerReactRootIndex = {
  createReactRootIndex: function() {
    return Math.ceil(Math.random() * GLOBAL_MOUNT_POINT_MAX);
  }
};

module.exports = ServerReactRootIndex;

},{}],92:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SimpleEventPlugin
 */



var EventConstants = _dereq_("./EventConstants");
var EventPluginUtils = _dereq_("./EventPluginUtils");
var EventPropagators = _dereq_("./EventPropagators");
var SyntheticClipboardEvent = _dereq_("./SyntheticClipboardEvent");
var SyntheticEvent = _dereq_("./SyntheticEvent");
var SyntheticFocusEvent = _dereq_("./SyntheticFocusEvent");
var SyntheticKeyboardEvent = _dereq_("./SyntheticKeyboardEvent");
var SyntheticMouseEvent = _dereq_("./SyntheticMouseEvent");
var SyntheticDragEvent = _dereq_("./SyntheticDragEvent");
var SyntheticTouchEvent = _dereq_("./SyntheticTouchEvent");
var SyntheticUIEvent = _dereq_("./SyntheticUIEvent");
var SyntheticWheelEvent = _dereq_("./SyntheticWheelEvent");

var invariant = _dereq_("./invariant");
var keyOf = _dereq_("./keyOf");

var topLevelTypes = EventConstants.topLevelTypes;

var eventTypes = {
  blur: {
    phasedRegistrationNames: {
      bubbled: keyOf({onBlur: true}),
      captured: keyOf({onBlurCapture: true})
    }
  },
  click: {
    phasedRegistrationNames: {
      bubbled: keyOf({onClick: true}),
      captured: keyOf({onClickCapture: true})
    }
  },
  contextMenu: {
    phasedRegistrationNames: {
      bubbled: keyOf({onContextMenu: true}),
      captured: keyOf({onContextMenuCapture: true})
    }
  },
  copy: {
    phasedRegistrationNames: {
      bubbled: keyOf({onCopy: true}),
      captured: keyOf({onCopyCapture: true})
    }
  },
  cut: {
    phasedRegistrationNames: {
      bubbled: keyOf({onCut: true}),
      captured: keyOf({onCutCapture: true})
    }
  },
  doubleClick: {
    phasedRegistrationNames: {
      bubbled: keyOf({onDoubleClick: true}),
      captured: keyOf({onDoubleClickCapture: true})
    }
  },
  drag: {
    phasedRegistrationNames: {
      bubbled: keyOf({onDrag: true}),
      captured: keyOf({onDragCapture: true})
    }
  },
  dragEnd: {
    phasedRegistrationNames: {
      bubbled: keyOf({onDragEnd: true}),
      captured: keyOf({onDragEndCapture: true})
    }
  },
  dragEnter: {
    phasedRegistrationNames: {
      bubbled: keyOf({onDragEnter: true}),
      captured: keyOf({onDragEnterCapture: true})
    }
  },
  dragExit: {
    phasedRegistrationNames: {
      bubbled: keyOf({onDragExit: true}),
      captured: keyOf({onDragExitCapture: true})
    }
  },
  dragLeave: {
    phasedRegistrationNames: {
      bubbled: keyOf({onDragLeave: true}),
      captured: keyOf({onDragLeaveCapture: true})
    }
  },
  dragOver: {
    phasedRegistrationNames: {
      bubbled: keyOf({onDragOver: true}),
      captured: keyOf({onDragOverCapture: true})
    }
  },
  dragStart: {
    phasedRegistrationNames: {
      bubbled: keyOf({onDragStart: true}),
      captured: keyOf({onDragStartCapture: true})
    }
  },
  drop: {
    phasedRegistrationNames: {
      bubbled: keyOf({onDrop: true}),
      captured: keyOf({onDropCapture: true})
    }
  },
  focus: {
    phasedRegistrationNames: {
      bubbled: keyOf({onFocus: true}),
      captured: keyOf({onFocusCapture: true})
    }
  },
  input: {
    phasedRegistrationNames: {
      bubbled: keyOf({onInput: true}),
      captured: keyOf({onInputCapture: true})
    }
  },
  keyDown: {
    phasedRegistrationNames: {
      bubbled: keyOf({onKeyDown: true}),
      captured: keyOf({onKeyDownCapture: true})
    }
  },
  keyPress: {
    phasedRegistrationNames: {
      bubbled: keyOf({onKeyPress: true}),
      captured: keyOf({onKeyPressCapture: true})
    }
  },
  keyUp: {
    phasedRegistrationNames: {
      bubbled: keyOf({onKeyUp: true}),
      captured: keyOf({onKeyUpCapture: true})
    }
  },
  load: {
    phasedRegistrationNames: {
      bubbled: keyOf({onLoad: true}),
      captured: keyOf({onLoadCapture: true})
    }
  },
  error: {
    phasedRegistrationNames: {
      bubbled: keyOf({onError: true}),
      captured: keyOf({onErrorCapture: true})
    }
  },
  // Note: We do not allow listening to mouseOver events. Instead, use the
  // onMouseEnter/onMouseLeave created by `EnterLeaveEventPlugin`.
  mouseDown: {
    phasedRegistrationNames: {
      bubbled: keyOf({onMouseDown: true}),
      captured: keyOf({onMouseDownCapture: true})
    }
  },
  mouseMove: {
    phasedRegistrationNames: {
      bubbled: keyOf({onMouseMove: true}),
      captured: keyOf({onMouseMoveCapture: true})
    }
  },
  mouseOut: {
    phasedRegistrationNames: {
      bubbled: keyOf({onMouseOut: true}),
      captured: keyOf({onMouseOutCapture: true})
    }
  },
  mouseOver: {
    phasedRegistrationNames: {
      bubbled: keyOf({onMouseOver: true}),
      captured: keyOf({onMouseOverCapture: true})
    }
  },
  mouseUp: {
    phasedRegistrationNames: {
      bubbled: keyOf({onMouseUp: true}),
      captured: keyOf({onMouseUpCapture: true})
    }
  },
  paste: {
    phasedRegistrationNames: {
      bubbled: keyOf({onPaste: true}),
      captured: keyOf({onPasteCapture: true})
    }
  },
  reset: {
    phasedRegistrationNames: {
      bubbled: keyOf({onReset: true}),
      captured: keyOf({onResetCapture: true})
    }
  },
  scroll: {
    phasedRegistrationNames: {
      bubbled: keyOf({onScroll: true}),
      captured: keyOf({onScrollCapture: true})
    }
  },
  submit: {
    phasedRegistrationNames: {
      bubbled: keyOf({onSubmit: true}),
      captured: keyOf({onSubmitCapture: true})
    }
  },
  touchCancel: {
    phasedRegistrationNames: {
      bubbled: keyOf({onTouchCancel: true}),
      captured: keyOf({onTouchCancelCapture: true})
    }
  },
  touchEnd: {
    phasedRegistrationNames: {
      bubbled: keyOf({onTouchEnd: true}),
      captured: keyOf({onTouchEndCapture: true})
    }
  },
  touchMove: {
    phasedRegistrationNames: {
      bubbled: keyOf({onTouchMove: true}),
      captured: keyOf({onTouchMoveCapture: true})
    }
  },
  touchStart: {
    phasedRegistrationNames: {
      bubbled: keyOf({onTouchStart: true}),
      captured: keyOf({onTouchStartCapture: true})
    }
  },
  wheel: {
    phasedRegistrationNames: {
      bubbled: keyOf({onWheel: true}),
      captured: keyOf({onWheelCapture: true})
    }
  }
};

var topLevelEventsToDispatchConfig = {
  topBlur:        eventTypes.blur,
  topClick:       eventTypes.click,
  topContextMenu: eventTypes.contextMenu,
  topCopy:        eventTypes.copy,
  topCut:         eventTypes.cut,
  topDoubleClick: eventTypes.doubleClick,
  topDrag:        eventTypes.drag,
  topDragEnd:     eventTypes.dragEnd,
  topDragEnter:   eventTypes.dragEnter,
  topDragExit:    eventTypes.dragExit,
  topDragLeave:   eventTypes.dragLeave,
  topDragOver:    eventTypes.dragOver,
  topDragStart:   eventTypes.dragStart,
  topDrop:        eventTypes.drop,
  topError:       eventTypes.error,
  topFocus:       eventTypes.focus,
  topInput:       eventTypes.input,
  topKeyDown:     eventTypes.keyDown,
  topKeyPress:    eventTypes.keyPress,
  topKeyUp:       eventTypes.keyUp,
  topLoad:        eventTypes.load,
  topMouseDown:   eventTypes.mouseDown,
  topMouseMove:   eventTypes.mouseMove,
  topMouseOut:    eventTypes.mouseOut,
  topMouseOver:   eventTypes.mouseOver,
  topMouseUp:     eventTypes.mouseUp,
  topPaste:       eventTypes.paste,
  topReset:       eventTypes.reset,
  topScroll:      eventTypes.scroll,
  topSubmit:      eventTypes.submit,
  topTouchCancel: eventTypes.touchCancel,
  topTouchEnd:    eventTypes.touchEnd,
  topTouchMove:   eventTypes.touchMove,
  topTouchStart:  eventTypes.touchStart,
  topWheel:       eventTypes.wheel
};

for (var topLevelType in topLevelEventsToDispatchConfig) {
  topLevelEventsToDispatchConfig[topLevelType].dependencies = [topLevelType];
}

var SimpleEventPlugin = {

  eventTypes: eventTypes,

  /**
   * Same as the default implementation, except cancels the event when return
   * value is false.
   *
   * @param {object} Event to be dispatched.
   * @param {function} Application-level callback.
   * @param {string} domID DOM ID to pass to the callback.
   */
  executeDispatch: function(event, listener, domID) {
    var returnValue = EventPluginUtils.executeDispatch(event, listener, domID);
    if (returnValue === false) {
      event.stopPropagation();
      event.preventDefault();
    }
  },

  /**
   * @param {string} topLevelType Record from `EventConstants`.
   * @param {DOMEventTarget} topLevelTarget The listening component root node.
   * @param {string} topLevelTargetID ID of `topLevelTarget`.
   * @param {object} nativeEvent Native browser event.
   * @return {*} An accumulation of synthetic events.
   * @see {EventPluginHub.extractEvents}
   */
  extractEvents: function(
      topLevelType,
      topLevelTarget,
      topLevelTargetID,
      nativeEvent) {
    var dispatchConfig = topLevelEventsToDispatchConfig[topLevelType];
    if (!dispatchConfig) {
      return null;
    }
    var EventConstructor;
    switch (topLevelType) {
      case topLevelTypes.topInput:
      case topLevelTypes.topLoad:
      case topLevelTypes.topError:
      case topLevelTypes.topReset:
      case topLevelTypes.topSubmit:
        // HTML Events
        // @see http://www.w3.org/TR/html5/index.html#events-0
        EventConstructor = SyntheticEvent;
        break;
      case topLevelTypes.topKeyPress:
        // FireFox creates a keypress event for function keys too. This removes
        // the unwanted keypress events.
        if (nativeEvent.charCode === 0) {
          return null;
        }
        /* falls through */
      case topLevelTypes.topKeyDown:
      case topLevelTypes.topKeyUp:
        EventConstructor = SyntheticKeyboardEvent;
        break;
      case topLevelTypes.topBlur:
      case topLevelTypes.topFocus:
        EventConstructor = SyntheticFocusEvent;
        break;
      case topLevelTypes.topClick:
        // Firefox creates a click event on right mouse clicks. This removes the
        // unwanted click events.
        if (nativeEvent.button === 2) {
          return null;
        }
        /* falls through */
      case topLevelTypes.topContextMenu:
      case topLevelTypes.topDoubleClick:
      case topLevelTypes.topMouseDown:
      case topLevelTypes.topMouseMove:
      case topLevelTypes.topMouseOut:
      case topLevelTypes.topMouseOver:
      case topLevelTypes.topMouseUp:
        EventConstructor = SyntheticMouseEvent;
        break;
      case topLevelTypes.topDrag:
      case topLevelTypes.topDragEnd:
      case topLevelTypes.topDragEnter:
      case topLevelTypes.topDragExit:
      case topLevelTypes.topDragLeave:
      case topLevelTypes.topDragOver:
      case topLevelTypes.topDragStart:
      case topLevelTypes.topDrop:
        EventConstructor = SyntheticDragEvent;
        break;
      case topLevelTypes.topTouchCancel:
      case topLevelTypes.topTouchEnd:
      case topLevelTypes.topTouchMove:
      case topLevelTypes.topTouchStart:
        EventConstructor = SyntheticTouchEvent;
        break;
      case topLevelTypes.topScroll:
        EventConstructor = SyntheticUIEvent;
        break;
      case topLevelTypes.topWheel:
        EventConstructor = SyntheticWheelEvent;
        break;
      case topLevelTypes.topCopy:
      case topLevelTypes.topCut:
      case topLevelTypes.topPaste:
        EventConstructor = SyntheticClipboardEvent;
        break;
    }
    ("production" !== "development" ? invariant(
      EventConstructor,
      'SimpleEventPlugin: Unhandled event type, `%s`.',
      topLevelType
    ) : invariant(EventConstructor));
    var event = EventConstructor.getPooled(
      dispatchConfig,
      topLevelTargetID,
      nativeEvent
    );
    EventPropagators.accumulateTwoPhaseDispatches(event);
    return event;
  }

};

module.exports = SimpleEventPlugin;

},{"./EventConstants":16,"./EventPluginUtils":20,"./EventPropagators":21,"./SyntheticClipboardEvent":93,"./SyntheticDragEvent":95,"./SyntheticEvent":96,"./SyntheticFocusEvent":97,"./SyntheticKeyboardEvent":99,"./SyntheticMouseEvent":100,"./SyntheticTouchEvent":101,"./SyntheticUIEvent":102,"./SyntheticWheelEvent":103,"./invariant":134,"./keyOf":141}],93:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticClipboardEvent
 * @typechecks static-only
 */



var SyntheticEvent = _dereq_("./SyntheticEvent");

/**
 * @interface Event
 * @see http://www.w3.org/TR/clipboard-apis/
 */
var ClipboardEventInterface = {
  clipboardData: function(event) {
    return (
      'clipboardData' in event ?
        event.clipboardData :
        window.clipboardData
    );
  }
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticUIEvent}
 */
function SyntheticClipboardEvent(dispatchConfig, dispatchMarker, nativeEvent) {
  SyntheticEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticEvent.augmentClass(SyntheticClipboardEvent, ClipboardEventInterface);

module.exports = SyntheticClipboardEvent;


},{"./SyntheticEvent":96}],94:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticCompositionEvent
 * @typechecks static-only
 */



var SyntheticEvent = _dereq_("./SyntheticEvent");

/**
 * @interface Event
 * @see http://www.w3.org/TR/DOM-Level-3-Events/#events-compositionevents
 */
var CompositionEventInterface = {
  data: null
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticUIEvent}
 */
function SyntheticCompositionEvent(
  dispatchConfig,
  dispatchMarker,
  nativeEvent) {
  SyntheticEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticEvent.augmentClass(
  SyntheticCompositionEvent,
  CompositionEventInterface
);

module.exports = SyntheticCompositionEvent;


},{"./SyntheticEvent":96}],95:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticDragEvent
 * @typechecks static-only
 */



var SyntheticMouseEvent = _dereq_("./SyntheticMouseEvent");

/**
 * @interface DragEvent
 * @see http://www.w3.org/TR/DOM-Level-3-Events/
 */
var DragEventInterface = {
  dataTransfer: null
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticUIEvent}
 */
function SyntheticDragEvent(dispatchConfig, dispatchMarker, nativeEvent) {
  SyntheticMouseEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticMouseEvent.augmentClass(SyntheticDragEvent, DragEventInterface);

module.exports = SyntheticDragEvent;

},{"./SyntheticMouseEvent":100}],96:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticEvent
 * @typechecks static-only
 */



var PooledClass = _dereq_("./PooledClass");

var emptyFunction = _dereq_("./emptyFunction");
var getEventTarget = _dereq_("./getEventTarget");
var merge = _dereq_("./merge");
var mergeInto = _dereq_("./mergeInto");

/**
 * @interface Event
 * @see http://www.w3.org/TR/DOM-Level-3-Events/
 */
var EventInterface = {
  type: null,
  target: getEventTarget,
  // currentTarget is set when dispatching; no use in copying it here
  currentTarget: emptyFunction.thatReturnsNull,
  eventPhase: null,
  bubbles: null,
  cancelable: null,
  timeStamp: function(event) {
    return event.timeStamp || Date.now();
  },
  defaultPrevented: null,
  isTrusted: null
};

/**
 * Synthetic events are dispatched by event plugins, typically in response to a
 * top-level event delegation handler.
 *
 * These systems should generally use pooling to reduce the frequency of garbage
 * collection. The system should check `isPersistent` to determine whether the
 * event should be released into the pool after being dispatched. Users that
 * need a persisted event should invoke `persist`.
 *
 * Synthetic events (and subclasses) implement the DOM Level 3 Events API by
 * normalizing browser quirks. Subclasses do not necessarily have to implement a
 * DOM interface; custom application-specific events can also subclass this.
 *
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 */
function SyntheticEvent(dispatchConfig, dispatchMarker, nativeEvent) {
  this.dispatchConfig = dispatchConfig;
  this.dispatchMarker = dispatchMarker;
  this.nativeEvent = nativeEvent;

  var Interface = this.constructor.Interface;
  for (var propName in Interface) {
    if (!Interface.hasOwnProperty(propName)) {
      continue;
    }
    var normalize = Interface[propName];
    if (normalize) {
      this[propName] = normalize(nativeEvent);
    } else {
      this[propName] = nativeEvent[propName];
    }
  }

  var defaultPrevented = nativeEvent.defaultPrevented != null ?
    nativeEvent.defaultPrevented :
    nativeEvent.returnValue === false;
  if (defaultPrevented) {
    this.isDefaultPrevented = emptyFunction.thatReturnsTrue;
  } else {
    this.isDefaultPrevented = emptyFunction.thatReturnsFalse;
  }
  this.isPropagationStopped = emptyFunction.thatReturnsFalse;
}

mergeInto(SyntheticEvent.prototype, {

  preventDefault: function() {
    this.defaultPrevented = true;
    var event = this.nativeEvent;
    event.preventDefault ? event.preventDefault() : event.returnValue = false;
    this.isDefaultPrevented = emptyFunction.thatReturnsTrue;
  },

  stopPropagation: function() {
    var event = this.nativeEvent;
    event.stopPropagation ? event.stopPropagation() : event.cancelBubble = true;
    this.isPropagationStopped = emptyFunction.thatReturnsTrue;
  },

  /**
   * We release all dispatched `SyntheticEvent`s after each event loop, adding
   * them back into the pool. This allows a way to hold onto a reference that
   * won't be added back into the pool.
   */
  persist: function() {
    this.isPersistent = emptyFunction.thatReturnsTrue;
  },

  /**
   * Checks if this event should be released back into the pool.
   *
   * @return {boolean} True if this should not be released, false otherwise.
   */
  isPersistent: emptyFunction.thatReturnsFalse,

  /**
   * `PooledClass` looks for `destructor` on each instance it releases.
   */
  destructor: function() {
    var Interface = this.constructor.Interface;
    for (var propName in Interface) {
      this[propName] = null;
    }
    this.dispatchConfig = null;
    this.dispatchMarker = null;
    this.nativeEvent = null;
  }

});

SyntheticEvent.Interface = EventInterface;

/**
 * Helper to reduce boilerplate when creating subclasses.
 *
 * @param {function} Class
 * @param {?object} Interface
 */
SyntheticEvent.augmentClass = function(Class, Interface) {
  var Super = this;

  var prototype = Object.create(Super.prototype);
  mergeInto(prototype, Class.prototype);
  Class.prototype = prototype;
  Class.prototype.constructor = Class;

  Class.Interface = merge(Super.Interface, Interface);
  Class.augmentClass = Super.augmentClass;

  PooledClass.addPoolingTo(Class, PooledClass.threeArgumentPooler);
};

PooledClass.addPoolingTo(SyntheticEvent, PooledClass.threeArgumentPooler);

module.exports = SyntheticEvent;

},{"./PooledClass":28,"./emptyFunction":116,"./getEventTarget":125,"./merge":144,"./mergeInto":146}],97:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticFocusEvent
 * @typechecks static-only
 */



var SyntheticUIEvent = _dereq_("./SyntheticUIEvent");

/**
 * @interface FocusEvent
 * @see http://www.w3.org/TR/DOM-Level-3-Events/
 */
var FocusEventInterface = {
  relatedTarget: null
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticUIEvent}
 */
function SyntheticFocusEvent(dispatchConfig, dispatchMarker, nativeEvent) {
  SyntheticUIEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticUIEvent.augmentClass(SyntheticFocusEvent, FocusEventInterface);

module.exports = SyntheticFocusEvent;

},{"./SyntheticUIEvent":102}],98:[function(_dereq_,module,exports){
/**
 * Copyright 2013 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticInputEvent
 * @typechecks static-only
 */



var SyntheticEvent = _dereq_("./SyntheticEvent");

/**
 * @interface Event
 * @see http://www.w3.org/TR/2013/WD-DOM-Level-3-Events-20131105
 *      /#events-inputevents
 */
var InputEventInterface = {
  data: null
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticUIEvent}
 */
function SyntheticInputEvent(
  dispatchConfig,
  dispatchMarker,
  nativeEvent) {
  SyntheticEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticEvent.augmentClass(
  SyntheticInputEvent,
  InputEventInterface
);

module.exports = SyntheticInputEvent;


},{"./SyntheticEvent":96}],99:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticKeyboardEvent
 * @typechecks static-only
 */



var SyntheticUIEvent = _dereq_("./SyntheticUIEvent");

var getEventKey = _dereq_("./getEventKey");
var getEventModifierState = _dereq_("./getEventModifierState");

/**
 * @interface KeyboardEvent
 * @see http://www.w3.org/TR/DOM-Level-3-Events/
 */
var KeyboardEventInterface = {
  key: getEventKey,
  location: null,
  ctrlKey: null,
  shiftKey: null,
  altKey: null,
  metaKey: null,
  repeat: null,
  locale: null,
  getModifierState: getEventModifierState,
  // Legacy Interface
  charCode: function(event) {
    // `charCode` is the result of a KeyPress event and represents the value of
    // the actual printable character.

    // KeyPress is deprecated but its replacement is not yet final and not
    // implemented in any major browser.
    if (event.type === 'keypress') {
      // IE8 does not implement "charCode", but "keyCode" has the correct value.
      return 'charCode' in event ? event.charCode : event.keyCode;
    }
    return 0;
  },
  keyCode: function(event) {
    // `keyCode` is the result of a KeyDown/Up event and represents the value of
    // physical keyboard key.

    // The actual meaning of the value depends on the users' keyboard layout
    // which cannot be detected. Assuming that it is a US keyboard layout
    // provides a surprisingly accurate mapping for US and European users.
    // Due to this, it is left to the user to implement at this time.
    if (event.type === 'keydown' || event.type === 'keyup') {
      return event.keyCode;
    }
    return 0;
  },
  which: function(event) {
    // `which` is an alias for either `keyCode` or `charCode` depending on the
    // type of the event. There is no need to determine the type of the event
    // as `keyCode` and `charCode` are either aliased or default to zero.
    return event.keyCode || event.charCode;
  }
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticUIEvent}
 */
function SyntheticKeyboardEvent(dispatchConfig, dispatchMarker, nativeEvent) {
  SyntheticUIEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticUIEvent.augmentClass(SyntheticKeyboardEvent, KeyboardEventInterface);

module.exports = SyntheticKeyboardEvent;

},{"./SyntheticUIEvent":102,"./getEventKey":123,"./getEventModifierState":124}],100:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticMouseEvent
 * @typechecks static-only
 */



var SyntheticUIEvent = _dereq_("./SyntheticUIEvent");
var ViewportMetrics = _dereq_("./ViewportMetrics");

var getEventModifierState = _dereq_("./getEventModifierState");

/**
 * @interface MouseEvent
 * @see http://www.w3.org/TR/DOM-Level-3-Events/
 */
var MouseEventInterface = {
  screenX: null,
  screenY: null,
  clientX: null,
  clientY: null,
  ctrlKey: null,
  shiftKey: null,
  altKey: null,
  metaKey: null,
  getModifierState: getEventModifierState,
  button: function(event) {
    // Webkit, Firefox, IE9+
    // which:  1 2 3
    // button: 0 1 2 (standard)
    var button = event.button;
    if ('which' in event) {
      return button;
    }
    // IE<9
    // which:  undefined
    // button: 0 0 0
    // button: 1 4 2 (onmouseup)
    return button === 2 ? 2 : button === 4 ? 1 : 0;
  },
  buttons: null,
  relatedTarget: function(event) {
    return event.relatedTarget || (
      event.fromElement === event.srcElement ?
        event.toElement :
        event.fromElement
    );
  },
  // "Proprietary" Interface.
  pageX: function(event) {
    return 'pageX' in event ?
      event.pageX :
      event.clientX + ViewportMetrics.currentScrollLeft;
  },
  pageY: function(event) {
    return 'pageY' in event ?
      event.pageY :
      event.clientY + ViewportMetrics.currentScrollTop;
  }
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticUIEvent}
 */
function SyntheticMouseEvent(dispatchConfig, dispatchMarker, nativeEvent) {
  SyntheticUIEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticUIEvent.augmentClass(SyntheticMouseEvent, MouseEventInterface);

module.exports = SyntheticMouseEvent;

},{"./SyntheticUIEvent":102,"./ViewportMetrics":105,"./getEventModifierState":124}],101:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticTouchEvent
 * @typechecks static-only
 */



var SyntheticUIEvent = _dereq_("./SyntheticUIEvent");

var getEventModifierState = _dereq_("./getEventModifierState");

/**
 * @interface TouchEvent
 * @see http://www.w3.org/TR/touch-events/
 */
var TouchEventInterface = {
  touches: null,
  targetTouches: null,
  changedTouches: null,
  altKey: null,
  metaKey: null,
  ctrlKey: null,
  shiftKey: null,
  getModifierState: getEventModifierState
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticUIEvent}
 */
function SyntheticTouchEvent(dispatchConfig, dispatchMarker, nativeEvent) {
  SyntheticUIEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticUIEvent.augmentClass(SyntheticTouchEvent, TouchEventInterface);

module.exports = SyntheticTouchEvent;

},{"./SyntheticUIEvent":102,"./getEventModifierState":124}],102:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticUIEvent
 * @typechecks static-only
 */



var SyntheticEvent = _dereq_("./SyntheticEvent");

var getEventTarget = _dereq_("./getEventTarget");

/**
 * @interface UIEvent
 * @see http://www.w3.org/TR/DOM-Level-3-Events/
 */
var UIEventInterface = {
  view: function(event) {
    if (event.view) {
      return event.view;
    }

    var target = getEventTarget(event);
    if (target != null && target.window === target) {
      // target is a window object
      return target;
    }

    var doc = target.ownerDocument;
    // TODO: Figure out why `ownerDocument` is sometimes undefined in IE8.
    if (doc) {
      return doc.defaultView || doc.parentWindow;
    } else {
      return window;
    }
  },
  detail: function(event) {
    return event.detail || 0;
  }
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticEvent}
 */
function SyntheticUIEvent(dispatchConfig, dispatchMarker, nativeEvent) {
  SyntheticEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticEvent.augmentClass(SyntheticUIEvent, UIEventInterface);

module.exports = SyntheticUIEvent;

},{"./SyntheticEvent":96,"./getEventTarget":125}],103:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule SyntheticWheelEvent
 * @typechecks static-only
 */



var SyntheticMouseEvent = _dereq_("./SyntheticMouseEvent");

/**
 * @interface WheelEvent
 * @see http://www.w3.org/TR/DOM-Level-3-Events/
 */
var WheelEventInterface = {
  deltaX: function(event) {
    return (
      'deltaX' in event ? event.deltaX :
      // Fallback to `wheelDeltaX` for Webkit and normalize (right is positive).
      'wheelDeltaX' in event ? -event.wheelDeltaX : 0
    );
  },
  deltaY: function(event) {
    return (
      'deltaY' in event ? event.deltaY :
      // Fallback to `wheelDeltaY` for Webkit and normalize (down is positive).
      'wheelDeltaY' in event ? -event.wheelDeltaY :
      // Fallback to `wheelDelta` for IE<9 and normalize (down is positive).
      'wheelDelta' in event ? -event.wheelDelta : 0
    );
  },
  deltaZ: null,

  // Browsers without "deltaMode" is reporting in raw wheel delta where one
  // notch on the scroll is always +/- 120, roughly equivalent to pixels.
  // A good approximation of DOM_DELTA_LINE (1) is 5% of viewport size or
  // ~40 pixels, for DOM_DELTA_SCREEN (2) it is 87.5% of viewport size.
  deltaMode: null
};

/**
 * @param {object} dispatchConfig Configuration used to dispatch this event.
 * @param {string} dispatchMarker Marker identifying the event target.
 * @param {object} nativeEvent Native browser event.
 * @extends {SyntheticMouseEvent}
 */
function SyntheticWheelEvent(dispatchConfig, dispatchMarker, nativeEvent) {
  SyntheticMouseEvent.call(this, dispatchConfig, dispatchMarker, nativeEvent);
}

SyntheticMouseEvent.augmentClass(SyntheticWheelEvent, WheelEventInterface);

module.exports = SyntheticWheelEvent;

},{"./SyntheticMouseEvent":100}],104:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule Transaction
 */



var invariant = _dereq_("./invariant");

/**
 * `Transaction` creates a black box that is able to wrap any method such that
 * certain invariants are maintained before and after the method is invoked
 * (Even if an exception is thrown while invoking the wrapped method). Whoever
 * instantiates a transaction can provide enforcers of the invariants at
 * creation time. The `Transaction` class itself will supply one additional
 * automatic invariant for you - the invariant that any transaction instance
 * should not be run while it is already being run. You would typically create a
 * single instance of a `Transaction` for reuse multiple times, that potentially
 * is used to wrap several different methods. Wrappers are extremely simple -
 * they only require implementing two methods.
 *
 * <pre>
 *                       wrappers (injected at creation time)
 *                                      +        +
 *                                      |        |
 *                    +-----------------|--------|--------------+
 *                    |                 v        |              |
 *                    |      +---------------+   |              |
 *                    |   +--|    wrapper1   |---|----+         |
 *                    |   |  +---------------+   v    |         |
 *                    |   |          +-------------+  |         |
 *                    |   |     +----|   wrapper2  |--------+   |
 *                    |   |     |    +-------------+  |     |   |
 *                    |   |     |                     |     |   |
 *                    |   v     v                     v     v   | wrapper
 *                    | +---+ +---+   +---------+   +---+ +---+ | invariants
 * perform(anyMethod) | |   | |   |   |         |   |   | |   | | maintained
 * +----------------->|-|---|-|---|-->|anyMethod|---|---|-|---|-|-------->
 *                    | |   | |   |   |         |   |   | |   | |
 *                    | |   | |   |   |         |   |   | |   | |
 *                    | |   | |   |   |         |   |   | |   | |
 *                    | +---+ +---+   +---------+   +---+ +---+ |
 *                    |  initialize                    close    |
 *                    +-----------------------------------------+
 * </pre>
 *
 * Use cases:
 * - Preserving the input selection ranges before/after reconciliation.
 *   Restoring selection even in the event of an unexpected error.
 * - Deactivating events while rearranging the DOM, preventing blurs/focuses,
 *   while guaranteeing that afterwards, the event system is reactivated.
 * - Flushing a queue of collected DOM mutations to the main UI thread after a
 *   reconciliation takes place in a worker thread.
 * - Invoking any collected `componentDidUpdate` callbacks after rendering new
 *   content.
 * - (Future use case): Wrapping particular flushes of the `ReactWorker` queue
 *   to preserve the `scrollTop` (an automatic scroll aware DOM).
 * - (Future use case): Layout calculations before and after DOM upates.
 *
 * Transactional plugin API:
 * - A module that has an `initialize` method that returns any precomputation.
 * - and a `close` method that accepts the precomputation. `close` is invoked
 *   when the wrapped process is completed, or has failed.
 *
 * @param {Array<TransactionalWrapper>} transactionWrapper Wrapper modules
 * that implement `initialize` and `close`.
 * @return {Transaction} Single transaction for reuse in thread.
 *
 * @class Transaction
 */
var Mixin = {
  /**
   * Sets up this instance so that it is prepared for collecting metrics. Does
   * so such that this setup method may be used on an instance that is already
   * initialized, in a way that does not consume additional memory upon reuse.
   * That can be useful if you decide to make your subclass of this mixin a
   * "PooledClass".
   */
  reinitializeTransaction: function() {
    this.transactionWrappers = this.getTransactionWrappers();
    if (!this.wrapperInitData) {
      this.wrapperInitData = [];
    } else {
      this.wrapperInitData.length = 0;
    }
    this._isInTransaction = false;
  },

  _isInTransaction: false,

  /**
   * @abstract
   * @return {Array<TransactionWrapper>} Array of transaction wrappers.
   */
  getTransactionWrappers: null,

  isInTransaction: function() {
    return !!this._isInTransaction;
  },

  /**
   * Executes the function within a safety window. Use this for the top level
   * methods that result in large amounts of computation/mutations that would
   * need to be safety checked.
   *
   * @param {function} method Member of scope to call.
   * @param {Object} scope Scope to invoke from.
   * @param {Object?=} args... Arguments to pass to the method (optional).
   *                           Helps prevent need to bind in many cases.
   * @return Return value from `method`.
   */
  perform: function(method, scope, a, b, c, d, e, f) {
    ("production" !== "development" ? invariant(
      !this.isInTransaction(),
      'Transaction.perform(...): Cannot initialize a transaction when there ' +
      'is already an outstanding transaction.'
    ) : invariant(!this.isInTransaction()));
    var errorThrown;
    var ret;
    try {
      this._isInTransaction = true;
      // Catching errors makes debugging more difficult, so we start with
      // errorThrown set to true before setting it to false after calling
      // close -- if it's still set to true in the finally block, it means
      // one of these calls threw.
      errorThrown = true;
      this.initializeAll(0);
      ret = method.call(scope, a, b, c, d, e, f);
      errorThrown = false;
    } finally {
      try {
        if (errorThrown) {
          // If `method` throws, prefer to show that stack trace over any thrown
          // by invoking `closeAll`.
          try {
            this.closeAll(0);
          } catch (err) {
          }
        } else {
          // Since `method` didn't throw, we don't want to silence the exception
          // here.
          this.closeAll(0);
        }
      } finally {
        this._isInTransaction = false;
      }
    }
    return ret;
  },

  initializeAll: function(startIndex) {
    var transactionWrappers = this.transactionWrappers;
    for (var i = startIndex; i < transactionWrappers.length; i++) {
      var wrapper = transactionWrappers[i];
      try {
        // Catching errors makes debugging more difficult, so we start with the
        // OBSERVED_ERROR state before overwriting it with the real return value
        // of initialize -- if it's still set to OBSERVED_ERROR in the finally
        // block, it means wrapper.initialize threw.
        this.wrapperInitData[i] = Transaction.OBSERVED_ERROR;
        this.wrapperInitData[i] = wrapper.initialize ?
          wrapper.initialize.call(this) :
          null;
      } finally {
        if (this.wrapperInitData[i] === Transaction.OBSERVED_ERROR) {
          // The initializer for wrapper i threw an error; initialize the
          // remaining wrappers but silence any exceptions from them to ensure
          // that the first error is the one to bubble up.
          try {
            this.initializeAll(i + 1);
          } catch (err) {
          }
        }
      }
    }
  },

  /**
   * Invokes each of `this.transactionWrappers.close[i]` functions, passing into
   * them the respective return values of `this.transactionWrappers.init[i]`
   * (`close`rs that correspond to initializers that failed will not be
   * invoked).
   */
  closeAll: function(startIndex) {
    ("production" !== "development" ? invariant(
      this.isInTransaction(),
      'Transaction.closeAll(): Cannot close transaction when none are open.'
    ) : invariant(this.isInTransaction()));
    var transactionWrappers = this.transactionWrappers;
    for (var i = startIndex; i < transactionWrappers.length; i++) {
      var wrapper = transactionWrappers[i];
      var initData = this.wrapperInitData[i];
      var errorThrown;
      try {
        // Catching errors makes debugging more difficult, so we start with
        // errorThrown set to true before setting it to false after calling
        // close -- if it's still set to true in the finally block, it means
        // wrapper.close threw.
        errorThrown = true;
        if (initData !== Transaction.OBSERVED_ERROR) {
          wrapper.close && wrapper.close.call(this, initData);
        }
        errorThrown = false;
      } finally {
        if (errorThrown) {
          // The closer for wrapper i threw an error; close the remaining
          // wrappers but silence any exceptions from them to ensure that the
          // first error is the one to bubble up.
          try {
            this.closeAll(i + 1);
          } catch (e) {
          }
        }
      }
    }
    this.wrapperInitData.length = 0;
  }
};

var Transaction = {

  Mixin: Mixin,

  /**
   * Token to look for to determine if an error occured.
   */
  OBSERVED_ERROR: {}

};

module.exports = Transaction;

},{"./invariant":134}],105:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule ViewportMetrics
 */



var getUnboundedScrollPosition = _dereq_("./getUnboundedScrollPosition");

var ViewportMetrics = {

  currentScrollLeft: 0,

  currentScrollTop: 0,

  refreshScrollValues: function() {
    var scrollPosition = getUnboundedScrollPosition(window);
    ViewportMetrics.currentScrollLeft = scrollPosition.x;
    ViewportMetrics.currentScrollTop = scrollPosition.y;
  }

};

module.exports = ViewportMetrics;

},{"./getUnboundedScrollPosition":130}],106:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule accumulate
 */



var invariant = _dereq_("./invariant");

/**
 * Accumulates items that must not be null or undefined.
 *
 * This is used to conserve memory by avoiding array allocations.
 *
 * @return {*|array<*>} An accumulation of items.
 */
function accumulate(current, next) {
  ("production" !== "development" ? invariant(
    next != null,
    'accumulate(...): Accumulated items must be not be null or undefined.'
  ) : invariant(next != null));
  if (current == null) {
    return next;
  } else {
    // Both are not empty. Warning: Never call x.concat(y) when you are not
    // certain that x is an Array (x could be a string with concat method).
    var currentIsArray = Array.isArray(current);
    var nextIsArray = Array.isArray(next);
    if (currentIsArray) {
      return current.concat(next);
    } else {
      if (nextIsArray) {
        return [current].concat(next);
      } else {
        return [current, next];
      }
    }
  }
}

module.exports = accumulate;

},{"./invariant":134}],107:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule adler32
 */

/* jslint bitwise:true */



var MOD = 65521;

// This is a clean-room implementation of adler32 designed for detecting
// if markup is not what we expect it to be. It does not need to be
// cryptographically strong, only reasonable good at detecting if markup
// generated on the server is different than that on the client.
function adler32(data) {
  var a = 1;
  var b = 0;
  for (var i = 0; i < data.length; i++) {
    a = (a + data.charCodeAt(i)) % MOD;
    b = (b + a) % MOD;
  }
  return a | (b << 16);
}

module.exports = adler32;

},{}],108:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @typechecks
 * @providesModule cloneWithProps
 */



var ReactPropTransferer = _dereq_("./ReactPropTransferer");

var keyOf = _dereq_("./keyOf");
var warning = _dereq_("./warning");

var CHILDREN_PROP = keyOf({children: null});

/**
 * Sometimes you want to change the props of a child passed to you. Usually
 * this is to add a CSS class.
 *
 * @param {object} child child component you'd like to clone
 * @param {object} props props you'd like to modify. They will be merged
 * as if you used `transferPropsTo()`.
 * @return {object} a clone of child with props merged in.
 */
function cloneWithProps(child, props) {
  if ("production" !== "development") {
    ("production" !== "development" ? warning(
      !child.props.ref,
      'You are calling cloneWithProps() on a child with a ref. This is ' +
      'dangerous because you\'re creating a new child which will not be ' +
      'added as a ref to its parent.'
    ) : null);
  }

  var newProps = ReactPropTransferer.mergeProps(props, child.props);

  // Use `child.props.children` if it is provided.
  if (!newProps.hasOwnProperty(CHILDREN_PROP) &&
      child.props.hasOwnProperty(CHILDREN_PROP)) {
    newProps.children = child.props.children;
  }

  // The current API doesn't retain _owner and _context, which is why this
  // doesn't use ReactDescriptor.cloneAndReplaceProps.
  return child.constructor(newProps);
}

module.exports = cloneWithProps;

},{"./ReactPropTransferer":72,"./keyOf":141,"./warning":158}],109:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule containsNode
 * @typechecks
 */

var isTextNode = _dereq_("./isTextNode");

/*jslint bitwise:true */

/**
 * Checks if a given DOM node contains or is another DOM node.
 *
 * @param {?DOMNode} outerNode Outer DOM node.
 * @param {?DOMNode} innerNode Inner DOM node.
 * @return {boolean} True if `outerNode` contains or is `innerNode`.
 */
function containsNode(outerNode, innerNode) {
  if (!outerNode || !innerNode) {
    return false;
  } else if (outerNode === innerNode) {
    return true;
  } else if (isTextNode(outerNode)) {
    return false;
  } else if (isTextNode(innerNode)) {
    return containsNode(outerNode, innerNode.parentNode);
  } else if (outerNode.contains) {
    return outerNode.contains(innerNode);
  } else if (outerNode.compareDocumentPosition) {
    return !!(outerNode.compareDocumentPosition(innerNode) & 16);
  } else {
    return false;
  }
}

module.exports = containsNode;

},{"./isTextNode":138}],110:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule copyProperties
 */

/**
 * Copy properties from one or more objects (up to 5) into the first object.
 * This is a shallow copy. It mutates the first object and also returns it.
 *
 * NOTE: `arguments` has a very significant performance penalty, which is why
 * we don't support unlimited arguments.
 */
function copyProperties(obj, a, b, c, d, e, f) {
  obj = obj || {};

  if ("production" !== "development") {
    if (f) {
      throw new Error('Too many arguments passed to copyProperties');
    }
  }

  var args = [a, b, c, d, e];
  var ii = 0, v;
  while (args[ii]) {
    v = args[ii++];
    for (var k in v) {
      obj[k] = v[k];
    }

    // IE ignores toString in object iteration.. See:
    // webreflection.blogspot.com/2007/07/quick-fix-internet-explorer-and.html
    if (v.hasOwnProperty && v.hasOwnProperty('toString') &&
        (typeof v.toString != 'undefined') && (obj.toString !== v.toString)) {
      obj.toString = v.toString;
    }
  }

  return obj;
}

module.exports = copyProperties;

},{}],111:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule createArrayFrom
 * @typechecks
 */

var toArray = _dereq_("./toArray");

/**
 * Perform a heuristic test to determine if an object is "array-like".
 *
 *   A monk asked Joshu, a Zen master, "Has a dog Buddha nature?"
 *   Joshu replied: "Mu."
 *
 * This function determines if its argument has "array nature": it returns
 * true if the argument is an actual array, an `arguments' object, or an
 * HTMLCollection (e.g. node.childNodes or node.getElementsByTagName()).
 *
 * It will return false for other array-like objects like Filelist.
 *
 * @param {*} obj
 * @return {boolean}
 */
function hasArrayNature(obj) {
  return (
    // not null/false
    !!obj &&
    // arrays are objects, NodeLists are functions in Safari
    (typeof obj == 'object' || typeof obj == 'function') &&
    // quacks like an array
    ('length' in obj) &&
    // not window
    !('setInterval' in obj) &&
    // no DOM node should be considered an array-like
    // a 'select' element has 'length' and 'item' properties on IE8
    (typeof obj.nodeType != 'number') &&
    (
      // a real array
      (// HTMLCollection/NodeList
      (Array.isArray(obj) ||
      // arguments
      ('callee' in obj) || 'item' in obj))
    )
  );
}

/**
 * Ensure that the argument is an array by wrapping it in an array if it is not.
 * Creates a copy of the argument if it is already an array.
 *
 * This is mostly useful idiomatically:
 *
 *   var createArrayFrom = require('createArrayFrom');
 *
 *   function takesOneOrMoreThings(things) {
 *     things = createArrayFrom(things);
 *     ...
 *   }
 *
 * This allows you to treat `things' as an array, but accept scalars in the API.
 *
 * If you need to convert an array-like object, like `arguments`, into an array
 * use toArray instead.
 *
 * @param {*} obj
 * @return {array}
 */
function createArrayFrom(obj) {
  if (!hasArrayNature(obj)) {
    return [obj];
  } else if (Array.isArray(obj)) {
    return obj.slice();
  } else {
    return toArray(obj);
  }
}

module.exports = createArrayFrom;

},{"./toArray":155}],112:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule createFullPageComponent
 * @typechecks
 */



// Defeat circular references by requiring this directly.
var ReactCompositeComponent = _dereq_("./ReactCompositeComponent");

var invariant = _dereq_("./invariant");

/**
 * Create a component that will throw an exception when unmounted.
 *
 * Components like <html> <head> and <body> can't be removed or added
 * easily in a cross-browser way, however it's valuable to be able to
 * take advantage of React's reconciliation for styling and <title>
 * management. So we just document it and throw in dangerous cases.
 *
 * @param {function} componentClass convenience constructor to wrap
 * @return {function} convenience constructor of new component
 */
function createFullPageComponent(componentClass) {
  var FullPageComponent = ReactCompositeComponent.createClass({
    displayName: 'ReactFullPageComponent' + (
      componentClass.type.displayName || ''
    ),

    componentWillUnmount: function() {
      ("production" !== "development" ? invariant(
        false,
        '%s tried to unmount. Because of cross-browser quirks it is ' +
        'impossible to unmount some top-level components (eg <html>, <head>, ' +
        'and <body>) reliably and efficiently. To fix this, have a single ' +
        'top-level component that never unmounts render these elements.',
        this.constructor.displayName
      ) : invariant(false));
    },

    render: function() {
      return this.transferPropsTo(componentClass(null, this.props.children));
    }
  });

  return FullPageComponent;
}

module.exports = createFullPageComponent;

},{"./ReactCompositeComponent":38,"./invariant":134}],113:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule createNodesFromMarkup
 * @typechecks
 */

/*jslint evil: true, sub: true */

var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

var createArrayFrom = _dereq_("./createArrayFrom");
var getMarkupWrap = _dereq_("./getMarkupWrap");
var invariant = _dereq_("./invariant");

/**
 * Dummy container used to render all markup.
 */
var dummyNode =
  ExecutionEnvironment.canUseDOM ? document.createElement('div') : null;

/**
 * Pattern used by `getNodeName`.
 */
var nodeNamePattern = /^\s*<(\w+)/;

/**
 * Extracts the `nodeName` of the first element in a string of markup.
 *
 * @param {string} markup String of markup.
 * @return {?string} Node name of the supplied markup.
 */
function getNodeName(markup) {
  var nodeNameMatch = markup.match(nodeNamePattern);
  return nodeNameMatch && nodeNameMatch[1].toLowerCase();
}

/**
 * Creates an array containing the nodes rendered from the supplied markup. The
 * optionally supplied `handleScript` function will be invoked once for each
 * <script> element that is rendered. If no `handleScript` function is supplied,
 * an exception is thrown if any <script> elements are rendered.
 *
 * @param {string} markup A string of valid HTML markup.
 * @param {?function} handleScript Invoked once for each rendered <script>.
 * @return {array<DOMElement|DOMTextNode>} An array of rendered nodes.
 */
function createNodesFromMarkup(markup, handleScript) {
  var node = dummyNode;
  ("production" !== "development" ? invariant(!!dummyNode, 'createNodesFromMarkup dummy not initialized') : invariant(!!dummyNode));
  var nodeName = getNodeName(markup);

  var wrap = nodeName && getMarkupWrap(nodeName);
  if (wrap) {
    node.innerHTML = wrap[1] + markup + wrap[2];

    var wrapDepth = wrap[0];
    while (wrapDepth--) {
      node = node.lastChild;
    }
  } else {
    node.innerHTML = markup;
  }

  var scripts = node.getElementsByTagName('script');
  if (scripts.length) {
    ("production" !== "development" ? invariant(
      handleScript,
      'createNodesFromMarkup(...): Unexpected <script> element rendered.'
    ) : invariant(handleScript));
    createArrayFrom(scripts).forEach(handleScript);
  }

  var nodes = createArrayFrom(node.childNodes);
  while (node.lastChild) {
    node.removeChild(node.lastChild);
  }
  return nodes;
}

module.exports = createNodesFromMarkup;

},{"./ExecutionEnvironment":22,"./createArrayFrom":111,"./getMarkupWrap":126,"./invariant":134}],114:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule cx
 */

/**
 * This function is used to mark string literals representing CSS class names
 * so that they can be transformed statically. This allows for modularization
 * and minification of CSS class names.
 *
 * In static_upstream, this function is actually implemented, but it should
 * eventually be replaced with something more descriptive, and the transform
 * that is used in the main stack should be ported for use elsewhere.
 *
 * @param string|object className to modularize, or an object of key/values.
 *                      In the object case, the values are conditions that
 *                      determine if the className keys should be included.
 * @param [string ...]  Variable list of classNames in the string case.
 * @return string       Renderable space-separated CSS className.
 */
function cx(classNames) {
  if (typeof classNames == 'object') {
    return Object.keys(classNames).filter(function(className) {
      return classNames[className];
    }).join(' ');
  } else {
    return Array.prototype.join.call(arguments, ' ');
  }
}

module.exports = cx;

},{}],115:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule dangerousStyleValue
 * @typechecks static-only
 */



var CSSProperty = _dereq_("./CSSProperty");

var isUnitlessNumber = CSSProperty.isUnitlessNumber;

/**
 * Convert a value into the proper css writable value. The style name `name`
 * should be logical (no hyphens), as specified
 * in `CSSProperty.isUnitlessNumber`.
 *
 * @param {string} name CSS property name such as `topMargin`.
 * @param {*} value CSS property value such as `10px`.
 * @return {string} Normalized style value with dimensions applied.
 */
function dangerousStyleValue(name, value) {
  // Note that we've removed escapeTextForBrowser() calls here since the
  // whole string will be escaped when the attribute is injected into
  // the markup. If you provide unsafe user data here they can inject
  // arbitrary CSS which may be problematic (I couldn't repro this):
  // https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet
  // http://www.thespanner.co.uk/2007/11/26/ultimate-xss-css-injection/
  // This is not an XSS hole but instead a potential CSS injection issue
  // which has lead to a greater discussion about how we're going to
  // trust URLs moving forward. See #2115901

  var isEmpty = value == null || typeof value === 'boolean' || value === '';
  if (isEmpty) {
    return '';
  }

  var isNonNumeric = isNaN(value);
  if (isNonNumeric || value === 0 ||
      isUnitlessNumber.hasOwnProperty(name) && isUnitlessNumber[name]) {
    return '' + value; // cast to string
  }

  if (typeof value === 'string') {
    value = value.trim();
  }
  return value + 'px';
}

module.exports = dangerousStyleValue;

},{"./CSSProperty":4}],116:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule emptyFunction
 */

var copyProperties = _dereq_("./copyProperties");

function makeEmptyFunction(arg) {
  return function() {
    return arg;
  };
}

/**
 * This function accepts and discards inputs; it has no side effects. This is
 * primarily useful idiomatically for overridable function endpoints which
 * always need to be callable, since JS lacks a null-call idiom ala Cocoa.
 */
function emptyFunction() {}

copyProperties(emptyFunction, {
  thatReturns: makeEmptyFunction,
  thatReturnsFalse: makeEmptyFunction(false),
  thatReturnsTrue: makeEmptyFunction(true),
  thatReturnsNull: makeEmptyFunction(null),
  thatReturnsThis: function() { return this; },
  thatReturnsArgument: function(arg) { return arg; }
});

module.exports = emptyFunction;

},{"./copyProperties":110}],117:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule emptyObject
 */



var emptyObject = {};

if ("production" !== "development") {
  Object.freeze(emptyObject);
}

module.exports = emptyObject;

},{}],118:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule escapeTextForBrowser
 * @typechecks static-only
 */



var ESCAPE_LOOKUP = {
  "&": "&amp;",
  ">": "&gt;",
  "<": "&lt;",
  "\"": "&quot;",
  "'": "&#x27;"
};

var ESCAPE_REGEX = /[&><"']/g;

function escaper(match) {
  return ESCAPE_LOOKUP[match];
}

/**
 * Escapes text to prevent scripting attacks.
 *
 * @param {*} text Text value to escape.
 * @return {string} An escaped string.
 */
function escapeTextForBrowser(text) {
  return ('' + text).replace(ESCAPE_REGEX, escaper);
}

module.exports = escapeTextForBrowser;

},{}],119:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule flattenChildren
 */



var traverseAllChildren = _dereq_("./traverseAllChildren");
var warning = _dereq_("./warning");

/**
 * @param {function} traverseContext Context passed through traversal.
 * @param {?ReactComponent} child React child component.
 * @param {!string} name String name of key path to child.
 */
function flattenSingleChildIntoContext(traverseContext, child, name) {
  // We found a component instance.
  var result = traverseContext;
  var keyUnique = !result.hasOwnProperty(name);
  ("production" !== "development" ? warning(
    keyUnique,
    'flattenChildren(...): Encountered two children with the same key, ' +
    '`%s`. Child keys must be unique; when two children share a key, only ' +
    'the first child will be used.',
    name
  ) : null);
  if (keyUnique && child != null) {
    result[name] = child;
  }
}

/**
 * Flattens children that are typically specified as `props.children`. Any null
 * children will not be included in the resulting object.
 * @return {!object} flattened children keyed by name.
 */
function flattenChildren(children) {
  if (children == null) {
    return children;
  }
  var result = {};
  traverseAllChildren(children, flattenSingleChildIntoContext, result);
  return result;
}

module.exports = flattenChildren;

},{"./traverseAllChildren":156,"./warning":158}],120:[function(_dereq_,module,exports){
/**
 * Copyright 2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule focusNode
 */



/**
 * IE8 throws if an input/textarea is disabled and we try to focus it.
 * Focus only when necessary.
 *
 * @param {DOMElement} node input/textarea to focus
 */
function focusNode(node) {
  if (!node.disabled) {
    node.focus();
  }
}

module.exports = focusNode;

},{}],121:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule forEachAccumulated
 */



/**
 * @param {array} an "accumulation" of items which is either an Array or
 * a single item. Useful when paired with the `accumulate` module. This is a
 * simple utility that allows us to reason about a collection of items, but
 * handling the case when there is exactly one item (and we do not need to
 * allocate an array).
 */
var forEachAccumulated = function(arr, cb, scope) {
  if (Array.isArray(arr)) {
    arr.forEach(cb, scope);
  } else if (arr) {
    cb.call(scope, arr);
  }
};

module.exports = forEachAccumulated;

},{}],122:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule getActiveElement
 * @typechecks
 */

/**
 * Same as document.activeElement but wraps in a try-catch block. In IE it is
 * not safe to call document.activeElement if there is nothing focused.
 *
 * The activeElement will be null only if the document body is not yet defined.
 */
function getActiveElement() /*?DOMElement*/ {
  try {
    return document.activeElement || document.body;
  } catch (e) {
    return document.body;
  }
}

module.exports = getActiveElement;

},{}],123:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule getEventKey
 * @typechecks static-only
 */



var invariant = _dereq_("./invariant");

/**
 * Normalization of deprecated HTML5 `key` values
 * @see https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent#Key_names
 */
var normalizeKey = {
  'Esc': 'Escape',
  'Spacebar': ' ',
  'Left': 'ArrowLeft',
  'Up': 'ArrowUp',
  'Right': 'ArrowRight',
  'Down': 'ArrowDown',
  'Del': 'Delete',
  'Win': 'OS',
  'Menu': 'ContextMenu',
  'Apps': 'ContextMenu',
  'Scroll': 'ScrollLock',
  'MozPrintableKey': 'Unidentified'
};

/**
 * Translation from legacy `which`/`keyCode` to HTML5 `key`
 * Only special keys supported, all others depend on keyboard layout or browser
 * @see https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent#Key_names
 */
var translateToKey = {
  8: 'Backspace',
  9: 'Tab',
  12: 'Clear',
  13: 'Enter',
  16: 'Shift',
  17: 'Control',
  18: 'Alt',
  19: 'Pause',
  20: 'CapsLock',
  27: 'Escape',
  32: ' ',
  33: 'PageUp',
  34: 'PageDown',
  35: 'End',
  36: 'Home',
  37: 'ArrowLeft',
  38: 'ArrowUp',
  39: 'ArrowRight',
  40: 'ArrowDown',
  45: 'Insert',
  46: 'Delete',
  112: 'F1', 113: 'F2', 114: 'F3', 115: 'F4', 116: 'F5', 117: 'F6',
  118: 'F7', 119: 'F8', 120: 'F9', 121: 'F10', 122: 'F11', 123: 'F12',
  144: 'NumLock',
  145: 'ScrollLock',
  224: 'Meta'
};

/**
 * @param {object} nativeEvent Native browser event.
 * @return {string} Normalized `key` property.
 */
function getEventKey(nativeEvent) {
  if (nativeEvent.key) {
    // Normalize inconsistent values reported by browsers due to
    // implementations of a working draft specification.

    // FireFox implements `key` but returns `MozPrintableKey` for all
    // printable characters (normalized to `Unidentified`), ignore it.
    var key = normalizeKey[nativeEvent.key] || nativeEvent.key;
    if (key !== 'Unidentified') {
      return key;
    }
  }

  // Browser does not implement `key`, polyfill as much of it as we can.
  if (nativeEvent.type === 'keypress') {
    // Create the character from the `charCode` ourselves and use as an almost
    // perfect replacement.
    var charCode = 'charCode' in nativeEvent ?
      nativeEvent.charCode :
      nativeEvent.keyCode;

    // The enter-key is technically both printable and non-printable and can
    // thus be captured by `keypress`, no other non-printable key should.
    return charCode === 13 ? 'Enter' : String.fromCharCode(charCode);
  }
  if (nativeEvent.type === 'keydown' || nativeEvent.type === 'keyup') {
    // While user keyboard layout determines the actual meaning of each
    // `keyCode` value, almost all function keys have a universal value.
    return translateToKey[nativeEvent.keyCode] || 'Unidentified';
  }

  ("production" !== "development" ? invariant(false, "Unexpected keyboard event type: %s", nativeEvent.type) : invariant(false));
}

module.exports = getEventKey;

},{"./invariant":134}],124:[function(_dereq_,module,exports){
/**
 * Copyright 2013 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule getEventModifierState
 * @typechecks static-only
 */



/**
 * Translation from modifier key to the associated property in the event.
 * @see http://www.w3.org/TR/DOM-Level-3-Events/#keys-Modifiers
 */

var modifierKeyToProp = {
  'Alt': 'altKey',
  'Control': 'ctrlKey',
  'Meta': 'metaKey',
  'Shift': 'shiftKey'
};

// IE8 does not implement getModifierState so we simply map it to the only
// modifier keys exposed by the event itself, does not support Lock-keys.
// Currently, all major browsers except Chrome seems to support Lock-keys.
function modifierStateGetter(keyArg) {
  /*jshint validthis:true */
  var syntheticEvent = this;
  var nativeEvent = syntheticEvent.nativeEvent;
  if (nativeEvent.getModifierState) {
    return nativeEvent.getModifierState(keyArg);
  }
  var keyProp = modifierKeyToProp[keyArg];
  return keyProp ? !!nativeEvent[keyProp] : false;
}

function getEventModifierState(nativeEvent) {
  return modifierStateGetter;
}

module.exports = getEventModifierState;

},{}],125:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule getEventTarget
 * @typechecks static-only
 */



/**
 * Gets the target node from a native browser event by accounting for
 * inconsistencies in browser DOM APIs.
 *
 * @param {object} nativeEvent Native browser event.
 * @return {DOMEventTarget} Target node.
 */
function getEventTarget(nativeEvent) {
  var target = nativeEvent.target || nativeEvent.srcElement || window;
  // Safari may fire events on text nodes (Node.TEXT_NODE is 3).
  // @see http://www.quirksmode.org/js/events_properties.html
  return target.nodeType === 3 ? target.parentNode : target;
}

module.exports = getEventTarget;

},{}],126:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule getMarkupWrap
 */

var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

var invariant = _dereq_("./invariant");

/**
 * Dummy container used to detect which wraps are necessary.
 */
var dummyNode =
  ExecutionEnvironment.canUseDOM ? document.createElement('div') : null;

/**
 * Some browsers cannot use `innerHTML` to render certain elements standalone,
 * so we wrap them, render the wrapped nodes, then extract the desired node.
 *
 * In IE8, certain elements cannot render alone, so wrap all elements ('*').
 */
var shouldWrap = {
  // Force wrapping for SVG elements because if they get created inside a <div>,
  // they will be initialized in the wrong namespace (and will not display).
  'circle': true,
  'defs': true,
  'ellipse': true,
  'g': true,
  'line': true,
  'linearGradient': true,
  'path': true,
  'polygon': true,
  'polyline': true,
  'radialGradient': true,
  'rect': true,
  'stop': true,
  'text': true
};

var selectWrap = [1, '<select multiple="true">', '</select>'];
var tableWrap = [1, '<table>', '</table>'];
var trWrap = [3, '<table><tbody><tr>', '</tr></tbody></table>'];

var svgWrap = [1, '<svg>', '</svg>'];

var markupWrap = {
  '*': [1, '?<div>', '</div>'],

  'area': [1, '<map>', '</map>'],
  'col': [2, '<table><tbody></tbody><colgroup>', '</colgroup></table>'],
  'legend': [1, '<fieldset>', '</fieldset>'],
  'param': [1, '<object>', '</object>'],
  'tr': [2, '<table><tbody>', '</tbody></table>'],

  'optgroup': selectWrap,
  'option': selectWrap,

  'caption': tableWrap,
  'colgroup': tableWrap,
  'tbody': tableWrap,
  'tfoot': tableWrap,
  'thead': tableWrap,

  'td': trWrap,
  'th': trWrap,

  'circle': svgWrap,
  'defs': svgWrap,
  'ellipse': svgWrap,
  'g': svgWrap,
  'line': svgWrap,
  'linearGradient': svgWrap,
  'path': svgWrap,
  'polygon': svgWrap,
  'polyline': svgWrap,
  'radialGradient': svgWrap,
  'rect': svgWrap,
  'stop': svgWrap,
  'text': svgWrap
};

/**
 * Gets the markup wrap configuration for the supplied `nodeName`.
 *
 * NOTE: This lazily detects which wraps are necessary for the current browser.
 *
 * @param {string} nodeName Lowercase `nodeName`.
 * @return {?array} Markup wrap configuration, if applicable.
 */
function getMarkupWrap(nodeName) {
  ("production" !== "development" ? invariant(!!dummyNode, 'Markup wrapping node not initialized') : invariant(!!dummyNode));
  if (!markupWrap.hasOwnProperty(nodeName)) {
    nodeName = '*';
  }
  if (!shouldWrap.hasOwnProperty(nodeName)) {
    if (nodeName === '*') {
      dummyNode.innerHTML = '<link />';
    } else {
      dummyNode.innerHTML = '<' + nodeName + '></' + nodeName + '>';
    }
    shouldWrap[nodeName] = !dummyNode.firstChild;
  }
  return shouldWrap[nodeName] ? markupWrap[nodeName] : null;
}


module.exports = getMarkupWrap;

},{"./ExecutionEnvironment":22,"./invariant":134}],127:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule getNodeForCharacterOffset
 */



/**
 * Given any node return the first leaf node without children.
 *
 * @param {DOMElement|DOMTextNode} node
 * @return {DOMElement|DOMTextNode}
 */
function getLeafNode(node) {
  while (node && node.firstChild) {
    node = node.firstChild;
  }
  return node;
}

/**
 * Get the next sibling within a container. This will walk up the
 * DOM if a node's siblings have been exhausted.
 *
 * @param {DOMElement|DOMTextNode} node
 * @return {?DOMElement|DOMTextNode}
 */
function getSiblingNode(node) {
  while (node) {
    if (node.nextSibling) {
      return node.nextSibling;
    }
    node = node.parentNode;
  }
}

/**
 * Get object describing the nodes which contain characters at offset.
 *
 * @param {DOMElement|DOMTextNode} root
 * @param {number} offset
 * @return {?object}
 */
function getNodeForCharacterOffset(root, offset) {
  var node = getLeafNode(root);
  var nodeStart = 0;
  var nodeEnd = 0;

  while (node) {
    if (node.nodeType == 3) {
      nodeEnd = nodeStart + node.textContent.length;

      if (nodeStart <= offset && nodeEnd >= offset) {
        return {
          node: node,
          offset: offset - nodeStart
        };
      }

      nodeStart = nodeEnd;
    }

    node = getLeafNode(getSiblingNode(node));
  }
}

module.exports = getNodeForCharacterOffset;

},{}],128:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule getReactRootElementInContainer
 */



var DOC_NODE_TYPE = 9;

/**
 * @param {DOMElement|DOMDocument} container DOM element that may contain
 *                                           a React component
 * @return {?*} DOM element that may have the reactRoot ID, or null.
 */
function getReactRootElementInContainer(container) {
  if (!container) {
    return null;
  }

  if (container.nodeType === DOC_NODE_TYPE) {
    return container.documentElement;
  } else {
    return container.firstChild;
  }
}

module.exports = getReactRootElementInContainer;

},{}],129:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule getTextContentAccessor
 */



var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

var contentKey = null;

/**
 * Gets the key used to access text content on a DOM node.
 *
 * @return {?string} Key used to access text content.
 * @internal
 */
function getTextContentAccessor() {
  if (!contentKey && ExecutionEnvironment.canUseDOM) {
    // Prefer textContent to innerText because many browsers support both but
    // SVG <text> elements don't support innerText even when <div> does.
    contentKey = 'textContent' in document.documentElement ?
      'textContent' :
      'innerText';
  }
  return contentKey;
}

module.exports = getTextContentAccessor;

},{"./ExecutionEnvironment":22}],130:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule getUnboundedScrollPosition
 * @typechecks
 */



/**
 * Gets the scroll position of the supplied element or window.
 *
 * The return values are unbounded, unlike `getScrollPosition`. This means they
 * may be negative or exceed the element boundaries (which is possible using
 * inertial scrolling).
 *
 * @param {DOMWindow|DOMElement} scrollable
 * @return {object} Map with `x` and `y` keys.
 */
function getUnboundedScrollPosition(scrollable) {
  if (scrollable === window) {
    return {
      x: window.pageXOffset || document.documentElement.scrollLeft,
      y: window.pageYOffset || document.documentElement.scrollTop
    };
  }
  return {
    x: scrollable.scrollLeft,
    y: scrollable.scrollTop
  };
}

module.exports = getUnboundedScrollPosition;

},{}],131:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule hyphenate
 * @typechecks
 */

var _uppercasePattern = /([A-Z])/g;

/**
 * Hyphenates a camelcased string, for example:
 *
 *   > hyphenate('backgroundColor')
 *   < "background-color"
 *
 * For CSS style names, use `hyphenateStyleName` instead which works properly
 * with all vendor prefixes, including `ms`.
 *
 * @param {string} string
 * @return {string}
 */
function hyphenate(string) {
  return string.replace(_uppercasePattern, '-$1').toLowerCase();
}

module.exports = hyphenate;

},{}],132:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule hyphenateStyleName
 * @typechecks
 */



var hyphenate = _dereq_("./hyphenate");

var msPattern = /^ms-/;

/**
 * Hyphenates a camelcased CSS property name, for example:
 *
 *   > hyphenate('backgroundColor')
 *   < "background-color"
 *   > hyphenate('MozTransition')
 *   < "-moz-transition"
 *   > hyphenate('msTransition')
 *   < "-ms-transition"
 *
 * As Modernizr suggests (http://modernizr.com/docs/#prefixed), an `ms` prefix
 * is converted to `-ms-`.
 *
 * @param {string} string
 * @return {string}
 */
function hyphenateStyleName(string) {
  return hyphenate(string).replace(msPattern, '-ms-');
}

module.exports = hyphenateStyleName;

},{"./hyphenate":131}],133:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule instantiateReactComponent
 * @typechecks static-only
 */



var invariant = _dereq_("./invariant");

/**
 * Validate a `componentDescriptor`. This should be exposed publicly in a follow
 * up diff.
 *
 * @param {object} descriptor
 * @return {boolean} Returns true if this is a valid descriptor of a Component.
 */
function isValidComponentDescriptor(descriptor) {
  return (
    descriptor &&
    typeof descriptor.type === 'function' &&
    typeof descriptor.type.prototype.mountComponent === 'function' &&
    typeof descriptor.type.prototype.receiveComponent === 'function'
  );
}

/**
 * Given a `componentDescriptor` create an instance that will actually be
 * mounted. Currently it just extracts an existing clone from composite
 * components but this is an implementation detail which will change.
 *
 * @param {object} descriptor
 * @return {object} A new instance of componentDescriptor's constructor.
 * @protected
 */
function instantiateReactComponent(descriptor) {

  // TODO: Make warning
  // if (__DEV__) {
    ("production" !== "development" ? invariant(
      isValidComponentDescriptor(descriptor),
      'Only React Components are valid for mounting.'
    ) : invariant(isValidComponentDescriptor(descriptor)));
  // }

  return new descriptor.type(descriptor);
}

module.exports = instantiateReactComponent;

},{"./invariant":134}],134:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule invariant
 */



/**
 * Use invariant() to assert state which your program assumes to be true.
 *
 * Provide sprintf-style format (only %s is supported) and arguments
 * to provide information about what broke and what you were
 * expecting.
 *
 * The invariant message will be stripped in production, but the invariant
 * will remain to ensure logic does not differ in production.
 */

var invariant = function(condition, format, a, b, c, d, e, f) {
  if ("production" !== "development") {
    if (format === undefined) {
      throw new Error('invariant requires an error message argument');
    }
  }

  if (!condition) {
    var error;
    if (format === undefined) {
      error = new Error(
        'Minified exception occurred; use the non-minified dev environment ' +
        'for the full error message and additional helpful warnings.'
      );
    } else {
      var args = [a, b, c, d, e, f];
      var argIndex = 0;
      error = new Error(
        'Invariant Violation: ' +
        format.replace(/%s/g, function() { return args[argIndex++]; })
      );
    }

    error.framesToPop = 1; // we don't care about invariant's own frame
    throw error;
  }
};

module.exports = invariant;

},{}],135:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule isEventSupported
 */



var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

var useHasFeature;
if (ExecutionEnvironment.canUseDOM) {
  useHasFeature =
    document.implementation &&
    document.implementation.hasFeature &&
    // always returns true in newer browsers as per the standard.
    // @see http://dom.spec.whatwg.org/#dom-domimplementation-hasfeature
    document.implementation.hasFeature('', '') !== true;
}

/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */
function isEventSupported(eventNameSuffix, capture) {
  if (!ExecutionEnvironment.canUseDOM ||
      capture && !('addEventListener' in document)) {
    return false;
  }

  var eventName = 'on' + eventNameSuffix;
  var isSupported = eventName in document;

  if (!isSupported) {
    var element = document.createElement('div');
    element.setAttribute(eventName, 'return;');
    isSupported = typeof element[eventName] === 'function';
  }

  if (!isSupported && useHasFeature && eventNameSuffix === 'wheel') {
    // This is the only way to test support for the `wheel` event in IE9+.
    isSupported = document.implementation.hasFeature('Events.wheel', '3.0');
  }

  return isSupported;
}

module.exports = isEventSupported;

},{"./ExecutionEnvironment":22}],136:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule isNode
 * @typechecks
 */

/**
 * @param {*} object The object to check.
 * @return {boolean} Whether or not the object is a DOM node.
 */
function isNode(object) {
  return !!(object && (
    typeof Node === 'function' ? object instanceof Node :
      typeof object === 'object' &&
      typeof object.nodeType === 'number' &&
      typeof object.nodeName === 'string'
  ));
}

module.exports = isNode;

},{}],137:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule isTextInputElement
 */



/**
 * @see http://www.whatwg.org/specs/web-apps/current-work/multipage/the-input-element.html#input-type-attr-summary
 */
var supportedInputTypes = {
  'color': true,
  'date': true,
  'datetime': true,
  'datetime-local': true,
  'email': true,
  'month': true,
  'number': true,
  'password': true,
  'range': true,
  'search': true,
  'tel': true,
  'text': true,
  'time': true,
  'url': true,
  'week': true
};

function isTextInputElement(elem) {
  return elem && (
    (elem.nodeName === 'INPUT' && supportedInputTypes[elem.type]) ||
    elem.nodeName === 'TEXTAREA'
  );
}

module.exports = isTextInputElement;

},{}],138:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule isTextNode
 * @typechecks
 */

var isNode = _dereq_("./isNode");

/**
 * @param {*} object The object to check.
 * @return {boolean} Whether or not the object is a DOM text node.
 */
function isTextNode(object) {
  return isNode(object) && object.nodeType == 3;
}

module.exports = isTextNode;

},{"./isNode":136}],139:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule joinClasses
 * @typechecks static-only
 */



/**
 * Combines multiple className strings into one.
 * http://jsperf.com/joinclasses-args-vs-array
 *
 * @param {...?string} classes
 * @return {string}
 */
function joinClasses(className/*, ... */) {
  if (!className) {
    className = '';
  }
  var nextClass;
  var argLength = arguments.length;
  if (argLength > 1) {
    for (var ii = 1; ii < argLength; ii++) {
      nextClass = arguments[ii];
      nextClass && (className += ' ' + nextClass);
    }
  }
  return className;
}

module.exports = joinClasses;

},{}],140:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule keyMirror
 * @typechecks static-only
 */



var invariant = _dereq_("./invariant");

/**
 * Constructs an enumeration with keys equal to their value.
 *
 * For example:
 *
 *   var COLORS = keyMirror({blue: null, red: null});
 *   var myColor = COLORS.blue;
 *   var isColorValid = !!COLORS[myColor];
 *
 * The last line could not be performed if the values of the generated enum were
 * not equal to their keys.
 *
 *   Input:  {key1: val1, key2: val2}
 *   Output: {key1: key1, key2: key2}
 *
 * @param {object} obj
 * @return {object}
 */
var keyMirror = function(obj) {
  var ret = {};
  var key;
  ("production" !== "development" ? invariant(
    obj instanceof Object && !Array.isArray(obj),
    'keyMirror(...): Argument must be an object.'
  ) : invariant(obj instanceof Object && !Array.isArray(obj)));
  for (key in obj) {
    if (!obj.hasOwnProperty(key)) {
      continue;
    }
    ret[key] = key;
  }
  return ret;
};

module.exports = keyMirror;

},{"./invariant":134}],141:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule keyOf
 */

/**
 * Allows extraction of a minified key. Let's the build system minify keys
 * without loosing the ability to dynamically use key strings as values
 * themselves. Pass in an object with a single key/val pair and it will return
 * you the string key of that single record. Suppose you want to grab the
 * value for a key 'className' inside of an object. Key/val minification may
 * have aliased that key to be 'xa12'. keyOf({className: null}) will return
 * 'xa12' in that case. Resolve keys you want to use once at startup time, then
 * reuse those resolutions.
 */
var keyOf = function(oneKeyObj) {
  var key;
  for (key in oneKeyObj) {
    if (!oneKeyObj.hasOwnProperty(key)) {
      continue;
    }
    return key;
  }
  return null;
};


module.exports = keyOf;

},{}],142:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule mapObject
 */



/**
 * For each key/value pair, invokes callback func and constructs a resulting
 * object which contains, for every key in obj, values that are the result of
 * of invoking the function:
 *
 *   func(value, key, iteration)
 *
 * Grepable names:
 *
 *   function objectMap()
 *   function objMap()
 *
 * @param {?object} obj Object to map keys over
 * @param {function} func Invoked for each key/val pair.
 * @param {?*} context
 * @return {?object} Result of mapping or null if obj is falsey
 */
function mapObject(obj, func, context) {
  if (!obj) {
    return null;
  }
  var i = 0;
  var ret = {};
  for (var key in obj) {
    if (obj.hasOwnProperty(key)) {
      ret[key] = func.call(context, obj[key], key, i++);
    }
  }
  return ret;
}

module.exports = mapObject;

},{}],143:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule memoizeStringOnly
 * @typechecks static-only
 */



/**
 * Memoizes the return value of a function that accepts one string argument.
 *
 * @param {function} callback
 * @return {function}
 */
function memoizeStringOnly(callback) {
  var cache = {};
  return function(string) {
    if (cache.hasOwnProperty(string)) {
      return cache[string];
    } else {
      return cache[string] = callback.call(this, string);
    }
  };
}

module.exports = memoizeStringOnly;

},{}],144:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule merge
 */



var mergeInto = _dereq_("./mergeInto");

/**
 * Shallow merges two structures into a return value, without mutating either.
 *
 * @param {?object} one Optional object with properties to merge from.
 * @param {?object} two Optional object with properties to merge from.
 * @return {object} The shallow extension of one by two.
 */
var merge = function(one, two) {
  var result = {};
  mergeInto(result, one);
  mergeInto(result, two);
  return result;
};

module.exports = merge;

},{"./mergeInto":146}],145:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule mergeHelpers
 *
 * requiresPolyfills: Array.isArray
 */



var invariant = _dereq_("./invariant");
var keyMirror = _dereq_("./keyMirror");

/**
 * Maximum number of levels to traverse. Will catch circular structures.
 * @const
 */
var MAX_MERGE_DEPTH = 36;

/**
 * We won't worry about edge cases like new String('x') or new Boolean(true).
 * Functions are considered terminals, and arrays are not.
 * @param {*} o The item/object/value to test.
 * @return {boolean} true iff the argument is a terminal.
 */
var isTerminal = function(o) {
  return typeof o !== 'object' || o === null;
};

var mergeHelpers = {

  MAX_MERGE_DEPTH: MAX_MERGE_DEPTH,

  isTerminal: isTerminal,

  /**
   * Converts null/undefined values into empty object.
   *
   * @param {?Object=} arg Argument to be normalized (nullable optional)
   * @return {!Object}
   */
  normalizeMergeArg: function(arg) {
    return arg === undefined || arg === null ? {} : arg;
  },

  /**
   * If merging Arrays, a merge strategy *must* be supplied. If not, it is
   * likely the caller's fault. If this function is ever called with anything
   * but `one` and `two` being `Array`s, it is the fault of the merge utilities.
   *
   * @param {*} one Array to merge into.
   * @param {*} two Array to merge from.
   */
  checkMergeArrayArgs: function(one, two) {
    ("production" !== "development" ? invariant(
      Array.isArray(one) && Array.isArray(two),
      'Tried to merge arrays, instead got %s and %s.',
      one,
      two
    ) : invariant(Array.isArray(one) && Array.isArray(two)));
  },

  /**
   * @param {*} one Object to merge into.
   * @param {*} two Object to merge from.
   */
  checkMergeObjectArgs: function(one, two) {
    mergeHelpers.checkMergeObjectArg(one);
    mergeHelpers.checkMergeObjectArg(two);
  },

  /**
   * @param {*} arg
   */
  checkMergeObjectArg: function(arg) {
    ("production" !== "development" ? invariant(
      !isTerminal(arg) && !Array.isArray(arg),
      'Tried to merge an object, instead got %s.',
      arg
    ) : invariant(!isTerminal(arg) && !Array.isArray(arg)));
  },

  /**
   * @param {*} arg
   */
  checkMergeIntoObjectArg: function(arg) {
    ("production" !== "development" ? invariant(
      (!isTerminal(arg) || typeof arg === 'function') && !Array.isArray(arg),
      'Tried to merge into an object, instead got %s.',
      arg
    ) : invariant((!isTerminal(arg) || typeof arg === 'function') && !Array.isArray(arg)));
  },

  /**
   * Checks that a merge was not given a circular object or an object that had
   * too great of depth.
   *
   * @param {number} Level of recursion to validate against maximum.
   */
  checkMergeLevel: function(level) {
    ("production" !== "development" ? invariant(
      level < MAX_MERGE_DEPTH,
      'Maximum deep merge depth exceeded. You may be attempting to merge ' +
      'circular structures in an unsupported way.'
    ) : invariant(level < MAX_MERGE_DEPTH));
  },

  /**
   * Checks that the supplied merge strategy is valid.
   *
   * @param {string} Array merge strategy.
   */
  checkArrayStrategy: function(strategy) {
    ("production" !== "development" ? invariant(
      strategy === undefined || strategy in mergeHelpers.ArrayStrategies,
      'You must provide an array strategy to deep merge functions to ' +
      'instruct the deep merge how to resolve merging two arrays.'
    ) : invariant(strategy === undefined || strategy in mergeHelpers.ArrayStrategies));
  },

  /**
   * Set of possible behaviors of merge algorithms when encountering two Arrays
   * that must be merged together.
   * - `clobber`: The left `Array` is ignored.
   * - `indexByIndex`: The result is achieved by recursively deep merging at
   *   each index. (not yet supported.)
   */
  ArrayStrategies: keyMirror({
    Clobber: true,
    IndexByIndex: true
  })

};

module.exports = mergeHelpers;

},{"./invariant":134,"./keyMirror":140}],146:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule mergeInto
 * @typechecks static-only
 */



var mergeHelpers = _dereq_("./mergeHelpers");

var checkMergeObjectArg = mergeHelpers.checkMergeObjectArg;
var checkMergeIntoObjectArg = mergeHelpers.checkMergeIntoObjectArg;

/**
 * Shallow merges two structures by mutating the first parameter.
 *
 * @param {object|function} one Object to be merged into.
 * @param {?object} two Optional object with properties to merge from.
 */
function mergeInto(one, two) {
  checkMergeIntoObjectArg(one);
  if (two != null) {
    checkMergeObjectArg(two);
    for (var key in two) {
      if (!two.hasOwnProperty(key)) {
        continue;
      }
      one[key] = two[key];
    }
  }
}

module.exports = mergeInto;

},{"./mergeHelpers":145}],147:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule mixInto
 */



/**
 * Simply copies properties to the prototype.
 */
var mixInto = function(constructor, methodBag) {
  var methodName;
  for (methodName in methodBag) {
    if (!methodBag.hasOwnProperty(methodName)) {
      continue;
    }
    constructor.prototype[methodName] = methodBag[methodName];
  }
};

module.exports = mixInto;

},{}],148:[function(_dereq_,module,exports){
/**
 * Copyright 2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule monitorCodeUse
 */



var invariant = _dereq_("./invariant");

/**
 * Provides open-source compatible instrumentation for monitoring certain API
 * uses before we're ready to issue a warning or refactor. It accepts an event
 * name which may only contain the characters [a-z0-9_] and an optional data
 * object with further information.
 */

function monitorCodeUse(eventName, data) {
  ("production" !== "development" ? invariant(
    eventName && !/[^a-z0-9_]/.test(eventName),
    'You must provide an eventName using only the characters [a-z0-9_]'
  ) : invariant(eventName && !/[^a-z0-9_]/.test(eventName)));
}

module.exports = monitorCodeUse;

},{"./invariant":134}],149:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule onlyChild
 */


var ReactDescriptor = _dereq_("./ReactDescriptor");

var invariant = _dereq_("./invariant");

/**
 * Returns the first child in a collection of children and verifies that there
 * is only one child in the collection. The current implementation of this
 * function assumes that a single child gets passed without a wrapper, but the
 * purpose of this helper function is to abstract away the particular structure
 * of children.
 *
 * @param {?object} children Child collection structure.
 * @return {ReactComponent} The first and only `ReactComponent` contained in the
 * structure.
 */
function onlyChild(children) {
  ("production" !== "development" ? invariant(
    ReactDescriptor.isValidDescriptor(children),
    'onlyChild must be passed a children with exactly one child.'
  ) : invariant(ReactDescriptor.isValidDescriptor(children)));
  return children;
}

module.exports = onlyChild;

},{"./ReactDescriptor":56,"./invariant":134}],150:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule performance
 * @typechecks
 */



var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

var performance;

if (ExecutionEnvironment.canUseDOM) {
  performance =
    window.performance ||
    window.msPerformance ||
    window.webkitPerformance;
}

module.exports = performance || {};

},{"./ExecutionEnvironment":22}],151:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule performanceNow
 * @typechecks
 */

var performance = _dereq_("./performance");

/**
 * Detect if we can use `window.performance.now()` and gracefully fallback to
 * `Date.now()` if it doesn't exist. We need to support Firefox < 15 for now
 * because of Facebook's testing infrastructure.
 */
if (!performance || !performance.now) {
  performance = Date;
}

var performanceNow = performance.now.bind(performance);

module.exports = performanceNow;

},{"./performance":150}],152:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule setInnerHTML
 */



var ExecutionEnvironment = _dereq_("./ExecutionEnvironment");

/**
 * Set the innerHTML property of a node, ensuring that whitespace is preserved
 * even in IE8.
 *
 * @param {DOMElement} node
 * @param {string} html
 * @internal
 */
var setInnerHTML = function(node, html) {
  node.innerHTML = html;
};

if (ExecutionEnvironment.canUseDOM) {
  // IE8: When updating a just created node with innerHTML only leading
  // whitespace is removed. When updating an existing node with innerHTML
  // whitespace in root TextNodes is also collapsed.
  // @see quirksmode.org/bugreports/archives/2004/11/innerhtml_and_t.html

  // Feature detection; only IE8 is known to behave improperly like this.
  var testElement = document.createElement('div');
  testElement.innerHTML = ' ';
  if (testElement.innerHTML === '') {
    setInnerHTML = function(node, html) {
      // Magic theory: IE8 supposedly differentiates between added and updated
      // nodes when processing innerHTML, innerHTML on updated nodes suffers
      // from worse whitespace behavior. Re-adding a node like this triggers
      // the initial and more favorable whitespace behavior.
      // TODO: What to do on a detached node?
      if (node.parentNode) {
        node.parentNode.replaceChild(node, node);
      }

      // We also implement a workaround for non-visible tags disappearing into
      // thin air on IE8, this only happens if there is no visible text
      // in-front of the non-visible tags. Piggyback on the whitespace fix
      // and simply check if any non-visible tags appear in the source.
      if (html.match(/^[ \r\n\t\f]/) ||
          html[0] === '<' && (
            html.indexOf('<noscript') !== -1 ||
            html.indexOf('<script') !== -1 ||
            html.indexOf('<style') !== -1 ||
            html.indexOf('<meta') !== -1 ||
            html.indexOf('<link') !== -1)) {
        // Recover leading whitespace by temporarily prepending any character.
        // \uFEFF has the potential advantage of being zero-width/invisible.
        node.innerHTML = '\uFEFF' + html;

        // deleteData leaves an empty `TextNode` which offsets the index of all
        // children. Definitely want to avoid this.
        var textNode = node.firstChild;
        if (textNode.data.length === 1) {
          node.removeChild(textNode);
        } else {
          textNode.deleteData(0, 1);
        }
      } else {
        node.innerHTML = html;
      }
    };
  }
}

module.exports = setInnerHTML;

},{"./ExecutionEnvironment":22}],153:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule shallowEqual
 */



/**
 * Performs equality by iterating through keys on an object and returning
 * false when any key has values which are not strictly equal between
 * objA and objB. Returns true when the values of all keys are strictly equal.
 *
 * @return {boolean}
 */
function shallowEqual(objA, objB) {
  if (objA === objB) {
    return true;
  }
  var key;
  // Test for A's keys different from B.
  for (key in objA) {
    if (objA.hasOwnProperty(key) &&
        (!objB.hasOwnProperty(key) || objA[key] !== objB[key])) {
      return false;
    }
  }
  // Test for B'a keys missing from A.
  for (key in objB) {
    if (objB.hasOwnProperty(key) && !objA.hasOwnProperty(key)) {
      return false;
    }
  }
  return true;
}

module.exports = shallowEqual;

},{}],154:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule shouldUpdateReactComponent
 * @typechecks static-only
 */



/**
 * Given a `prevDescriptor` and `nextDescriptor`, determines if the existing
 * instance should be updated as opposed to being destroyed or replaced by a new
 * instance. Both arguments are descriptors. This ensures that this logic can
 * operate on stateless trees without any backing instance.
 *
 * @param {?object} prevDescriptor
 * @param {?object} nextDescriptor
 * @return {boolean} True if the existing instance should be updated.
 * @protected
 */
function shouldUpdateReactComponent(prevDescriptor, nextDescriptor) {
  if (prevDescriptor && nextDescriptor &&
      prevDescriptor.type === nextDescriptor.type && (
        (prevDescriptor.props && prevDescriptor.props.key) ===
        (nextDescriptor.props && nextDescriptor.props.key)
      ) && prevDescriptor._owner === nextDescriptor._owner) {
    return true;
  }
  return false;
}

module.exports = shouldUpdateReactComponent;

},{}],155:[function(_dereq_,module,exports){
/**
 * Copyright 2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule toArray
 * @typechecks
 */

var invariant = _dereq_("./invariant");

/**
 * Convert array-like objects to arrays.
 *
 * This API assumes the caller knows the contents of the data type. For less
 * well defined inputs use createArrayFrom.
 *
 * @param {object|function|filelist} obj
 * @return {array}
 */
function toArray(obj) {
  var length = obj.length;

  // Some browse builtin objects can report typeof 'function' (e.g. NodeList in
  // old versions of Safari).
  ("production" !== "development" ? invariant(
    !Array.isArray(obj) &&
    (typeof obj === 'object' || typeof obj === 'function'),
    'toArray: Array-like object expected'
  ) : invariant(!Array.isArray(obj) &&
  (typeof obj === 'object' || typeof obj === 'function')));

  ("production" !== "development" ? invariant(
    typeof length === 'number',
    'toArray: Object needs a length property'
  ) : invariant(typeof length === 'number'));

  ("production" !== "development" ? invariant(
    length === 0 ||
    (length - 1) in obj,
    'toArray: Object should have keys for indices'
  ) : invariant(length === 0 ||
  (length - 1) in obj));

  // Old IE doesn't give collections access to hasOwnProperty. Assume inputs
  // without method will throw during the slice call and skip straight to the
  // fallback.
  if (obj.hasOwnProperty) {
    try {
      return Array.prototype.slice.call(obj);
    } catch (e) {
      // IE < 9 does not support Array#slice on collections objects
    }
  }

  // Fall back to copying key by key. This assumes all keys have a value,
  // so will not preserve sparsely populated inputs.
  var ret = Array(length);
  for (var ii = 0; ii < length; ii++) {
    ret[ii] = obj[ii];
  }
  return ret;
}

module.exports = toArray;

},{"./invariant":134}],156:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule traverseAllChildren
 */



var ReactInstanceHandles = _dereq_("./ReactInstanceHandles");
var ReactTextComponent = _dereq_("./ReactTextComponent");

var invariant = _dereq_("./invariant");

var SEPARATOR = ReactInstanceHandles.SEPARATOR;
var SUBSEPARATOR = ':';

/**
 * TODO: Test that:
 * 1. `mapChildren` transforms strings and numbers into `ReactTextComponent`.
 * 2. it('should fail when supplied duplicate key', function() {
 * 3. That a single child and an array with one item have the same key pattern.
 * });
 */

var userProvidedKeyEscaperLookup = {
  '=': '=0',
  '.': '=1',
  ':': '=2'
};

var userProvidedKeyEscapeRegex = /[=.:]/g;

function userProvidedKeyEscaper(match) {
  return userProvidedKeyEscaperLookup[match];
}

/**
 * Generate a key string that identifies a component within a set.
 *
 * @param {*} component A component that could contain a manual key.
 * @param {number} index Index that is used if a manual key is not provided.
 * @return {string}
 */
function getComponentKey(component, index) {
  if (component && component.props && component.props.key != null) {
    // Explicit key
    return wrapUserProvidedKey(component.props.key);
  }
  // Implicit key determined by the index in the set
  return index.toString(36);
}

/**
 * Escape a component key so that it is safe to use in a reactid.
 *
 * @param {*} key Component key to be escaped.
 * @return {string} An escaped string.
 */
function escapeUserProvidedKey(text) {
  return ('' + text).replace(
    userProvidedKeyEscapeRegex,
    userProvidedKeyEscaper
  );
}

/**
 * Wrap a `key` value explicitly provided by the user to distinguish it from
 * implicitly-generated keys generated by a component's index in its parent.
 *
 * @param {string} key Value of a user-provided `key` attribute
 * @return {string}
 */
function wrapUserProvidedKey(key) {
  return '$' + escapeUserProvidedKey(key);
}

/**
 * @param {?*} children Children tree container.
 * @param {!string} nameSoFar Name of the key path so far.
 * @param {!number} indexSoFar Number of children encountered until this point.
 * @param {!function} callback Callback to invoke with each child found.
 * @param {?*} traverseContext Used to pass information throughout the traversal
 * process.
 * @return {!number} The number of children in this subtree.
 */
var traverseAllChildrenImpl =
  function(children, nameSoFar, indexSoFar, callback, traverseContext) {
    var subtreeCount = 0;  // Count of children found in the current subtree.
    if (Array.isArray(children)) {
      for (var i = 0; i < children.length; i++) {
        var child = children[i];
        var nextName = (
          nameSoFar +
          (nameSoFar ? SUBSEPARATOR : SEPARATOR) +
          getComponentKey(child, i)
        );
        var nextIndex = indexSoFar + subtreeCount;
        subtreeCount += traverseAllChildrenImpl(
          child,
          nextName,
          nextIndex,
          callback,
          traverseContext
        );
      }
    } else {
      var type = typeof children;
      var isOnlyChild = nameSoFar === '';
      // If it's the only child, treat the name as if it was wrapped in an array
      // so that it's consistent if the number of children grows
      var storageName =
        isOnlyChild ? SEPARATOR + getComponentKey(children, 0) : nameSoFar;
      if (children == null || type === 'boolean') {
        // All of the above are perceived as null.
        callback(traverseContext, null, storageName, indexSoFar);
        subtreeCount = 1;
      } else if (children.type && children.type.prototype &&
                 children.type.prototype.mountComponentIntoNode) {
        callback(traverseContext, children, storageName, indexSoFar);
        subtreeCount = 1;
      } else {
        if (type === 'object') {
          ("production" !== "development" ? invariant(
            !children || children.nodeType !== 1,
            'traverseAllChildren(...): Encountered an invalid child; DOM ' +
            'elements are not valid children of React components.'
          ) : invariant(!children || children.nodeType !== 1));
          for (var key in children) {
            if (children.hasOwnProperty(key)) {
              subtreeCount += traverseAllChildrenImpl(
                children[key],
                (
                  nameSoFar + (nameSoFar ? SUBSEPARATOR : SEPARATOR) +
                  wrapUserProvidedKey(key) + SUBSEPARATOR +
                  getComponentKey(children[key], 0)
                ),
                indexSoFar + subtreeCount,
                callback,
                traverseContext
              );
            }
          }
        } else if (type === 'string') {
          var normalizedText = ReactTextComponent(children);
          callback(traverseContext, normalizedText, storageName, indexSoFar);
          subtreeCount += 1;
        } else if (type === 'number') {
          var normalizedNumber = ReactTextComponent('' + children);
          callback(traverseContext, normalizedNumber, storageName, indexSoFar);
          subtreeCount += 1;
        }
      }
    }
    return subtreeCount;
  };

/**
 * Traverses children that are typically specified as `props.children`, but
 * might also be specified through attributes:
 *
 * - `traverseAllChildren(this.props.children, ...)`
 * - `traverseAllChildren(this.props.leftPanelChildren, ...)`
 *
 * The `traverseContext` is an optional argument that is passed through the
 * entire traversal. It can be used to store accumulations or anything else that
 * the callback might find relevant.
 *
 * @param {?*} children Children tree object.
 * @param {!function} callback To invoke upon traversing each child.
 * @param {?*} traverseContext Context for traversal.
 * @return {!number} The number of children in this subtree.
 */
function traverseAllChildren(children, callback, traverseContext) {
  if (children == null) {
    return 0;
  }

  return traverseAllChildrenImpl(children, '', 0, callback, traverseContext);
}

module.exports = traverseAllChildren;

},{"./ReactInstanceHandles":64,"./ReactTextComponent":83,"./invariant":134}],157:[function(_dereq_,module,exports){
/**
 * Copyright 2013-2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule update
 */



var copyProperties = _dereq_("./copyProperties");
var keyOf = _dereq_("./keyOf");
var invariant = _dereq_("./invariant");

function shallowCopy(x) {
  if (Array.isArray(x)) {
    return x.concat();
  } else if (x && typeof x === 'object') {
    return copyProperties(new x.constructor(), x);
  } else {
    return x;
  }
}

var COMMAND_PUSH = keyOf({$push: null});
var COMMAND_UNSHIFT = keyOf({$unshift: null});
var COMMAND_SPLICE = keyOf({$splice: null});
var COMMAND_SET = keyOf({$set: null});
var COMMAND_MERGE = keyOf({$merge: null});
var COMMAND_APPLY = keyOf({$apply: null});

var ALL_COMMANDS_LIST = [
  COMMAND_PUSH,
  COMMAND_UNSHIFT,
  COMMAND_SPLICE,
  COMMAND_SET,
  COMMAND_MERGE,
  COMMAND_APPLY
];

var ALL_COMMANDS_SET = {};

ALL_COMMANDS_LIST.forEach(function(command) {
  ALL_COMMANDS_SET[command] = true;
});

function invariantArrayCase(value, spec, command) {
  ("production" !== "development" ? invariant(
    Array.isArray(value),
    'update(): expected target of %s to be an array; got %s.',
    command,
    value
  ) : invariant(Array.isArray(value)));
  var specValue = spec[command];
  ("production" !== "development" ? invariant(
    Array.isArray(specValue),
    'update(): expected spec of %s to be an array; got %s. ' +
    'Did you forget to wrap your parameter in an array?',
    command,
    specValue
  ) : invariant(Array.isArray(specValue)));
}

function update(value, spec) {
  ("production" !== "development" ? invariant(
    typeof spec === 'object',
    'update(): You provided a key path to update() that did not contain one ' +
    'of %s. Did you forget to include {%s: ...}?',
    ALL_COMMANDS_LIST.join(', '),
    COMMAND_SET
  ) : invariant(typeof spec === 'object'));

  if (spec.hasOwnProperty(COMMAND_SET)) {
    ("production" !== "development" ? invariant(
      Object.keys(spec).length === 1,
      'Cannot have more than one key in an object with %s',
      COMMAND_SET
    ) : invariant(Object.keys(spec).length === 1));

    return spec[COMMAND_SET];
  }

  var nextValue = shallowCopy(value);

  if (spec.hasOwnProperty(COMMAND_MERGE)) {
    var mergeObj = spec[COMMAND_MERGE];
    ("production" !== "development" ? invariant(
      mergeObj && typeof mergeObj === 'object',
      'update(): %s expects a spec of type \'object\'; got %s',
      COMMAND_MERGE,
      mergeObj
    ) : invariant(mergeObj && typeof mergeObj === 'object'));
    ("production" !== "development" ? invariant(
      nextValue && typeof nextValue === 'object',
      'update(): %s expects a target of type \'object\'; got %s',
      COMMAND_MERGE,
      nextValue
    ) : invariant(nextValue && typeof nextValue === 'object'));
    copyProperties(nextValue, spec[COMMAND_MERGE]);
  }

  if (spec.hasOwnProperty(COMMAND_PUSH)) {
    invariantArrayCase(value, spec, COMMAND_PUSH);
    spec[COMMAND_PUSH].forEach(function(item) {
      nextValue.push(item);
    });
  }

  if (spec.hasOwnProperty(COMMAND_UNSHIFT)) {
    invariantArrayCase(value, spec, COMMAND_UNSHIFT);
    spec[COMMAND_UNSHIFT].forEach(function(item) {
      nextValue.unshift(item);
    });
  }

  if (spec.hasOwnProperty(COMMAND_SPLICE)) {
    ("production" !== "development" ? invariant(
      Array.isArray(value),
      'Expected %s target to be an array; got %s',
      COMMAND_SPLICE,
      value
    ) : invariant(Array.isArray(value)));
    ("production" !== "development" ? invariant(
      Array.isArray(spec[COMMAND_SPLICE]),
      'update(): expected spec of %s to be an array of arrays; got %s. ' +
      'Did you forget to wrap your parameters in an array?',
      COMMAND_SPLICE,
      spec[COMMAND_SPLICE]
    ) : invariant(Array.isArray(spec[COMMAND_SPLICE])));
    spec[COMMAND_SPLICE].forEach(function(args) {
      ("production" !== "development" ? invariant(
        Array.isArray(args),
        'update(): expected spec of %s to be an array of arrays; got %s. ' +
        'Did you forget to wrap your parameters in an array?',
        COMMAND_SPLICE,
        spec[COMMAND_SPLICE]
      ) : invariant(Array.isArray(args)));
      nextValue.splice.apply(nextValue, args);
    });
  }

  if (spec.hasOwnProperty(COMMAND_APPLY)) {
    ("production" !== "development" ? invariant(
      typeof spec[COMMAND_APPLY] === 'function',
      'update(): expected spec of %s to be a function; got %s.',
      COMMAND_APPLY,
      spec[COMMAND_APPLY]
    ) : invariant(typeof spec[COMMAND_APPLY] === 'function'));
    nextValue = spec[COMMAND_APPLY](nextValue);
  }

  for (var k in spec) {
    if (!(ALL_COMMANDS_SET.hasOwnProperty(k) && ALL_COMMANDS_SET[k])) {
      nextValue[k] = update(value[k], spec[k]);
    }
  }

  return nextValue;
}

module.exports = update;

},{"./copyProperties":110,"./invariant":134,"./keyOf":141}],158:[function(_dereq_,module,exports){
/**
 * Copyright 2014 Facebook, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @providesModule warning
 */



var emptyFunction = _dereq_("./emptyFunction");

/**
 * Similar to invariant but only logs a warning if the condition is not met.
 * This can be used to log issues in development environments in critical
 * paths. Removing the logging code for production environments will keep the
 * same logic and follow the same code paths.
 */

var warning = emptyFunction;

if ("production" !== "development") {
  warning = function(condition, format ) {var args=Array.prototype.slice.call(arguments,2);
    if (format === undefined) {
      throw new Error(
        '`warning(condition, format, ...args)` requires a warning ' +
        'message argument'
      );
    }

    if (!condition) {
      var argIndex = 0;
      console.warn('Warning: ' + format.replace(/%s/g, function()  {return args[argIndex++];}));
    }
  };
}

module.exports = warning;

},{"./emptyFunction":116}]},{},[88])
(88)
});
(function (root, factory) {
  if (typeof exports === 'object') {
    module.exports = factory(require('react'));
  }
  else if (typeof define === 'function' && define.amd) {
    define('react-coffeescript-glue',['react'], factory);
  }
  else {
    var globalAlias = 'ReactCoffeescriptGlue';
    var namespace = globalAlias.split('.');
    var parent = root;
    for ( var i = 0; i < namespace.length-1; i++ ) {
      if ( parent[namespace[i]] === undefined ) parent[namespace[i]] = {};
      parent = parent[namespace[i]];
    }
    parent[namespace[namespace.length-1]] = factory(root['React']);
  }
}(this, function(React) {
  function _requireDep(name) {
    return {'react': React}[name];
  }

  var _bundleExports = (function() {
  var define_tag, method, tag, _ref,
    __slice = [].slice;

  define_tag = function(tag) {
    if (!({}.hasOwnProperty.call(React.DOM, tag) && tag !== 'injection')) {
      return;
    }
    return window['_' + tag] = function() {
      var attr, attrs, children, key, options, value, _i, _len, _ref, _ref1;
      attrs = arguments[0], children = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      if (Array.isArray(attrs)) {
        options = {
          className: ''
        };
        for (_i = 0, _len = attrs.length; _i < _len; _i++) {
          attr = attrs[_i];
          if (typeof attr === 'string') {
            options.className += ' ' + attr;
          } else {
            for (key in attr) {
              value = attr[key];
              options[key] = value;
            }
          }
        }
        return (_ref = React.DOM)[tag].apply(_ref, [options].concat(__slice.call(children)));
      } else {
        return (_ref1 = React.DOM)[tag].apply(_ref1, [attrs].concat(__slice.call(children)));
      }
    };
  };

  _ref = React.DOM;
  for (tag in _ref) {
    method = _ref[tag];
    define_tag(tag);
  }

}).call(this);


  return _bundleExports;
}));

(function (root, factory) {
  if (typeof exports === 'object') {
    module.exports = factory(require('react'), require('react-coffeescript-glue'));
  }
  else if (typeof define === 'function' && define.amd) {
    define('versal-react-sidebar',['react', 'react-coffeescript-glue'], factory);
  }
  else {
    var globalAlias = 'SidebarCourseComponent';
    var namespace = globalAlias.split('.');
    var parent = root;
    for ( var i = 0; i < namespace.length-1; i++ ) {
      if ( parent[namespace[i]] === undefined ) parent[namespace[i]] = {};
      parent = parent[namespace[i]];
    }
    parent[namespace[namespace.length-1]] = factory(root['React'], root['ReactCoffeescriptGlue']);
  }
}(this, function(React, ReactCoffeescriptGlue) {
  function _requireDep(name) {
    return {'react': React, 'react-coffeescript-glue': ReactCoffeescriptGlue}[name];
  }

  var _bundleExports = (function() {
  var PlaceholderTextComponent, RenderInBodyAdapter, SidebarCourseComponent, SidebarCourseTitleComponent, SidebarDragImageComponent, SidebarDropdownComponent, SidebarLessonComponent, SidebarSectionComponent, TimeSinceComponent, dragXOffset;

  dragXOffset = 10;

  PlaceholderTextComponent = React.createClass({
    render: function() {
      var text;
      text = this.props.children.trim();
      if (text) {
        return _span([], text);
      } else {
        return _span(['sidebar-placeholder-text'], this.props.placeholder);
      }
    }
  });

  SidebarSectionComponent = React.createClass({
    _onClick: function(e) {
      if (!this.props.isAccessible) {
        return;
      }
      this.props.onClick();
      return e.stopPropagation();
    },
    render: function() {
      return _div([
        'sidebar-section-title', this.props.hasCompletedSection || this.props.isCurrentSection ? 'sidebar-toc-progressed' : void 0, this.props.isCurrentSection ? 'sidebar-toc-active' : void 0, {
          onClick: this._onClick
        }
      ], this.props.title);
    }
  });

  SidebarDragImageComponent = React.createClass({
    _dragYOffset: function() {
      if (this.isMounted()) {
        return this.getDOMNode().offsetHeight / 2;
      } else {
        return 0;
      }
    },
    render: function() {
      return _div([
        'sidebar-lesson sidebar-lesson-drag-image', {
          style: {
            left: this.props.x - dragXOffset,
            top: this.props.y - this._dragYOffset(),
            width: this.props.width
          }
        }
      ], _div(['sidebar-lesson-title'], _div(['sidebar-lesson-title-readonly'], PlaceholderTextComponent({
        placeholder: this.props.placeholder
      }, this.props.title))));
    }
  });

  RenderInBodyAdapter = React.createClass({
    componentWillMount: function() {
      this._elementInBody = document.createElement('div');
      return document.body.appendChild(this._elementInBody);
    },
    componentWillUnmount: function() {
      React.unmountComponentAtNode(this._elementInBody);
      return document.body.removeChild(this._elementInBody);
    },
    render: function() {
      return _span();
    },
    componentDidMount: function() {
      return this._renderElementInBody();
    },
    componentDidUpdate: function() {
      return this._renderElementInBody();
    },
    _renderElementInBody: function() {
      return React.renderComponent(this.props.children, this._elementInBody);
    }
  });

  SidebarLessonComponent = React.createClass({
    _onClick: function(e) {
      if (!this.props.isAccessible) {
        return;
      }
      this.props.onClick();
      return e.stopPropagation();
    },
    _renderSections: function() {
      return this.props.gadgets.map((function(_this) {
        return function(gadget, gadgetIndex) {
          var trimmedTitle;
          if (gadget.type !== _this.props.sectionGadgetType) {
            return;
          }
          trimmedTitle = (gadget.config.content || '').trim();
          if (trimmedTitle === '') {
            return;
          }
          return SidebarSectionComponent({
            key: gadget.id,
            title: trimmedTitle,
            isAccessible: _this.props.isAccessible,
            hasCompletedSection: _this.props.hasCompletedLesson || (_this.props.isCurrentLesson && gadgetIndex <= _this.props.currentGadgetIndex),
            isCurrentSection: _this.props.isCurrentLesson && gadgetIndex === _this.props.currentGadgetIndex,
            onClick: function() {
              return _this.props.onClickSection(gadgetIndex);
            }
          });
        };
      })(this));
    },
    getInitialState: function() {
      return {
        editing: false,
        dragImageContainer: null,
        customDragImageX: null,
        customDragImageY: null
      };
    },
    _onDragEnter: function(e) {
      e.preventDefault();
      return e.dataTransfer.dropEffect = 'move';
    },
    _onDragOver: function(e) {
      var append, height, relY;
      e.preventDefault();
      relY = e.clientY - this.getDOMNode().getBoundingClientRect().top;
      height = this.getDOMNode().offsetHeight / 2;
      append = relY > height;
      return this.props.onDragMove(append);
    },
    _onDrag: function(e) {
      return this.setState({
        customDragImageX: e.clientX,
        customDragImageY: e.clientY
      });
    },
    _onDragEnd: function() {
      return this.setState({
        renderCustomDragImage: false,
        customDragImageX: null,
        customDragImageY: null
      });
    },
    _onDrop: function(e) {
      return e.preventDefault();
    },
    _dragHandleOnDragStart: function(e) {
      var dragHandleY;
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('Text', this.props.title);
      if (e.dataTransfer.setDragImage) {
        dragHandleY = this.refs.title.getDOMNode().offsetHeight / 2;
        e.dataTransfer.setDragImage(this.getDOMNode(), dragXOffset, dragHandleY);
        return setTimeout(this.props.onDragStart, 0);
      } else {
        this.props.onDragStart();
        return this.setState({
          renderCustomDragImage: true
        });
      }
    },
    _dragHandleOnDragEnd: function() {
      this.props.onDragEnd();
      this.props.onHoverStart();
      return setTimeout(((function(_this) {
        return function() {
          return _this.props.onHoverStart();
        };
      })(this)), 50);
    },
    render: function() {
      var lessonPlaceholder, _ref;
      lessonPlaceholder = 'Untitled lesson';
      return _div([
        'sidebar-lesson', !this.props.isAccessible ? 'sidebar-lesson-disabled' : void 0, this.state.editing ? 'sidebar-lesson-editing' : void 0, this.props.editable ? 'sidebar-lesson-editable' : void 0, this.props.hovered ? 'sidebar-lesson-hovered' : void 0, this.props.dragging ? 'sidebar-lesson-dragging' : void 0, this.props.hasCompletedLesson || this.props.isCurrentLesson ? 'sidebar-toc-progressed' : void 0, this.props.isCurrentLesson ? 'sidebar-toc-active' : void 0, {
          onClick: this._onClick,
          onDragEnter: this._onDragEnter,
          onDragOver: this._onDragOver,
          onDrag: this._onDrag,
          onDragEnd: this._onDragEnd,
          onDrop: this._onDrop,
          onMouseEnter: this.props.onHoverStart,
          onMouseMove: this.props.onHoverStart,
          onMouseLeave: this.props.onHoverEnd
        }
      ], this.props.editable ? _div([], _div([
        'sidebar-lesson-drag-handle', {
          draggable: true,
          onDragStart: this._dragHandleOnDragStart,
          onDragEnd: this._dragHandleOnDragEnd
        }
      ], _i(['icon-reorder'])), _div([
        'sidebar-lesson-delete-button', {
          onClick: function(e) {
            return e.stopPropagation();
          },
          onMouseDown: (function(_this) {
            return function(e) {
              if (confirm('Are you sure you want to delete this lesson?')) {
                return _this.props.onDelete();
              }
            };
          })(this)
        }
      ], _i(['icon-remove'])), this.state.editing ? _div([
        'sidebar-lesson-edit-button', {
          key: 'edit-button-editing'
        }
      ], _i(['icon-pencil'])) : _div([
        'sidebar-lesson-edit-button', {
          key: 'edit-button-not-editing',
          onClick: (function(_this) {
            return function(e) {
              e.stopPropagation();
              return _this.setState({
                editing: !_this.state.editing
              });
            };
          })(this)
        }
      ], _i(['icon-pencil']))) : void 0, _div([
        'sidebar-lesson-title', {
          ref: 'title'
        }
      ], this.state.editing ? _input([
        'sidebar-lesson-title-input', {
          value: this.props.title,
          ref: 'lessonTitleInput',
          placeholder: lessonPlaceholder,
          onClick: (function(_this) {
            return function(e) {
              return e.stopPropagation();
            };
          })(this),
          onBlur: (function(_this) {
            return function() {
              return _this.setState({
                editing: false
              });
            };
          })(this),
          onKeyDown: (function(_this) {
            return function(e) {
              var _ref;
              if ((_ref = e.key) === 'Enter' || _ref === 'Escape') {
                return _this.setState({
                  editing: false
                });
              }
            };
          })(this),
          onChange: (function(_this) {
            return function(e) {
              return _this.props.onChangeTitle(e.target.value);
            };
          })(this)
        }
      ]) : _div(['sidebar-lesson-title-readonly'], PlaceholderTextComponent({
        placeholder: lessonPlaceholder
      }, this.props.title))), _div([], this._renderSections()), _i([
        'sidebar-lesson-lock icon-lock', {
          title: 'This lesson is locked by one or more quizzes'
        }
      ]), this.state.renderCustomDragImage ? RenderInBodyAdapter({}, SidebarDragImageComponent({
        title: this.props.title,
        x: this.state.customDragImageX,
        y: this.state.customDragImageY,
        width: (_ref = this.getDOMNode()) != null ? _ref.offsetWidth : void 0,
        placeholder: lessonPlaceholder
      })) : void 0);
    },
    componentDidMount: function() {
      return this._afterRender(false);
    },
    componentDidUpdate: function(prevProps, prevState) {
      return this._afterRender(prevProps.isCurrentLesson);
    },
    _afterRender: function(prevIsCurrentLesson) {
      var scrollContainer, _ref;
      if (!this.getDOMNode().offsetParent) {
        return console.warn('Invariant violation: SidebarLessonComponent has no offsetParent, probably not attached to the DOM yet');
      }
      if (!this.getDOMNode().offsetParent.className.match('sidebar-body')) {
        return console.warn('Invariant violation: SidebarLessonComponent offsetParent is not the sidebar body!');
      }
      if (this.props.isCurrentLesson && !prevIsCurrentLesson) {
        scrollContainer = this.getDOMNode().offsetParent;
        if (!((scrollContainer.scrollTop <= (_ref = this.getDOMNode().offsetTop) && _ref <= scrollContainer.scrollTop + scrollContainer.offsetHeight))) {
          scrollContainer.scrollTop = this.getDOMNode().offsetTop - scrollContainer.offsetHeight / 2;
        }
      }
      if (this.state.editing) {
        return this.refs.lessonTitleInput.getDOMNode().focus();
      }
    }
  });

  SidebarCourseTitleComponent = React.createClass({
    getInitialState: function() {
      return {
        editing: false
      };
    },
    render: function() {
      var coursePlaceholder;
      coursePlaceholder = 'Untitled course';
      return _div(['sidebar-course-title'], this.state.editing ? _input([
        'sidebar-course-title-input', {
          value: this.props.title,
          ref: 'input',
          placeholder: coursePlaceholder,
          onBlur: (function(_this) {
            return function() {
              return _this.setState({
                editing: false
              });
            };
          })(this),
          onKeyDown: (function(_this) {
            return function(e) {
              var _ref;
              if ((_ref = e.key) === 'Enter' || _ref === 'Escape') {
                return _this.setState({
                  editing: false
                });
              }
            };
          })(this),
          onChange: (function(_this) {
            return function(e) {
              return _this.props.onChange(e.target.value);
            };
          })(this)
        }
      ]) : _div([
        {
          onClick: (function(_this) {
            return function() {
              return _this.props.onClick();
            };
          })(this)
        }
      ], PlaceholderTextComponent({
        placeholder: coursePlaceholder
      }, this.props.title)), this.props.editable && !this.state.editing ? _i([
        'sidebar-course-title-edit-icon icon-pencil', {
          onClick: (function(_this) {
            return function() {
              return _this.setState({
                editing: true
              });
            };
          })(this)
        }
      ]) : void 0);
    },
    componentDidMount: function() {
      return this._afterRender();
    },
    componentDidUpdate: function(prevProps, prevState) {
      return this._afterRender();
    },
    _afterRender: function() {
      if (this.state.editing) {
        return this.refs.input.getDOMNode().focus();
      }
    }
  });

  SidebarDropdownComponent = React.createClass({
    getInitialState: function() {
      return {
        opened: false
      };
    },
    _onDocumentClick: function(e) {
      if (this.getDOMNode().contains(e.target)) {
        return;
      }
      return this.setState({
        opened: false
      });
    },
    componentDidMount: function() {
      return document.addEventListener('click', this._onDocumentClick, true);
    },
    componentWillUnmount: function() {
      return document.removeEventListener('click', this._onDocumentClick, true);
    },
    render: function() {
      return _div([], _div([
        'sidebar-course-title-options-toggle', {
          onClick: (function(_this) {
            return function() {
              return _this.setState({
                opened: !_this.state.opened
              });
            };
          })(this)
        }
      ], this.state.opened ? _i(['icon-caret-up']) : _i(['icon-caret-down'])), this.state.opened ? _div(['sidebar-course-title-options-dropdown spec-sidebar-course-title-options-dropdown'], _div(['sidebar-course-title-options-dropdown-list'], this.props.children)) : void 0);
    }
  });

  TimeSinceComponent = React.createClass({
    _timeSince: function(date) {
      var diff, label, max, min, unit, unitCount, _i, _len, _ref, _ref1;
      diff = (+(new Date)) - date;
      if (diff <= 30 * 1000) {
        label = 'seconds';
      } else if ((30 * 1000 < diff && diff <= 60 * 1000)) {
        label = 'less than a minute';
      } else {
        _ref = [['minute', 60 * 1000, 60 * 60 * 1000], ['hour', 60 * 60 * 1000, 24 * 60 * 60 * 1000], ['day', 24 * 60 * 60 * 1000, Infinity]];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          _ref1 = _ref[_i], unit = _ref1[0], min = _ref1[1], max = _ref1[2];
          if ((min < diff && diff <= max)) {
            unitCount = Math.floor(diff / min);
            label = "" + unitCount + " " + unit;
            if (unitCount > 1) {
              label += 's';
            }
          }
        }
      }
      return label;
    },
    componentDidMount: function() {
      return this._interval = setInterval(((function(_this) {
        return function() {
          return _this.forceUpdate();
        };
      })(this)), 10 * 1000);
    },
    componentWillUnmount: function() {
      return clearInterval(this._interval);
    },
    render: function() {
      return _span([], this._timeSince(this.props.date));
    }
  });

  return SidebarCourseComponent = React.createClass({
    getInitialState: function() {
      return {
        dragFromIndex: null,
        dragToIndex: null,
        hoveredId: null
      };
    },
    _addDropTargetToLessons: function(lessonComponents) {
      var newLessonComponents;
      newLessonComponents = lessonComponents.slice();
      if (this.state.dragToIndex != null) {
        newLessonComponents.splice(this.state.dragToIndex, 0, _div(['sidebar-lesson-drop-target']));
      }
      return newLessonComponents;
    },
    _draggingSomeLesson: function() {
      return this.state.dragFromIndex != null;
    },
    _renderLesson: function(lesson, lessonIndex) {
      var hasCompletedLesson, isCurrentLesson;
      hasCompletedLesson = lessonIndex < this.props.currentLessonIndex;
      isCurrentLesson = lessonIndex === this.props.currentLessonIndex;
      return SidebarLessonComponent({
        key: lesson.id,
        title: lesson.title,
        isAccessible: lesson.isAccessible,
        gadgets: lesson.gadgets,
        hovered: this.state.hoveredId === lesson.id,
        sectionGadgetType: this.props.sectionGadgetType,
        hasCompletedLesson: hasCompletedLesson && !this._draggingSomeLesson(),
        isCurrentLesson: isCurrentLesson && !this._draggingSomeLesson(),
        dragging: lessonIndex === this.state.dragFromIndex,
        currentGadgetIndex: this.props.currentGadgetIndex,
        editable: this.props.editable,
        onClick: (function(_this) {
          return function() {
            return _this.props.onClickLesson(lessonIndex);
          };
        })(this),
        onClickSection: (function(_this) {
          return function(gadgetIndex) {
            return _this.props.onClickSection(lessonIndex, gadgetIndex);
          };
        })(this),
        onChangeTitle: (function(_this) {
          return function(title) {
            return _this.props.onChangeLessonTitle(lessonIndex, title);
          };
        })(this),
        onDelete: (function(_this) {
          return function() {
            return _this.props.onLessonDelete(lessonIndex);
          };
        })(this),
        onDragStart: (function(_this) {
          return function() {
            return _this.setState({
              dragFromIndex: lessonIndex
            });
          };
        })(this),
        onDragMove: (function(_this) {
          return function(append) {
            return _this.setState({
              dragToIndex: lessonIndex + (append ? 1 : 0)
            });
          };
        })(this),
        onDragEnd: (function(_this) {
          return function() {
            var dragFromId, dragToIndex;
            dragFromId = _this.props.course.lessons[_this.state.dragFromIndex].id;
            dragToIndex = _this.state.dragToIndex;
            if (dragToIndex > _this.state.dragFromIndex) {
              dragToIndex--;
            }
            _this.props.onLessonMove(dragFromId, dragToIndex);
            return _this.setState({
              dragFromIndex: null,
              dragToIndex: null
            });
          };
        })(this),
        onHoverStart: (function(_this) {
          return function() {
            return _this.setState({
              hoveredId: lesson.id
            });
          };
        })(this),
        onHoverEnd: (function(_this) {
          return function() {
            return _this.setState({
              hoveredId: null
            });
          };
        })(this)
      });
    },
    _addLesson: function(e) {
      e.preventDefault();
      return this.props.onLessonAdd();
    },
    render: function() {
      return _div(['sidebar'], _div(['sidebar-course-title-container'], SidebarCourseTitleComponent({
        title: this.props.course.title,
        onClick: this.props.onClickCourseTitle,
        onChange: this.props.onChangeCourseTitle,
        editable: this.props.editable
      }), this.props.editable ? SidebarDropdownComponent({}, _div([], _b([], 'view as learner')), _div([], _a([
        {
          target: '_blank',
          href: this.props.siteBaseUrl + '/c/' + this.props.course.id + '/learn'
        }
      ], 'this revision')), this.props.course.isPublished ? _div([], _a([
        {
          target: '_blank',
          href: this.props.siteBaseUrl + '/c/' + this.props.course.id + '/learn?revision=true'
        }
      ], 'published course')) : void 0) : void 0), _div([
        'sidebar-body', 'sidebar-scrollbar', this._draggingSomeLesson() ? 'sidebar-dragging-some-lesson' : void 0, {
          style: {
            position: 'relative'
          }
        }
      ], _div([], this._addDropTargetToLessons(this.props.course.lessons.map(this._renderLesson))), this.props.editable ? _div(['sidebar-lesson'], _a([
        'sidebar-add-lesson', {
          onClick: this._addLesson
        }
      ], 'Add a lesson')) : void 0), this.props.editable ? _div(['sidebar-footer'], _div(['sidebar-last-saved'], TimeSinceComponent({
        date: this.props.lastSavedDateTime
      })), this.props.contributorsComponent ? _div(['sidebar-contributors'], this.props.contributorsComponent) : void 0) : void 0);
    },
    componentDidMount: function() {
      if (!this.getDOMNode().offsetParent) {
        return console.warn('Invariant violation: SidebarCourseComponent has no offsetParent, probably not attached to the DOM yet');
      }
    }
  });

}).call(this);


  return _bundleExports;
}));

(function(root, factory) {
    if (typeof exports === 'object') {
        // CommonJS
        module.exports = factory(require('backbone'), require('react'), require('underscore'));
    } else if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define('react-backbone',['backbone', 'react', 'underscore'], factory);
    } else {
        // Browser globals
        root.amdWeb = factory(root.Backbone, root.React, root._);
    }
}(this, function(Backbone, React, _) {

    

    var collectionBehavior = {
        changeOptions: 'add remove reset sort',
        updateScheduler: function(func) { return _.debounce(func, 0); }
    };

    var modelBehavior = {
        changeOptions: 'change',
        //note: if we debounce models too we can no longer use model attributes
        //as properties to react controlled components due to https://github.com/facebook/react/issues/955
        updateScheduler: _.identity
    };

    var subscribe = function(component, modelOrCollection, customChangeOptions) {
        if (!modelOrCollection) {
            return;
        }

        var behavior = modelOrCollection instanceof Backbone.Collection ? collectionBehavior : modelBehavior;

        var triggerUpdate = behavior.updateScheduler(function() {
            if (component.isMounted()) {
                (component.onModelChange || component.forceUpdate).call(component);
            }
        });

        var changeOptions = customChangeOptions || component.changeOptions || behavior.changeOptions;
        modelOrCollection.on(changeOptions, triggerUpdate, component);
    };

    var unsubscribe = function(component, modelOrCollection) {
        if (!modelOrCollection) {
            return;
        }

        modelOrCollection.off(null, null, component);
    };

    React.BackboneMixin = function(optionsOrPropName, customChangeOptions) {
      var propName, modelOrCollection;
      if (typeof optionsOrPropName === "object") {
          customChangeOptions = optionsOrPropName.renderOn;
          propName = optionsOrPropName.propName;
          modelOrCollection = optionsOrPropName.modelOrCollection;
      } else {
          propName = optionsOrPropName;
      }

      if (!modelOrCollection) {
          modelOrCollection = function(props) {
            return props[propName];
          }
      }

      return {
        componentDidMount: function() {
            // Whenever there may be a change in the Backbone data, trigger a reconcile.
            subscribe(this, modelOrCollection(this.props), customChangeOptions);
        },

        componentWillReceiveProps: function(nextProps) {
            if (modelOrCollection(this.props) === modelOrCollection(nextProps)) {
                return;
            }

            unsubscribe(this, modelOrCollection(this.props));
            subscribe(this, modelOrCollection(nextProps), customChangeOptions);

            if (typeof this.componentWillChangeModel === 'function') {
                this.componentWillChangeModel();
            }
        },

        componentDidUpdate: function(prevProps, prevState) {
            if (modelOrCollection(this.props) === modelOrCollection(prevProps)) {
                return;
            }

            if (typeof this.componentDidChangeModel === 'function') {
                this.componentDidChangeModel();
            }
        },

        componentWillUnmount: function() {
            // Ensure that we clean up any dangling references when the component is destroyed.
            unsubscribe(this, modelOrCollection(this.props));
        }
      };
    };

    React.BackboneViewMixin = {
        getModel: function() {
            return this.props.model;
        },

        model: function() {
            return this.getModel();
        },

        getCollection: function() {
            return this.props.collection;
        },

        collection: function() {
            return this.getCollection();
        },

        el: function() {
            return this.isMounted() && this.getDOMNode();
        }
    };

    React.createBackboneClass = function(spec) {
        var currentMixins = spec.mixins || [];

        spec.mixins = currentMixins.concat([
            React.BackboneMixin('model'),
            React.BackboneMixin('collection'),
            React.BackboneViewMixin
        ]);

        return React.createClass(spec);
    };

    return React;
}));

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/sidebar/author',['cdn.marionette', 'app/mediator', 'state/position', 'libs/analytics', 'versal-react-sidebar', 'models/settings', 'react', 'react-backbone', 'react-coffeescript-glue', 'plugins/backbone.move'], function(Marionette, mediator, currentPosition, analytics, SidebarCourseComponent, settings, React) {
    var AuthorSidebarView, SidebarAuthorCourseControllerComponent, SidebarContributorsComponent;
    SidebarContributorsComponent = React.createClass({
      componentDidMount: function() {
        this._contribRegion = new Marionette.Region({
          el: this.getDOMNode()
        });
        return this.props.mediator.on('plugin:populate:contributorsRegion', this._onPopulateContributors);
      },
      componentWillUnmount: function() {
        this.props.mediator.off('plugin:populate:contributorsRegion', this._onPopulateContributors);
        return this._contribRegion.close();
      },
      render: function() {
        return _div([]);
      },
      _onPopulateContributors: function(view) {
        return this._contribRegion.show(view);
      }
    });
    SidebarAuthorCourseControllerComponent = React.createClass({
      mixins: [React.BackboneMixin('course'), React.BackboneMixin('currentPosition')],
      getInitialState: function() {
        return {
          lastSavedTime: +(new Date)
        };
      },
      componentDidMount: function() {
        this.props.course.lessons.on('add remove reset sort change', (function() {
          return this.forceUpdate();
        }), this);
        $(document).on('ajaxComplete', this._onAjaxComplete);
        this.props.mediator.trigger('player:authorSideBar:ready');
        return this._ensureLesson();
      },
      componentWillReceiveProps: function(nextProps) {
        if (this.props.course.lessons !== nextProps.course.lessons) {
          this.props.course.lessons.off(null, null, this);
          return nextProps.course.lessons.on('add remove reset sort change', (function() {
            return this.forceUpdate();
          }), this);
        }
      },
      componentWillUnmount: function() {
        this.props.course.lessons.off(null, null, this);
        return $(document).off('ajaxComplete', this._onAjaxComplete);
      },
      _onAjaxComplete: function() {
        return this.setState({
          lastSavedTime: +(new Date)
        });
      },
      _ensureLesson: function(callback) {
        if (callback == null) {
          callback = function() {};
        }
        if (this.props.course.lessons.length === 0) {
          return this.props.course.lessons.create({}, {
            success: callback
          });
        } else {
          return callback();
        }
      },
      render: function() {
        var courseJSON, currentGadget, currentGadgetIndex, currentLesson, currentLessonIndex, lesson, _i, _len, _ref;
        currentLesson = this.props.course.lessons.get(this.props.currentPosition.get('lessonCid'));
        if (currentLesson) {
          currentLessonIndex = this.props.course.lessons.indexOf(currentLesson);
          currentGadget = currentLesson.gadgets.get(this.props.currentPosition.get('gadgetCid'));
          currentGadgetIndex = currentLesson.gadgets.indexOf(currentGadget);
        }
        courseJSON = this.props.course.toJSON({
          lessons: true,
          gadgets: true
        });
        _ref = courseJSON.lessons;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          lesson = _ref[_i];
          lesson.isAccessible = true;
        }
        return SidebarCourseComponent({
          course: courseJSON,
          currentLessonIndex: currentLessonIndex,
          currentGadgetIndex: currentGadgetIndex,
          sectionGadgetType: 'versal/header',
          editable: true,
          lastSavedDateTime: this.state.lastSavedTime,
          contributorsComponent: SidebarContributorsComponent({
            mediator: this.props.mediator
          }),
          siteBaseUrl: this.props.siteBaseUrl,
          onClickCourseTitle: (function(_this) {
            return function() {
              return _this.props.mediator.trigger('parent:notify', {
                event: 'publishCourse'
              });
            };
          })(this),
          onChangeCourseTitle: (function(_this) {
            return function(title) {
              _this.props.course.set({
                title: title
              });
              return _this.props.course.debouncedSave();
            };
          })(this),
          onClickLesson: (function(_this) {
            return function(lessonIndex) {
              return _this.props.mediator.trigger('navigate:lesson', lessonIndex + 1);
            };
          })(this),
          onClickSection: (function(_this) {
            return function(lessonIndex, gadgetIndex) {
              return _this.props.mediator.trigger('navigate:gadget', lessonIndex + 1, gadgetIndex + 1);
            };
          })(this),
          onChangeLessonTitle: (function(_this) {
            return function(lessonIndex, title) {
              lesson = _this.props.course.lessons.at(lessonIndex);
              lesson.set({
                title: title
              });
              return lesson.debouncedSave();
            };
          })(this),
          onLessonDelete: (function(_this) {
            return function(lessonIndex) {
              lesson = _this.props.course.lessons.at(lessonIndex);
              lesson.destroy();
              _this.props.mediator.trigger('lesson:deleted', lesson);
              analytics.track('Removed lesson', {
                lessonId: lesson.id,
                courseId: _this.props.course.id
              });
              return _this._ensureLesson(function() {
                var newIndex;
                if (_this.props.currentPosition.get('lessonCid') === lesson.cid) {
                  newIndex = Math.min(lessonIndex, _this.props.course.lessons.length - 1);
                  return _this.props.mediator.trigger('navigate:lesson', newIndex + 1);
                }
              });
            };
          })(this),
          onLessonMove: (function(_this) {
            return function(fromId, toIndex) {
              var fromLesson;
              fromLesson = _this.props.course.lessons.get(fromId);
              return _this.props.course.lessons.move(fromLesson, toIndex);
            };
          })(this),
          onLessonAdd: (function(_this) {
            return function() {
              return _this.props.course.lessons.create({}, {
                success: function(lesson) {
                  var lessonIndex;
                  lesson.set('isAccessible', true);
                  lessonIndex = _this.props.course.lessons.indexOf(lesson);
                  analytics.track('Added lesson', {
                    lessonId: lesson.id,
                    courseId: _this.props.course.id
                  });
                  return _this.props.mediator.trigger('navigate:lesson', lessonIndex + 1);
                }
              });
            };
          })(this)
        });
      }
    });
    return AuthorSidebarView = (function(_super) {
      __extends(AuthorSidebarView, _super);

      function AuthorSidebarView() {
        return AuthorSidebarView.__super__.constructor.apply(this, arguments);
      }

      AuthorSidebarView.prototype.className = 'spec-author-sidebar';

      AuthorSidebarView.prototype.template = function() {
        return '';
      };

      AuthorSidebarView.prototype.onShow = function() {
        var sidebarComponent;
        this.$el.css('height', '100%');
        sidebarComponent = SidebarAuthorCourseControllerComponent({
          course: this.model,
          currentPosition: currentPosition,
          siteBaseUrl: settings.get('site'),
          mediator: mediator
        });
        return React.renderComponent(sidebarComponent, this.el);
      };

      AuthorSidebarView.prototype.onClose = function() {
        return React.unmountComponentAtNode(this.el);
      };

      return AuthorSidebarView;

    })(Marionette.ItemView);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/sidebar/learner',['cdn.marionette', 'app/mediator', 'state/position', 'versal-react-sidebar', 'react', 'react-backbone', 'react-coffeescript-glue'], function(Marionette, mediator, currentPosition, SidebarCourseComponent, React) {
    var LearnerSidebarView, SidebarCourseControllerComponent;
    SidebarCourseControllerComponent = React.createClass({
      mixins: [React.BackboneMixin('course'), React.BackboneMixin('currentPosition')],
      render: function() {
        var currentGadget, currentGadgetIndex, currentLesson, currentLessonIndex;
        currentLesson = this.props.course.lessons.get(this.props.currentPosition.get('lessonCid'));
        if (currentLesson) {
          currentLessonIndex = this.props.course.lessons.indexOf(currentLesson);
          currentGadget = currentLesson.gadgets.get(this.props.currentPosition.get('gadgetCid'));
          currentGadgetIndex = currentLesson.gadgets.indexOf(currentGadget);
        }
        return SidebarCourseComponent({
          course: this.props.course.toJSON({
            lessons: true,
            gadgets: true
          }),
          currentLessonIndex: currentLessonIndex,
          currentGadgetIndex: currentGadgetIndex,
          sectionGadgetType: 'versal/header',
          onClickCourseTitle: function() {
            return mediator.trigger('parent:notify', {
              event: 'publishCourse'
            });
          },
          onClickLesson: function(lessonIndex) {
            return mediator.trigger('navigate:lesson', lessonIndex + 1);
          },
          onClickSection: function(lessonIndex, gadgetIndex) {
            return mediator.trigger('navigate:gadget', lessonIndex + 1, gadgetIndex + 1);
          }
        });
      }
    });
    return LearnerSidebarView = (function(_super) {
      __extends(LearnerSidebarView, _super);

      function LearnerSidebarView() {
        return LearnerSidebarView.__super__.constructor.apply(this, arguments);
      }

      LearnerSidebarView.prototype.className = 'spec-learner-sidebar';

      LearnerSidebarView.prototype.template = function() {
        return '';
      };

      LearnerSidebarView.prototype.onShow = function() {
        this.$el.css('height', '100%');
        return React.renderComponent(SidebarCourseControllerComponent({
          course: this.model,
          currentPosition: currentPosition
        }), this.el);
      };

      LearnerSidebarView.prototype.onClose = function() {
        return React.unmountComponentAtNode(this.el);
      };

      return LearnerSidebarView;

    })(Marionette.ItemView);
  });

}).call(this);


define('text!templates/tray/tray.html',[],function () { return '<div class="tray-gadgets-scroller js-tray-gadgets-scroller">\n  <div class="prev-arrow js-scroll-prev">\n    <i class="icon-caret-left"></i>\n  </div>\n\n  <div class="js-tray-gadgets tray-gadgets"></div>\n\n  <div class="next-arrow js-scroll-next">\n    <i class="icon-caret-right"></i>\n  </div>\n</div>\n';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/modal',['cdn.marionette'], function(Marionette) {
    var BaseModalView;
    return BaseModalView = (function(_super) {
      __extends(BaseModalView, _super);

      function BaseModalView() {
        this._onKeyDown = __bind(this._onKeyDown, this);
        return BaseModalView.__super__.constructor.apply(this, arguments);
      }

      BaseModalView.prototype.onClose = function() {
        $(document).off('keydown', this._onKeyDown);
        return this.remove();
      };

      BaseModalView.prototype._onBackdropClick = function() {
        return this.close();
      };

      BaseModalView.prototype._onModalClick = function(e) {
        return e.stopPropagation();
      };

      BaseModalView.prototype._onCloseModalClick = function() {
        return this.close();
      };

      BaseModalView.prototype._onKeyDown = function(e) {
        if (e.keyCode === 27) {
          return this.close();
        }
      };

      BaseModalView.prototype.onRender = function() {
        return $(document).on('keydown', this._onKeyDown);
      };

      BaseModalView.prototype._prevent = function(e) {
        e.stopPropagation();
        return e.preventDefault();
      };

      BaseModalView.prototype.events = {
        'click': '_onModalClick',
        'click .js-close': '_onCloseModalClick',
        'click .modal-backdrop': '_onBackdropClick'
      };

      return BaseModalView;

    })(Marionette.ItemView);
  });

}).call(this);


define('text!templates/tray/version_modal.html',[],function () { return '<div class="gadget-version-modal modal">\n  <div class="js-instructions instructions">\n    <%- prompt %>\n  </div>\n  <div class="gadget-info">\n    <div class="icon" style="background-image: url(<%- icon %>)"></div>\n    <div class="title"><%- title %></div>\n    <div class="author"><%- author %></div>\n    <div class="version">\n      <%- fromVersion %> &#8594; <%- toVersion %>\n    </div>\n  </div>\n  <div class="js-error-text error-text">Gadget <%- operation %> failed, please check your connection and try again</div>\n  <div class="js-button-controls button-controls">\n    <button class="version-change-cancel js-close">maybe later</button>\n    <button class="version-change-ok js-ok action">\n      <span class="js-okay-text"><%- operation %></span>\n      <div class="js-spinner spinner"></div>\n    </button>\n  </div>\n  <div class="js-done-controls button-controls done-controls">\n    <button class="js-done js-close action">okay</button>\n  </div>\n</div>\n<div class="js-modal-backdrop modal-backdrop"></div>\n';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/tray/version_modal',['views/modal', 'text!templates/tray/version_modal.html', 'app/mediator'], function(Modal, modalTemplate, mediator) {
    var GadgetVersionModal;
    return GadgetVersionModal = (function(_super) {
      __extends(GadgetVersionModal, _super);

      function GadgetVersionModal() {
        this.templateHelpers = __bind(this.templateHelpers, this);
        this.onVersionChangeFailed = __bind(this.onVersionChangeFailed, this);
        this.onVersionChangeSuccess = __bind(this.onVersionChangeSuccess, this);
        return GadgetVersionModal.__super__.constructor.apply(this, arguments);
      }

      GadgetVersionModal.prototype.template = _.template(modalTemplate);

      GadgetVersionModal.prototype.events = _.extend({}, GadgetVersionModal.prototype.events, {
        'click .js-ok': 'onVersionChangeClick',
        'click .js-modal-backdrop': 'close'
      });

      GadgetVersionModal.prototype.ui = {
        confirmButton: '.js-ok',
        okayText: '.js-okay-text',
        spinner: '.js-spinner',
        controls: '.js-button-controls',
        doneControls: '.js-done-controls',
        instructions: '.js-instructions',
        errorText: '.js-error-text'
      };

      GadgetVersionModal.prototype.initialize = function() {
        this.upgrading = !this.options.toVersion;
        this.toVersion = this.options.toVersion || this.options.model.get('latestVersion');
        return this.fromVersion = this.options.model.get('version');
      };

      GadgetVersionModal.prototype.onVersionChangeClick = function() {
        this.showLoading();
        return this.options.palette.changeVersion(this.options.model.type().split('@')[0], this.toVersion).done(this.onVersionChangeSuccess).fail(this.onVersionChangeFailed);
      };

      GadgetVersionModal.prototype.showLoading = function() {
        if (!this.indicator) {
          this.indicator = new vs.ui.LoadingIndicator(this.ui.spinner, '#fff');
        }
        this.ui.okayText.addClass('invisible');
        return this.ui.errorText.hide();
      };

      GadgetVersionModal.prototype.showDone = function() {
        var status;
        this.ui.spinner.hide();
        this.ui.okayText.removeClass('invisible');
        this.ui.controls.hide();
        status = this.upgrading ? 'updated' : 'reverted';
        this.ui.instructions.text("All instances of this gadget have been " + status);
        return this.ui.doneControls.show();
      };

      GadgetVersionModal.prototype.onVersionChangeSuccess = function() {
        this.showDone();
        return mediator.trigger('tray:gadgetUpdated', this.options.model);
      };

      GadgetVersionModal.prototype.onVersionChangeFailed = function() {
        this.ui.okayText.text('try again').removeClass('invisible');
        this.ui.errorText.show();
        return this.ui.spinner.hide();
      };

      GadgetVersionModal.prototype.serializeData = function() {
        return _.extend({
          icon: this.options.model.icon()
        }, this.options.model.toJSON());
      };

      GadgetVersionModal.prototype.templateHelpers = function() {
        return {
          operation: this.upgrading ? 'upgrade' : 'revert',
          fromVersion: this.fromVersion,
          toVersion: this.toVersion,
          prompt: this.upgrading ? 'Upgrade each instance of this gadget in the current course' : 'Revert each instance of this gadget back to its previous version'
        };
      };

      return GadgetVersionModal;

    })(Modal);
  });

}).call(this);

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/tray/tray',['cdn.marionette', './item', 'text!templates/tray/tray.html', 'app/mediator', './version_modal'], function(Marionette, TrayItemView, template, mediator, GadgetVersionModal) {
    var TrayView;
    return TrayView = (function(_super) {
      __extends(TrayView, _super);

      function TrayView() {
        this.selectCatalog = __bind(this.selectCatalog, this);
        this.itemViewOptions = __bind(this.itemViewOptions, this);
        return TrayView.__super__.constructor.apply(this, arguments);
      }

      TrayView.prototype.template = _.template(template);

      TrayView.prototype.className = 'tray';

      TrayView.prototype.ui = {
        gadgetList: '.js-tray-gadgets',
        gadgetScroller: '.js-tray-gadgets-scroller'
      };

      TrayView.prototype.events = {
        'click .js-scroll-next': 'scrollNext',
        'click .js-scroll-prev': 'scrollPrev'
      };

      TrayView.prototype.initialize = function(_arg) {
        this.catalogs = _arg.catalogs, this.model = _arg.model;
        this.gadgetsPerRow = 10;
        this.palette = this.model.palette;
        this.storePaletteHistory();
        this.palette.on('sync', this.render, this);
        this.collection = new Backbone.Collection;
        this.on('itemview:upgrade', this.onGadgetUpgradeRequest, this);
        this.on('itemview:revert', this.onGadgetRevertRequest, this);
        this.listenTo(mediator, 'lesson:deleted gadget:deleted', this.onFragmentRemove);
        this.listenTo(mediator, 'tray:catalog:changed', this.selectCatalog);
        return this.listenTo(this, 'composite:collection:rendered', this._onCollectionRendered);
      };

      TrayView.prototype.itemViewContainer = '.js-tray-gadgets';

      TrayView.prototype.itemView = TrayItemView;

      TrayView.prototype.getModelType = function(model) {
        return model.type().split('@')[0];
      };

      TrayView.prototype.onBeforeItemAdded = function(itemView) {
        var paletteMember;
        paletteMember = this.palette.findByType(this.getModelType(itemView.model));
        if (paletteMember) {
          return itemView.model.set(paletteMember.toJSON(), {
            silent: true
          });
        }
      };

      TrayView.prototype.itemViewOptions = function(projectModel) {
        return {
          revertable: (function(_this) {
            return function() {
              var oldversion;
              oldversion = _this.paletteHistory[_this.getModelType(projectModel)];
              if (!oldversion) {
                return false;
              }
              return oldversion !== projectModel.get('latestVersion');
            };
          })(this)
        };
      };

      TrayView.prototype.storePaletteHistory = function() {
        var types, versions;
        types = this.palette.map((function(_this) {
          return function(p) {
            return _this.getModelType(p);
          };
        })(this));
        versions = this.palette.pluck('version');
        return this.paletteHistory = _.object(types, versions);
      };

      TrayView.prototype.onRender = function() {
        if (this.scrollIndex == null) {
          this.scrollIndex = 0;
        }
        return this._updatePageArrows();
      };

      TrayView.prototype.selectCatalog = function(activeCatalog) {
        this.scrollIndex = 0;
        this.collection = this.catalogs[activeCatalog];
        return this.render();
      };

      TrayView.prototype._onCollectionRendered = function() {
        this.icons = this.ui.gadgetList.children();
        if (this.icons.length > 0) {
          return _.defer((function(_this) {
            return function() {
              var initial;
              initial = _this.icons.first().offset().left;
              _this.icons.each(function(i) {
                return $(this).data('leftPos', $(this).offset().left - initial);
              });
              return _this.scrollToChild(_this.scrollIndex, false);
            };
          })(this));
        }
      };

      TrayView.prototype.scrollToChild = function(index, animate) {
        var offset, pos;
        if (animate == null) {
          animate = true;
        }
        pos = index - (index % this.gadgetsPerRow);
        offset = this.icons.eq(pos).data('leftPos');
        if (animate) {
          this.ui.gadgetScroller.animate({
            scrollLeft: offset
          });
        } else {
          this.ui.gadgetScroller.scrollLeft(offset);
        }
        return this._updatePageArrows();
      };

      TrayView.prototype._updatePageArrows = function() {
        this.ui.gadgetScroller.toggleClass('first-page', this.scrollIndex === 0);
        return this.ui.gadgetScroller.toggleClass('last-page', (this.scrollIndex + this.gadgetsPerRow) >= this.icons.length);
      };

      TrayView.prototype.scrollNext = function() {
        this.scrollIndex = Math.min(this.icons.length - 1, this.scrollIndex + this.gadgetsPerRow);
        return this.scrollToChild(this.scrollIndex);
      };

      TrayView.prototype.scrollPrev = function() {
        this.scrollIndex = Math.max(0, this.scrollIndex - this.gadgetsPerRow);
        return this.scrollToChild(this.scrollIndex);
      };

      TrayView.prototype.appendHtml = function(cv, iv) {
        var usernames, _ref;
        usernames = _.compact((_ref = this.model) != null ? _ref.authors.map(function(author) {
          return author.get('username');
        }) : void 0);
        if (iv.model.get('hidden') && !_.contains(usernames, iv.model.get('username'))) {
          return;
        }
        TrayView.__super__.appendHtml.apply(this, arguments);
        return setTimeout(function() {
          return $(window).trigger('resize');
        }, 200);
      };

      TrayView.prototype.showVersionModal = function(model, toVersion) {
        var view;
        view = new GadgetVersionModal({
          model: model,
          palette: this.palette,
          toVersion: toVersion
        });
        view.render();
        return $('body').append(view.$el);
      };

      TrayView.prototype.onGadgetUpgradeRequest = function(view) {
        return this.showVersionModal(this.palette.findByType(this.getModelType(view.model)));
      };

      TrayView.prototype.onGadgetRevertRequest = function(view) {
        var toVersion;
        toVersion = this.paletteHistory[this.getModelType(view.model)];
        return this.showVersionModal(view.model, toVersion);
      };

      TrayView.prototype.onFragmentRemove = function(model) {
        if (this._pendingRemove) {
          this.stopListening(this._pendingRemove, 'sync');
        }
        this._pendingRemove = model;
        return this.listenToOnce(model, 'sync', this.onRemoveComplete);
      };

      TrayView.prototype.onRemoveComplete = function() {
        return this.palette.fetch();
      };

      return TrayView;

    })(Marionette.CompositeView);
  });

}).call(this);


define('text!templates/tray/tray_filters.html',[],function () { return '<% catalogs.forEach(function(cat){ %>\n  <a class="tray-filter js-choose-catalog js-catalog-label" data-catalog="<%- cat %>"><%- cat %></a>\n<% }) %>\n\n<a class="tray-filter js-tray-toggle tray-toggle">\n  <i class="tray-toggle-expand icon-double-angle-up"></i>\n  <i class="tray-toggle-collapse icon-double-angle-down"></i>\n</a>\n';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/tray/tray_filters',['cdn.marionette', 'text!templates/tray/tray_filters.html', 'app/mediator', 'models/settings', 'libs/analytics'], function(Marionette, template, mediator, settings, analytics) {
    var TrayFiltersView;
    return TrayFiltersView = (function(_super) {
      __extends(TrayFiltersView, _super);

      function TrayFiltersView() {
        this._activeCatalogs = __bind(this._activeCatalogs, this);
        this._onCatalogClick = __bind(this._onCatalogClick, this);
        this._showSelectedCatalog = __bind(this._showSelectedCatalog, this);
        this.templateHelpers = __bind(this.templateHelpers, this);
        return TrayFiltersView.__super__.constructor.apply(this, arguments);
      }

      TrayFiltersView.prototype.template = _.template(template);

      TrayFiltersView.prototype.className = 'tray-filters';

      TrayFiltersView.prototype.ui = {
        labels: '.js-catalog-label'
      };

      TrayFiltersView.prototype.events = {
        'click .js-choose-catalog': '_onCatalogClick',
        'click .js-tray-toggle': '_onTrayToggleClick'
      };

      TrayFiltersView.prototype.templateHelpers = function() {
        return {
          catalogs: _.keys(this.catalogs)
        };
      };

      TrayFiltersView.prototype.initialize = function(_arg) {
        this.catalogs = _arg.catalogs;
        this.listenTo(this.catalogs.all, 'sync', this._updateLabels);
        this.listenTo(this.catalogs.course, 'add remove', this._updateLabels);
        this.listenTo(mediator, 'tray:gadget:dragstart', this._onTrayGadgetDragStart);
        this.listenTo(mediator, 'gadget:editing:start', this._onGadgetEditingStart);
        return this.listenTo(mediator, 'gadget:editing:stop', this._onGadgetEditingStop);
      };

      TrayFiltersView.prototype.onRender = function() {
        return this._updateLabels();
      };

      TrayFiltersView.prototype.selectCatalog = function(name) {
        this._activeCatalog = name;
        this._showSelectedCatalog(this._activeCatalog);
        this._setExpanded(true);
        localStorage.versalTrayExpanded = true;
        return mediator.trigger('tray:catalog:changed', this._activeCatalog);
      };

      TrayFiltersView.prototype._showSelectedCatalog = function(name) {
        this.ui.labels.removeClass('active');
        if (name) {
          return this.$("[data-catalog=" + name + "]").addClass('active');
        }
      };

      TrayFiltersView.prototype._onCatalogClick = function(e) {
        var name;
        name = $(e.target).data('catalog');
        analytics.track('Clicked gadget tray tab', {
          courseId: settings.get('courseId'),
          name: name
        });
        if (!this._activeCatalog) {
          return this.selectCatalog(name);
        }
        if (!this._expanded) {
          return this._setExpanded(true);
        } else {
          return this.selectCatalog(name);
        }
      };

      TrayFiltersView.prototype._onTrayGadgetDragStart = function() {
        if (!this._usedOpenButtonToExpand) {
          return this._setExpanded(false);
        }
      };

      TrayFiltersView.prototype._activeCatalogs = function() {
        return _.compact(_.map(this.catalogs, function(v, k) {
          if (v != null ? v.length : void 0) {
            return k;
          }
        }));
      };

      TrayFiltersView.prototype._updateLabels = function() {
        return this.ui.labels.each((function(_this) {
          return function(i, el) {
            return $(el).toggleClass('hidden', !_.contains(_this._activeCatalogs(), $(el).data('catalog')));
          };
        })(this));
      };

      TrayFiltersView.prototype._onTrayToggleClick = function() {
        if (this._expanded) {
          analytics.track('Clicked gadget tray tab', {
            name: 'close',
            courseId: settings.get('courseId')
          });
        } else {
          analytics.track('Clicked gadget tray tab', {
            name: 'open',
            courseId: settings.get('courseId')
          });
        }
        if (this._activeCatalog) {
          this._setExpanded(!this._expanded);
        } else {
          this.selectCatalog('all');
        }
        this._usedOpenButtonToExpand = true;
        return localStorage.versalTrayExpanded = this._expanded;
      };

      TrayFiltersView.prototype._setExpanded = function(expanded) {
        if (expanded === this._expanded) {
          return;
        }
        if (expanded) {
          this._showSelectedCatalog(this._activeCatalog);
        } else {
          this._showSelectedCatalog(null);
        }
        this._expanded = expanded;
        this._usedOpenButtonToExpand = false;
        return mediator.trigger('tray:expanded', this._expanded);
      };

      TrayFiltersView.prototype._onGadgetEditingStart = function() {
        return this._setExpanded(false);
      };

      TrayFiltersView.prototype._onGadgetEditingStop = function() {
        var expanded;
        expanded = localStorage.versalTrayExpanded;
        return this._setExpanded(expanded === 'true' || expanded === void 0);
      };

      return TrayFiltersView;

    })(Marionette.ItemView);
  });

}).call(this);


define('text!templates/header.html',[],function () { return '<i class="toc-icon js-toggle-toc icon-reorder"></i>\n<span class="course-title"><%- title %></span>\n';});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/header',['cdn.marionette', 'text!templates/header.html', 'app/mediator'], function(Marionette, template, mediator) {
    var HeaderView;
    return HeaderView = (function(_super) {
      __extends(HeaderView, _super);

      function HeaderView() {
        return HeaderView.__super__.constructor.apply(this, arguments);
      }

      HeaderView.prototype.template = _.template(template);

      HeaderView.prototype.className = 'player-header';

      HeaderView.prototype.events = {
        'click .js-toggle-toc': 'onToggleClick'
      };

      HeaderView.prototype.initialize = function() {
        return this.listenTo(this.model, 'change', this.render);
      };

      HeaderView.prototype.onToggleClick = function(e) {
        e.stopPropagation();
        return mediator.trigger('toc:toggle');
      };

      return HeaderView;

    })(Marionette.ItemView);
  });

}).call(this);

(function() {
  define('plugins/vs-sticky',['cdn.underscore', 'cdn.jquery'], function(_, $) {
    var StickyHeaders, VENDOR_PREFIXES;
    VENDOR_PREFIXES = ['', '-webkit-', '-moz-', '-ms-', '-o-'];
    return StickyHeaders = (function() {
      StickyHeaders.prototype.selector = '.js-sticky-header';

      function StickyHeaders(el) {
        this.el = el;
        this.refresh = _.throttle(this.refresh.bind(this), 10);
        this._current = null;
        this._stickyContainer = $('<div class="vs-sticky-container" />');
        this.enable();
      }

      StickyHeaders.prototype.enable = function() {
        return $(this.el).on('scroll', this.refresh);
      };

      StickyHeaders.prototype.disable = function() {
        return $(this.el).off('scroll', this.refresh);
      };

      StickyHeaders.prototype.refresh = function() {
        var candidates, current, cutoff, next, _ref;
        cutoff = this.el.getBoundingClientRect().top;
        candidates = this.el.querySelectorAll(this.selector);
        if (!candidates.length) {
          return this.setStickyHeader(null);
        }
        _ref = _.reduce(candidates, _.partial(this.findCurrent, cutoff), null), current = _ref.current, next = _ref.next;
        if (this._sticky !== current) {
          this.setStickyHeader(current);
        }
        return this.adjustCurrent(cutoff, current, next);
      };

      StickyHeaders.prototype.findCurrent = function(cutoff, memo, cur) {
        if (memo == null) {
          memo = {
            current: null,
            next: null
          };
        }
        if (!memo.next) {
          if (cur.getBoundingClientRect().top <= cutoff) {
            memo.current = cur;
          }
          if (memo.current !== cur) {
            memo.next = cur;
          }
        }
        return memo;
      };

      StickyHeaders.prototype.setStickyHeader = function(current) {
        var style;
        if (this._sticky) {
          $(this._sticky).css('visibility', 'visible');
          this._sticky.dispatchEvent(new CustomEvent('unstuck', {
            bubbles: true
          }));
        }
        this._sticky = current;
        if (!current) {
          return this._stickyContainer.detach();
        }
        current.dispatchEvent(new CustomEvent('stuck', {
          bubbles: true
        }));
        style = window.getComputedStyle(current);
        this._stickyContainer.text(current.textContent).css(_.pick(style, 'color', 'fontSize', 'fontFamily', 'fontWeight', 'fontVariant')).appendTo(this.el);
        return $(this._sticky).css('visibility', 'hidden');
      };

      StickyHeaders.prototype.adjustCurrent = function(cutoff, current, next) {
        var offset, remainingSpace, transform;
        if (!current) {
          return;
        }
        remainingSpace = ((next != null ? next.getBoundingClientRect().top : void 0) || this.el.getBoundingClientRect().bottom) - cutoff;
        offset = remainingSpace - current.getBoundingClientRect().height;
        transform = offset <= 0 ? "translateY(" + offset + "px)" : 'none';
        return $(this._stickyContainer).css(_.object(_.map(VENDOR_PREFIXES, function(pref) {
          return ["" + pref + "transform", transform];
        })));
      };

      return StickyHeaders;

    })();
  });

}).call(this);

!function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function d(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],j(a,b(f,this),b(g,this))}function e(a){var b=this;return null===this._state?void this._deferreds.push(a):void k(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function f(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void j(b(c,a),b(f,this),b(g,this))}this._state=!0,this._value=a,h.call(this)}catch(d){g.call(this,d)}}function g(a){this._state=!1,this._value=a,h.call(this)}function h(){for(var a=0,b=this._deferreds.length;b>a;a++)e.call(this,this._deferreds[a]);this._deferreds=null}function i(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function j(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}"undefined"!=typeof module&&module.exports?module.exports=a.Promise?a.Promise:d:a.Promise||(a.Promise=d);var k=function(){function b(){var a=c;d=void 0,c=[];for(var b=0,e=a.length;e>b;b++)a[b]()}var c,d,e;return a.process&&"function"===process.nextTick?process.nextTick:a.MutationObserver?(c=[],e=document.createElement("div"),new MutationObserver(b).observe(e,{attributes:!0}),function(a){c.length||e.setAttribute("yes","no"),c.push(a)}):a.setImmediate?a.setImmediate:(c=[],function(a){c.push(a),d||(d=setTimeout(b,0))})}();d.prototype["catch"]=function(a){return this.then(null,a)},d.prototype.then=function(a,b){var c=this;return new d(function(d,f){e.call(c,new i(a,b,d,f))})},d.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&c(arguments[0])?arguments[0]:arguments);return new d(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},d.resolve=function(a){return new d(function(b){b(a)})},d.reject=function(a){return new d(function(b,c){c(a)})},d.race=function(a){return new d(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})}}(this),function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c;try{c=document.createEvent("CustomEvent"),c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail)}catch(d){c=document.createEvent("Event");for(var e in b)c[e]=b[e];c.initEvent(a,b.bubbles,b.cancelable)}return c}"undefined"!=typeof window.CustomEvent&&(a.prototype=window.CustomEvent.prototype),window.CustomEvent=a}(),"undefined"==typeof WeakMap&&!function(){var a=Object.defineProperty,b=Date.now()%1e9,c=function(){this.name="__st"+(1e9*Math.random()>>>0)+(b++ +"__")};c.prototype={set:function(b,c){var d=b[this.name];d&&d[0]===b?d[1]=c:a(b,this.name,{value:[b,c],writable:!0})},get:function(a){var b;return(b=a[this.name])&&b[0]===a?b[1]:void 0},"delete":function(a){this.set(a,void 0)}},window.WeakMap=c}(),function(a){function b(a){u.push(a),t||(t=!0,q(d))}function c(a){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(a)||a}function d(){t=!1;var a=u;u=[],a.sort(function(a,b){return a.uid_-b.uid_});var b=!1;a.forEach(function(a){var c=a.takeRecords();e(a),c.length&&(a.callback_(c,a),b=!0)}),b&&d()}function e(a){a.nodes_.forEach(function(b){var c=p.get(b);c&&c.forEach(function(b){b.observer===a&&b.removeTransientObservers()})})}function f(a,b){for(var c=a;c;c=c.parentNode){var d=p.get(c);if(d)for(var e=0;e<d.length;e++){var f=d[e],g=f.options;if(c===a||g.subtree){var h=b(g);h&&f.enqueue(h)}}}}function g(a){this.callback_=a,this.nodes_=[],this.records_=[],this.uid_=++v}function h(a,b){this.type=a,this.target=b,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function i(a){var b=new h(a.type,a.target);return b.addedNodes=a.addedNodes.slice(),b.removedNodes=a.removedNodes.slice(),b.previousSibling=a.previousSibling,b.nextSibling=a.nextSibling,b.attributeName=a.attributeName,b.attributeNamespace=a.attributeNamespace,b.oldValue=a.oldValue,b}function j(a,b){return w=new h(a,b)}function k(a){return x?x:(x=i(w),x.oldValue=a,x)}function l(){w=x=void 0}function m(a){return a===x||a===w}function n(a,b){return a===b?a:x&&m(a)?x:null}function o(a,b,c){this.observer=a,this.target=b,this.options=c,this.transientObservedNodes=[]}var p=new WeakMap,q=window.msSetImmediate;if(!q){var r=[],s=String(Math.random());window.addEventListener("message",function(a){if(a.data===s){var b=r;r=[],b.forEach(function(a){a()})}}),q=function(a){r.push(a),window.postMessage(s,"*")}}var t=!1,u=[],v=0;g.prototype={observe:function(a,b){if(a=c(a),!b.childList&&!b.attributes&&!b.characterData||b.attributeOldValue&&!b.attributes||b.attributeFilter&&b.attributeFilter.length&&!b.attributes||b.characterDataOldValue&&!b.characterData)throw new SyntaxError;var d=p.get(a);d||p.set(a,d=[]);for(var e,f=0;f<d.length;f++)if(d[f].observer===this){e=d[f],e.removeListeners(),e.options=b;break}e||(e=new o(this,a,b),d.push(e),this.nodes_.push(a)),e.addListeners()},disconnect:function(){this.nodes_.forEach(function(a){for(var b=p.get(a),c=0;c<b.length;c++){var d=b[c];if(d.observer===this){d.removeListeners(),b.splice(c,1);break}}},this),this.records_=[]},takeRecords:function(){var a=this.records_;return this.records_=[],a}};var w,x;o.prototype={enqueue:function(a){var c=this.observer.records_,d=c.length;if(c.length>0){var e=c[d-1],f=n(e,a);if(f)return void(c[d-1]=f)}else b(this.observer);c[d]=a},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(a){var b=this.options;b.attributes&&a.addEventListener("DOMAttrModified",this,!0),b.characterData&&a.addEventListener("DOMCharacterDataModified",this,!0),b.childList&&a.addEventListener("DOMNodeInserted",this,!0),(b.childList||b.subtree)&&a.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(a){var b=this.options;b.attributes&&a.removeEventListener("DOMAttrModified",this,!0),b.characterData&&a.removeEventListener("DOMCharacterDataModified",this,!0),b.childList&&a.removeEventListener("DOMNodeInserted",this,!0),(b.childList||b.subtree)&&a.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(a){if(a!==this.target){this.addListeners_(a),this.transientObservedNodes.push(a);var b=p.get(a);b||p.set(a,b=[]),b.push(this)}},removeTransientObservers:function(){var a=this.transientObservedNodes;this.transientObservedNodes=[],a.forEach(function(a){this.removeListeners_(a);for(var b=p.get(a),c=0;c<b.length;c++)if(b[c]===this){b.splice(c,1);break}},this)},handleEvent:function(a){switch(a.stopImmediatePropagation(),a.type){case"DOMAttrModified":var b=a.attrName,c=a.relatedNode.namespaceURI,d=a.target,e=new j("attributes",d);e.attributeName=b,e.attributeNamespace=c;var g=a.attrChange===MutationEvent.ADDITION?null:a.prevValue;f(d,function(a){return!a.attributes||a.attributeFilter&&a.attributeFilter.length&&-1===a.attributeFilter.indexOf(b)&&-1===a.attributeFilter.indexOf(c)?void 0:a.attributeOldValue?k(g):e});break;case"DOMCharacterDataModified":var d=a.target,e=j("characterData",d),g=a.prevValue;f(d,function(a){return a.characterData?a.characterDataOldValue?k(g):e:void 0});break;case"DOMNodeRemoved":this.addTransientObserver(a.target);case"DOMNodeInserted":var h,i,d=a.relatedNode,m=a.target;"DOMNodeInserted"===a.type?(h=[m],i=[]):(h=[],i=[m]);var n=m.previousSibling,o=m.nextSibling,e=j("childList",d);e.addedNodes=h,e.removedNodes=i,e.previousSibling=n,e.nextSibling=o,f(d,function(a){return a.childList?e:void 0})}l()}},a.JsMutationObserver=g,a.MutationObserver||(a.MutationObserver=g)}(this),window.CustomElements=window.CustomElements||{flags:{}},function(a){function b(a,c,d){var e=a.firstElementChild;if(!e)for(e=a.firstChild;e&&e.nodeType!==Node.ELEMENT_NODE;)e=e.nextSibling;for(;e;)c(e,d)!==!0&&b(e,c,d),e=e.nextElementSibling;return null}function c(a,b){for(var c=a.shadowRoot;c;)d(c,b),c=c.olderShadowRoot}function d(a,d){b(a,function(a){return d(a)?!0:void c(a,d)}),c(a,d)}function e(a){return h(a)?(i(a),!0):void l(a)}function f(a){d(a,function(a){return e(a)?!0:void 0})}function g(a){return e(a)||f(a)}function h(b){if(!b.__upgraded__&&b.nodeType===Node.ELEMENT_NODE){var c=b.getAttribute("is")||b.localName,d=a.registry[c];if(d)return A.dom&&console.group("upgrade:",b.localName),a.upgrade(b),A.dom&&console.groupEnd(),!0}}function i(a){l(a),r(a)&&d(a,function(a){l(a)})}function j(a){if(E.push(a),!D){D=!0;var b=window.Platform&&window.Platform.endOfMicrotask||setTimeout;b(k)}}function k(){D=!1;for(var a,b=E,c=0,d=b.length;d>c&&(a=b[c]);c++)a();E=[]}function l(a){C?j(function(){m(a)}):m(a)}function m(a){(a.attachedCallback||a.detachedCallback||a.__upgraded__&&A.dom)&&(A.dom&&console.group("inserted:",a.localName),r(a)&&(a.__inserted=(a.__inserted||0)+1,a.__inserted<1&&(a.__inserted=1),a.__inserted>1?A.dom&&console.warn("inserted:",a.localName,"insert/remove count:",a.__inserted):a.attachedCallback&&(A.dom&&console.log("inserted:",a.localName),a.attachedCallback())),A.dom&&console.groupEnd())}function n(a){o(a),d(a,function(a){o(a)})}function o(a){C?j(function(){p(a)}):p(a)}function p(a){(a.attachedCallback||a.detachedCallback||a.__upgraded__&&A.dom)&&(A.dom&&console.group("removed:",a.localName),r(a)||(a.__inserted=(a.__inserted||0)-1,a.__inserted>0&&(a.__inserted=0),a.__inserted<0?A.dom&&console.warn("removed:",a.localName,"insert/remove count:",a.__inserted):a.detachedCallback&&a.detachedCallback()),A.dom&&console.groupEnd())}function q(a){return window.ShadowDOMPolyfill?ShadowDOMPolyfill.wrapIfNeeded(a):a}function r(a){for(var b=a,c=q(document);b;){if(b==c)return!0;b=b.parentNode||b.host}}function s(a){if(a.shadowRoot&&!a.shadowRoot.__watched){A.dom&&console.log("watching shadow-root for: ",a.localName);for(var b=a.shadowRoot;b;)t(b),b=b.olderShadowRoot}}function t(a){a.__watched||(w(a),a.__watched=!0)}function u(a){if(A.dom){var b=a[0];if(b&&"childList"===b.type&&b.addedNodes&&b.addedNodes){for(var c=b.addedNodes[0];c&&c!==document&&!c.host;)c=c.parentNode;var d=c&&(c.URL||c._URL||c.host&&c.host.localName)||"";d=d.split("/?").shift().split("/").pop()}console.group("mutations (%d) [%s]",a.length,d||"")}a.forEach(function(a){"childList"===a.type&&(G(a.addedNodes,function(a){a.localName&&g(a)}),G(a.removedNodes,function(a){a.localName&&n(a)}))}),A.dom&&console.groupEnd()}function v(){u(F.takeRecords()),k()}function w(a){F.observe(a,{childList:!0,subtree:!0})}function x(a){w(a)}function y(a){A.dom&&console.group("upgradeDocument: ",a.baseURI.split("/").pop()),g(a),A.dom&&console.groupEnd()}function z(a){a=q(a);for(var b,c=a.querySelectorAll("link[rel="+B+"]"),d=0,e=c.length;e>d&&(b=c[d]);d++)b.import&&b.import.__parsed&&z(b.import);y(a)}var A=window.logFlags||{},B=window.HTMLImports?HTMLImports.IMPORT_LINK_TYPE:"none",C=!window.MutationObserver||window.MutationObserver===window.JsMutationObserver;a.hasPolyfillMutations=C;var D=!1,E=[],F=new MutationObserver(u),G=Array.prototype.forEach.call.bind(Array.prototype.forEach);a.IMPORT_LINK_TYPE=B,a.watchShadow=s,a.upgradeDocumentTree=z,a.upgradeAll=g,a.upgradeSubtree=f,a.insertedNode=i,a.observeDocument=x,a.upgradeDocument=y,a.takeRecords=v}(window.CustomElements),function(a){function b(b,g){var h=g||{};if(!b)throw new Error("document.registerElement: first argument `name` must not be empty");if(b.indexOf("-")<0)throw new Error("document.registerElement: first argument ('name') must contain a dash ('-'). Argument provided was '"+String(b)+"'.");if(c(b))throw new Error("Failed to execute 'registerElement' on 'Document': Registration failed for type '"+String(b)+"'. The type name is invalid.");if(n(b))throw new Error("DuplicateDefinitionError: a type with name '"+String(b)+"' is already registered");if(!h.prototype)throw new Error("Options missing required prototype property");return h.__name=b.toLowerCase(),h.lifecycle=h.lifecycle||{},h.ancestry=d(h.extends),e(h),f(h),l(h.prototype),o(h.__name,h),h.ctor=p(h),h.ctor.prototype=h.prototype,h.prototype.constructor=h.ctor,a.ready&&a.upgradeDocumentTree(document),h.ctor}function c(a){for(var b=0;b<y.length;b++)if(a===y[b])return!0}function d(a){var b=n(a);return b?d(b.extends).concat([b]):[]}function e(a){for(var b,c=a.extends,d=0;b=a.ancestry[d];d++)c=b.is&&b.tag;a.tag=c||a.__name,c&&(a.is=a.__name)}function f(a){if(!Object.__proto__){var b=HTMLElement.prototype;if(a.is){var c=document.createElement(a.tag),d=Object.getPrototypeOf(c);d===a.prototype&&(b=d)}for(var e,f=a.prototype;f&&f!==b;)e=Object.getPrototypeOf(f),f.__proto__=e,f=e;a.native=b}}function g(a){return h(B(a.tag),a)}function h(b,c){return c.is&&b.setAttribute("is",c.is),b.removeAttribute("unresolved"),i(b,c),b.__upgraded__=!0,k(b),a.insertedNode(b),a.upgradeSubtree(b),b}function i(a,b){Object.__proto__?a.__proto__=b.prototype:(j(a,b.prototype,b.native),a.__proto__=b.prototype)}function j(a,b,c){for(var d={},e=b;e!==c&&e!==HTMLElement.prototype;){for(var f,g=Object.getOwnPropertyNames(e),h=0;f=g[h];h++)d[f]||(Object.defineProperty(a,f,Object.getOwnPropertyDescriptor(e,f)),d[f]=1);e=Object.getPrototypeOf(e)}}function k(a){a.createdCallback&&a.createdCallback()}function l(a){if(!a.setAttribute._polyfilled){var b=a.setAttribute;a.setAttribute=function(a,c){m.call(this,a,c,b)};var c=a.removeAttribute;a.removeAttribute=function(a){m.call(this,a,null,c)},a.setAttribute._polyfilled=!0}}function m(a,b,c){a=a.toLowerCase();var d=this.getAttribute(a);c.apply(this,arguments);var e=this.getAttribute(a);this.attributeChangedCallback&&e!==d&&this.attributeChangedCallback(a,d,e)}function n(a){return a?z[a.toLowerCase()]:void 0}function o(a,b){z[a]=b}function p(a){return function(){return g(a)}}function q(a,b,c){return a===A?r(b,c):C(a,b)}function r(a,b){var c=n(b||a);if(c){if(a==c.tag&&b==c.is)return new c.ctor;if(!b&&!c.is)return new c.ctor}if(b){var d=r(a);return d.setAttribute("is",b),d}var d=B(a);return a.indexOf("-")>=0&&i(d,HTMLElement),d}function s(a){if(!a.__upgraded__&&a.nodeType===Node.ELEMENT_NODE){var b=a.getAttribute("is"),c=n(b||a.localName);if(c){if(b&&c.tag==a.localName)return h(a,c);if(!b&&!c.extends)return h(a,c)}}}function t(b){var c=D.call(this,b);return a.upgradeAll(c),c}a||(a=window.CustomElements={flags:{}});var u=a.flags,v=Boolean(document.registerElement),w=!u.register&&v&&!window.ShadowDOMPolyfill&&(!window.HTMLImports||HTMLImports.useNative);if(w){var x=function(){};a.registry={},a.upgradeElement=x,a.watchShadow=x,a.upgrade=x,a.upgradeAll=x,a.upgradeSubtree=x,a.observeDocument=x,a.upgradeDocument=x,a.upgradeDocumentTree=x,a.takeRecords=x,a.reservedTagList=[]}else{var y=["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"],z={},A="http://www.w3.org/1999/xhtml",B=document.createElement.bind(document),C=document.createElementNS.bind(document),D=Node.prototype.cloneNode;document.registerElement=b,document.createElement=r,document.createElementNS=q,Node.prototype.cloneNode=t,a.registry=z,a.upgrade=s}var E;E=Object.__proto__||w?function(a,b){return a instanceof b}:function(a,b){for(var c=a;c;){if(c===b.prototype)return!0;c=c.__proto__}return!1},a.instanceof=E,a.reservedTagList=y,document.register=document.registerElement,a.hasNative=v,a.useNative=w}(window.CustomElements),function(a){function b(a){return"link"===a.localName&&a.getAttribute("rel")===c}var c=a.IMPORT_LINK_TYPE,d={selectors:["link[rel="+c+"]"],map:{link:"parseLink"},parse:function(a){if(!a.__parsed){a.__parsed=!0;var b=a.querySelectorAll(d.selectors);e(b,function(a){d[d.map[a.localName]](a)}),CustomElements.upgradeDocument(a),CustomElements.observeDocument(a)}},parseLink:function(a){b(a)&&this.parseImport(a)},parseImport:function(a){a.import&&d.parse(a.import)}},e=Array.prototype.forEach.call.bind(Array.prototype.forEach);a.parser=d,a.IMPORT_LINK_TYPE=c}(window.CustomElements),function(a){function b(){CustomElements.parser.parse(document),CustomElements.upgradeDocument(document);var a=window.Platform&&Platform.endOfMicrotask?Platform.endOfMicrotask:setTimeout;a(function(){CustomElements.ready=!0,CustomElements.readyTime=Date.now(),window.HTMLImports&&(CustomElements.elapsed=CustomElements.readyTime-HTMLImports.readyTime),document.dispatchEvent(new CustomEvent("WebComponentsReady",{bubbles:!0})),window.HTMLImports&&(HTMLImports.__importsParsingHook=function(a){CustomElements.parser.parse(a.import)})})}if("function"!=typeof window.CustomEvent&&(window.CustomEvent=function(a){var b=document.createEvent("HTMLEvents");return b.initEvent(a,!0,!0),b}),"complete"===document.readyState||a.flags.eager)b();else if("interactive"!==document.readyState||window.attachEvent||window.HTMLImports&&!window.HTMLImports.ready){var c=window.HTMLImports&&!HTMLImports.ready?"HTMLImportsLoaded":"DOMContentLoaded";window.addEventListener(c,b)}else b()}(window.CustomElements),function(){function a(){window.HTMLTemplateElement=function(){throw new TypeError("Illegal constructor")},HTMLTemplateElement.prototype=Object.create(HTMLElement.prototype)}function b(){var a=document.createElement("style");a.textContent="template { display: none; }",document.head.appendChild(a)}function c(){HTMLTemplateElement.prototype._templateHostDocument=document.implementation.createHTMLDocument("")}function d(){Object.defineProperty(HTMLTemplateElement.prototype,"content",{get:function(){return this._contentFragment||this._createContentFragment(),this._contentFragment}}),HTMLTemplateElement.prototype._createContentFragment=function(){for(this._contentFragment=this._templateHostDocument.createDocumentFragment();this.firstChild;)this._contentFragment.appendChild(this.removeChild(this.firstChild))}}function e(a){a.htmlTemplatePolyfillApplied||(a.htmlTemplatePolyfillApplied=!0,a.__proto__=HTMLTemplateElement.prototype,a._createContentFragment())}function f(){Array.prototype.forEach.call(document.querySelectorAll("template"),e)}function g(){function a(a){Array.prototype.forEach.call(a,function(a){a.addedNodes&&Array.prototype.forEach.call(a.addedNodes,function(a){a.tagName&&"TEMPLATE"==a.tagName&&e(a)})})}new MutationObserver(a).observe(document,{subtree:!0,childList:!0})}window.HTMLTemplateElement&&"content"in window.HTMLTemplateElement.prototype||(b(),a(),c(),d(),f(),g())}(),window.HTMLImports=window.HTMLImports||{flags:{}},function(a){var b=(a.path,a.xhr),c=a.flags,d=function(a,b){this.cache={},this.onload=a,this.oncomplete=b,this.inflight=0,this.pending={}};d.prototype={addNodes:function(a){this.inflight+=a.length;for(var b,c=0,d=a.length;d>c&&(b=a[c]);c++)this.require(b);this.checkDone()},addNode:function(a){this.inflight++,this.require(a),this.checkDone()},require:function(a){var b=a.src||a.href;a.__nodeUrl=b,this.dedupe(b,a)||this.fetch(b,a)},dedupe:function(a,b){if(this.pending[a])return this.pending[a].push(b),!0;return this.cache[a]?(this.onload(a,b,this.cache[a]),this.tail(),!0):(this.pending[a]=[b],!1)},fetch:function(a,d){if(c.load&&console.log("fetch",a,d),a.match(/^data:/)){var e=a.split(","),f=e[0],g=e[1];g=f.indexOf(";base64")>-1?atob(g):decodeURIComponent(g),setTimeout(function(){this.receive(a,d,null,g)}.bind(this),0)}else{var h=function(b,c,e){this.receive(a,d,b,c,e)}.bind(this);b.load(a,h)}},receive:function(a,b,c,d,e){this.cache[a]=d;var f=this.pending[a];e&&e!==a&&(this.cache[e]=d,f=f.concat(this.pending[e]));for(var g,h=0,i=f.length;i>h&&(g=f[h]);h++)this.onload(e||a,g,d),this.tail();this.pending[a]=null,e&&e!==a&&(this.pending[e]=null)},tail:function(){--this.inflight,this.checkDone()},checkDone:function(){this.inflight||this.oncomplete()}},b=b||{async:!0,ok:function(a){return a.status>=200&&a.status<300||304===a.status||0===a.status},load:function(c,d,e){var f=new XMLHttpRequest;return(a.flags.debug||a.flags.bust)&&(c+="?"+Math.random()),f.open("GET",c,b.async),f.addEventListener("readystatechange",function(){if(4===f.readyState){var a=f.getResponseHeader("Location"),c=null;if(a)var c="/"===a.substr(0,1)?location.origin+a:c;d.call(e,!b.ok(f)&&f,f.response||f.responseText,c)}}),f.send(),f},loadDocument:function(a,b,c){this.load(a,b,c).responseType="document"}},a.xhr=b,a.Loader=d}(window.HTMLImports),function(a){function b(a){return"link"===a.localName&&a.rel===g}function c(a){var b,c=d(a);try{b=btoa(c)}catch(e){b=btoa(unescape(encodeURIComponent(c))),console.warn("Script contained non-latin characters that were forced to latin. Some characters may be wrong.",a)}return"data:text/javascript;base64,"+b}function d(a){return a.textContent+e(a)}function e(a){var b=a.__nodeUrl;if(!b){b=a.ownerDocument.baseURI;var c="["+Math.floor(1e3*(Math.random()+1))+"]",d=a.textContent.match(/Polymer\(['"]([^'"]*)/);c=d&&d[1]||c,b+="/"+c+".js"}return"\n//# sourceURL="+b+"\n"}function f(a){var b=a.ownerDocument.createElement("style");return b.textContent=a.textContent,n.resolveUrlsInStyle(b),b}var g="import",h=a.flags,i=/Trident/.test(navigator.userAgent),j=window.ShadowDOMPolyfill?window.ShadowDOMPolyfill.wrapIfNeeded(document):document,k={documentSelectors:"link[rel="+g+"]",importsSelectors:["link[rel="+g+"]","link[rel=stylesheet]","style","script:not([type])",'script[type="text/javascript"]'].join(","),map:{link:"parseLink",script:"parseScript",style:"parseStyle"},parseNext:function(){var a=this.nextToParse();a&&this.parse(a)},parse:function(a){if(this.isParsed(a))return void(h.parse&&console.log("[%s] is already parsed",a.localName));var b=this[this.map[a.localName]];b&&(this.markParsing(a),b.call(this,a))},markParsing:function(a){h.parse&&console.log("parsing",a),this.parsingElement=a},markParsingComplete:function(a){a.__importParsed=!0,a.__importElement&&(a.__importElement.__importParsed=!0),this.parsingElement=null,h.parse&&console.log("completed",a)},invalidateParse:function(a){a&&a.__importLink&&(a.__importParsed=a.__importLink.__importParsed=!1,this.parseSoon())},parseSoon:function(){this._parseSoon&&cancelAnimationFrame(this._parseDelay);var a=this;this._parseSoon=requestAnimationFrame(function(){a.parseNext()})},parseImport:function(a){if(HTMLImports.__importsParsingHook&&HTMLImports.__importsParsingHook(a),a.import.__importParsed=!0,this.markParsingComplete(a),a.dispatchEvent(a.__resource?new CustomEvent("load",{bubbles:!1}):new CustomEvent("error",{bubbles:!1})),a.__pending)for(var b;a.__pending.length;)b=a.__pending.shift(),b&&b({target:a});this.parseNext()},parseLink:function(a){b(a)?this.parseImport(a):(a.href=a.href,this.parseGeneric(a))},parseStyle:function(a){var b=a;a=f(a),a.__importElement=b,this.parseGeneric(a)},parseGeneric:function(a){this.trackElement(a),document.head.appendChild(a)},trackElement:function(a,b){var c=this,d=function(d){b&&b(d),c.markParsingComplete(a),c.parseNext()};if(a.addEventListener("load",d),a.addEventListener("error",d),i&&"style"===a.localName){var e=!1;if(-1==a.textContent.indexOf("@import"))e=!0;else if(a.sheet){e=!0;for(var f,g=a.sheet.cssRules,h=g?g.length:0,j=0;h>j&&(f=g[j]);j++)f.type===CSSRule.IMPORT_RULE&&(e=e&&Boolean(f.styleSheet))}e&&a.dispatchEvent(new CustomEvent("load",{bubbles:!1}))}},parseScript:function(b){var d=document.createElement("script");d.__importElement=b,d.src=b.src?b.src:c(b),a.currentScript=b,this.trackElement(d,function(){d.parentNode.removeChild(d),a.currentScript=null}),document.head.appendChild(d)},nextToParse:function(){return!this.parsingElement&&this.nextToParseInDoc(j)},nextToParseInDoc:function(a,c){for(var d,e=a.querySelectorAll(this.parseSelectorsForNode(a)),f=0,g=e.length;g>f&&(d=e[f]);f++)if(!this.isParsed(d))return this.hasResource(d)?b(d)?this.nextToParseInDoc(d.import,d):d:void 0;return c},parseSelectorsForNode:function(a){var b=a.ownerDocument||a;return b===j?this.documentSelectors:this.importsSelectors},isParsed:function(a){return a.__importParsed},hasResource:function(a){return b(a)&&!a.import?!1:!0}},l=/(url\()([^)]*)(\))/g,m=/(@import[\s]+(?!url\())([^;]*)(;)/g,n={resolveUrlsInStyle:function(a){var b=a.ownerDocument,c=b.createElement("a");return a.textContent=this.resolveUrlsInCssText(a.textContent,c),a},resolveUrlsInCssText:function(a,b){var c=this.replaceUrls(a,b,l);return c=this.replaceUrls(c,b,m)},replaceUrls:function(a,b,c){return a.replace(c,function(a,c,d,e){var f=d.replace(/["']/g,"");return b.href=f,f=b.href,c+"'"+f+"'"+e})}};a.parser=k,a.path=n,a.isIE=i}(HTMLImports),function(a){function b(a){return c(a,q)}function c(a,b){return"link"===a.localName&&a.getAttribute("rel")===b}function d(a,b){var c=a;c instanceof Document||(c=document.implementation.createHTMLDocument(q)),c._URL=b;var d=c.createElement("base");d.setAttribute("href",b),c.baseURI||(c.baseURI=b);var e=c.createElement("meta");return e.setAttribute("charset","utf-8"),c.head.appendChild(e),c.head.appendChild(d),a instanceof Document||(c.body.innerHTML=a),window.HTMLTemplateElement&&HTMLTemplateElement.bootstrap&&HTMLTemplateElement.bootstrap(c),c}function e(a,b){b=b||r,g(function(){h(a,b)},b)}function f(a){return"complete"===a.readyState||a.readyState===y}function g(a,b){if(f(b))a&&a();else{var c=function(){("complete"===b.readyState||b.readyState===y)&&(b.removeEventListener(z,c),g(a,b))};b.addEventListener(z,c)}}function h(a,b){function c(){f==g&&a&&a()}function d(){f++,c()}var e=b.querySelectorAll("link[rel=import]"),f=0,g=e.length;if(g)for(var h,j=0;g>j&&(h=e[j]);j++)i(h)?d.call(h):(h.addEventListener("load",d),h.addEventListener("error",d));else c()}function i(a){return o?a.import&&"loading"!==a.import.readyState||a.__loaded:a.__importParsed}function j(a){for(var b,c=0,d=a.length;d>c&&(b=a[c]);c++)k(b)&&l(b)}function k(a){return"link"===a.localName&&"import"===a.rel}function l(a){var b=a.import;b?m({target:a}):(a.addEventListener("load",m),a.addEventListener("error",m))}function m(a){a.target.__loaded=!0}var n="import"in document.createElement("link"),o=n,p=a.flags,q="import",r=window.ShadowDOMPolyfill?ShadowDOMPolyfill.wrapIfNeeded(document):document;if(o)var s={};else var t=(a.xhr,a.Loader),u=a.parser,s={documents:{},documentPreloadSelectors:"link[rel="+q+"]",importsPreloadSelectors:["link[rel="+q+"]"].join(","),loadNode:function(a){v.addNode(a)},loadSubtree:function(a){var b=this.marshalNodes(a);v.addNodes(b)},marshalNodes:function(a){return a.querySelectorAll(this.loadSelectorsForNode(a))},loadSelectorsForNode:function(a){var b=a.ownerDocument||a;return b===r?this.documentPreloadSelectors:this.importsPreloadSelectors},loaded:function(a,c,e){if(p.load&&console.log("loaded",a,c),c.__resource=e,b(c)){var f=this.documents[a];f||(f=d(e,a),f.__importLink=c,this.bootDocument(f),this.documents[a]=f),c.import=f}u.parseNext()},bootDocument:function(a){this.loadSubtree(a),this.observe(a),u.parseNext()},loadedAll:function(){u.parseNext()}},v=new t(s.loaded.bind(s),s.loadedAll.bind(s));var w={get:function(){return HTMLImports.currentScript||document.currentScript},configurable:!0};if(Object.defineProperty(document,"_currentScript",w),Object.defineProperty(r,"_currentScript",w),!document.baseURI){var x={get:function(){return window.location.href},configurable:!0};Object.defineProperty(document,"baseURI",x),Object.defineProperty(r,"baseURI",x)}var y=HTMLImports.isIE?"complete":"interactive",z="readystatechange";o&&new MutationObserver(function(a){for(var b,c=0,d=a.length;d>c&&(b=a[c]);c++)b.addedNodes&&j(b.addedNodes)}).observe(document.head,{childList:!0}),a.hasNative=n,a.useNative=o,a.importer=s,a.IMPORT_LINK_TYPE=q,a.isImportLoaded=i,a.importLoader=v,a.whenReady=e,a.whenImportsReady=e}(window.HTMLImports),function(a){function b(a){for(var b,d=0,e=a.length;e>d&&(b=a[d]);d++)"childList"===b.type&&b.addedNodes.length&&c(b.addedNodes)}function c(a){for(var b,e,g=0,h=a.length;h>g&&(e=a[g]);g++)b=b||e.ownerDocument,d(e)&&f.loadNode(e),e.children&&e.children.length&&c(e.children)}function d(a){return 1===a.nodeType&&g.call(a,f.loadSelectorsForNode(a))}function e(a){h.observe(a,{childList:!0,subtree:!0})}var f=(a.IMPORT_LINK_TYPE,a.importer),g=(a.parser,HTMLElement.prototype.matches||HTMLElement.prototype.matchesSelector||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector),h=new MutationObserver(b);a.observe=e,f.observe=e}(HTMLImports),function(){function a(){HTMLImports.importer.bootDocument(b)}"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(a,b){var c=document.createEvent("HTMLEvents");return c.initEvent(a,b.bubbles===!1?!1:!0,b.cancelable===!1?!1:!0,b.detail),c});var b=window.ShadowDOMPolyfill?window.ShadowDOMPolyfill.wrapIfNeeded(document):document;HTMLImports.whenImportsReady(function(){HTMLImports.ready=!0,HTMLImports.readyTime=(new Date).getTime(),b.dispatchEvent(new CustomEvent("HTMLImportsLoaded",{bubbles:!0}))}),HTMLImports.useNative||("complete"===document.readyState||"interactive"===document.readyState&&!window.attachEvent?a():document.addEventListener("DOMContentLoaded",a))}();
//# sourceMappingURL=runtime.min.js.map;
define("bower_components/versal-component-runtime/dist/runtime.min", function(){});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define('plugins/vs-element-seeing-observer',['cdn.jquery', 'cdn.underscore', 'app/mediator', 'state/position', 'bower_components/versal-component-runtime/dist/runtime.min'], function($, _, mediator, currentPosition) {
    var ElementSeeingObserver, SECTION_TYPE;
    SECTION_TYPE = 'versal/header';
    return ElementSeeingObserver = (function() {
      ElementSeeingObserver.prototype._viewportBottomOffset = 28;

      ElementSeeingObserver.prototype._delay = 150;

      function ElementSeeingObserver(el) {
        this.el = el;
        this._observeCurrentSection = __bind(this._observeCurrentSection, this);
        this._viewportChanged = __bind(this._viewportChanged, this);
        if (!this.el) {
          return;
        }
        this._debouncedViewportChanged = _.debounce(this._viewportChanged, this._delay);
        $(this.el).on('scroll', this._debouncedViewportChanged);
        $(this.el).on('scroll', this._observeCurrentSection);
        $(window).on('resize', this._debouncedViewportChanged);
      }

      ElementSeeingObserver.prototype.destroy = function() {
        $(this.el).off('scroll', this._debouncedViewportChanged);
        $(this.el).off('scroll', this._observeCurrentSection);
        return $(window).off('resize', this._debouncedViewportChanged);
      };

      ElementSeeingObserver.prototype._viewportChanged = function() {
        var gadgetElements;
        gadgetElements = this.el.querySelectorAll('.gadget');
        return _.each(gadgetElements, (function(_this) {
          return function(gadget) {
            var inViewport;
            if (gadget.hasAttribute('element-was-seen')) {
              return;
            }
            inViewport = _this._isInViewport(gadget, window.innerHeight);
            if (inViewport) {
              gadget.dispatchEvent(new CustomEvent('elementWasSeen'));
              return gadget.setAttribute('element-was-seen', 1);
            }
          };
        })(this));
      };

      ElementSeeingObserver.prototype._isInViewport = function(el, end) {
        var fuzzyEnd, rect;
        fuzzyEnd = end + 10;
        rect = el.getBoundingClientRect();
        return rect.bottom < fuzzyEnd;
      };

      ElementSeeingObserver.prototype._observeCurrentSection = function(el) {
        var current, sections, viewport;
        viewport = this.el.getBoundingClientRect();
        sections = this.el.querySelectorAll(".gadget[data-type='" + SECTION_TYPE + "']");
        current = null;
        _.each(sections, function(section) {
          if (section.getBoundingClientRect().top <= viewport.top) {
            return current = section;
          }
        });
        if (this.el.scrollTop >= (this.el.scrollHeight - this.el.offsetHeight - this._viewportBottomOffset)) {
          current = _.last(sections);
        }
        if (current) {
          return currentPosition.set('gadgetCid', current.getAttribute('data-cid'));
        } else {
          return currentPosition.unset('gadgetCid');
        }
      };

      return ElementSeeingObserver;

    })();
  });

}).call(this);


define('text!templates/layout.html',[],function () { return '<div>\n  <header class="header-container js-header-container"></header>\n\n  <aside class="sidebar-container js-sidebar-container"></aside>\n\n  <div class="main-container js-main-container">\n    <div class="course-container js-course-container"></div>\n  </div>\n\n  <div class="tray-container js-tray-container"></div>\n  <footer class="footer-container js-footer-container"></footer>\n\n  <div class="dialogs"></div>\n  <div class="loading-container js-loading-container"></div>\n</div>\n';});

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/player_layout',['cdn.marionette', 'cdn.jquery', 'app/mediator', 'plugins/vs-sticky', 'plugins/vs-element-seeing-observer', 'text!templates/layout.html'], function(Marionette, $, mediator, StickyHeaders, ElementSeeingObserver, template) {
    var PlayerLayout;
    return PlayerLayout = (function(_super) {
      __extends(PlayerLayout, _super);

      function PlayerLayout() {
        return PlayerLayout.__super__.constructor.apply(this, arguments);
      }

      PlayerLayout.prototype.template = template;

      PlayerLayout.prototype.regions = {
        header: '.js-header-container',
        sidebar: '.js-sidebar-container',
        dialogs: '.dialogs',
        courseContainer: '.js-course-container',
        tray: '.js-tray-container',
        footer: '.js-footer-container',
        loading: '.js-loading-container'
      };

      PlayerLayout.prototype.ui = {
        mainContainer: '.js-main-container'
      };

      PlayerLayout.prototype.events = {
        'click': 'onClick'
      };

      PlayerLayout.prototype.initialize = function() {
        this.listenTo(mediator, 'tray:expanded', function(expanded) {
          return this.$el.toggleClass('tray-expanded', expanded);
        });
        this.listenTo(mediator, 'toc:toggle', this.toggleSidebar);
        this.listenTo(mediator, 'gadget:dragstart', function() {
          return this.$el.addClass('drag-in-progress');
        });
        this.listenTo(mediator, 'gadget:dragend', function() {
          return this.$el.removeClass('drag-in-progress');
        });
        this.listenTo(mediator, 'gadget:editing:start', function() {
          this.$el.addClass('edit-in-progress');
          return this.toggleSidebar(false);
        });
        this.listenTo(mediator, 'gadget:editing:stop', function() {
          return this.$el.removeClass('edit-in-progress');
        });
        this.listenTo(mediator, 'course:collab:open', function() {
          return this.$el.addClass('collab-connected');
        });
        return this.listenTo(mediator, 'course:collab:close', function() {
          return this.$el.removeClass('collab-connected');
        });
      };

      PlayerLayout.prototype.onRender = function() {
        var e, sticky;
        try {
          sticky = new StickyHeaders(this.ui.mainContainer.get(0));
          this.listenTo(mediator, 'lesson:closed', sticky != null ? sticky.refresh.bind(sticky) : void 0);
        } catch (_error) {
          e = _error;
          console.warn('Sticky headers:', e);
        }
        return new ElementSeeingObserver(this.ui.mainContainer.get(0));
      };

      PlayerLayout.prototype.onClick = function(e) {
        if ($(e.target).parents('.js-sidebar-container').length > 0) {
          return;
        }
        return this.toggleSidebar(false);
      };

      PlayerLayout.prototype.toggleSidebar = function(toggle) {
        return this.$el.toggleClass('sidebar-expanded', toggle);
      };

      return PlayerLayout;

    })(Marionette.Layout);
  });

}).call(this);

(function() {
  define('plugins/backbone.prioritize',[], function() {
    return function(priority) {
      return function(a, b) {
        var ca, cb, ha, hb, pa, pb;
        pa = priority.indexOf(a.get('title'));
        pb = priority.indexOf(b.get('title'));
        ca = a.get('catalog');
        cb = b.get('catalog');
        if (ca === 'approved' && cb === 'sandbox') {
          return -1;
        }
        if (ca === 'sandbox' && cb === 'approved') {
          return 1;
        }
        ha = a.get('hidden');
        hb = b.get('hidden');
        if (hb && !ha) {
          return -1;
        }
        if (ha && !hb) {
          return 1;
        }
        if (pa === pb) {
          return 0;
        }
        if (0 <= pb && pb < pa) {
          return 1;
        }
        if (pb >= 0 && pa < 0) {
          return 1;
        }
        return -1;
      };
    };
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('collections/gadget_projects',['cdn.backbone', 'cdn.underscore', 'models/gadget_project'], function(Backbone, _, GadgetProject) {
    var GadgetProjects;
    return GadgetProjects = (function(_super) {
      __extends(GadgetProjects, _super);

      function GadgetProjects() {
        return GadgetProjects.__super__.constructor.apply(this, arguments);
      }

      GadgetProjects.prototype.model = GadgetProject;

      GadgetProjects.prototype.url = function() {
        return '/gadgets';
      };

      GadgetProjects.prototype.fetchFiltered = function(query, params) {
        var data, options;
        if (params == null) {
          params = {};
        }
        data = _.extend({}, params.data, query);
        options = _.extend({}, params, {
          data: data
        });
        return this.fetch(options);
      };

      GadgetProjects.prototype.fetchApproved = function(params) {
        return this.fetchFiltered({
          catalog: 'approved'
        }, params);
      };

      GadgetProjects.prototype.fetchSandbox = function(params) {
        return this.fetchFiltered({
          user: 'me',
          catalog: 'sandbox'
        }, params);
      };

      GadgetProjects.prototype.findByType = function(type) {
        var filter, gadgetType, name, username, version, _ref, _ref1;
        _ref = type.split('@'), gadgetType = _ref[0], version = _ref[1];
        _ref1 = gadgetType.split('/'), username = _ref1[0], name = _ref1[1];
        filter = {
          username: username,
          name: name
        };
        if (version) {
          filter.version = version;
        }
        return this.findWhere(filter);
      };

      return GadgetProjects;

    })(Backbone.Collection);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('app/combined_catalogue',['cdn.jquery', 'app/mediator', 'plugins/backbone.prioritize', 'collections/gadget_projects'], function($, mediator, prioritize, GadgetProjects) {
    var CombinedCatalogue, preferredGadgets;
    preferredGadgets = ['Section header', 'Header', 'Text', 'Image', 'Video', 'Wolfram', 'Quiz', 'Expression', 'Data viewer', 'References', 'Map', 'Markdown', 'Image annotator', 'Image detail', 'Color bar', 'R0', '3D anatomy', 'Cellular automaton', 'Principle of superposition'];
    return CombinedCatalogue = (function(_super) {
      __extends(CombinedCatalogue, _super);

      function CombinedCatalogue() {
        return CombinedCatalogue.__super__.constructor.apply(this, arguments);
      }

      CombinedCatalogue.prototype.initialize = function() {
        this.ready = new $.Deferred();
        return mediator.on('catalog:findByType', (function(_this) {
          return function(type, callback) {
            var project;
            console.warn('mediator catalog:findByType is obsolete');
            project = _this.findByType(type);
            if (project == null) {
              throw new Error('Unknown gadget project of type: ' + type);
            }
            return callback(project);
          };
        })(this));
      };

      CombinedCatalogue.prototype.fetchAll = function(opts) {
        var comparator;
        if (opts == null) {
          opts = {};
        }
        comparator = prioritize(preferredGadgets);
        this.approved = new GadgetProjects([], {
          comparator: comparator
        });
        this.sandbox = new GadgetProjects;
        return $.when(this.approved.fetchApproved(), this.sandbox.fetchSandbox()).then((function(_this) {
          return function() {
            var addAs;
            addAs = function(catalog, collection) {
              return _this.add(collection.models.map(function(m) {
                if (!m.get('catalog')) {
                  m.set({
                    catalog: catalog
                  });
                }
                return m;
              }));
            };
            addAs('approved', _this.approved);
            addAs('sandbox', _this.sandbox);
            _this.trigger('reset');
            _this.trigger('sync');
            return _this.ready.resolve();
          };
        })(this));
      };

      return CombinedCatalogue;

    })(GadgetProjects);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('collections/gadgets',['cdn.backbone', 'cdn.underscore', 'models/gadget'], function(Backbone, _, Gadget) {
    var Gadgets;
    return Gadgets = (function(_super) {
      __extends(Gadgets, _super);

      function Gadgets() {
        return Gadgets.__super__.constructor.apply(this, arguments);
      }

      Gadgets.prototype.model = Gadget;

      Gadgets.prototype.url = function() {
        if (this.lesson) {
          return _.result(this.lesson, 'url') + '/gadgets';
        }
      };

      Gadgets.prototype.initialize = function(models, options) {
        return this.lesson = options && options.lesson ? options.lesson : void 0;
      };

      return Gadgets;

    })(Backbone.Collection);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/lesson',['cdn.backbone', 'cdn.underscore', 'collections/gadgets'], function(Backbone, _, Gadgets) {
    var Lesson;
    return Lesson = (function(_super) {
      __extends(Lesson, _super);

      Lesson.prototype.defaults = {
        title: 'Untitled lesson',
        isActive: false
      };

      Lesson.prototype._locals = ['isActive'];

      function Lesson(attrs, options) {
        if (attrs == null) {
          attrs = {};
        }
        if (options == null) {
          options = {};
        }
        this.gadgets = new Gadgets([], {
          lesson: this
        });
        options.parse = true;
        this.debouncedSave = _.debounce(this.save.bind(this), 1000);
        Lesson.__super__.constructor.call(this, attrs, options);
      }

      Lesson.prototype.parse = function(attrs) {
        if (!attrs) {
          return;
        }
        if (attrs.gadgets) {
          this.gadgets.reset(attrs.gadgets, {
            parse: true
          });
        }
        return _.omit(attrs, 'gadgets', this._locals);
      };

      Lesson.prototype.validate = function(attrs, options) {
        if (!attrs.title) {
          return 'Title must be not empty';
        }
      };

      Lesson.prototype.toJSON = function(options) {
        var result;
        result = _.clone(this.attributes);
        if (options != null ? options.gadgets : void 0) {
          result.gadgets = this.gadgets.toJSON();
        }
        return _.omit(result, this._locals);
      };

      Lesson.prototype.url = function() {
        if (this.id == null) {
          console.warn("Tried to get lesson URL while it doesn't have an ID yet");
        }
        return Lesson.__super__.url.apply(this, arguments);
      };

      return Lesson;

    })(Backbone.Model);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('collections/lessons',['cdn.backbone', 'cdn.underscore', 'models/lesson'], function(Backbone, _, Lesson) {
    var Lessons;
    return Lessons = (function(_super) {
      __extends(Lessons, _super);

      function Lessons() {
        return Lessons.__super__.constructor.apply(this, arguments);
      }

      Lessons.prototype.model = Lesson;

      Lessons.prototype.url = function() {
        if (this.course) {
          return _.result(this.course, 'url') + '/lessons';
        }
      };

      Lessons.prototype.initialize = function(models, options) {
        if (!(options != null ? options.course : void 0)) {
          throw new Error('Course reference is mandatory for the Lessons');
        }
        return this.course = options.course;
      };

      return Lessons;

    })(Backbone.Collection);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('collections/gadget_palette',['cdn.jquery', 'cdn.backbone', 'cdn.underscore', 'collections/gadget_projects'], function($, Backbone, _, GadgetProjects) {
    var GadgetPalette;
    return GadgetPalette = (function(_super) {
      __extends(GadgetPalette, _super);

      function GadgetPalette() {
        return GadgetPalette.__super__.constructor.apply(this, arguments);
      }

      GadgetPalette.prototype.initialize = function(models, options) {
        if (options == null) {
          options = {};
        }
        if (options != null ? options.course : void 0) {
          return this.url = function() {
            return _.result(options.course, 'url') + '/palette';
          };
        }
      };

      GadgetPalette.prototype.upgrade = function(type, opts) {
        return this.changeVersion(type, null, opts);
      };

      GadgetPalette.prototype.changeVersion = function(type, version, opts) {
        var gadgetProject, url;
        if (opts == null) {
          opts = {};
        }
        gadgetProject = this.findByType(type);
        if (!gadgetProject) {
          return $.Deferred().reject("Gadget project not found");
        }
        url = gadgetProject.url();
        opts.url || (opts.url = url);
        if (!version) {
          version = gadgetProject.get('latestVersion');
        }
        return gadgetProject.save({
          version: version
        }, opts);
      };

      return GadgetPalette;

    })(GadgetProjects);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('collections/users',['cdn.backbone', 'models/user'], function(Backbone, User) {
    var Users;
    return Users = (function(_super) {
      __extends(Users, _super);

      function Users() {
        return Users.__super__.constructor.apply(this, arguments);
      }

      Users.prototype.model = User;

      Users.prototype.url = function() {
        return '/users';
      };

      return Users;

    })(Backbone.Collection);
  });

}).call(this);

(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('models/course',['cdn.backbone', 'cdn.underscore', 'collections/lessons', 'collections/gadget_palette', 'collections/users'], function(Backbone, _, Lessons, GadgetPalette, Users) {
    var Course;
    return Course = (function(_super) {
      __extends(Course, _super);

      Course.prototype.urlRoot = '/courses';

      Course.prototype.defaults = {
        title: 'Untitled course',
        isEditable: false,
        shortDesc: '',
        longDesc: '',
        authorBio: '',
        tags: [],
        catalogs: []
      };

      function Course(attrs, options) {
        if (attrs == null) {
          attrs = {};
        }
        if (options == null) {
          options = {};
        }
        this.authors = new Users;
        this.authors.url = (function(_this) {
          return function() {
            return _.result(_this, 'url') + '/users';
          };
        })(this);
        this.lessons = new Lessons([], {
          course: this
        });
        this.progress = new Backbone.Model;
        this.progress.isNew = function() {
          return false;
        };
        this.progress.url = (function(_this) {
          return function() {
            return _.result(_this, 'url') + '/progress';
          };
        })(this);
        this.palette = new GadgetPalette([], {
          course: this
        });
        this.debouncedSave = _.debounce(this.save.bind(this), 1000);
        options.parse = true;
        Backbone.Model.call(this, attrs, options);
      }

      Course.prototype.parse = function(attrs) {
        if (attrs.authors) {
          this.authors.set(attrs.authors, {
            parse: true
          });
        }
        if (attrs.lessons) {
          this.lessons.set(attrs.lessons, {
            parse: true
          });
        }
        if (attrs.palette) {
          this.palette.set(attrs.palette, {
            parse: true
          });
        }
        if (attrs.currentPosition) {
          this.progress.set({
            lessonIndex: attrs.currentPosition.currentLesson
          });
        }
        return _.omit(attrs, 'lessons', 'authors', 'progress', 'palette');
      };

      Course.prototype.toJSON = function(options) {
        var result;
        if (options == null) {
          options = {};
        }
        result = _.clone(this.attributes);
        result.isPublished = this._isPublished();
        if (options.lessons) {
          result.lessons = this.lessons.toJSON(options);
        }
        if (options.palette) {
          result.palette = this.palette.toJSON(options);
        }
        return result;
      };

      Course.prototype.validate = function(attrs, options) {
        if (!attrs.title) {
          return 'Title must be not empty';
        }
      };

      Course.prototype.start = function(options) {
        if (options == null) {
          options = {};
        }
        options.attrs = {};
        options.url = _.result(this, 'url') + '/start';
        return this.sync('create', this, options);
      };

      Course.prototype.complete = function(options) {
        if (options == null) {
          options = {};
        }
        options.attrs = {};
        options.url = _.result(this, 'url') + '/completion';
        return this.sync('update', this, options);
      };

      Course.prototype.isStaged = function() {
        return _.contains(this.get('catalogs'), 'staged');
      };

      Course.prototype._isPublished = function() {
        return this.isStaged() || _.contains(this.get('catalogs'), 'labs');
      };

      Course.prototype.title = function() {
        return this.get('title') || 'Untitled course';
      };

      return Course;

    })(Backbone.Model);
  });

}).call(this);


define('text!templates/asset_picker/asset_picker.html',[],function () { return '<div class="assets-modal modal">\n  <div class="header">\n    <div class="modal-title">file picker</div>\n    <div class="modal-controls">\n      <button class="cancel js-close">cancel</button>\n      <button class="action js-use-file js-upload">use file</button>\n    </div>\n    <div class="clearfix"></div>\n  </div>\n  <div class="content">\n    <div class="preview-region">\n      <% if(allowUploading()) { %>\n        <div class="uploading-overlay">\n          <div class="uploading-spinner"></div>\n        </div>\n         <div class="choose-overlay">\n          <div class="drop-image"></div>\n          <div class="drop-blurb">\n            drag file here\n            <span class="click-blurb">or click to upload</span>\n          </div>\n          <div class="dropzone"></div>\n        </div>\n        <input class="hidden-uploader" type="file">\n      <% } %>\n      <div class="file-preview"></div>\n      <div class="status-message"></div>\n    </div>\n    <% if (getType() == "video") { %>\n      <input class="video-link" placeholder="paste YouTube or Vimeo link" />\n    <% } %>\n  </div>\n</div>\n<div class="modal-backdrop"></div>\n';});

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define('views/asset_picker/asset_picker',['app/mediator', 'libs/vs.ui', 'plugins/tracker', 'cdn.marionette', 'text!templates/asset_picker/asset_picker.html', 'views/modal', 'models/asset'], function(mediator, ui, tracker, Marionette, template, Modal, Asset) {
    var AssetPickerView;
    return AssetPickerView = (function(_super) {
      __extends(AssetPickerView, _super);

      function AssetPickerView() {
        this.onUploadError = __bind(this.onUploadError, this);
        this.onAssetRefetchError = __bind(this.onAssetRefetchError, this);
        this.onAssetRefetch = __bind(this.onAssetRefetch, this);
        this.onUploadSuccess = __bind(this.onUploadSuccess, this);
        this.onDrop = __bind(this.onDrop, this);
        this.templateHelpers = __bind(this.templateHelpers, this);
        return AssetPickerView.__super__.constructor.apply(this, arguments);
      }

      AssetPickerView.prototype.template = _.template(template);

      AssetPickerView.prototype.templateHelpers = function() {
        return {
          getType: (function(_this) {
            return function() {
              return _this.type;
            };
          })(this),
          allowUploading: (function(_this) {
            return function() {
              return _this.type !== 'video';
            };
          })(this)
        };
      };

      AssetPickerView.prototype.initialize = function(options) {
        this.options = options;
        $(window).on('dragenter dragexit dragover dragleave drop', this._prevent);
        this.type = this.options.type;
        if (!this.type) {
          throw new Error("Asset type is required");
        }
        return this.formats = this.type === 'image' ? ['jpg', 'jpeg', 'png', 'gif'] : this.type === 'video' ? ['mp4', 'ogg', 'webm', 'avi', 'mov'] : void 0;
      };

      AssetPickerView.prototype.ui = {
        preview: '.preview-region',
        filePreview: '.file-preview',
        uploading: '.uploading-overlay',
        choose: '.choose-overlay',
        status: '.status-message',
        useButton: '.js-use-file',
        spinner: '.uploading-spinner',
        hiddenUploader: '.hidden-uploader',
        videoInput: '.video-link'
      };

      AssetPickerView.prototype.events = _.extend({}, AssetPickerView.prototype.events, {
        'click .choose-overlay': 'onChooseClick',
        'dragenter .dropzone': 'onOverlayDragEnter',
        'dragleave .dropzone': 'onOverlayDragLeave',
        'dragenter .preview-region': 'onRegionDragEnter',
        'dragexit .dropzone': '_prevent',
        'dragover .dropzone': '_prevent',
        'drop .dropzone': 'onDrop',
        'click .js-use-file': 'onUseClick',
        'input .video-link': 'onVideoInputChange',
        'paste .video-link': 'onVideoInputChange'
      });

      AssetPickerView.prototype.onOverlayDragEnter = function(e) {
        this.ui.choose.addClass('dragenter');
        return e.preventDefault();
      };

      AssetPickerView.prototype.onOverlayDragLeave = function(e) {
        this.ui.choose.removeClass('dragenter fromRegion');
        if (this.hasFile) {
          this.ui.choose.hide();
        }
        return e.preventDefault();
      };

      AssetPickerView.prototype.onRegionDragEnter = function(e) {
        if (!this.hasFile) {
          return;
        }
        this.ui.choose.addClass('dragenter fromRegion');
        this.ui.choose.show();
        return e.preventDefault();
      };

      AssetPickerView.prototype.onDrop = function(event) {
        var e, _ref;
        e = event.originalEvent;
        e.stopPropagation();
        e.preventDefault();
        if (e.dataTransfer.files.length) {
          return this.onChooseComplete((_ref = e.dataTransfer.files) != null ? _ref[0] : void 0);
        }
      };

      AssetPickerView.prototype.showStatus = function(message, error) {
        if (error == null) {
          error = false;
        }
        this.ui.status.toggleClass('error', error);
        return this.ui.status.text(message);
      };

      AssetPickerView.prototype.showPreviewError = function(message) {
        return this.ui.filePreview.text(message);
      };

      AssetPickerView.prototype.showUploading = function() {
        this.ui.choose.hide();
        this.ui.uploading.show();
        if (!this.indicator) {
          this.indicator = new ui.LoadingIndicator(this.ui.spinner, '#fff');
        }
        return this.showStatus('uploading...');
      };

      AssetPickerView.prototype.showChoose = function() {
        this.ui.uploading.hide();
        this.ui.choose.show();
        this.showStatus("Accepted file types: " + (this.formats.join(', ')));
        return this.hasFile = false;
      };

      AssetPickerView.prototype.showFilePreview = function(file) {
        var sizeMb;
        sizeMb = file.size / (1024 * 1024);
        if (sizeMb > 5) {
          return this.showPreviewError('File too large to preview');
        }
        if (typeof FileReader !== "undefined" && FileReader !== null) {
          this.fr = new FileReader();
          this.fr.onload = (function(_this) {
            return function(e) {
              return _this.onPreviewLoaded.call(_this, e, file);
            };
          })(this);
          return this.fr.readAsDataURL(file);
        } else {
          return this.showPreviewError('No preview available');
        }
      };

      AssetPickerView.prototype.onPreviewLoaded = function(e, file) {
        var v;
        if (file.type.split('/')[0] !== this.type) {
          return this.showPreviewError('No preview available');
        } else if (this.type === "image") {
          return this.ui.filePreview.html($('<img>').attr('src', e.target.result));
        } else if (this.type === "video") {
          v = $('<video>')[0];
          if (!!(v.canPlayType && v.canPlayType(file.type).replace(/no/, ''))) {
            return this.ui.filePreview.html("<video preload='metadata' controls='controls'>\n  <source src='" + e.target.result + "'>\n</video>");
          } else {
            return this.showPreviewError('No preview available');
          }
        }
      };

      AssetPickerView.prototype.onUploadSuccess = function(asset) {
        var omitLocation, representations, _base;
        this.ui.uploading.hide();
        omitLocation = _.partial(_.omit, _, 'location');
        representations = _.map(asset.representations.toJSON(), omitLocation);
        this.assetJSON = _.extend(asset.toJSON(), {
          representations: representations
        });
        this.showStatus('processing...');
        if (typeof (_base = this.options).processing === "function") {
          _base.processing();
        }
        return this.checkProcessingStatus(asset);
      };

      AssetPickerView.prototype.checkProcessingStatus = function(asset) {
        return asset.fetch({
          success: this.onAssetRefetch,
          error: this.onAssetRefetchError
        });
      };

      AssetPickerView.prototype.onAssetRefetch = function(asset) {
        if (asset.representations.findWhere({
          available: false
        })) {
          return _.delay(this.checkProcessingStatus.bind(this), 3000, asset);
        } else {
          return this.onProcessingComplete();
        }
      };

      AssetPickerView.prototype.onAssetRefetchError = function(asset) {
        return this.showStatus('Server error', true);
      };

      AssetPickerView.prototype.onProcessingComplete = function(asset) {
        this.ui.useButton.prop('disabled', false);
        return this.showStatus('Processing complete');
      };

      AssetPickerView.prototype.onUploadError = function() {
        this.ui.uploading.hide();
        return this.showStatus('Error uploading', true);
      };

      AssetPickerView.prototype.onChooseClick = function() {
        this.ui.hiddenUploader.one('change', (function(_this) {
          return function() {
            var _ref;
            return _this.onChooseComplete((_ref = _this.ui.hiddenUploader[0].files) != null ? _ref[0] : void 0);
          };
        })(this));
        return this.ui.hiddenUploader.click();
      };

      AssetPickerView.prototype.onChooseComplete = function(file) {
        var asset, attributes, contentType, extension, saving;
        if (!file) {
          return this.showStatus('No file chosen', true);
        }
        extension = _.last(file.name.split('.'));
        if (!_.contains(this.formats, extension.toLowerCase())) {
          return this.showStatus("Unsupported file type chosen. Acceptable formats: " + (this.formats.join(', ')), true);
        }
        contentType = file.type || ("" + this.type + "/x-" + extension);
        attributes = {
          title: 'New File',
          tags: [this.type],
          content: file,
          contentType: contentType
        };
        asset = new Asset;
        saving = asset.save(attributes, {
          upload: true,
          success: this.onUploadSuccess,
          error: this.onUploadError
        });
        tracker.timeXHR(saving, 'upload-asset', {
          contentType: contentType,
          name: file.name
        });
        this.showUploading();
        this.ui.videoInput.css({
          "visibility": "hidden"
        });
        this.showFilePreview(file);
        return this.hasFile = true;
      };

      AssetPickerView.prototype.onUseClick = function() {
        this.options.success(this.assetJSON);
        this.close();
        return tracker.track('use-asset', {
          assetJSON: this.assetJSON
        });
      };

      AssetPickerView.prototype.close = function() {
        $(window).off('dragenter dragexit dragover dragleave drop', this._prevent);
        return AssetPickerView.__super__.close.apply(this, arguments);
      };

      AssetPickerView.prototype.onVideoInputChange = function() {
        var input, vimId, ytId;
        input = this.ui.videoInput.val();
        if (this.oldInput === input) {
          return;
        }
        this.oldInput = input;
        if (input.length === 0) {
          this.render();
          this.ui.videoInput.focus();
          return;
        }
        ytId = this.getYoutubeId(input);
        vimId = this.getVimeoId(input);
        if (ytId || vimId) {
          this.ui.choose.hide();
          this.ui.useButton.prop('disabled', false);
          this.showStatus("");
        }
        if (ytId) {
          this.assetJSON = {
            type: "youtube",
            youtube_id: ytId
          };
          return this.ui.filePreview.html(this.getYoutubeEmbed(ytId));
        } else if (vimId) {
          this.assetJSON = {
            type: "vimeo",
            vimeo_id: vimId
          };
          return this.ui.filePreview.html(this.getVimeoEmbed(vimId));
        } else {
          this.showStatus("That is not a valid YouTube or Vimeo video url", true);
          return this.ui.useButton.prop('disabled', true);
        }
      };

      AssetPickerView.prototype.getYoutubeId = function(input) {
        var ytRegex, _ref;
        ytRegex = /(?:(?:https?:\/\/)?(?:[a-zA_Z]{2,3}.)?)?(?:(?:youtube\.com\/watch\?)(?:[a-z=_&]+|(?:[\w\d\-\_\=]+&amp;(?:amp;)?))*v(?:&lt;[A-Z]+&gt;)?=|youtu.be\/)([0-9a-zA-Z\-\_]+)/;
        return (_ref = input.match(ytRegex)) != null ? _ref[1] : void 0;
      };

      AssetPickerView.prototype.getVimeoId = function(input) {
        var vimeoRegex, _ref;
        vimeoRegex = /(?:(?:https?:\/\/)?(?:[a-zA_Z]{2,3}.)?)?(?:vimeo\.com\/)([0-9]+)/;
        return (_ref = input.match(vimeoRegex)) != null ? _ref[1] : void 0;
      };

      AssetPickerView.prototype.onRender = function() {
        AssetPickerView.__super__.onRender.apply(this, arguments);
        this.ui.useButton.prop('disabled', true);
        return this.showChoose();
      };

      AssetPickerView.prototype.getEmbedCode = function(type) {
        var videos;
        if (type === 'asset') {
          videos = _.filter(this.get("representations"), function(rep) {
            return rep.contentType.indexOf("video/") === 0;
          });
          videos = _.sortBy(videos, function(v) {
            if (v.contentType === 'video/webm') {
              return 0;
            } else {
              return 1;
            }
          });
          return _.template('<video class="myVideo" preload="none" controls="controls">\n  <% _.each(videos, function(vid) { %>\n    <source src="<%= vid.location %>" type="<%= vid.contentType %>">\n  <% }) %>\n</video>', {
            videos: videos
          });
        }
      };

      AssetPickerView.prototype.getYoutubeEmbed = function(ytId) {
        return '<iframe id="ytplayer" type="text/html" width="100%" height="100%" src="//www.youtube.com/embed/' + ytId + '" frameborder="0"/>';
      };

      AssetPickerView.prototype.getVimeoEmbed = function(vimId) {
        return '<iframe src="//player.vimeo.com/video/' + vimId + '" width="100%" height="100%" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';
      };

      return AssetPickerView;

    })(Modal);
  });

}).call(this);

(function() {
  define('messages/handlers/asset_select',['cdn.jquery', 'views/asset_picker/asset_picker'], function($, AssetPickerView) {
    return function(message, options) {
      var mediator, view;
      mediator = this;
      view = new AssetPickerView(_.pick(message, 'success', 'type', 'processing'));
      return $('body').append(view.render().$el);
    };
  });

}).call(this);

(function() {
  define('messages/handlers/parent_notify',[], function() {
    return function(data) {
      return window.parent.postMessage(JSON.stringify(data), '*');
    };
  });

}).call(this);

(function() {
  define('messages/decorate',['app/mediator', 'messages/handlers/asset_select', 'messages/handlers/parent_notify'], function(mediator, assetSelectHandler, parentNotifyHandler) {
    var handlers;
    handlers = {
      'asset:select': assetSelectHandler,
      'parent:notify': parentNotifyHandler
    };
    return _.each(handlers, function(handler, signal) {
      return mediator.on(signal, handler, mediator);
    });
  });

}).call(this);

(function() {
  define('app/legacy-gadget-dependencies',['cdn.underscore', 'cdn.jquery', 'cdn.backbone', 'cdn.marionette', 'cdn.processing', 'cdn.raphael', 'cdn.hogan', 'cdn.jqueryui', 'cdn.underscore.mixins'], function(_, $, Backbone, Marionette, Processing, Raphael, Hogan) {
    window._ = _;
    window.$ = $;
    window.Backbone = Backbone;
    window.Marionette = Marionette;
    window.Processing = Processing;
    window.Raphael = Raphael;
    window.Hogan = Hogan;
    return null;
  });

}).call(this);

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define('player',['cdn.underscore', 'cdn.jquery', 'cdn.marionette', 'app/models/patch_backbone_sync', 'plugins/vs.collab', 'views/course', 'views/sidebar/author', 'views/sidebar/learner', 'views/tray/tray', 'views/tray/tray_filters', 'views/header', 'views/player_layout', 'app/combined_catalogue', 'views/loading', 'app/mediator', 'plugins/tracker', 'models/settings', 'libs/keen', 'libs/analytics', 'collections/gadget_projects', 'models/course', 'messages/decorate', 'libs/modernizr', 'libs/vs.ui', 'bower_components/versal-component-runtime/dist/runtime.min', 'app/legacy-gadget-dependencies'], function(_, $, Marionette, patchBackboneSync, collab, CourseView, AuthorSidebarView, LearnerSidebarView, TrayView, TrayFiltersView, HeaderView, PlayerLayoutView, CombinedCatalogue, LoadingView, mediator, tracker, settings, Keen, analytics, GadgetProjects, Course) {
    var PlayerApplication;
    return PlayerApplication = (function() {
      function PlayerApplication(options) {
        this._onNavigateGadget = __bind(this._onNavigateGadget, this);
        this._onNavigateLesson = __bind(this._onNavigateLesson, this);
        this.onCourseLoad = __bind(this.onCourseLoad, this);
        this._onLearnerStateChanged = __bind(this._onLearnerStateChanged, this);
        var $el, containerSelector, courseId;
        if (options) {
          settings.set(options);
        }
        patchBackboneSync(settings.get('api'));
        $(document).ajaxError(function() {
          return mediator.trigger('course:save:error');
        });
        $(document).ajaxSuccess(function() {
          return mediator.trigger('course:save:success');
        });
        this._installBowerStylesAndScripts();
        this._courseRendering = $.Deferred();
        this._courseRendering.done((function(_this) {
          return function() {
            return mediator.trigger('course:rendered', _this.courseView);
          };
        })(this));
        courseId = settings.get('courseId');
        this.installNavigation(courseId);
        containerSelector = settings.get('container');
        $el = $(containerSelector);
        $el.addClass('versal-player js-versal-player');
        this.layout = new PlayerLayoutView({
          el: $el.get(0)
        });
        this.layout.render();
        this.loadingView = new LoadingView;
        this.layout.loading.show(this.loadingView);
        mediator.on('lesson:allGadgetsRendered', this._onAllGadgetsRendered, this);
        this.combinedCatalogue = new CombinedCatalogue;
        this.combinedCatalogue.fetchAll();
        if (courseId) {
          this.loadCourse(courseId);
        }
      }

      PlayerApplication.prototype._installDependency = function(type, path) {
        var tag;
        if (type === 'stylesheet') {
          tag = document.createElement('link');
          tag.rel = 'stylesheet';
          tag.href = path;
        } else {
          tag = document.createElement('script');
          tag.src = path;
        }
        return document.head.appendChild(tag);
      };

      PlayerApplication.prototype._installBowerStylesAndScripts = function() {
        this._installDependency('script', 'bower_components/versal-gadget-launchers/iframe-launcher/iframe-launcher.js');
        this._installDependency('stylesheet', 'bower_components/versal-gadget-launchers/iframe-launcher/iframe-launcher.css');
        this._installDependency('script', 'bower_components/versal-gadget-launchers/legacy-launcher/legacy-launcher.js');
        this._installDependency('stylesheet', 'bower_components/versal-gadget-launchers/legacy-launcher/legacy-launcher.css');
        this._installDependency('script', 'bower_components/versal-gadget-launchers/component-launcher/component-launcher.js');
        return this._installDependency('stylesheet', 'bower_components/versal-gadget-launchers/component-launcher/component-launcher.css');
      };

      PlayerApplication.prototype._onLearnerStateChanged = function(e) {
        var position;
        if (e.data.event === 'learnerStateChanged') {
          position = e.data.data;
          if (position.gadgetIndex != null) {
            return this._showGadget(position.lessonIndex, position.gadgetIndex);
          } else if (position.lessonIndex != null) {
            return this._showLesson(position.lessonIndex);
          } else {
            return this._courseRendering.done((function(_this) {
              return function() {
                var gadgetIndex, lessonIndex;
                lessonIndex = _this.course.progress.get('lessonIndex') || 1;
                gadgetIndex = _this.course.progress.get('gadgetIndex');
                return window.parent.postMessage({
                  event: 'setLearnerState',
                  data: {
                    lessonIndex: lessonIndex,
                    gadgetIndex: gadgetIndex
                  }
                }, '*');
              };
            })(this));
          }
        }
      };

      PlayerApplication.prototype.installNavigation = function(courseId) {
        this.uninstallNavigation();
        mediator.on('navigate:lesson', this._onNavigateLesson);
        mediator.on('navigate:gadget', this._onNavigateGadget);
        return window.addEventListener('message', this._onLearnerStateChanged);
      };

      PlayerApplication.prototype.uninstallNavigation = function() {
        window.removeEventListener('message', this._onLearnerStateChanged);
        if (this._onNavigateLesson) {
          mediator.off('navigate:lesson', this._onNavigateLesson);
        }
        if (this._onNavigateGadget) {
          return mediator.off('navigate:gadget', this._onNavigateGadget);
        }
      };

      PlayerApplication.prototype.close = function() {
        this.layout.sidebar.close();
        this.uninstallNavigation();
        return mediator.off('lesson:allGadgetsRendered', this._onAllGadgetsRendered, this);
      };

      PlayerApplication.prototype.initializeCollab = function() {
        if (settings.get('collabUrl')) {
          return collab.init(mediator, settings.toJSON());
        }
      };

      PlayerApplication.prototype.loadCourse = function(courseId) {
        var courseBaseUrl, courseFetch, courseModel;
        courseModel = new Course({
          id: courseId
        });
        if (settings.get('revision')) {
          courseBaseUrl = courseModel.url();
          courseModel.url = (function(_this) {
            return function() {
              return '/catalogs/staged' + courseBaseUrl;
            };
          })(this);
        }
        courseFetch = courseModel.fetch({
          data: {
            depth: 'sections'
          },
          silent: true,
          error: this.onCourseLoadError,
          success: this.onCourseLoad
        });
        tracker.timeXHR(courseFetch, 'fetch-course', {
          courseId: courseId.toString()
        });
        return this._renderTimer = tracker.createTimer('render-course', {
          courseId: courseId.toString()
        });
      };

      PlayerApplication.prototype.onCourseLoad = function(courseModel) {
        var catalogs, filters;
        this.course = courseModel;
        mediator.catalogue = new GadgetProjects(courseModel.palette.models);
        if (settings.get('noEditable')) {
          courseModel.set({
            isEditable: false
          });
        }
        this._configureTracking();
        if (courseModel.get('isEditable')) {
          this.initializeCollab();
        }
        this.layout.header.show(new HeaderView({
          model: courseModel
        }));
        if (courseModel.get('isEditable')) {
          catalogs = {
            all: this.combinedCatalogue,
            course: courseModel.palette,
            sandbox: this.combinedCatalogue.sandbox
          };
          this.layout.sidebar.show(new AuthorSidebarView({
            model: courseModel
          }));
          this.layout.tray.show(new TrayView({
            model: courseModel,
            catalogs: catalogs
          }));
          this.layout.footer.show(filters = new TrayFiltersView({
            catalogs: catalogs
          }));
          this.combinedCatalogue.ready.done((function(_this) {
            return function() {
              var expandTray;
              mediator.catalogue.add(_this.combinedCatalogue.models);
              expandTray = true;
              if (localStorage.hasOwnProperty('versalTrayExpanded')) {
                expandTray = localStorage.versalTrayExpanded === 'true';
              }
              if (expandTray) {
                filters.selectCatalog('all');
                return filters._usedOpenButtonToExpand = true;
              }
            };
          })(this));
          $(this.layout.el).addClass('editable');
        } else {
          this.layout.sidebar.show(new LearnerSidebarView({
            model: courseModel
          }));
        }
        this.courseView = new CourseView({
          model: courseModel
        });
        this.layout.courseContainer.show(this.courseView);
        if (courseModel.get('currentPosition') == null) {
          courseModel.start();
        }
        this._notifyTitleChanged(courseModel);
        courseModel.on('change:title', this._notifyTitleChanged);
        return this._courseRendering.resolve();
      };

      PlayerApplication.prototype.onCourseLoadError = function(courseModel, x, r) {
        return mediator.trigger('parent:notify', {
          event: 'player:loadingError',
          data: {
            status: x.status,
            message: x.responseText
          }
        });
      };

      PlayerApplication.prototype._showLesson = function(lessonIndex) {
        return this._courseRendering.done((function(_this) {
          return function() {
            return _this.courseView.showLesson(lessonIndex);
          };
        })(this));
      };

      PlayerApplication.prototype._showGadget = function(lessonIndex, gadgetIndex) {
        return this._courseRendering.done((function(_this) {
          return function() {
            return _this.courseView.showGadget(lessonIndex, gadgetIndex);
          };
        })(this));
      };

      PlayerApplication.prototype._onAllGadgetsRendered = function(lesson) {
        var message, _ref;
        this.loadingView.hide(((function(_this) {
          return function() {
            return _this.layout.loading.reset();
          };
        })(this)));
        if (this._playerLoaded) {
          return;
        }
        message = {
          event: 'player:loaded',
          course: this.course.pick('title', 'isEditable')
        };
        mediator.trigger('parent:notify', message);
        this._playerLoaded = true;
        return (_ref = this._renderTimer) != null ? _ref.stop() : void 0;
      };

      PlayerApplication.prototype._onNavigateLesson = function(lessonIndex) {
        if (!this.course) {
          return;
        }
        window.parent.postMessage({
          event: 'setLearnerState',
          data: {
            lessonIndex: lessonIndex
          }
        }, '*');
        return mediator.trigger('parent:notify', {
          event: 'player:navigate:lesson',
          data: {
            lessonIndex: lessonIndex
          }
        });
      };

      PlayerApplication.prototype._onNavigateGadget = function(lessonIndex, gadgetIndex) {
        if (!this.course) {
          return;
        }
        window.parent.postMessage({
          event: 'setLearnerState',
          data: {
            lessonIndex: lessonIndex,
            gadgetIndex: gadgetIndex
          }
        }, '*');
        return mediator.trigger('parent:notify', {
          event: 'player:navigate:gadget',
          data: {
            lessonIndex: lessonIndex,
            gadgetIndex: gadgetIndex
          }
        });
      };

      PlayerApplication.prototype._configureTracking = function() {
        var courseId, courseState, interactionId, segmentSettings, segmentioKey, sessionId, userId, _ref, _ref1;
        interactionId = _.random(1e15, 1e16).toString(32);
        courseId = settings.get('courseId');
        userId = (_ref = this.course.get('currentPosition')) != null ? _ref.userId : void 0;
        sessionId = (_ref1 = settings.get('api')) != null ? _ref1.sessionId : void 0;
        segmentSettings = settings.get('segmentio');
        if (segmentioKey = segmentSettings != null ? segmentSettings.write_key : void 0) {
          analytics.load(segmentioKey);
          analytics.page();
          analytics.identify(sessionId, {
            interactionId: interactionId
          });
          if (settings.get('embedded')) {
            analytics.track('Loaded course embed', {
              courseId: courseId
            });
          }
        }
        if (!this.course.get('isEditable')) {
          courseState = this.course.get('currentPosition') ? 'Continued course' : 'Started course';
          analytics.track(courseState, {
            courseId: courseId
          });
        }
        tracker.configure({
          interactionId: interactionId,
          courseId: courseId,
          userId: userId
        });
        if (settings.get('keen')) {
          return Keen.configure({
            projectId: settings.get('keen').projectId,
            writeKey: settings.get('keen').writeKey
          });
        }
      };

      PlayerApplication.prototype._notifyTitleChanged = function(course) {
        var message;
        message = {
          event: 'player:course:title:changed',
          data: course.title()
        };
        return mediator.trigger('parent:notify', message);
      };

      return PlayerApplication;

    })();
  });

}).call(this);

